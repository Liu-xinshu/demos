(function(r){var i={};function n(e){if(i[e]){return i[e].exports}var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=r;n.c=i;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(t,e){if(e&1)t=n(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=273)})([function(e,t,r){var v=r(6);var m=r(29);var _=r(22);var y=r(23);var g=r(30);var w="prototype";var F=function(e,t,r){var i=e&F.F;var n=e&F.G;var a=e&F.S;var o=e&F.P;var s=e&F.B;var l=n?v:a?v[t]||(v[t]={}):(v[t]||{})[w];var u=n?m:m[t]||(m[t]={});var d=u[w]||(u[w]={});var c,f,h,p;if(n)r=t;for(c in r){f=!i&&l&&l[c]!==undefined;h=(f?l:r)[c];p=s&&f?g(h,v):o&&typeof h=="function"?g(Function.call,h):h;if(l)y(l,c,h,e&F.U);if(u[c]!=h)_(u,c,p);if(o&&d[c]!=h)d[c]=h}};v.core=m;F.F=1;F.G=2;F.S=4;F.P=8;F.B=16;F.W=32;F.U=64;F.R=128;e.exports=F},function(e,t,r){"use strict";t.__esModule=true;t.default=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}},function(e,t,r){"use strict";t.__esModule=true;var i=r(231);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;(0,n.default)(e,i.key,i)}}return function(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}}()},function(e,t,r){e.exports={default:r(477),__esModule:true}},function(e,t,r){var i=r(8);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMisc=undefined;var i=r(1);var n=l(i);var a=r(506);var o=r(83);var s=r(510);function l(e){return e&&e.__esModule?e:{default:e}}var u=function e(){(0,n.default)(this,e)};u.getLabelOpt=function(e){return{style:Freedo.LabelStyle.FILL_AND_OUTLINE,text:e,show:true,fillColor:new Freedo.Color(1,1,1,1),outlineWidth:2,outlineColor:new Freedo.Color(.165,.165,.165,1),showBackground:false,backgroundColor:new Freedo.Color(.165,.165,.165,1),font:"16px 雅黑",horizontalOrigin:Freedo.HorizontalOrigin.LEFT,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,pixelOffset:new Freedo.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY}};u.upperFirst=function(e){var t=e.split(" ");for(var r=0;r<t.length;r++){var i=t[r].slice(0,1).toUpperCase();var n=t[r].slice(1);t[r]=i+n}return t.join(" ")};Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var r in t){if(new RegExp("("+r+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[r]:("00"+t[r]).substr((""+t[r]).length))}return e};function d(e,t,r,i){var n=0,a=0,o="",s="",l=0,u=0,d=[].concat(e),c=[].concat(t),f=r,h=c instanceof Array,p=f instanceof Array;f=[].concat(f);if(i){this.window[i]=0}for(n=0,l=f.length;n<l;n++){if(f[n]===""){continue}for(a=0,u=d.length;a<u;a++){o=f[n]+"";s=h?c[a]!==undefined?c[a]:"":c[0];f[n]=o.split(d[a]).join(s);if(i&&f[n]!==o){this.window[i]+=(o.length-f[n].length)/d[a].length}}}return p?f:f[0]}String.prototype.Has=function(e){if(this.indexOf(e)==-1)return false;else return true};String.prototype.replaceAll=function(e,t){return d(e,t,this)};String.prototype.Left=String.prototype.left=function(e){return this.substr(0,e)};String.prototype.Right=String.prototype.right=function(e){return this.substr(this.length-e,e)};u.now=function(){var e=new Date;return e.format("yyyy-MM-dd hh:mm:ss")};u.FdGeometric=a.FdGeometric;u.FdMath=o.FdMath;u.FdAjax=s.FdAjax;var c=r(165);if(typeof window.mobx==="undefined"){window.mobx=c}t.FdMisc=u},function(e,t){var r=e.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=r},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return true}}},function(e,t){e.exports=function(e){return typeof e==="object"?e!==null:typeof e==="function"}},function(e,t,r){"use strict";function i(e){return Object.prototype.toString.call(e)}function n(e){return i(e)==="[object String]"}var a=Object.prototype.hasOwnProperty;function o(e,t){return a.call(e,t)}function s(r){var e=Array.prototype.slice.call(arguments,1);e.forEach(function(t){if(!t){return}if(typeof t!=="object"){throw new TypeError(t+"must be object")}Object.keys(t).forEach(function(e){r[e]=t[e]})});return r}function l(e,t,r){return[].concat(e.slice(0,t),r,e.slice(t+1))}function u(e){if(e>=55296&&e<=57343){return false}if(e>=64976&&e<=65007){return false}if((e&65535)===65535||(e&65535)===65534){return false}if(e>=0&&e<=8){return false}if(e===11){return false}if(e>=14&&e<=31){return false}if(e>=127&&e<=159){return false}if(e>1114111){return false}return true}function d(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(e&1023);return String.fromCharCode(t,r)}return String.fromCharCode(e)}var c=/\\([!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~])/g;var f=/&([a-z#][a-z0-9]{1,31});/gi;var h=new RegExp(c.source+"|"+f.source,"gi");var p=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;var v=r(253);function m(e,t){var r=0;if(o(v,t)){return v[t]}if(t.charCodeAt(0)===35&&p.test(t)){r=t[1].toLowerCase()==="x"?parseInt(t.slice(2),16):parseInt(t.slice(1),10);if(u(r)){return d(r)}}return e}function _(e){if(e.indexOf("\\")<0){return e}return e.replace(c,"$1")}function y(e){if(e.indexOf("\\")<0&&e.indexOf("&")<0){return e}return e.replace(h,function(e,t,r){if(t){return t}return m(e,r)})}var g=/[&<>"]/;var w=/[&<>"]/g;var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function b(e){return F[e]}function C(e){if(g.test(e)){return e.replace(w,b)}return e}var x=/[.?*+^$[\]\\(){}|-]/g;function P(e){return e.replace(x,"\\$&")}function M(e){switch(e){case 9:case 32:return true}return false}function T(e){if(e>=8192&&e<=8202){return true}switch(e){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return true}return false}var E=r(174);function S(e){return E.test(e)}function A(e){switch(e){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return true;default:return false}}function k(e){return e.trim().replace(/\s+/g," ").toUpperCase()}t.lib={};t.lib.mdurl=r(254);t.lib.ucmicro=r(616);t.assign=s;t.isString=n;t.has=o;t.unescapeMd=_;t.unescapeAll=y;t.isValidEntityCode=u;t.fromCodePoint=d;t.escapeHtml=C;t.arrayReplaceAt=l;t.isSpace=M;t.isWhiteSpace=T;t.isMdAsciiPunct=A;t.isPunctChar=S;t.escapeRE=P;t.normalizeReference=k},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPolylineEditor=undefined;var i=r(3);var u=v(i);var n=r(1);var a=v(n);var o=r(2);var s=v(o);var l=r(5);var d=r(170);var c=r(82);var f=r(237);var h=r(83);var p=r(120);function v(e){return e&&e.__esModule?e:{default:e}}var m=function(){function t(e){(0,a.default)(this,t);this._viewer=e;this._polylines={};this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._curGuid=undefined;this._startPoint=undefined;this._hasTempLine=false;this._tempLine=undefined;this._tempPoint={};this._startCapture=false;this._bKeydown=false;this._lineWidth=2;this._autoClose=true;this._autoDelLines=false;this._singleLineMode=false;this._heightOffset=0;this._handler=undefined;this._keyBoard=undefined;this._editPTs=[];this._editIndex=0;this._editPl=undefined;this._editPt=undefined;this._editTran=new d.FdTransformHelper(e);this._editTran.setAxisSize(5);this._editLsnr=undefined;this._pointNum=1;this._movement=undefined;this._canvas=undefined}(0,s.default)(t,[{key:"pleOptions",get:function e(){var t=[];for(var r in this._polylines){t.push({pts:this._polylines[r].pts})}return t},set:function e(t){this.removeAll();for(var r in t){var i=t[r].pts;this.setStartPt(i[0]);for(var n=0;n<i.length-1;n++){this.addResult(i[n+1])}}this._startPoint=undefined;this._curGuid=undefined}}]);return t}();m.prototype.run=function(){this.registerHandlers();this._startCapture=true;this._event.raiseEvent("Start",{})};m.prototype.start=function(){this.run()};m.prototype.callbackPt=function(e,t){t=this._editPts[this._editIndex];return t};m.prototype.startEditPt=function(){if(!this._editPt){var e=new Freedo.CallbackProperty(this.callbackPt.bind(this),false);this._editPt=this._viewer.entities.add({position:e,point:{pixelSize:10,color:Freedo.Color.YELLOW.withAlpha(.9)}})}this._editPt.boundingSphere=new Freedo.BoundingSphere(this._editPts[this._editIndex],10);this._editPt.modelMatrix=Freedo.clone(Freedo.Matrix4.IDENTITY,true);this._viewer.camera.viewBoundingSphere(this._editPt.boundingSphere,new Freedo.HeadingPitchRange(10,-.5,0));this._viewer.camera.lookAtTransform(Freedo.Matrix4.IDENTITY);this._editTran.setData([this._editPt]);this._editTran.start("MOVE")};m.prototype.startEdit=function(e){this._editPts=Freedo.clone(e,true);this._editPl=this._viewer.scene.primitives.add(this.createLinePrimitive(e));this._editIndex=0;this.startEditPt();if(this._editLsnr)this._editLsnr();var n=this;this._editLsnr=this._editTran.on(function(e,t){if(e=="Transforming"){var r=n._editPts[n._editIndex];var i=Freedo.Cartographic.fromDegrees(t.TMoveX,t.TMoveY,t.TMoveZ);n._editPts[n._editIndex]=Freedo.Cartographic.toCartesian(i)}if(e=="Transformed"){n._editPt.boundingSphere=new Freedo.BoundingSphere(n._editPts[n._editIndex],10);if(n._editPl)n._viewer.scene.primitives.remove(n._editPl);n._editPl=n._viewer.scene.primitives.add(n.createLinePrimitive(n._editPts));var i=Freedo.Cartographic.fromDegrees(t.TMoveX,t.TMoveY,t.TMoveZ);n._event.raiseEvent("Transformed",{positionG:i})}})};m.prototype.editPre=function(){this._editIndex-=1;if(this._editIndex<0)this._editIndex=0;this.startEditPt()};m.prototype.editNext=function(){this._editIndex+=1;if(this._editIndex>this._editPts.length-1)this._editIndex=this._editPts.length-1;this.startEditPt()};m.prototype.editPtByIndex=function(e){e=parseInt(e);if(e>=this._editPts.length){e=this._editPts.length-1}else if(e<0){e=0}this._editIndex=e;this.startEditPt()};m.prototype.endEdit=function(){this._editTran.cancel();this._viewer.entities.remove(this._editPt);this._viewer.scene.primitives.remove(this._editPl);this._event.raiseEvent("EditEnd",{pts:this._editPts})};m.prototype.showMouseTip=function(e){this.changeMouseIcon(e)};m.prototype.setAutoLoop=function(e){this._autoClose=e};m.prototype.setAutoClose=function(e){this._autoClose=e};m.prototype.setAutoDelLines=function(e){this._autoDelLines=e};m.prototype.setHeightOffset=function(e){this._heightOffset=e};m.prototype.onKeyDown=function(){if(!this._startCapture)return;this.bKeydown=true;if(window.event.keyCode==27){this.cancel()}};m.prototype.onKeyUp=function(){if(!this._startCapture)return;this.bKeydown=false};m.prototype.setStartPt=function(e){this._startPoint=e;this._curGuid=Freedo.createGuid();this._polylines[this._curGuid]={};this._polylines[this._curGuid].lines=[];this._polylines[this._curGuid].pts=[];this._polylines[this._curGuid].ptsG=[];this._polylines[this._curGuid].pts[0]=e};m.prototype.callbackX=function(){return[this._startPoint,this._tempPoint]};m.prototype.updateTmpLine=function(e){var t=l.FdMisc.FdGeometric.pickPositionG(this._viewer,e);if(Freedo.defined(t)){var r;if(this._viewer.scene.globe)r=l.FdMisc.FdGeometric.tc(t);else r=new Freedo.Cartesian3(t[0],t[1],t[2]);this._tempPoint=r;if(!this._hasTempLine){this._hasTempLine=true;var i=new Freedo.PolylineMaterialAppearance({material:Freedo.Material.fromType("Color",{color:new Freedo.Color(1,.3,.3,.5)})});var n=new Freedo.PolylineMaterialAppearance({material:Freedo.Material.fromType("PolylineDash",{color:new Freedo.Color(1,.3,.3,.5)})});this._tempLine=this._viewer.scene.primitives.add(new p.FdChangeablePrimitive({appearance:i,depthFailAppearance:n}))}this._tempLine.setAttribute("geometryInstances",new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:this.callbackX(),arcType:this._viewer.scene.planeMode?Freedo.ArcType.NONE:undefined,width:2})}))}this._viewer.scene.requestRender()};m.prototype.removeTmpLine=function(){if(this._tempLine){this._viewer.scene.primitives.remove(this._tempLine);this._hasTempLine=false}};m.prototype.createLinePrimitive=function(e){var t,r;if(this._viewer.scene.globe){r=true}else{r=false}t=new Freedo.PolylineGeometry({positions:e,width:2,followSurface:r,arcType:this._viewer.scene.planeMode?Freedo.ArcType.NONE:undefined,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT});return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:t}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})};m.prototype.addResult=function(e){var t=[this._startPoint,e];var r=this._viewer.scene.primitives.add(this.createLinePrimitive([t[0],t[1]]));if(Freedo.defined(this._polylines[this._curGuid])){this._polylines[this._curGuid].lines.push(r);this._polylines[this._curGuid].pts.push(e);if(this._viewer.scene.globe){var i=l.FdMisc.FdGeometric.tg(e);this._polylines[this._curGuid].ptsG.push(i)}else{this._polylines[this._curGuid].ptsG.push(e)}}this._startPoint=Freedo.clone(e,true);this._endPoint=undefined};m.prototype.pickStartPoint=function(e){var t=l.FdMisc.FdGeometric.pickPositionG(this._viewer,e);if(Freedo.defined(t)){t[2]+=this._heightOffset;if(this._viewer.scene.globe){this._startPoint=l.FdMisc.FdGeometric.tc(t);this._polylines[this._curGuid].pts.push(l.FdMisc.FdGeometric.tc(t))}else{this._startPoint=new Freedo.Cartesian3(t[0],t[1],t[2]);this._polylines[this._curGuid].pts.push(this._startPoint)}this._polylines[this._curGuid].ptsG.push(t);this._pointNum+=1;this._event.raiseEvent("PointAdded",{position:t})}};m.prototype.pickEndPoint=function(e){var t=l.FdMisc.FdGeometric.pickPositionG(this._viewer,e);if(Freedo.defined(t)){t[2]+=this._heightOffset;if(this._viewer.scene.globe)this.addResult(l.FdMisc.FdGeometric.tc(t));else this.addResult(new Freedo.Cartesian3(t[0],t[1],t[2]));this._pointNum+=1;this._event.raiseEvent("PointAdded",{position:t})}};m.prototype.onMouseLeftClick=function(e){if(!this._startCapture)return;if(!Freedo.defined(this._curGuid)){this._curGuid=Freedo.createGuid();this._polylines[this._curGuid]={};this._polylines[this._curGuid].lines=[];this._polylines[this._curGuid].pts=[];this._polylines[this._curGuid].ptsG=[]}if(!Freedo.defined(this._polylines[this._curGuid]))return;if(this._startPoint){this.pickEndPoint(e.position)}else{this.pickStartPoint(e.position)}};m.prototype.delResult=function(e){if(!e)e=this._curGuid;var t=this._polylines[e].lines;if(t){var r=true;var i=false;var n=undefined;try{for(var a=(0,u.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._viewer.scene.primitives.remove(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}this._polylines[e]=undefined};m.prototype.polylineAdded=function(){var s=this;var e={id:this._curGuid,polyline:this._polylines[this._curGuid]};this._event.raiseEvent("PLAdd",e);this._event.raiseEvent("DataChanged",e);if(this._autoDelLines){if(!this._curGuid)return;var l=this._polylines[this._curGuid].lines;if(!Freedo.defined(l)){console.log("FdPolylineEditor lines异常")}var t=true;var r=false;var i=undefined;try{for(var n=(0,u.default)(l),a;!(t=(a=n.next()).done);t=true){var o=a.value;o.show=false}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}setTimeout(function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,u.default)(l),a;!(t=(a=n.next()).done);t=true){var o=a.value;s._viewer.scene.primitives.remove(o)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}e.lines=[]},1e3,this._polylines[this._curGuid])}this._viewer.scene.requestRender()};m.prototype.onMouseRightClick=function(e){this._pointNum=1;if(this._canvas&&this._context){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var t="请点击添加第"+this._pointNum+"个点";this._context.fillText(t,0,14)}if(!e){this.delResult(this._curGuid);this.removeTmpLine();this._startPoint=undefined;this._curGuid=undefined;this._viewer.scene.requestRender();return}if(!this._startCapture)return;if(!!this._startPoint){var r=this._polylines[this._curGuid].pts.length;var i=this._polylines[this._curGuid].pts[0];var n=this._polylines[this._curGuid].pts[r-1];if(this._autoClose){var a=this._viewer.scene.primitives.add(this.createLinePrimitive([n,i]));this._polylines[this._curGuid].lines.push(a);this._polylines[this._curGuid].pts.push(i);var o=l.FdMisc.FdGeometric.tg(i);this._polylines[this._curGuid].ptsG.push(o);if(this._polylines[this._curGuid].pts.length<=3){this.delResult(this._curGuid)}}else{if(this._polylines[this._curGuid].pts.length<=1){this.delResult(this._curGuid)}}if(this._polylines[this._curGuid])this.polylineAdded();this.removeTmpLine();this._startPoint=undefined;this._curGuid=undefined;this._viewer.scene.requestRender()}this._event.raiseEvent("Finished",{})};m.prototype.forceFinish=function(){this.onMouseRightClick()};m.prototype.forceEnd=function(){this.onMouseRightClick()};m.prototype.onMouseMove=function(e){if(!this._startCapture)return;if(this._startPoint&&!Freedo.Cartesian3.equals(e.endPosition,e.startPosition)){this.updateTmpLine(e.endPosition)}if(this._canvas&&this._context){this.updateTip(e)}};m.prototype.registerHandlers=function(){var r=this;this._handler=this._handler&&this._handler.destroy();this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.onMouseLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(this.onMouseRightClick.bind(this),Freedo.ScreenSpaceEventType.RIGHT_CLICK);this._handler.setInputAction(this.onMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._keyBoard=new c.FdKeyboard(this._viewer);this._keyBoard.enable();this._keyBoard.on(function(e,t){if(e==="keyUp"){if(t.keyCode==27){r.cancel()}}})};m.prototype.changeMouseIcon=function(e){var t=this._viewer.container.id;var r=document.getElementById(t);if(this._startCapture&&e){r.style.cursor="url('"+Freedo.FdApp.getFreedoXPath()+"Assets/Textures/pen.png') 0 32, crosshair";this.drawTip(true)}else{r.style.cursor="default";this.drawTip(false)}this._viewer.scene.requestRender()};m.prototype.drawTip=function(e){if(this._startCapture&&e){if(this._canvas){document.body.removeChild(this._canvas);this._canvas=undefined}this._canvas=document.createElement("canvas");this._canvas.style.position="absolute";this._canvas.style.display="block";this._canvas.style.zIndex="999";this._canvas.style.backgroundColor="rgba(213, 213, 213, 0.835)";this._canvas.style.borderTopLeftRadius="4px";this._canvas.style.borderTopRightRadius="4px";this._canvas.style.borderBottomRightRadius="4px";this._canvas.style.borderBottomLeftRadius="4px";this._canvas.height=20;this._canvas.width=160;this._context=this._canvas.getContext("2d");this._context.clearRect(0,0,this._canvas.width,this._canvas.height);this._context.font="16px 雅黑";this._context.fillStyle="black";document.body.appendChild(this._canvas)}else{this._pointNum=1;this._movement=undefined;this._context.clearRect(0,0,this._canvas.width,this._canvas.height);this._context=undefined;document.body.removeChild(this._canvas);this._canvas=undefined}this._viewer.scene.requestRender()};m.prototype.updateTip=function(e){this._context.clearRect(0,0,this._canvas.width,this._canvas.height);var t=e.endPosition;this._canvas.style.left=window.event.pageX+36+"px";this._canvas.style.top=window.event.pageY-22+"px";var r=new Freedo.Cartesian2(t.x,t.y);var i=this._viewer.scene.globe.pick(this._viewer.camera.getPickRay(r),this._viewer.scene);if(i){var n="请点击添加第"+this._pointNum+"个点";this._context.fillText(n,8,16)}else{var n="当前位置无法绘制";this._context.fillText(n,8,16)}};m.prototype.getData=function(){return this._polylines};m.prototype.cancel=function(){this._startCapture=false;this.removeAll();this._handler=this._handler&&this._handler.destroy();this._keyBoard=this._keyBoard&&this._keyBoard.dispose();if(this._canvas&&this._context){this.changeMouseIcon(false)}this._event.raiseEvent("Cancel",{})};m.prototype.removeAll=function(){for(var e in this._polylines){if(this._polylines[e]!=undefined){var t=true;var r=false;var i=undefined;try{for(var n=(0,u.default)(this._polylines[e].lines),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._viewer.scene.primitives.remove(o)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}}}this.removeTmpLine();this._polylines={};this._startPoint=undefined;this._curGuid=undefined;this._viewer.scene.requestRender()};m.prototype.hideAll=function(){for(var e in this._polylines){var t=true;var r=false;var i=undefined;try{for(var n=(0,u.default)(this._polylines[e].lines),a;!(t=(a=n.next()).done);t=true){var o=a.value;o.show=false}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}}};m.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};m.prototype.reset=function(){this.cancel()};m.prototype.dispose=function(){this.reset()};t.FdPolylineEditor=m},function(e,t,r){var i=r(98)("wks");var n=r(58);var a=r(6).Symbol;var o=typeof a=="function";var s=e.exports=function(e){return i[e]||(i[e]=o&&a[e]||(o?a:n)("Symbol."+e))};s.store=i},function(e,t,r){var i=r(32);var n=Math.min;e.exports=function(e){return e>0?n(i(e),9007199254740991):0}},function(e,t){var r=e.exports={version:"2.6.2"};if(typeof __e=="number")__e=r},function(e,t,r){e.exports=!r(7)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(e,t,r){var n=r(4);var a=r(180);var o=r(38);var s=Object.defineProperty;t.f=r(14)?Object.defineProperty:function e(t,r,i){n(t);r=o(r,true);n(i);if(a)try{return s(t,r,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");if("value"in i)t[r]=i.value;return t}},function(e,t,r){var i=r(39);e.exports=function(e){return Object(i(e))}},function(e,t,r){var v=r(20);var m=r(13);var _=r(53);var y=r(54);var g=r(69);var w="prototype";var F=function(e,t,r){var i=e&F.F;var n=e&F.G;var a=e&F.S;var o=e&F.P;var s=e&F.B;var l=e&F.W;var u=n?m:m[t]||(m[t]={});var d=u[w];var c=n?v:a?v[t]:(v[t]||{})[w];var f,h,p;if(n)r=t;for(f in r){h=!i&&c&&c[f]!==undefined;if(h&&g(u,f))continue;p=h?c[f]:r[f];u[f]=n&&typeof c[f]!="function"?r[f]:s&&h?_(p,v):l&&c[f]==p?function(i){var e=function(e,t,r){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(e);case 2:return new i(e,t)}return new i(e,t,r)}return i.apply(this,arguments)};e[w]=i[w];return e}(p):o&&typeof p=="function"?_(Function.call,p):p;if(o){(u.virtual||(u.virtual={}))[f]=p;if(e&F.R&&d&&!d[f])y(d,f,p)}}};F.F=1;F.G=2;F.S=4;F.P=8;F.B=16;F.W=32;F.U=64;F.R=128;e.exports=F},function(e,t,r){"use strict";t.__esModule=true;var i=r(55);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}t.default=n.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r){if(Object.prototype.hasOwnProperty.call(r,i)){e[i]=r[i]}}}return e}},function(e,t){e.exports=function(e){if(typeof e!="function")throw TypeError(e+" is not a function!");return e}},function(e,t){var r=e.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=r},function(e,t,r){var i=r(158)("wks");var n=r(115);var a=r(20).Symbol;var o=typeof a=="function";var s=e.exports=function(e){return i[e]||(i[e]=o&&a[e]||(o?a:n)("Symbol."+e))};s.store=i},function(e,t,r){var i=r(15);var n=r(57);e.exports=r(14)?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){e[t]=r;return e}},function(e,t,r){var a=r(6);var o=r(22);var s=r(25);var l=r(58)("src");var i="toString";var n=Function[i];var u=(""+n).split(i);r(29).inspectSource=function(e){return n.call(e)};(e.exports=function(e,t,r,i){var n=typeof r=="function";if(n)s(r,"name")||o(r,"name",t);if(e[t]===r)return;if(n)s(r,l)||o(r,l,e[t]?""+e[t]:u.join(String(t)));if(e===a){e[t]=r}else if(!i){delete e[t];o(e,t,r)}else if(e[t]){e[t]=r}else{o(e,t,r)}})(Function.prototype,i,function e(){return typeof this=="function"&&this[l]||n.call(this)})},function(e,t,r){var i=r(0);var n=r(7);var o=r(39);var s=/"/g;var a=function(e,t,r,i){var n=String(o(e));var a="<"+t;if(r!=="")a+=" "+r+'="'+String(i).replace(s,"&quot;")+'"';return a+">"+n+"</"+t+">"};e.exports=function(t,e){var r={};r[t]=e(a);i(i.P+i.F*n(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",r)}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var i=r(85);var n=r(39);e.exports=function(e){return i(n(e))}},function(e,t,r){var i=r(86);var n=r(57);var a=r(26);var o=r(38);var s=r(25);var l=r(180);var u=Object.getOwnPropertyDescriptor;t.f=r(14)?u:function e(t,r){t=a(t);r=o(r,true);if(l)try{return u(t,r)}catch(e){}if(s(t,r))return n(!i.f.call(t,r),t[r])}},function(e,t,r){var i=r(25);var n=r(16);var a=r(126)("IE_PROTO");var o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){e=n(e);if(i(e,a))return e[a];if(typeof e.constructor=="function"&&e instanceof e.constructor){return e.constructor.prototype}return e instanceof Object?o:null}},function(e,t){var r=e.exports={version:"2.6.2"};if(typeof __e=="number")__e=r},function(e,t,r){var a=r(19);e.exports=function(i,n,e){a(i);if(n===undefined)return i;switch(e){case 1:return function(e){return i.call(n,e)};case 2:return function(e,t){return i.call(n,e,t)};case 3:return function(e,t,r){return i.call(n,e,t,r)}}return function(){return i.apply(n,arguments)}}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){var r=Math.ceil;var i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},function(e,t,r){"use strict";var i=r(7);e.exports=function(e,t){return!!e&&i(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,r){var n=r(47);var a=r(217);var o=r(155);var s=Object.defineProperty;t.f=r(43)?Object.defineProperty:function e(t,r,i){n(t);r=o(r,true);n(i);if(a)try{return s(t,r,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");if("value"in i)t[r]=i.value;return t}},function(e,t,r){e.exports={default:r(497),__esModule:true}},function(e,t,r){e.exports=r(714)},function(e,t,r){"use strict";t.__esModule=true;var i=r(49);var l=n(i);function n(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(){var s=e.apply(this,arguments);return new l.default(function(n,a){function o(e,t){try{var r=s[e](t);var i=r.value}catch(e){a(e);return}if(r.done){n(i)}else{return l.default.resolve(i).then(function(e){o("next",e)},function(e){o("throw",e)})}}return o("next")})}}},function(e,t,r){var n=r(8);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&typeof(r=e.toString)=="function"&&!n(i=r.call(e)))return i;if(typeof(r=e.valueOf)=="function"&&!n(i=r.call(e)))return i;if(!t&&typeof(r=e.toString)=="function"&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(e==undefined)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(0);var a=r(29);var o=r(7);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e];var i={};i[e]=t(r);n(n.S+n.F*o(function(){r(1)}),"Object",i)}},function(e,t,r){var g=r(30);var w=r(85);var F=r(16);var b=r(12);var i=r(142);e.exports=function(c,e){var f=c==1;var h=c==2;var p=c==3;var v=c==4;var m=c==6;var _=c==5||m;var y=e||i;return function(e,t,r){var i=F(e);var n=w(i);var a=g(t,r,3);var o=b(n.length);var s=0;var l=f?y(e,o):h?y(e,0):undefined;var u,d;for(;o>s;s++)if(_||s in n){u=n[s];d=a(u,s,i);if(c){if(f)l[s]=d;else if(d)switch(c){case 3:return true;case 5:return u;case 6:return s;case 2:l.push(u)}else if(v)return false}}return m?-1:p||v?v:l}}},function(e,t){e.exports=function(e){return typeof e==="object"?e!==null:typeof e==="function"}},function(e,t,r){e.exports=!r(68)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCommon=undefined;var i=r(36);var n=h(i);var a=r(49);var s=h(a);var o=r(37);var l=h(o);var u=r(84);var d=h(u);var c=r(1);var f=h(c);function h(e){return e&&e.__esModule?e:{default:e}}var p=function e(){(0,f.default)(this,e)};p.fdAjax=function(t){t=t||{};t.type=(t.type||"GET").toUpperCase();t.dataType=t.dataType||"json";t.async=t.async||true;var e="";if(t.data){e=(0,d.default)(t.data)}if(window.XMLHttpRequest){var r=new XMLHttpRequest}else{var r=new ActiveXObject("Microsoft.XMLHTTP")}r.onreadystatechange=function(){if(r.readyState===4){var e=r.status;if(e>=200&&e<300){t.success&&t.success(r.responseText,r.responseXML)}else{t.fail&&t.fail(r.responseText,r.responseXML)}}};if(t.type==="GET"){r.open("GET",t.url+e,t.async);r.send(null)}else if(t.type==="POST"){r.open("POST",t.url,t.async);r.setRequestHeader("Content-type","application/json; charset=utf-8");if(t.token!==undefined){r.setRequestHeader("Authorization",t.token)}r.send(e)}};p.ajaxJson=function(){var t=(0,l.default)(n.default.mark(function e(r){var o;return n.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=r.dataType||"json";return t.abrupt("return",new s.default(function(n,a){p.fdAjax({url:r.url,type:r.type||"POST",data:r.data||null,dataType:r.dataType||"json",success:function e(t,r){if(o==="json"){if(t){var i=JSON.parse(t);n(i)}else{a(t)}}else{n(r)}},fail:function e(t,r){var i=JSON.parse(t);a(i)}})}));case 2:case"end":return t.stop()}}},e,this)}));return function(e){return t.apply(this,arguments)}}();t.FdCommon=p},function(e,t,r){"use strict";if(r(14)){var g=r(51);var w=r(6);var F=r(7);var b=r(0);var C=r(109);var i=r(150);var h=r(30);var x=r(64);var n=r(57);var P=r(22);var a=r(66);var o=r(32);var M=r(12);var T=r(208);var s=r(60);var l=r(38);var u=r(25);var E=r(75);var S=r(8);var p=r(16);var v=r(139);var A=r(61);var k=r(28);var L=r(62).f;var m=r(141);var d=r(58);var c=r(11);var f=r(41);var _=r(99);var y=r(88);var D=r(144);var I=r(77);var R=r(104);var O=r(63);var N=r(143);var B=r(197);var H=r(15);var V=r(27);var G=H.f;var z=V.f;var U=w.RangeError;var j=w.TypeError;var q=w.Uint8Array;var W="ArrayBuffer";var X="Shared"+W;var Z="BYTES_PER_ELEMENT";var Y="prototype";var J=Array[Y];var Q=i.ArrayBuffer;var K=i.DataView;var $=f(0);var ee=f(2);var te=f(3);var re=f(4);var ie=f(5);var ne=f(6);var ae=_(true);var oe=_(false);var se=D.values;var le=D.keys;var ue=D.entries;var de=J.lastIndexOf;var ce=J.reduce;var fe=J.reduceRight;var he=J.join;var pe=J.sort;var ve=J.slice;var me=J.toString;var _e=J.toLocaleString;var ye=c("iterator");var ge=c("toStringTag");var we=d("typed_constructor");var Fe=d("def_constructor");var be=C.CONSTR;var Ce=C.TYPED;var xe=C.VIEW;var Pe="Wrong length!";var Me=f(1,function(e,t){return ke(y(e,e[Fe]),t)});var Te=F(function(){return new q(new Uint16Array([1]).buffer)[0]===1});var Ee=!!q&&!!q[Y].set&&F(function(){new q(1).set({})});var Se=function(e,t){var r=o(e);if(r<0||r%t)throw U("Wrong offset!");return r};var Ae=function(e){if(S(e)&&Ce in e)return e;throw j(e+" is not a typed array!")};var ke=function(e,t){if(!(S(e)&&we in e)){throw j("It is not a typed array constructor!")}return new e(t)};var Le=function(e,t){return De(y(e,e[Fe]),t)};var De=function(e,t){var r=0;var i=t.length;var n=ke(e,i);while(i>r)n[r]=t[r++];return n};var Ie=function(e,t,r){G(e,t,{get:function(){return this._d[r]}})};var Re=function e(t){var r=p(t);var i=arguments.length;var n=i>1?arguments[1]:undefined;var a=n!==undefined;var o=m(r);var s,l,u,d,c,f;if(o!=undefined&&!v(o)){for(f=o.call(r),u=[],s=0;!(c=f.next()).done;s++){u.push(c.value)}r=u}if(a&&i>2)n=h(n,arguments[2],2);for(s=0,l=M(r.length),d=ke(this,l);l>s;s++){d[s]=a?n(r[s],s):r[s]}return d};var Oe=function e(){var t=0;var r=arguments.length;var i=ke(this,r);while(r>t)i[t]=arguments[t++];return i};var Ne=!!q&&F(function(){_e.call(new q(1))});var Be=function e(){return _e.apply(Ne?ve.call(Ae(this)):Ae(this),arguments)};var He={copyWithin:function e(t,r){return B.call(Ae(this),t,r,arguments.length>2?arguments[2]:undefined)},every:function e(t){return re(Ae(this),t,arguments.length>1?arguments[1]:undefined)},fill:function e(t){return N.apply(Ae(this),arguments)},filter:function e(t){return Le(this,ee(Ae(this),t,arguments.length>1?arguments[1]:undefined))},find:function e(t){return ie(Ae(this),t,arguments.length>1?arguments[1]:undefined)},findIndex:function e(t){return ne(Ae(this),t,arguments.length>1?arguments[1]:undefined)},forEach:function e(t){$(Ae(this),t,arguments.length>1?arguments[1]:undefined)},indexOf:function e(t){return oe(Ae(this),t,arguments.length>1?arguments[1]:undefined)},includes:function e(t){return ae(Ae(this),t,arguments.length>1?arguments[1]:undefined)},join:function e(t){return he.apply(Ae(this),arguments)},lastIndexOf:function e(t){return de.apply(Ae(this),arguments)},map:function e(t){return Me(Ae(this),t,arguments.length>1?arguments[1]:undefined)},reduce:function e(t){return ce.apply(Ae(this),arguments)},reduceRight:function e(t){return fe.apply(Ae(this),arguments)},reverse:function e(){var t=this;var r=Ae(t).length;var i=Math.floor(r/2);var n=0;var a;while(n<i){a=t[n];t[n++]=t[--r];t[r]=a}return t},some:function e(t){return te(Ae(this),t,arguments.length>1?arguments[1]:undefined)},sort:function e(t){return pe.call(Ae(this),t)},subarray:function e(t,r){var i=Ae(this);var n=i.length;var a=s(t,n);return new(y(i,i[Fe]))(i.buffer,i.byteOffset+a*i.BYTES_PER_ELEMENT,M((r===undefined?n:s(r,n))-a))}};var Ve=function e(t,r){return Le(this,ve.call(Ae(this),t,r))};var Ge=function e(t){Ae(this);var r=Se(arguments[1],1);var i=this.length;var n=p(t);var a=M(n.length);var o=0;if(a+r>i)throw U(Pe);while(o<a)this[r+o]=n[o++]};var ze={entries:function e(){return ue.call(Ae(this))},keys:function e(){return le.call(Ae(this))},values:function e(){return se.call(Ae(this))}};var Ue=function(e,t){return S(e)&&e[Ce]&&typeof t!="symbol"&&t in e&&String(+t)==String(t)};var je=function e(t,r){return Ue(t,r=l(r,true))?n(2,t[r]):z(t,r)};var qe=function e(t,r,i){if(Ue(t,r=l(r,true))&&S(i)&&u(i,"value")&&!u(i,"get")&&!u(i,"set")&&!i.configurable&&(!u(i,"writable")||i.writable)&&(!u(i,"enumerable")||i.enumerable)){t[r]=i.value;return t}return G(t,r,i)};if(!be){V.f=je;H.f=qe}b(b.S+b.F*!be,"Object",{getOwnPropertyDescriptor:je,defineProperty:qe});if(F(function(){me.call({})})){me=_e=function e(){return he.call(this)}}var We=a({},He);a(We,ze);P(We,ye,ze.values);a(We,{slice:Ve,set:Ge,constructor:function(){},toString:me,toLocaleString:Be});Ie(We,"buffer","b");Ie(We,"byteOffset","o");Ie(We,"byteLength","l");Ie(We,"length","e");G(We,ge,{get:function(){return this[Ce]}});e.exports=function(e,c,t,n){n=!!n;var f=e+(n?"Clamped":"")+"Array";var i="get"+e;var a="set"+e;var h=w[f];var o=h||{};var r=h&&k(h);var s=!h||!C.ABV;var l={};var u=h&&h[Y];var d=function(e,t){var r=e._d;return r.v[i](t*c+r.o,Te)};var p=function(e,t,r){var i=e._d;if(n)r=(r=Math.round(r))<0?0:r>255?255:r&255;i.v[a](t*c+i.o,r,Te)};var v=function(e,t){G(e,t,{get:function(){return d(this,t)},set:function(e){return p(this,t,e)},enumerable:true})};if(s){h=t(function(e,t,r,i){x(e,h,f,"_d");var n=0;var a=0;var o,s,l,u;if(!S(t)){l=T(t);s=l*c;o=new Q(s)}else if(t instanceof Q||(u=E(t))==W||u==X){o=t;a=Se(r,c);var d=t.byteLength;if(i===undefined){if(d%c)throw U(Pe);s=d-a;if(s<0)throw U(Pe)}else{s=M(i)*c;if(s+a>d)throw U(Pe)}l=s/c}else if(Ce in t){return De(h,t)}else{return Re.call(h,t)}P(e,"_d",{b:o,o:a,l:s,e:l,v:new K(o)});while(n<l)v(e,n++)});u=h[Y]=A(We);P(u,"constructor",h)}else if(!F(function(){h(1)})||!F(function(){new h(-1)})||!R(function(e){new h;new h(null);new h(1.5);new h(e)},true)){h=t(function(e,t,r,i){x(e,h,f);var n;if(!S(t))return new o(T(t));if(t instanceof Q||(n=E(t))==W||n==X){return i!==undefined?new o(t,Se(r,c),i):r!==undefined?new o(t,Se(r,c)):new o(t)}if(Ce in t)return De(h,t);return Re.call(h,t)});$(r!==Function.prototype?L(o).concat(L(r)):L(o),function(e){if(!(e in h))P(h,e,o[e])});h[Y]=u;if(!g)u.constructor=h}var m=u[ye];var _=!!m&&(m.name=="values"||m.name==undefined);var y=ze.values;P(h,we,true);P(u,Ce,f);P(u,xe,true);P(u,Fe,h);if(n?new h(1)[ge]!=f:!(ge in u)){G(u,ge,{get:function(){return f}})}l[f]=h;b(b.G+b.W+b.F*(h!=o),l);b(b.S,f,{BYTES_PER_ELEMENT:c});b(b.S+b.F*F(function(){o.of.call(h,1)}),f,{from:Re,of:Oe});if(!(Z in u))P(u,Z,c);b(b.P,f,He);O(f);b(b.P+b.F*Ee,f,{set:Ge});b(b.P+b.F*!_,f,ze);if(!g&&u.toString!=me)u.toString=me;b(b.P+b.F*F(function(){new h(1).slice()}),f,{slice:Ve});b(b.P+b.F*(F(function(){return[1,2].toLocaleString()!=new h([1,2]).toLocaleString()})||!F(function(){u.toLocaleString.call([1,2])})),f,{toLocaleString:Be});I[f]=_?m:y;if(!g&&!_)P(u,ye,y)}}else e.exports=function(){}},function(e,t,r){var a=r(203);var i=r(0);var n=r(98)("metadata");var o=n.store||(n.store=new(r(206)));var s=function(e,t,r){var i=o.get(e);if(!i){if(!r)return undefined;o.set(e,i=new a)}var n=i.get(t);if(!n){if(!r)return undefined;i.set(t,n=new a)}return n};var l=function(e,t,r){var i=s(t,r,false);return i===undefined?false:i.has(e)};var u=function(e,t,r){var i=s(t,r,false);return i===undefined?undefined:i.get(e)};var d=function(e,t,r,i){s(r,i,true).set(e,t)};var c=function(e,t){var r=s(e,t,false);var i=[];if(r)r.forEach(function(e,t){i.push(t)});return i};var f=function(e){return e===undefined||typeof e=="symbol"?e:String(e)};var h=function(e){i(i.S,"Reflect",e)};e.exports={store:o,map:s,has:l,get:u,set:d,keys:c,key:f,exp:h}},function(e,t,r){var i=r(42);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLoft=undefined;var i=r(96);var w=u(i);var n=r(18);var d=u(n);var a=r(3);var m=u(a);var o=r(1);var c=u(o);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var x=Math.PI;var P=function(){function u(e){var r=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,c.default)(this,u);if(arguments.length==0)return this;this._id=t;this._viewer=e;var n=i.positions,a=i.shape,o=i.shapeType;this.timer;this._primitive;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var s=Freedo.defaultValue(i.offsetHeight,10);if(!Freedo.defined(n)&&Freedo.defined(o)){var l=new Freedo.FdMicroApp.FdPolylineEditor(e);l.setAutoClose(false);l.setAutoDelLines(true);l.setHeightOffset(s);l.start();l.on(function(e,t){if(e!=="DataChanged")return;i.positions=t.polyline.pts;l.cancel();r.buildLoft(i)})}else this.buildLoft(i)}(0,l.default)(u,[{key:"showTestPts",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=r.txt,n=i===undefined?false:i,a=r.color,o=a===undefined?Freedo.Color.YELLOW:a,s=r.line,l=s===undefined?false:s;if(!this._testPtPrimitives)this._testPtPrimitives=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);var u=true;var d=false;var c=undefined;try{for(var f=(0,m.default)(t),h;!(u=(h=f.next()).done);u=true){var p=h.value;this._testPtPrimitives.add({position:p,color:o})}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}if(n){var v=this._viewer.scene.primitives.add(new Freedo.LabelCollection);t.forEach(function(e,t){v.add({position:e,text:""+t})})}if(l)this._viewer.entities.add({polyline:{positions:t.concat(t[0])}})}},{key:"showSt",value:function e(t,r){var i=r[r.length-2];for(var n=0;n<t.length/3;n++){this._viewer.entities.add({position:new Freedo.Cartesian3(t[3*n],t[3*n+1],t[3*n+2]),label:{fillColor:Freedo.Color.YELLOW,text:n+"#"+(r[2*n]/i).toFixed(2)+"&"+new Number(r[2*n+1]).toFixed(2)}})}}},{key:"showNormal",value:function e(t,r){for(var i=0;i<t.length/3;i++){var n=new Freedo.Cartesian3(r[3*i],r[3*i+1],r[3*i+2]),a=new Freedo.Cartesian3(t[3*i],t[3*i+1],t[3*i+2]),o=Freedo.Cartesian3.multiplyByScalar(n,500,new Freedo.Cartesian3);var s=Freedo.Cartesian3.add(a,o,new Freedo.Cartesian3);this._viewer.entities.add({polyline:{positions:[a,s],material:Freedo.Color.fromRandom({alpha:1})}})}}},{key:"removeTestPts",value:function e(){this._testPtPrimitives&&this._testPtPrimitives.removeAll()}},{key:"buildLoft",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this._data=Freedo.clone(t);var r=t.shape,i=t.positions,n=t.rate,a=n===undefined?720:n,o=t.smooth,s=t.image;if(!Freedo.defined(r))throw new Error("option.shape属性不能为空！");var l=u.smoothByPolyline(i,r,a,o);this._primitive=u.buildPrimitive(this._viewer,(0,d.default)({},t,l,{image:s}));this._viewer.scene.primitives.add(this._primitive);if(t.showDebugWireframe){this._debugWireframe=u.showWireframe(l.shapes,l.line,this._viewer)}this._event.raiseEvent("DataChanged",this)}},{key:"buildShape",value:function e(t,r,i,n){if(typeof t!=="string")return;var a=void 0;if(t.toLowerCase()==="circle"){a=u.buildCirclePts(r,i,n)}else if(t.toLowerCase()==="semicircle"){a=u.buildCirclePts(r,i,n);a=a.slice(a.length/2-1)}else if(t.toLowerCase()==="triangle"){a=u.buildCirclePts(r,i,n,3)}else if(t.toLowerCase()==="pentagram"){a=u.buildPentagramPts(r,i,n)}else if(t.toLowerCase()==="square"){a=u.buildCirclePts(r,i,n,4)}else if(t.toLowerCase()==="panel"){a=u.buildCirclePts(r,i,n,2);a.reverse();return a}else if(t.toLowerCase()==="road"){a=u.buildCirclePts(r,i,n,12);return[a[5],a[6],a[10],a[11]]}if(Freedo.defined(a)){a.push(a[0]);return a}return}},{key:"destroy",value:function e(){this._viewer.scene.primitives.remove(this._primitive);if(Freedo.defined(this._debugWireframe)){this._viewer.scene.primitives.remove(this._debugWireframe)}clearInterval(this.timer)}},{key:"remove",value:function e(){this.destroy()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"getData",value:function e(){return{id:this._id,type:"Loft",option:Freedo.clone(this._data)}}},{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return u}();P.buildPrimitive=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!t.shapes)throw"请传入特征点集合！";var r=P.triangulate(t.shapes,t.line,t.ratio);if(!Freedo.defined(t.image)||t.st===false)delete r.st;var i=Freedo.defaultValue(t.color,Freedo.Color.YELLOW);var n={idx:-1};var a=t.appearance?t.appearance:P.buildAppearance(t,r,e,n);this.timer=n.idx;var o=P.buildGeometry(r);return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:o,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(i)}}),appearance:a,asynchronous:false})};P.buildGeometry=function(e){var t=new Float64Array(e.positions);var r=e.compressSt===false?false:true;var i=e.normals&&new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:true,values:new Float32Array(e.normals)});var n=void 0;if(Freedo.defined(e.st)){var a=e.st[e.st.length-2];var o=new Float32Array(e.st.length);for(var s=0;s<e.st.length;s++){if(s%2===0)o[s]=r?e.st[s]/a:e.st[s];else o[s]=e.st[s]}n=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:o})}var l=void 0;if(Freedo.defined(e.idx)){l=new Uint32Array(e.idx.length);for(var u=0;u<e.idx.length;u++){l[u]=e.idx[u]}}var d=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t}),st:n,normal:i},indices:l,primitiveType:e.primitiveType,boundingSphere:Freedo.BoundingSphere.fromVertices(t)});return d};P.buildAppearance=function(e,t,r,i){var n=new Freedo.Cartesian2;var a=Freedo.defaultValue(e.loop,false);if(typeof a==="boolean"&&a)a=100;if(typeof a==="number"&&a>0){i.idx=setInterval(function(e){n.x-=.01;if(n.x>=1)n.x=0;r.scene.requestRender()},a)}var o=void 0;if(Freedo.defined(e.image)&&Freedo.defined(t.st)){var s=t.st[t.st.length-2];var l=Freedo.defaultValue(e.repeat,new Freedo.Cartesian2(1,1));var u=new Freedo.Cartesian2(s,1);Freedo.Cartesian2.multiplyComponents(l,u,u);o=new Freedo.MaterialAppearance({faceForward:false,material:new Freedo.Material({fabric:{type:"DiffuseMap",uniforms:{image:e.image,repeat:u,offset:n},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st+offset)).channels"}}})})}else{o=new Freedo.PerInstanceColorAppearance((0,d.default)({},t.appearanceOpt))}return o};P.triangulate=function(e,t,r){var i=e.length;var n=e[0].length;var a=[];var o=[];var s=[];var l=[];var u=e.reduce(function(t,e){e.map(function(e){return t.push(e)});return t},[]);if(n===1){u.map(function(e){return o.push(e.x,e.y,e.z)});return{positions:o,primitiveType:Freedo.PrimitiveType.LINE_STRIP,appearanceOpt:{flat:true}}}var d=function e(t){if(t.length%3!==0)throw"顶点必须为3的倍数！";var r=new Freedo.Cartesian3;for(var i=0;i<t.length;i+=3){var n=Freedo.Cartesian3.subtract(t[i+1],t[i],new Freedo.Cartesian3);var a=Freedo.Cartesian3.subtract(t[i+2],t[i+1],new Freedo.Cartesian3);var o=Freedo.Cartesian3.cross(a,n,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(o,o);Freedo.Cartesian3.add(r,o,r)}Freedo.Cartesian3.normalize(r,r);s.push(r.x,r.y,r.z)};function c(e,t){if(e>0)while(t<0){t+=e}if(e<0)while(t>0){t-=e}return t%e}u.map(function(e){return o.push(e.x,e.y,e.z)});var f=P.stCalculator(e[0],t,r);for(var h=0;h<i;h++){for(var p=0;p<n;p++){var v=h*n+p;var m=(h+1)*n+p;var _=h*n+c(n,p+1);var y=(h-1)*n+p;var g=h*n+c(n,p-1);l.push.apply(l,(0,w.default)(f(h,p)));if(h<i-1&&p<n-1){a.push(v,_,m)}if(h>0&&p>0)a.push(v,g,y);if(h==i-1&&p==0)d([u[v],u[_],u[y]]);else if(h==i-1&&p==n-1)d([u[v],u[y],u[g]]);else if(h==0&&p==0)d([u[v],u[m],u[_]]);else if(h==0&&p==n-1)d([u[v],u[g],u[m]]);else if(h==0)d([u[v],u[m],u[_],u[v],u[g],u[m]]);else if(h==i-1)d([u[v],u[_],u[y],u[v],u[y],u[g]]);else if(p==0)d([u[v],u[_],u[y],u[v],u[m],u[_]]);else if(p==n-1)d([u[v],u[g],u[m],u[v],u[y],u[g]]);else d([u[v],u[m],u[_],u[v],u[_],u[y],u[v],u[y],u[g],u[v],u[g],u[m]])}}return{positions:o,idx:a,normals:s,st:l,primitiveType:Freedo.PrimitiveType.TRIANGLES,appearanceOpt:{faceForward:false}}};P.stCalculator=function(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var o=void 0,s=[],l=void 0,u=[];i(e,s);o=s[s.length-1];i(t,u);l=o*r;function i(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var r=0,i=e.length;for(var n=0;n<i;n++){t.push(r);if(n>=i-1)break;r+=Freedo.Cartesian3.distance(e[n],e[n+1])}return t}return function(e,t){var r=u[e],i=s[t];var n=r/l,a=i/o;return[n,a]}};P.smoothByPolyline=function(r,i){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:720;var t=arguments[3];var n=r.length;if(i&&i.length<1)throw"特征点至少指定两个！";if(r&&r.length<2)throw"轨迹点至少指定两个！";var a=[i],o=[r[0]],s=[[r[0]]];if(r.length===2){var l=Freedo.Cartesian3.subtract(r[1],r[0],new Freedo.Cartesian3);var u=i.map(function(e){return Freedo.Cartesian3.add(e,l,new Freedo.Cartesian3)});a.push(u);o.push(r[n-1]);return{shapes:a,line:o}}for(var d=0;d<n-2;d++){var c=[r[d],r[d+1],r[d+2]];var f=P.smoothBrokenline(c,i,e,t);var h=f.shapes;o=o.concat(f.positions);s.push(f.positions);a=a.concat(h);var p=Freedo.Cartesian3.subtract(c[0],c[1],new Freedo.Cartesian3);var v=Freedo.Cartesian3.subtract(c[2],c[1],new Freedo.Cartesian3);var m=Freedo.Cartesian3.cross(v,p,new Freedo.Cartesian3);var _=Freedo.Cartesian3.angleBetween(p,v);i=P.drawShape(c[0],i,c[1],m,x-_);if(d===n-3){(function(){var t=Freedo.Cartesian3.subtract(r[d+2],r[d+1],new Freedo.Cartesian3);var e=i.map(function(e){return Freedo.Cartesian3.add(e,t,new Freedo.Cartesian3)});a.push(e);s.push([r[d+2]])})()}}o.push(r[n-1]);return{shapes:a,line:o,gline:s}};P.calcInner=function(e,n,a){var o=[];e.map(function(e){var t=Freedo.Cartesian3.subtract(e,n,new Freedo.Cartesian3);var r=new Freedo.Cartesian3;var i=Freedo.Cartesian3.magnitude(t);Freedo.Cartesian3.multiplyByScalar(t,(i-a)/i,t);Freedo.Cartesian3.add(n,t,r);o.push(r)});return o};P.smoothBrokenline=function(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:720;var i=arguments[3];var n=e[0],a=e[1],o=e[2];var s=Freedo.Cartesian3.subtract(n,a,new Freedo.Cartesian3);var l=Freedo.Cartesian3.subtract(o,a,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(s,s);Freedo.Cartesian3.normalize(l,l);var u=Freedo.Cartesian3.add(s,l,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(u,u);var d=Freedo.Cartesian3.angleBetween(s,u);var c=Freedo.defined(i)&&i>0?this.getMaxRdii(e[0],t)*i:P.getSoomth(e,d);var f=c/Math.tan(d);Freedo.Cartesian3.multiplyByScalar(s,f,s);var h=Freedo.Cartesian3.add(a,s,new Freedo.Cartesian3);var p=f/Math.cos(d);Freedo.Cartesian3.multiplyByScalar(u,p,u);var v=Freedo.Cartesian3.add(a,u,new Freedo.Cartesian3);var m=Freedo.Cartesian3.subtract(h,v,new Freedo.Cartesian3);var _=Freedo.Cartesian3.cross(l,s,new Freedo.Cartesian3);var y=2*x/r;r=parseInt((x-d*2)/y)+1;var g=[];var w=[];if(Math.abs(Math.PI/2-d)<1e-4){w.push(P.drawShape(n,t,a,_,Math.PI-d*2));g.push(a);return{shapes:w,positions:g}}for(var F=0;F<=r;F++){if(F!=0){if(y*F>x-d*2)P.rotateVector(_,m,(x-d*2)%y,m);else P.rotateVector(_,m,y,m)}var b=Freedo.Cartesian3.add(m,v,new Freedo.Cartesian3);var C=y*F>x-d*2?x-d*2:y*F;w.push(P.drawShape(n,t,b,_,C));g.push(b)}return{shapes:w,positions:g}};P.drawShape=function(e,t,r,i,n,a){var o=Freedo.Cartesian3.subtract(r,e,new Freedo.Cartesian3);var s=t.map(function(e){return Freedo.Cartesian3.add(o,e,new Freedo.Cartesian3)});if(Math.abs(n%x)>1e-6&&t.length>1){s.map(function(e){var t=Freedo.Cartesian3.subtract(e,r,new Freedo.Cartesian3);P.rotateVector(i,t,n,t);Freedo.Cartesian3.add(r,t,e)})}return s};P.rotateVector=function(e,t,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Freedo.Cartesian3;var n=Freedo.Quaternion.fromAxisAngle(e,r,new Freedo.Quaternion);var a=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,n,new Freedo.Cartesian3(1,1,1));Freedo.Matrix4.multiplyByPointAsVector(a,t,i);return i};P.getMaxRdii=function(e,t){var r=0;var i=true;var n=false;var a=undefined;try{for(var o=(0,m.default)(t),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=Freedo.Cartesian3.distance(e,l);r=u>r?u:r}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}return r===0?1:r};P.buildCirclePts=function(e,t,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:36;var n=new Freedo.Cartesian3(e.x-1,e.y,e.z);Freedo.Cartesian3.cross(r,n,n);Freedo.Cartesian3.normalize(n,n);Freedo.Cartesian3.multiplyByScalar(n,t,n);var a=[];var o=2*Math.PI/i;for(var s=0;s<i;s++){P.rotateVector(r,n,o,n);var l=Freedo.Cartesian3.add(e,n,new Freedo.Cartesian3);a.push(l)}return a};P.buildPentagramPts=function(e,t,r){var i=new Freedo.Cartesian3(e.x-1,e.y,e.z);var n=Freedo.Math.toRadians(36);var a=Freedo.Math.toRadians(18);var o=t/(1/Math.tan(n)+1/Math.tan(a));Freedo.Cartesian3.cross(r,i,i);Freedo.Cartesian3.normalize(i,i);var s=[];var l=2*Math.PI/10;for(var u=0;u<10;u++){var d=Freedo.Cartesian3.multiplyByScalar(i,u%2==0?t:o,new Freedo.Cartesian3);P.rotateVector(r,d,l*u,d);var c=Freedo.Cartesian3.add(e,d,new Freedo.Cartesian3);s.push(c)}return s};P.getSoomth=function(e,t){if(!t){var r=Freedo.Cartesian3.subtract(e[0],e[1],new Freedo.Cartesian3);var i=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);Freedo.Cartesian3.normalize(r,r);Freedo.Cartesian3.normalize(i,i);var n=Freedo.Cartesian3.add(r,i,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(n,n);t=Freedo.Cartesian3.angleBetween(r,n)}var a=Freedo.Cartesian3.distance(e[0],e[1]);var o=Freedo.Cartesian3.distance(e[2],e[1]);var s=a<o?a/3:o/3;return s*Math.tan(t)};P.showWireframe=function(e,t,r){var i=[],n=t.length,a=e[0].length;var o=new Freedo.PolylineCollection;o.add({positions:t,width:3,material:Freedo.Material.fromType("Color",{color:Freedo.Color.RED})});for(var s=0;s<a;s++){var l=[];i.push(l);for(var u=0;u<n;u++){l.push(e[u][s])}o.add({positions:l,width:3,material:Freedo.Material.fromType("Color",{color:Freedo.Color.WHITE})})}for(var d=0;d<n;d++){o.add({positions:e[d],width:3,loop:true,material:Freedo.Material.fromType("Color",{color:Freedo.Color.WHITE})})}if(r)r.scene.primitives.add(o);return o};function f(e){if(e&&e instanceof Array&&e.length>2)return true;throw"坐标参数错误"}t.FdLoft=P},function(e,t,r){e.exports={default:r(572),__esModule:true}},function(e,t,r){var i=r(58)("meta");var n=r(8);var a=r(25);var o=r(15).f;var s=0;var l=Object.isExtensible||function(){return true};var u=!r(7)(function(){return l(Object.preventExtensions({}))});var d=function(e){o(e,i,{value:{i:"O"+ ++s,w:{}}})};var c=function(e,t){if(!n(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!a(e,i)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[i].i};var f=function(e,t){if(!a(e,i)){if(!l(e))return true;if(!t)return false;d(e)}return e[i].w};var h=function(e){if(u&&p.NEED&&l(e)&&!a(e,i))d(e);return e};var p=e.exports={KEY:i,NEED:false,fastKey:c,getWeak:f,onFreeze:h}},function(e,t){e.exports=false},function(e,t,r){var i=r(11)("unscopables");var n=Array.prototype;if(n[i]==undefined)r(22)(n,i,{});e.exports=function(e){n[i][e]=true}},function(e,t,r){var a=r(91);e.exports=function(i,n,e){a(i);if(n===undefined)return i;switch(e){case 1:return function(e){return i.call(n,e)};case 2:return function(e,t){return i.call(n,e,t)};case 3:return function(e,t,r){return i.call(n,e,t,r)}}return function(){return i.apply(n,arguments)}}},function(e,t,r){var i=r(34);var n=r(92);e.exports=r(43)?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){e[t]=r;return e}},function(e,t,r){e.exports={default:r(529),__esModule:true}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdBezierCurveAlgorithm=undefined;var i=r(1);var a=n(i);function n(e){return e&&e.__esModule?e:{default:e}}var o=function e(t,r,i,n){(0,a.default)(this,e);this.mPointA=t.position;this.mPointB=r.position;this.mControlPointA=i.position;this.mControlPointB=n.position};o.prototype.coefficients=function(e,t,r,i,n){var a=1-e;r=a*a;i=e*e;n=i*e;t=r*a;r*=3*e;i*=3*a;return{a:t,b:r,c:i,d:n}};o.prototype.getPointAt=function(e,t,r,i){if(e<0)e=0;if(e>1)e=1;var n,a,o,s;var l=this.coefficients(e,n,a,o,s);t=l.a*this.mPointA.x+l.b*this.mControlPointA.x+l.c*this.mControlPointB.x+l.d*this.mPointB.x;r=l.a*this.mPointA.y+l.b*this.mControlPointA.y+l.c*this.mControlPointB.y+l.d*this.mPointB.y;i=l.a*this.mPointA.z+l.b*this.mControlPointA.z+l.c*this.mControlPointB.z+l.d*this.mPointB.z;return{x:t,y:r,z:i}};o.prototype.getVertexForCurve=function(e){var t=0;var r=0;switch(e){case 1:t=1;r=2;break;case 2:t=.5;r=3;break;case 3:t=.2;r=6;break;case 4:t=.1;r=11;break;case 5:t=.05;r=21;break;case 6:t=.02;r=51;break;case 7:t=.01;r=101;break;case 8:t=.005;r=201;break;case 9:t=.0025;r=401;break;case 10:t=.00125;r=801;break;case 11:t=625e-6;r=1601;break;default:t=.005;r=201;break}var i=[];var n=0;for(var a=0;a<r;++a){var o={};var s=0,l=0,u=0;var d=this.getPointAt(n,s,l,u);o.x=d.x;o.y=d.y;o.z=d.z;i.push(o);n+=t}return i};t.FdBezierCurveAlgorithm=o},function(e,t){e.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},function(e,t){var r=0;var i=Math.random();e.exports=function(e){return"Symbol(".concat(e===undefined?"":e,")_",(++r+i).toString(36))}},function(e,t,r){var i=r(182);var n=r(127);e.exports=Object.keys||function e(t){return i(t,n)}},function(e,t,r){var i=r(32);var n=Math.max;var a=Math.min;e.exports=function(e,t){e=i(e);return e<0?n(e+t,0):a(e,t)}},function(e,t,a){var n=a(4);var o=a(183);var s=a(127);var l=a(126)("IE_PROTO");var u=function(){};var d="prototype";var c=function(){var e=a(124)("iframe");var t=s.length;var r="<";var i=">";var n;e.style.display="none";a(128).appendChild(e);e.src="javascript:";n=e.contentWindow.document;n.open();n.write(r+"script"+i+"document.F=Object"+r+"/script"+i);n.close();c=n.F;while(t--)delete c[d][s[t]];return c()};e.exports=Object.create||function e(t,r){var i;if(t!==null){u[d]=n(t);i=new u;u[d]=null;i[l]=t}else i=c();return r===undefined?i:o(i,r)}},function(e,t,r){var i=r(182);var n=r(127).concat("length","prototype");t.f=Object.getOwnPropertyNames||function e(t){return i(t,n)}},function(e,t,r){"use strict";var i=r(6);var n=r(15);var a=r(14);var o=r(11)("species");e.exports=function(e){var t=i[e];if(a&&t&&!t[o])n.f(t,o,{configurable:true,get:function(){return this}})}},function(e,t){e.exports=function(e,t,r,i){if(!(e instanceof t)||i!==undefined&&i in e){throw TypeError(r+": incorrect invocation!")}return e}},function(e,t,r){var f=r(30);var h=r(195);var p=r(139);var v=r(4);var m=r(12);var _=r(141);var y={};var g={};var t=e.exports=function(e,t,r,i,n){var a=n?function(){return e}:_(e);var o=f(r,i,t?2:1);var s=0;var l,u,d,c;if(typeof a!="function")throw TypeError(e+" is not iterable!");if(p(a))for(l=m(e.length);l>s;s++){c=t?o(v(u=e[s])[0],u[1]):o(e[s]);if(c===y||c===g)return c}else for(d=a.call(e);!(u=d.next()).done;){c=h(d,o,u.value,t);if(c===y||c===g)return c}};t.BREAK=y;t.RETURN=g},function(e,t,r){var n=r(23);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var i=r(151);var n=r(152);e.exports=function(e){return i(n(e))}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return true}}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){"use strict";var i=r(485)(true);r(153)(String,"String",function(e){this._t=String(e);this._i=0},function(){var e=this._t;var t=this._i;var r;if(t>=e.length)return{value:undefined,done:true};r=i(e,t);this._i+=r.length;return{value:r,done:false}})},function(T,e,E){(function(e){
/*!
 * Knockout ES5 plugin - https://github.com/SteveSanderson/knockout-es5
 * Copyright (c) Steve Sanderson
 * MIT license
 */
(function(t,o){"use strict";var s;var n;function a(e,t){if(!e||typeof e!=="object"){throw new Error("When calling ko.track, you must pass an object as the first parameter.")}var r;if(f(t)){t.deep=t.deep||false;t.fields=t.fields||Object.getOwnPropertyNames(e);t.lazy=t.lazy||false;c(e,t.fields,t)}else{r=t||Object.getOwnPropertyNames(e);c(e,r,{})}return e}var r=/^function\s*([^\s(]+)/;function i(e){if(e.name){return e.name}return(e.toString().trim().match(r)||[])[1]}function l(e){return e&&typeof e==="object"&&i(e.constructor)==="Object"}function u(e,t,r){var i=s.isObservable(e);var n=!i&&Array.isArray(e);var a=i?e:n?s.observableArray(e):s.observable(e);r[t]=function(){return a};if(n||i&&"push"in a){_(s,a)}return{configurable:true,enumerable:true,get:a,set:s.isWriteableObservable(a)?a:o}}function d(e,t,r){if(s.isObservable(e)){return u(e,t,r)}var i;function n(e,t){if(i){return t?i(e):i}if(Array.isArray(e)){i=s.observableArray(e);_(s,i);return i}return i=s.observable(e)}r[t]=function(){return n(e)};return{configurable:true,enumerable:true,get:function(){return n(e)()},set:function(e){n(e,true)}}}function c(r,e,i){if(!e.length){return}var n=p(r,true);var a={};e.forEach(function(e){if(e in n){return}if(Object.getOwnPropertyDescriptor(r,e).configurable===false){return}var t=r[e];a[e]=(i.lazy?d:u)(t,e,n);if(i.deep&&l(t)){c(t,Object.keys(t),i)}});Object.defineProperties(r,a)}function f(e){return!!e&&typeof e==="object"&&e.constructor===Object}var h;function p(e,t){if(!h){h=n()}var r=h.get(e);if(!r&&t){r={};h.set(e,r)}return r}function v(e,t){if(!h){return}if(arguments.length===1){h["delete"](e)}else{var r=p(e,false);if(r){t.forEach(function(e){delete r[e]})}}}function m(e,t,r){var i=this,n={owner:e,deferEvaluation:true};if(typeof r==="function"){n.read=r}else{if("value"in r){throw new Error('For ko.defineProperty, you must not specify a "value" for the property. '+'You must provide a "get" function.')}if(typeof r.get!=="function"){throw new Error("For ko.defineProperty, the third parameter must be either an evaluator function, "+'or an options object containing a function called "get".')}n.read=r.get;n.write=r.set}e[t]=i.computed(n);a.call(i,e,[t]);return e}function _(t,r){var i=null;t.computed(function(){if(i){i.dispose();i=null}var e=r();if(e instanceof Array){i=y(t,r,e)}})}function y(e,t,r){var i=w(e,r);return i.subscribe(t)}var g;function w(e,t){if(!g){g=n()}var r=g.get(t);if(!r){r=new e.subscribable;g.set(t,r);var i={};F(t,r,i);b(e,t,r,i)}return r}function F(r,i,n){["pop","push","reverse","shift","sort","splice","unshift"].forEach(function(e){var t=r[e];r[e]=function(){var e=t.apply(this,arguments);if(n.pause!==true){i.notifySubscribers(this)}return e}})}function b(r,i,n,a){["remove","removeAll","destroy","destroyAll","replace"].forEach(function(t){Object.defineProperty(i,t,{enumerable:false,value:function(){var e;a.pause=true;try{e=r.observableArray.fn[t].apply(r.observableArray(i),arguments)}finally{a.pause=false}n.notifySubscribers(i);return e}})})}function C(e,t){if(!e||typeof e!=="object"){return null}var r=p(e,false);if(r&&t in r){return r[t]()}return null}function x(e,t){if(!e||typeof e!=="object"){return false}var r=p(e,false);return!!r&&t in r}function P(e,t){var r=C(e,t);if(r){r.valueHasMutated()}}function M(e){e.track=a;e.untrack=v;e.getObservable=C;e.valueHasMutated=P;e.defineProperty=m;e.es5={getAllObservablesForObject:p,notifyWhenPresentOrFutureArrayValuesMutate:_,isTracked:x}}function e(){if(true){s=E(663);var e=t.WeakMap||E(664);M(s);n=function(){return new e};T.exports=s}else{}}e()})(typeof window!=="undefined"?window:typeof e!=="undefined"?e:this)}).call(this,E(73))},function(e,t,r){e.exports={default:r(671),__esModule:true}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){if(typeof window==="object")r=window}e.exports=r},function(e,t,r){var i=r(15).f;var n=r(25);var a=r(11)("toStringTag");e.exports=function(e,t,r){if(e&&!n(e=r?e:e.prototype,a))i(e,a,{configurable:true,value:t})}},function(e,t,r){var n=r(31);var a=r(11)("toStringTag");var o=n(function(){return arguments}())=="Arguments";var s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,r,i;return e===undefined?"Undefined":e===null?"Null":typeof(r=s(t=Object(e),a))=="string"?r:o?n(t):(i=n(t))=="Object"&&typeof t.callee=="function"?"Arguments":i}},function(e,t,r){var o=r(0);var i=r(39);var s=r(7);var l=r(130);var n="["+l+"]";var u="​";var a=RegExp("^"+n+n+"*");var d=RegExp(n+n+"*$");var c=function(e,t,r){var i={};var n=s(function(){return!!l[e]()||u[e]()!=u});var a=i[e]=n?t(f):l[e];if(r)i[r]=a;o(o.P+o.F*n,"String",i)};var f=c.trim=function(e,t){e=String(i(e));if(t&1)e=e.replace(a,"");if(t&2)e=e.replace(d,"");return e};e.exports=c},function(e,t){e.exports={}},function(e,t,r){var i=r(8);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,r){r(478);var i=r(20);var n=r(54);var a=r(80);var o=r(21)("toStringTag");var s=("CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,"+"DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,"+"MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,"+"SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,"+"TextTrackList,TouchList").split(",");for(var l=0;l<s.length;l++){var u=s[l];var d=i[u];var c=d&&d.prototype;if(c&&!c[o])n(c,o,u);a[u]=a.Array}},function(e,t){e.exports={}},function(e,t,r){var i=r(219);var n=r(159);e.exports=Object.keys||function e(t){return i(t,n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdKeyboard=undefined;var i=r(3);var l=o(i);var n=r(1);var a=o(n);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t,r){(0,a.default)(this,e);this._viewer=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._divID=this._viewer._container.id;this._bActive=false;this._bRun=false;this._windowTimer=null;this._metaData=[];if(r>1)this._eventTime=r;else this._eventTime=30};s.prototype.enable=function(){this._bActive=true;this.setFocus();this.addEventLsnr();this._event.raiseEvent("StatusChanged",{status:this._bActive})};s.prototype.disable=function(){this._bActive=false;this._event.raiseEvent("StatusChanged",{status:this._bActive})};s.prototype.getStatus=function(){return this._bActive};s.prototype.setStatus=function(e){this._bActive=e};s.prototype.setFocus=function(){var e=document.getElementById(this._divID);if(Freedo.defined(e)){e.setAttribute("tabindex",1);e.focus()}};s.prototype.prevent=function(e){var t=e.keyCode||e.which;if(t==38||t==40||t==37||t==39||t==87||t==65||t==83||t==68){e.stopPropagation();e.preventDefault()}};s.prototype.onKeyDown=function(e){if(!this._bActive)return;e=window.event||e;var t=e.keyCode||e.which;this._metaData[e.keyCode]=true;this._event.raiseEvent("KeyPress",{metaData:Freedo.clone(this._metaData,true)});this.startTimer();this.prevent(e)};s.prototype.onKeyUp=function(e){if(!this._bActive)return;this._event.raiseEvent("timer",{metaData:this._metaData});this._event.raiseEvent("keyUp",{keyCode:e.keyCode});e=window.event||e;var t=e.keyCode||e.which;this._metaData[e.keyCode]=false;this.stopTimer();this.prevent(e)};s.prototype.startTimer=function(e){var t=this;if(this._windowTimer==null){this._windowTimer=window.setInterval(function(){t._event.raiseEvent("timer",{metaData:t._metaData});t._event.raiseEvent("KeyPressed",{metaData:t._metaData})},this._eventTime)}};s.prototype.stopTimer=function(e){if(this._windowTimer!=null){var t=true;var r=true;var i=false;var n=undefined;try{for(var a=(0,l.default)(this._metaData),o;!(r=(o=a.next()).done);r=true){var s=o.value;if(s){t=false;break}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}if(t){window.clearInterval(this._windowTimer);this._windowTimer=null}}};s.prototype.addEventLsnr=function(){var t=this;if(!this._bRun){this._bRun=true;var r=this._viewer.canvas;r.addEventListener("click",function(e){if(e.target===r){this.setAttribute("tabindex",1);this.focus()}});r.onkeydown=function(e){if(e.target===r){t.onKeyDown(e)}};r.onkeyup=function(e){if(e.target===r){t.onKeyUp(e)}}}};s.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};s.prototype.reset=function(){this._bActive=false};s.prototype.dispose=function(){this.reset()};t.FdKeyboard=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMath=undefined;var i=r(96);var y=o(i);var n=r(1);var a=o(n);function o(e){return e&&e.__esModule?e:{default:e}}var c=function e(){(0,a.default)(this,e)};var s=20037508.342789;c.isNumber=function(e){return typeof e==="number"&&isFinite(e)};c.round=function(e,t){if(e>=0){var r=parseInt(e*Math.pow(10,t)+.5)/Math.pow(10,t);return r}else{var i=-e;var r=parseInt(i*Math.pow(10,t)+.5)/Math.pow(10,t);return-r}};c.calcVVQuat=function(e,t){var r=Freedo.Cartesian3.angleBetween(e,t);var i=Freedo.Cartesian3.cross(e,t,new Freedo.Cartesian3);var n=Freedo.Quaternion.fromAxisAngle(i,r);return n};c.calcHeadUpV=function(e){var t=Freedo.FdMisc.FdGeometric.tg(e);t[2]+=1;t=Freedo.FdMisc.FdGeometric.tc(t);return Freedo.Cartesian3.subtract(e,t,new Freedo.Cartesian3)};c.calcModelAlignVectorM4=function(e,t){var r=Freedo.Cartesian3.subtract(t,e,new Freedo.Cartesian3);var i=Freedo.Cartesian3.normalize(r,r);var n=Freedo.Cartesian3.normalize(e,new Freedo.Cartesian3);var a=Freedo.Cartesian3.normalize(t,new Freedo.Cartesian3);var o=Freedo.Cartesian3.cross(n,a,new Freedo.Cartesian3);var s=Freedo.Cartesian3.normalize(o,o);var l=Freedo.Cartesian3.cross(i,s,new Freedo.Cartesian3);var u=Freedo.Cartesian3.normalize(l,l);var d=new Freedo.Matrix4(i.x,i.y,i.z,0,s.x,s.y,s.z,0,u.x,u.y,u.z,0,e.x,e.y,e.z,1);return Freedo.Matrix4.transpose(d,d)};c.addDelta2Height=function(e,t){var r=[];t=Freedo.defaultValue(t,.02);for(var i=0;i<e.length;i++){var n=Freedo.FdMisc.FdGeometric.tg(e[i]);n[2]+=t;r.push(n)}var a=[];for(var i=0;i<r.length;i++){var o=Freedo.FdMisc.FdGeometric.tc(r[i]);a.push(o)}return a};c.addOffset=function(e,t){return c.addDelta2Height(e,t)};c.getPositionFromString=function(e){var t=e.split(",");var r=[];r=t.map(function(e){return+e});return r};c.LongLat2Mercator=function(e,t){var r=e;var i=t;if(i>85.0511287798066)i=85.0511287798066;if(i<-85.0511287798066)i=-85.0511287798066;e=r*s/180;t=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);t=t*s/180;return{x:e,y:t}};c.Mercator2LongLat=function(e,t){var r=e/s*180;var i=t/s*180;i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[r,i]};var f=new Freedo.WebMercatorTilingScheme;var h=new Freedo.GeographicTilingScheme;var p=new Freedo.Rectangle;c.tile2rect=function(e,t,r,i,n){var a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var o,s,l,u;var d=a?f:h;d.tileXYToRectangle(a?e:r,a?r:e,n,p);o=p.west;s=p.south;l=p.east;u=p.north;d.tileXYToRectangle(a?t:i,a?i:t,n,p);o=Math.min(o,p.west);s=Math.min(s,p.south);l=Math.max(l,p.east);u=Math.max(u,p.north);return[o*Freedo.Math.DEGREES_PER_RADIAN,s*Freedo.Math.DEGREES_PER_RADIAN,l*Freedo.Math.DEGREES_PER_RADIAN,u*Freedo.Math.DEGREES_PER_RADIAN]};c.getBoundingSphereFromBoundsMinMax=function(e,t,r,i){e=c.getPositionFromString(e);t=c.getPositionFromString(t);r=c.getPositionFromString(r);var n=r[0];r[0]=r[1];r[1]=n;var a=new Freedo.Cartesian3(e[0],e[1],e[2]);var o=new Freedo.Cartesian3(t[0],t[1],t[2]);var s=new Freedo.Cartesian3.fromDegrees(r[0],r[1],r[2]);var l=o.y;o.y=-o.z;o.z=l;l=a.y;a.y=-a.z;a.z=l;if(s.x>6378100&&s.y<.1&&s.z<.1){}else{var u=Freedo.Transforms.eastNorthUpToFixedFrame(s);Freedo.Matrix4.multiplyByPoint(u,o,o);Freedo.Matrix4.multiplyByPoint(u,a,a)}if(i){Freedo.Matrix4.multiplyByPoint(i,o,o);Freedo.Matrix4.multiplyByPoint(i,a,a)}var d=Freedo.BoundingSphere.fromCornerPoints(o,a);return d};c.getBoundingBoxVertexFromBoundsMinMax=function(e,t,r,i){e=Freedo.FdMisc.FdMath.getPositionFromString(e);t=Freedo.FdMisc.FdMath.getPositionFromString(t);var n=new Freedo.Cartesian3(e[0],-e[2],e[1]);var a=new Freedo.Cartesian3(t[0],-t[2],t[1]);var o=a;var s=new Freedo.Cartesian3(a.x,a.y,n.z);var l=new Freedo.Cartesian3(n.x,a.y,n.z);var u=new Freedo.Cartesian3(n.x,a.y,a.z);var d=n;var c=new Freedo.Cartesian3(n.x,n.y,a.z);var f=new Freedo.Cartesian3(a.x,n.y,a.z);var h=new Freedo.Cartesian3(a.x,n.y,n.z);if(i){Freedo.Matrix4.multiplyByPoint(i,o,o);Freedo.Matrix4.multiplyByPoint(i,s,s);Freedo.Matrix4.multiplyByPoint(i,l,l);Freedo.Matrix4.multiplyByPoint(i,u,u);Freedo.Matrix4.multiplyByPoint(i,d,d);Freedo.Matrix4.multiplyByPoint(i,c,c);Freedo.Matrix4.multiplyByPoint(i,f,f);Freedo.Matrix4.multiplyByPoint(i,h,h)}else{r=Freedo.FdMisc.FdMath.getPositionFromString(r);var p;if(r.x>6378100&&r.y<.1&&r.z<.1){p=Freedo.Matrix4.fromTranslation(r)}else{var v=new Freedo.Cartesian3.fromDegrees(r[1],r[0],r[2]);p=Freedo.Transforms.eastNorthUpToFixedFrame(v)}Freedo.Matrix4.multiplyByPoint(p,o,o);Freedo.Matrix4.multiplyByPoint(p,s,s);Freedo.Matrix4.multiplyByPoint(p,l,l);Freedo.Matrix4.multiplyByPoint(p,u,u);Freedo.Matrix4.multiplyByPoint(p,d,d);Freedo.Matrix4.multiplyByPoint(p,c,c);Freedo.Matrix4.multiplyByPoint(p,f,f);Freedo.Matrix4.multiplyByPoint(p,h,h)}return[o,s,l,u,d,c,f,h]};c.computeScreenSpacePosition=function(e,t,r){var i=new Freedo.Cartesian4;var n=t;if(Freedo.defined(r)){var a=Cartesian4.fromElements(t.x,t.y,t.z,1,i);n=Matrix4.multiplyByVector(r,a,i)}var o=Freedo.SceneTransforms.wgs84ToWindowCoordinates(e,n,new Freedo.Cartesian2);return o};c.washPts=function(e){var t=[];for(var r=0;r<e.length;r++){var i=Freedo.clone(e[r],true);if(t.length>0){var n=Freedo.Cartesian3.distance(t[t.length-1],i);if(n>1e-4)t.push(i)}else t.push(i)}return t};c.isBackOfEarth=function(e,t){var r=Freedo.FdMisc.FdGeometric.calcAngle(new Freedo.Cartesian3,Freedo.FdMisc.FdGeometric.tc(t),e.position);r*=180/3.14;if(r<90)return true;else return false};c.isInCameraView=function(e,t){var r;var i=e.frustum.computeCullingVolume(e.position,e.direction,e.up);var n=(r=Freedo.Cartesian3).fromDegrees.apply(r,(0,y.default)(t));var a=new Freedo.BoundingSphere(n,.01);var o=i.computeVisibility(a);return o};c.getDistanceOfCamera=function(e,t){var r;var i=(r=Freedo.Cartesian3).fromDegrees.apply(r,(0,y.default)(t));var n=Freedo.Cartesian3.negate(e.direction,new Freedo.Cartesian3);var a=Freedo.Plane.fromPointNormal(i,n);var o=Freedo.Plane.getPointDistance(a,e.position);return o};c.getScreenPos=function(e,t){var r;var i=(r=Freedo.Cartesian3).fromDegrees.apply(r,(0,y.default)(t));return Freedo.SceneTransforms.wgs84ToWindowCoordinates(e,i)};c.getViewPosInfo=function(e,t){var r,i;if(e.length>3)e.pop();if(t.length>3)t.pop();var n=(r=Freedo.Cartesian3).fromDegrees.apply(r,(0,y.default)(e));var a=(i=Freedo.Cartesian3).fromDegrees.apply(i,(0,y.default)(t));var o=Freedo.Cartesian3.fromDegrees(t[0],t[1],e[2]);var s=Math.PI/180;var l=Math.cos(t[1]*s);var u=Math.sin((e[0]-t[0])*s)*l;var d=Math.cos(e[1]*s)*Math.sin(t[1]*s);var c=Math.sin(e[1]*s)*l;var f=Math.cos((e[0]-t[0])*s);var h=Math.atan2(u,d-c*f);h=Freedo.Math.toDegrees(h);if(h<0){h=h+Math.PI*2}h=Math.PI*2-h;var p=Freedo.FdMisc.FdGeometric.calcAngle(o,n,a);p=Freedo.Math.toDegrees(p);if(n.equals(o)){if(e[2]<t[2]){p=90}else{p=-90}}else if(e[2]>t[2]){p*=-1}var v=Freedo.Cartesian3.normalize(n,new Freedo.Cartesian3);var m=Freedo.Cartesian3.subtract(a,n,new Freedo.Cartesian3);m=Freedo.Cartesian3.normalize(m,new Freedo.Cartesian3);var _=Freedo.Cartesian3.cross(v,m,new Freedo.Cartesian3);return{heading:h,pitch:p,v:v,vt:m,vvt:_}};c.isPosInPoly=function(e,t){var r=void 0,i=void 0,n=void 0,a=0,o=0,s=0,l=0,u=void 0,d=e[0],c=e[1];if(t.length<3){return false}r=0;i=t.length;for(n=0;n<i;n++){if(n==i-1){a=t[n][0];s=t[n][1];o=t[0][0];l=t[0][1]}else{a=t[n][0];s=t[n][1];o=t[n+1][0];l=t[n+1][1]}if(c>=s&&c<l||c>=l&&c<s){if(Math.abs(s-l)>0){u=a-(a-o)*(s-c)/(s-l);if(u<d){r++}}}}if(r%2!=0){return true}return false};c.isPosInPolyByWC=function(e,t){var r=Freedo.FdMisc.FdGeometric.tg(e);var i=[];for(var n=0;n<t.length;n++){var a=Freedo.FdMisc.FdGeometric.tg(t[n]);i.push(a)}return this.isPosInPoly(r,i)};c.senseOfRotationByPos=function(e,t,r){var i=(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1]);if(i>0){i=1}else if(i<0){i=-1}else{i=0}return i};c.boxInSphere=function(e,t,r){t[1]=Freedo.defaultValue(t[1],t[0]);r=Freedo.defaultValue(r,0);var i=e.center;var n=e.radius;var a=t[0];var o=t[1];var s=Freedo.Cartesian3.distance(i,a);var l=Freedo.Cartesian3.distance(i,o);if(s+r<n&&l+r<n)return 1;else if(s<=n+r&&l>=n+r)return 0;else if(l<=n+r&&s>=n+r)return 0;else if(s>n+r&&l>n+r)return-1};t.FdMath=c},function(e,t,r){e.exports={default:r(580),__esModule:true}},function(e,t,r){var i=r(31);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return i(e)=="String"?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){"use strict";var i=r(4);e.exports=function(){var e=i(this);var t="";if(e.global)t+="g";if(e.ignoreCase)t+="i";if(e.multiline)t+="m";if(e.unicode)t+="u";if(e.sticky)t+="y";return t}},function(e,t,r){var n=r(4);var a=r(19);var o=r(11)("species");e.exports=function(e,t){var r=n(e).constructor;var i;return r===undefined||(i=n(r)[o])==undefined?t:a(i)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){e.exports=true},function(e,t){e.exports=function(e){if(typeof e!="function")throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},function(e,t,r){var i=r(34).f;var n=r(69);var a=r(21)("toStringTag");e.exports=function(e,t,r){if(e&&!n(e=r?e:e.prototype,a))i(e,a,{configurable:true,value:t})}},function(e,t,r){var i=r(152);e.exports=function(e){return Object(i(e))}},function(e,t,r){var f=r(53);var h=r(223);var p=r(224);var v=r(47);var m=r(114);var _=r(160);var y={};var g={};var t=e.exports=function(e,t,r,i,n){var a=n?function(){return e}:_(e);var o=f(r,i,t?2:1);var s=0;var l,u,d,c;if(typeof a!="function")throw TypeError(e+" is not iterable!");if(p(a))for(l=m(e.length);l>s;s++){c=t?o(v(u=e[s])[0],u[1]):o(e[s]);if(c===y||c===g)return c}else for(d=a.call(e);!(u=d.next()).done;){c=h(d,o,u.value,t);if(c===y||c===g)return c}};t.BREAK=y;t.RETURN=g},function(e,t,r){"use strict";t.__esModule=true;var i=r(232);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++){r[t]=e[t]}return r}else{return(0,n.default)(e)}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,r){var i=r(29);var n=r(6);var a="__core-js_shared__";var o=n[a]||(n[a]={});(e.exports=function(e,t){return o[e]||(o[e]=t!==undefined?t:{})})("versions",[]).push({version:i.version,mode:r(51)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var l=r(26);var u=r(12);var d=r(60);e.exports=function(s){return function(e,t,r){var i=l(e);var n=u(i.length);var a=d(r,n);var o;if(s&&t!=t)while(n>a){o=i[a++];if(o!=o)return true}else for(;n>a;a++)if(s||a in i){if(i[a]===t)return s||a||0}return!s&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var i=r(31);e.exports=Array.isArray||function e(t){return i(t)=="Array"}},function(e,t,r){var l=r(32);var u=r(39);e.exports=function(s){return function(e,t){var r=String(u(e));var i=l(t);var n=r.length;var a,o;if(i<0||i>=n)return s?"":undefined;a=r.charCodeAt(i);return a<55296||a>56319||i+1===n||(o=r.charCodeAt(i+1))<56320||o>57343?s?r.charAt(i):a:s?r.slice(i,i+2):(a-55296<<10)+(o-56320)+65536}}},function(e,t,r){var i=r(8);var n=r(31);var a=r(11)("match");e.exports=function(e){var t;return i(e)&&((t=e[a])!==undefined?!!t:n(e)=="RegExp")}},function(e,t,r){var a=r(11)("iterator");var o=false;try{var i=[7][a]();i["return"]=function(){o=true};Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return false;var r=false;try{var i=[7];var n=i[a]();n.next=function(){return{done:r=true}};i[a]=function(){return n};e(i)}catch(e){}return r}},function(e,t,r){"use strict";var n=r(75);var a=RegExp.prototype.exec;e.exports=function(e,t){var r=e.exec;if(typeof r==="function"){var i=r.call(e,t);if(typeof i!=="object"){throw new TypeError("RegExp exec method returned something other than an Object or null")}return i}if(n(e)!=="RegExp"){throw new TypeError("RegExp#exec called on incompatible receiver")}return a.call(e,t)}},function(e,t,r){"use strict";r(199);var d=r(23);var c=r(22);var f=r(7);var h=r(39);var p=r(11);var v=r(145);var m=p("species");var _=!f(function(){var e=/./;e.exec=function(){var e=[];e.groups={a:"7"};return e};return"".replace(e,"$<a>")!=="7"});var y=function(){var e=/(?:)/;var t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return r.length===2&&r[0]==="a"&&r[1]==="b"}();e.exports=function(r,e,t){var i=p(r);var o=!f(function(){var e={};e[i]=function(){return 7};return""[r](e)!=7});var n=o?!f(function(){var e=false;var t=/a/;t.exec=function(){e=true;return null};if(r==="split"){t.constructor={};t.constructor[m]=function(){return t}}t[i]("");return!e}):undefined;if(!o||!n||r==="replace"&&!_||r==="split"&&!y){var s=/./[i];var a=t(h,i,""[r],function e(t,r,i,n,a){if(r.exec===v){if(o&&!a){return{done:true,value:s.call(r,i,n)}}return{done:true,value:t.call(i,r,n)}}return{done:false}});var l=a[0];var u=a[1];d(String.prototype,r,l);c(RegExp.prototype,i,e==2?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)})}}},function(e,t,r){var i=r(6);var n=i.navigator;e.exports=n&&n.userAgent||""},function(e,t,r){"use strict";var _=r(6);var y=r(0);var g=r(23);var w=r(66);var F=r(50);var b=r(65);var C=r(64);var x=r(8);var P=r(7);var M=r(104);var T=r(74);var E=r(131);e.exports=function(i,e,t,r,n,a){var o=_[i];var s=o;var l=n?"set":"add";var u=s&&s.prototype;var d={};var c=function(e){var i=u[e];g(u,e,e=="delete"?function(e){return a&&!x(e)?false:i.call(this,e===0?0:e)}:e=="has"?function e(t){return a&&!x(t)?false:i.call(this,t===0?0:t)}:e=="get"?function e(t){return a&&!x(t)?undefined:i.call(this,t===0?0:t)}:e=="add"?function e(t){i.call(this,t===0?0:t);return this}:function e(t,r){i.call(this,t===0?0:t,r);return this})};if(typeof s!="function"||!(a||u.forEach&&!P(function(){(new s).entries().next()}))){s=r.getConstructor(e,i,n,l);w(s.prototype,t);F.NEED=true}else{var f=new s;var h=f[l](a?{}:-0,1)!=f;var p=P(function(){f.has(1)});var v=M(function(e){new s(e)});var m=!a&&P(function(){var e=new s;var t=5;while(t--)e[l](t,t);return!e.has(-0)});if(!v){s=e(function(e,t){C(e,s,i);var r=E(new o,e,s);if(t!=undefined)b(t,n,r[l],r);return r});s.prototype=u;u.constructor=s}if(p||m){c("delete");c("has");n&&c("get")}if(m||h)c(l);if(a&&u.clear)delete u.clear}T(s,i);d[i]=s;y(y.G+y.W+y.F*(s!=o),d);if(!a)r.setStrong(s,i,n);return s}},function(e,t,r){var i=r(6);var n=r(22);var a=r(58);var o=a("typed_array");var s=a("view");var l=!!(i.ArrayBuffer&&i.DataView);var u=l;var d=0;var c=9;var f;var h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");while(d<c){if(f=i[h[d++]]){n(f.prototype,o,true);n(f.prototype,s,true)}else u=false}e.exports={ABV:l,CONSTR:u,TYPED:o,VIEW:s}},function(e,t,r){"use strict";e.exports=r(51)||!r(7)(function(){var e=Math.random();__defineSetter__.call(null,e,function(){});delete r(6)[e]})},function(e,t,r){"use strict";var i=r(0);e.exports=function(e){i(i.S,e,{of:function e(){var t=arguments.length;var r=new Array(t);while(t--)r[t]=arguments[t];return new this(r)}})}},function(e,t,r){"use strict";var i=r(0);var s=r(19);var l=r(30);var u=r(65);e.exports=function(e){i(i.S,e,{from:function e(t){var r=arguments[1];var i,n,a,o;s(this);i=r!==undefined;if(i)s(r);if(t==undefined)return new this;n=[];if(i){a=0;o=l(r,arguments[2],2);u(t,false,function(e){n.push(o(e,a++))})}else{u(t,false,n.push,n)}return new this(n)}})}},function(e,t,a){var n=a(47);var o=a(481);var s=a(159);var l=a(157)("IE_PROTO");var u=function(){};var d="prototype";var c=function(){var e=a(154)("iframe");var t=s.length;var r="<";var i=">";var n;e.style.display="none";a(220).appendChild(e);e.src="javascript:";n=e.contentWindow.document;n.open();n.write(r+"script"+i+"document.F=Object"+r+"/script"+i);n.close();c=n.F;while(t--)delete c[d][s[t]];return c()};e.exports=Object.create||function e(t,r){var i;if(t!==null){u[d]=n(t);i=new u;u[d]=null;i[l]=t}else i=c();return r===undefined?i:o(i,r)}},function(e,t,r){var i=r(156);var n=Math.min;e.exports=function(e){return e>0?n(i(e),9007199254740991):0}},function(e,t){var r=0;var i=Math.random();e.exports=function(e){return"Symbol(".concat(e===undefined?"":e,")_",(++r+i).toString(36))}},function(e,t,r){var n=r(89);var a=r(21)("toStringTag");var o=n(function(){return arguments}())=="Arguments";var s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,r,i;return e===undefined?"Undefined":e===null?"Null":typeof(r=s(t=Object(e),a))=="string"?r:o?n(t):(i=n(t))=="Object"&&typeof t.callee=="function"?"Arguments":i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i;function n(){if(typeof i==="undefined"){var e=document.getElementsByTagName("script");for(var t=0;t<e.length;t++){var r=e[t].getAttribute("src");if(Freedo.defined(r)&&r.indexOf("FreedoX.js")!==-1){i=r.substr(0,r.indexOf("FreedoX.js"))}}}return i}t.getFreedoXPath=n},function(e,t,r){e.exports={default:r(488),__esModule:true}},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdChangeablePrimitive=undefined;var i=r(121);var n=u(i);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function t(e){(0,o.default)(this,t);this.show=Freedo.defaultValue(e.show,true);this.asynchronous=Freedo.defaultValue(e.asynchronous,false);this.initialiseOptions(e);this._oldPrimitives=[]}(0,l.default)(t,[{key:"initialiseOptions",value:function e(t){c(this,t);this._ellipsoid=undefined;this._granularity=undefined;this._height=undefined;this._textureRotationAngle=undefined;this._id=undefined;this._createPrimitive=true;this._primitive=undefined;this._outlinePolygon=undefined}},{key:"setAttribute",value:function e(t,r){this[t]=r;this._createPrimitive=true}},{key:"getAttribute",value:function e(t){return this[t]}},{key:"update",value:function e(t){if(!Freedo.defined(this.appearance)){throw new Freedo.DeveloperError("this.appearance must be defined.")}if(!this.show){return}if(!this._createPrimitive&&!Freedo.defined(this._primitive)){return}if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var r=this.geometryInstances;if(!r){return}this._createPrimitive=false;this._ellipsoid=this.ellipsoid;this._granularity=this.granularity;this._height=this.height;this._textureRotationAngle=this.textureRotationAngle;this._id=this.id;var i=this.isGround?Freedo.GroundPrimitive:Freedo.Primitive;var n=new i({geometryInstances:r,appearance:this.appearance,depthFailAppearance:this.depthFailAppearance,asynchronous:this.asynchronous,modelMatrix:this.modelMatrix});n._scene=this._scene;if(Freedo.defined(this._primitive)){this._nextPrimitive=n;var a=this;n.readyPromise.then(function(e){if(e===a._nextPrimitive){a._nextPrimitive=undefined;if(e!==a._primitive){var t=a._primitive;a._primitive=e;if(Freedo.defined(t)){setTimeout(function(){t.destroy()},1e4)}}}else{e.destroy()}}).otherwise(function(e){console.log(e)})}else{this._primitive=n}}if(Freedo.defined(this._primitive)){this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(t)}if(Freedo.defined(this._nextPrimitive)&&this._nextPrimitive!==this._primitive){this._nextPrimitive.update(t)}this._outlinePolygon&&this._outlinePolygon.update(context,t,commandList)}},{key:"isDestroyed",value:function e(){return false}},{key:"destroy",value:function e(){if(Freedo.defined(this._scene)){this._scene._destroyingObjects.push(this);this._scene=undefined}else{this.destroyImpl()}}},{key:"destroyImpl",value:function e(){if(Freedo.defined(this._primitive)){this._primitive.destroy()}this._primitive=undefined;this._nextPrimitive=undefined}},{key:"setStrokeStyle",value:function e(t,r){if(!this.strokeColor||!this.strokeColor.equals(t)||this.strokeWidth!=r){this._createPrimitive=true;this.strokeColor=t;this.strokeWidth=r}}},{key:"asynchronous",get:function e(){return this._asynchronous},set:function e(t){if(!Freedo.defined(this._primitive)){this._asynchronous=t}}}]);return t}();function c(e,t){e=e||{};var r;for(r in t){if(e[r]===undefined){e[r]=f(t[r])}}}function f(e,t){if(e==null||(typeof e==="undefined"?"undefined":(0,n.default)(e))!="object")return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var r in e){t[r]=typeof t[r]=="undefined"?f(e[r],null):t[r]}return t}t.FdChangeablePrimitive=d},function(e,t,r){"use strict";t.__esModule=true;var i=r(535);var n=l(i);var a=r(537);var o=l(a);var s=typeof o.default==="function"&&typeof n.default==="symbol"?function(e){return typeof e}:function(e){return e&&typeof o.default==="function"&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};function l(e){return e&&e.__esModule?e:{default:e}}t.default=typeof o.default==="function"&&s(n.default)==="symbol"?function(e){return typeof e==="undefined"?"undefined":s(e)}:function(e){return e&&typeof o.default==="function"&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e==="undefined"?"undefined":s(e)}},function(e,t,r){"use strict";var u=r(9).isSpace;var d=r(9).unescapeAll;e.exports=function e(t,r,i){var n,a,o=0,s=r,l={ok:false,pos:0,lines:0,str:""};if(t.charCodeAt(r)===60){r++;while(r<i){n=t.charCodeAt(r);if(n===10||u(n)){return l}if(n===62){l.pos=r+1;l.str=d(t.slice(s+1,r));l.ok=true;return l}if(n===92&&r+1<i){r+=2;continue}r++}return l}a=0;while(r<i){n=t.charCodeAt(r);if(n===32){break}if(n<32||n===127){break}if(n===92&&r+1<i){r+=2;continue}if(n===40){a++;if(a>1){break}}if(n===41){a--;if(a<0){break}}r++}if(s===r){return l}l.str=d(t.slice(s,r));l.lines=o;l.pos=r;l.ok=true;return l}},function(e,t,r){"use strict";var u=r(9).unescapeAll;e.exports=function e(t,r,i){var n,a,o=0,s=r,l={ok:false,pos:0,lines:0,str:""};if(r>=i){return l}a=t.charCodeAt(r);if(a!==34&&a!==39&&a!==40){return l}r++;if(a===40){a=41}while(r<i){n=t.charCodeAt(r);if(n===a){l.pos=r+1;l.lines=o;l.str=u(t.slice(s+1,r));l.ok=true;return l}else if(n===10){o++}else if(n===92&&r+1<i){r++;if(t.charCodeAt(r)===10){o++}}r++}return l}},function(e,t,r){var i=r(8);var n=r(6).document;var a=i(n)&&i(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},function(e,t,r){var i=r(6);var n=r(29);var a=r(51);var o=r(181);var s=r(15).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=a?{}:i.Symbol||{});if(e.charAt(0)!="_"&&!(e in t))s(t,e,{value:o.f(e)})}},function(e,t,r){var i=r(98)("keys");var n=r(58);e.exports=function(e){return i[e]||(i[e]=n(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var i=r(6).document;e.exports=i&&i.documentElement},function(e,t,r){var i=r(8);var n=r(4);var a=function(e,t){n(e);if(!i(t)&&t!==null)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,i,n){try{n=r(30)(Function.call,r(27).f(Object.prototype,"__proto__").set,2);n(e,[]);i=!(e instanceof Array)}catch(e){i=true}return function e(t,r){a(t,r);if(i)t.__proto__=r;else n(t,r);return t}}({},false):undefined),check:a}},function(e,t){e.exports="\t\n\v\f\r   ᠎    "+"         　\u2028\u2029\ufeff"},function(e,t,r){var a=r(8);var o=r(129).set;e.exports=function(e,t,r){var i=t.constructor;var n;if(i!==r&&typeof i=="function"&&(n=i.prototype)!==r.prototype&&a(n)&&o){o(e,n)}return e}},function(e,t,r){"use strict";var a=r(32);var o=r(39);e.exports=function e(t){var r=String(o(this));var i="";var n=a(t);if(n<0||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(r+=r))if(n&1)i+=r;return i}},function(e,t){e.exports=Math.sign||function e(t){return(t=+t)==0||t!=t?t:t<0?-1:1}},function(e,t){var r=Math.expm1;e.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||r(-2e-17)!=-2e-17?function e(t){return(t=+t)==0?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(e,t,r){"use strict";var g=r(51);var w=r(0);var F=r(23);var b=r(22);var C=r(77);var x=r(136);var P=r(74);var M=r(28);var T=r(11)("iterator");var E=!([].keys&&"next"in[].keys());var S="@@iterator";var A="keys";var k="values";var L=function(){return this};e.exports=function(e,t,r,i,n,a,o){x(r,t,i);var s=function(t){if(!E&&t in c)return c[t];switch(t){case A:return function e(){return new r(this,t)};case k:return function e(){return new r(this,t)}}return function e(){return new r(this,t)}};var l=t+" Iterator";var u=n==k;var d=false;var c=e.prototype;var f=c[T]||c[S]||n&&c[n];var h=f||s(n);var p=n?!u?h:s("entries"):undefined;var v=t=="Array"?c.entries||f:f;var m,_,y;if(v){y=M(v.call(new e));if(y!==Object.prototype&&y.next){P(y,l,true);if(!g&&typeof y[T]!="function")b(y,T,L)}}if(u&&f&&f.name!==k){d=true;h=function e(){return f.call(this)}}if((!g||o)&&(E||d||!c[T])){b(c,T,h)}C[t]=h;C[l]=L;if(n){m={values:u?h:s(k),keys:a?h:s(A),entries:p};if(o)for(_ in m){if(!(_ in c))F(c,_,m[_])}else w(w.P+w.F*(E||d),t,m)}return m}},function(e,t,r){"use strict";var i=r(61);var n=r(57);var a=r(74);var o={};r(22)(o,r(11)("iterator"),function(){return this});e.exports=function(e,t,r){e.prototype=i(o,{next:n(1,r)});a(e,t+" Iterator")}},function(e,t,r){var i=r(103);var n=r(39);e.exports=function(e,t,r){if(i(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(n(e))}},function(e,t,r){var i=r(11)("match");e.exports=function(t){var r=/./;try{"/./"[t](r)}catch(e){try{r[i]=false;return!"/./"[t](r)}catch(e){}}return true}},function(e,t,r){var i=r(77);var n=r(11)("iterator");var a=Array.prototype;e.exports=function(e){return e!==undefined&&(i.Array===e||a[n]===e)}},function(e,t,r){"use strict";var i=r(15);var n=r(57);e.exports=function(e,t,r){if(t in e)i.f(e,t,n(0,r));else e[t]=r}},function(e,t,r){var i=r(75);var n=r(11)("iterator");var a=r(77);e.exports=r(29).getIteratorMethod=function(e){if(e!=undefined)return e[n]||e["@@iterator"]||a[i(e)]}},function(e,t,r){var i=r(365);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,r){"use strict";var l=r(16);var u=r(60);var d=r(12);e.exports=function e(t){var r=l(this);var i=d(r.length);var n=arguments.length;var a=u(n>1?arguments[1]:undefined,i);var o=n>2?arguments[2]:undefined;var s=o===undefined?i:u(o,i);while(s>a)r[a++]=t;return r}},function(e,t,r){"use strict";var i=r(52);var n=r(198);var a=r(77);var o=r(26);e.exports=r(135)(Array,"Array",function(e,t){this._t=o(e);this._i=0;this._k=t},function(){var e=this._t;var t=this._k;var r=this._i++;if(!e||r>=e.length){this._t=undefined;return n(1)}if(t=="keys")return n(0,r);if(t=="values")return n(0,e[r]);return n(0,[r,e[r]])},"values");a.Arguments=a.Array;i("keys");i("values");i("entries")},function(e,t,r){"use strict";var s=r(87);var l=RegExp.prototype.exec;var u=String.prototype.replace;var i=l;var d="lastIndex";var c=function(){var e=/a/,t=/b*/g;l.call(e,"a");l.call(t,"a");return e[d]!==0||t[d]!==0}();var f=/()??/.exec("")[1]!==undefined;var n=c||f;if(n){i=function e(t){var r=this;var i,n,a,o;if(f){n=new RegExp("^"+r.source+"$(?!\\s)",s.call(r))}if(c)i=r[d];a=l.call(r,t);if(c&&a){r[d]=r.global?a.index+a[0].length:i}if(f&&a&&a.length>1){u.call(a[0],n,function(){for(o=1;o<arguments.length-2;o++){if(arguments[o]===undefined)a[o]=undefined}})}return a}}e.exports=i},function(e,t,r){"use strict";var i=r(102)(true);e.exports=function(e,t,r){return t+(r?i(e,t).length:1)}},function(e,t,r){var i=r(30);var n=r(188);var a=r(128);var o=r(124);var s=r(6);var l=s.process;var u=s.setImmediate;var d=s.clearImmediate;var c=s.MessageChannel;var f=s.Dispatch;var h=0;var p={};var v="onreadystatechange";var m,_,y;var g=function(){var e=+this;if(p.hasOwnProperty(e)){var t=p[e];delete p[e];t()}};var w=function(e){g.call(e.data)};if(!u||!d){u=function e(t){var r=[];var i=1;while(arguments.length>i)r.push(arguments[i++]);p[++h]=function(){n(typeof t=="function"?t:Function(t),r)};m(h);return h};d=function e(t){delete p[t]};if(r(31)(l)=="process"){m=function(e){l.nextTick(i(g,e,1))}}else if(f&&f.now){m=function(e){f.now(i(g,e,1))}}else if(c){_=new c;y=_.port2;_.port1.onmessage=w;m=i(y.postMessage,y,1)}else if(s.addEventListener&&typeof postMessage=="function"&&!s.importScripts){m=function(e){s.postMessage(e+"","*")};s.addEventListener("message",w,false)}else if(v in o("script")){m=function(e){a.appendChild(o("script"))[v]=function(){a.removeChild(this);g.call(e)}}}else{m=function(e){setTimeout(i(g,e,1),0)}}}e.exports={set:u,clear:d}},function(e,t,r){var s=r(6);var l=r(147).set;var u=s.MutationObserver||s.WebKitMutationObserver;var d=s.process;var c=s.Promise;var f=r(31)(d)=="process";e.exports=function(){var r,i,n;var e=function(){var e,t;if(f&&(e=d.domain))e.exit();while(r){t=r.fn;r=r.next;try{t()}catch(e){if(r)n();else i=undefined;throw e}}i=undefined;if(e)e.enter()};if(f){n=function(){d.nextTick(e)}}else if(u&&!(s.navigator&&s.navigator.standalone)){var t=true;var a=document.createTextNode("");new u(e).observe(a,{characterData:true});n=function(){a.data=t=!t}}else if(c&&c.resolve){var o=c.resolve(undefined);n=function(){o.then(e)}}else{n=function(){l.call(s,e)}}return function(e){var t={fn:e,next:undefined};if(i)i.next=t;if(!r){r=t;n()}i=t}}},function(e,t,r){"use strict";var n=r(19);function i(e){var r,i;this.promise=new e(function(e,t){if(r!==undefined||i!==undefined)throw TypeError("Bad Promise constructor");r=e;i=t});this.resolve=n(r);this.reject=n(i)}e.exports.f=function(e){return new i(e)}},function(e,t,r){"use strict";var i=r(6);var n=r(14);var a=r(51);var o=r(109);var s=r(22);var l=r(66);var u=r(7);var d=r(64);var c=r(32);var f=r(12);var h=r(208);var p=r(62).f;var v=r(15).f;var m=r(143);var _=r(74);var y="ArrayBuffer";var g="DataView";var w="prototype";var F="Wrong length!";var b="Wrong index!";var C=i[y];var x=i[g];var P=i.Math;var M=i.RangeError;var T=i.Infinity;var E=C;var S=P.abs;var A=P.pow;var k=P.floor;var L=P.log;var D=P.LN2;var I="buffer";var R="byteLength";var O="byteOffset";var N=n?"_b":I;var B=n?"_l":R;var H=n?"_o":O;function V(e,t,r){var i=new Array(r);var n=r*8-t-1;var a=(1<<n)-1;var o=a>>1;var s=t===23?A(2,-24)-A(2,-77):0;var l=0;var u=e<0||e===0&&1/e<0?1:0;var d,c,f;e=S(e);if(e!=e||e===T){c=e!=e?1:0;d=a}else{d=k(L(e)/D);if(e*(f=A(2,-d))<1){d--;f*=2}if(d+o>=1){e+=s/f}else{e+=s*A(2,1-o)}if(e*f>=2){d++;f/=2}if(d+o>=a){c=0;d=a}else if(d+o>=1){c=(e*f-1)*A(2,t);d=d+o}else{c=e*A(2,o-1)*A(2,t);d=0}}for(;t>=8;i[l++]=c&255,c/=256,t-=8);d=d<<t|c;n+=t;for(;n>0;i[l++]=d&255,d/=256,n-=8);i[--l]|=u*128;return i}function G(e,t,r){var i=r*8-t-1;var n=(1<<i)-1;var a=n>>1;var o=i-7;var s=r-1;var l=e[s--];var u=l&127;var d;l>>=7;for(;o>0;u=u*256+e[s],s--,o-=8);d=u&(1<<-o)-1;u>>=-o;o+=t;for(;o>0;d=d*256+e[s],s--,o-=8);if(u===0){u=1-a}else if(u===n){return d?NaN:l?-T:T}else{d=d+A(2,t);u=u-a}return(l?-1:1)*d*A(2,u-t)}function z(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function U(e){return[e&255]}function j(e){return[e&255,e>>8&255]}function q(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]}function W(e){return V(e,52,8)}function X(e){return V(e,23,4)}function Z(e,t,r){v(e[w],t,{get:function(){return this[r]}})}function Y(e,t,r,i){var n=+r;var a=h(n);if(a+t>e[B])throw M(b);var o=e[N]._b;var s=a+e[H];var l=o.slice(s,s+t);return i?l:l.reverse()}function J(e,t,r,i,n,a){var o=+r;var s=h(o);if(s+t>e[B])throw M(b);var l=e[N]._b;var u=s+e[H];var d=i(+n);for(var c=0;c<t;c++)l[u+c]=d[a?c:t-c-1]}if(!o.ABV){C=function e(t){d(this,C,y);var r=h(t);this._b=m.call(new Array(r),0);this[B]=r};x=function e(t,r,i){d(this,x,g);d(t,C,g);var n=t[B];var a=c(r);if(a<0||a>n)throw M("Wrong offset!");i=i===undefined?n-a:f(i);if(a+i>n)throw M(F);this[N]=t;this[H]=a;this[B]=i};if(n){Z(C,R,"_l");Z(x,I,"_b");Z(x,R,"_l");Z(x,O,"_o")}l(x[w],{getInt8:function e(t){return Y(this,1,t)[0]<<24>>24},getUint8:function e(t){return Y(this,1,t)[0]},getInt16:function e(t){var r=Y(this,2,t,arguments[1]);return(r[1]<<8|r[0])<<16>>16},getUint16:function e(t){var r=Y(this,2,t,arguments[1]);return r[1]<<8|r[0]},getInt32:function e(t){return z(Y(this,4,t,arguments[1]))},getUint32:function e(t){return z(Y(this,4,t,arguments[1]))>>>0},getFloat32:function e(t){return G(Y(this,4,t,arguments[1]),23,4)},getFloat64:function e(t){return G(Y(this,8,t,arguments[1]),52,8)},setInt8:function e(t,r){J(this,1,t,U,r)},setUint8:function e(t,r){J(this,1,t,U,r)},setInt16:function e(t,r){J(this,2,t,j,r,arguments[2])},setUint16:function e(t,r){J(this,2,t,j,r,arguments[2])},setInt32:function e(t,r){J(this,4,t,q,r,arguments[2])},setUint32:function e(t,r){J(this,4,t,q,r,arguments[2])},setFloat32:function e(t,r){J(this,4,t,X,r,arguments[2])},setFloat64:function e(t,r){J(this,8,t,W,r,arguments[2])}})}else{if(!u(function(){C(1)})||!u(function(){new C(-1)})||u(function(){new C;new C(1.5);new C(NaN);return C.name!=y})){C=function e(t){d(this,C);return new E(h(t))};var Q=C[w]=E[w];for(var K=p(E),$=0,ee;K.length>$;){if(!((ee=K[$++])in C))s(C,ee,E[ee])}if(!a)Q.constructor=C}var te=new x(new C(2));var re=x[w].setInt8;te.setInt8(0,2147483648);te.setInt8(1,2147483649);if(te.getInt8(0)||!te.getInt8(1))l(x[w],{setInt8:function e(t,r){re.call(this,t,r<<24>>24)},setUint8:function e(t,r){re.call(this,t,r<<24>>24)}},true)}_(C,y);_(x,g);s(x[w],o.VIEW,true);t[y]=C;t[g]=x},function(e,t,r){var i=r(89);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return i(e)=="String"?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(e==undefined)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){"use strict";var g=r(90);var w=r(17);var F=r(218);var b=r(54);var C=r(80);var x=r(480);var P=r(93);var M=r(484);var T=r(21)("iterator");var E=!([].keys&&"next"in[].keys());var S="@@iterator";var A="keys";var k="values";var L=function(){return this};e.exports=function(e,t,r,i,n,a,o){x(r,t,i);var s=function(t){if(!E&&t in c)return c[t];switch(t){case A:return function e(){return new r(this,t)};case k:return function e(){return new r(this,t)}}return function e(){return new r(this,t)}};var l=t+" Iterator";var u=n==k;var d=false;var c=e.prototype;var f=c[T]||c[S]||n&&c[n];var h=f||s(n);var p=n?!u?h:s("entries"):undefined;var v=t=="Array"?c.entries||f:f;var m,_,y;if(v){y=M(v.call(new e));if(y!==Object.prototype&&y.next){P(y,l,true);if(!g&&typeof y[T]!="function")b(y,T,L)}}if(u&&f&&f.name!==k){d=true;h=function e(){return f.call(this)}}if((!g||o)&&(E||d||!c[T])){b(c,T,h)}C[t]=h;C[l]=L;if(n){m={values:u?h:s(k),keys:a?h:s(A),entries:p};if(o)for(_ in m){if(!(_ in c))F(c,_,m[_])}else w(w.P+w.F*(E||d),t,m)}return m}},function(e,t,r){var i=r(42);var n=r(20).document;var a=i(n)&&i(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},function(e,t,r){var n=r(42);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&typeof(r=e.toString)=="function"&&!n(i=r.call(e)))return i;if(typeof(r=e.valueOf)=="function"&&!n(i=r.call(e)))return i;if(!t&&typeof(r=e.toString)=="function"&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){var r=Math.ceil;var i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},function(e,t,r){var i=r(158)("keys");var n=r(115);e.exports=function(e){return i[e]||(i[e]=n(e))}},function(e,t,r){var i=r(13);var n=r(20);var a="__core-js_shared__";var o=n[a]||(n[a]={});(e.exports=function(e,t){return o[e]||(o[e]=t!==undefined?t:{})})("versions",[]).push({version:i.version,mode:r(90)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var i=r(116);var n=r(21)("iterator");var a=r(80);e.exports=r(13).getIteratorMethod=function(e){if(e!=undefined)return e[n]||e["@@iterator"]||a[i(e)]}},function(e,t,r){var n=r(54);e.exports=function(e,t,r){for(var i in t){if(r&&e[i])e[i]=t[i];else n(e,i,t[i])}return e}},function(e,t){e.exports=function(e,t,r,i){if(!(e instanceof t)||i!==undefined&&i in e){throw TypeError(r+": incorrect invocation!")}return e}},function(e,t,r){var i=r(115)("meta");var n=r(42);var a=r(69);var o=r(34).f;var s=0;var l=Object.isExtensible||function(){return true};var u=!r(68)(function(){return l(Object.preventExtensions({}))});var d=function(e){o(e,i,{value:{i:"O"+ ++s,w:{}}})};var c=function(e,t){if(!n(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!a(e,i)){if(!l(e))return"F";if(!t)return"E";d(e)}return e[i].i};var f=function(e,t){if(!a(e,i)){if(!l(e))return true;if(!t)return false;d(e)}return e[i].w};var h=function(e){if(u&&p.NEED&&l(e)&&!a(e,i))d(e);return e};var p=e.exports={KEY:i,NEED:false,fastKey:c,getWeak:f,onFreeze:h}},function(e,t,r){var i=r(42);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,Fi,bi){"use strict";bi.r(Fi);(function(r,t){bi.d(Fi,"$mobx",function(){return wi});bi.d(Fi,"Reaction",function(){return Br});bi.d(Fi,"untracked",function(){return Lr});bi.d(Fi,"IDerivationState",function(){return br});bi.d(Fi,"createAtom",function(){return dt});bi.d(Fi,"spy",function(){return e});bi.d(Fi,"comparer",function(){return j});bi.d(Fi,"isObservableObject",function(){return _e});bi.d(Fi,"isBoxedObservable",function(){return ae});bi.d(Fi,"isObservableArray",function(){return Ct});bi.d(Fi,"ObservableMap",function(){return $e});bi.d(Fi,"isObservableMap",function(){return et});bi.d(Fi,"transaction",function(){return Qe});bi.d(Fi,"observable",function(){return Ge});bi.d(Fi,"computed",function(){return Te});bi.d(Fi,"isObservable",function(){return we});bi.d(Fi,"isObservableProp",function(){return Fe});bi.d(Fi,"isComputed",function(){return Ce});bi.d(Fi,"isComputedProp",function(){return xe});bi.d(Fi,"extendObservable",function(){return Se});bi.d(Fi,"extendShallowObservable",function(){return Ee});bi.d(Fi,"observe",function(){return Wr});bi.d(Fi,"intercept",function(){return Yr});bi.d(Fi,"autorun",function(){return q});bi.d(Fi,"reaction",function(){return Z});bi.d(Fi,"when",function(){return Kr});bi.d(Fi,"action",function(){return k});bi.d(Fi,"isAction",function(){return D});bi.d(Fi,"runInAction",function(){return L});bi.d(Fi,"keys",function(){return ti});bi.d(Fi,"values",function(){return ri});bi.d(Fi,"entries",function(){return ii});bi.d(Fi,"set",function(){return ni});bi.d(Fi,"remove",function(){return ai});bi.d(Fi,"has",function(){return oi});bi.d(Fi,"get",function(){return si});bi.d(Fi,"decorate",function(){return li});bi.d(Fi,"configure",function(){return ui});bi.d(Fi,"onBecomeObserved",function(){return nt});bi.d(Fi,"onBecomeUnobserved",function(){return at});bi.d(Fi,"flow",function(){return ci});bi.d(Fi,"toJS",function(){return mi});bi.d(Fi,"trace",function(){return Or});bi.d(Fi,"getDependencyTree",function(){return ar});bi.d(Fi,"getObserverTree",function(){return sr});bi.d(Fi,"_resetGlobalState",function(){return nr});bi.d(Fi,"_getGlobalState",function(){return ir});bi.d(Fi,"getDebugName",function(){return it});bi.d(Fi,"getAtom",function(){return tt});bi.d(Fi,"_getAdministration",function(){return rt});bi.d(Fi,"_allowStateChanges",function(){return C});bi.d(Fi,"_allowStateChangesInsideComputed",function(){return M});bi.d(Fi,"isArrayLike",function(){return qt});bi.d(Fi,"_isComputingDerivation",function(){return Tr});bi.d(Fi,"onReactionError",function(){return Hr});bi.d(Fi,"_interceptReads",function(){return _i});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};function n(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var u=Object.assign||function e(t){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))t[a]=r[a]}return t};function a(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),n,a=[],o;try{while((t===void 0||t-- >0)&&!(n=i.next()).done)a.push(n.value)}catch(e){o={error:e}}finally{try{if(n&&!n.done&&(r=i["return"]))r.call(i)}finally{if(o)throw o.error}}return a}function o(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}var s={};var l={};function d(t,e){var r=e?s:l;return r[t]||(r[t]={configurable:true,enumerable:e,get:function(){c(this);return this[t]},set:function(e){c(this);this[t]=e}})}function c(e){if(e.__mobxDidRunLazyInitializers===true)return;var t=e.__mobxDecorators;if(t){Ht(e,"__mobxDidRunLazyInitializers",true);for(var r in t){var i=t[r];i.propertyCreator(e,i.prop,i.descriptor,i.decoratorTarget,i.decoratorArguments)}}}function f(s,l){return function e(){var o;var t=function e(t,r,i,n){if(n===true){l(t,r,i,t,o);return null}if(false){}if(!Object.prototype.hasOwnProperty.call(t,"__mobxDecorators")){var a=t.__mobxDecorators;Ht(t,"__mobxDecorators",u({},a))}t.__mobxDecorators[r]={prop:r,propertyCreator:l,descriptor:i,decoratorTarget:t,decoratorArguments:o};return d(r,s)};if(h(arguments)){o=Pt;return t.apply(null,arguments)}else{o=Array.prototype.slice.call(arguments);return t}}}function h(e){return(e.length===2||e.length===3)&&typeof e[1]==="string"||e.length===4&&e[3]===true}function p(){return!!tr.spyListeners.length}function v(e){if(!tr.spyListeners.length)return;var t=tr.spyListeners;for(var r=0,i=t.length;r<i;r++)t[r](e)}function m(e){var t=u({},e,{spyReportStart:true});v(t)}var _={spyReportEnd:true};function y(e){if(e)v(u({},e,{spyReportEnd:true}));else v(_)}function e(t){tr.spyListeners.push(t);return Dt(function(){tr.spyListeners=tr.spyListeners.filter(function(e){return e!==t})})}function g(e,t){if(false){}var r=function(){return w(e,t,this,arguments)};r.isMobxAction=true;return r}function w(e,t,r,i){var n=F(e,t,r,i);try{return t.apply(r,i)}finally{b(n)}}function F(e,t,r,i){var n=p()&&!!e;var a=0;if(n){a=Date.now();var o=i&&i.length||0;var s=new Array(o);if(o>0)for(var l=0;l<o;l++)s[l]=i[l];m({type:"action",name:e,object:r,arguments:s})}var u=Dr();pr();var d=x(true);return{prevDerivation:u,prevAllowStateChanges:d,notifySpy:n,startTime:a}}function b(e){P(e.prevAllowStateChanges);vr();Ir(e.prevDerivation);if(e.notifySpy)y({time:Date.now()-e.startTime})}function C(e,t){var r=x(e);var i;try{i=t()}finally{P(r)}return i}function x(e){var t=tr.allowStateChanges;tr.allowStateChanges=e;return t}function P(e){tr.allowStateChanges=e}function M(e){var t=tr.computationDepth;tr.computationDepth=0;var r;try{r=e()}finally{tr.computationDepth=t}return r}function T(){St(false&&false)}function E(n){return function(e,t,r){if(r){if(false){}if(r.value){return{value:g(n,r.value),enumerable:false,configurable:true,writable:true}}var i=r.initializer;return{enumerable:false,configurable:true,writable:true,initializer:function(){return g(n,i.call(this))}}}return S(n).apply(this,arguments)}}function S(i){return function(e,t,r){Object.defineProperty(e,t,{configurable:true,enumerable:false,get:function(){return undefined},set:function(e){Ht(this,t,k(i,e))}})}}function A(e,t,r,i){if(i===true){I(e,t,r.value);return null}if(r){return{configurable:true,enumerable:false,get:function(){I(this,t,r.value||r.initializer.call(this));return this[t]},set:T}}return{enumerable:false,configurable:true,set:function(e){I(this,t,e)},get:function(){return undefined}}}var k=function e(t,r,i,n){if(arguments.length===1&&typeof t==="function")return g(t.name||"<unnamed action>",t);if(arguments.length===2&&typeof r==="function")return g(t,r);if(arguments.length===1&&typeof t==="string")return E(t);if(n===true){t[r]=g(t.name||r,i.value)}else{return E(r).apply(null,arguments)}};k.bound=A;function L(e,t){var r=typeof e==="string"?e:e.name||"<unnamed action>";var i=typeof e==="function"?e:t;if(false){}return w(r,i,this,undefined)}function D(e){return typeof e==="function"&&e.isMobxAction===true}function I(e,t,r){Ht(e,t,g(t,r.bind(e)))}var R=Object.prototype.toString;function O(e,t){return N(e,t)}function N(e,t,r,i){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return false;if(e!==e)return t!==t;var n=typeof e;if(n!=="function"&&n!=="object"&&typeof t!="object")return false;return B(e,t,r,i)}function B(e,t,r,i){e=H(e);t=H(t);var n=R.call(e);if(n!==R.call(t))return false;switch(n){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return typeof Symbol!=="undefined"&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t)}var a=n==="[object Array]";if(!a){if(typeof e!="object"||typeof t!="object")return false;var o=e.constructor,s=t.constructor;if(o!==s&&!(typeof o==="function"&&o instanceof o&&typeof s==="function"&&s instanceof s)&&("constructor"in e&&"constructor"in t)){return false}}r=r||[];i=i||[];var l=r.length;while(l--){if(r[l]===e)return i[l]===t}r.push(e);i.push(t);if(a){l=e.length;if(l!==t.length)return false;while(l--){if(!N(e[l],t[l],r,i))return false}}else{var u=Object.keys(e),d;l=u.length;if(Object.keys(t).length!==l)return false;while(l--){d=u[l];if(!(V(t,d)&&N(e[d],t[d],r,i)))return false}}r.pop();i.pop();return true}function H(e){if(Ct(e))return e.peek();if(Wt(e)||et(e))return Zt(e.entries());return e}function V(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function G(e,t){return e===t}function z(e,t){return O(e,t)}function U(e,t){return jt(e,t)||G(e,t)}var j={identity:G,structural:z,default:U};function q(e,t){if(t===void 0){t=Mt}if(false){}var r=t&&t.name||e.name||"Autorun@"+Et();var i=!t.scheduler&&!t.delay;var n;if(i){n=new Br(r,function(){this.track(s)},t.onError)}else{var a=X(t);var o=false;n=new Br(r,function(){if(!o){o=true;a(function(){o=false;if(!n.isDisposed)n.track(s)})}},t.onError)}function s(){e(n)}n.schedule();return n.getDisposer()}var W=function(e){return e()};function X(t){return t.scheduler?t.scheduler:t.delay?function(e){return setTimeout(e,t.delay)}:W}function Z(r,e,i){if(i===void 0){i=Mt}if(typeof i==="boolean"){i={fireImmediately:i};Lt("Using fireImmediately as argument is deprecated. Use '{ fireImmediately: true }' instead")}if(false){}var t=i.name||"Reaction@"+Et();var n=k(t,i.onError?Y(i.onError,e):e);var a=!i.scheduler&&!i.delay;var o=X(i);var s=true;var l=false;var u;var d=i.compareStructural?j.structural:i.equals||j.default;var c=new Br(t,function(){if(s||a){f()}else if(!l){l=true;o(f)}},i.onError);function f(){l=false;if(c.isDisposed)return;var t=false;c.track(function(){var e=r(c);t=s||!d(u,e);u=e});if(s&&i.fireImmediately)n(u,c);if(!s&&t===true)n(u,c);if(s)s=false}c.schedule();return c.getDisposer()}function Y(t,e){return function(){try{return e.apply(this,arguments)}catch(e){t.call(this,e)}}}var J=function(){function e(e){this.dependenciesState=br.NOT_TRACKING;this.observing=[];this.newObserving=null;this.isBeingObserved=false;this.isPendingUnobservation=false;this.observers=[];this.observersIndexes={};this.diffValue=0;this.runId=0;this.lastAccessedBy=0;this.lowestObserverState=br.UP_TO_DATE;this.unboundDepsCount=0;this.__mapid="#"+Et();this.value=new xr(null);this.isComputing=false;this.isRunningSetter=false;this.isTracing=Cr.NONE;if(false){}this.derivation=e.get;this.name=e.name||"ComputedValue@"+Et();if(e.set)this.setter=g(this.name+"-setter",e.set);this.equals=e.equals||(e.compareStructural||e.struct?j.structural:j.default);this.scope=e.context;this.requiresReaction=!!e.requiresReaction;this.keepAlive=!!e.keepAlive}e.prototype.onBecomeStale=function(){gr(this)};e.prototype.onBecomeUnobserved=function(){};e.prototype.onBecomeObserved=function(){};e.prototype.get=function(){if(this.isComputing)St("Cycle detected in computation "+this.name+": "+this.derivation);if(tr.inBatch===0&&this.observers.length===0&&!this.keepAlive){if(Mr(this)){this.warnAboutUntrackedRead();pr();this.value=this.computeValue(false);vr()}}else{mr(this);if(Mr(this))if(this.trackAndCompute())yr(this)}var e=this.value;if(Pr(e))throw e.cause;return e};e.prototype.peek=function(){var e=this.computeValue(false);if(Pr(e))throw e.cause;return e};e.prototype.set=function(e){if(this.setter){At(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?");this.isRunningSetter=true;try{this.setter.call(this.scope,e)}finally{this.isRunningSetter=false}}else At(false,false&&false)};e.prototype.trackAndCompute=function(){if(p()){v({object:this.scope,type:"compute",name:this.name})}var e=this.value;var t=this.dependenciesState===br.NOT_TRACKING;var r=this.computeValue(true);var i=t||Pr(e)||Pr(r)||!this.equals(e,r);if(i){this.value=r}return i};e.prototype.computeValue=function(e){this.isComputing=true;tr.computationDepth++;var t;if(e){t=Sr(this,this.derivation,this.scope)}else{if(tr.disableErrorBoundaries===true){t=this.derivation.call(this.scope)}else{try{t=this.derivation.call(this.scope)}catch(e){t=new xr(e)}}}tr.computationDepth--;this.isComputing=false;return t};e.prototype.suspend=function(){if(!this.keepAlive){kr(this);this.value=undefined}};e.prototype.observe=function(r,i){var n=this;var a=true;var o=undefined;return q(function(){var e=n.get();if(!a||i){var t=Dr();r({type:"update",object:n,newValue:e,oldValue:o});Ir(t)}a=false;o=e})};e.prototype.warnAboutUntrackedRead=function(){if(true)return;if(this.requiresReaction===true){St("[mobx] Computed value "+this.name+" is read outside a reactive context")}if(this.isTracing!==Cr.NONE){console.log("[mobx.trace] '"+this.name+"' is being read outside a reactive context. Doing a full recompute")}if(tr.computedRequiresReaction){console.warn("[mobx] Computed value "+this.name+" is being read outside a reactive context. Doing a full recompute")}};e.prototype.toJSON=function(){return this.get()};e.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"};e.prototype.valueOf=function(){return Jt(this.get())};return e}();J.prototype[Yt()]=J.prototype.valueOf;var Q=Ut("ComputedValue",J);function K(e){return e.interceptors!==undefined&&e.interceptors.length>0}function $(e,t){var r=e.interceptors||(e.interceptors=[]);r.push(t);return Dt(function(){var e=r.indexOf(t);if(e!==-1)r.splice(e,1)})}function ee(e,t){var r=Dr();try{var i=e.interceptors;if(i)for(var n=0,a=i.length;n<a;n++){t=i[n](t);At(!t||t.type,"Intercept handlers should return nothing or a change object");if(!t)break}return t}finally{Ir(r)}}function te(e){return e.changeListeners!==undefined&&e.changeListeners.length>0}function re(e,t){var r=e.changeListeners||(e.changeListeners=[]);r.push(t);return Dt(function(){var e=r.indexOf(t);if(e!==-1)r.splice(e,1)})}function ie(e,t){var r=Dr();var i=e.changeListeners;if(!i)return;i=i.slice();for(var n=0,a=i.length;n<a;n++){i[n](t)}Ir(r)}ut();var ne=function(a){n(e,a);function e(e,t,r,i){if(r===void 0){r="ObservableValue@"+Et()}if(i===void 0){i=true}var n=a.call(this,r)||this;n.enhancer=t;n.hasUnreportedChange=false;n.value=t(e,undefined,r);if(i&&p()){v({type:"create",name:n.name,newValue:""+n.value})}return n}e.prototype.dehanceValue=function(e){if(this.dehancer!==undefined)return this.dehancer(e);return e};e.prototype.set=function(e){var t=this.value;e=this.prepareNewValue(e);if(e!==tr.UNCHANGED){var r=p();if(r){m({type:"update",name:this.name,newValue:e,oldValue:t})}this.setNewValue(e);if(r)y()}};e.prototype.prepareNewValue=function(e){Er(this);if(K(this)){var t=ee(this,{object:this,type:"update",newValue:e});if(!t)return tr.UNCHANGED;e=t.newValue}e=this.enhancer(e,this.value,this.name);return this.value!==e?e:tr.UNCHANGED};e.prototype.setNewValue=function(e){var t=this.value;this.value=e;this.reportChanged();if(te(this)){ie(this,{type:"update",object:this,newValue:e,oldValue:t})}};e.prototype.get=function(){this.reportObserved();return this.dehanceValue(this.value)};e.prototype.intercept=function(e){return $(this,e)};e.prototype.observe=function(e,t){if(t)e({object:this,type:"update",newValue:this.value,oldValue:undefined});return re(this,e)};e.prototype.toJSON=function(){return this.get()};e.prototype.toString=function(){return this.name+"["+this.value+"]"};e.prototype.valueOf=function(){return Jt(this.get())};return e}(st);ne.prototype[Yt()]=ne.prototype.valueOf;var ae=Ut("ObservableValue",ne);var oe=function(){function e(e,t,r){this.target=e;this.name=t;this.defaultEnhancer=r;this.values={}}e.prototype.read=function(e,t){if(true&&this.target!==e){this.illegalAccess(e,t);if(!this.values[t])return undefined}return this.values[t].get()};e.prototype.write=function(e,t,r){var i=this.target;if(true&&i!==e){this.illegalAccess(e,t)}var n=this.values[t];if(n instanceof J){n.set(r);return}if(K(this)){var a=ee(this,{type:"update",object:i,name:t,newValue:r});if(!a)return;r=a.newValue}r=n.prepareNewValue(r);if(r!==tr.UNCHANGED){var o=te(this);var s=p();var a=o||s?{type:"update",object:i,oldValue:n.value,name:t,newValue:r}:null;if(s)m(u({},a,{name:this.name,key:t}));n.setNewValue(r);if(o)ie(this,a);if(s)y()}};e.prototype.remove=function(e){if(!this.values[e])return;var t=this.target;if(K(this)){var r=ee(this,{object:t,name:e,type:"remove"});if(!r)return}try{pr();var i=te(this);var n=p();var a=this.values[e].get();if(this.keys)this.keys.remove(e);delete this.values[e];delete this.target[e];var r=i||n?{type:"remove",object:t,oldValue:a,name:e}:null;if(n)m(u({},r,{name:this.name,key:e}));if(i)ie(this,r);if(n)y()}finally{vr()}};e.prototype.illegalAccess=function(e,t){console.warn("Property '"+t+"' of '"+e+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")};e.prototype.observe=function(e,t){false&&false;return re(this,e)};e.prototype.intercept=function(e){return $(this,e)};e.prototype.getKeys=function(){var t=this;if(this.keys===undefined){this.keys=new _t(Object.keys(this.values).filter(function(e){return t.values[e]instanceof ne}),qe,"keys("+this.name+")",true)}return this.keys.slice()};return e}();function se(e,t,r){if(t===void 0){t=""}if(r===void 0){r=Ue}var i=e.$mobx;if(i)return i;false&&false;if(!Nt(e))t=(e.constructor.name||"ObservableObject")+"@"+Et();if(!t)t="ObservableObject@"+Et();i=new oe(e,t,r);Vt(e,"$mobx",i);return i}function le(e,t,r,i){var n=se(e);zt(e,t);if(K(n)){var a=ee(n,{object:e,name:t,type:"add",newValue:r});if(!a)return;r=a.newValue}var o=n.values[t]=new ne(r,i,n.name+"."+t,false);r=o.value;Object.defineProperty(e,t,fe(t));if(n.keys)n.keys.push(t);ve(n,e,t,r)}function ue(e,t,r){var i=se(e);r.name=i.name+"."+t;r.context=e;i.values[t]=new J(r);Object.defineProperty(e,t,pe(t))}var de=Object.create(null);var ce=Object.create(null);function fe(t){return de[t]||(de[t]={configurable:true,enumerable:true,get:function(){return this.$mobx.read(this,t)},set:function(e){this.$mobx.write(this,t,e)}})}function he(e){var t=e.$mobx;if(!t){c(e);return e.$mobx}return t}function pe(t){return ce[t]||(ce[t]={configurable:true,enumerable:false,get:function(){return he(this).read(this,t)},set:function(e){he(this).write(this,t,e)}})}function ve(e,t,r,i){var n=te(e);var a=p();var o=n||a?{type:"add",object:t,name:r,newValue:i}:null;if(a)m(u({},o,{name:e.name,key:r}));if(n)ie(e,o);if(a)y()}var me=Ut("ObservableObjectAdministration",oe);function _e(e){if(Ot(e)){c(e);return me(e.$mobx)}return false}function ye(o){var t=f(true,function(e,t,r,i,n){if(false){}var a=r?r.initializer?r.initializer.call(e):r.value:undefined;le(e,t,a,o)});var e=typeof r!=="undefined"&&r.env&&"production"!=="production"?function e(){if(arguments.length<2)return St("Incorrect decorator invocation. @observable decorator doesn't expect any arguments");return t.apply(null,arguments)}:t;e.enhancer=o;return e}function ge(e,t){if(e===null||e===undefined)return false;if(t!==undefined){if(false){}if(_e(e)){var r=e.$mobx;return r.values&&!!r.values[t]}return false}return _e(e)||!!e.$mobx||lt(e)||jr(e)||Q(e)}function we(e){if(arguments.length!==1)St(false&&false);return ge(e)}function Fe(e,t){if(typeof t!=="string")return St(false&&false);return ge(e,t)}function be(e,t){if(e===null||e===undefined)return false;if(t!==undefined){if(_e(e)===false)return false;if(!e.$mobx.values[t])return false;var r=tt(e,t);return Q(r)}return Q(e)}function Ce(e){if(arguments.length>1)return St(false&&false);return be(e)}function xe(e,t){if(typeof t!=="string")return St(false&&false);return be(e,t)}var Pe=f(false,function(e,t,r,i,n){var a=r.get,o=r.set;var s=n[0]||{};ue(e,t,u({get:a,set:o},s))});var Me=Pe({equals:j.structural});var Te=function e(t,r,i){if(typeof r==="string"){return Pe.apply(null,arguments)}if(t!==null&&typeof t==="object"&&arguments.length===1){return Pe.apply(null,arguments)}if(false){}var n=typeof r==="object"?r:{};n.get=t;n.set=typeof r==="function"?r:n.set;n.name=n.name||t.name||"";return new J(n)};Te.struct=Me;function Ee(e,t,r){Lt("'extendShallowObservable' is deprecated, use 'extendObservable(target, props, { deep: false })' instead");return Se(e,t,r,ke)}function Se(e,t,r,i){if(false){var n}i=De(i);var a=i.defaultDecorator||(i.deep===false?Ne:Re);c(e);se(e,i.name,a.enhancer);pr();try{for(var n in t){var o=Object.getOwnPropertyDescriptor(t,n);if(false){}var s=r&&n in r?r[n]:o.get?Pe:a;if(false){}var l=s(e,n,o,true);if(l)Object.defineProperty(e,n,l)}}finally{vr()}return e}var Ae={deep:true,name:undefined,defaultDecorator:undefined};var ke={deep:false,name:undefined,defaultDecorator:undefined};Object.freeze(Ae);Object.freeze(ke);function Le(e){if(!/^(deep|name|defaultDecorator)$/.test(e))St("invalid option for (extend)observable: "+e)}function De(e){if(e===null||e===undefined)return Ae;if(typeof e==="string")return{name:e,deep:true};if(false){}return e}function Ie(e){return e.defaultDecorator?e.defaultDecorator.enhancer:e.deep===false?qe:Ue}var Re=ye(Ue);var Oe=ye(je);var Ne=ye(qe);var Be=ye(We);function He(e,t,r){if(typeof arguments[1]==="string"){return Re.apply(null,arguments)}if(we(e))return e;var i=Nt(e)?Ge.object(e,t,r):Array.isArray(e)?Ge.array(e,t):Wt(e)?Ge.map(e,t):e;if(i!==e)return i;St(false&&false)}var Ve={box:function(e,t){if(arguments.length>2)ze("box");var r=De(t);return new ne(e,Ie(r),r.name)},shallowBox:function(e,t){if(arguments.length>2)ze("shallowBox");Lt("observable.shallowBox","observable.box(value, { deep: false })");return Ge.box(e,{name:t,deep:false})},array:function(e,t){if(arguments.length>2)ze("array");var r=De(t);return new _t(e,Ie(r),r.name)},shallowArray:function(e,t){if(arguments.length>2)ze("shallowArray");Lt("observable.shallowArray","observable.array(values, { deep: false })");return Ge.array(e,{name:t,deep:false})},map:function(e,t){if(arguments.length>2)ze("map");var r=De(t);return new $e(e,Ie(r),r.name)},shallowMap:function(e,t){if(arguments.length>2)ze("shallowMap");Lt("observable.shallowMap","observable.map(values, { deep: false })");return Ge.map(e,{name:t,deep:false})},object:function(e,t,r){if(typeof arguments[1]==="string")ze("object");var i=De(r);return Se({},e,t,i)},shallowObject:function(e,t){if(typeof arguments[1]==="string")ze("shallowObject");Lt("observable.shallowObject","observable.object(values, {}, { deep: false })");return Ge.object(e,{},{name:t,deep:false})},ref:Ne,shallow:Oe,deep:Re,struct:Be};var Ge=He;Object.keys(Ve).forEach(function(e){return Ge[e]=Ve[e]});function ze(e){St("Expected one or two arguments to observable."+e+". Did you accidentally try to use observable."+e+" as decorator?")}function Ue(e,t,r){if(we(e))return e;if(Array.isArray(e))return Ge.array(e,{name:r});if(Nt(e))return Ge.object(e,undefined,{name:r});if(Wt(e))return Ge.map(e,{name:r});return e}function je(e,t,r){if(e===undefined||e===null)return e;if(_e(e)||Ct(e)||et(e))return e;if(Array.isArray(e))return Ge.array(e,{name:r,deep:false});if(Nt(e))return Ge.object(e,undefined,{name:r,deep:false});if(Wt(e))return Ge.map(e,{name:r,deep:false});return St(false&&false)}function qe(e){return e}function We(e,t,r){if(false){}if(O(e,t))return t;return e}function Xe(){return typeof Symbol==="function"&&Symbol.iterator||"@@iterator"}function Ze(e,t){Vt(e,Xe(),t)}function Ye(e){e[Xe()]=Je;return e}function Je(){return this}function Qe(e,t){if(t===void 0){t=undefined}pr();try{return e.apply(t)}finally{vr()}}var Ke={};var $e=function(){function e(e,t,r){if(t===void 0){t=Ue}if(r===void 0){r="ObservableMap@"+Et()}this.enhancer=t;this.name=r;this.$mobx=Ke;this._keys=new _t(undefined,qe,this.name+".keys()",true);if(typeof Map!=="function"){throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js")}this._data=new Map;this._hasMap=new Map;this.merge(e)}e.prototype._has=function(e){return this._data.has(e)};e.prototype.has=function(e){if(this._hasMap.has(e))return this._hasMap.get(e).get();return this._updateHasMapEntry(e,false).get()};e.prototype.set=function(e,t){var r=this._has(e);if(K(this)){var i=ee(this,{type:r?"update":"add",object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}if(r){this._updateValue(e,t)}else{this._addValue(e,t)}return this};e.prototype.delete=function(t){var r=this;if(K(this)){var e=ee(this,{type:"delete",object:this,name:t});if(!e)return false}if(this._has(t)){var i=p();var n=te(this);var e=n||i?{type:"delete",object:this,oldValue:this._data.get(t).value,name:t}:null;if(i)m(u({},e,{name:this.name,key:t}));Qe(function(){r._keys.remove(t);r._updateHasMapEntry(t,false);var e=r._data.get(t);e.setNewValue(undefined);r._data.delete(t)});if(n)ie(this,e);if(i)y();return true}return false};e.prototype._updateHasMapEntry=function(e,t){var r=this._hasMap.get(e);if(r){r.setNewValue(t)}else{r=new ne(t,qe,this.name+"."+e+"?",false);this._hasMap.set(e,r)}return r};e.prototype._updateValue=function(e,t){var r=this._data.get(e);t=r.prepareNewValue(t);if(t!==tr.UNCHANGED){var i=p();var n=te(this);var a=n||i?{type:"update",object:this,oldValue:r.value,name:e,newValue:t}:null;if(i)m(u({},a,{name:this.name,key:e}));r.setNewValue(t);if(n)ie(this,a);if(i)y()}};e.prototype._addValue=function(t,r){var i=this;Qe(function(){var e=new ne(r,i.enhancer,i.name+"."+t,false);i._data.set(t,e);r=e.value;i._updateHasMapEntry(t,true);i._keys.push(t)});var e=p();var n=te(this);var a=n||e?{type:"add",object:this,name:t,newValue:r}:null;if(e)m(u({},a,{name:this.name,key:t}));if(n)ie(this,a);if(e)y()};e.prototype.get=function(e){if(this.has(e))return this.dehanceValue(this._data.get(e).get());return this.dehanceValue(undefined)};e.prototype.dehanceValue=function(e){if(this.dehancer!==undefined){return this.dehancer(e)}return e};e.prototype.keys=function(){return this._keys[Xe()]()};e.prototype.values=function(){var e=this;var t=0;return Ye({next:function(){return t<e._keys.length?{value:e.get(e._keys[t++]),done:false}:{value:undefined,done:true}}})};e.prototype.entries=function(){var t=this;var r=0;return Ye({next:function(){if(r<t._keys.length){var e=t._keys[r++];return{value:[e,t.get(e)],done:false}}return{done:true}}})};e.prototype.forEach=function(t,r){var i=this;this._keys.forEach(function(e){return t.call(r,i.get(e),e,i)})};e.prototype.merge=function(t){var n=this;if(et(t)){t=t.toJS()}Qe(function(){if(Nt(t))Object.keys(t).forEach(function(e){return n.set(e,t[e])});else if(Array.isArray(t))t.forEach(function(e){var t=a(e,2),r=t[0],i=t[1];return n.set(r,i)});else if(Wt(t))t.forEach(function(e,t){return n.set(t,e)});else if(t!==null&&t!==undefined)St("Cannot initialize map from "+t)});return this};e.prototype.clear=function(){var t=this;Qe(function(){Lr(function(){t._keys.slice().forEach(function(e){return t.delete(e)})})})};e.prototype.replace=function(i){var n=this;Qe(function(){var t=Xt(i);var e=n._keys;var r=e.filter(function(e){return t.indexOf(e)===-1});r.forEach(function(e){return n.delete(e)});n.merge(i)});return this};Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:true,configurable:true});e.prototype.toPOJO=function(){var t=this;var r={};this._keys.forEach(function(e){return r[""+e]=t.get(e)});return r};e.prototype.toJS=function(){var t=this;var r=new Map;this._keys.forEach(function(e){return r.set(e,t.get(e))});return r};e.prototype.toJSON=function(){return this.toPOJO()};e.prototype.toString=function(){var t=this;return this.name+"[{ "+this._keys.map(function(e){return e+": "+(""+t.get(e))}).join(", ")+" }]"};e.prototype.observe=function(e,t){false&&false;return re(this,e)};e.prototype.intercept=function(e){return $(this,e)};return e}();Ze($e.prototype,function(){return this.entries()});Vt($e.prototype,typeof Symbol!=="undefined"?Symbol.toStringTag:"@@toStringTag","Map");var et=Ut("ObservableMap",$e);function tt(e,t){if(typeof e==="object"&&e!==null){if(Ct(e)){if(t!==undefined)St(false&&false);return e.$mobx.atom}if(et(e)){var r=e;if(t===undefined)return tt(r._keys);var i=r._data.get(t)||r._hasMap.get(t);if(!i)St(false&&false);return i}c(e);if(t&&!e.$mobx)e[t];if(_e(e)){if(!t)return St(false&&false);var i=e.$mobx.values[t];if(!i)St(false&&false);return i}if(lt(e)||Q(e)||jr(e)){return e}}else if(typeof e==="function"){if(jr(e.$mobx)){return e.$mobx}}return St(false&&false)}function rt(e,t){if(!e)St("Expecting some object");if(t!==undefined)return rt(tt(e,t));if(lt(e)||Q(e)||jr(e))return e;if(et(e))return e;c(e);if(e.$mobx)return e.$mobx;St(false&&false)}function it(e,t){var r;if(t!==undefined)r=tt(e,t);else if(_e(e)||et(e))r=rt(e);else r=tt(e);return r.name}function nt(e,t,r){return ot("onBecomeObserved",e,t,r)}function at(e,t,r){return ot("onBecomeUnobserved",e,t,r)}function ot(e,t,r,i){var n=typeof r==="string"?tt(t,r):tt(t);var a=typeof r==="string"?i:r;var o=n[e];if(typeof o!=="function")return St(false&&false);n[e]=function(){o.call(this);a.call(this)};return function(){n[e]=o}}var st;var lt;function ut(){if(st)return;st=function(){function e(e){if(e===void 0){e="Atom@"+Et()}this.name=e;this.isPendingUnobservation=false;this.isBeingObserved=false;this.observers=[];this.observersIndexes={};this.diffValue=0;this.lastAccessedBy=0;this.lowestObserverState=br.NOT_TRACKING}e.prototype.onBecomeUnobserved=function(){};e.prototype.onBecomeObserved=function(){};e.prototype.reportObserved=function(){return mr(this)};e.prototype.reportChanged=function(){pr();_r(this);vr()};e.prototype.toString=function(){return this.name};return e}();lt=Ut("Atom",st)}function dt(e,t,r){if(t===void 0){t=It}if(r===void 0){r=It}var i=new st(e);nt(i,t);at(i,r);return i}var ct=1e4;var ft=function(){var e=false;var t={};Object.defineProperty(t,"0",{set:function(){e=true}});Object.create(t)["0"]=1;return e===false}();var ht=0;var pt=function(){function e(){}return e}();function vt(e,t){if(typeof Object["setPrototypeOf"]!=="undefined"){Object["setPrototypeOf"](e.prototype,t)}else if(typeof e.prototype.__proto__!=="undefined"){e.prototype.__proto__=t}else{e["prototype"]=t}}vt(pt,Array.prototype);if(Object.isFrozen(Array)){["constructor","push","shift","concat","pop","unshift","replace","find","findIndex","splice","reverse","sort"].forEach(function(e){Object.defineProperty(pt.prototype,e,{configurable:true,writable:true,value:Array.prototype[e]})})}var mt=function(){function e(r,i,e,t){this.array=e;this.owned=t;this.values=[];this.lastKnownLength=0;this.atom=new st(r||"ObservableArray@"+Et());this.enhancer=function(e,t){return i(e,t,r+"[..]")}}e.prototype.dehanceValue=function(e){if(this.dehancer!==undefined)return this.dehancer(e);return e};e.prototype.dehanceValues=function(e){if(this.dehancer!==undefined&&e.length>0)return e.map(this.dehancer);return e};e.prototype.intercept=function(e){return $(this,e)};e.prototype.observe=function(e,t){if(t===void 0){t=false}if(t){e({object:this.array,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0})}return re(this,e)};e.prototype.getArrayLength=function(){this.atom.reportObserved();return this.values.length};e.prototype.setArrayLength=function(e){if(typeof e!=="number"||e<0)throw new Error("[mobx.array] Out of range: "+e);var t=this.values.length;if(e===t)return;else if(e>t){var r=new Array(e-t);for(var i=0;i<e-t;i++)r[i]=undefined;this.spliceWithArray(t,0,r)}else this.spliceWithArray(e,t-e)};e.prototype.updateArrayLength=function(e,t){if(e!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?");this.lastKnownLength+=t;if(t>0&&e+t+1>ht)Ft(e+t+1)};e.prototype.spliceWithArray=function(e,t,r){var i=this;Er(this.atom);var n=this.values.length;if(e===undefined)e=0;else if(e>n)e=n;else if(e<0)e=Math.max(0,n+e);if(arguments.length===1)t=n-e;else if(t===undefined||t===null)t=0;else t=Math.max(0,Math.min(t,n-e));if(r===undefined)r=Pt;if(K(this)){var a=ee(this,{object:this.array,type:"splice",index:e,removedCount:t,added:r});if(!a)return Pt;t=a.removedCount;r=a.added}r=r.length===0?r:r.map(function(e){return i.enhancer(e,undefined)});var o=r.length-t;this.updateArrayLength(n,o);var s=this.spliceItemsIntoValues(e,t,r);if(t!==0||r.length!==0)this.notifyArraySplice(e,r,s);return this.dehanceValues(s)};e.prototype.spliceItemsIntoValues=function(e,t,r){var i;if(r.length<ct){return(i=this.values).splice.apply(i,o([e,t],r))}else{var n=this.values.slice(e,e+t);this.values=this.values.slice(0,e).concat(r,this.values.slice(e+t));return n}};e.prototype.notifyArrayChildUpdate=function(e,t,r){var i=!this.owned&&p();var n=te(this);var a=n||i?{object:this.array,type:"update",index:e,newValue:t,oldValue:r}:null;if(i)m(u({},a,{name:this.atom.name}));this.atom.reportChanged();if(n)ie(this,a);if(i)y()};e.prototype.notifyArraySplice=function(e,t,r){var i=!this.owned&&p();var n=te(this);var a=n||i?{object:this.array,type:"splice",index:e,removed:r,added:t,removedCount:r.length,addedCount:t.length}:null;if(i)m(u({},a,{name:this.atom.name}));this.atom.reportChanged();if(n)ie(this,a);if(i)y()};return e}();var _t=function(s){n(e,s);function e(e,t,r,i){if(r===void 0){r="ObservableArray@"+Et()}if(i===void 0){i=false}var n=s.call(this)||this;var a=new mt(r,t,n,i);Vt(n,"$mobx",a);if(e&&e.length){var o=x(true);n.spliceWithArray(0,0,e);P(o)}if(ft){Object.defineProperty(a.array,"0",yt)}return n}e.prototype.intercept=function(e){return this.$mobx.intercept(e)};e.prototype.observe=function(e,t){if(t===void 0){t=false}return this.$mobx.observe(e,t)};e.prototype.clear=function(){return this.splice(0)};e.prototype.concat=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}this.$mobx.atom.reportObserved();return Array.prototype.concat.apply(this.peek(),e.map(function(e){return Ct(e)?e.peek():e}))};e.prototype.replace=function(e){return this.$mobx.spliceWithArray(0,this.$mobx.values.length,e)};e.prototype.toJS=function(){return this.slice()};e.prototype.toJSON=function(){return this.toJS()};e.prototype.peek=function(){this.$mobx.atom.reportObserved();return this.$mobx.dehanceValues(this.$mobx.values)};e.prototype.find=function(e,t,r){if(r===void 0){r=0}if(arguments.length===3)Lt("The array.find fromIndex argument to find will not be supported anymore in the next major");var i=this.findIndex.apply(this,arguments);return i===-1?undefined:this.get(i)};e.prototype.findIndex=function(e,t,r){if(r===void 0){r=0}if(arguments.length===3)Lt("The array.findIndex fromIndex argument to find will not be supported anymore in the next major");var i=this.peek(),n=i.length;for(var a=r;a<n;a++)if(e.call(t,i[a],a,this))return a;return-1};e.prototype.splice=function(e,t){var r=[];for(var i=2;i<arguments.length;i++){r[i-2]=arguments[i]}switch(arguments.length){case 0:return[];case 1:return this.$mobx.spliceWithArray(e);case 2:return this.$mobx.spliceWithArray(e,t)}return this.$mobx.spliceWithArray(e,t,r)};e.prototype.spliceWithArray=function(e,t,r){return this.$mobx.spliceWithArray(e,t,r)};e.prototype.push=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=this.$mobx;r.spliceWithArray(r.values.length,0,e);return r.values.length};e.prototype.pop=function(){return this.splice(Math.max(this.$mobx.values.length-1,0),1)[0]};e.prototype.shift=function(){return this.splice(0,1)[0]};e.prototype.unshift=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=this.$mobx;r.spliceWithArray(0,0,e);return r.values.length};e.prototype.reverse=function(){var e=this.slice();return e.reverse.apply(e,arguments)};e.prototype.sort=function(e){var t=this.slice();return t.sort.apply(t,arguments)};e.prototype.remove=function(e){var t=this.$mobx.dehanceValues(this.$mobx.values).indexOf(e);if(t>-1){this.splice(t,1);return true}return false};e.prototype.move=function(e,t){Lt("observableArray.move is deprecated, use .slice() & .replace() instead");function r(e){if(e<0){throw new Error("[mobx.array] Index out of bounds: "+e+" is negative")}var t=this.$mobx.values.length;if(e>=t){throw new Error("[mobx.array] Index out of bounds: "+e+" is not smaller than "+t)}}r.call(this,e);r.call(this,t);if(e===t){return}var i=this.$mobx.values;var n;if(e<t){n=o(i.slice(0,e),i.slice(e+1,t+1),[i[e]],i.slice(t+1))}else{n=o(i.slice(0,t),[i[e]],i.slice(t,e),i.slice(e+1))}this.replace(n)};e.prototype.get=function(e){var t=this.$mobx;if(t){if(e<t.values.length){t.atom.reportObserved();return t.dehanceValue(t.values[e])}console.warn("[mobx.array] Attempt to read an array index ("+e+") that is out of bounds ("+t.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}return undefined};e.prototype.set=function(e,t){var r=this.$mobx;var i=r.values;if(e<i.length){Er(r.atom);var n=i[e];if(K(r)){var a=ee(r,{type:"update",object:this,index:e,newValue:t});if(!a)return;t=a.newValue}t=r.enhancer(t,n);var o=t!==n;if(o){i[e]=t;r.notifyArrayChildUpdate(e,t,n)}}else if(e===i.length){r.spliceWithArray(e,0,[t])}else{throw new Error("[mobx.array] Index out of bounds, "+e+" is larger than "+i.length)}};return e}(pt);Ze(_t.prototype,function(){this.$mobx.atom.reportObserved();var e=this;var t=0;return Ye({next:function(){return t<e.length?{value:e[t++],done:false}:{done:true,value:undefined}}})});Object.defineProperty(_t.prototype,"length",{enumerable:false,configurable:true,get:function(){return this.$mobx.getArrayLength()},set:function(e){this.$mobx.setArrayLength(e)}});if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Ht(_t.prototype,typeof Symbol!=="undefined"?Symbol.toStringTag:"@@toStringTag","Array")}["every","filter","forEach","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toString","toLocaleString"].forEach(function(e){var t=Array.prototype[e];At(typeof t==="function","Base function not defined on Array prototype: '"+e+"'");Ht(_t.prototype,e,function(){return t.apply(this.peek(),arguments)})});Bt(_t.prototype,["constructor","intercept","observe","clear","concat","get","replace","toJS","toJSON","peek","find","findIndex","splice","spliceWithArray","push","pop","set","shift","unshift","reverse","sort","remove","move","toString","toLocaleString"]);var yt=gt(0);function gt(t){return{enumerable:false,configurable:false,get:function(){return this.get(t)},set:function(e){this.set(t,e)}}}function wt(e){Object.defineProperty(_t.prototype,""+e,gt(e))}function Ft(e){for(var t=ht;t<e;t++)wt(t);ht=e}Ft(1e3);var bt=Ut("ObservableArrayAdministration",mt);function Ct(e){return Ot(e)&&bt(e.$mobx)}var xt="An invariant failed, however the error is obfuscated because this is an production build.";var Pt=[];Object.freeze(Pt);var Mt={};Object.freeze(Mt);function Tt(){return typeof window!=="undefined"?window:t}function Et(){return++tr.mobxGuid}function St(e){At(false,e);throw"X"}function At(e,t){if(!e)throw new Error("[mobx] "+(t||xt))}var kt=[];function Lt(e,t){if(true)return false;if(t){return Lt("'"+e+"', use '"+t+"' instead.")}if(kt.indexOf(e)!==-1)return false;kt.push(e);console.error("[mobx] Deprecated: "+e);return true}function Dt(e){var t=false;return function(){if(t)return;t=true;return e.apply(this,arguments)}}var It=function(){};function Rt(e){var t=[];e.forEach(function(e){if(t.indexOf(e)===-1)t.push(e)});return t}function Ot(e){return e!==null&&typeof e==="object"}function Nt(e){if(e===null||typeof e!=="object")return false;var t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}function Bt(e,t){for(var r=0;r<t.length;r++){Ht(e,t[r],e[t[r]])}}function Ht(e,t,r){Object.defineProperty(e,t,{enumerable:false,writable:true,configurable:true,value:r})}function Vt(e,t,r){Object.defineProperty(e,t,{enumerable:false,writable:false,configurable:true,value:r})}function Gt(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!r||r.configurable!==false&&r.writable!==false}function zt(e,t){if(false){}}function Ut(e,t){var r="isMobX"+e;t.prototype[r]=true;return function(e){return Ot(e)&&e[r]===true}}function jt(e,t){return typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}function qt(e){return Array.isArray(e)||Ct(e)}function Wt(e){if(Tt().Map!==undefined&&e instanceof Tt().Map)return true;return false}function Xt(e){if(Nt(e))return Object.keys(e);if(Array.isArray(e))return e.map(function(e){var t=a(e,1),r=t[0];return r});if(Wt(e)||et(e))return Zt(e.keys());return St("Cannot get keys from '"+e+"'")}function Zt(e){var t=[];while(true){var r=e.next();if(r.done)break;t.push(r.value)}return t}function Yt(){return typeof Symbol==="function"&&Symbol.toPrimitive||"@@toPrimitive"}function Jt(e){return e===null?null:typeof e==="object"?""+e:e}var Qt=["mobxGuid","spyListeners","enforceActions","computedRequiresReaction","disableErrorBoundaries","runId","UNCHANGED"];var Kt=function(){function e(){this.version=5;this.UNCHANGED={};this.trackingDerivation=null;this.computationDepth=0;this.runId=0;this.mobxGuid=0;this.inBatch=0;this.pendingUnobservations=[];this.pendingReactions=[];this.isRunningReactions=false;this.allowStateChanges=true;this.enforceActions=false;this.spyListeners=[];this.globalReactionErrorHandlers=[];this.computedRequiresReaction=false;this.disableErrorBoundaries=false}return e}();var $t=true;var er=false;var tr=function(){var e=Tt();if(e.__mobxInstanceCount>0&&!e.__mobxGlobals)$t=false;if(e.__mobxGlobals&&e.__mobxGlobals.version!==(new Kt).version)$t=false;if(!$t){setTimeout(function(){if(!er){St("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")}},1);return new Kt}else if(e.__mobxGlobals){e.__mobxInstanceCount+=1;if(!e.__mobxGlobals.UNCHANGED)e.__mobxGlobals.UNCHANGED={};return e.__mobxGlobals}else{e.__mobxInstanceCount=1;return e.__mobxGlobals=new Kt}}();function rr(){if(tr.pendingReactions.length||tr.inBatch||tr.isRunningReactions)St("isolateGlobalState should be called before MobX is running any reactions");er=true;if($t){if(--Tt().__mobxInstanceCount===0)Tt().__mobxGlobals=undefined;tr=new Kt}}function ir(){return tr}function nr(){var e=new Kt;for(var t in e)if(Qt.indexOf(t)===-1)tr[t]=e[t];tr.allowStateChanges=!tr.enforceActions}function ar(e,t){return or(tt(e,t))}function or(e){var t={name:e.name};if(e.observing&&e.observing.length>0)t.dependencies=Rt(e.observing).map(or);return t}function sr(e,t){return lr(tt(e,t))}function lr(e){var t={name:e.name};if(ur(e))t.observers=dr(e).map(lr);return t}function ur(e){return e.observers&&e.observers.length>0}function dr(e){return e.observers}function cr(e,t){var r=e.observers.length;if(r){e.observersIndexes[t.__mapid]=r}e.observers[r]=t;if(e.lowestObserverState>t.dependenciesState)e.lowestObserverState=t.dependenciesState}function fr(e,t){if(e.observers.length===1){e.observers.length=0;hr(e)}else{var r=e.observers;var i=e.observersIndexes;var n=r.pop();if(n!==t){var a=i[t.__mapid]||0;if(a){i[n.__mapid]=a}else{delete i[n.__mapid]}r[a]=n}delete i[t.__mapid]}}function hr(e){if(e.isPendingUnobservation===false){e.isPendingUnobservation=true;tr.pendingUnobservations.push(e)}}function pr(){tr.inBatch++}function vr(){if(--tr.inBatch===0){zr();var e=tr.pendingUnobservations;for(var t=0;t<e.length;t++){var r=e[t];r.isPendingUnobservation=false;if(r.observers.length===0){if(r.isBeingObserved){r.isBeingObserved=false;r.onBecomeUnobserved()}if(r instanceof J){r.suspend()}}}tr.pendingUnobservations=[]}}function mr(e){var t=tr.trackingDerivation;if(t!==null){if(t.runId!==e.lastAccessedBy){e.lastAccessedBy=t.runId;t.newObserving[t.unboundDepsCount++]=e;if(!e.isBeingObserved){e.isBeingObserved=true;e.onBecomeObserved()}}return true}else if(e.observers.length===0&&tr.inBatch>0){hr(e)}return false}function _r(e){if(e.lowestObserverState===br.STALE)return;e.lowestObserverState=br.STALE;var t=e.observers;var r=t.length;while(r--){var i=t[r];if(i.dependenciesState===br.UP_TO_DATE){if(i.isTracing!==Cr.NONE){wr(i,e)}i.onBecomeStale()}i.dependenciesState=br.STALE}}function yr(e){if(e.lowestObserverState===br.STALE)return;e.lowestObserverState=br.STALE;var t=e.observers;var r=t.length;while(r--){var i=t[r];if(i.dependenciesState===br.POSSIBLY_STALE)i.dependenciesState=br.STALE;else if(i.dependenciesState===br.UP_TO_DATE)e.lowestObserverState=br.UP_TO_DATE}}function gr(e){if(e.lowestObserverState!==br.UP_TO_DATE)return;e.lowestObserverState=br.POSSIBLY_STALE;var t=e.observers;var r=t.length;while(r--){var i=t[r];if(i.dependenciesState===br.UP_TO_DATE){i.dependenciesState=br.POSSIBLY_STALE;if(i.isTracing!==Cr.NONE){wr(i,e)}i.onBecomeStale()}}}function wr(e,t){console.log("[mobx.trace] '"+e.name+"' is invalidated due to a change in: '"+t.name+"'");if(e.isTracing===Cr.BREAK){var r=[];Fr(ar(e),r,1);new Function("debugger;\n/*\nTracing '"+e.name+"'\n\nYou are entering this break point because derivation '"+e.name+"' is being traced and '"+t.name+"' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n"+(e instanceof J?e.derivation.toString():"")+"\n\nThe dependencies for this derivation are:\n\n"+r.join("\n")+"\n*/\n    ")()}}function Fr(e,t,r){if(t.length>=1e3){t.push("(and many more)");return}t.push(""+new Array(r).join("\t")+e.name);if(e.dependencies)e.dependencies.forEach(function(e){return Fr(e,t,r+1)})}var br;(function(e){e[e["NOT_TRACKING"]=-1]="NOT_TRACKING";e[e["UP_TO_DATE"]=0]="UP_TO_DATE";e[e["POSSIBLY_STALE"]=1]="POSSIBLY_STALE";e[e["STALE"]=2]="STALE"})(br||(br={}));var Cr;(function(e){e[e["NONE"]=0]="NONE";e[e["LOG"]=1]="LOG";e[e["BREAK"]=2]="BREAK"})(Cr||(Cr={}));var xr=function(){function e(e){this.cause=e}return e}();function Pr(e){return e instanceof xr}function Mr(e){switch(e.dependenciesState){case br.UP_TO_DATE:return false;case br.NOT_TRACKING:case br.STALE:return true;case br.POSSIBLY_STALE:{var t=Dr();var r=e.observing,i=r.length;for(var n=0;n<i;n++){var a=r[n];if(Q(a)){if(tr.disableErrorBoundaries){a.get()}else{try{a.get()}catch(e){Ir(t);return true}}if(e.dependenciesState===br.STALE){Ir(t);return true}}}Rr(e);Ir(t);return false}}}function Tr(){return tr.trackingDerivation!==null}function Er(e){var t=e.observers.length>0;if(tr.computationDepth>0&&t)St(false&&false);if(!tr.allowStateChanges&&(t||tr.enforceActions==="strict"))St(false&&false)}function Sr(e,t,r){Rr(e);e.newObserving=new Array(e.observing.length+100);e.unboundDepsCount=0;e.runId=++tr.runId;var i=tr.trackingDerivation;tr.trackingDerivation=e;var n;if(tr.disableErrorBoundaries===true){n=t.call(r)}else{try{n=t.call(r)}catch(e){n=new xr(e)}}tr.trackingDerivation=i;Ar(e);return n}function Ar(e){var t=e.observing;var r=e.observing=e.newObserving;var i=br.UP_TO_DATE;var n=0,a=e.unboundDepsCount;for(var o=0;o<a;o++){var s=r[o];if(s.diffValue===0){s.diffValue=1;if(n!==o)r[n]=s;n++}if(s.dependenciesState>i){i=s.dependenciesState}}r.length=n;e.newObserving=null;a=t.length;while(a--){var s=t[a];if(s.diffValue===0){fr(s,e)}s.diffValue=0}while(n--){var s=r[n];if(s.diffValue===1){s.diffValue=0;cr(s,e)}}if(i!==br.UP_TO_DATE){e.dependenciesState=i;e.onBecomeStale()}}function kr(e){var t=e.observing;e.observing=[];var r=t.length;while(r--)fr(t[r],e);e.dependenciesState=br.NOT_TRACKING}function Lr(e){var t=Dr();var r=e();Ir(t);return r}function Dr(){var e=tr.trackingDerivation;tr.trackingDerivation=null;return e}function Ir(e){tr.trackingDerivation=e}function Rr(e){if(e.dependenciesState===br.UP_TO_DATE)return;e.dependenciesState=br.UP_TO_DATE;var t=e.observing;var r=t.length;while(r--)t[r].lowestObserverState=br.UP_TO_DATE}function Or(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=false;if(typeof e[e.length-1]==="boolean")r=e.pop();var i=Nr(e);if(!i){return St(false&&false)}if(i.isTracing===Cr.NONE){console.log("[mobx.trace] '"+i.name+"' tracing enabled")}i.isTracing=r?Cr.BREAK:Cr.LOG}function Nr(e){switch(e.length){case 0:return tr.trackingDerivation;case 1:return tt(e[0]);case 2:return tt(e[0],e[1])}}var Br=function(){function e(e,t,r){if(e===void 0){e="Reaction@"+Et()}this.name=e;this.onInvalidate=t;this.errorHandler=r;this.observing=[];this.newObserving=[];this.dependenciesState=br.NOT_TRACKING;this.diffValue=0;this.runId=0;this.unboundDepsCount=0;this.__mapid="#"+Et();this.isDisposed=false;this._isScheduled=false;this._isTrackPending=false;this._isRunning=false;this.isTracing=Cr.NONE}e.prototype.onBecomeStale=function(){this.schedule()};e.prototype.schedule=function(){if(!this._isScheduled){this._isScheduled=true;tr.pendingReactions.push(this);zr()}};e.prototype.isScheduled=function(){return this._isScheduled};e.prototype.runReaction=function(){if(!this.isDisposed){pr();this._isScheduled=false;if(Mr(this)){this._isTrackPending=true;try{this.onInvalidate();if(this._isTrackPending&&p()){v({name:this.name,type:"scheduled-reaction"})}}catch(e){this.reportExceptionInDerivation(e)}}vr()}};e.prototype.track=function(e){pr();var t=p();var r;if(t){r=Date.now();m({name:this.name,type:"reaction"})}this._isRunning=true;var i=Sr(this,e,undefined);this._isRunning=false;this._isTrackPending=false;if(this.isDisposed){kr(this)}if(Pr(i))this.reportExceptionInDerivation(i.cause);if(t){y({time:Date.now()-r})}vr()};e.prototype.reportExceptionInDerivation=function(t){var r=this;if(this.errorHandler){this.errorHandler(t,this);return}if(tr.disableErrorBoundaries)throw t;var e="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this;console.error(e,t);if(p()){v({type:"error",name:this.name,message:e,error:""+t})}tr.globalReactionErrorHandlers.forEach(function(e){return e(t,r)})};e.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;if(!this._isRunning){pr();kr(this);vr()}}};e.prototype.getDisposer=function(){var e=this.dispose.bind(this);e.$mobx=this;return e};e.prototype.toString=function(){return"Reaction["+this.name+"]"};e.prototype.trace=function(e){if(e===void 0){e=false}Or(this,e)};return e}();function Hr(t){tr.globalReactionErrorHandlers.push(t);return function(){var e=tr.globalReactionErrorHandlers.indexOf(t);if(e>=0)tr.globalReactionErrorHandlers.splice(e,1)}}var Vr=100;var Gr=function(e){return e()};function zr(){if(tr.inBatch>0||tr.isRunningReactions)return;Gr(Ur)}function Ur(){tr.isRunningReactions=true;var e=tr.pendingReactions;var t=0;while(e.length>0){if(++t===Vr){console.error("Reaction doesn't converge to a stable state after "+Vr+" iterations."+(" Probably there is a cycle in the reactive function: "+e[0]));e.splice(0)}var r=e.splice(0);for(var i=0,n=r.length;i<n;i++)r[i].runReaction()}tr.isRunningReactions=false}var jr=Ut("Reaction",Br);function qr(t){var r=Gr;Gr=function(e){return t(function(){return r(e)})}}function Wr(e,t,r,i){if(typeof r==="function")return Zr(e,t,r,i);else return Xr(e,t,r)}function Xr(e,t,r){return rt(e).observe(t,r)}function Zr(e,t,r,i){return rt(e,t).observe(r,i)}function Yr(e,t,r){if(typeof r==="function")return Qr(e,t,r);else return Jr(e,t)}function Jr(e,t){return rt(e).intercept(t)}function Qr(e,t,r){return rt(e,t).intercept(r)}function Kr(e,t,r){if(arguments.length===1||t&&typeof t==="object")return ei(e,t);return $r(e,t,r||{})}function $r(t,e,r){var i;if(typeof r.timeout==="number"){i=setTimeout(function(){if(!a.$mobx.isDisposed){a();var e=new Error("WHEN_TIMEOUT");if(r.onError)r.onError(e);else throw e}},r.timeout)}r.name=r.name||"When@"+Et();var n=g(r.name+"-effect",e);var a=q(function(e){if(t()){e.dispose();if(i)clearTimeout(i);n()}},r);return a}function ei(i,n){if(false){}var a;var e=new Promise(function(e,t){var r=$r(i,e,u({},n,{onError:t}));a=function(){r();t("WHEN_CANCELLED")}});e.cancel=a;return e}function ti(e){if(_e(e)){return e.$mobx.getKeys()}if(et(e)){return e._keys.slice()}if(Ct(e)){return e.map(function(e,t){return t})}return St(false&&false)}function ri(t){if(_e(t)){return ti(t).map(function(e){return t[e]})}if(et(t)){return ti(t).map(function(e){return t.get(e)})}if(Ct(t)){return t.slice()}return St(false&&false)}function ii(t){if(_e(t)){return ti(t).map(function(e){return[e,t[e]]})}if(et(t)){return ti(t).map(function(e){return[e,t.get(e)]})}if(Ct(t)){return t.map(function(e,t){return[t,e]})}return St(false&&false)}function ni(e,t,r){if(arguments.length===2){pr();var i=t;try{for(var n in i)ni(e,n,i[n])}finally{vr()}return}if(_e(e)){var a=e.$mobx;var o=a.values[t];if(o){a.write(e,t,r)}else{le(e,t,r,a.defaultEnhancer)}}else if(et(e)){e.set(t,r)}else if(Ct(e)){if(typeof t!=="number")t=parseInt(t,10);At(t>=0,"Not a valid index: '"+t+"'");pr();if(t>=e.length)e.length=t+1;e[t]=r;vr()}else{return St(false&&false)}}function ai(e,t){if(_e(e)){e.$mobx.remove(t)}else if(et(e)){e.delete(t)}else if(Ct(e)){if(typeof t!=="number")t=parseInt(t,10);At(t>=0,"Not a valid index: '"+t+"'");e.splice(t,1)}else{return St(false&&false)}}function oi(e,t){if(_e(e)){var r=rt(e);r.getKeys();return!!r.values[t]}else if(et(e)){return e.has(t)}else if(Ct(e)){return t>=0&&t<e.length}else{return St(false&&false)}}function si(e,t){if(!oi(e,t))return undefined;if(_e(e)){return e[t]}else if(et(e)){return e.get(t)}else if(Ct(e)){return e[t]}else{return St(false&&false)}}function li(e,n){false&&false;var a=typeof e==="function"?e.prototype:e;var t=function(r){var e=n[r];if(!Array.isArray(e)){e=[e]}false&&false;var t=Object.getOwnPropertyDescriptor(a,r);var i=e.reduce(function(e,t){return t(a,r,e)},t);if(i)Object.defineProperty(a,r,i)};for(var r in n){t(r)}return e}function ui(e){var t=e.enforceActions,r=e.computedRequiresReaction,i=e.disableErrorBoundaries,n=e.arrayBuffer,a=e.reactionScheduler;if(t!==undefined){if(typeof t==="boolean"||t==="strict")Lt("Deprecated value for 'enforceActions', use 'false' => '\"never\"', 'true' => '\"observed\"', '\"strict\"' => \"'always'\" instead");var o=void 0;switch(t){case true:case"observed":o=true;break;case false:case"never":o=false;break;case"strict":case"always":o="strict";break;default:fail("Invalid value for 'enforceActions': '"+t+"', expected 'never', 'always' or 'observed'")}tr.enforceActions=o;tr.allowStateChanges=o===true||o==="strict"?false:true}if(r!==undefined){tr.computedRequiresReaction=!!r}if(e.isolateGlobalState===true){rr()}if(i!==undefined){if(i===true)console.warn("WARNING: Debug feature only. MobX will NOT recover from errors if this is on.");tr.disableErrorBoundaries=!!i}if(typeof n==="number"){Ft(n)}if(a){qr(a)}}var di=0;function ci(i){if(arguments.length!==1)St(true&&"Flow expects one 1 argument and cannot be used as decorator");var c=i.name||"<unnamed flow>";return function(){var e=this;var t=arguments;var s=++di;var l=k(c+" - runid: "+s+" - init",i).apply(e,t);var u;var d=undefined;var r=new Promise(function(t,r){var i=0;u=r;function n(e){d=undefined;var t;try{t=k(c+" - runid: "+s+" - yield "+i++,l.next).call(l,e)}catch(e){return r(e)}o(t)}function a(e){d=undefined;var t;try{t=k(c+" - runid: "+s+" - yield "+i++,l.throw).call(l,e)}catch(e){return r(e)}o(t)}function o(e){if(e&&typeof e.then==="function"){e.then(o,r);return}if(e.done)return t(e.value);d=Promise.resolve(e.value);return d.then(n,a)}n(undefined)});r.cancel=k(c+" - runid: "+s+" - cancel",function(){try{if(d)fi(d);var e=l.return();var t=Promise.resolve(e.value);t.then(It,It);fi(t);u(new Error("FLOW_CANCELLED"))}catch(e){u(e)}});return r}}function fi(e){if(typeof e.cancel==="function")e.cancel()}var hi={detectCycles:true,exportMapsAsObjects:true,recurseEverything:false};function pi(e,t,r,i){if(i.detectCycles)e.set(t,r);return r}function vi(e,r,i){if(!r.recurseEverything&&!we(e))return e;if(typeof e!=="object")return e;if(e===null)return null;if(e instanceof Date)return e;if(ae(e))return vi(e.get(),r,i);if(we(e))ti(e);var t=r.detectCycles===true;if(t&&e!==null&&i.has(e)){return i.get(e)}if(Ct(e)||Array.isArray(e)){var n=pi(i,e,[],r);var a=e.map(function(e){return vi(e,r,i)});n.length=a.length;for(var o=0,s=a.length;o<s;o++)n[o]=a[o];return n}if(et(e)||Object.getPrototypeOf(e)===Map.prototype){if(r.exportMapsAsObjects===false){var l=pi(i,e,new Map,r);e.forEach(function(e,t){l.set(t,vi(e,r,i))});return l}else{var u=pi(i,e,{},r);e.forEach(function(e,t){u[t]=vi(e,r,i)});return u}}var d=pi(i,e,{},r);for(var c in e){d[c]=vi(e[c],r,i)}return d}function mi(e,t){if(typeof t==="boolean")t={detectCycles:t};if(!t)t=hi;t.detectCycles=t.detectCycles===undefined?t.recurseEverything===true:t.detectCycles===true;var r;if(t.detectCycles)r=new Map;return vi(e,t,r)}function _i(e,t,r){var i;if(et(e)||Ct(e)||ae(e)){i=rt(e)}else if(_e(e)){if(typeof t!=="string")return St(false&&false);i=rt(e,t)}else{return St(false&&false)}if(i.dehancer!==undefined)return St(false&&false);i.dehancer=typeof t==="function"?t:r;return function(){i.dehancer=undefined}}try{"production"}catch(e){var yi=typeof window!=="undefined"?window:t;if(typeof r==="undefined")yi.process={};yi.process.env={}}if(typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__==="object"){__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:e,extras:{getDebugName:it}})}if(false){var gi}var wi="$mobx"}).call(this,bi(234),bi(73))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e){var t=typeof e==="undefined"?undefined:Freedo.Math.toDegrees(e);return Freedo.FdMisc.FdMath.round(t,6)}function s(e){var t=e.positionCartographic;return[i(t.longitude),i(t.latitude),Freedo.FdMisc.FdMath.round(t.height,2),i(e.heading),i(e.pitch),i(e.roll)]}function n(e,t,r){if(!Freedo.defined(e)){console.error("camera未定义");return}var i=s(e);if(!_.isEqual(i,t)){var n=t;var a;if(!Freedo.Matrix4.equals(e.transform,Freedo.Matrix4.IDENTITY)){a=Freedo.Matrix4.clone(e.transform,a);e.lookAtTransform(Freedo.Matrix4.IDENTITY)}var o;if(typeof r==="undefined"){o={}}else{o=Freedo.clone(r,true)}o.destination=Freedo.Cartesian3.fromDegrees(n[0],n[1],n[2]);o.orientation={heading:Freedo.Math.toRadians(n[3]),pitch:Freedo.Math.toRadians(n[4]),roll:Freedo.Math.toRadians(n[5])};if(typeof a!=="undefined"&&typeof o.endTransform==="undefined"){o.endTransform=a}e.flyTo(o);return true}else{return false}}function a(e,t){var r=s(e);if(!_.isEqual(r,t)){var i=t;var n;if(!Freedo.Matrix4.equals(e.transform,Freedo.Matrix4.IDENTITY)){n=Freedo.Matrix4.clone(e.transform,n);e.lookAtTransform(Freedo.Matrix4.IDENTITY)}e.setView({destination:Freedo.Cartesian3.fromDegrees(i[0],i[1],i[2]),orientation:{heading:Freedo.Math.toRadians(i[3]),pitch:Freedo.Math.toRadians(i[4]),roll:Freedo.Math.toRadians(i[5])}});if(typeof n!=="undefined"){e.lookAtTransform(n)}return true}else{return false}}function o(e,t,r){r=Freedo.defaultValue(r,100);var i=Freedo.FdMisc.FdGeometric.tc(t);var n=new Freedo.BoundingSphere(i,r);e.flyToBoundingSphere(n,{duration:0})}function l(e,t,r){r=Freedo.defaultValue(r,100);var i=Freedo.FdMisc.FdGeometric.tc(t);var n=new Freedo.BoundingSphere(i,r);e.flyToBoundingSphere(n)}function u(r){var n=r.viewer;var a=[];var o=[];var s=r.coordinate;var e=n.scene._canvas.clientWidth;var t=n.scene._canvas.clientHeight;var i=n.scene.cartesianToCanvasCoordinates(s);a[0]=new Freedo.Cartesian2(i.x,0);a[1]=new Freedo.Cartesian2(i.x,t);o[0]=new Freedo.Cartesian2(0,i.y);o[1]=new Freedo.Cartesian2(e,i.y);var l=function e(t){return n.scene.primitives.add(new Freedo.FdTools.FdScreenLine({scene:n.scene,coordinate:t,lineColor:r.lineColor}))};var u=function e(t,r){var i=Freedo.Cartesian2.subtract(r,t,new Freedo.Cartesian2);var n=new Freedo.Cartesian3(i.x,i.y,0);var a=Freedo.Matrix4.fromTranslation(n,new Freedo.Matrix4);return a};var d=l(a);var c=l(o);var f=function e(){var t=n.scene.cartesianToCanvasCoordinates(s);if(t){var r=new Freedo.Cartesian2(t.x,0);var i=new Freedo.Cartesian2(0,t.y);d._modelMatrix=u(a[0],r);c._modelMatrix=u(o[0],i)}};n.camera.changed.addEventListener(f);d._modelMatrix=u(a[0],new Freedo.Cartesian2(600,0));n.camera.flyTo({destination:r.destination,complete:function e(){setTimeout(function(){n.camera.changed.removeEventListener(f);d.hide();c.hide()},500)}})}t.getCurrentCameraInfo=s;t.flyToByCameraInfo=n;t.goToByCameraInfo=a;t.goToByPosition=o;t.flyToByPosition=l;t.screenLine=u},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){t.f=r(21)},function(e,t,r){var i=r(20);var n=r(13);var a=r(90);var o=r(168);var s=r(34).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=a?{}:i.Symbol||{});if(e.charAt(0)!="_"&&!(e in t))s(t,e,{value:o.f(e)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTransformHelper=undefined;var i=r(3);var L=d(i);var n=r(1);var a=d(n);var o=r(2);var s=d(o);var l=r(547);var u=r(5);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function t(e){(0,a.default)(this,t);this._viewer=e;this._bInTransform=false;this._transType="MOVE";this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._sceneSphere={};this._basePt=undefined;this._t12={TMoveX:0,TMoveY:0,TMoveZ:0,DMoveX:0,DMoveY:0,DMoveZ:0,THeading:0,TPitch:0,TRoll:0,TScaleX:1,TScaleY:1,TScaleZ:1,TBaseX:0,TBaseY:0,TBaseZ:0};this._aPModelSet=[];this._mani=new l.FdTransformManipulator(e);this._maniCallBack=undefined;this._mouseDown12Arg={};this._mouseDownMM=Freedo.Matrix4.IDENTITY;this._selectedAxis="";this._centerDis={};this._inMoveTo=false;this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3};this._axisZoom=1}(0,s.default)(t,[{key:"tranOptions",get:function e(){var t=[];var r=true;var i=false;var n=undefined;try{for(var a=(0,L.default)(this._aPModelSet),o;!(r=(o=a.next()).done);r=true){var s=o.value;t=s.modelMatrix}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}return{modelMatrix:t}},set:function e(t){if(!Freedo.defined(t)){return}var r=true;var i=false;var n=undefined;try{for(var a=(0,L.default)(this._aPModelSet),o;!(r=(o=a.next()).done);r=true){var s=o.value;s.modelMatrix=Freedo.clone(t.modelMatrix,true)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}}]);return t}();c.prototype.setData=function(e){this._aPModelSet=e};c.prototype.setModel=function(e){this._aPModelSet=e};c.prototype.addPModel=function(e){this._aPModelSet.push(e)};c.prototype.hideAxis=function(){this._transType=""};c.prototype.setAxisSize=function(e){this._mani.setAxisSize(e)};c.prototype.setArg=function(e,t){switch(e){case"basePtX":this._t12.TBaseX=t;break;case"basePtY":this._t12.TBaseY=t;break;case"basePtZ":this._t12.TBaseZ=t;break;case"translateX":this._t12.DMoveX=t;break;case"translateY":this._t12.DMoveY=t;break;case"translateZ":this._t12.DMoveZ=t;break;case"rotateX":this._t12.THeading=t;break;case"rotateY":this._t12.TPitch=t;break;case"rotateZ":this._t12.TRoll=t;break;case"scaleX":this._t12.TScaleX=t;break;case"scaleY":this._t12.TScaleY=t;break;case"scaleZ":this._t12.TScaleZ=t;break}this._t12.TMoveX=this._t12.TBaseX+this._t12.DMoveX;this._t12.TMoveY=this._t12.TBaseY+this._t12.DMoveY;this._t12.TMoveZ=this._t12.TBaseZ+this._t12.DMoveZ;var r=Freedo.Math.toRadians;var i=Freedo.Math.toDegrees;var n=this.getMatrix(r(this._t12.DMoveX),r(this._t12.DMoveY),this._t12.DMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,this._t12.TScaleX,this._t12.TScaleY,this._t12.TScaleZ,Freedo.Math.toRadians(this._t12.TBaseX),Freedo.Math.toRadians(this._t12.TBaseY),this._t12.TBaseZ);var a=Freedo.Cartesian3.fromDegrees(this._t12.TBaseX,this._t12.TBaseY,this._t12.TBaseZ);var o=Freedo.Matrix4.multiplyByPoint(n,a,new Freedo.Cartesian3);var s=Freedo.Cartographic.fromCartesian(o);this._t12.TMoveX=i(s.longitude);this._t12.TMoveY=i(s.latitude);this._t12.TMoveZ=s.height;this._mani.updatePosition(this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ);this._mani.updateBasePt(this._t12.TBaseX,this._t12.TBaseY,this._t12.TBaseZ);this._sceneSphere.center=Freedo.Cartesian3.fromDegrees(this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ)};c.prototype.getMatrix=function(e,t,r,i,n,a,o,s,l,u,d,c){var f=Freedo.Cartesian3.fromRadians(u,d,c);var h=Freedo.Cartesian3.fromRadians(u+e,d+t,c+r);i=Freedo.Math.toRadians(i);n=Freedo.Math.toRadians(n);a=Freedo.Math.toRadians(a);var p=Freedo.Quaternion.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(i,n,a));var v=new Freedo.Cartesian3(o,s,l);var m=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,p,v);var _=Freedo.Transforms.eastNorthUpToFixedFrame(f);var y=Freedo.Matrix4.inverse(_,new Freedo.Matrix4);var g=Freedo.Transforms.eastNorthUpToFixedFrame(h);var w=Freedo.Matrix4.multiply(m,y,new Freedo.Matrix4);var F=Freedo.Matrix4.multiply(g,w,new Freedo.Matrix4);return Freedo.clone(F,true)};c.prototype.getMatrixOfTileset=function(e,t,r,i,n,a,o,s,l,u,d,c,f){if(e===undefined){return}if(d===undefined){var h=this.getTilesetBasePt(e);d=h.longitude;c=h.latitude;f=h.height}var p=Freedo.Cartesian3.fromRadians(d,c,f);var v=Freedo.Cartesian3.fromRadians(d+t,c+r,f+i);n=Freedo.Math.toRadians(n);a=Freedo.Math.toRadians(a);o=Freedo.Math.toRadians(o);var m=Freedo.Quaternion.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(n,a,o));var _=new Freedo.Cartesian3(s,l,u);var y=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,m,_);var g=Freedo.Transforms.eastNorthUpToFixedFrame(p);var w=Freedo.Matrix4.inverse(g,new Freedo.Matrix4);var F=Freedo.Transforms.eastNorthUpToFixedFrame(v);var b=Freedo.Matrix4.multiply(y,w,new Freedo.Matrix4);var C=Freedo.Matrix4.multiply(F,b,new Freedo.Matrix4);return Freedo.clone(C,true)};c.prototype.startTransform=function(e,t){this._bInTransform=true;this._transType=e;if(this._aPModelSet.length>0){if(this.checkConflict())return;this._basePt=undefined;this.calcSceneBS();var r=true;var i=false;var n=undefined;try{for(var a=(0,L.default)(this._aPModelSet),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._mouseDownMat=Freedo.clone(s.modelMatrix,true)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}var l=this;this._maniCallBack=this._mani.on(function(e,t){if(e=="Transform"){l.onTransform()}if(e=="Transformed"){l.onTransformed()}if(e=="GotoPoint"){l.onGotoPoint(t)}if(e=="Transforming"){l.onTransforming(t)}});if(this._transType.indexOf("MOVETO")>=0)this._inMoveTo=true;this._mani.startTransform(this._transType);this._event.raiseEvent("Start",{});if(this._aPModelSet.length>0){this._mani.updateSceneSphere(this._sceneSphere);this._mani.updatePosition(this._basePt.longitude,this._basePt.latitude,this._basePt.height);this._mani.updateBasePt(this._basePt.longitude,this._basePt.latitude,this._basePt.height)}};c.prototype.start=function(e,t){this.startTransform(e,t)};c.prototype.getData=function(){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,L.default)(this._aPModelSet),a;!(t=(a=n.next()).done);t=true){var o=a.value;e.push({modelMatrix:Freedo.clone(o.modelMatrix,true),tileset:o})}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}return e};c.prototype.checkConflict=function(){var e=0;var t=0;var r=true;var i=false;var n=undefined;try{for(var a=(0,L.default)(this._aPModelSet),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=s["transformTime"];if(t==0){if(l===undefined)e=undefined;else e=Freedo.clone(l,true)}else{if(l!==e){alert("编辑状态存在冲突无法继续！");this.cancelTransform();return true}}t++}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}return false};c.prototype.initTransform=function(){var e=0;var t=0;var r=true;var i=false;var n=undefined;try{for(var a=(0,L.default)(this._aPModelSet),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=s["transformTime"];if(t==0){if(l===undefined)e=undefined;else e=Freedo.clone(l,true)}else{if(l!==e){console.log("部分模型存在变换，部分没有，请注意")}}t++}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}var u=true;var d=false;var c=undefined;try{for(var f=(0,L.default)(this._aPModelSet),h;!(u=(h=f.next()).done);u=true){var s=h.value;var e=s["transformTime"];if(e==undefined||e==0){this.resetTransform()}var l=s["transformMatrix"];if(l!==undefined){this._t12=Freedo.clone(l,true)}this._event.raiseEvent("InitTransform",Freedo.clone(this._t12,true))}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}};c.prototype.updateBasePt=function(){this._basePt={longitude:Freedo.Math.toRadians(this._t12.TMoveX),latitude:Freedo.Math.toRadians(this._t12.TMoveY),height:this._t12.TMoveZ}};c.prototype.getModelBS=function(e){var t=Freedo.Matrix4.getTranslation(e.modelMatrix,new Freedo.Cartesian3);var r=e.boundingSphere;var i=new Freedo.BoundingSphere(t,r.radius);return i};c.prototype.calcSceneBS=function(){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,L.default)(this._aPModelSet),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(o===undefined)console.log("FdTransform：无效数据");var s=o.boundingSphere;if(o instanceof Freedo.Model){s=this.getModelBS(o)}else if(o instanceof Freedo.Primitive){var l=Freedo.Matrix4.getTranslation(o.modelMatrix,new Freedo.Cartesian3);var u=o._boundingSpheres;s=new Freedo.BoundingSphere(l,u.radius)}else if(o.point){s=new Freedo.BoundingSphere(o.position.getValue(),10)}e.push(s)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._sceneSphere=Freedo.BoundingSphere.fromBoundingSpheres(e,new Freedo.BoundingSphere);if(this._basePt===undefined){this._basePt=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);this._basePt.longitude=Freedo.Math.toDegrees(this._basePt.longitude);this._basePt.latitude=Freedo.Math.toDegrees(this._basePt.latitude)}};c.prototype.calcXYZDist=function(e,t,r,i,n,a){return[i-e,n-t,a-r];var o=new Freedo.EllipsoidGeodesic(new Freedo.Cartographic(e,t,r),new Freedo.Cartographic(i,t,r)).surfaceDistance;if(i<e)o*=-1;var s=new Freedo.EllipsoidGeodesic(new Freedo.Cartographic(e,t,r),new Freedo.Cartographic(e,n,r)).surfaceDistance;if(n<t)s*=-1;var l=a-r;return[o,s,l]};c.prototype.calcAxisZoom=function(){if(this._bInClip===false){this._axisZoom=1;return}var e=this._sceneSphere.center;var t=this._viewer.camera.positionWC;var r=1,i=1;r=Freedo.Cartesian3.distance(e,t)/6;i=this._viewer.camera.getPixelSize(this._sceneSphere,10,10);this._axisZoom=r;if(this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW)this._axisZoom=this._viewer.camera.positionWC.x/6;if(this._axisZoom>4e5)this._axisZoom=4e5;if(this._axisZoom<1)this._axisZoom=1};c.prototype.onTransforming=function(e){var t=e.MouseDownPos;var r=e.MouseMovePos;var i=e.SelectedAxis;var n=e.FixedAxis;this._selectedAxis=i;var a=[0,0,0];var o=1,s=1,l=1,u=0,d=0,c=0;this.calcAxisZoom();var f=undefined;if(Freedo.defined(t))f=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);var h=undefined;if(Freedo.defined(r))h=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height);var p=0;var v=0;if(f)p=Freedo.Cartesian3.distance(f,this._sceneSphere.center);if(h)v=Freedo.Cartesian3.distance(h,this._sceneSphere.center);var m=Freedo.clone(this._mouseDown12Arg,true);if(this._aPModelSet.length>0){this.calcSceneBS()}if(i==="XY"){a=this.calcXYZDist(t.longitude,t.latitude,t.height,r.longitude,r.latitude,t.height)}if(i==="YZ"){a=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,r.latitude,r.height)}if(i==="XZ"){a=this.calcXYZDist(t.longitude,t.latitude,t.height,r.longitude,t.latitude,r.height)}if(n==="X"){a=this.calcXYZDist(t.longitude,t.latitude,t.height,r.longitude,t.latitude,t.height)}if(n==="Y"){a=this.calcXYZDist(t.longitude,t.latitude,t.height,t.longitude,r.latitude,t.height)}if(n==="Z"){a[0]=0;a[1]=0;a[2]=-1*(e.MouseMoveXY.y-e.MouseDownXY.y)*this._axisZoom/100}if(this._transType.indexOf("SCALE")>=0&&i==="XY_QCIRCLE"){var _=v/p;o=_;s=_;l=_}var y={};if(this._transType.indexOf("ROTATE")>=0&&i==="XY_CIRCLE"){y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var g=Freedo.Cartesian3.fromRadians(y.longitude+.01,y.latitude,y.height);var w=Freedo.Cartesian3.subtract(g,this._sceneSphere.center,new Freedo.Cartesian3);var F=Freedo.Cartesian3.subtract(f,this._sceneSphere.center,new Freedo.Cartesian3);var b=Freedo.Cartesian3.subtract(h,this._sceneSphere.center,new Freedo.Cartesian3);var C=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(b,w));var x=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(F,w));if(t.latitude<y.latitude)x=360-x;if(r.latitude<y.latitude)C=360-C;u=x-C}if(this._transType.indexOf("ROTATE")>=0&&i==="XZ_CIRCLE"){if(!Freedo.defined(f))return;y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var g=Freedo.Cartesian3.fromRadians(y.longitude+.01,y.latitude,y.height);var w=Freedo.Cartesian3.subtract(g,this._sceneSphere.center,new Freedo.Cartesian3);var F=Freedo.Cartesian3.subtract(f,this._sceneSphere.center,new Freedo.Cartesian3);var b=Freedo.Cartesian3.subtract(h,this._sceneSphere.center,new Freedo.Cartesian3);var C=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(b,w));var x=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(F,w));if(t.height<y.height)x=360-x;if(r.height<y.height)C=360-C;d=C-x}if(this._transType.indexOf("ROTATE")>=0&&i==="YZ_CIRCLE"){if(!Freedo.defined(f))return;y=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);var g=Freedo.Cartesian3.fromRadians(y.longitude,y.latitude+.01,y.height);var w=Freedo.Cartesian3.subtract(g,this._sceneSphere.center,new Freedo.Cartesian3);var F=Freedo.Cartesian3.subtract(f,this._sceneSphere.center,new Freedo.Cartesian3);var b=Freedo.Cartesian3.subtract(h,this._sceneSphere.center,new Freedo.Cartesian3);var C=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(b,w));var x=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(F,w));if(t.height<y.height)x=360-x;if(r.height<y.height)C=360-C;c=C-x}var P={TMoveX:a[0],TMoveY:a[1],TMoveZ:a[2],THeading:u,TPitch:d,TRoll:c,TScaleX:o,TScaleY:s,TScaleZ:l};m.DMoveX+=Freedo.Math.toDegrees(P.TMoveX);m.DMoveY+=Freedo.Math.toDegrees(P.TMoveY);m.DMoveZ+=P.TMoveZ;m.THeading+=P.THeading;m.TPitch+=P.TPitch;m.TRoll+=P.TRoll;m.TScaleX*=P.TScaleX;m.TScaleY*=P.TScaleY;m.TScaleZ*=P.TScaleZ;this._t12.DMoveX=m.DMoveX;this._t12.DMoveY=m.DMoveY;this._t12.DMoveZ=m.DMoveZ;this._t12.THeading=m.THeading;this._t12.TPitch=m.TPitch;this._t12.TRoll=m.TRoll;this._t12.TScaleX=m.TScaleX;this._t12.TScaleY=m.TScaleY;this._t12.TScaleZ=m.TScaleZ;this.refineArgs();this._event.raiseEvent("Transforming",Freedo.clone(this._t12,true));if(this._aPModelSet.length>0){var M=true;var T=false;var E=undefined;try{for(var S=(0,L.default)(this._aPModelSet),A;!(M=(A=S.next()).done);M=true){var k=A.value;y=this.getTilesetBasePt(k);this.applyTransformToTileset(k,Freedo.Math.toRadians(m.DMoveX),Freedo.Math.toRadians(m.DMoveY),m.DMoveZ,m.THeading,m.TPitch,m.TRoll,m.TScaleX,m.TScaleY,m.TScaleZ,Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height);this._event.raiseEvent("DataChanged",Freedo.clone(k.modelMatrix,true))}}catch(e){T=true;E=e}finally{try{if(!M&&S.return){S.return()}}finally{if(T){throw E}}}this._t12.TMoveX=Freedo.Math.toDegrees(y.longitude)+m.DMoveX;this._t12.TMoveY=Freedo.Math.toDegrees(y.latitude)+m.DMoveY;this._t12.TMoveZ=y.height+m.DMoveZ;this.calcSceneBS();this._mani.updateSceneSphere(this._sceneSphere)}};c.prototype.refineArgs=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,L.default)(this._aPModelSet),n;!(e=(n=i.next()).done);e=true){var a=n.value;var o=Freedo.Matrix4.getScale(a.modelMatrix,new Freedo.Cartesian3);if(this._t12.THeading>360)this._t12.THeading-=360;if(this._t12.THeading<-360)this._t12.THeading+=360;if(this._t12.TPitch>360)this._t12.TPitch-=360;if(this._t12.TPitch<-360)this._t12.TPitch+=360;if(this._t12.TRoll>360)this._t12.TRoll-=360;if(this._t12.TRoll<-360)this._t12.TRoll+=360;this._t12.TMoveX=Freedo.FdMisc.FdMath.round(this._t12.TMoveX,8);this._t12.TMoveY=Freedo.FdMisc.FdMath.round(this._t12.TMoveY,8);this._t12.TMoveZ=Freedo.FdMisc.FdMath.round(this._t12.TMoveZ,6);this._t12.THeading=Freedo.FdMisc.FdMath.round(this._t12.THeading,4);this._t12.TPitch=Freedo.FdMisc.FdMath.round(this._t12.TPitch,4);this._t12.TRoll=Freedo.FdMisc.FdMath.round(this._t12.TRoll,4);this._t12.TScaleX=1;this._t12.TScaleY=1;this._t12.TScaleZ=1}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}};c.prototype.onGotoPoint=function(e){if(e.type!=this.PositionType.NONE&&this._inMoveTo){var t=Freedo.Cartographic.fromCartesian(e.position);if(t!==undefined){var r=Freedo.clone(this._t12,true);r.TMoveX=t.longitude;r.TMoveY=t.latitude;var i=true;var n=false;var a=undefined;try{for(var o=(0,L.default)(this._aPModelSet),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=this.getTilesetBasePt(l);var d=r.TMoveX-u.longitude;var c=r.TMoveY-u.latitude;var f=r.TMoveZ-u.height;this.applyTransformToTileset(l,parseFloat(d),parseFloat(c),parseFloat(f),parseFloat(r.THeading),parseFloat(r.TPitch),parseFloat(r.TRoll),parseFloat(r.TScaleX),parseFloat(r.TScaleY),parseFloat(r.TScaleZ),Freedo.Math.toRadians(this._t12.TBaseX),Freedo.Math.toRadians(this._t12.TBaseY),this._t12.TBaseZ)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}r.TMoveX=Freedo.Math.toDegrees(r.TMoveX);r.TMoveY=Freedo.Math.toDegrees(r.TMoveY);r.TMoveZ=r.TMoveZ;this._t12=Freedo.clone(r,true);this.refineArgs();if(this._transType!==""){this.calcSceneBS();this._mani.updateSceneSphere(this._sceneSphere)}this.onTransformed()}this._inMoveTo=false}};c.prototype.onTransform=function(e){this._event.raiseEvent("Transform",{});this.reset12Args();this._mouseDown12Arg=Freedo.clone(this._t12,true);var t=true;var r=false;var i=undefined;try{for(var n=(0,L.default)(this._aPModelSet),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._mouseDownMM=Freedo.clone(o.modelMatrix,true);break}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};c.prototype.onTransformed=function(e){this.refineArgs();this._mouseDownMM=Freedo.Matrix4.IDENTITY;var t=[1,1,1];var r=[0,0,0];var i=[0,0,0];this.calcSceneBS();var n=[this._basePt.longitude,this._basePt.latitude,this._basePt.height];var a=Freedo.FdMisc.FdGeometric.tg(this._sceneSphere.center);var o=Freedo.Matrix4.IDENTITY;var s=true;var l=false;var u=undefined;try{for(var d=(0,L.default)(this._aPModelSet),c;!(s=(c=d.next()).done);s=true){var f=c.value;o=f.modelMatrix;t=Freedo.Matrix4.getScale(f.modelMatrix,new Freedo.Cartesian3);r=Freedo.Matrix4.getTranslation(f.modelMatrix,new Freedo.Cartesian3);i=Freedo.Matrix4.getRotation(f.modelMatrix,new Freedo.Cartesian3);break}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}this._event.raiseEvent("Transformed",{TMoveX:this._t12.TMoveX,TMoveY:this._t12.TMoveY,TMoveZ:this._t12.TMoveZ,DMoveX:Freedo.Math.toRadians(a[0]-n[0]),DMoveY:Freedo.Math.toRadians(a[1]-n[1]),DMoveZ:a[2]-n[2],THeading:this._t12.THeading,TPitch:this._t12.TPitch,TRoll:this._t12.TRoll,TScaleX:t.x,TScaleY:t.y,TScaleZ:t.z});this._event.raiseEvent("TransformedMatrix",Freedo.Matrix4.toArray(o))};c.prototype.getTilesetBasePt=function(e){if(e===undefined)return undefined;var t=false;var r;if(e._root&&e._root.transform){var i=Freedo.Matrix4.fromArray(e._root.transform);if(i.equals(Freedo.Matrix4.IDENTITY)){var n=Freedo.Matrix4.fromTranslation(e._root._boundingVolume._boundingSphere.center);r=Freedo.Matrix4.multiply(e.modelMatrix,n,new Freedo.Matrix4)}else r=Freedo.clone(e._root.transform,true)}else if(e instanceof Freedo.Model||e instanceof Freedo.Primitive)r=Freedo.clone(e.modelMatrix,true);else{r=Freedo.clone(e.modelMatrix,true);t=true}var a=Freedo.Matrix4.getTranslation(r,new Freedo.Cartesian3);var o=Freedo.Cartographic.fromCartesian(a);if(t){o=Freedo.Cartographic.fromCartesian(e.boundingSphere.center)}return o};c.prototype.applyTransformToTileset=function(e,t,r,i,n,a,o,s,l,u,d,c,f){var h=this.getMatrixOfTileset(e,t,r,i,n,a,o,s,l,u,d,c,f);if(e instanceof Freedo.Model){var p=Freedo.Matrix4.multiply(h,this._mouseDownMM,new Freedo.Matrix4);e.modelMatrix=p}else{var p=Freedo.Matrix4.multiply(h,this._mouseDownMM,new Freedo.Matrix4);e.modelMatrix=p}};c.prototype.applyTransformToModel=function(e,t,r,i,n,a,o,s,l,u,d,c,f){this.hideAxis();var h=this.getMatrixOfTileset(e,t,r,i,n,a,o,s,l,u,d,c,f);var p=Freedo.Matrix4.multiply(h,e.modelMatrix,new Freedo.Matrix4);e.modelMatrix=p};c.prototype.applyTransform=function(e,t,r,i,n,a,o,s,l){if(this.checkConflict())return;this.calcSceneBS();try{e=parseFloat(e);t=parseFloat(t);r=parseFloat(r);i=parseFloat(i);n=parseFloat(n);a=parseFloat(a);o=parseFloat(o);s=parseFloat(s);l=parseFloat(l)}catch(e){return}if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(i)||isNaN(n)||isNaN(a)||isNaN(o)||isNaN(s)||isNaN(l))return;var u=true;var d=false;var c=undefined;try{for(var f=(0,L.default)(this._aPModelSet),h;!(u=(h=f.next()).done);u=true){var p=h.value;var v=this.getTilesetBasePt(p);var m=Freedo.Math.toRadians(e)-v.longitude;var _=Freedo.Math.toRadians(t)-v.latitude;var y=r-v.height;this.applyTransformToTileset(p,parseFloat(m),parseFloat(_),parseFloat(y),parseFloat(i),parseFloat(n),parseFloat(a),parseFloat(o),parseFloat(s),parseFloat(l),Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}this._t12.TMoveX=e;this._t12.TMoveY=t;this._t12.TMoveZ=r;this._t12.THeading=i;this._t12.TPitch=n;this._t12.TRoll=a;this._t12.TScaleX=o;this._t12.TScaleY=s;this._t12.TScaleZ=l;this.refineArgs();if(this._transType!==""){this.calcSceneBS();if(this._mani)this._mani.updateSceneSphere(this._sceneSphere)}this.onTransformed()};c.prototype.applyTransformDelta=function(e,t,r,i,n,a,o,s,l){if(this.checkConflict())return;this.hideAxis();this.calcSceneBS();try{e=parseFloat(e);t=parseFloat(t);r=parseFloat(r);i=parseFloat(i);n=parseFloat(n);a=parseFloat(a);o=parseFloat(o);s=parseFloat(s);l=parseFloat(l)}catch(e){return}if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(i)||isNaN(n)||isNaN(a)||isNaN(o)||isNaN(s)||isNaN(l))return;var u=true;var d=false;var c=undefined;try{for(var f=(0,L.default)(this._aPModelSet),h;!(u=(h=f.next()).done);u=true){var p=h.value;var v=this.getTilesetBasePt(p);this._mouseDownMM=Freedo.clone(p.modelMatrix,true);this.applyTransformToTileset(p,e,t,r,parseFloat(i),parseFloat(n),parseFloat(a),parseFloat(o),parseFloat(s),parseFloat(l),Freedo.Math.toRadians(this._basePt.longitude),Freedo.Math.toRadians(this._basePt.latitude),this._basePt.height)}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}this._t12.DMoveX=e;this._t12.DMoveY=t;this._t12.DMoveZ=r;this._t12.TMoveX=e+this._basePt.longitude;this._t12.TMoveY=t+this._basePt.latitude;this._t12.TMoveZ=r+this._basePt.height;this._t12.THeading=i;this._t12.TPitch=n;this._t12.TRoll=a;this._t12.TScaleX=o;this._t12.TScaleY=s;this._t12.TScaleZ=l;this.refineArgs();if(this._transType!==""){this.calcSceneBS();this._mani.updateSceneSphere(this._sceneSphere)}this.onTransformed()};c.prototype.reset12Args=function(){if(this.checkConflict())return;var e=undefined;var t=true;var r=false;var i=undefined;try{for(var n=(0,L.default)(this._aPModelSet),a;!(t=(a=n.next()).done);t=true){var o=a.value;var e=this.getTilesetBasePt(o);break}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}if(e==undefined){return}this._t12.DMoveX=0;this._t12.DMoveY=0;this._t12.DMoveZ=0;this._t12.TMoveX=Freedo.Math.toDegrees(e.longitude);this._t12.TMoveY=Freedo.Math.toDegrees(e.latitude);this._t12.TMoveZ=e.height;this._t12.THeading=0;this._t12.TPitch=0;this._t12.TRoll=0;this._t12.TScaleX=1;this._t12.TScaleY=1;this._t12.TScaleZ=1;this.refineArgs();this._basePt=undefined};c.prototype.resetTransform=function(){this.reset12Args();var e=true;var t=false;var r=undefined;try{for(var i=(0,L.default)(this._aPModelSet),n;!(e=(n=i.next()).done);e=true){var a=n.value;if(a instanceof Freedo.Model){a.modelMatrix=Freedo.clone(a.initModelMatrix,true)}else a.modelMatrix=Freedo.clone(Freedo.Matrix4.IDENTITY,true);this._event.raiseEvent("DataChanged",Freedo.clone(a.modelMatrix,true))}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this.calcSceneBS();if(this._bInTransform){this._mani.updateSceneSphere(this._sceneSphere)}this._event.raiseEvent("resetTransform",Freedo.clone(this._t12,true))};c.prototype.saveTransform=function(){var e=Date.parse(new Date);var t=true;var r=false;var i=undefined;try{for(var n=(0,L.default)(this._aPModelSet),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=this._sceneMgr._pModelMap[o]}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};c.prototype.cancelTransform=function(){this.reset()};c.prototype.cancel=function(){this.reset()};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.reset=function(){this._bInTransform=false;this._mani.reset();this._transType="";if(this._maniCallBack)this._maniCallBack();this._event.raiseEvent("Cancel",{})};c.prototype.dispose=function(){this.reset()};t.FdTransformHelper=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPickPMComponent=undefined;var i=r(118);var a=c(i);var n=r(172);var y=c(n);var o=r(3);var g=c(o);var s=r(35);var h=c(s);var l=r(1);var u=c(l);var d=r(5);function c(e){return e&&e.__esModule?e:{default:e}}var f=function e(t,r,i){(0,u.default)(this,e);this._viewer=t;this._bInSurvey=false;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._baseColor=[255,255,255,1];this._highlightColor=[255,0,0,1];var n=this;this.updatePModelStyleThrottle=_.throttle(n.updatePModelStyle,30);this._mode="HIGH_LIGHT";this._clickMode=Freedo.ScreenSpaceEventType.LEFT_CLICK;this._pModelSetMap=new h.default;this._singleMode=false;this._hideAll=false;this._clearOnEmptyClick=true;this._blink=undefined;this._ignoreID=[];this._ignorePModels=[];this._pmtsManager=undefined;this._bBoxs=[]};f.prototype.setBaseColor=function(e,t,r,i){this._baseColor=[e,t,r,i]};f.prototype.setSingleMode=function(e){this._singleMode=e};f.prototype.getSingleMode=function(){return this._singleMode};f.prototype.addIgnoreID=function(e){this._ignoreID=e};f.prototype.setIgnoreIDs=function(e){this._ignoreID=e};f.prototype.setIgnorePModels=function(e){this._ignorePModels=e};f.prototype.addIgnorePModel=function(e){this._ignorePModels.push(e)};f.prototype.clearIgnoreID=function(){this._ignoreID=[]};f.prototype.setPMTSManager=function(e){this._pmtsManager=e};f.prototype.setMode=function(e){if(e==="BBOX_MODE"&&this._pmtsManager===undefined){console.log("要使用线框模式需先传入PMTSManager");return}this._mode=e};f.prototype.getMode=function(){return this._mode};f.prototype.setClickMode=function(e){this._clickMode=e};f.prototype.start=function(e){this.cancel(e);this.setBaseColor(this._baseColor);this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.handleLeftClick.bind(this),this._clickMode);this._bInSurvey=true};f.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};f.prototype.updatePModelStyle=function(){var e=[];var t=[];var r=true;var i=false;var n=undefined;try{for(var a=(0,g.default)(this._pModelSetMap),o;!(r=(o=a.next()).done);r=true){var s=(0,y.default)(o.value,2),l=s[0],u=s[1];e.splice(0,e.length);t.splice(0,t.length);var d=u;if(typeof d!=="undefined"){for(var c in d){var f=d[c];if(typeof f.color!=="undefined"){var h=f.color;var p="rgba("+h[0]+","+h[1]+","+h[2]+","+h[3]+")";e.push(["${component} ~== '"+c+"'",p])}if(typeof f.show!=="undefined"){t.push(["${component} ~== '"+c+"'",f.show])}}var v=this._baseColor;var m="rgba("+v[0]+","+v[1]+","+v[2]+","+v[3]+")";e.push(["true",m]);if(!this._hideAll)t.push(["true","true"]);l.style=new Freedo.FreedoPModelStyle({color:{conditions:e},show:{conditions:t}})}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._viewer.scene.requestRender()};f.prototype.pickComponent=function(e,t,r){var i=this._viewer.scene.pick(e);if(Freedo.defined(i)){if(Freedo.defined(i.tileset)){for(var n=0;n<this._ignorePModels.length;n++){if(i.tileset===this._ignorePModels[n]){return}}if(!this._pModelSetMap.has(i.tileset)){this._pModelSetMap.set(i.tileset,{})}var a=i.getPropertyNames();var o=i.getProperty("component");for(var n=0;n<this._ignoreID.length;n++){if(o===this._ignoreID[n]){this._event.raiseEvent("DataChanged",undefined);return}}if(Freedo.defined(o)){var s=undefined;if(r){s=i.getAncestors("component")}t(o,i.tileset,s);var l={tilesetUrl:i.tileset.url,tileset:i.tileset,componentid:o,ancestorComponents:s,names:i.getProperty("names"),desc:i.getProperty("desc"),tag:i.getProperty("tags")};var u=this._pModelSetMap.get(i.tileset);if(!Freedo.defined(u[o])){u[o]={}}u[o].data=l;this._event.raiseEvent("DataChanged",l);return}}else if(i.primitive instanceof Freedo.Model){if(Freedo.defined(i.node)){t(i.node.name,i,"Gltf")}}}else{this._event.raiseEvent("DataChanged",undefined)}if(this._clearOnEmptyClick)t(undefined,undefined)};f.prototype.getData=function(){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,g.default)(this._pModelSetMap),a;!(t=(a=n.next()).done);t=true){var o=(0,y.default)(a.value,2),s=o[0],l=o[1];for(var u in l){e.push(l[u].data)}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}return e};f.prototype.unhighlightAllComponents=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,g.default)(this._pModelSetMap),n;!(e=(n=i.next()).done);e=true){var a=(0,y.default)(n.value,2),o=a[0],s=a[1];var l=s;for(var u in l){delete l[u]["color"]}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this.updatePModelStyle()};f.prototype.showAllComponents=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,g.default)(this._pModelSetMap),n;!(e=(n=i.next()).done);e=true){var a=(0,y.default)(n.value,2),o=a[0],s=a[1];var l=s;for(var u in l){delete l[u]["show"]}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this._hideAll=false;this.updatePModelStyle()};f.prototype.hideAllComponents=function(){this._hideAll=true;this.updatePModelStyle()};f.prototype.handleLeftClick=function(e){if(this._bInSurvey==false)return;var f=this;this.pickComponent(e.position,function(e,t,r){if(f._mode=="HIGH_LIGHT"){if(f._singleMode){f.unhighlightAllComponents()}if(Freedo.defined(e)){var i=f._highlightColor[0];var n=f._highlightColor[1];var a=f._highlightColor[2];var o=f._highlightColor[3];f.highlightComponent(e,t,i,n,a,o)}else{f.unhighlightAllComponents();f._pModelSetMap=new h.default}}if(f._mode=="BBOX_MODE"){if(f._singleMode){f.hideComponentBoundingBoxs()}if(Freedo.defined(e)){var s=f.getPMTSInfo(t);f.showComponentBoundingBox(e,s)}else{f.hideComponentBoundingBoxs();f._pModelSetMap=new h.default}}if(f._mode=="SHOW_HIDE"){if(f._singleMode){f.showAllComponents()}if(Freedo.defined(e)){var i=Math.random()*255;var n=Math.random()*255;var a=Math.random()*255;var o=Math.random()*.5+.5;f.showComponent(e,t,false)}else{f.showAllComponents();f._pModelSetMap=new h.default}if(r=="Gltf"){var l=t.primitive,u=t.node;if(f._singleMode)l.gltf.nodes.forEach(function(e){return l.getNode(e.name).show=true});u.show=false}}if(f._mode=="SHOW_SINGLE"){if(Freedo.defined(e)){f.hideAllComponents();f.showComponent(e,t,true)}else{f.showAllComponents();f._pModelSetMap=new h.default}}if(f._mode=="PICK_MODE"){if(Freedo.defined(e)){}else{f._pModelSetMap=new h.default}}if(f._mode=="BLINK_HL"){if(Freedo.defined(e)){if(f._blink){clearInterval(f._blink);f._blink=undefined;f.unhighlightAllComponents()}var d=0;var i=f._highlightColor[0];var n=f._highlightColor[1];var a=f._highlightColor[2];var o=f._highlightColor[3];f._blink=setInterval(function(){if(d%2==0){f.highlightComponent(e,t,i,n,a,o)}else{f.unhighlightComponent(e,t)}d+=1},500)}else{clearInterval(f._blink);f._blink=undefined;f.unhighlightAllComponents();f._pModelSetMap=new h.default}}if(f._mode=="BLINK_SH"){if(Freedo.defined(e)){if(f._blink){clearInterval(f._blink);f._blink=undefined;f.showAllComponents()}var c=0;f._blink=setInterval(function(){if(c%2==0){f.showComponent(e,t,false)}else{f.showComponent(e,t,true)}c+=1},500)}else{clearInterval(f._blink);f._blink=undefined;f.showAllComponents();f._pModelSetMap=new h.default}}},true)};f.prototype.highlightComponent=function(e,t,r,i,n,a){if(Freedo.defined(e)){if(typeof this._pModelSetMap.get(t)==="undefined"){this._pModelSetMap.set(t,{})}var o=this._pModelSetMap.get(t);if(typeof o[e]==="undefined"){o[e]={}}var s=this._highlightColor;if(r!==undefined){s=[r,i,n,a]}o[e].color=s;this.updatePModelStyle();return true}else{return false}};f.prototype.getPMTSInfo=function(t){var r=this._pmtsManager.getPmtsIdByPModel(t);var e=this._pmtsManager.getPmts(r);var i=void 0;e.pModelInfos.forEach(function(e){if(e.pModel==t){i={pmtsId:r,element:e}}});return i};f.prototype.createBB=function(e,t,r,i){t=Freedo.FdMisc.FdMath.getPositionFromString(t);r=Freedo.FdMisc.FdMath.getPositionFromString(r);e=Freedo.FdMisc.FdMath.getPositionFromString(e);var n=new Freedo.Cartesian3.fromDegrees(e[1],e[0],e[2]);var a=new Freedo.Cartesian3(t[0],-t[2],t[1]);var o=new Freedo.Cartesian3(r[0],-r[2],r[1]);var s=true;var l=Freedo.Transforms.eastNorthUpToFixedFrame(n);if(e[1]==0&&e[0]==0&&e[2]==0||i[14]>1e6){l=i;s=false}Freedo.Matrix4.multiplyByPoint(l,a,a);Freedo.Matrix4.multiplyByPoint(l,o,o);var u=Freedo.FdMisc.FdGeometric.tg(a);var d=Freedo.FdMisc.FdGeometric.tg(o);var c=o;var f=Freedo.FdMisc.FdGeometric.tc([d[0],d[1],u[2]]);var h=Freedo.FdMisc.FdGeometric.tc([u[0],d[1],u[2]]);var p=Freedo.FdMisc.FdGeometric.tc([u[0],d[1],d[2]]);var v=a;var m=Freedo.FdMisc.FdGeometric.tc([u[0],u[1],d[2]]);var _=Freedo.FdMisc.FdGeometric.tc([d[0],u[1],d[2]]);var y=Freedo.FdMisc.FdGeometric.tc([d[0],u[1],u[2]]);if(s){Freedo.Matrix4.multiplyByPoint(i,c,c);Freedo.Matrix4.multiplyByPoint(i,f,f);Freedo.Matrix4.multiplyByPoint(i,h,h);Freedo.Matrix4.multiplyByPoint(i,p,p);Freedo.Matrix4.multiplyByPoint(i,v,v);Freedo.Matrix4.multiplyByPoint(i,m,m);Freedo.Matrix4.multiplyByPoint(i,_,_);Freedo.Matrix4.multiplyByPoint(i,y,y)}var g=r[0]-t[0];var w=r[2]-t[2];var F=r[1]-t[1];var b=g;if(g>F)b=F;if(b>w)b=w;b/=4;g=b/g;w=b/w;F=b/F;var C=this.drawLines(c,p,g,_,w,f,F);var x=this.drawLines(f,h,g,y,w,c,F);var P=this.drawLines(h,f,g,v,w,p,F);var M=this.drawLines(p,c,g,m,w,h,F);var T=this.drawLines(v,y,g,h,w,m,F);var E=this.drawLines(m,_,g,p,w,v,F);var S=this.drawLines(_,m,g,c,w,y,F);var A=this.drawLines(y,v,g,f,w,_,F);var k=[];k.push(C);k.push(x);k.push(P);k.push(M);k.push(T);k.push(E);k.push(S);k.push(A);return k};f.prototype.drawLines=function(e,t,r,i,n,a,o){var s=Freedo.Cartesian3.add(e,Freedo.Cartesian3.multiplyByScalar(Freedo.Cartesian3.subtract(t,e,new Freedo.Cartesian3),r,new Freedo.Cartesian3),new Freedo.Cartesian3);var l=Freedo.Cartesian3.add(e,Freedo.Cartesian3.multiplyByScalar(Freedo.Cartesian3.subtract(i,e,new Freedo.Cartesian3),n,new Freedo.Cartesian3),new Freedo.Cartesian3);var u=Freedo.Cartesian3.add(e,Freedo.Cartesian3.multiplyByScalar(Freedo.Cartesian3.subtract(a,e,new Freedo.Cartesian3),o,new Freedo.Cartesian3),new Freedo.Cartesian3);var d=this._viewer.scene.primitives.add(this.createLinePrimitive(e,s));var c=this._viewer.scene.primitives.add(this.createLinePrimitive(e,l));var f=this._viewer.scene.primitives.add(this.createLinePrimitive(e,u));return{lineX:d,lineY:c,lineZ:f}};f.prototype.createLinePrimitive=function(e,t){var r=new Freedo.PolylineGeometry({positions:[e,t],width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT});return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:r}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.Color.fromBytes(this._highlightColor[0],this._highlightColor[1],this._highlightColor[2],this._highlightColor[3]*255)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:Freedo.Color.fromBytes(this._highlightColor[0],this._highlightColor[1],this._highlightColor[2],this._highlightColor[3]*255)}}})})})};f.prototype.showComponentBoundingBox=function(e,i){var n=this;if(Freedo.defined(e)){var t=this._pmtsManager.getToken(i.pmtsId);this._pmtsManager.getUidProp(i.pmtsId,e,t,function(e){var t=i.element.matrix.metadata.position;var r=n.createBB(t,e[0].BoundsMin,e[0].BoundsMax,i.element.pModel.modelMatrix);n._bBoxs.push(r);n._viewer.scene.requestRender()})}};f.prototype.showComponentBBoxByUid=function(e,t){var u=this;if(Freedo.defined(t)){var r=this._pmtsManager.getToken(e);var d=this._pmtsManager.getPmts(e);this._pmtsManager.getUidProp(e,t,r,function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,g.default)(d.pModelInfos),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(o.matrix.identifier==e[0].cmatrix){var s=o.matrix.metadata.position;var l=u.createBB(s,e[0].BoundsMin,e[0].BoundsMax,o.pModel.modelMatrix);u._bBoxs.push(l);u._viewer.scene.requestRender()}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}})}};f.prototype.hideComponentBoundingBoxs=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,g.default)(this._bBoxs),n;!(e=(n=i.next()).done);e=true){var a=n.value;var o=true;var s=false;var l=undefined;try{for(var u=(0,g.default)(a),d;!(o=(d=u.next()).done);o=true){var c=d.value;this._viewer.scene.primitives.remove(c.lineX);this._viewer.scene.primitives.remove(c.lineY);this._viewer.scene.primitives.remove(c.lineZ)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this._viewer.scene.requestRender()};f.prototype.hideAllComponentsBoundingBox=function(){this.hideComponentBoundingBoxs()};f.prototype.findFeature=function(e,t){if(e._content.featuresLength!==0){for(var r=0;r<e._content._features.length;r++){var i=e._content._features[r].getProperty("component");if(i===t){return e._content._features[r]}}}return false};f.prototype.highlightComponentsArray=function(e,t,s){s=Freedo.defaultValue(s,[255,255,255,255]);e=Freedo.defaultValue(e,[]);var l=Freedo.clone(e,true);for(var r=0;r<l.length;r++){var i=l[r].components;l[r].componentsSet=new a.default(l[r].components);delete l[r].component}var n=new Freedo.FreedoPModelStyle({color:{evaluateColor:function e(t,r,i){if(!Freedo.defined(t)){return Freedo.Color.fromBytes(255,255,255,255)}if(t instanceof Freedo.FreedoPModelFeature){var n=t.getProperty("component");for(var a=0;a<l.length;a++){var o=l[a].color;if(l[a].componentsSet.has(n)){return Freedo.Color.fromBytes(o[0],o[1],o[2],o[3],r)}}return Freedo.Color.fromBytes(s[0],s[1],s[2],s[3],r)}else{var n=r.getProperty("component");for(var a=0;a<l.length;a++){var o=l[a].color;if(l[a].componentsSet.has(n)){return Freedo.Color.fromBytes(o[0],o[1],o[2],o[3],i)}}return Freedo.Color.fromBytes(s[0],s[1],s[2],s[3],i)}}}});for(var r=0;r<t.length;r++){t[r].style=n}this._viewer.scene.requestRender()};f.prototype.showComponentsArray=function(e,t,o){o=Freedo.defaultValue(o,false);e=Freedo.defaultValue(e,[]);var s=Freedo.clone(e,true);var l=new a.default(s);var r=new Freedo.FreedoPModelStyle({show:{evaluate:function e(t,r,i){if(!Freedo.defined(t)){return true}if(t instanceof Freedo.FreedoPModelFeature){var n=t.getProperty("component");for(var a=0;a<s.length;a++){if(l.has(n)){return o}}return!o}else{var n=r.getProperty("component");for(var a=0;a<s.length;a++){if(l.has(n)){return o}}return!o}}}});for(var i=0;i<t.length;i++){t[i].style=r}this._viewer.scene.requestRender()};f.prototype.unhighlightComponent=function(e,t){if(Freedo.defined(e)||Freedo.defined(t)){var r=this._pModelSetMap.get(t);delete r[e]["color"];this.updatePModelStyle();return true}else{return false}this.updatePModelStyle()};f.prototype.setHighlightColor=function(e,t,r,i){this._highlightColor=[e,t,r,i]};f.prototype.showComponent=function(e,t,r){if(Freedo.defined(e)){if(typeof this._pModelSetMap.get(t)==="undefined"){this._pModelSetMap.set(t,{})}var i=this._pModelSetMap.get(t);if(typeof i[e]==="undefined"){i[e]={}}i[e].show=r}this.updatePModelStyle()};f.prototype.getUidBoundingSphere=function(t,e,r){var i=this._pModelInfos.find(function(e){return e.pModel===t});Freedo.FdServer.FdPMTSParser.getUidBoundingSphere(i.layer,i.matrixSet,i.matrix,e,token,undefined,function(e,t){if(typeof t!=="undefined"){console.log("getUidBoundingSphere got error!");return}r(e)})};f.prototype.setClearOnEmptyClick=function(e){this._clearOnEmptyClick=e};f.prototype.cancel=function(e){this.reset(e)};f.prototype.reset=function(e){e=Freedo.defaultValue(e,true);if(this._blink)clearInterval(this._blink);this._blink=undefined;this._bInSurvey=false;this._handler=this._handler&&this._handler.destroy();if(!e)return;this.setBaseColor(255,255,255,1);this.unhighlightAllComponents();this.showAllComponents();this.hideComponentBoundingBoxs();this._pModelSetMap=new h.default};t.FdPickPMComponent=f},function(e,t,r){"use strict";t.__esModule=true;var i=r(565);var n=o(i);var a=r(3);var l=o(a);function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function r(e,t){var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,l.default)(e),s;!(i=(s=o.next()).done);i=true){r.push(s.value);if(t&&r.length===t)break}}catch(e){n=true;a=e}finally{try{if(!i&&o["return"])o["return"]()}finally{if(n)throw a}}return r}return function(e,t){if(Array.isArray(e)){return e}else if((0,n.default)(Object(e))){return r(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}()},function(e,t,r){"use strict";var n=r(91);function i(e){var r,i;this.promise=new e(function(e,t){if(r!==undefined||i!==undefined)throw TypeError("Bad Promise constructor");r=e;i=t});this.resolve=n(r);this.reject=n(i)}e.exports.f=function(e){return new i(e)}},function(e,t){e.exports=/[!-#%-\*,-/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E49\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/},function(e,t,r){"use strict";e.exports=function e(t,r,i){var n,a,o,s,l=-1,u=t.posMax,d=t.pos;t.pos=r+1;n=1;while(t.pos<u){o=t.src.charCodeAt(t.pos);if(o===93){n--;if(n===0){a=true;break}}s=t.pos;t.md.inline.skipToken(t);if(o===91){if(s===t.pos-1){n++}else if(i){t.pos=d;return-1}}}if(a){l=t.pos}t.pos=d;return l}},function(e,t,r){"use strict";function i(){this.__rules__=[];this.__cache__=null}i.prototype.__find__=function(e){for(var t=0;t<this.__rules__.length;t++){if(this.__rules__[t].name===e){return t}}return-1};i.prototype.__compile__=function(){var r=this;var t=[""];r.__rules__.forEach(function(e){if(!e.enabled){return}e.alt.forEach(function(e){if(t.indexOf(e)<0){t.push(e)}})});r.__cache__={};t.forEach(function(t){r.__cache__[t]=[];r.__rules__.forEach(function(e){if(!e.enabled){return}if(t&&e.alt.indexOf(t)<0){return}r.__cache__[t].push(e.fn)})})};i.prototype.at=function(e,t,r){var i=this.__find__(e);var n=r||{};if(i===-1){throw new Error("Parser rule not found: "+e)}this.__rules__[i].fn=t;this.__rules__[i].alt=n.alt||[];this.__cache__=null};i.prototype.before=function(e,t,r,i){var n=this.__find__(e);var a=i||{};if(n===-1){throw new Error("Parser rule not found: "+e)}this.__rules__.splice(n,0,{name:t,enabled:true,fn:r,alt:a.alt||[]});this.__cache__=null};i.prototype.after=function(e,t,r,i){var n=this.__find__(e);var a=i||{};if(n===-1){throw new Error("Parser rule not found: "+e)}this.__rules__.splice(n+1,0,{name:t,enabled:true,fn:r,alt:a.alt||[]});this.__cache__=null};i.prototype.push=function(e,t,r){var i=r||{};this.__rules__.push({name:e,enabled:true,fn:t,alt:i.alt||[]});this.__cache__=null};i.prototype.enable=function(e,r){if(!Array.isArray(e)){e=[e]}var i=[];e.forEach(function(e){var t=this.__find__(e);if(t<0){if(r){return}throw new Error("Rules manager: invalid rule name "+e)}this.__rules__[t].enabled=true;i.push(e)},this);this.__cache__=null;return i};i.prototype.enableOnly=function(e,t){if(!Array.isArray(e)){e=[e]}this.__rules__.forEach(function(e){e.enabled=false});this.enable(e,t)};i.prototype.disable=function(e,r){if(!Array.isArray(e)){e=[e]}var i=[];e.forEach(function(e){var t=this.__find__(e);if(t<0){if(r){return}throw new Error("Rules manager: invalid rule name "+e)}this.__rules__[t].enabled=false;i.push(e)},this);this.__cache__=null;return i};i.prototype.getRules=function(e){if(this.__cache__===null){this.__compile__()}return this.__cache__[e]||[]};e.exports=i},function(e,t,r){"use strict";function i(e,t,r){this.type=e;this.tag=t;this.attrs=null;this.map=null;this.nesting=r;this.level=0;this.children=null;this.content="";this.markup="";this.info="";this.meta=null;this.block=false;this.hidden=false}i.prototype.attrIndex=function e(t){var r,i,n;if(!this.attrs){return-1}r=this.attrs;for(i=0,n=r.length;i<n;i++){if(r[i][0]===t){return i}}return-1};i.prototype.attrPush=function e(t){if(this.attrs){this.attrs.push(t)}else{this.attrs=[t]}};i.prototype.attrSet=function e(t,r){var i=this.attrIndex(t),n=[t,r];if(i<0){this.attrPush(n)}else{this.attrs[i]=n}};i.prototype.attrGet=function e(t){var r=this.attrIndex(t),i=null;if(r>=0){i=this.attrs[r][1]}return i};i.prototype.attrJoin=function e(t,r){var i=this.attrIndex(t);if(i<0){this.attrPush([t,r])}else{this.attrs[i][1]=this.attrs[i][1]+" "+r}};e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.PModelLoader=undefined;var i=r(3);var v=o(i);var n=r(272);var a=r(247);function o(e){return e&&e.__esModule?e:{default:e}}var w=new THREE.Sphere;function f(e,t,r,i,n){for(var a in e){var o=e[a];if(o.name==="tileset.json"){var s=r.replace("{matrix}",t).replace("{filepath}",o.path);i.push(s)}else if(o.name.endsWith(".xml")){var l=r.replace("{matrix}",t).replace("{filepath}",o.path);n.push(l)}if(o.cnodes){f(o.cnodes,t,r,i,n)}}}function c(e,t){var r=e;var i=r;if(Array.isArray(i)){var n=true;var a=false;var o=undefined;try{for(var s=(0,v.default)(i),l;!(n=(l=s.next()).done);n=true){var u=l.value;c(u,t)}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}else{if(!r["Node"]){var d=e["@uid"];if(!d){d=e["uid"]}t.push(d);return}c(i["Node"],t)}}function h(e,t,r,i){var n=e;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,v.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=d["@uid"];if(c===t){return{bbmin:d["@BoundsMin"],bbmax:d["@BoundsMax"]}}if(d["Node"]){var f=h(d["Node"],t,r,i);if(f){return f}}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}return undefined}else{var c=e["@uid"];if(c===t){return{bbmin:e["@BoundsMin"],bbmax:e["@BoundsMax"]}}if(n["Node"]){var f=h(n["Node"],t,r,i);return f}return undefined}}function s(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.boundingSphere=undefined;this.gltfLoader=new n.GLTFLoader;this.fileLoader=new THREE.FileLoader(e);this.modelTree=new a.Tree;this.loadedGltfs=[];this.ready=false;this.gltfScene=new THREE.Group;this.treeRootLength=0;this.controller=undefined;this.treeDiv=undefined;this.lastHighlightedComponents=[];this.highlightColor=new THREE.Vector3(1,1,0);this.lastClickedItemName=""}s.prototype={constructor:s,crossOrigin:"anonymous",load:function e(t,l,u,d){var c=this;c.fileLoader.load(t,function(e){try{var t=JSON.parse(e);var r=[];var i=[];t.contents.matrixsets.map(function(e){var t=e.resourceurl.find(function(e){return e.type==="file"}).template;f(e.matrix.cnodes,e.matrix.id,t,r,i)});c.treeRootLength=r.length;var n=[];for(var a=0;a<r.length;a++){var o=r[a];var s=i[a];c.loadByTileset(o,s,l,u,d,r.length-a-1,n)}}catch(e){if(d!==undefined){d(e)}else{throw e}}},u,d)},loadByTileset:function e(t,r,f,i,h,p,v){var m=this;var n=this.path!==undefined?this.path:THREE.LoaderUtils.extractUrlBase(t);var _=n;var y;if(t.indexOf("?")!==-1){y=t.substr(t.indexOf("?"))}function g(){m.fileLoader.load(r,function(e){m.treeRootLength--;var t=$.xml2json(e);var r=t["Node"];if(Array.isArray(r)){for(var i=0;i<r.length;i++){var n=r[i];var a={title:n["@name"],uid:n["@uid"],name:n["@name"],BoundsMin:n["@BoundsMin"],BoundsMax:n["@BoundsMax"],child:[],childVal:n["Node"]};m.modelTree.addRootTree=a}}else{var o={title:r["@name"],uid:r["@uid"],name:r["@name"],BoundsMin:r["@BoundsMin"],BoundsMax:r["@BoundsMax"],child:[],childVal:r["Node"]};m.modelTree.addRootTree=o}if(m.treeRootLength===0){var s=m.modelTree.createTree({onNodeClick:m.nodeClick.bind(m),onNodeExpand:m.nodeExpand.bind(m),onNodeSelected:m.nodeSelected.bind(m)});var l=m.treeDiv;if(!!window.ActiveXObject||"ActiveXObject"in window){l.appendChild(s)}else{l.append(s)}}},function(e){},function(e){m.treeRootLength--})}m.fileLoader.load(t,function(e){try{var t=JSON.parse(e);var r=t.root;var i=r.boundingVolume.box;var n=Math.sqrt(i[3]*i[3]+i[7]*i[7]+i[11]*i[11]);if(!m.boundingSphere){m.boundingSphere=new THREE.Sphere(new THREE.Vector3(i[0],i[2],-i[1]),n)}else{w.center.set(i[0],i[2],-i[1]);w.radius=n;m.boundingSphere.union(w)}m.ready=true;var a=r.children.length;m.ready=true;for(var o=0;o<a;o++){var s=r.children[o].content.url;if(s.endsWith(".gltf")||s.endsWith(".glb")){var l=_+s;if(y){l+=y}v.push(l)}else{console.log("Format '"+s+"' is not supported!")}}if(p===0){var u=0;var d=v.length;for(var c=0;c<d;c++){var l=v[c];m.gltfLoader.load(l,function(e){u++;f(e,u,d);if(m.treeDiv!=undefined&&u===d){g()}m.loadedGltfs.push({url:l,gltf:e})},function(){},function(e){u++;f({err:e},u,a)})}}}catch(e){if(h!==undefined){h(e)}else{throw e}}},i,h)},getComponentBoundingBox:function e(t){var r=this;var i=r.modelTree.tree;for(var n=0;n<i.length;n++){var a=i[n];if(a.uid===t){return{bbmin:a.BoundsMin,bbmax:a.BoundsMax}}var o=h(a.childVal,t);if(o){return o}}return undefined},nodeClick:function e(t,r,i){var n=this;if(!n.controller){return}var a=false;var o=t.uid;if(o===n.lastClickedItemName){a=true}n.lastClickedItemName=o;var s=t.BoundsMin;var l=t.BoundsMax;n.controller.flyTo(s,l);if(n.lastHighlightedComponents.length>0){n.controller.unhighlightComponents(n.lastHighlightedComponents);n.lastHighlightedComponents=[];if(a){return}}var u=[];if(t.childVal){c(t.childVal,u)}else{u.push(t.uid)}n.controller.highlightComponents(u,n.highlightColor);n.lastHighlightedComponents=u},nodeExpand:function e(t,r){var i=this;var n=t.childVal;if(!n)return;if(t.child.length>0)return;t.child=[];var a=n;if(Array.isArray(a)){var o=true;var s=false;var l=undefined;try{for(var u=(0,v.default)(a),d;!(o=(d=u.next()).done);o=true){var c=d.value;var f={title:c["@name"],uid:c["@uid"],name:c["@name"],BoundsMin:c["@BoundsMin"],BoundsMax:c["@BoundsMax"],child:[],childVal:c["Node"]};t.child.push(f)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}}else{var h=a;var p={title:h["@name"],uid:h["@uid"],name:h["@name"],BoundsMin:h["@BoundsMin"],BoundsMax:h["@BoundsMax"],child:[],childVal:h["Node"]};t.child.push(p)}i.modelTree.addNode(t,r)},nodeSelected:function e(t,r,i){var n=this;if(!n.controller){return}var a=t.uid;var o=true;if(!i){o=false}var s=[];if(t.childVal){c(t.childVal,s)}else{s.push(a)}n.controller.showComponents(s,o)}};t.PModelLoader=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FreedoControls=undefined;var i=r(72);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var Q=new THREE.Raycaster;var K=new THREE.Vector3;var $=new THREE.Vector3;var ee=new THREE.Vector3;var te=new THREE.Matrix4;var re=new THREE.Matrix4;var ie=new THREE.Matrix4;var ne=new THREE.Matrix4;var ae=new THREE.Vector3;var oe=new THREE.Vector3;var o=function e(t,r){this.object=t;var i=r;var n=i.clientWidth;var a=i.clientHeight;var f=i.offsetLeft;var h=i.offsetTop;var p=t;this.windowWidth=n;this.windowHeight=a;this.group=undefined;this.domElement=r!==undefined?r:document;this.enabled=false;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.enablePicking=false;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.pickedEvent=[];this.enableDamping=false;this.dampingFactor=.25;this.enableZoom=true;this.zoomSpeed=1;this.minimumZoomDistance=.1;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this.enableRotate=true;this.rotateSpeed=1;this.rotateCenter=new THREE.Vector3;this.maximumMovementRatio=.1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT};var o={type:"change"};var s={type:"start"};var l={type:"end"};var u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4};var d=u.NONE;var c=1e-6;var v=new THREE.Vector2;var m=new THREE.Vector2;var _=new THREE.Vector2;var y=new THREE.Vector2;var g=new THREE.Vector2;var w=new THREE.Vector2;var F=new THREE.Vector2;var b=new THREE.Vector2;var C=new THREE.Vector2;var x=new THREE.Vector2;var P=this;function M(e,t){e=e/P.windowWidth*2-1;t=-(t/P.windowHeight)*2+1;K.set(e,t,.5);Q.setFromCamera(K,p);return Q.intersectObject(P.group,true)}function T(e,t){e=e/P.windowWidth*2-1;t=-(t/P.windowHeight)*2+1;K.set(e,t,.5);Q.setFromCamera(K,p);return Q.ray.clone()}function E(e){var t=e.project(p);var r=P.windowWidth/2,i=P.windowHeight/2;return{x:Math.round(t.x*r+r),y:Math.round(-t.y*i+i)}}this.resize=function(){n=i.clientWidth;a=i.clientHeight;f=i.offsetLeft;h=i.offsetTop;P.windowWidth=n;P.windowHeight=a},this.addPickingEventListener=function(e){P.pickedEvent.push(e)},this.setIntesetionTestGroup=function(e){P.group=e};this.update=function(){return function e(){return false}}();var S=null;function A(e){}function k(e){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;m.set(t,r);var i=M(t,r);if(i.length>0){P.rotateCenter=i[0].point}else{P.rotateCenter=P.target.clone()}}function L(e){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;g.set(t,r)}function D(e){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;_.set(t,r);var i=_.x-m.x;var n=_.y-m.y;if(i!==0&&Math.abs(n)/Math.abs(i)>5){i=0}if(n!==0&&Math.abs(i)/Math.abs(n)>5){n=0}var a=i/P.windowHeight;var o=n/P.windowHeight;a=Math.min(a,P.maximumMovementRatio);o=Math.min(o,P.maximumMovementRatio);var s=a*Math.PI*2;var l=o*Math.PI;var u=p.up;$=p.getWorldDirection($);ee.crossVectors($,u);te.identity();te.makeRotationAxis(ee,-l);re.identity();re.makeRotationAxis(u,-s);var d=P.rotateCenter.clone();d=d.negate();ne.identity();ne.makeTranslation(d.x,d.y,d.z);d=d.negate();ie.identity();ie.makeTranslation(d.x,d.y,d.z);ie.multiply(te);ie.multiply(re);ie.multiply(ne);var c=p.position;p.applyMatrix(ie);m.copy(_)}function I(e){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;_.set(t,r);p.getWorldDirection($);var i=new THREE.Plane;var n=false;if(!n){var a=P.target.clone();i.setFromNormalAndCoplanarPoint($,a);var o=T(m.x,m.y);var s=T(_.x,_.y);var l=o.intersectPlane(i,ae);var u=s.intersectPlane(i,oe);if(l&&u){ae.sub(oe);ae.add(p.position);p.position.set(ae.x,ae.y,ae.z)}else{o.direction.negate();s.direction.negate();l=o.intersectPlane(i,ae);u=s.intersectPlane(i,oe);if(l&&u){oe.sub(ae);oe.add(p.position);p.position.set(oe.x,oe.y,oe.z)}}}m.copy(_)}var R=new THREE.Vector3(1,0,0);function O(e){if(P.enablePicking){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;_.set(t,r);if(v){_.sub(v)}else{_.set(0,0)}if(Math.abs(_.x)<3&&Math.abs(_.y)<3){if(S){S.material.materialShaderForHighlight.uniforms.highlight.value=0}var i=M(t,r);if(i.length>0){var n=i[0].object;if(!n.material.materialShaderForHighlight){n.material=n.material.clone();n.material.onBeforeCompile=function(e){e.uniforms.highlight={value:1};e.uniforms.highlightColor={value:R};e.fragmentShader="uniform float highlight;\n uniform vec3 highlightColor;\n"+e.fragmentShader;e.fragmentShader=e.fragmentShader.replace("#include <fog_fragment>",["#include <fog_fragment>","if(highlight > 0.5){","\tgl_FragColor.rgb = mix( gl_FragColor.rgb, highlightColor, 0.5 );","}"].join("\n"));n.material.materialShaderForHighlight=e};n.material.needsUpdate=true}else{n.material.materialShaderForHighlight.uniforms.highlight.value=1;n.material.materialShaderForHighlight.uniforms.highlightColor.value=R}for(var a=0;a<P.pickedEvent.length;a++){var o=P.pickedEvent[a];o(n)}S=n}}}}function N(e){var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;var i=P.object;var n=M(t,r);var a=e.deltaY<0?1:-1;var o,s;if(n.length===0){var l=P.target.clone();l.sub(i.position);s=l.length();o=l.normalize()}else{var u=n[0];var l=u.point;s=u.distance;o=l.sub(i.position).normalize()}s=s*.1*a;if(Math.abs(s)>P.maximumZoomDistance){s=a*P.maximumZoomDistance}if(Math.abs(s)<P.minimumZoomDistance){s=a*P.minimumZoomDistance}i.position.add(o.multiplyScalar(s))}function B(e){m.set(e.touches[0].pageX,e.touches[0].pageY)}function H(e){if(P.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var i=Math.sqrt(t*t+r*r);b.set(0,i)}if(P.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(n,a)}}function V(e){_.set(e.touches[0].pageX,e.touches[0].pageY);y.subVectors(_,m).multiplyScalar(P.rotateSpeed);var t=P.domElement===document?P.domElement.body:P.domElement;rotateLeft(2*Math.PI*y.x/t.clientHeight);rotateUp(2*Math.PI*y.y/t.clientHeight);m.copy(_);P.update()}function G(e){if(P.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var i=Math.sqrt(t*t+r*r);C.set(0,i);x.set(0,Math.pow(C.y/b.y,P.zoomSpeed));dollyIn(x.y);b.copy(C)}if(P.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(n,a);F.subVectors(w,g).multiplyScalar(P.panSpeed);pan(F.x,F.y);g.copy(w)}P.update()}function z(e){}function U(e){if(P.enabled===false)return;e.preventDefault();var t=e.clientX-e.target.offsetLeft-f;var r=e.clientY-e.target.offsetTop-h;v.set(t,r);m.set(t,r);switch(e.button){case P.mouseButtons.LEFT:if(P.enablePan===false)return;L(e);d=u.PAN;break;case P.mouseButtons.MIDDLE:if(P.enableZoom===false)return;k(e);d=u.ROTATE;break;case P.mouseButtons.RIGHT:if(P.enablePan===false)return;A(e);break}if(d!==u.NONE){P.domElement.addEventListener("mousemove",j,false);P.domElement.addEventListener("mouseup",q,false);P.dispatchEvent(s)}}function j(e){if(P.enabled===false)return;e.preventDefault();switch(d){case u.ROTATE:if(P.enableRotate===false)return;D(e);break;case u.DOLLY:if(P.enableZoom===false)return;break;case u.PAN:if(P.enablePan===false)return;I(e);break}}function q(e){if(P.enabled===false)return;O(e);P.domElement.removeEventListener("mousemove",j,false);P.domElement.removeEventListener("mouseup",q,false);P.dispatchEvent(l);d=u.NONE}function W(e){if(P.enabled===false||P.enableZoom===false||d!==u.NONE&&d!==u.ROTATE)return;N(e)}function X(e){if(P.enabled===false)return;e.preventDefault();switch(e.touches.length){case 1:if(P.enableRotate===false)return;B(e);d=u.TOUCH_ROTATE;break;case 2:if(P.enableZoom===false&&P.enablePan===false)return;H(e);d=u.TOUCH_DOLLY_PAN;break;default:d=u.NONE}if(d!==u.NONE){P.dispatchEvent(s)}}function Z(e){if(P.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:if(P.enableRotate===false)return;if(d!==u.TOUCH_ROTATE)return;V(e);break;case 2:if(P.enableZoom===false&&P.enablePan===false)return;if(d!==u.TOUCH_DOLLY_PAN)return;G(e);break;default:d=u.NONE}}function Y(e){if(P.enabled===false)return;z(e);P.dispatchEvent(l);d=u.NONE}function J(e){if(P.enabled===false)return;e.preventDefault()}P.domElement.addEventListener("contextmenu",J,false);P.domElement.addEventListener("mousedown",U,false);P.domElement.addEventListener("wheel",W,false);P.domElement.addEventListener("touchstart",X,false);P.domElement.addEventListener("touchend",Y,false);P.domElement.addEventListener("touchmove",Z,false);this.update();this.dispose=function(){P.domElement.removeEventListener("contextmenu",J,false);P.domElement.removeEventListener("mousedown",U,false);P.domElement.removeEventListener("wheel",W,false);P.domElement.removeEventListener("touchstart",X,false);P.domElement.removeEventListener("touchend",Y,false);P.domElement.removeEventListener("touchmove",Z,false);P.domElement.removeEventListener("mousemove",j,false);P.domElement.removeEventListener("mouseup",q,false)}};o.prototype=(0,n.default)(THREE.EventDispatcher.prototype);o.prototype.constructor=o;t.FreedoControls=o},function(e,t,r){e.exports=!r(14)&&!r(7)(function(){return Object.defineProperty(r(124)("div"),"a",{get:function(){return 7}}).a!=7})},function(e,t,r){t.f=r(11)},function(e,t,r){var o=r(25);var s=r(26);var l=r(99)(false);var u=r(126)("IE_PROTO");e.exports=function(e,t){var r=s(e);var i=0;var n=[];var a;for(a in r)if(a!=u)o(r,a)&&n.push(a);while(t.length>i)if(o(r,a=t[i++])){~l(n,a)||n.push(a)}return n}},function(e,t,r){var s=r(15);var l=r(4);var u=r(59);e.exports=r(14)?Object.defineProperties:function e(t,r){l(t);var i=u(r);var n=i.length;var a=0;var o;while(n>a)s.f(t,o=i[a++],r[o]);return t}},function(e,t,r){var i=r(26);var n=r(62).f;var a={}.toString;var o=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var s=function(e){try{return n(e)}catch(e){return o.slice()}};e.exports.f=function e(t){return o&&a.call(t)=="[object Window]"?s(t):n(i(t))}},function(e,t,r){"use strict";var h=r(59);var p=r(100);var v=r(86);var m=r(16);var _=r(85);var n=Object.assign;e.exports=!n||r(7)(function(){var e={};var t={};var r=Symbol();var i="abcdefghijklmnopqrst";e[r]=7;i.split("").forEach(function(e){t[e]=e});return n({},e)[r]!=7||Object.keys(n({},t)).join("")!=i})?function e(t,r){var i=m(t);var n=arguments.length;var a=1;var o=p.f;var s=v.f;while(n>a){var l=_(arguments[a++]);var u=o?h(l).concat(o(l)):h(l);var d=u.length;var c=0;var f;while(d>c)if(s.call(l,f=u[c++]))i[f]=l[f]}return i}:n},function(e,t){e.exports=Object.is||function e(t,r){return t===r?t!==0||1/t===1/r:t!=t&&r!=r}},function(e,t,r){"use strict";var a=r(19);var o=r(8);var s=r(188);var l=[].slice;var u={};var d=function(e,t,r){if(!(t in u)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";u[t]=Function("F,a","return new F("+i.join(",")+")")}return u[t](e,r)};e.exports=Function.bind||function e(t){var r=a(this);var i=l.call(arguments,1);var n=function(){var e=i.concat(l.call(arguments));return this instanceof n?d(r,e.length,e):s(r,e,t)};if(o(r.prototype))n.prototype=r.prototype;return n}},function(e,t){e.exports=function(e,t,r){var i=r===undefined;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(6).parseInt;var a=r(76).trim;var i=r(130);var o=/^[-+]?0[xX]/;e.exports=n(i+"08")!==8||n(i+"0x16")!==22?function e(t,r){var i=a(String(t),3);return n(i,r>>>0||(o.test(i)?16:10))}:n},function(e,t,r){var n=r(6).parseFloat;var a=r(76).trim;e.exports=1/n(r(130)+"-0")!==-Infinity?function e(t){var r=a(String(t),3);var i=n(r);return i===0&&r.charAt(0)=="-"?-0:i}:n},function(e,t,r){var i=r(31);e.exports=function(e,t){if(typeof e!="number"&&i(e)!="Number")throw TypeError(t);return+e}},function(e,t,r){var i=r(8);var n=Math.floor;e.exports=function e(t){return!i(t)&&isFinite(t)&&n(t)===t}},function(e,t){e.exports=Math.log1p||function e(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(e,t,r){var o=r(133);var i=Math.pow;var s=i(2,-52);var l=i(2,-23);var u=i(2,127)*(2-l);var d=i(2,-126);var c=function(e){return e+1/s-1/s};e.exports=Math.fround||function e(t){var r=Math.abs(t);var i=o(t);var n,a;if(r<d)return i*c(r/d/l)*d*l;n=(1+l/s)*r;a=n-(n-r);if(a>u||a!=a)return i*Infinity;return i*a}},function(e,t,r){var a=r(4);e.exports=function(t,e,r,i){try{return i?e(a(r)[0],r[1]):e(r)}catch(e){var n=t["return"];if(n!==undefined)a(n.call(t));throw e}}},function(e,t,r){var d=r(19);var c=r(16);var f=r(85);var h=r(12);e.exports=function(e,t,r,i,n){d(t);var a=c(e);var o=f(a);var s=h(a.length);var l=n?s-1:0;var u=n?-1:1;if(r<2)for(;;){if(l in o){i=o[l];l+=u;break}l+=u;if(n?l<0:s<=l){throw TypeError("Reduce of empty array with no initial value")}}for(;n?l>=0:s>l;l+=u)if(l in o){i=t(i,o[l],l,a)}return i}},function(e,t,r){"use strict";var d=r(16);var c=r(60);var f=r(12);e.exports=[].copyWithin||function e(t,r){var i=d(this);var n=f(i.length);var a=c(t,n);var o=c(r,n);var s=arguments.length>2?arguments[2]:undefined;var l=Math.min((s===undefined?n:c(s,n))-o,n-a);var u=1;if(o<a&&a<o+l){u=-1;o+=l-1;a+=l-1}while(l-- >0){if(o in i)i[a]=i[o];else delete i[a];a+=u;o+=u}return i}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){"use strict";var i=r(145);r(0)({target:"RegExp",proto:true,forced:i!==/./.exec},{exec:i})},function(e,t,r){if(r(14)&&/./g.flags!="g")r(15).f(RegExp.prototype,"flags",{configurable:true,get:r(87)})},function(e,t){e.exports=function(e){try{return{e:false,v:e()}}catch(e){return{e:true,v:e}}}},function(e,t,r){var n=r(4);var a=r(8);var o=r(149);e.exports=function(e,t){n(e);if(a(t)&&t.constructor===e)return t;var r=o.f(e);var i=r.resolve;i(t);return r.promise}},function(e,t,r){"use strict";var i=r(204);var n=r(78);var a="Map";e.exports=r(108)(a,function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}},{get:function e(t){var r=i.getEntry(n(this,a),t);return r&&r.v},set:function e(t,r){return i.def(n(this,a),t===0?0:t,r)}},i,true)},function(e,t,r){"use strict";var o=r(15).f;var s=r(61);var l=r(66);var u=r(30);var d=r(64);var c=r(65);var i=r(135);var n=r(198);var a=r(63);var f=r(14);var h=r(50).fastKey;var p=r(78);var v=f?"_s":"size";var m=function(e,t){var r=h(t);var i;if(r!=="F")return e._i[r];for(i=e._f;i;i=i.n){if(i.k==t)return i}};e.exports={getConstructor:function(e,a,r,i){var n=e(function(e,t){d(e,n,a,"_i");e._t=a;e._i=s(null);e._f=undefined;e._l=undefined;e[v]=0;if(t!=undefined)c(t,r,e[i],e)});l(n.prototype,{clear:function e(){for(var t=p(this,a),r=t._i,i=t._f;i;i=i.n){i.r=true;if(i.p)i.p=i.p.n=undefined;delete r[i.i]}t._f=t._l=undefined;t[v]=0},delete:function(e){var t=p(this,a);var r=m(t,e);if(r){var i=r.n;var n=r.p;delete t._i[r.i];r.r=true;if(n)n.n=i;if(i)i.p=n;if(t._f==r)t._f=i;if(t._l==r)t._l=n;t[v]--}return!!r},forEach:function e(t){p(this,a);var r=u(t,arguments.length>1?arguments[1]:undefined,3);var i;while(i=i?i.n:this._f){r(i.v,i.k,this);while(i&&i.r)i=i.p}},has:function e(t){return!!m(p(this,a),t)}});if(f)o(n.prototype,"size",{get:function(){return p(this,a)[v]}});return n},def:function(e,t,r){var i=m(e,t);var n,a;if(i){i.v=r}else{e._l=i={i:a=h(t,true),k:t,v:r,p:n=e._l,n:undefined,r:false};if(!e._f)e._f=i;if(n)n.n=i;e[v]++;if(a!=="F")e._i[a]=i}return e},getEntry:m,setStrong:function(e,r,t){i(e,r,function(e,t){this._t=p(e,r);this._k=t;this._l=undefined},function(){var e=this;var t=e._k;var r=e._l;while(r&&r.r)r=r.p;if(!e._t||!(e._l=r=r?r.n:e._t._f)){e._t=undefined;return n(1)}if(t=="keys")return n(0,r.k);if(t=="values")return n(0,r.v);return n(0,[r.k,r.v])},t?"entries":"values",!t,true);a(r)}}},function(e,t,r){"use strict";var i=r(204);var n=r(78);var a="Set";e.exports=r(108)(a,function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}},{add:function e(t){return i.def(n(this,a),t=t===0?0:t,t)}},i)},function(e,t,r){"use strict";var i=r(41)(0);var a=r(23);var n=r(50);var o=r(185);var s=r(207);var l=r(8);var u=r(7);var d=r(78);var c="WeakMap";var f=n.getWeak;var h=Object.isExtensible;var p=s.ufstore;var v={};var m;var _=function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}};var y={get:function e(t){if(l(t)){var r=f(t);if(r===true)return p(d(this,c)).get(t);return r?r[this._i]:undefined}},set:function e(t,r){return s.def(d(this,c),t,r)}};var g=e.exports=r(108)(c,_,y,s,true,true);if(u(function(){return(new g).set((Object.freeze||Object)(v),7).get(v)!=7})){m=s.getConstructor(_,c);o(m.prototype,y);n.NEED=true;i(["delete","has","get","set"],function(i){var e=g.prototype;var n=e[i];a(e,i,function(e,t){if(l(e)&&!h(e)){if(!this._f)this._f=new m;var r=this._f[i](e,t);return i=="set"?this:r}return n.call(this,e,t)})})}},function(e,t,r){"use strict";var o=r(66);var s=r(50).getWeak;var n=r(4);var l=r(8);var u=r(64);var d=r(65);var i=r(41);var c=r(25);var f=r(78);var a=i(5);var h=i(6);var p=0;var v=function(e){return e._l||(e._l=new m)};var m=function(){this.a=[]};var _=function(e,t){return a(e.a,function(e){return e[0]===t})};m.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var r=_(this,e);if(r)r[1]=t;else this.a.push([e,t])},delete:function(t){var e=h(this.a,function(e){return e[0]===t});if(~e)this.a.splice(e,1);return!!~e}};e.exports={getConstructor:function(e,i,r,n){var a=e(function(e,t){u(e,a,i,"_i");e._t=i;e._i=p++;e._l=undefined;if(t!=undefined)d(t,r,e[n],e)});o(a.prototype,{delete:function(e){if(!l(e))return false;var t=s(e);if(t===true)return v(f(this,i))["delete"](e);return t&&c(t,this._i)&&delete t[this._i]},has:function e(t){if(!l(t))return false;var r=s(t);if(r===true)return v(f(this,i)).has(t);return r&&c(r,this._i)}});return a},def:function(e,t,r){var i=s(n(t),true);if(i===true)v(e).set(t,r);else i[e._i]=r;return e},ufstore:v}},function(e,t,r){var i=r(32);var n=r(12);e.exports=function(e){if(e===undefined)return 0;var t=i(e);var r=n(t);if(t!==r)throw RangeError("Wrong length!");return r}},function(e,t,r){var n=r(62);var a=r(100);var o=r(4);var i=r(6).Reflect;e.exports=i&&i.ownKeys||function e(t){var r=n.f(o(t));var i=a.f;return i?r.concat(i(t)):r}},function(e,t,r){"use strict";var h=r(101);var p=r(8);var v=r(12);var m=r(30);var _=r(11)("isConcatSpreadable");function y(e,t,r,i,n,a,o,s){var l=n;var u=0;var d=o?m(o,s,3):false;var c,f;while(u<i){if(u in r){c=d?d(r[u],u,t):r[u];f=false;if(p(c)){f=c[_];f=f!==undefined?!!f:h(c)}if(f&&a>0){l=y(e,t,c,v(c.length),l,a-1)-1}else{if(l>=9007199254740991)throw TypeError();e[l]=c}l++}u++}return l}e.exports=y},function(e,t,r){var d=r(12);var c=r(132);var f=r(39);e.exports=function(e,t,r,i){var n=String(f(e));var a=n.length;var o=r===undefined?" ":String(r);var s=d(t);if(s<=a||o=="")return n;var l=s-a;var u=c.call(o,Math.ceil(l/o.length));if(u.length>l)u=u.slice(0,l);return i?u+n:n+u}},function(e,t,r){var l=r(59);var u=r(26);var d=r(86).f;e.exports=function(s){return function(e){var t=u(e);var r=l(t);var i=r.length;var n=0;var a=[];var o;while(i>n)if(d.call(t,o=r[n++])){a.push(s?[o,t[o]]:t[o])}return a}}},function(e,t,r){var i=r(75);var n=r(214);e.exports=function(t){return function e(){if(i(this)!=t)throw TypeError(t+"#toJSON isn't generic");return n(this)}}},function(e,t,r){var i=r(65);e.exports=function(e,t){var r=[];i(e,false,r.push,r,t);return r}},function(e,t){e.exports=Math.scale||function e(t,r,i,n,a){if(arguments.length===0||t!=t||r!=r||i!=i||n!=n||a!=a)return NaN;if(t===Infinity||t===-Infinity)return t;return(t-r)*(a-n)/(i-r)+n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){e.exports=!r(43)&&!r(68)(function(){return Object.defineProperty(r(154)("div"),"a",{get:function(){return 7}}).a!=7})},function(e,t,r){e.exports=r(54)},function(e,t,r){var o=r(69);var s=r(67);var l=r(482)(false);var u=r(157)("IE_PROTO");e.exports=function(e,t){var r=s(e);var i=0;var n=[];var a;for(a in r)if(a!=u)o(r,a)&&n.push(a);while(t.length>i)if(o(r,a=t[i++])){~l(n,a)||n.push(a)}return n}},function(e,t,r){var i=r(20).document;e.exports=i&&i.documentElement},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPModelsStyleManager=undefined;var i=r(118);var d=f(i);var n=r(3);var g=f(n);var a=r(35);var c=f(a);var o=r(1);var s=f(o);var l=r(2);var u=f(l);function f(e){return e&&e.__esModule?e:{default:e}}var h=new Freedo.Color(0,0,0,0);var p=function(){function t(e){(0,s.default)(this,t);this._viewer=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._tilesetStyleMap=new c.default;this.lastPickedPrimitive=undefined}(0,u.default)(t,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"update",value:function e(t,y){var r=this;if(y._visibleArray.size===0){y._visible=false}t.style=new Freedo.FreedoPModelStyle({color:{evaluateColor:function e(t,r,i){if(!Freedo.defined(t)){return Freedo.Color.fromBytes(255,255,255,255)}if(t instanceof Freedo.FreedoPModelFeature){var n=y._colorArray;var a=true;var o=false;var s=undefined;try{for(var l=(0,g.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;if(t.hasHierarchyProperty("component",d[0])){var c=d[1];return Freedo.Color.fromBytes(c[0],c[1],c[2],c[3]*255,r)}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}var f=y.restColor;return Freedo.Color.fromBytes(f[0],f[1],f[2],f[3]*255,r)}else{var n=y._colorArray;var h=true;var p=false;var v=undefined;try{for(var m=(0,g.default)(n),_;!(h=(_=m.next()).done);h=true){var d=_.value;if(r.hasHierarchyProperty("component",d[0])){var c=d[1];return Freedo.Color.fromBytes(c[0],c[1],c[2],c[3]*255,i)}}}catch(e){p=true;v=e}finally{try{if(!h&&m.return){m.return()}}finally{if(p){throw v}}}var f=y.restColor;return Freedo.Color.fromBytes(f[0],f[1],f[2],f[3]*255,i)}}},show:{evaluate:function e(t,r,i){if(!Freedo.defined(t)){return true}if(t instanceof Freedo.FreedoPModelFeature){var n=true;var a=false;var o=undefined;try{for(var s=(0,g.default)(y._visibleArray),l;!(n=(l=s.next()).done);n=true){var u=l.value;if(t.hasHierarchyProperty("component",u)){return y._visible}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}return!y._visible}else{var d=true;var c=false;var f=undefined;try{for(var h=(0,g.default)(y._visibleArray),p;!(d=(p=h.next()).done);d=true){var u=p.value;if(r.hasHierarchyProperty("component",u)){return y._visible}}}catch(e){c=true;f=e}finally{try{if(!d&&h.return){h.return()}}finally{if(c){throw f}}}return!y._visible}}}})}},{key:"clone",value:function e(t,r){t.forEach(function(e){r.add(e)})}},{key:"showComponentsArray",value:function e(t,r,i){var n;if(this._tilesetStyleMap.has(t)){n=this._tilesetStyleMap.get(t);n._visibleArray.clear();n._visibleArray=new d.default(r)}else{var a=new c.default;var o=new d.default(r);n={_colorArray:a,_visibleArray:o,_visible:i,restColor:[255,255,255,1]};this._tilesetStyleMap.set(t,n)}this.update(t,n)}},{key:"replaceHighlightComponent",value:function e(t,r,i,n,a){if(this._tilesetStyleMap.has(t)){var o=this._tilesetStyleMap.get(t);if(i==="color"){o._colorArray.clear()}else{o._visibleArray.clear()}}this.addHighlightComponent(t,r,i,n,a)}},{key:"addHighlightComponent",value:function e(t,r,i,n,a){var o;a=Freedo.defaultValue(a,[255,255,255,1]);if(this._tilesetStyleMap.has(t)){o=this._tilesetStyleMap.get(t);if(i==="color"){if(Freedo.defined(r)&&r.length>0){o._colorArray.set(r,n)}}else{if(o._visible!==n){if(!Freedo.defined(o._lastVisibleArray)){o._lastVisibleArray=new d.default}this.clone(o._visibleArray,o._lastVisibleArray);o._visibleArray.clear();o._visible=n}if(Freedo.defined(r)&&r.length>0){o._visibleArray.add(r)}}}else{var s=new c.default;var l=new d.default;var u=false;if(i==="color"){if(Freedo.defined(r)&&r.length>0){s.set(r,n)}}else{if(Freedo.defined(r)&&r.length>0){l.add(r)}u=n}o={_colorArray:s,_visibleArray:l,_visible:u};this._tilesetStyleMap.set(t,o)}o.restColor=a;this.update(t,o)}},{key:"deleteHighlightComponent",value:function e(t,r,i){if(!this._tilesetStyleMap.has(t)){return}var n=this._tilesetStyleMap.get(t);if(i==="color"){if(n._colorArray.has(r)){n._colorArray.delete(r)}}else{if(n._visibleArray.has(r)){n._visibleArray.delete(r);if(Freedo.defined(n._lastVisibleArray)&&n._lastVisibleArray.size>0){this.clone(n._lastVisibleArray,n._visibleArray);n._visible=!n._visible}if(n._visibleArray.size===0){n._visible=false}}}this.update(t,n)}},{key:"pickComponent",value:function e(t,r,i){var n=this._viewer.scene.pick(t);if(Freedo.defined(n)){if(Freedo.defined(n.tileset)){var a=n.getProperty("component");if(Freedo.defined(a)){var o=undefined;if(i){o=n.getAncestors("component")}r(a,n.tileset,o);this._event.raiseEvent("selectedComponent",n);return}}if(n.primitive instanceof Freedo.Model){if(Freedo.defined(n.node)){r(n.node.name,n,"Gltf");return}}}r(undefined,undefined)}},{key:"highlightGltf",value:function e(t){if(!Freedo.defined(this.lastPickedPrimitive)){return}var r=this.lastPickedPrimitive.primitive.gltf;var i=r.nodes;if(!Freedo.defined(t)){for(var n=0;n<i.length;n++){if(i[n].name===this.lastPickedPrimitive.node.name){i[n].highlightComponentColor=undefined}}return}for(var n=0;n<i.length;n++){if(i[n].name===this.lastPickedPrimitive.node.name){i[n].highlightComponentColor=Freedo.clone(t,true)}}}},{key:"separateGltfComponent",value:function e(t){for(var r=0;r<t.length;r++){var i=t[r];var n=i.models;for(var a=0;a<n.length;a++){n[a].show=false}}this.lastPickedPrimitive.primitive.show=true;var o=this.lastPickedPrimitive.primitive.gltf;var s=o.nodes;for(var r=0;r<s.length;r++){if(s[r].name===this.lastPickedPrimitive.node.name)continue;s[r].highlightComponentColor=h}}}]);return t}();t.FdPModelsStyleManager=p},function(e,t,r){"use strict";var o=r(34).f;var s=r(113);var l=r(161);var u=r(53);var d=r(162);var c=r(95);var i=r(153);var n=r(216);var a=r(225);var f=r(43);var h=r(163).fastKey;var p=r(164);var v=f?"_s":"size";var m=function(e,t){var r=h(t);var i;if(r!=="F")return e._i[r];for(i=e._f;i;i=i.n){if(i.k==t)return i}};e.exports={getConstructor:function(e,a,r,i){var n=e(function(e,t){d(e,n,a,"_i");e._t=a;e._i=s(null);e._f=undefined;e._l=undefined;e[v]=0;if(t!=undefined)c(t,r,e[i],e)});l(n.prototype,{clear:function e(){for(var t=p(this,a),r=t._i,i=t._f;i;i=i.n){i.r=true;if(i.p)i.p=i.p.n=undefined;delete r[i.i]}t._f=t._l=undefined;t[v]=0},delete:function(e){var t=p(this,a);var r=m(t,e);if(r){var i=r.n;var n=r.p;delete t._i[r.i];r.r=true;if(n)n.n=i;if(i)i.p=n;if(t._f==r)t._f=i;if(t._l==r)t._l=n;t[v]--}return!!r},forEach:function e(t){p(this,a);var r=u(t,arguments.length>1?arguments[1]:undefined,3);var i;while(i=i?i.n:this._f){r(i.v,i.k,this);while(i&&i.r)i=i.p}},has:function e(t){return!!m(p(this,a),t)}});if(f)o(n.prototype,"size",{get:function(){return p(this,a)[v]}});return n},def:function(e,t,r){var i=m(e,t);var n,a;if(i){i.v=r}else{e._l=i={i:a=h(t,true),k:t,v:r,p:n=e._l,n:undefined,r:false};if(!e._f)e._f=i;if(n)n.n=i;e[v]++;if(a!=="F")e._i[a]=i}return e},getEntry:m,setStrong:function(e,r,t){i(e,r,function(e,t){this._t=p(e,r);this._k=t;this._l=undefined},function(){var e=this;var t=e._k;var r=e._l;while(r&&r.r)r=r.p;if(!e._t||!(e._l=r=r?r.n:e._t._f)){e._t=undefined;return n(1)}if(t=="keys")return n(0,r.k);if(t=="values")return n(0,r.v);return n(0,[r.k,r.v])},t?"entries":"values",!t,true);a(r)}}},function(e,t,r){var a=r(47);e.exports=function(t,e,r,i){try{return i?e(a(r)[0],r[1]):e(r)}catch(e){var n=t["return"];if(n!==undefined)a(n.call(t));throw e}}},function(e,t,r){var i=r(80);var n=r(21)("iterator");var a=Array.prototype;e.exports=function(e){return e!==undefined&&(i.Array===e||a[n]===e)}},function(e,t,r){"use strict";var i=r(20);var n=r(13);var a=r(34);var o=r(43);var s=r(21)("species");e.exports=function(e){var t=typeof n[e]=="function"?n[e]:i[e];if(o&&t&&!t[s])a.f(t,s,{configurable:true,get:function(){return this}})}},function(e,t,r){"use strict";var c=r(20);var f=r(17);var h=r(163);var p=r(68);var v=r(54);var m=r(161);var _=r(95);var y=r(162);var g=r(42);var w=r(93);var F=r(34).f;var b=r(490)(0);var C=r(43);e.exports=function(r,e,t,i,n,a){var o=c[r];var s=o;var l=n?"set":"add";var u=s&&s.prototype;var d={};if(!C||typeof s!="function"||!(a||u.forEach&&!p(function(){(new s).entries().next()}))){s=i.getConstructor(e,r,n,l);m(s.prototype,t);h.NEED=true}else{s=e(function(e,t){y(e,s,r,"_c");e._c=new o;if(t!=undefined)_(t,n,e[l],e)});b("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(i){var n=i=="add"||i=="set";if(i in u&&!(a&&i=="clear"))v(s.prototype,i,function(e,t){y(this,s,i);if(!n&&a&&!g(e))return i=="get"?undefined:false;var r=this._c[i](e===0?0:e,t);return n?this:r})});a||F(s.prototype,"size",{get:function(){return this._c.size}})}w(s,r);d[r]=s;f(f.G+f.W+f.F,d);if(!a)i.setStrong(s,r,n);return s}},function(e,t,r){var i=r(89);e.exports=Array.isArray||function e(t){return i(t)=="Array"}},function(e,t,r){var i=r(116);var n=r(494);e.exports=function(t){return function e(){if(i(this)!=t)throw TypeError(t+"#toJSON isn't generic");return n(this)}}},function(e,t,r){"use strict";var i=r(17);e.exports=function(e){i(i.S,e,{of:function e(){var t=arguments.length;var r=new Array(t);while(t--)r[t]=arguments[t];return new this(r)}})}},function(e,t,r){"use strict";var i=r(17);var s=r(91);var l=r(53);var u=r(95);e.exports=function(e){i(i.S,e,{from:function e(t){var r=arguments[1];var i,n,a,o;s(this);i=r!==undefined;if(i)s(r);if(t==undefined)return new this;n=[];if(i){a=0;o=l(r,arguments[2],2);u(t,false,function(e){n.push(o(e,a++))})}else{u(t,false,n.push,n)}return new this(n)}})}},function(e,t,r){e.exports={default:r(502),__esModule:true}},function(e,t,r){e.exports={default:r(507),__esModule:true}},function(e,t,r){var a=r(21)("iterator");var o=false;try{var i=[7][a]();i["return"]=function(){o=true};Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return false;var r=false;try{var i=[7];var n=i[a]();n.next=function(){return{done:r=true}};i[a]=function(){return n};e(i)}catch(e){}return r}},function(e,t){var r=e.exports={};var i;var n;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=a}}catch(e){i=a}try{if(typeof clearTimeout==="function"){n=clearTimeout}else{n=o}}catch(e){n=o}})();function s(t){if(i===setTimeout){return setTimeout(t,0)}if((i===a||!i)&&setTimeout){i=setTimeout;return setTimeout(t,0)}try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}function l(t){if(n===clearTimeout){return clearTimeout(t)}if((n===o||!n)&&clearTimeout){n=clearTimeout;return clearTimeout(t)}try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}var u=[];var d=false;var c;var f=-1;function h(){if(!d||!c){return}d=false;if(c.length){u=c.concat(u)}else{f=-1}if(u.length){p()}}function p(){if(d){return}var e=s(h);d=true;var t=u.length;while(t){c=u;u=[];while(++f<t){if(c){c[f].run()}}f=-1;t=u.length}c=null;d=false;l(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}u.push(new v(e,t));if(u.length===1&&!d){s(p)}};function v(e,t){this.fun=e;this.array=t}v.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function m(){}r.on=m;r.addListener=m;r.once=m;r.off=m;r.removeListener=m;r.removeAllListeners=m;r.emit=m;r.prependListener=m;r.prependOnceListener=m;r.listeners=function(e){return[]};r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function h(){}h.getHeading=function(e){if(!Freedo.defined(e)){throw new Freedo.DeveloperError("camera is required")}return s(e.direction,e.up)};h.getPitch=function(e){if(!Freedo.defined(e)){throw new Freedo.DeveloperError("camera is required")}return w(e.direction)};h.lookAt=function(e,t,r){if(!Freedo.defined(e)){throw new Freedo.DeveloperError("camera is required")}if(!Freedo.defined(t)){throw new Freedo.DeveloperError("target is required")}if(!Freedo.defined(r)){throw new Freedo.DeveloperError("offset is required")}var i;if(Freedo.defined(r.heading)){i=F(r.heading,r.pitch,r.range)}else{i=r}Freedo.Cartesian3.add(t,i,e.position);Freedo.Cartesian3.subtract(t,e.position,b);Freedo.Cartesian3.normalize(b,e.direction);if(Freedo.Cartesian3.equalsEpsilon(e.direction,Freedo.Cartesian3.UNIT_Z,Freedo.Math.EPSILON4)){Freedo.Cartesian3.fromElements(0,-1,0,x)}else if(Freedo.Cartesian3.equalsEpsilon(e.direction,M,Freedo.Math.EPSILON4)){Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Y,x)}else{Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Z,x)}Freedo.Cartesian3.cross(b,x,C);Freedo.Cartesian3.cross(C,b,x);Freedo.Cartesian3.normalize(x,e.up);Freedo.Cartesian3.normalize(C,e.right)};h.setView=function(e,t){if(!Freedo.defined(e)){throw new Freedo.DeveloperError("camera is required")}t=Freedo.defaultValue(t,Freedo.defaultValue.EMPTY_OBJECT);var r=Freedo.defaultValue(t.orientation,Freedo.defaultValue.EMPTY_OBJECT);var i=Freedo.defaultValue(t.destination,Freedo.Cartesian3.clone(e.position,P));var n=e.direction;var a=e.up;if(Freedo.defined(r.direction)&&Freedo.defined(r.up)){n=r.direction;a=r.up}else if(Freedo.defined(r.heading)||Freedo.defined(r.pitch)){var o=Freedo.defaultValue(r.heading,0);var s=Freedo.defaultValue(r.pitch,0);var l=F(o,s,1);Freedo.Cartesian3.negate(l,b);n=Freedo.Cartesian3.normalize(b,b);if(Freedo.Cartesian3.equalsEpsilon(n,Freedo.Cartesian3.UNIT_Z,Freedo.Math.EPSILON4)){a=Freedo.Cartesian3.fromElements(0,-1,0,x)}else if(Freedo.Cartesian3.equalsEpsilon(n,M,Freedo.Math.EPSILON4)){a=Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Y,x)}else{a=Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Z,x)}}var u=Freedo.Cartesian3.cross(n,a,C);a=Freedo.Cartesian3.cross(u,n,x);Freedo.Cartesian3.clone(i,e.position);Freedo.Cartesian3.normalize(n,e.direction);Freedo.Cartesian3.normalize(a,e.up);Freedo.Cartesian3.normalize(u,e.right)};h.flyTo=function(e,t){t=Freedo.defaultValue(t,Freedo.defaultValue.EMPTY_OBJECT);var r=t.destination;if(!Freedo.defined(e)){throw new Freedo.DeveloperError("scene is required.")}if(!Freedo.defined(r)){throw new Freedo.DeveloperError("destination is required.")}h.cancelFlight();var i=Freedo.defaultValue(t.orientation,Freedo.defaultValue.EMPTY_OBJECT);if(Freedo.defined(i.direction)){i=A(e.camera,r,i,o.orientation)}var n;a.destination=r;a.heading=i.heading;a.pitch=i.pitch;a.roll=i.roll;a.duration=t.duration;a.complete=function(){if(n===k._currentFlight){k._currentFlight=undefined}if(Freedo.defined(t.complete)){t.complete()}};a.cancel=t.cancel;a.easingFunction=t.easingFunction;n=e.tweens.add(k.createTween(e,a));h._currentFlight=n};function c(e,t){var r=e.frustum;var i=Math.tan(r.fovy*.5);var n=r.aspectRatio*i;return Math.max(t/n,t/i)}var l=new Freedo.Cartesian3;var u=new Freedo.Quaternion;var d=new Freedo.Quaternion;var f=new Freedo.Matrix3;var i=new Freedo.Matrix4;var p=new Freedo.Cartesian3;var v=new Freedo.Cartesian3;var m=new Freedo.Cartesian3;var _=new Freedo.Cartesian3;var n=new Freedo.Cartesian4;var y=new Freedo.Quaternion;var g=new Freedo.Matrix3;h.flyToBoundingSphere=function(e,t,r){if(!Freedo.defined(t)){throw new DeveloperError("boundingSphere is required.")}var i=e.camera;r=Freedo.defaultValue(r,Freedo.defaultValue.EMPTY_OBJECT);i._setTransform(Freedo.Matrix4.IDENTITY);var n=r.offset;if(!Freedo.defined(n)){n=Freedo.HeadingPitchRange.clone(Freedo.Camera.DEFAULT_OFFSET)}if(!Freedo.defined(n.range)||n.range===0){n.range=c(i,t.radius)}var a=F(n.heading,n.pitch,n.range);a=Freedo.Cartesian3.add(a,t.center,p);var o;var s;o=Freedo.Cartesian3.subtract(t.center,a,v);Freedo.Cartesian3.normalize(o,o);s=Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Z,m);if(1-Math.abs(Freedo.Cartesian3.dot(o,s))<Freedo.Math.EPSILON6){var l=Freedo.Quaternion.fromAxisAngle(o,n.heading,y);var u=Freedo.Matrix3.fromQuaternion(l,g);s=Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Y,m);Freedo.Matrix3.multiplyByVector(u,s,s)}var d=Freedo.Cartesian3.cross(o,s,_);Freedo.Cartesian3.cross(d,o,s);Freedo.Cartesian3.normalize(s,s);h.flyTo(e,{destination:a,orientation:{direction:o,up:s},duration:r.duration,complete:r.complete,cancel:r.cancel,endTransform:r.endTransform,maximumHeight:r.maximumHeight,easingFunction:r.easingFunction,flyOverLongitude:r.flyOverLongitude,flyOverLongitudeWeight:r.flyOverLongitudeWeight,pitchAdjustHeight:r.pitchAdjustHeight})};h.cancelFlight=function(){if(Freedo.defined(h._currentFlight)){h._currentFlight.cancelTween();h._currentFlight=undefined}};function s(e,t){var r=0;if(e.z<Freedo.Math.EPSILON5-1){r=Math.atan2(t.x,t.y)}else if(e.z>1-Freedo.Math.EPSILON5){r=Math.atan2(-t.x,-t.y)}else{r=Math.atan2(e.x,e.y)}if(isNaN(r)){throw new Freedo.DeveloperError("")}return r}function w(e){var t=0;if(e.z<Freedo.Math.EPSILON5-1){t=-Freedo.Math.PI_OVER_TWO}else if(e.z>1-Freedo.Math.EPSILON5){t=Freedo.Math.PI_OVER_TWO}else{var r=Math.sqrt(e.x*e.x+e.y*e.y);t=Math.atan(e.z/r)}if(isNaN(t)){throw new Freedo.DeveloperError("")}return t}var l=new Freedo.Cartesian3;var u=new Freedo.Quaternion;var d=new Freedo.Quaternion;var f=new Freedo.Matrix3;function F(e,t,r){t=Freedo.Math.clamp(t,-Freedo.Math.PI_OVER_TWO,Freedo.Math.PI_OVER_TWO);e=Freedo.Math.zeroToTwoPi(e);var i=Freedo.Quaternion.fromAxisAngle(Freedo.Cartesian3.UNIT_X,t,u);var n=Freedo.Quaternion.fromAxisAngle(Freedo.Cartesian3.UNIT_Z,-e,d);var a=Freedo.Quaternion.multiply(n,i,n);var o=Freedo.Matrix3.fromQuaternion(a,f);var s=Freedo.Cartesian3.clone(Freedo.Cartesian3.UNIT_Y,l);Freedo.Matrix3.multiplyByVector(o,s,s);Freedo.Cartesian3.negate(s,s);Freedo.Cartesian3.multiplyByScalar(s,r,s);return s}var b=new Freedo.Cartesian3;var C=new Freedo.Cartesian3;var x=new Freedo.Cartesian3;var P=new Freedo.Cartesian3;var M=new Freedo.Cartesian3(0,0,-1);h._currentFlight=undefined;var a={destination:undefined,heading:undefined,pitch:undefined,roll:undefined,duration:undefined,complete:undefined,cancel:undefined,easingFunction:undefined};var o={destination:undefined,orientation:{direction:undefined,up:undefined,heading:undefined,pitch:undefined,roll:undefined}};var T=new Freedo.Cartesian3;var E=new Freedo.Cartesian3;var S=new Freedo.Cartesian3;function A(e,t,r,i){var n=Freedo.Cartesian3.clone(r.direction,T);var a=Freedo.Cartesian3.clone(r.up,E);var o=Freedo.Cartesian3.cross(n,a,S);i.heading=s(n,a);i.pitch=w(n);i.roll=0;return i}var k={};function L(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function D(e,t){function r(){if(typeof t==="function"){t()}e.enableInputs=true}return r}function I(e,t){if(Freedo.Math.equalsEpsilon(e,Freedo.Math.TWO_PI,Freedo.Math.EPSILON11)){e=0}if(t>e+Math.PI){e+=Freedo.Math.TWO_PI}else if(t<e-Math.PI){e-=Freedo.Math.TWO_PI}return e}var R=new Freedo.Cartesian3;var O=new Freedo.Cartesian3;function N(n,a,o,s,l,u){var d=Freedo.Cartesian3.clone(n.position,R);var c=I(h.getHeading(n),s);var f=h.getPitch(n);function e(){return function e(t){var r=t.time/a;var i=Freedo.Cartesian3.lerp(d,o,r,O);h.setView(n,{destination:i,orientation:{heading:Freedo.Math.lerp(c,s,r),pitch:Freedo.Math.lerp(f,l,r),roll:Freedo.Math.lerp(0,u,r)}})}}return e()}k.createTween=function(e,t){var r=e.camera;var i=t.destination;var n=Freedo.defaultValue(t.easingFunction,Freedo.EasingFunction.LINEAR_NONE);var a=t.duration;if(!Freedo.defined(a)){a=Math.ceil(Freedo.Cartesian3.distance(r.position,i)/100)+2;a=Math.min(a,3)}var o=Freedo.defaultValue(t.heading,0);var s=Freedo.defaultValue(t.pitch,0);var l=Freedo.defaultValue(t.roll,0);var u=e.screenSpaceCameraController;u.enableInputs=false;var d=D(u,t.complete);var c=D(u,t.cancel);if(a<=0){var f=function e(){var t=N(r,1,i,o,s,l);t({time:1});if(typeof d==="function"){d()}};return L(f,c)}var h=N(r,a,i,o,s,l);return{duration:a,easingFunction:n,startObject:{time:0},stopObject:{time:a},update:h,complete:d,cancel:c}};t.FdPlaneViewCameraHelper=h},function(e,t,r){var i=r(219);var n=r(159).concat("length","prototype");t.f=Object.getOwnPropertyNames||function e(t){return i(t,n)}},function(e,I,R){(function(n,a){var s=/%[sdj%]/g;I.format=function(e){if(!F(e)){var t=[];for(var r=0;r<arguments.length;r++){t.push(l(arguments[r]))}return t.join(" ")}var r=1;var i=arguments;var n=i.length;var a=String(e).replace(s,function(e){if(e==="%%")return"%";if(r>=n)return e;switch(e){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch(e){return"[Circular]"}default:return e}});for(var o=i[r];r<n;o=i[++r]){if(c(o)||!x(o)){a+=" "+o}else{a+=" "+l(o)}}return a};I.deprecate=function(e,t){if(b(n.process)){return function(){return I.deprecate(e,t).apply(this,arguments)}}if(a.noDeprecation===true){return e}var r=false;function i(){if(!r){if(a.throwDeprecation){throw new Error(t)}else if(a.traceDeprecation){console.trace(t)}else{console.error(t)}r=true}return e.apply(this,arguments)}return i};var e={};var i;I.debuglog=function(t){if(b(i))i=a.env.NODE_DEBUG||"";t=t.toUpperCase();if(!e[t]){if(new RegExp("\\b"+t+"\\b","i").test(i)){var r=a.pid;e[t]=function(){var e=I.format.apply(I,arguments);console.error("%s %d: %s",t,r,e)}}else{e[t]=function(){}}}return e[t]};function l(e,t){var r={seen:[],stylize:u};if(arguments.length>=3)r.depth=arguments[2];if(arguments.length>=4)r.colors=arguments[3];if(d(t)){r.showHidden=t}else if(t){I._extend(r,t)}if(b(r.showHidden))r.showHidden=false;if(b(r.depth))r.depth=2;if(b(r.colors))r.colors=false;if(b(r.customInspect))r.customInspect=true;if(r.colors)r.stylize=o;return p(r,e,r.depth)}I.inspect=l;l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function o(e,t){var r=l.styles[t];if(r){return"["+l.colors[r][0]+"m"+e+"["+l.colors[r][1]+"m"}else{return e}}function u(e,t){return e}function h(e){var r={};e.forEach(function(e,t){r[e]=true});return r}function p(t,r,i){if(t.customInspect&&r&&T(r.inspect)&&r.inspect!==I.inspect&&!(r.constructor&&r.constructor.prototype===r)){var e=r.inspect(i,t);if(!F(e)){e=p(t,e,i)}return e}var n=v(t,r);if(n){return n}var a=Object.keys(r);var o=h(a);if(t.showHidden){a=Object.getOwnPropertyNames(r)}if(M(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0)){return m(r)}if(a.length===0){if(T(r)){var s=r.name?": "+r.name:"";return t.stylize("[Function"+s+"]","special")}if(C(r)){return t.stylize(RegExp.prototype.toString.call(r),"regexp")}if(P(r)){return t.stylize(Date.prototype.toString.call(r),"date")}if(M(r)){return m(r)}}var l="",u=false,d=["{","}"];if(w(r)){u=true;d=["[","]"]}if(T(r)){var c=r.name?": "+r.name:"";l=" [Function"+c+"]"}if(C(r)){l=" "+RegExp.prototype.toString.call(r)}if(P(r)){l=" "+Date.prototype.toUTCString.call(r)}if(M(r)){l=" "+m(r)}if(a.length===0&&(!u||r.length==0)){return d[0]+l+d[1]}if(i<0){if(C(r)){return t.stylize(RegExp.prototype.toString.call(r),"regexp")}else{return t.stylize("[Object]","special")}}t.seen.push(r);var f;if(u){f=_(t,r,i,o,a)}else{f=a.map(function(e){return y(t,r,i,o,e,u)})}t.seen.pop();return g(f,l,d)}function v(e,t){if(b(t))return e.stylize("undefined","undefined");if(F(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(f(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(c(t))return e.stylize("null","null")}function m(e){return"["+Error.prototype.toString.call(e)+"]"}function _(t,r,i,n,e){var a=[];for(var o=0,s=r.length;o<s;++o){if(D(r,String(o))){a.push(y(t,r,i,n,String(o),true))}else{a.push("")}}e.forEach(function(e){if(!e.match(/^\d+$/)){a.push(y(t,r,i,n,e,true))}});return a}function y(e,t,r,i,n,a){var o,s,l;l=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]};if(l.get){if(l.set){s=e.stylize("[Getter/Setter]","special")}else{s=e.stylize("[Getter]","special")}}else{if(l.set){s=e.stylize("[Setter]","special")}}if(!D(i,n)){o="["+n+"]"}if(!s){if(e.seen.indexOf(l.value)<0){if(c(r)){s=p(e,l.value,null)}else{s=p(e,l.value,r-1)}if(s.indexOf("\n")>-1){if(a){s=s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2)}else{s="\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")}}}else{s=e.stylize("[Circular]","special")}}if(b(o)){if(a&&n.match(/^\d+$/)){return s}o=JSON.stringify(""+n);if(o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){o=o.substr(1,o.length-2);o=e.stylize(o,"name")}else{o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");o=e.stylize(o,"string")}}return o+": "+s}function g(e,t,r){var i=0;var n=e.reduce(function(e,t){i++;if(t.indexOf("\n")>=0)i++;return e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(n>60){return r[0]+(t===""?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]}return r[0]+t+" "+e.join(", ")+" "+r[1]}function w(e){return Array.isArray(e)}I.isArray=w;function d(e){return typeof e==="boolean"}I.isBoolean=d;function c(e){return e===null}I.isNull=c;function t(e){return e==null}I.isNullOrUndefined=t;function f(e){return typeof e==="number"}I.isNumber=f;function F(e){return typeof e==="string"}I.isString=F;function r(e){return typeof e==="symbol"}I.isSymbol=r;function b(e){return e===void 0}I.isUndefined=b;function C(e){return x(e)&&S(e)==="[object RegExp]"}I.isRegExp=C;function x(e){return typeof e==="object"&&e!==null}I.isObject=x;function P(e){return x(e)&&S(e)==="[object Date]"}I.isDate=P;function M(e){return x(e)&&(S(e)==="[object Error]"||e instanceof Error)}I.isError=M;function T(e){return typeof e==="function"}I.isFunction=T;function E(e){return e===null||typeof e==="boolean"||typeof e==="number"||typeof e==="string"||typeof e==="symbol"||typeof e==="undefined"}I.isPrimitive=E;I.isBuffer=R(548);function S(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function L(){var e=new Date;var t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],t].join(" ")}I.log=function(){console.log("%s - %s",L(),I.format.apply(I,arguments))};I.inherits=R(549);I._extend=function(e,t){if(!t||!x(t))return e;var r=Object.keys(t);var i=r.length;while(i--){e[r[i]]=t[r[i]]}return e};function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}).call(this,R(73),R(234))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGeologySimulationManager=undefined;var i=r(35);var d=s(i);var n=r(1);var c=s(n);var a=r(2);var o=s(a);var f=r(561);var S=r(563);function s(e){return e&&e.__esModule?e:{default:e}}var A=new Freedo.Cartesian2(100,50);var k=new Freedo.Cartesian3;var L=new Freedo.Cartesian3;var D=new Freedo.Cartesian3;var I=new Freedo.Cartographic;var R=new Uint16Array([0,1,2,2,1,3]);var l=function(){function u(e,t,r){(0,c.default)(this,u);this._drillDataArray=[];this._layerTextureMap=new d.default;this._bottomName="bottom";this._debugPointEntities=undefined;this._groundErasers=[];this._geologyPrimitives=[];this._scene=e;this._lastHeightPrimitive=undefined;this._drillOptions={};if(!Freedo.defined(r)){r="../../sampleData/GeologySimulation/GeoTexture/"}var i=t.Geology.Drill;for(var n=i.length-1;n>=0;n--){this._drillDataArray.push(new f.DrillData(i[n]));var a=i[n].layer;for(var o=a.length-1;o>=0;o--){var s=a[o];if(!this._layerTextureMap.has(s.name)){this._layerTextureMap.set(s.name,r+s.texture)}}}this._layerTextureMap.set(this._bottomName,r+"bottom.jpg");var l=[];for(var n=this._drillDataArray.length-1;n>=0;n--){l.push(this._drillDataArray[n].cartesianOnZeroHeight)}this._extent=Freedo.BoundingSphere.fromPoints(l);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper}(0,o.default)(u,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"interpolateCartographics",value:function e(t,r){var i=this._scene.terrainProvider;var n=[];for(var a=1;a<t.length;a++){var o=(0,S.interpolate)(t[a-1],t[a],r);if(a===1){n.push(t[a-1])}for(var s=0;s<o.length;s++){n.push(o[s])}n.push(t[a])}if(!Freedo.defined(i)){return Freedo.when.resolve(n)}return Freedo.sampleTerrainMostDetailed(i,n)}},{key:"addDebugPoints",value:function e(t){if(!this._debugPointEntities){this._debugPointEntities=[];for(var r=this._drillDataArray.length-1;r>=0;r--){var i=t.entities.add({position:this._drillDataArray[r].cartesian,point:{pixelSize:5,color:Freedo.Color.WHITE,outlineColor:Freedo.Color.BLACK,outlineWidth:2,heightReference:Freedo.HeightReference.CLAMP_TO_GROUND}});this._debugPointEntities.push(i)}}}},{key:"addGeologyPrimitives",value:function e(v,t,r,i,n,a){var l=this._scene.primitives;var u=[];var M=[];var T=0;var o=0;for(var s=0;s<v.length-1;++s){var d=v[s];var c=v[s+1];var f=Freedo.Cartesian3.fromRadians(d.pos.longitude,d.pos.latitude,d.pos.height);var h=Freedo.Cartesian3.fromRadians(c.pos.longitude,c.pos.latitude,c.pos.height);var p=Freedo.Cartesian3.distance(f,h);b(d,c,o,p,t,r,i);o+=p;I.longitude+=d.pos.longitude;I.latitude+=d.pos.latitude}I.longitude+=v[s].pos.longitude;I.latitude+=v[s].pos.latitude;I.longitude/=v.length;I.latitude/=v.length;var m=Freedo.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(I);var _;if(i){var y=new Freedo.Cartesian3;Freedo.Cartesian3.multiplyByScalar(m,T,y);_=Freedo.Matrix4.fromTranslation(y)}else{_=Freedo.Matrix4.IDENTITY}if(n){E()}for(var s=0;s<M.length;s++){var g=M[s];var w=this._layerTextureMap.get(g.name);P(w,g,a)}F(v);return u;function F(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r].waterDepth;var n=e[r].pos;t.push(Freedo.Cartesian3.fromRadians(n.longitude,n.latitude,n.height-i))}var a=new Freedo.PolylineGeometry({positions:t,width:3,vertexFormat:Freedo.VertexFormat.POSITION_ONLY,followSurface:false});var o=l.add(new Freedo.Primitive({asynchronous:false,geometryInstances:[new Freedo.GeometryInstance({geometry:a,modelMatrix:_,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(new Freedo.Color(.3,.3,1,1))}})],appearance:new Freedo.PolylineColorAppearance({translucent:false})}));u.push(o)}function b(e,t,r,i,n,a){var o=1;var s,l;var u=0;var d=0;var c,f;var h,p;for(s=0;s<e.layers.length;++s){c=e.layers[s];f=c.name;for(l=0;l<t.layers.length;++l){h=t.layers[l];if(!h.allocated){h.allocated=true;p=h.name;if(p===f){x(o++,f,e.pos,u,u+c.thickness,t.pos,d,d+h.thickness,r,i,n,a);u+=c.thickness;d+=h.thickness;break}else{x(o++,p,e.pos,u,u,t.pos,d,d+h.thickness,r,i,n,a);d+=h.thickness}}}if(l===t.layers.length){x(o++,f,e.pos,u,u+c.thickness,t.pos,d,d,r,i,n,a);u+=c.thickness}}for(;l<t.layers.length;++l){h=t.layers[l];if(!h.allocated){h.allocated=true;p=h.name;x(o++,p,e.pos,u,u,t.pos,d,d+h.thickness,r,i,n,a);d+=h.thickness}}}function C(e,t,r){Freedo.Cartesian3.subtract(t,e,k);Freedo.Cartesian3.subtract(r,t,L);Freedo.Cartesian3.cross(k,L,D);return Freedo.Cartesian3.normalize(D,D)}function x(e,t,r,i,n,a,o,s,l,u,d,c){var f=undefined;var h=Math.max(n,s);if(T<h){T=h}for(var p=0;p<M.length;p++){if(!M[p].closed&&M[p].name===t&&Freedo.Math.equalsEpsilon(M[p].depth0,i,Freedo.Math.EPSILON5)&&Freedo.Math.equalsEpsilon(M[p].depth1,n,Freedo.Math.EPSILON5)){f=M[p];break}}if(!Freedo.defined(f)){f=[];f.closed=false;f.name=t;M.push(f)}f.depth0=o;f.depth1=s;if(o===s){f.closed=true}var v=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height);var m=Freedo.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(r);var _=Freedo.Cartesian3.fromRadians(a.longitude,a.latitude,a.height);var y=Freedo.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(a);var g=(0,S.getOffsetPoint)(v,m,-i);var w=(0,S.getOffsetPoint)(_,y,-o);var F=(0,S.getOffsetPoint)(v,m,-n);var b=(0,S.getOffsetPoint)(_,y,-s);var C=new Float64Array(4*3);C[0]=g.x;C[1]=g.y;C[2]=g.z;C[3]=F.x;C[4]=F.y;C[5]=F.z;C[6]=w.x;C[7]=w.y;C[8]=w.z;C[9]=b.x;C[10]=b.y;C[11]=b.z;var x=new Float32Array(4*2);x[0]=l/d/A.x;x[1]=i/c/A.y;x[2]=l/d/A.x;x[3]=n/c/A.y;x[4]=(l+u)/d/A.x;x[5]=o/c/A.y;x[6]=(l+u)/d/A.x;x[7]=s/c/A.y;var P=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:C}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})},indices:R,primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(C)});P.layerName=t;P.layerIndex=e;P.depth=(Math.abs(n-i)+Math.abs(s-o))/2;f.push(P)}function P(e,t,r){var i=[];var n;var a=0;for(var o=0;o<t.length;++o){i.push(new Freedo.GeometryInstance({geometry:t[o],modelMatrix:_}));n=t[o].layerName;a+=t[o].depth}a/=t.length;var s=l.add(new Freedo.Primitive({asynchronous:false,geometryInstances:i,appearance:new Freedo.MaterialAppearance({materialSupport:Freedo.MaterialAppearance.MaterialSupport.TEXTURED,material:new Freedo.Material({fabric:{materials:{first:{type:"DiffuseMap",uniforms:{image:e,repeat:A}}},uniforms:{value:[0,0,0,1]},components:{diffuse:"vec3(value[0][0], value[0][1], value[1][0]) + first.diffuse",alpha:"value[1][1]"}}})})}));s.layerName=n;s.drillsInfo=r;s.depth=a;s.offsetMatrix=_;u.push(s)}function E(){var e=[];e.closed=false;e.name="bottom";M.push(e);var t=[];var r=new Freedo.Cartesian3;for(var i=0;i<v.length;++i){var n=v[i];var a=n.layers[n.layers.length-1].depth;var o=Freedo.Cartesian3.fromRadians(n.pos.longitude,n.pos.latitude,n.pos.height);var s=Freedo.Ellipsoid.WGS84.geodeticSurfaceNormalCartographic(n.pos);var l=(0,S.getOffsetPoint)(o,s,-a);t.push(l);Freedo.Cartesian3.add(r,l,r)}Freedo.Cartesian3.multiplyByScalar(r,1/t.length,r);var u=t.length+1;var d=new Float64Array(u*3);var c=new Float32Array(u*2);var f=Number.POSITIVE_INFINITY;var h=Number.POSITIVE_INFINITY;d[0]=r.x;d[1]=r.y;d[2]=r.z;c[0]=0;c[1]=0;for(var i=0;i<u-1;i++){d[3+i*3+0]=t[i].x;d[3+i*3+1]=t[i].y;d[3+i*3+2]=t[i].z;c[2+i*2+0]=(t[i].x-r.x)/A.x;if(c[2+i*2+0]<f){f=c[2+i*2+0]}c[2+i*2+1]=(t[i].y-r.y)/A.y;if(c[2+i*2+1]<h){h=c[2+i*2+1]}}for(var i=0;i<u;i++){c[i*2+0]-=f;c[i*2+1]-=h}var p=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:c})},primitiveType:Freedo.PrimitiveType.TRIANGLE_FAN,boundingSphere:Freedo.BoundingSphere.fromVertices(d)});p.layerName="bottom";e.push(p)}}},{key:"getSimulateDrills",value:function e(t,r){var i=[];if(this._drillDataArray.length>0){var n=this;for(var a=0,o=t.length;a<o;a++){var s=(0,S.getSimulateDrill)(n,t[a],r);if(Freedo.defined(s)){i.push({pos:t[a],waterDepth:s.waterDepth,drillInfo:s.drillsInfo,layers:s.layers})}}}return i}},{key:"getRelativeDrillsInfo",value:function e(t,r){var i=[];for(var n=0;n<r.length-1;n++){var a=r[n];var o=-1,s=Number.MAX_VALUE;for(var l=0;l<t.length;l++){var u=a.longitude-t[l].pos.longitude;var d=a.latitude-t[l].pos.latitude;var c=u*u+d*d;if(s>c){o=l;s=c}}var f={drillsInfo:t[o].drillInfo,pos:t[o].pos};i.push(f)}return i}},{key:"addGeologySimulation",value:function e(l,t,u,d,c,f){if(l.length<2){throw new Freedo.RuntimeError("The input points array is invalid !")}t=Freedo.defaultValue(t,1);u=Freedo.defaultValue(u,5);d=Freedo.defaultValue(d,5);c=Freedo.defaultValue(c,false);f=Freedo.defaultValue(f,true);if(l.length>2){var r=l[0];l.push(r)}this._drillOptions["Drill"+(new Date).getTime()]={points:l,maxStep:t,tileS:u,tileT:d,flipUp:c,buildBottom:f};var h=this._scene;h.globe.depthTestAgainstTerrain=true;h.screenSpaceCameraController.enableCollisionDetection=false;var i=h.terrainProvider;var p=this;this.interpolateCartographics(l,t,i).then(function(e){var t=[];for(var r=0;r<e.length-1;r++){t.push(Freedo.Cartesian3.fromRadians(e[r].longitude,e[r].latitude,e[r].height))}var i={pints:l};if(!c){var n=new Freedo.GroundErasePrimitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(t)}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(new Freedo.Color(0,0,0,1))}}),classificationType:Freedo.ClassificationType.TERRAIN});i.erasePritive=n;p._groundErasers.push(h.primitives.add(n))}var a=p.getSimulateDrills(e,100);if(a.length>0){var o=p.getRelativeDrillsInfo(a,l);var s=p.addGeologyPrimitives(a,u,d,c,f,o);p._geologyPrimitives=p._geologyPrimitives.concat(s);i.geologyPrimitives=s}p._event.raiseEvent("dataAdded",i);p._scene.requestRender()},function(e){throw new Freedo.RuntimeError("TerrainProvider maybe invalidate. Check if there is a terrain in scene !")})}},{key:"pickGeologySimulations",value:function e(t){if(Freedo.defined(this._lastHeightPrimitive)){this._lastHeightPrimitive.appearance.material.uniforms.value=[0,0,0,1];this._lastHeightPrimitive=undefined}var r=this._scene.globe.depthTestAgainstTerrain;this._scene.globe.depthTestAgainstTerrain=true;var i=scene.pick(t);var n=undefined;if(Freedo.defined(i)&&Freedo.defined(i.primitive)){i.primitive.appearance.material.uniforms.value=[.8,.6,.6,.9];this._lastHeightPrimitive=i.primitive;n={layerName:i.primitive.layerName,depth:i.primitive.depth,primitive:i.primitive,drillsInfo:i.primitive.drillsInfo,offsetMatrix:i.primitive.offsetMatrix}}this._scene.globe.depthTestAgainstTerrain=r;this._scene.requestRender();return n}},{key:"removeAllGeologySimulations",value:function e(){this._lastHeightPrimitive=undefined;var t=this._scene;for(var r=this._groundErasers.length-1;r>=0;r--){t.primitives.remove(this._groundErasers[r])}this._groundErasers.splice(0);for(var r=this._geologyPrimitives.length-1;r>=0;r--){t.primitives.remove(this._geologyPrimitives[r])}this._geologyPrimitives.splice(0);this._event.raiseEvent("dataRemoved",{});t.requestRender()}},{key:"dispose",value:function e(){removeAllGeologySimulations();this._layerTextureMap.clear();this._drillDataArray=[];this._eventHelper.removeAll()}},{key:"drillOptions",get:function e(){return this._drillOptions}}]);return u}();t.FdGeologySimulationManager=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdEraseGroundManager=undefined;var i=r(3);var s=u(i);var n=r(1);var a=u(n);var o=r(2);var l=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function t(e){(0,a.default)(this,t);this._viewer=e;this._scene=this._viewer.scene;this._egs=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._options={}}(0,l.default)(t,[{key:"eraseGroudByPointsArray",value:function e(t,r){this._options["id_"+this._egs.length]={points:t,color:Freedo.clone(r,true)};var i=new Freedo.GroundErasePrimitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(t)}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(new Freedo.Color(r[0],r[1],r[2],1))}}),classificationType:Freedo.ClassificationType.TERRAIN,debugShowShadowVolume:false});var n=this._scene.groundPrimitives.add(i);this._egs.push(n);this._event.raiseEvent("dataAdded",{points:t,color:r,erasePrimitive:i});this._scene.requestRender()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){var t=true;var r=false;var i=undefined;try{for(var n=(0,s.default)(this._egs),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._scene.groundPrimitives.remove(o)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._options={};this._event.raiseEvent("dataRemoved",{});this._scene.requestRender()}},{key:"dispose",value:function e(){this.reset()}},{key:"eraseGroudOptions",get:function e(){return this._options}}]);return t}();t.FdEraseGroundManager=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLabelsManager=undefined;var i=r(18);var M=h(i);var n=r(241);var a=h(n);var o=r(55);var s=h(o);var l=r(1);var d=h(l);var u=r(2);var c=h(u);var f=r(117);function h(e){return e&&e.__esModule?e:{default:e}}var p=r(165);var T=(0,f.getFreedoXPath)()+"Assets/Textures/pin/pin.png";var E=(0,f.getFreedoXPath)()+"Assets/Textures/close.png";var v=function(){function u(e,t,r,i){(0,d.default)(this,u);this._viewer=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var n=e.scene.primitives.add(new Freedo.PrimitiveCollection);var a=n.add(new Freedo.BillboardCollection);var o=n.add(new Freedo.PointPrimitiveCollection);var s=n.add(new Freedo.LabelCollection);a.validWhenPicking=false;o.validWhenPicking=false;s.validWhenPicking=false;this._collection=n;this._billboards=a;this._points=o;this._texts=s;if(i){var l=n.add(new Freedo.BillboardCollection);l.validWhenPicking=false;this._billboards1=l}this._isPlaneViewer=Freedo.defaultValue(r,false);this._setData(t)}(0,c.default)(u,[{key:"addLabel",value:function e(r){if(r.name===undefined){r.name=r.text}if(r.position===undefined){var i=new Freedo.FdMicroApp.FdPolylineEditor(this._viewer);i.setAutoDelLines(true);i.setHeightOffset(0);i.run();var n=this;i.on(function(e,t){if(e=="PointAdded"){r.position=t.position;i.cancel();i.removeAll();n.addLabel(r)}})}else{var t=r.id,a=t===undefined?"":t,o=r.name,s=o===undefined?"":o,l=r.position,u=r.text,d=u===undefined?"":u,c=r.image,f=c===undefined?"":c,h=r.show,p=h===undefined?true:h,v=r.distanceDisplayCondition,m=r.rawOptionOfBillboard,_=m===undefined?{}:m,y=r.rawOptionOfPoint,g=y===undefined?{}:y,w=r.rawOptionOfLabel,F=w===undefined?{}:w;this.data.collection.push({id:a,name:s,position:l,text:d,image:f,show:p,distanceDisplayCondition:v,rawOptionOfBillboard:_,rawOptionOfPoint:g,rawOptionOfLabel:F});this._event.raiseEvent("LabelChanged");return this.data.collection.length-1}}},{key:"removeLabel",value:function e(t){this.data.collection.splice(t,1);this._event.raiseEvent("LabelChanged")}},{key:"getDataPropName",value:function e(){return"label"}},{key:"getData",value:function e(){return this._data}},{key:"setData",value:function e(t){this._data=t;this._event.raiseEvent("LabelChanged")}},{key:"setLabel",value:function e(t,r){(0,s.default)(this.data.collection[t],r)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"dispose",value:function e(){this._viewer.scene.primitives.remove(this._collection);this._collection=undefined;this._billboards=undefined;this._points=undefined;this._texts=undefined;this._data=undefined;this._mobxSpy();this._mobxSpy=undefined;this._event.raiseEvent("Changed");this._eventHelper.removeAll();this._eventHelper=undefined;this._event=undefined;this._viewer.scene.requestRender()}},{key:"_setData",value:function e(){var t=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(typeof r.show==="undefined"){r.show=true}if(typeof r.collection==="undefined"){r.collection=[]}r.collection.forEach(function(e){if(typeof e.show==="undefined"){e.show=true}});var i=p.observable(r);i.collection.forEach(function(e){e.label=t._addLabel(e)});this._data=i;this._collection.show=r.show;var n=this;this._mobxSpy=p.spy(function(e){if(e.type==="splice"){if(e.object===n._data.collection){if(e.addedCount>0){e.added.forEach(function(e){e.label=n._addLabel(e);setTimeout(function(){n._event.raiseEvent("Changed")},0)})}if(e.removedCount>0){e.removed.forEach(function(e){var t=e.label;n._removeLabel(t);setTimeout(function(){n._event.raiseEvent("Changed")},0)})}}}if(e.type==="update"){if(e.object===n._data){if(e.key==="show"){n._collection.show=e.newValue;n._viewer.scene.requestRender();n._event.raiseEvent("Changed")}else if(e.key==="collection"){n._data.collection.forEach(function(e){n._removeLabel(e.label)});e.newValue.forEach(function(e){n._addLabel(e)});setTimeout(function(){n._event.raiseEvent("Changed")},0)}}else if(typeof e.object.label!=="undefined"){if(n._containsLabel(e.object.label)){var t=e.object.label;n._setLabel(t,(0,a.default)({},e.key,e.newValue));setTimeout(function(){n._event.raiseEvent("Changed")},0)}}}})}},{key:"_addLabel",value:function e(t){var r=t.id,i=r===undefined?"":r,n=t.name,a=n===undefined?"":n,o=t.position,s=t.text,l=s===undefined?"":s,u=t.image,d=u===undefined?"":u,c=t.show,f=c===undefined?true:c,h=t.distanceDisplayCondition,p=t.rawOptionOfBillboard,v=p===undefined?{}:p,m=t.rawOptionOfPoint,_=m===undefined?{}:m,y=t.rawOptionOfLabel,g=y===undefined?{}:y;var w;var F=Number.POSITIVE_INFINITY;if(this._isPlaneViewer){w=o}else{w=Freedo.Cartesian3.fromDegrees(o[0],o[1],o[2])}if(typeof d==="undefined"||d===""){d=T}h=Freedo.defaultValue(h,new Freedo.DistanceDisplayCondition(0,2e7));var b=this._billboards.add((0,M.default)({disableDepthTestDistance:F,distanceDisplayCondition:h,id:i,position:w,show:f,image:d,pixelOffset:new Freedo.Cartesian2(0,-1),horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,width:32,height:32},v));if(Freedo.defined(this._billboards1)){var C=this._billboards1.add((0,M.default)({disableDepthTestDistance:F,distanceDisplayCondition:h,id:i+"_ErrorIcon",position:w,show:f,image:E,pixelOffset:new Freedo.Cartesian2(22,-22),horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,width:8,height:8},v))}var x=this._points.add((0,M.default)({disableDepthTestDistance:F,distanceDisplayCondition:h,id:i,position:w,show:false,pixelSize:3,color:Freedo.Color.YELLOW,outlineColor:Freedo.Color.BLACK,outlineWidth:1},_));var P=this._texts.add((0,M.default)({disableDepthTestDistance:F,distanceDisplayCondition:h,id:i,position:w,show:f,text:l,font:"16px sans-serif",fillColor:Freedo.Color.WHITE,outlineColor:Freedo.Color.BLACK,outlineWidth:1,showBackground:false,style:Freedo.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Freedo.Cartesian2(18,-16),horizontalOrigin:Freedo.HorizontalOrigin.LEFT,verticalOrigin:Freedo.VerticalOrigin.CENTER},g));this._viewer.scene.requestRender();return{text:P,point:x,billboard:b}}},{key:"_setLabel",value:function e(t,r){var i=r.position,n=r.text,a=r.image,o=r.show,s=r.id;if(typeof i!=="undefined"){var l=Freedo.Cartesian3.fromDegrees(i[0],i[1],i[2]);t.billboard.position=l;t.point.position=l;t.text.position=l}if(typeof o!=="undefined"){t.billboard.show=o;t.text.show=o}if(typeof n!=="undefined"){t.text.text=n}if(typeof a!=="undefined"&&a){t.billboard.image=a}if(typeof s!=="undefined"&&s){t.billboard.id=s}this._viewer.scene.requestRender()}},{key:"_removeLabel",value:function e(t){this._points.remove(t.point);this._texts.remove(t.text);this._billboards.remove(t.billboard);this._viewer.scene.requestRender()}},{key:"_containsLabel",value:function e(t){return this._points.contains(t.point)}},{key:"data",set:function e(t){throw new Error("FdLabelsManager不支持直接赋值！")},get:function e(){return this._data}}]);return u}();t.FdLabelsManager=v},function(e,t,r){"use strict";t.__esModule=true;var i=r(231);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){if(t in e){(0,n.default)(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}},function(e,t,r){var n=r(47);var a=r(91);var o=r(21)("species");e.exports=function(e,t){var r=n(e).constructor;var i;return r===undefined||(i=n(r)[o])==undefined?t:a(i)}},function(e,t,r){var i=r(53);var n=r(574);var a=r(220);var o=r(154);var s=r(20);var l=s.process;var u=s.setImmediate;var d=s.clearImmediate;var c=s.MessageChannel;var f=s.Dispatch;var h=0;var p={};var v="onreadystatechange";var m,_,y;var g=function(){var e=+this;if(p.hasOwnProperty(e)){var t=p[e];delete p[e];t()}};var w=function(e){g.call(e.data)};if(!u||!d){u=function e(t){var r=[];var i=1;while(arguments.length>i)r.push(arguments[i++]);p[++h]=function(){n(typeof t=="function"?t:Function(t),r)};m(h);return h};d=function e(t){delete p[t]};if(r(89)(l)=="process"){m=function(e){l.nextTick(i(g,e,1))}}else if(f&&f.now){m=function(e){f.now(i(g,e,1))}}else if(c){_=new c;y=_.port2;_.port1.onmessage=w;m=i(y.postMessage,y,1)}else if(s.addEventListener&&typeof postMessage=="function"&&!s.importScripts){m=function(e){s.postMessage(e+"","*")};s.addEventListener("message",w,false)}else if(v in o("script")){m=function(e){a.appendChild(o("script"))[v]=function(){a.removeChild(this);g.call(e)}}}else{m=function(e){setTimeout(i(g,e,1),0)}}}e.exports={set:u,clear:d}},function(e,t){e.exports=function(e){try{return{e:false,v:e()}}catch(e){return{e:true,v:e}}}},function(e,t,r){var n=r(47);var a=r(42);var o=r(173);e.exports=function(e,t){n(e);if(a(t)&&t.constructor===e)return t;var r=o.f(e);var i=r.resolve;i(t);return r.promise}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelAnimation=undefined;var i=r(18);var n=u(i);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,o.default)(this,r);this._viewer=e;this._data=this._option=Freedo.clone(t);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;if(!t.url)throw new Error("请传入Gltf模型数据地址！");this.initOptions();this.loadModel();this.parsePath()}(0,l.default)(r,[{key:"initOptions",value:function e(){var t=this._option;this._speed=Freedo.defaultValue(t.speed,10);this._offsetHeight=Freedo.defaultValue(t.offsetHeight,0);this._pause=false;this._stop=false;this._loop=!!this._option.loop;this._scale=Freedo.defaultValue(this._option.scale,1);this._delay=Freedo.defaultValue(this._option.delay,0);this._modelOption=Freedo.defaultValue(this._option.modelOption,{});this._showPath=Freedo.defaultValue(this._option.showPath,false)}},{key:"loadModel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._option.url;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._model){this._viewer.scene.primitives.remove(this._model)}this._option.url=t;this._modelOption=(0,n.default)({},this._modelOption,r,{url:t});this._ready=false;this._scale=Freedo.defaultValue(r.scale,this._scale);this._model=Freedo.Model.fromGltf((0,n.default)({scale:this._scale},this._modelOption));this._viewer.scene.primitives.add(this._model);this._readyPromise=this._model.readyPromise.then(this.onModelReady.bind(this));return this._readyPromise}},{key:"track",value:function e(){this._viewer.trackedEntity=this._model}},{key:"unTrack",value:function e(){this._viewer.trackedEntity=undefined}},{key:"onModelReady",value:function e(t){this._ready=true;this.updateModelMatrix();this._event.raiseEvent("DataChanged");return t}},{key:"setPositions",value:function e(){return this.parsePath.apply(this,arguments)}},{key:"parsePath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._option.positions;this.stop();this._time=new Freedo.JulianDate;if(!t){return}this._option.positions=t;var r=[];var i=[];this._distance=0;this._sampledPositionProperty=new Freedo.SampledPositionProperty;this._sampledPositionProperty.forwardExtrapolationType=Freedo.ExtrapolationType.HOLD;this._sampledPositionProperty.setInterpolationOptions({interpolationDegree:Freedo.defaultValue(this._option.interpolationDegree,2),interpolationAlgorithm:Freedo.HermitePolynomialApproximation});this._velocityOrientationProperty=new Freedo.VelocityOrientationProperty(this._sampledPositionProperty);for(var n=0;n<t.length;n++){var a=Freedo.Cartesian3.fromDegrees(t[n][0],t[n][1],t[n][2]+this._offsetHeight);var o=n==0?0:Freedo.Cartesian3.distance(a,i[n-1]);this._distance+=o;var s=n==0?new Freedo.JulianDate:Freedo.JulianDate.addSeconds(r[n-1],o,new Freedo.JulianDate);r.push(s);i.push(a);this._sampledPositionProperty.addSample(s,a)}this._times=r;this._pts=i;this._endTime=r[r.length-1];this._path=t;this.showPath(this._showPath)}},{key:"registerRenderEvent",value:function e(){var i=this;if(this._RenderRemoveCallback)this._RenderRemoveCallback();var n=void 0;this._RenderRemoveCallback=this._viewer.scene.postRender.addEventListener(function(e){i._viewer.scene.requestRender();var t=new Date;if(!n||i._pause){n=i._pause?undefined:t;return}var r=(t.getTime()-n.getTime())/1e3*i._speed;Freedo.JulianDate.addSeconds(i._time,r,i._time);if(Freedo.JulianDate.compare(i._time,i._endTime)>=0){i.stop();i._loop&&i.start();i._event.raiseEvent("End");return}n=t;i.updateModelMatrix()});this._viewer.scene.requestRender()}},{key:"updateModelMatrix",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._time;if(!this._sampledPositionProperty)return;var r=this._sampledPositionProperty.getValue(t,c);var i=this._velocityOrientationProperty.getValue(t,f);var n=Freedo.Matrix4.fromTranslationQuaternionRotationScale(r,i,h);this._model.modelMatrix=n;return n}},{key:"updateTrackView",value:function e(t){if(!this._track)return;var r=this._viewer.camera;var i=this._trackOffset;var n=Freedo.Matrix4.getTranslation(t,p);var a=i.range;var o=new Freedo.BoundingSphere(n,a);r.viewBoundingSphere(o)}},{key:"start",value:function e(){var t=this;if(!this._ready){throw new Error("请等待模型加载完成再开始播放!")}if(!this._path){throw new Error("请等先设置路径参数再开始播放!")}setTimeout(function(){t.registerRenderEvent();t._event.raiseEvent("Start")},this._delay*1e3)}},{key:"play",value:function e(){if(this._pause){this._pause=false}else{this.start()}}},{key:"pause",value:function e(){if(this._RenderRemoveCallback)this._pause=true;this._event.raiseEvent("Pause")}},{key:"stop",value:function e(){if(this._RenderRemoveCallback){this._RenderRemoveCallback();this._RenderRemoveCallback=undefined}this._time=new Freedo.JulianDate;this._pause=false;this._stop=true;this._event.raiseEvent("Stop")}},{key:"reset",value:function e(){this.stop();this.updateModelMatrix(new Freedo.JulianDate)}},{key:"setLoop",value:function e(t){this._loop=!!t}},{key:"getLoop",value:function e(){return this._loop}},{key:"setScale",value:function e(t){this._scale=Number(t);this._model&&(this._model.scale=this._scale)}},{key:"getScale",value:function e(){return this._scale}},{key:"setDelay",value:function e(t){this._delay=Number(t)}},{key:"getDelay",value:function e(){return this._delay}},{key:"setSpeed",value:function e(t){this._speed=Number(t)}},{key:"getSpeed",value:function e(){return this._speed}},{key:"setOffsetHeight",value:function e(t){this._offsetHeight=Number(t);this.setPositions()}},{key:"getOffsetHeight",value:function e(t){return this._offsetHeight}},{key:"showPath",value:function e(t){var r=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this._showPath=!!t;if(this._pathEntity){this._viewer.entities.remove(this._pathEntity);this._viewer.scene.primitives.remove(this._pathPoints)}if(this._showPath&&Freedo.defined(this._path)&&this._path.length>1){var n=this.getPath(false);var a=this.getPath(i);this._pathEntity=this._viewer.entities.add({polyline:{positions:a,material:Freedo.Color.YELLOW,depthFailMaterial:Freedo.Color.YELLOW}});this._pathPoints=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);n.forEach(function(e){r._pathPoints.add({position:e,color:Freedo.Color.RED,pixelSize:5,disableDepthTestDistance:Infinity})})}this._viewer.scene.requestRender()}},{key:"isShowPath",value:function e(){return this._showPath}},{key:"getPath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!this._path)return[];if(!t)return this._path.map(function(e){return Freedo.Cartesian3.fromDegrees(e[0],e[1],e[2])});var r=new Freedo.JulianDate;var i=[];var n=this._distance>1e3?this._distance/1e3:1;while(Freedo.JulianDate.compare(r,this._endTime)<0){var a=this._sampledPositionProperty.getValue(r);a&&i.push(a);Freedo.JulianDate.addSeconds(r,n,r)}i.push(this._sampledPositionProperty.getValue(this._endTime));return i}},{key:"trackBoundingSphere",value:function e(t){if(t){this._trackOffset=t;this._track=true}else if(t==false){this._track=false}}},{key:"cancelTrack",value:function e(){this._track=false}},{key:"destroy",value:function e(){this.stop();this.showPath(false);this._model&&this._viewer.scene.primitives.remove(this._model);this.play=e;this.stop=e;function e(){throw new Error("This object has been destroyed!")}}},{key:"getData",value:function e(){return(0,n.default)({},this._data,{loop:this._loop,offsetHeight:this._offsetHeight,showPath:this._showPath,scale:this._scale})}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"ready",get:function e(){return this._ready}},{key:"loop",get:function e(){return this._loop},set:function e(t){this._loop=!!t}},{key:"readyPromise",get:function e(){return this._readyPromise}},{key:"state",get:function e(){if(!this._ready){return"unready"}else if(this._RenderRemoveCallback&&!this._pause){return"play"}else if(this._RenderRemoveCallback&&this._pause){return"pause"}else if(this._stop){return"stop"}}}]);return r}();var c=new Freedo.Cartesian3;var f=new Freedo.Quaternion;var h=new Freedo.Cartesian3(1,1,1);var p=new Freedo.Cartesian3;t.FdModelAnimation=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Tree=undefined;var i=r(3);var v=u(i);var n=r(84);var m=u(n);var a=r(1);var o=u(a);var s=r(2);var l=u(s);r(581);function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}function f(e,t){if(c(e,t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}}function h(e,t){if(!c(e,t)){e.className+=" "+t}}var d=function(){function e(){(0,o.default)(this,e);this.tree=[];this.setting={onNodeClick:undefined,onNodeExpand:undefined,onNodeSelected:undefined};this.componentID=undefined;this.uid=undefined;this.compareData=undefined;this.uidParentsArr=[];this.currentUidRoot=undefined}(0,l.default)(e,[{key:"addNode",value:function e(t,r){var i=$('input[name="'+t.nodeTag+'"]').hasClass("checked");var n=this.renderTree(t.child,i);if(!!window.ActiveXObject||"ActiveXObject"in window){r.appendChild(n)}else{r.append(n)}}},{key:"renderTree",value:function e(t,l){var u=this;if(!Array.isArray(t)||t.length<=0){return""}var d=document.createElement("ul");d.className="fd__tree_ul";t.forEach(function(t,e){if((0,m.default)(t)!=="{}"){var r=document.createElement("li");r.className="fd__tree_li";if(t.child){var i=document.createElement("span");i.innerHTML="<i></i>";i.className="fd_tree_toggle";i.addEventListener("click",function(){c(r,"active")===true?f(r,"active"):h(r,"active");u.setting.onNodeExpand(t,r)});if(!!window.ActiveXObject||"ActiveXObject"in window){r.appendChild(i)}else{r.append(i)}}var n=document.createElement("label");n.className="FD-radio-label";var a=((new Date).getTime()+Math.random()*1e3).toString(36);if(l)n.innerHTML='<input class="FD-radio-radio checked" type="checkbox" name="'+a+'" />';else n.innerHTML='<input class="FD-radio-radio" type="checkbox" name="'+a+'" />';var o=document.createElement("span");o.classList.add("FD-radio-checkbox","FD-radio-radioInput");o.addEventListener("click",function(){u.selectedNode(t,n,r);var e=$(n).find(".FD-radio-radio").hasClass("checked");u.setting.onNodeSelected(t,r,e)});if(!!window.ActiveXObject||"ActiveXObject"in window){n.appendChild(o);r.appendChild(n)}else{n.append(o);r.append(n)}var s=document.createElement("span");s.innerHTML=t.title;s.className="fd_tree_span";s.addEventListener("click",function(){u.setting.onNodeClick(t,r,s)},false);if(!!window.ActiveXObject||"ActiveXObject"in window){r.appendChild(s)}else{r.append(s)}if(t.child&&(0,m.default)(t.child[0])!=="{}"){if(!!window.ActiveXObject||"ActiveXObject"in window){r.appendChild(u.renderTree(t.child,l))}else{r.append(u.renderTree(t.child,l))}}t.nodeTag=a;if(!!window.ActiveXObject||"ActiveXObject"in window){d.appendChild(r)}else{d.append(r)}}});return d}},{key:"findAndActiveParentNode",value:function e(t,r,i){var n=true;var a=false;var o=undefined;try{for(var s=(0,v.default)(r),l;!(n=(l=s.next()).done);n=true){var u=l.value;if(u===t){if(i===this.tree){}else{$('input[name="'+i.nodeTag+'"]').addClass("checked");this.findAndActiveParentNode(i,this.tree,this.tree)}break}if(u.child&&(0,m.default)(u.child[0])!=="{}"){this.findAndActiveParentNode(t,u.child,u)}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}},{key:"selectedNode",value:function e(t,r,i){var n=$(r).find(".FD-radio-radio").hasClass("checked");$(i).find(".FD-radio-radio").each(function(){if(n)$(this).removeClass("checked");else $(this).addClass("checked")});if(!n){this.findAndActiveParentNode(t,this.tree,this.tree)}}},{key:"expandTreeByComponentID",value:function e(t,r){}},{key:"getUIDFromTree",value:function e(t){var r=true;var i=false;var n=undefined;try{for(var a=(0,v.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;if(s.uid===this.componentID){this.uid=s.uid;this.compareData=s;this.expandTreeByComponentID(this.uid,this.compareData);break}if(s.child.length!==0&&(0,m.default)(s.child[0])!=="{}"){this.getUIDFromTree(s.child)}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"findUIDByComponentID",value:function e(t){this.componentID=t;this.getUIDFromTree(this.tree)}},{key:"createTree",value:function e(t){this.setting=t;return this.renderTree(this.tree,true)}},{key:"recycleGetUids",value:function e(t,r){var i=true;var n=false;var a=undefined;try{for(var o=(0,v.default)(r),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=true;var d=false;var c=undefined;try{for(var f=(0,v.default)(l.child),h;!(u=(h=f.next()).done);u=true){var p=h.value;if(p.uid===t){if(this.uidParentsArr.includes(l.uid)){break}this.uidParentsArr.push(l.uid);this.recycleGetUids(l.uid,this.tree);break}if(p.child&&(0,m.default)(p.child[0])!=="{}"){this.recycleGetUids(t,l.child)}}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}}},{key:"clearAllActive",value:function e(){$(".fd__tree_ul").find(".fd_tree_span.active").each(function(e){$(this).removeClass("active")})}},{key:"getUidParents",value:function e(t){this.uidParentsArr=[];this.recycleGetUids(t,this.tree);return this.uidParentsArr}},{key:"addRootTree",set:function e(t){this.tree.push(t)}},{key:"treeArray",set:function e(t){this.tree=t},get:function e(){return this.tree}}]);return e}();t.Tree=d},function(e,t){e.exports=function(r){var o=[];o.toString=function e(){return this.map(function(e){var t=i(e,r);if(e[2]){return"@media "+e[2]+"{"+t+"}"}else{return t}}).join("")};o.i=function(e,t){if(typeof e==="string")e=[[null,e,""]];var r={};for(var i=0;i<this.length;i++){var n=this[i][0];if(typeof n==="number")r[n]=true}for(i=0;i<e.length;i++){var a=e[i];if(typeof a[0]!=="number"||!r[a[0]]){if(t&&!a[2]){a[2]=t}else if(t){a[2]="("+a[2]+") and ("+t+")"}o.push(a)}}};return o};function i(e,t){var r=e[1]||"";var i=e[3];if(!i){return r}if(t&&typeof btoa==="function"){var n=o(i);var a=i.sources.map(function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"});return[r].concat(a).concat([n]).join("\n")}return[r].join("\n")}function o(e){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e))));var r="sourceMappingURL=data:application/json;charset=utf-8;base64,"+t;return"/*# "+r+" */"}},function(e,t,r){var d={};var i=function(e){var t;return function(){if(typeof t==="undefined")t=e.apply(this,arguments);return t}};var n=i(function(){return window&&document&&document.all&&!window.atob});var a=function(e,t){if(t){return t.querySelector(e)}return document.querySelector(e)};var o=function(e){var i={};return function(e,t){if(typeof e==="function"){return e()}if(typeof i[e]==="undefined"){var r=a.call(this,e,t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement){try{r=r.contentDocument.head}catch(e){r=null}}i[e]=r}return i[e]}}();var s=null;var l=0;var u=[];var c=r(583);e.exports=function(e,l){if(typeof DEBUG!=="undefined"&&DEBUG){if(typeof document!=="object")throw new Error("The style-loader cannot be used in a non-browser environment")}l=l||{};l.attrs=typeof l.attrs==="object"?l.attrs:{};if(!l.singleton&&typeof l.singleton!=="boolean")l.singleton=n();if(!l.insertInto)l.insertInto="head";if(!l.insertAt)l.insertAt="bottom";var u=h(e,l);f(u,l);return function e(t){var r=[];for(var i=0;i<u.length;i++){var n=u[i];var a=d[n.id];a.refs--;r.push(a)}if(t){var o=h(t,l);f(o,l)}for(var i=0;i<r.length;i++){var a=r[i];if(a.refs===0){for(var s=0;s<a.parts.length;s++)a.parts[s]();delete d[a.id]}}}};function f(e,t){for(var r=0;r<e.length;r++){var i=e[r];var n=d[i.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++){n.parts[a](i.parts[a])}for(;a<i.parts.length;a++){n.parts.push(w(i.parts[a],t))}}else{var o=[];for(var a=0;a<i.parts.length;a++){o.push(w(i.parts[a],t))}d[i.id]={id:i.id,refs:1,parts:o}}}}function h(e,t){var r=[];var i={};for(var n=0;n<e.length;n++){var a=e[n];var o=t.base?a[0]+t.base:a[0];var s=a[1];var l=a[2];var u=a[3];var d={css:s,media:l,sourceMap:u};if(!i[o])r.push(i[o]={id:o,parts:[d]});else i[o].parts.push(d)}return r}function p(e,t){var r=o(e.insertInto);if(!r){throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.")}var i=u[u.length-1];if(e.insertAt==="top"){if(!i){r.insertBefore(t,r.firstChild)}else if(i.nextSibling){r.insertBefore(t,i.nextSibling)}else{r.appendChild(t)}u.push(t)}else if(e.insertAt==="bottom"){r.appendChild(t)}else if(typeof e.insertAt==="object"&&e.insertAt.before){var n=o(e.insertAt.before,r);r.insertBefore(t,n)}else{throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n")}}function v(e){if(e.parentNode===null)return false;e.parentNode.removeChild(e);var t=u.indexOf(e);if(t>=0){u.splice(t,1)}}function m(e){var t=document.createElement("style");if(e.attrs.type===undefined){e.attrs.type="text/css"}if(e.attrs.nonce===undefined){var r=g();if(r){e.attrs.nonce=r}}y(t,e.attrs);p(e,t);return t}function _(e){var t=document.createElement("link");if(e.attrs.type===undefined){e.attrs.type="text/css"}e.attrs.rel="stylesheet";y(t,e.attrs);p(e,t);return t}function y(t,r){Object.keys(r).forEach(function(e){t.setAttribute(e,r[e])})}function g(){if(false){}return r.nc}function w(r,e){var t,i,n,a;if(e.transform&&r.css){a=typeof e.transform==="function"?e.transform(r.css):e.transform.default(r.css);if(a){r.css=a}else{return function(){}}}if(e.singleton){var o=l++;t=s||(s=m(e));i=b.bind(null,t,o,false);n=b.bind(null,t,o,true)}else if(r.sourceMap&&typeof URL==="function"&&typeof URL.createObjectURL==="function"&&typeof URL.revokeObjectURL==="function"&&typeof Blob==="function"&&typeof btoa==="function"){t=_(e);i=x.bind(null,t,e);n=function(){v(t);if(t.href)URL.revokeObjectURL(t.href)}}else{t=m(e);i=C.bind(null,t);n=function(){v(t)}}i(r);return function e(t){if(t){if(t.css===r.css&&t.media===r.media&&t.sourceMap===r.sourceMap){return}i(r=t)}else{n()}}}var F=function(){var r=[];return function(e,t){r[e]=t;return r.filter(Boolean).join("\n")}}();function b(e,t,r,i){var n=r?"":i.css;if(e.styleSheet){e.styleSheet.cssText=F(t,n)}else{var a=document.createTextNode(n);var o=e.childNodes;if(o[t])e.removeChild(o[t]);if(o.length){e.insertBefore(a,o[t])}else{e.appendChild(a)}}}function C(e,t){var r=t.css;var i=t.media;if(i){e.setAttribute("media",i)}if(e.styleSheet){e.styleSheet.cssText=r}else{while(e.firstChild){e.removeChild(e.firstChild)}e.appendChild(document.createTextNode(r))}}function x(e,t,r){var i=r.css;var n=r.sourceMap;var a=t.convertToAbsoluteUrls===undefined&&n;if(t.convertToAbsoluteUrls||a){i=c(i)}if(n){i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"}var o=new Blob([i],{type:"text/css"});var s=e.href;e.href=URL.createObjectURL(o);if(s)URL.revokeObjectURL(s)}},function(e,t,r){var l=r(81);var u=r(67);var d=r(97).f;e.exports=function(s){return function(e){var t=u(e);var r=l(t);var i=r.length;var n=0;var a=[];var o;while(i>n)if(d.call(t,o=r[n++])){a.push(s?[o,t[o]]:t[o])}return a}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdStyler=undefined;var i=r(172);var y=u(i);var n=r(3);var g=u(n);var a=r(35);var o=u(a);var s=r(1);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function e(t){(0,l.default)(this,e);this._viewer=t;var r=this;this.updateStyleThrottle=_.throttle(r.updateStyle,30);this._aPModel=[];this._defaultShow=true;this._colorStyle=new o.default;this._showStyle=new o.default;this._baseColor=[255,255,255,1]};d.prototype.addPModel=function(e){this._aPModel.push(e)};d.prototype.setData=function(e){this._aPModel=e};d.prototype.setBaseColor=function(e,t,r,i){this._baseColor=[e,t,r,i]};d.prototype.updateStyle=function(){var _=this;var e=new Freedo.FreedoPModelStyle({color:{evaluateColor:function e(t,r,i){if(!Freedo.defined(i)){r=t}if(!r)return Freedo.Color.WHITE;var n=r.getAncestors("component").join("|");var a=undefined;var o=999;var s=true;var l=false;var u=undefined;try{for(var d=(0,g.default)(_._colorStyle),c;!(s=(c=d.next()).done);s=true){var f=(0,y.default)(c.value,2),h=f[0],p=f[1];var v=n.indexOf(h);if(v!=-1&&v<o){a=p;o=v}}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}if(Freedo.defined(a)){return Freedo.Color.fromBytes(a[0],a[1],a[2],a[3]*255,i)}else{var m=_._baseColor;return Freedo.Color.fromBytes(m[0],m[1],m[2],m[3]*255,i)}}},show:{evaluate:function e(t,r){if(!Freedo.defined(r)){r=t}if(!r)return true;var i=r.getProperty("component");var n=r.getAncestors("component").join("|");var a=undefined;var o=999;var s=true;var l=false;var u=undefined;try{for(var d=(0,g.default)(_._showStyle),c;!(s=(c=d.next()).done);s=true){var f=(0,y.default)(c.value,2),h=f[0],p=f[1];var v=n.indexOf(h);if(v!=-1&&v<o){a=p;o=v}}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}if(Freedo.defined(a)){return a}else{return _._defaultShow}}}});for(var t=0;t<this._aPModel.length;t++){this._aPModel[t].style=e}};d.prototype.getData=function(){return{colorStyle:this._colorStyle,showStyle:this._showStyle}};d.prototype.show=function(e){for(var t=0;t<this._aPModel.length;t++){this._aPModel[t].show=e}};d.prototype.showAll=function(){this._showStyle=new o.default;this._defaultShow=true;this.updateStyleThrottle()};d.prototype.hideAll=function(){this._defaultShow=false;this._showStyle=new o.default;this.updateStyleThrottle()};d.prototype.setShow=function(e,t){if(Freedo.defined(e)){this._showStyle.set(e,t)}this.updateStyleThrottle()};d.prototype.setColor=function(e,t,r,i,n){if(Freedo.defined(e)){this._colorStyle.set(e,[t,r,i,n])}this.updateStyleThrottle()};d.prototype.restoreColor=function(e){if(Freedo.defined(e)){this._colorStyle.delete(e)}this.updateStyleThrottle()};d.prototype.restoreAllColor=function(){this._colorStyle=new o.default;this.updateStyleThrottle()};d.prototype.reset=function(){};t.FdStyler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdProp=undefined;var i=r(3);var _=l(i);var n=r(1);var a=l(n);var o=r(2);var s=l(o);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function i(e,t,r){(0,a.default)(this,i);this._status={show:false};this._viewer=e;this._pmts=t;this._tree=r.tree;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._width=260;this._height=800;this._vbox=undefined;this._propGrid1=undefined;this._propGrid2=undefined;this._pickPanel=undefined;this._pm=undefined}(0,s.default)(i,[{key:"createVBox",value:function e(){this._vbox=Ext.create("Ext.Panel",{header:false,border:false,layout:{type:"vbox"},items:[this._propGrid1,this._propGrid2,this._pickPanel]})}},{key:"onStartClick",value:function e(){this._pm.setSingleMode(true);this._pm.start()}},{key:"onCancelClick",value:function e(){this._pm.cancel()}},{key:"onHideClick",value:function e(){this._pm.start();this._pm.setMode("SHOW_HIDE")}},{key:"onHighClick",value:function e(){this._pm.start();this._pm.setHighlightColor(255,255,0,1);this._pm.setMode("HIGH_LIGHT")}},{key:"onPickClick",value:function e(){this._pm.start();this._pm.setMode("PICK_MODE")}},{key:"onHalfClick",value:function e(){this._pm.start();this._pm.setHighlightColor(255,255,255,.2);this._pm.setMode("HIGH_LIGHT")}},{key:"onSingleMultiClick",value:function e(){this._pm.setSingleMode(!this._pm.getSingleMode())}},{key:"onSingleClick",value:function e(){this._pm.setSingleMode(true)}},{key:"onMultiClick",value:function e(){this._pm.setSingleMode(false)}},{key:"onHLUidClick",value:function e(){Ext.MessageBox.prompt("Uid","请输入Uid：",this.HLByUid,this)}},{key:"onKVClick",value:function e(){if(typeof this._tree!="undefined"){var t=this._tree.getSelectedModel();if(Freedo.defined(t)){Ext.MessageBox.prompt("KV键值对接口","请输入key,value键值对，用逗号隔开：",this.KV,this)}else{Ext.Msg.alert("提示","请先选中模型")}}}},{key:"createPropGrid",value:function e(){this._propGrid1=Ext.create("Ext.grid.property.Grid",{header:false,border:false,flex:20,width:"100%"});this._propGrid2=Ext.create("Ext.grid.property.Grid",{header:false,border:false,flex:70,width:"100%",source:{}});this._pickPanel=Ext.create("Ext.Panel",{flex:25,title:"鼠标点选",width:"100%",bodyPadding:6,border:false,layout:{type:"table",columns:3,tdAttrs:{style:"padding: 4px 6px;"}},items:[{xtype:"button",text:"启用点选",scale:"medium",handler:this.onStartClick.bind(this)},{xtype:"button",text:"关闭点选",scale:"medium",handler:this.onCancelClick.bind(this)},{xtype:"button",text:"隐藏模式",scale:"medium",handler:this.onHideClick.bind(this)},{xtype:"button",text:"高亮模式",scale:"medium",handler:this.onHighClick.bind(this)},{xtype:"button",text:"选取模式",scale:"medium",handler:this.onPickClick.bind(this)},{xtype:"button",text:"单选模式",scale:"medium",handler:this.onSingleMultiClick.bind(this)},{xtype:"button",text:"UID 高亮",scale:"medium",handler:this.onHLUidClick.bind(this)},{xtype:"button",text:"键值接口",scale:"medium",handler:this.onKVClick.bind(this)}]})}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"createComponents",value:function e(){this.createPropGrid();this.createVBox();this.regLsnr()}},{key:"show",value:function e(){if(!this._win){this.getContainer();var t=Ext.getBody().dom.clientWidth;var r=Ext.getBody().dom.clientHeight;this._win=Ext.create("Ext.window.Window",{title:"点选查询",height:this._height,width:this._width,x:t-10-this._width,y:130,layout:"fit",items:this._vbox});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"getContainer",value:function e(){this.createComponents();return this._vbox}},{key:"HLByUid",value:function e(t,r){if(t=="ok"&&r!=""){this._pm.setMode("HIGH_LIGHT");var i=r;if(typeof this._tree!="undefined"){var n=this._tree.getSelectedModel();if(Freedo.defined(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,_.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;this._pm.highlightComponent(i,d)}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}}else{Ext.Msg.alert("提示","请先选中模型")}}}}},{key:"KV",value:function e(t,r){var i=this;if(t=="ok"&&r!=""){var n=void 0,a=void 0;var o=r;var s=o.split(",");if(s.length==1){n="name";a=s[0]}if(s.length==2){n=s[0];a=s[1]}if(typeof this._tree!="undefined"){var l=this._tree.getSelectedModel();if(Freedo.defined(l)){var u=true;var d=false;var c=undefined;try{for(var f=(0,_.default)(l),h;!(u=(h=f.next()).done);u=true){var p=h.value;var v=this._pmts.getPmtsIdByPModel(p);var m=this._pmts.getToken(v);this._pmts.getPropFromKeyValue(v,n,a,m,function(e){i.flyToComponent(v,e)},{pModel:p})}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}}else{Ext.Msg.alert("提示","请先选中模型")}}}}},{key:"flyToComponent",value:function e(t,r){if(!Freedo.defined(r)){return}this._pmts.highlightComponent(t,r.uid,255,0,0,1);this._viewer.camera.flyToBoundingSphere(r.bs,{duration:0})}},{key:"regLsnr",value:function e(){this._pm=new Freedo.FdMicroApp.FdPickPMComponent(this._viewer);this._pm.setHighlightColor(255,255,0,1);this._pm.setSingleMode(false);this._pm.setClearOnEmptyClick(false);var u=this;this._pm.on(function(e,l){if(e=="DataChanged"){if(!Freedo.defined(l))return;u._propGrid2.setSource({});u._propGrid1.setSource({componentid:l.componentid,names:l.names,ancestorComponents:l.ancestorComponents.join(","),desc:l.desc,tags:l.tag});var t=u._pmts.getPmtsIdByPModel(l.tileset);var r=u._pmts.getToken(t);u._event.raiseEvent(e,l);u._pmts.getAidProp(undefined,l.componentid,l.ancestorComponents,r,function(e,t){if(e.length>=1){var r=e[0];u._propGrid2.setProperty("【基本属性】","",true);for(var i in r){if(!(r[i]instanceof Array)){u._propGrid2.setProperty(i,r[i],true)}}var n=r["propset"];for(var i in n){var a=n[i];u._propGrid2.setProperty("【"+a.Name+"】","",true);for(var o=0;o<a.sValue.length;o++){var s=a.sValue[o];u._propGrid2.setProperty(s.Name,s.NominalValue,true)}}}u._event.raiseEvent("PropFetched",l)},{pModel:l.tileset})}})}},{key:"onClose",value:function e(){this._win=undefined;this._status.show=false;this._pm.cancel()}}]);return i}();t.FdProp=u},function(e,t,r){"use strict";e.exports=r(611)},function(e,t,r){"use strict";e.exports.encode=r(612);e.exports.decode=r(613);e.exports.format=r(614);e.exports.parse=r(615)},function(e,t){e.exports=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/},function(e,t){e.exports=/[\0-\x1F\x7F-\x9F]/},function(e,t){e.exports=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/},function(e,t,r){"use strict";var i="[a-zA-Z_:][a-zA-Z0-9:._-]*";var n="[^\"'=<>`\\x00-\\x20]+";var a="'[^']*'";var o='"[^"]*"';var s="(?:"+n+"|"+a+"|"+o+")";var l="(?:\\s+"+i+"(?:\\s*=\\s*"+s+")?)";var u="<[A-Za-z][A-Za-z0-9\\-]*"+l+"*\\s*\\/?>";var d="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>";var c="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e";var f="<[?].*?[?]>";var h="<![A-Z]+\\s+[^>]*>";var p="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>";var v=new RegExp("^(?:"+u+"|"+d+"|"+c+"|"+f+"|"+h+"|"+p+")");var m=new RegExp("^(?:"+u+"|"+d+")");e.exports.HTML_TAG_RE=v;e.exports.HTML_OPEN_CLOSE_TAG_RE=m},function(e,t,r){"use strict";e.exports.tokenize=function e(t,r){var i,n,a,o,s,l=t.pos,u=t.src.charCodeAt(l);if(r){return false}if(u!==126){return false}n=t.scanDelims(t.pos,true);o=n.length;s=String.fromCharCode(u);if(o<2){return false}if(o%2){a=t.push("text","",0);a.content=s;o--}for(i=0;i<o;i+=2){a=t.push("text","",0);a.content=s+s;t.delimiters.push({marker:u,jump:i,token:t.tokens.length-1,level:t.level,end:-1,open:n.can_open,close:n.can_close})}t.pos+=n.length;return true};e.exports.postProcess=function e(t){var r,i,n,a,o,s=[],l=t.delimiters,u=t.delimiters.length;for(r=0;r<u;r++){n=l[r];if(n.marker!==126){continue}if(n.end===-1){continue}a=l[n.end];o=t.tokens[n.token];o.type="s_open";o.tag="s";o.nesting=1;o.markup="~~";o.content="";o=t.tokens[a.token];o.type="s_close";o.tag="s";o.nesting=-1;o.markup="~~";o.content="";if(t.tokens[a.token-1].type==="text"&&t.tokens[a.token-1].content==="~"){s.push(a.token-1)}}while(s.length){r=s.pop();i=r+1;while(i<t.tokens.length&&t.tokens[i].type==="s_close"){i++}i--;if(r!==i){o=t.tokens[i];t.tokens[i]=t.tokens[r];t.tokens[r]=o}}}},function(e,t,r){"use strict";e.exports.tokenize=function e(t,r){var i,n,a,o=t.pos,s=t.src.charCodeAt(o);if(r){return false}if(s!==95&&s!==42){return false}n=t.scanDelims(t.pos,s===42);for(i=0;i<n.length;i++){a=t.push("text","",0);a.content=String.fromCharCode(s);t.delimiters.push({marker:s,jump:i,token:t.tokens.length-1,level:t.level,end:-1,open:n.can_open,close:n.can_close})}t.pos+=n.length;return true};e.exports.postProcess=function e(t){var r,i,n,a,o,s,l=t.delimiters,u=t.delimiters.length;for(r=0;r<u;r++){i=l[r];if(i.marker!==95&&i.marker!==42){continue}if(i.end===-1){continue}n=l[i.end];s=r+1<u&&l[r+1].end===i.end-1&&l[r+1].token===i.token+1&&l[i.end-1].token===n.token-1&&l[r+1].marker===i.marker;o=String.fromCharCode(i.marker);a=t.tokens[i.token];a.type=s?"strong_open":"em_open";a.tag=s?"strong":"em";a.nesting=1;a.markup=s?o+o:o;a.content="";a=t.tokens[n.token];a.type=s?"strong_close":"em_close";a.tag=s?"strong":"em";a.nesting=-1;a.markup=s?o+o:o;a.content="";if(s){t.tokens[l[r+1].token].content="";t.tokens[l[i.end-1].token].content="";r++}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.loadView=undefined;var d=r(667);var i=t.loadView=function(l,u){"use strict";var e=function e(t,r,i){r=l(r);var n=(0,d.createFragmentFromTemplate)(t);var a=[];var o;for(o=0;o<n.childNodes.length;++o){a.push(n.childNodes[o])}r.appendChild(n);for(o=0;o<a.length;++o){var s=a[o];if(s.nodeType===1||s.nodeType===8){u.applyBindings(i,s)}}return a};return e}(Freedo.getElement,r(71))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NavigationControl=undefined;var i=r(72);var n=o(i);var a=r(673);function o(e){return e&&e.__esModule?e:{default:e}}var s=t.NavigationControl=function(){"use strict";var e=function e(t){a.UserInterfaceControl.apply(this,arguments)};e.prototype=(0,n.default)(a.UserInterfaceControl.prototype);return e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=t.Utils=function(a,e,o,t,r,s){"use strict";var i={};var l=new t;var u=new e;i.getCameraFocus=function(e,t,r){var i=e.scene;var n=i.camera;if(i.mode==s.MORPHING){return undefined}if(!a(r)){r=new o}if(a(e.trackedEntity)){r=e.trackedEntity.position.getValue(e.clock.currentTime,r)}else{u.origin=n.positionWC;u.direction=n.directionWC;r=i.globe.pick(u,i,r)}if(!a(r)){return undefined}if(i.mode==s.SCENE2D||i.mode==s.COLUMBUS_VIEW){r=n.worldToCameraCoordinatesPoint(r,r);if(t){r=i.globe.ellipsoid.cartographicToCartesian(i.mapProjection.unproject(r,l),r)}}else{if(!t){r=n.worldToCameraCoordinatesPoint(r,r)}}return r};return i}(Freedo.defined,Freedo.Ray,Freedo.Cartesian3,Freedo.Cartographic,Freedo.ReferenceFrame,Freedo.SceneMode)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdWater=undefined;var i=r(3);var p=f(i);var n=r(18);var o=f(n);var a=r(1);var s=f(a);var l=r(2);var u=f(l);var d=r(5);var c=r(10);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(){function i(e,t,r){(0,s.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new c.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._waterPolygon=undefined;this._colorAlpha=new Freedo.Cartesian2(.8,1);this.create()}(0,u.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();h.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdWater.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.pts){this._data.pts=[];this._ple.run();this.addLsnr()}else{this.build()}};h.prototype.refresh=function(){this._viewer.scene.requestRender()};h.prototype.build=function(){var e=this._data;var t=e.height,r=t===undefined?0:t,i=e.extrudedHeight,n=i===undefined?0:i,a=e.pts,o=a===undefined?[]:a,s=e.waterType,l=s===undefined?1:s;var u=4e3;var d=.005;var c=2;var f=undefined;if(l<=2){var h=[];if(e.holes){for(var p=0;p<e.holes.length;p++){var v=new Freedo.PolygonHierarchy(Freedo.Cartesian3.fromDegreesArray(e.holes[p]));h.push(v)}}f=new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(Freedo.Cartesian3.fromDegreesArray(o),h),vertexFormat:Freedo.EllipsoidSurfaceAppearance.VERTEX_FORMAT,height:r,extrudedHeight:n})}if(l==3){f=new Freedo.RectangleGeometry({rectangle:Freedo.Rectangle.fromDegrees(-179.99999999,-89.99999999,179.99999999,89.99999999),vertexFormat:Freedo.EllipsoidSurfaceAppearance.VERTEX_FORMAT,height:0});u=4e5;d=.005;c=4}if(l<=3){var m={geometryInstances:new Freedo.GeometryInstance({geometry:f}),appearance:new Freedo.EllipsoidSurfaceAppearance({material:new Freedo.Material({fabric:{materials:{water:{type:"Water",uniforms:{normalMap:Freedo.buildModuleUrl("Assets/Textures/waterNormals.jpg"),frequency:u,animationSpeed:d,amplitude:c}}},uniforms:{colorAlpha:this._colorAlpha},components:{diffuse:"water.diffuse",specular:"water.specular",shininess:"water.shininess",normal:"water.normal",emission:"water.emission",alpha:"colorAlpha.x"}}}),renderState:{cull:false},aboveGround:false,translucent:true}),show:true};var _=l==1?Freedo.GroundPrimitive:Freedo.Primitive;this._waterPolygon=this._viewer.scene.primitives.add(new _(m))}else{this._waterPolygon=this.buildRiver(o)}this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};h.prototype.buildRiver=function(e){e=Freedo.Cartesian3.fromDegreesArrayHeights(e);if(typeof this._data.offsetHeight=="number")e=Freedo.FdMisc.FdMath.addDelta2Height(e,this._data.offsetHeight);var t=Freedo.defaultValue(this._data.width,200);var r=Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3);var i=Freedo.FdModel.FdLoft.buildCirclePts(e[0],t/2,r,2);i.reverse();var n=Freedo.FdModel.FdLoft.smoothByPolyline(e,i,720,1);var a=Freedo.FdModel.FdLoft.buildPrimitive(viewer,(0,o.default)({},n,{image:Freedo.FdApp.getFreedoXPath()+"Assets/Textures/water.jpg",loop:Freedo.defaultValue(this._data.loop,true)}));return this._viewer.scene.primitives.add(a)};h.prototype.setHeight=function(e){var t=this._data.waterType;if(t==3){var r=this._data.extrudedHeight,i=r===undefined?0:r;if(!this._waterPolygon)return;var n=(6378137+parseFloat(e))/(6378137+i);this._waterPolygon.modelMatrix=Freedo.Matrix4.fromScale(new Freedo.Cartesian3(n,n,n))}else{var a=this._data.pts;a=Freedo.Cartesian3.fromDegreesArrayHeights(a);if(typeof this._data.offsetHeight=="number")a=Freedo.FdMisc.FdMath.addDelta2Height(a,this._data.offsetHeight);var o=new Freedo.Cartesian3;var s=true;var l=false;var u=undefined;try{for(var d=(0,p.default)(a),c;!(s=(c=d.next()).done);s=true){var f=c.value;var h=Freedo.Cartesian3.normalize(f,new Freedo.Cartesian3);Freedo.Cartesian3.add(o,h,o)}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}Freedo.Cartesian3.multiplyByScalar(o,e/a.length,o);this._waterPolygon.modelMatrix=Freedo.Matrix4.multiplyByTranslation(Freedo.Matrix4.IDENTITY,o,new Freedo.Matrix4)}};h.prototype.setOpacity=function(e){this._colorAlpha.x=parseFloat(e)};h.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;var e=0;var t,i;this._lsner=this._ple.on(function(e,t){console.log(e);if(e=="PointAdded"){r._data.pts.push(t.position[0]);r._data.pts.push(t.position[1])}if(e=="DataChanged"){if(r._data.waterType==4){r._data.pts.length=0;t.polyline.ptsG.forEach(function(e){r._data.pts.push(e[0],e[1],e[2])})}r._ple.cancel()}if(e=="Cancel"){r.build()}})};h.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};h.prototype.clear=function(){this._viewer.scene.primitives.remove(this._waterPolygon);this._waterPolygon=undefined;this._viewer.scene.requestRender()};h.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};h.prototype.show=function(){this._waterPolygon.show=true;this._viewer.scene.requestRender()};h.prototype.hide=function(){this._waterPolygon.show=false;this._viewer.scene.requestRender()};h.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"Water",option:Freedo.clone(this._data,true)}};h.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel();this.remove()};h.prototype.dispose=function(){this.reset()};t.FdWater=h},function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r)&255);return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicLine=undefined;var i=r(1);var n=d(i);var a=r(2);var o=d(a);var s=r(56);var l=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._scratchTWP=undefined;this._dynamicLinePrimitives=[];this._dynamicLineRoutes=[];this._disposeListener=undefined;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdDynamicLine.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.width)){this._data.width=16}if(!Freedo.defined(this._data.color)){this._data.color=new Freedo.Color(.3,.8,1,1)}if(!this._data.routes[0].positions){this._data.routes[0].positions=[];this._data.positions=[];this._ple.run();this.addLsnr()}else{this.build()}};c.prototype.build=function(){var e=this._id;var t=this._data;var r=t.routes;this._dynamicLineRoutes.push(r);var i=this.createDynamicLinesPrimitive(r,t.color,t.width,Freedo.defaultValue(t.depthTest,true));this._viewer.scene.primitives.add(i);this._dynamicLinePrimitives.push(i);r.forEach(function(e){var t=e.startTime;var r=e.duration;e.forward=Freedo.defaultValue(e.forward,true);if(e.forward==true){e.time=e.startTime;e.delta=.01}else{e.time=e.startTime+e.duration;e.delta=-.01}e.round=Freedo.defaultValue(e.round,false)});this.addLsnrOfMotion();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.addLsnr=function(){var i=this;if(this._lsner)this._lsner();this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){var r=Freedo.FdMisc.FdGeometric.tc(t.position);i._data.routes[0].positions.push(r);i._data.positions.push(t.position)}if(e=="DataChanged"){i._ple.cancel()}if(e=="Cancel"){i.build()}})};c.prototype.addLsnrOfMotion=function(){var r=this;if(this._disposeListener!=undefined){return}this._disposeListener=this._viewer.scene.preUpdate.addEventListener(function(){for(var e=0;e<r._dynamicLinePrimitives.length;e++){var t=r._dynamicLinePrimitives[e];if(!Freedo.defined(t)){continue}r.setDynamicLinesStatus(t,r._dynamicLineRoutes[e])}})};c.prototype.createDynamicLinesApperance=function(e,t){console.log(e);var r=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:e}},translucent:true}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:t,func:Freedo.WebGLConstants.LEQUAL}})});var i=Freedo.ShaderSource.replaceMain(r._vertexShaderSource,"czm_twp_main");var n="varying vec4 v_twp; \n"+"void main() \n"+"{ \n"+"    czm_twp_main(); \n"+"    v_twp = czm_batchTable_twp(batchId); \n"+"}";r._vertexShaderSource=i+"\n"+n;var a=Freedo.ShaderSource.replaceMain(r._fragmentShaderSource,"czm_twp2_main");var o="varying vec4 v_twp; \n"+"void main() \n"+"{ \n"+"   czm_twp2_main(); \n"+"   float t = v_twp.x;"+"   float w = v_twp.y;"+"   float p = v_twp.z;"+"   float d = v_twp.w;"+"   float alpha = gl_FragColor.a;"+"   if(d > 0.0){"+"       if(v_st.s > (t - 0.06) && v_st.s < t){"+"           alpha = smoothstep(1.0, alpha, abs(v_st.s - t) / 0.06) * (1.0 - alpha) + alpha;"+"       }"+"   } else {"+"       if(v_st.s > t && v_st.s < (t + 0.06)){"+"           alpha = smoothstep(1.0, alpha, abs(v_st.s - t) / 0.06) * (1.0 - alpha) + alpha;"+"       }"+"   }"+"   gl_FragColor.a = alpha;"+"}";r._fragmentShaderSource=a+"\n"+o;return r};c.prototype.createDynamicLinesGeometryInstance=function(e,t){var r=new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:t,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),attributes:{twp:new Freedo.GeometryInstanceAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:false,value:[0,.5,1,1]})}});return r};c.prototype.createDynamicLinesPrimitive=function(e,t,i,r){var n=[];var a=this;e.forEach(function(e){var t=e.positions;var r=a.createDynamicLinesGeometryInstance(t,i);n.push(r)});var o=new Freedo.Primitive({geometryInstances:n,appearance:this.createDynamicLinesApperance(t,r)});return o};c.prototype.getScratchTWP=function(){if(typeof this._scratchTWP==="undefined"){this._scratchTWP=new Freedo.Cartesian4(0,0,0,0)}return this._scratchTWP};c.prototype.setDynamicLinesStatus=function(e,t){var r=this.getScratchTWP();if(typeof e._batchTable!=="undefined"){var i="twp";var n=e._batchTableAttributeIndices[i];var a=e._batchTable._numberOfInstances;for(var o=0;o<a;++o){var s=o;var l=t[s];var u=l.startTime;var d=l.duration;var c=l.time;c+=l.delta;if(c>u+d){if(l.round){c=u+d;l.delta*=-1}else{c=u}}else if(c<u){if(l.round){c=u;l.delta*=-1}else{c=u+d}}l.time=c;var f=c-u;var h=Math.min(f/d,1);Freedo.Cartesian4.fromElements(h,.3,1,l.delta,r);e._batchTable.setBatchedAttribute(s,n,r)}this._viewer.scene.requestRender()}};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.clear=function(e){for(var t=0;t<this._dynamicLinePrimitives.length;t++){var r=this._dynamicLinePrimitives[t];this._viewer.scene.primitives.remove(r)}this._dynamicLinePrimitives=[];this._dynamicLineRoutes=[];if(this._dynamicLinePrimitives.length==0){this._disposeListener();this._disposeListener=undefined}this._viewer.scene.requestRender()};c.prototype.getData=function(){if(!this._data)return this._data;var e=Freedo.clone(this._data,true);return{id:this._id,type:"DynamicLine",option:e}};c.prototype.remove=function(){this.clear();this._data=undefined};c.prototype.show=function(){for(var e=0;e<this._dynamicLinePrimitives.length;e++){var t=this._dynamicLinePrimitives[e];t.show=true}this._viewer.scene.requestRender()};c.prototype.hide=function(){for(var e=0;e<this._dynamicLinePrimitives.length;e++){var t=this._dynamicLinePrimitives[e];t.show=false}this._viewer.scene.requestRender()};c.prototype.reDraw=function(e){this.clear();this.build()};c.prototype.dispose=function(){this.remove()};t.FdDynamicLine=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLabel=undefined;var i=r(18);var m=c(i);var n=r(1);var a=c(n);var o=r(2);var s=c(o);var l=r(5);var u=r(10);var d=r(117);function c(e){return e&&e.__esModule?e:{default:e}}var _=(0,d.getFreedoXPath)()+"Assets/Textures/pin/pin.png";var f=function(){function n(e,t,r,i){(0,a.default)(this,n);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._labels=i.labels;this._billboards=i.billboards;this._points=i.points;this.create()}(0,s.default)(n,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return n}();f.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdLabel.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};f.prototype.refresh=function(){this._viewer.scene.requestRender()};f.prototype.build=function(){var e=this._data;var t=e.position,r=e.text,i=r===undefined?"":r,n=e.point,a=n===undefined?true:n,o=e.image,s=o===undefined?_:o,l=e.distanceDisplayCondition;var u=e.labelOption,d=u===undefined?{}:u,c=e.billboardOption,f=c===undefined?{}:c,h=e.pointOption,p=h===undefined?{}:h;var v=Freedo.Cartesian3.fromDegrees(t[0],t[1],t[2]);l=Freedo.defaultValue(l,new Freedo.DistanceDisplayCondition(0,2e7));this.label=this._labels.add((0,m.default)({distanceDisplayCondition:l,id:this._id,position:v,text:i,font:"16px sans-serif",fillColor:Freedo.Color.BLACK,outlineColor:Freedo.Color.WHITE.withAlpha(.5),outlineWidth:4,showBackground:false,style:Freedo.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Freedo.Cartesian2(18,-16),horizontalOrigin:Freedo.HorizontalOrigin.LEFT,verticalOrigin:Freedo.VerticalOrigin.CENTER},d));this.point=this._points.add((0,m.default)({distanceDisplayCondition:l,id:this._id,position:v,pixelSize:3,color:Freedo.Color.YELLOW,outlineColor:Freedo.Color.BLACK,outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY},p));this.billboard=this._billboards.add((0,m.default)({distanceDisplayCondition:l,id:this._id,image:s,position:v,pixelOffset:new Freedo.Cartesian2(0,-20)},f));this._event.raiseEvent("LabelAdded",this);this._event.raiseEvent("DataChanged",this);this._event.raiseEvent("LabelChanged",this);this._viewer.scene.requestRender()};f.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){r._data.position=t.position;r._ple.cancel();r.build()}})};f.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};f.prototype.setImage=function(e){this._data.image=e;this.remove();this.build()};f.prototype.setPosition=function(e,t,r){this._data.position=[e,t,r];this.remove();this.build()};f.prototype.remove=function(){this._labels.remove(this.label);this._billboards.remove(this.billboard);this._points.remove(this.point)};f.prototype.show=function(e){var t=Freedo.defaultValue(e,true);if(this.label){if(this._data.labelOption==undefined||this._data.labelOption.show!==false)this.label.show=t}if(this.billboard){if(this._data.billboardOption==undefined||this._data.billboardOption.show!==false)this.billboard.show=t}if(this.point){if(this._data.pointOption==undefined||this._data.pointOption.show!==false)this.point.show=t}this._viewer.scene.requestRender()};f.prototype.hide=function(){this.show(false)};f.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Label",option:e}};f.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};f.prototype.dispose=function(){this.reset();this.remove()};t.FdLabel=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDivLabel=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function i(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,n.default)(this,i);this.id=t;this._viewer=e;this._camera=this._viewer.camera;this._divId=r.divId;this._pixelOffset=Freedo.defaultValue(r.pixelOffset,new Freedo.Cartesian2);this._offsetHeight=Freedo.defaultValue(r.offset,0);this._data=Freedo.clone(r);this._show=r.show!==false;this._computeVisbility=true;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._div=document.getElementById(this._divId);this._div=Freedo.defaultValue(this._div,r.div);if(!this._div){this.buildPresetDiv()}this._div.style.position="absolute";this._timer=undefined;this.position=r.position;this.regLsr()}(0,o.default)(i,[{key:"buildPresetDiv",value:function e(){switch(this._data.style){case"1":this._div=i.LabelStyle_1(this._data.text,this);this._pixelOffset={x:0,y:-50};break;case"2":this._div=i.LabelStyle_2(this._data.text,this);this._pixelOffset={x:-70,y:-60};break;case"3":this._div=i.LabelStyle_3(this._data.text,this);this._pixelOffset={x:-70,y:-60};break;case"4":this._div=i.LabelStyle_4(this._data.text,this);this._pixelOffset={x:-3,y:-61};break;case"5":this._div=i.LabelStyle_5(this._data.text,this);this._pixelOffset={x:-32,y:-64};break;case"6":this._div=i.LabelStyle_6(this._data.text,this);this._pixelOffset={x:-32,y:-64};break;default:this._div=i.LabelStyle_1(this._data.text,this);this._pixelOffset={x:0,y:-50};break}}},{key:"regLsr",value:function e(){var i=this;this._removeCallback=this._viewer.camera.changed.addEventListener(this.updateOffset,this);this._timer=setInterval(function(){var e=i._viewer._container.clientWidth;var t=i._viewer._container.clientHeight;if(e!==i._lastCanvasWidth||t!==i._lastCanvasHeight){i.updateOffset()}else{var r=i.computeVisbility();if(!r)i._div.style.display="none"}},500)}},{key:"computeVisbility",value:function e(){if(!this._show||!this._div){return false}if(!Freedo.defaultValue(this._data.depthTest,true)){this._computeVisbility=true;return true}var t=this._viewer.scene.cartesianToCanvasCoordinates(this._realPosition,c);if(!Freedo.defined(t))return false;var r=this._viewer.scene.pickTranslucentDepth;this._viewer.scene.pickTranslucentDepth=false;var i=this._viewer.scene.pickPosition(t,p);this._viewer.scene.pickTranslucentDepth=r;if(Freedo.defined(i)){var n=Freedo.Cartesian3.distanceSquared(i,this._camera.positionWC);var a;if(this._viewer.scene.mode===Freedo.SceneMode.SCENE3D){a=Freedo.Cartesian3.distanceSquared(this._realPosition,this._camera.positionWC)}else{var o=this._viewer.scene.mapProjection.project(this._camera.positionCartographic,h);var s=Freedo.Cartographic.clone(this._position,d);d.height+=this._offsetHeight;var l=this._viewer.scene.mapProjection.project(s,f);a=Freedo.Cartesian3.distanceSquared(l,o)}this._computeVisbility=a<=n;return this._computeVisbility}return true}},{key:"updateOffset",value:function e(){this._lastCanvasWidth=this._viewer._container.clientWidth;this._lastCanvasHeight=this._viewer._container.clientHeight;var t=true;var r=Freedo.defaultValue(this._data.maxDistance,Infinity);if(this._data.maxDistance){var i,n;if(this._viewer.scene.mode===Freedo.SceneMode.SCENE3D){i=this._camera.positionWC;n=Freedo.Cartographic.toCartesian(this._position,undefined,f)}else{i=this._viewer.scene.mapProjection.project(this._camera.positionCartographic,h);n=this._viewer.scene.mapProjection.project(this._position,f)}var a=Freedo.Cartesian3.distanceSquared(i,n);t=a<r*r}this._div.style.display=t&&this._show&&this._computeVisbility?"block":"none";if(getComputedStyle(this._div).display=="none"){return}var o=this.offsetPosition(this._position,this._offsetHeight,h);var s=this._viewer.scene.cartesianToCanvasCoordinates(o,c);if(!Freedo.defined(s)){this._div.style.display="none";return}this._div.style.left=s.x+this._pixelOffset.x+"px";this._div.style.top=s.y+this._pixelOffset.y+"px"}},{key:"isNumber",value:function e(t){return!isNaN(Number(t))}},{key:"remove",value:function e(){if(this._removeCallback){this._removeCallback();this._removeCallback=undefined}if(this._timer)clearInterval(this._timer);this._div&&this._div.remove();this._div=undefined}},{key:"getData",value:function e(){return Freedo.clone(this._data)}},{key:"updateHeight",value:function e(){if(!this._position||!this._viewer.scene.globe){return}var t=this._position;var r=this._viewer.scene.globe.getHeight(t);t.height=r;this.position=t}},{key:"offsetPosition",value:function e(t,r){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Freedo.Cartesian3;return Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height+r,undefined,i)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"position",get:function e(){return this._position},set:function e(t){if(t instanceof Freedo.Cartesian3){this._position=Freedo.Cartographic.fromCartesian(t);this._realPosition=this.offsetPosition(this._position,this._offsetHeight,new Freedo.Cartesian3);this.updateOffset()}else if(t instanceof Freedo.Cartographic){this._position=Freedo.Cartographic.clone(t);this._realPosition=this.offsetPosition(this._position,this._offsetHeight,new Freedo.Cartesian3);this.updateOffset()}else if(t instanceof Array){this._position=Freedo.Cartographic.fromDegrees(t[0],t[1],t[2]);this._realPosition=this.offsetPosition(this._position,this._offsetHeight,new Freedo.Cartesian3);this.updateOffset()}else if(this.isNumber(t.x)&&this.isNumber(t.y)&&this.isNumber(t.z)){var r=Freedo.Cartesian3.clone(t,f);this._position=Freedo.Cartographic.fromCartesian(r);this._realPosition=this.offsetPosition(this._position,this._offsetHeight,new Freedo.Cartesian3);this.updateOffset()}}},{key:"show",set:function e(t){this._show=!!t;this.updateOffset()},get:function e(){return getComputedStyle(this._div).display!=="none"}}]);return i}();l.LabelStyle_1=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="120px";r.style.height="50px";r.style.fontSize="0px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.display="inline-block";i.style.width="40px";i.style.height="100%";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/line.png)";var n=document.createElement("div");n.style.width="80px";n.style.padding="5px";n.style.textAlign="center";n.style.fontSize="14px";n.style.display="inline-block";n.style.backgroundSize="100% 100%";n.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/border_1.png)";n.style.verticalAlign="top";n.innerHTML=e.replace(/\|/g,"<br/>");n.style.pointerEvents="auto";n.style.boxSizing="border-box";n.style.userSelect="none";n.onclick=function(){t._event.raiseEvent("EntSelected",t)};r.appendChild(i);r.appendChild(n);t._viewer._container.appendChild(r);return r};l.LabelStyle_2=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="140px";r.style.height="40px";r.style.fontSize="0px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.display="inline-block";i.style.width="40px";i.style.height="100%";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/line.png)";var n=document.createElement("div");n.style.width="130px";n.style.height="34px";n.style.padding="5px";n.style.textAlign="center";n.style.fontSize="18px";n.style.color="white";n.style.display="inline-block";n.style.backgroundSize="100% 100%";n.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/border_1.png)";n.style.verticalAlign="top";n.innerHTML=e.replace(/\|/g,"<br/>");n.style.pointerEvents="auto";n.style.boxSizing="border-box";n.style.userSelect="none";n.onclick=function(){t._event.raiseEvent("EntSelected",t)};r.appendChild(n);t._viewer._container.appendChild(r);return r};l.LabelStyle_3=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="150px";r.style.height="40px";r.style.fontSize="0px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.display="inline-block";i.style.width="40px";i.style.height="100%";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/line.png)";var n=document.createElement("div");n.style.width="140px";n.style.height="34px";n.style.padding="5px";n.style.textAlign="center";n.style.fontSize="14px";n.style.color="white";n.style.display="inline-block";n.style.backgroundSize="100% 100%";n.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style1/border_1.png)";n.style.verticalAlign="top";n.innerHTML=e.replace(/\|/g,"<br/>");n.style.pointerEvents="auto";n.style.boxSizing="border-box";n.style.userSelect="none";n.onclick=function(){t._event.raiseEvent("EntSelected",t)};r.appendChild(n);t._viewer._container.appendChild(r);return r};function u(e){var t=0,r=e.length,i=-1;for(var n=0;n<r;n++){i=e.charCodeAt(n);if(i>=0&&i<=128)t+=1;else t+=2}return t}l.LabelStyle_4=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="84px";r.style.height="68px";r.style.fontSize="0px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.display="inline-block";i.style.width="84px";i.style.height="68px";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Misc/labels/style4/billboard.png)";var n=document.createElement("div");n.style.position="absolute";n.style.width="70px";n.style.height="14px";n.style.left="12px";n.style.top="6px";n.style.textAlign="center";n.style.fontSize="14px";n.style.color="white";n.style.display="inline-block";n.style.verticalAlign="top";n.innerHTML=e.replace(/\|/g,"<br/>");n.style.pointerEvents="auto";n.style.boxSizing="border-box";n.style.userSelect="none";n.onclick=function(){t._event.raiseEvent("EntSelected",t)};var a=u(e);if(a>8){var o=Math.ceil((a-8)/2);r.style.width=84+o*20+"px";i.style.width=84+o*20+"px";n.style.width=70+o*20+"px"}r.appendChild(i);r.appendChild(n);t._viewer._container.appendChild(r);return r};l.LabelStyle_5=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="64px";r.style.height="64px";r.style.fontSize="12px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.width="64px";i.style.height="64px";i.style.paddingTop="13px";i.style.textAlign="center";i.style.fontSize="12px";i.style.color="black";i.style.display="inline-block";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Textures/pin/pin4.png)";i.style.verticalAlign="top";i.innerHTML=e.replace(/\|/g,"<br/>");i.style.pointerEvents="auto";i.style.boxSizing="border-box";i.style.userSelect="none";i.onclick=function(){t._event.raiseEvent("EntSelected",t)};r.appendChild(i);t._viewer._container.appendChild(r);return r};l.LabelStyle_6=function(e,t){var r=document.createElement("div");r.style.position="absolute";r.style.width="64px";r.style.height="64px";r.style.fontSize="12px";r.style.pointerEvents="none";var i=document.createElement("div");i.style.width="64px";i.style.height="64px";i.style.paddingTop="13px";i.style.textAlign="center";i.style.fontSize="12px";i.style.color="black";i.style.display="inline-block";i.style.backgroundSize="100% 100%";i.style.backgroundImage="url("+Freedo.FdApp.getFreedoXPath()+"Assets/Textures/pin/pin6.png)";i.style.verticalAlign="top";i.innerHTML=e.replace(/\|/g,"<br/>");i.style.pointerEvents="auto";i.style.boxSizing="border-box";i.style.userSelect="none";i.onclick=function(){t._event.raiseEvent("EntSelected",t)};r.appendChild(i);t._viewer._container.appendChild(r);return r};var d=new Freedo.Cartographic;var c=new Freedo.Cartesian2;var f=new Freedo.Cartesian3;var h=new Freedo.Cartesian3;var p=new Freedo.Cartesian3;t.FdDivLabel=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnchorLabel=undefined;var i=r(1);var a=u(i);var n=r(2);var o=u(n);var l=r(5);var s=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function n(e,t,r){var i=this;(0,a.default)(this,n);this._viewer=e;this._id=t;this._data=r;this._points=e.entities;this._point=undefined;this._canvas=undefined;this._ple=new s.FdPolylineEditor(e);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._cameraLsnr=e.camera.changed.addEventListener(function(){i.updatePosition()});this._timeInterval=setInterval(function(){i.updatePosition()},3e3);this.create()}(0,o.default)(n,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return n}();d.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdAnchorLabel.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.paddingLeft)){this._data.paddingLeft=50}if(!Freedo.defined(this._data.moveTop)){this._data.moveTop=50}if(!Freedo.defined(this._data.offset)){this._data.offset=0}if(!Freedo.defined(this._data.maxDistance)){this._data.maxDistance=1e13}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};d.prototype.refresh=function(){this._viewer.scene.requestRender()};d.prototype.getPositionXY=function(){if(!Freedo.defined(this._point))return undefined;var e=this._point.position.getValue(Freedo.JulianDate.now());var t=Freedo.FdMisc.FdGeometric.tg(e);var r=l.FdMisc.FdMath.computeScreenSpacePosition(this._viewer.scene,e);if(!Freedo.defined(r))return undefined;return r};d.prototype.updatePosition=function(){var e=this.getPositionXY();if(!e)return;var t=this._viewer.container.getClientRects()[0].x;var r=this._viewer.container.getClientRects()[0].y;this._canvas.style.left=t+(e.x+0)+"px";this._canvas.style.top=r+(e.y-this._data.moveTop)+"px";if(this._data.maxDistance){var i=this._point.position.getValue(Freedo.JulianDate.now());var n=Freedo.Cartesian3.distance(i,this._viewer.scene.camera.position);if(n>this._data.maxDistance){this.hide()}else{this.show()}}this.refresh()};d.prototype.updateHeight=function(){if(!this._point.show)return;var e=this._data.position;var t=new Freedo.Cartographic.fromDegrees(e[0],e[1],e[2]);var r=undefined;var i=this._viewer.scene;r=i.globe.getHeight(t);if(!r)return;var n=Freedo.FdMisc.FdGeometric.tc([e[0],e[1],e[2]+r+this._data.offset]);this._point.position=n;this.refresh();this.updatePosition()};d.prototype.update=function(){this.updateContent()};d.prototype.updateContent=function(){var e=this.getPositionXY();if(!e)return;var t=this._data,r=t.lineWidth,i=r===undefined?1:r,n=t.lineColor,a=n===undefined?"white":n,o=t.textColor,s=o===undefined?"white":o,l=t.fontSize,u=l===undefined?16:l;var d=this._canvas.getContext("2d");d.clearRect(0,0,this._canvas.width,this._canvas.height);var c=this._data.paddingLeft;var f=1;var h=4;var p=this._data.width-c;var v=this._data.height-f;var m=this._data.moveTop;d.beginPath();d.moveTo(c,f+h);d.arcTo(c,f,c+h,f,h);d.lineTo(c+p-h,f);d.arcTo(c+p,f,c+p,f+h,h);d.lineTo(c+p,f+v-h);d.arcTo(c+p,f+v,c+p-h,f+v,h);d.lineTo(c+h,f+v);d.arcTo(c,f+v,c,f+v-h,h);d.fillStyle="rgba(100, 100, 100, 0.4)";d.fill();d.lineWidth=i;d.strokeStyle="black";d.stroke();d.beginPath();d.moveTo(c,f+v-h);d.lineTo(c,f+h);d.lineWidth=i;d.closePath();d.strokeStyle=a;d.stroke();d.beginPath();d.moveTo(0,m);d.lineTo(c*.6,v/2);d.lineTo(c,v/2);d.strokeStyle=a;d.stroke();d.font=u+"px 雅黑";d.lineWidth=i;d.fillStyle=s;d.textAlign="left";var _=this._data.text.split("|");for(var y=0;y<_.length;y++){d.fillText(_[y],c+10,f+(u+4)*(y+1))}};d.prototype.build=function(){var e=this._data;var t=e.position;var r=e.width;var i=e.height;if(!Freedo.defined(r)||!Freedo.defined(i)){console.error("FdAnchorLabel.prototype.build：width或height参数无效");return}if(!t)return;var n=l.FdMisc.FdGeometric.tc(t);var a=Freedo.Cartographic.fromCartesian(n);var o=l.FdMisc.FdGeometric.getLongAndLatRatio(a);this._data.positionC=Freedo.clone(n,true);this._point=this._points.add({position:n,point:{color:Freedo.Color.WHITE,pixelSize:5,outlineColor:Freedo.Color.RED.withAlpha(.5),outlineWidth:3,show:true,disableDepthTestDistance:this._data.maxDistance}});if(this._canvas){document.body.removeChild(this._canvas);this._canvas=undefined}this._canvas=document.createElement("canvas");this._canvas.id=this._id;this._canvas.style.position="absolute";this._canvas.style.display="block";this._canvas.style.zIndex="999";this._canvas.width=e.width+10;var s=e.moveTop>e.height?e.moveTop:e.height;this._canvas.height=s+10;this._canvas.style.pointerEvents="none";document.body.appendChild(this._canvas);if(e.show===false){this.hide()}this.updateContent();this.updatePosition();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};d.prototype.addLsnr=function(){if(this._lsner)this._lsner();var n=this;this._lsner=this._ple.on(function(e,t){if(e=="cancel"){this.cancel()}if(e=="PointAdded"){n._data.position=Freedo.clone(t.position,true);n._ple.cancel();n._lsner();n.build()}if(e=="Transformed"){var r=t.positionG;var i=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height);n._data.position=Freedo.FdMisc.FdGeometric.tg(i);n.clear();n.build()}})};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.startEdit=function(){console.info("开始编辑");this.addLsnr();this._ple.startEdit([this._data.positionC])};d.prototype.endEdit=function(){this._ple.endEdit()};d.prototype.clear=function(){this._points.remove(this._point);if(this._canvas){document.body.removeChild(this._canvas);this._canvas=undefined}this._viewer.scene.requestRender()};d.prototype.remove=function(){this.clear();this.reset();this._data=undefined;this._viewer.scene.requestRender()};d.prototype.show=function(){if(this._point){this._point.show=true}if(this._canvas){this._canvas.style.display="block"}if(this._data){this._data.show=true}this._viewer.scene.requestRender()};d.prototype.hide=function(){if(this._point){this._point.show=false}if(this._canvas){this._canvas.style.display="none"}if(this._data){this._data.show=false}this._viewer.scene.requestRender()};d.prototype.setText=function(e){this.clear();this._data.text=e;this.build()};d.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"AnchorLabel",option:e}};d.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel();if(this._cameraLsnr){this._cameraLsnr();this._cameraLsnr=undefined}if(this._timeInterval){clearInterval(this._timeInterval);this._timeInterval=undefined}};d.prototype.dispose=function(){this.reset();this.remove()};t.FdAnchorLabel=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicHemisphere=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);var b=r(48);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function i(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=Freedo.clone(r);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this.build(r)}(0,o.default)(i,[{key:"build",value:function e(t){this._primitive=this.buildPrimitive(t);this._viewer.scene.primitives.add(this._primitive);this.runAnimation()}},{key:"buildPrimitive",value:function e(t){var r=this.buildGeometry(t);var i=this.buildAppearance(t);var n=t.modelMatrix?t.modelMatrix:Freedo.Transforms.eastNorthUpToFixedFrame(t.position);return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:r}),appearance:i,asynchronous:false,modelMatrix:n})}},{key:"buildAppearance",value:function e(t){var r=Freedo.defaultValue(t.color,new Freedo.Color(1,1,0,1));var i=Freedo.defaultValue(this._data.cycle,1);var n=new Freedo.Material({fabric:{type:"Color",uniforms:{color:r,PI:Math.PI,offset:0},components:{alpha:"1.0-sin(PI/"+new Number(i).toFixed(2)+"*abs(materialInput.st.y - offset))",diffuse:"vec3(color.x,color.y,color.z)"}}});this._material=n;return new Freedo.MaterialAppearance({material:n,translucent:true,flat:true,faceForward:true,renderState:{depthMask:false,depthTest:{enabled:false}}})}},{key:"buildGeometry",value:function e(t){this._radius=Freedo.defaultValue(t.radius,1);this._stacks=Freedo.defaultValue(t.stacks,64);this._slices=Freedo.defaultValue(t.slices,64);var r=this.triangulate(this._radius,this._stacks,this._slices);var i=new Float64Array(r.positions);var n=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:i});var a=new Uint32Array(r.indices);var o=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:true,values:new Float32Array(r.normals)});var s=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(r.st)});return new Freedo.Geometry({attributes:{position:n,st:s,normal:o},indices:a,primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(i)})}},{key:"triangulate",value:function e(t,r,i){var n=new Freedo.Cartesian3(0,0,t);var a=[0,0,t],o=[],s=[0,0,1],l=[0,0];var u=[];for(var d=1;d<=r;d++){var c=d*Math.PI/2/r;var f=Math.sin(c)*t;var h=b.FdLoft.buildCirclePts(new Freedo.Cartesian3(0,0,f/Math.tan(c)),f,Freedo.Cartesian3.UNIT_Z,i);h.forEach(function(e){return a.push(e.x,e.y,e.z)});var p=d/i;var v=(d-1)*i+1;for(var m=0;m<i;m++){var _=h[m];s.push(_.x/t,_.y/t,_.z/t);l.push(0,p);var y=(m+1)%i;if(d<=1){var g=[0,m+v,(m>=i-1?0:m+1)+v];o.push.apply(o,g)}else{var w=[v+m,v+m-i,v+y-i],F=[v+y-i,v+y,v+m];o.push.apply(o,w);o.push.apply(o,F)}}u.push(h)}return{positions:a,indices:o,normals:s,st:l}}},{key:"computeNormal",value:function e(t){var r=new Freedo.Cartesian3;for(var i=0;i<t.length;i+=3){var n=Freedo.Cartesian3.subtract(t[i+1],t[i],new Freedo.Cartesian3);var a=Freedo.Cartesian3.subtract(t[i+2],t[i+1],new Freedo.Cartesian3);var o=Freedo.Cartesian3.cross(a,n,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(o,o);Freedo.Cartesian3.add(r,o,r)}Freedo.Cartesian3.normalize(r,r);return[r.x,r.y,r.z]}},{key:"showPoints",value:function e(t){var r=this;this._points=new Freedo.PointPrimitiveCollection({modelMatrix:this._data.modelMatrix});this._viewer.scene.primitives.add(this._points);t.forEach(function(e){r._points.add({position:e,pixelSize:10})})}},{key:"runAnimation",value:function e(){var r=this;var i=Freedo.defaultValue(this._data.speed,.005);var t=function e(t){if(r._material.uniforms.offset>=1){r._material.uniforms.offset=0}else{r._material.uniforms.offset+=i}r._viewer.scene.requestRender();r._animationId=requestAnimationFrame(e)};this._animationId=requestAnimationFrame(t)}},{key:"remove",value:function e(){cancelAnimationFrame(this._animationId);this._viewer.scene.primitives.remove(this._primitive)}},{key:"getData",value:function e(){return{id:this._id,type:"DynamicHemisphere",option:Freedo.clone(this._data)}}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"show",get:function e(){return this._primitive&&this._primitive.show},set:function e(t){this._primitive.show=!!t}},{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();t.FdDynamicHemisphere=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Freedo.Matrix4;var n=Freedo.Quaternion.fromAxisAngle(t,r,new Freedo.Quaternion);var a=Freedo.Matrix3.fromQuaternion(n,new Freedo.Matrix3);return Freedo.Matrix4.multiplyByMatrix3(e,a,i)}t.rotateMatrix=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GLTFLoader=undefined;var i=r(758);var E=u(i);var n=r(121);var a=u(n);var o=r(72);var s=u(o);var l=r(49);var y=u(l);function u(e){return e&&e.__esModule?e:{default:e}}function d(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.dracoLoader=null}d.prototype={constructor:d,crossOrigin:"anonymous",load:function e(t,r,i,n){var a=this;var o=this.path!==undefined?this.path:THREE.LoaderUtils.extractUrlBase(t);var s;if(t.indexOf("?")!==-1){s=t.substr(t.indexOf("?"))}var l=new THREE.FileLoader(a.manager);l.setResponseType("arraybuffer");l.load(t,function(e){try{a.parse(e,o,s,r,n)}catch(e){if(n!==undefined){n(e)}else{throw e}}},i,n)},setCrossOrigin:function e(t){this.crossOrigin=t;return this},setPath:function e(t){this.path=t;return this},setDRACOLoader:function e(t){this.dracoLoader=t;return this},parse:function e(t,r,i,o,n){var a;var s={};if(typeof t==="string"){a=t}else{var l=THREE.LoaderUtils.decodeText(new Uint8Array(t,0,4));if(l===_){try{s[S.KHR_BINARY_GLTF]=new w(t)}catch(e){if(n)n(e);return}a=s[S.KHR_BINARY_GLTF].content}else{a=THREE.LoaderUtils.decodeText(new Uint8Array(t))}}var u=JSON.parse(a);if(u.asset===undefined||u.asset.version[0]<2){if(n)n(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));return}if(u.extensionsUsed){for(var d=0;d<u.extensionsUsed.length;++d){var c=u.extensionsUsed[d];var f=u.extensionsRequired||[];switch(c){case S.KHR_LIGHTS_PUNCTUAL:s[c]=new v(u);break;case S.KHR_MATERIALS_UNLIT:s[c]=new m(u);break;case S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[c]=new b;break;case S.KHR_DRACO_MESH_COMPRESSION:s[c]=new F(u,this.dracoLoader);break;case S.MSFT_TEXTURE_DDS:s[S.MSFT_TEXTURE_DDS]=new p;break;default:if(f.indexOf(c)>=0){console.warn('GLTFLoader: Unknown extension "'+c+'".')}}}}var h=new te(u,s,{path:r||this.path||"",crossOrigin:this.crossOrigin,queryParameters:i,manager:this.manager});h.parse(function(e,t,r,i,n){var a={scene:e,scenes:t,cameras:r,animations:i,asset:n.asset,parser:h,userData:{}};U(s,a,n);o(a)},n)}};function c(){var i={};return{get:function e(t){return i[t]},add:function e(t,r){i[t]=r},remove:function e(t){delete i[t]},removeAll:function e(){i={}}}}var S={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function p(){if(!THREE.DDSLoader){throw new Error("GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader")}this.name=S.MSFT_TEXTURE_DDS;this.ddsLoader=new THREE.DDSLoader}function v(e){this.name=S.KHR_LIGHTS_PUNCTUAL;this.lights=[];var t=e.extensions&&e.extensions[S.KHR_LIGHTS_PUNCTUAL]||{};var r=t.lights||[];for(var i=0;i<r.length;i++){var n=r[i];var a;var o=new THREE.Color(16777215);if(n.color!==undefined)o.fromArray(n.color);var s=n.range!==undefined?n.range:0;switch(n.type){case"directional":a=new THREE.DirectionalLight(o);a.target.position.set(0,0,1);a.add(a.target);break;case"point":a=new THREE.PointLight(o);a.distance=s;break;case"spot":a=new THREE.SpotLight(o);a.distance=s;n.spot=n.spot||{};n.spot.innerConeAngle=n.spot.innerConeAngle!==undefined?n.spot.innerConeAngle:0;n.spot.outerConeAngle=n.spot.outerConeAngle!==undefined?n.spot.outerConeAngle:Math.PI/4;a.angle=n.spot.outerConeAngle;a.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle;a.target.position.set(0,0,1);a.add(a.target);break;default:throw new Error('GLTFLoader: Unexpected light type, "'+n.type+'".')}a.decay=2;if(n.intensity!==undefined)a.intensity=n.intensity;a.name=n.name||"light_"+i;this.lights.push(a)}}function m(e){this.name=S.KHR_MATERIALS_UNLIT}m.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial};m.prototype.extendParams=function(e,t,r){var i=[];e.color=new THREE.Color(1,1,1);e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var a=n.baseColorFactor;e.color.fromArray(a);e.opacity=a[3]}if(n.baseColorTexture!==undefined){i.push(r.assignTexture(e,"map",n.baseColorTexture.index))}}return y.default.all(i)};var f="binary_glTF";var _="glTF";var h=12;var g={JSON:1313821514,BIN:5130562};function w(e){this.name=S.KHR_BINARY_GLTF;this.content=null;this.body=null;var t=new DataView(e,0,h);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,true),length:t.getUint32(8,true)};if(this.header.magic!==_){throw new Error("GLTFLoader: Unsupported glTF-Binary header.")}else if(this.header.version<2){throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.")}var r=new DataView(e,h);var i=0;while(i<r.byteLength){var n=r.getUint32(i,true);i+=4;var a=r.getUint32(i,true);i+=4;if(a===g.JSON){var o=new Uint8Array(e,h+i,n);this.content=THREE.LoaderUtils.decodeText(o)}else if(a===g.BIN){var s=h+i;this.body=e.slice(s,s+n)}i+=n}if(this.content===null){throw new Error("GLTFLoader: JSON content not found.")}}function F(e,t){if(!t){throw new Error("GLTFLoader: No DRACOLoader instance provided.")}this.name=S.KHR_DRACO_MESH_COMPRESSION;this.json=e;this.dracoLoader=t}F.prototype.decodePrimitive=function(e,t){var r=this.json;var i=this.dracoLoader;var n=e.extensions[this.name].bufferView;var a=e.extensions[this.name].attributes;var o={};var s={};var l={};for(var u in a){if(!(u in O))continue;o[O[u]]=a[u]}for(u in e.attributes){if(O[u]!==undefined&&a[u]!==undefined){var d=r.accessors[e.attributes[u]];var c=P[d.componentType];l[O[u]]=c;s[O[u]]=d.normalized===true}}return t.getDependency("bufferView",n).then(function(e){return new y.default(function(n){i.decodeDracoFile(e,function(e){for(var t in e.attributes){var r=e.attributes[t];var i=s[t];if(i!==undefined)r.normalized=i}n(e)},o,l)})})};function b(){return{name:S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function e(){return THREE.ShaderMaterial},extendParams:function e(t,r,i){var n=r.extensions[this.name];var a=THREE.ShaderLib["standard"];var o=THREE.UniformsUtils.clone(a.uniforms);var s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n");var u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n");var d=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n");var c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n");var f=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",d).replace("#include <lights_physical_fragment>",c);delete o.roughness;delete o.metalness;delete o.roughnessMap;delete o.metalnessMap;o.specular={value:(new THREE.Color).setHex(1118481)};o.glossiness={value:.5};o.specularMap={value:null};o.glossinessMap={value:null};t.vertexShader=a.vertexShader;t.fragmentShader=f;t.uniforms=o;t.defines={STANDARD:""};t.color=new THREE.Color(1,1,1);t.opacity=1;var h=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;t.color.fromArray(p);t.opacity=p[3]}if(n.diffuseTexture!==undefined){h.push(i.assignTexture(t,"map",n.diffuseTexture.index))}t.emissive=new THREE.Color(0,0,0);t.glossiness=n.glossinessFactor!==undefined?n.glossinessFactor:1;t.specular=new THREE.Color(1,1,1);if(Array.isArray(n.specularFactor)){t.specular.fromArray(n.specularFactor)}if(n.specularGlossinessTexture!==undefined){var v=n.specularGlossinessTexture.index;h.push(i.assignTexture(t,"glossinessMap",v));h.push(i.assignTexture(t,"specularMap",v))}return y.default.all(h)},createMaterial:function e(t){var r=new THREE.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:true,lights:true,opacity:t.opacity,transparent:t.transparent});r.isGLTFSpecularGlossinessMaterial=true;r.color=t.color;r.map=t.map===undefined?null:t.map;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=t.aoMap===undefined?null:t.aoMap;r.aoMapIntensity=1;r.emissive=t.emissive;r.emissiveIntensity=1;r.emissiveMap=t.emissiveMap===undefined?null:t.emissiveMap;r.bumpMap=t.bumpMap===undefined?null:t.bumpMap;r.bumpScale=1;r.normalMap=t.normalMap===undefined?null:t.normalMap;if(t.normalScale)r.normalScale=t.normalScale;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=t.specularMap===undefined?null:t.specularMap;r.specular=t.specular;r.glossinessMap=t.glossinessMap===undefined?null:t.glossinessMap;r.glossiness=t.glossiness;r.alphaMap=null;r.envMap=t.envMap===undefined?null:t.envMap;r.envMapIntensity=1;r.refractionRatio=.98;r.extensions.derivatives=true;return r},cloneMaterial:function e(t){var r=t.clone();r.isGLTFSpecularGlossinessMaterial=true;var i=this.specularGlossinessParams;for(var n=0,a=i.length;n<a;n++){r[i[n]]=t[i[n]]}return r},refreshUniforms:function e(t,r,i,n,a,o){if(a.isGLTFSpecularGlossinessMaterial!==true){return}var s=a.uniforms;var l=a.defines;s.opacity.value=a.opacity;s.diffuse.value.copy(a.color);s.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity);s.map.value=a.map;s.specularMap.value=a.specularMap;s.alphaMap.value=a.alphaMap;s.lightMap.value=a.lightMap;s.lightMapIntensity.value=a.lightMapIntensity;s.aoMap.value=a.aoMap;s.aoMapIntensity.value=a.aoMapIntensity;var u;if(a.map){u=a.map}else if(a.specularMap){u=a.specularMap}else if(a.displacementMap){u=a.displacementMap}else if(a.normalMap){u=a.normalMap}else if(a.bumpMap){u=a.bumpMap}else if(a.glossinessMap){u=a.glossinessMap}else if(a.alphaMap){u=a.alphaMap}else if(a.emissiveMap){u=a.emissiveMap}if(u!==undefined){if(u.isWebGLRenderTarget){u=u.texture}if(u.matrixAutoUpdate===true){u.updateMatrix()}s.uvTransform.value.copy(u.matrix)}s.envMap.value=a.envMap;s.envMapIntensity.value=a.envMapIntensity;s.flipEnvMap.value=a.envMap&&a.envMap.isCubeTexture?-1:1;s.refractionRatio.value=a.refractionRatio;s.specular.value.copy(a.specular);s.glossiness.value=a.glossiness;s.glossinessMap.value=a.glossinessMap;s.emissiveMap.value=a.emissiveMap;s.bumpMap.value=a.bumpMap;s.normalMap.value=a.normalMap;s.displacementMap.value=a.displacementMap;s.displacementScale.value=a.displacementScale;s.displacementBias.value=a.displacementBias;if(s.glossinessMap.value!==null&&l.USE_GLOSSINESSMAP===undefined){l.USE_GLOSSINESSMAP="";l.USE_ROUGHNESSMAP=""}if(s.glossinessMap.value===null&&l.USE_GLOSSINESSMAP!==undefined){delete l.USE_GLOSSINESSMAP;delete l.USE_ROUGHNESSMAP}}}}function C(e,t,r,i){THREE.Interpolant.call(this,e,t,r,i)}C.prototype=(0,s.default)(THREE.Interpolant.prototype);C.prototype.constructor=C;C.prototype.copySampleValue_=function(e){var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(var a=0;a!==i;a++){t[a]=r[n+a]}return t};C.prototype.beforeStart_=C.prototype.copySampleValue_;C.prototype.afterEnd_=C.prototype.copySampleValue_;C.prototype.interpolate_=function(e,t,r,i){var n=this.resultBuffer;var a=this.sampleValues;var o=this.valueSize;var s=o*2;var l=o*3;var u=i-t;var d=(r-t)/u;var c=d*d;var f=c*d;var h=e*l;var p=h-l;var v=2*f-3*c+1;var m=f-2*c+d;var _=-2*f+3*c;var y=f-c;for(var g=0;g!==o;g++){var w=a[p+g+o];var F=a[p+g+s]*u;var b=a[h+g+o];var C=a[h+g]*u;n[g]=v*w+m*F+_*b+y*C}return n};var A={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};var x={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture};var P={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var M={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter};var T={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping};var k={1028:THREE.BackSide,1029:THREE.FrontSide};var L={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth};var D={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation};var I={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor};var R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var O={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"};var N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"};var B={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};var H={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};var V={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function G(e,t,r){if(typeof e!=="string"||e==="")return"";if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;var i=t+e;if(r){i+=r}return i}function z(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:false,depthTest:true,side:THREE.FrontSide})}function U(e,t,r){for(var i in r.extensions){if(e[i]===undefined){t.userData.gltfExtensions=t.userData.gltfExtensions||{};t.userData.gltfExtensions[i]=r.extensions[i]}}}function j(e,t){if(t.extras!==undefined){if((0,a.default)(t.extras)==="object"){e.userData=t.extras}else{console.warn("GLTFLoader: Ignoring primitive type .extras, "+t.extras)}}}function q(e,t,r){var i=false;var n=false;for(var a=0,o=t.length;a<o;a++){var s=t[a];if(s.POSITION!==undefined)i=true;if(s.NORMAL!==undefined)n=true;if(i&&n)break}if(!i&&!n)return;var l=[];var u=[];for(var a=0,o=t.length;a<o;a++){var s=t[a];var d="morphTarget"+a;if(i){if(s.POSITION!==undefined){var c=$(r[s.POSITION]);c.name=d;var f=e.attributes.position;for(var h=0,p=c.count;h<p;h++){c.setXYZ(h,c.getX(h)+f.getX(h),c.getY(h)+f.getY(h),c.getZ(h)+f.getZ(h))}}else{c=e.attributes.position}l.push(c)}if(n){var v;if(s.NORMAL!==undefined){var v=$(r[s.NORMAL]);v.name=d;var m=e.attributes.normal;for(var h=0,p=v.count;h<p;h++){v.setXYZ(h,v.getX(h)+m.getX(h),v.getY(h)+m.getY(h),v.getZ(h)+m.getZ(h))}}else{v=e.attributes.normal}u.push(v)}}if(i)e.morphAttributes.position=l;if(n)e.morphAttributes.normal=u}function W(e,t){e.updateMorphTargets();if(t.weights!==undefined){for(var r=0,i=t.weights.length;r<i;r++){e.morphTargetInfluences[r]=t.weights[r]}}if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){e.morphTargetDictionary[n[r]]=r}}else{console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function X(e,t){if(e.indices!==t.indices){return false}return Z(e.attributes,t.attributes)}function Z(e,t){if((0,E.default)(e).length!==(0,E.default)(t).length)return false;for(var r in e){if(e[r]!==t[r])return false}return true}function Y(e,t){if(e.length!==t.length)return false;for(var r=0,i=e.length;r<i;r++){if(e[r]!==t[r])return false}return true}function J(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(X(n.primitive,t))return n.promise}return null}function Q(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(Y(t,n.baseGeometries))return n.geometry}return null}function K(e,t,r){for(var i=0,n=e.length;i<n;i++){var a=e[i];if(t===a.baseGeometry&&Y(r,a.primitives))return a.geometry}return null}function $(e){if(e.isInterleavedBufferAttribute){var t=e.count;var r=e.itemSize;var i=e.array.slice(0,t*r);for(var n=0;n<t;++n){i[n]=e.getX(n);if(r>=2)i[n+1]=e.getY(n);if(r>=3)i[n+2]=e.getZ(n);if(r>=4)i[n+3]=e.getW(n)}return new THREE.BufferAttribute(i,r,e.normalized)}return e.clone()}function ee(e){if(e.length<2)return false;var t=e[0];var r=t.targets||[];if(t.indices===undefined)return false;for(var i=1,n=e.length;i<n;i++){var a=e[i];if(t.mode!==a.mode)return false;if(a.indices===undefined)return false;if(!Z(t.attributes,a.attributes))return false;var o=a.targets||[];if(r.length!==o.length)return false;for(var s=0,l=r.length;s<l;s++){if(!Z(r[s],o[s]))return false}}return true}function te(e,t,r){this.json=e||{};this.extensions=t||{};this.options=r||{};this.cache=new c;this.primitiveCache=[];this.multiplePrimitivesCache=[];this.multiPassGeometryCache=[];this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}te.prototype.parse=function(a,e){var o=this.json;this.cache.removeAll();this.markDefs();this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var t=e.scenes||[];var r=t[o.scene||0];var i=e.animations||[];var n=e.cameras||[];a(r,t,n,i,o)}).catch(e)};te.prototype.markDefs=function(){var e=this.json.nodes||[];var t=this.json.skins||[];var r=this.json.meshes||[];var i={};var n={};for(var a=0,o=t.length;a<o;a++){var s=t[a].joints;for(var l=0,u=s.length;l<u;l++){e[s[l]].isBone=true}}for(var d=0,c=e.length;d<c;d++){var f=e[d];if(f.mesh!==undefined){if(i[f.mesh]===undefined){i[f.mesh]=n[f.mesh]=0}i[f.mesh]++;if(f.skin!==undefined){r[f.mesh].isSkinnedMesh=true}}}this.json.meshReferences=i;this.json.meshUses=n};te.prototype.getDependency=function(e,t){var r=e+":"+t;var i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i};te.prototype.getDependencies=function(r){var e=this.cache.get(r);if(!e){var i=this;var t=this.json[r+(r==="mesh"?"es":"s")]||[];e=y.default.all(t.map(function(e,t){return i.getDependency(r,t)}));this.cache.add(r,e)}return e};te.prototype.getMultiDependencies=function(e){var r={};var t=[];for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=this.getDependencies(a);o=o.then(function(e,t){r[e]=t}.bind(this,a+(a==="mesh"?"es":"s")));t.push(o)}return y.default.all(t).then(function(){return r})};te.prototype.loadBuffer=function(e){var r=this.json.buffers[e];var i=this.fileLoader;if(r.type&&r.type!=="arraybuffer"){throw new Error("GLTFLoader: "+r.type+" buffer type is not supported.")}if(r.uri===undefined&&e===0){return y.default.resolve(this.extensions[S.KHR_BINARY_GLTF].body)}var n=this.options;return new y.default(function(e,t){i.load(G(r.uri,n.path,n.queryParameters),e,undefined,function(){t(new Error('GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})};te.prototype.loadBufferView=function(e){var i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteLength||0;var r=i.byteOffset||0;return e.slice(r,r+t)})};te.prototype.loadAccessor=function(e){var b=this;var C=this.json;var x=this.json.accessors[e];if(x.bufferView===undefined&&x.sparse===undefined){return null}var t=[];if(x.bufferView!==undefined){t.push(this.getDependency("bufferView",x.bufferView))}else{t.push(null)}if(x.sparse!==undefined){t.push(this.getDependency("bufferView",x.sparse.indices.bufferView));t.push(this.getDependency("bufferView",x.sparse.values.bufferView))}return y.default.all(t).then(function(e){var t=e[0];var r=R[x.type];var i=P[x.componentType];var n=i.BYTES_PER_ELEMENT;var a=n*r;var o=x.byteOffset||0;var s=C.bufferViews[x.bufferView].byteStride;var l=x.normalized===true;var u,d;if(s&&s!==a){var c="InterleavedBuffer:"+x.bufferView+":"+x.componentType;var f=b.cache.get(c);if(!f){u=new i(t);f=new THREE.InterleavedBuffer(u,s/n);b.cache.add(c,f)}d=new THREE.InterleavedBufferAttribute(f,r,o/n,l)}else{if(t===null){u=new i(x.count*r)}else{u=new i(t,o,x.count*r)}d=new THREE.BufferAttribute(u,r,l)}if(x.sparse!==undefined){var h=R.SCALAR;var p=P[x.sparse.indices.componentType];var v=x.sparse.indices.byteOffset||0;var m=x.sparse.values.byteOffset||0;var _=new p(e[1],v,x.sparse.count*h);var y=new i(e[2],m,x.sparse.count*r);if(t!==null){d.setArray(d.array.slice())}for(var g=0,w=_.length;g<w;g++){var F=_[g];d.setX(F,y[g*r]);if(r>=2)d.setY(F,y[g*r+1]);if(r>=3)d.setZ(F,y[g*r+2]);if(r>=4)d.setW(F,y[g*r+3]);if(r>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d})};te.prototype.loadTexture=function(e){var t=this;var i=this.json;var n=this.options;var a=this.textureLoader;var o=window.URL||window.webkitURL;var s=i.textures[e];var l=s.extensions||{};var r;if(l[S.MSFT_TEXTURE_DDS]){r=i.images[l[S.MSFT_TEXTURE_DDS].source]}else{r=i.images[s.source]}var u=r.uri;var d=false;if(r.bufferView!==undefined){u=t.getDependency("bufferView",r.bufferView).then(function(e){d=true;var t=new Blob([e],{type:r.mimeType});u=o.createObjectURL(t);return u})}return y.default.resolve(u).then(function(r){var i=THREE.Loader.Handlers.get(r);if(!i){i=l[S.MSFT_TEXTURE_DDS]?t.extensions[S.MSFT_TEXTURE_DDS].ddsLoader:a}return new y.default(function(e,t){i.load(G(r,n.path,n.queryParameters),e,undefined,t)})}).then(function(e){if(d===true){o.revokeObjectURL(u)}e.flipY=false;if(s.name!==undefined)e.name=s.name;var t=i.samplers||{};var r=t[s.sampler]||{};e.magFilter=M[r.magFilter]||THREE.LinearFilter;e.minFilter=M[r.minFilter]||THREE.LinearMipMapLinearFilter;e.wrapS=T[r.wrapS]||THREE.RepeatWrapping;e.wrapT=T[r.wrapT]||THREE.RepeatWrapping;return e})};te.prototype.assignTexture=function(t,r,e){return this.getDependency("texture",e).then(function(e){t[r]=e})};te.prototype.loadMaterial=function(e){var t=this;var r=this.json;var i=this.extensions;var n=this.json.materials[e];var a;var o={};var s=n.extensions||{};var l=[];if(s[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=u.getMaterialType(n);l.push(u.extendParams(o,n,t))}else if(s[S.KHR_MATERIALS_UNLIT]){var d=i[S.KHR_MATERIALS_UNLIT];a=d.getMaterialType(n);l.push(d.extendParams(o,n,t))}else{a=THREE.MeshStandardMaterial;var c=n.pbrMetallicRoughness||{};o.color=new THREE.Color(1,1,1);o.opacity=1;if(Array.isArray(c.baseColorFactor)){var f=c.baseColorFactor;o.color.fromArray(f);o.opacity=f[3]}if(c.baseColorTexture!==undefined){l.push(t.assignTexture(o,"map",c.baseColorTexture.index))}o.metalness=c.metallicFactor!==undefined?c.metallicFactor:1;o.roughness=c.roughnessFactor!==undefined?c.roughnessFactor:1;if(c.metallicRoughnessTexture!==undefined){var h=c.metallicRoughnessTexture.index;l.push(t.assignTexture(o,"metalnessMap",h));l.push(t.assignTexture(o,"roughnessMap",h))}}if(n.doubleSided===true){o.side=THREE.DoubleSide}var p=n.alphaMode||V.OPAQUE;if(p===V.BLEND){o.transparent=true}else{o.transparent=false;if(p===V.MASK){o.alphaTest=n.alphaCutoff!==undefined?n.alphaCutoff:.5}}if(n.normalTexture!==undefined&&a!==THREE.MeshBasicMaterial){l.push(t.assignTexture(o,"normalMap",n.normalTexture.index));o.normalScale=new THREE.Vector2(1,1);if(n.normalTexture.scale!==undefined){o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)}}if(n.occlusionTexture!==undefined&&a!==THREE.MeshBasicMaterial){l.push(t.assignTexture(o,"aoMap",n.occlusionTexture.index));if(n.occlusionTexture.strength!==undefined){o.aoMapIntensity=n.occlusionTexture.strength}}if(n.emissiveFactor!==undefined&&a!==THREE.MeshBasicMaterial){o.emissive=(new THREE.Color).fromArray(n.emissiveFactor)}if(n.emissiveTexture!==undefined&&a!==THREE.MeshBasicMaterial){l.push(t.assignTexture(o,"emissiveMap",n.emissiveTexture.index))}return y.default.all(l).then(function(){var e;if(a===THREE.ShaderMaterial){e=i[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o)}else{e=new a(o)}if(n.name!==undefined)e.name=n.name;if(e.normalScale){e.normalScale.y=-e.normalScale.y}if(e.map)e.map.encoding=THREE.sRGBEncoding;if(e.emissiveMap)e.emissiveMap.encoding=THREE.sRGBEncoding;if(e.specularMap)e.specularMap.encoding=THREE.sRGBEncoding;j(e,n);if(n.extensions)U(i,e,n);return e})};function re(e,t,r){var i=t.attributes;for(var n in i){var a=O[n];var o=r[i[n]];if(!a)continue;if(a in e.attributes)continue;e.addAttribute(a,o)}if(t.indices!==undefined&&!e.index){e.setIndex(r[t.indices])}if(t.targets!==undefined){q(e,t.targets,r)}j(e,t)}te.prototype.loadGeometries=function(p){var v=this;var s=this.extensions;var l=this.primitiveCache;var m=ee(p);var _;if(m){_=p;p=[p[0]]}return this.getDependencies("accessor").then(function(h){var e=[];for(var t=0,r=p.length;t<r;t++){var i=p[t];var n=J(l,i);if(n){e.push(n)}else if(i.extensions&&i.extensions[S.KHR_DRACO_MESH_COMPRESSION]){var a=s[S.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(i,v).then(function(e){re(e,i,h);return e});l.push({primitive:i,promise:a});e.push(a)}else{var o=new THREE.BufferGeometry;re(o,i,h);var a=y.default.resolve(o);l.push({primitive:i,promise:a});e.push(a)}}return y.default.all(e).then(function(e){if(m){var t=e[0];var r=v.multiPassGeometryCache;var i=K(r,t,_);if(i!==null)return[i.geometry];var n=new THREE.BufferGeometry;n.name=t.name;n.userData=t.userData;for(var a in t.attributes){n.addAttribute(a,t.attributes[a])}for(var a in t.morphAttributes){n.morphAttributes[a]=t.morphAttributes[a]}var o=[];var s=0;for(var l=0,u=_.length;l<u;l++){var d=h[_[l].indices];for(var c=0,f=d.count;c<f;c++){o.push(d.array[c])}n.addGroup(s,d.count,l);s+=d.count}n.setIndex(o);r.push({geometry:n,baseGeometry:t,primitives:_});return[n]}else if(e.length>1&&THREE.BufferGeometryUtils!==undefined){for(var l=1,u=p.length;l<u;l++){if(p[0].mode!==p[l].mode)return e}var r=v.multiplePrimitivesCache;var i=Q(r,e);if(i){if(i.geometry!==null)return[i.geometry]}else{var n=THREE.BufferGeometryUtils.mergeBufferGeometries(e,true);r.push({geometry:n,baseGeometries:e});if(n!==null)return[n]}}return e})})};te.prototype.loadMesh=function(x){var P=this;var e=this.json;var M=this.extensions;var T=this.json.meshes[x];return this.getMultiDependencies(["accessor","material"]).then(function(e){var b=T.primitives;var C=[];for(var t=0,r=b.length;t<r;t++){C[t]=b[t].material===undefined?z():e.materials[b[t].material]}return P.loadGeometries(b).then(function(e){var t=e.length===1&&e[0].groups.length>0;var r=[];for(var i=0,n=e.length;i<n;i++){var a=e[i];var o=b[i];var s;var l=t?C:C[i];if(o.mode===A.TRIANGLES||o.mode===A.TRIANGLE_STRIP||o.mode===A.TRIANGLE_FAN||o.mode===undefined){s=T.isSkinnedMesh===true?new THREE.SkinnedMesh(a,l):new THREE.Mesh(a,l);if(o.mode===A.TRIANGLE_STRIP){s.drawMode=THREE.TriangleStripDrawMode}else if(o.mode===A.TRIANGLE_FAN){s.drawMode=THREE.TriangleFanDrawMode}}else if(o.mode===A.LINES){s=new THREE.LineSegments(a,l)}else if(o.mode===A.LINE_STRIP){s=new THREE.Line(a,l)}else if(o.mode===A.LINE_LOOP){s=new THREE.LineLoop(a,l)}else if(o.mode===A.POINTS){s=new THREE.Points(a,l)}else{throw new Error("GLTFLoader: Primitive mode unsupported: "+o.mode)}if((0,E.default)(s.geometry.morphAttributes).length>0){W(s,T)}s.name=T.name||"mesh_"+x;if(e.length>1)s.name+="_"+i;j(s,T);r.push(s);var u=t?s.material:[s.material];var d=a.attributes.color!==undefined;var c=a.attributes.normal===undefined;var f=s.isSkinnedMesh===true;var h=(0,E.default)(a.morphAttributes).length>0;var p=h&&a.morphAttributes.normal!==undefined;for(var v=0,m=u.length;v<m;v++){var l=u[v];if(s.isPoints){var _="PointsMaterial:"+l.uuid;var y=P.cache.get(_);if(!y){y=new THREE.PointsMaterial;THREE.Material.prototype.copy.call(y,l);y.color.copy(l.color);y.map=l.map;y.lights=false;P.cache.add(_,y)}l=y}else if(s.isLine){var _="LineBasicMaterial:"+l.uuid;var g=P.cache.get(_);if(!g){g=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(g,l);g.color.copy(l.color);g.lights=false;P.cache.add(_,g)}l=g}if(d||c||f||h){var _="ClonedMaterial:"+l.uuid+":";if(l.isGLTFSpecularGlossinessMaterial)_+="specular-glossiness:";if(f)_+="skinning:";if(d)_+="vertex-colors:";if(c)_+="flat-shading:";if(h)_+="morph-targets:";if(p)_+="morph-normals:";var w=P.cache.get(_);if(!w){w=l.isGLTFSpecularGlossinessMaterial?M[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(l):l.clone();if(f)w.skinning=true;if(d)w.vertexColors=THREE.VertexColors;if(c)w.flatShading=true;if(h)w.morphTargets=true;if(p)w.morphNormals=true;P.cache.add(_,w)}l=w}u[v]=l;if(l.aoMap&&a.attributes.uv2===undefined&&a.attributes.uv!==undefined){console.log("GLTFLoader: Duplicating UVs to support aoMap.");a.addAttribute("uv2",new THREE.BufferAttribute(a.attributes.uv.array,2))}if(l.isGLTFSpecularGlossinessMaterial){s.onBeforeRender=M[S.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms}}s.material=t?u:u[0]}if(r.length===1){return r[0]}var F=new THREE.Group;for(var i=0,n=r.length;i<n;i++){F.add(r[i])}return F})})};te.prototype.loadCamera=function(e){var t;var r=this.json.cameras[e];var i=r[r.type];if(!i){console.warn("GLTFLoader: Missing camera parameters.");return}if(r.type==="perspective"){t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6)}else if(r.type==="orthographic"){t=new THREE.OrthographicCamera(i.xmag/-2,i.xmag/2,i.ymag/2,i.ymag/-2,i.znear,i.zfar)}if(r.name!==undefined)t.name=r.name;j(t,r);return y.default.resolve(t)};te.prototype.loadSkin=function(e){var t=this.json.skins[e];var r={joints:t.joints};if(t.inverseBindMatrices===undefined){return y.default.resolve(r)}return this.getDependency("accessor",t.inverseBindMatrices).then(function(e){r.inverseBindMatrices=e;return r})};te.prototype.loadAnimation=function(w){var e=this.json;var F=this.json.animations[w];return this.getMultiDependencies(["accessor","node"]).then(function(e){var t=[];for(var r=0,i=F.channels.length;r<i;r++){var n=F.channels[r];var a=F.samplers[n.sampler];if(a){var o=n.target;var s=o.node!==undefined?o.node:o.id;var l=F.parameters!==undefined?F.parameters[a.input]:a.input;var u=F.parameters!==undefined?F.parameters[a.output]:a.output;var d=e.accessors[l];var c=e.accessors[u];var f=e.nodes[s];if(f){f.updateMatrix();f.matrixAutoUpdate=true;var h;switch(N[o.path]){case N.weights:h=THREE.NumberKeyframeTrack;break;case N.rotation:h=THREE.QuaternionKeyframeTrack;break;case N.position:case N.scale:default:h=THREE.VectorKeyframeTrack;break}var p=f.name?f.name:f.uuid;var v=a.interpolation!==undefined?B[a.interpolation]:THREE.InterpolateLinear;var m=[];if(N[o.path]===N.weights){f.traverse(function(e){if(e.isMesh===true&&e.morphTargetInfluences){m.push(e.name?e.name:e.uuid)}})}else{m.push(p)}for(var _=0,y=m.length;_<y;_++){var g=new h(m[_]+"."+N[o.path],THREE.AnimationUtils.arraySlice(d.array,0),THREE.AnimationUtils.arraySlice(c.array,0),v);if(a.interpolation==="CUBICSPLINE"){g.createInterpolant=function e(t){return new C(this.times,this.values,this.getValueSize()/3,t)};g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=true}t.push(g)}}}}var s=F.name!==undefined?F.name:"animation_"+w;return new THREE.AnimationClip(s,undefined,t)})};te.prototype.loadNode=function(e){var t=this.json;var l=this.extensions;var u=this.json.meshReferences;var d=this.json.meshUses;var c=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera","light"]).then(function(e){var t;if(c.isBone===true){t=new THREE.Bone}else if(c.mesh!==undefined){var r=e.meshes[c.mesh];if(u[c.mesh]>1){var i=d[c.mesh]++;t=r.clone();t.name+="_instance_"+i;t.onBeforeRender=r.onBeforeRender;for(var n=0,a=t.children.length;n<a;n++){t.children[n].name+="_instance_"+i;t.children[n].onBeforeRender=r.children[n].onBeforeRender}}else{t=r}}else if(c.camera!==undefined){t=e.cameras[c.camera]}else if(c.extensions&&c.extensions[S.KHR_LIGHTS_PUNCTUAL]&&c.extensions[S.KHR_LIGHTS_PUNCTUAL].light!==undefined){var o=l[S.KHR_LIGHTS_PUNCTUAL].lights;t=o[c.extensions[S.KHR_LIGHTS_PUNCTUAL].light]}else{t=new THREE.Object3D}if(c.name!==undefined){t.name=THREE.PropertyBinding.sanitizeNodeName(c.name)}j(t,c);if(c.extensions)U(l,t,c);if(c.matrix!==undefined){var s=new THREE.Matrix4;s.fromArray(c.matrix);t.applyMatrix(s)}else{if(c.translation!==undefined){t.position.fromArray(c.translation)}if(c.rotation!==undefined){t.quaternion.fromArray(c.rotation)}if(c.scale!==undefined){t.scale.fromArray(c.scale)}}return t})};te.prototype.loadScene=function(){function F(e,t,r,i,n){var a=i[e];var o=r.nodes[e];if(o.skin!==undefined){var s=a.isGroup===true?a.children:[a];for(var l=0,u=s.length;l<u;l++){var d=s[l];var c=n[o.skin];var f=[];var h=[];for(var p=0,v=c.joints.length;p<v;p++){var m=c.joints[p];var _=i[m];if(_){f.push(_);var y=new THREE.Matrix4;if(c.inverseBindMatrices!==undefined){y.fromArray(c.inverseBindMatrices.array,p*16)}h.push(y)}else{console.warn('GLTFLoader: Joint "%s" could not be found.',m)}}d.bind(new THREE.Skeleton(f,h),d.matrixWorld)}}t.add(a);if(o.children){var g=o.children;for(var l=0,u=g.length;l<u;l++){var w=g[l];F(w,a,r,i,n)}}}return function e(t){var a=this.json;var o=this.extensions;var s=this.json.scenes[t];return this.getMultiDependencies(["node","skin"]).then(function(e){var t=new THREE.Scene;if(s.name!==undefined)t.name=s.name;j(t,s);if(s.extensions)U(o,t,s);var r=s.nodes||[];for(var i=0,n=r.length;i<n;i++){F(r[i],t,a,e.nodes,e.skins)}return t})}}();t.GLTFLoader=d},function(e,t,r){"use strict";r(274);var i=r(475);var n=r(5);var a=r(511);var o=r(532);var s=r(593);var l=r(697);var u=r(712);var d=r(728);var c=r(748);r.p=i.FdApp.getFreedoXPath()+"../";var f=typeof window!=="undefined"?window:typeof self!=="undefined"?self:{};if(typeof f.Freedo==="undefined"){f.Freedo={};console.warn("You should include freedo.js first! 你需要首先引用freedo.js，再使用freedox.js库！")}console.log("Freedo 版本："+Freedo.VERSION);console.log("FreedoX版本："+"2020-01-02");window.FreedoX=f.Freedo;FreedoX.FdApp=i.FdApp;FreedoX.FdWidgets=l.FdWidgets;FreedoX.FdMisc=n.FdMisc;FreedoX.FdCamera=a.FdCamera;FreedoX.FdMicroApp=o.FdMicroApp;FreedoX.FdTools=s.FdTools;FreedoX.FdTools.FdModel=d.FdModel;FreedoX.FdServer=u.FdServer;FreedoX.FdModel=d.FdModel;FreedoX.FdEffect=c.FdEffect;if(f.THREE){FreedoX.FdLocalView=r(756).FdLocalView}},function(e,t,r){"use strict";(function(e){r(275);r(471);r(472);if(e._babelPolyfill){throw new Error("only one instance of babel-polyfill is allowed")}e._babelPolyfill=true;var i="defineProperty";function t(e,t,r){e[t]||Object[i](e,t,{writable:true,configurable:true,value:r})}t(String.prototype,"padLeft","".padStart);t(String.prototype,"padRight","".padEnd);"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&t(Array,e,Function.call.bind([][e]))})}).call(this,r(73))},function(e,t,r){r(276);r(278);r(279);r(280);r(281);r(282);r(283);r(284);r(285);r(286);r(287);r(288);r(289);r(290);r(291);r(292);r(293);r(294);r(295);r(296);r(297);r(298);r(299);r(300);r(301);r(302);r(303);r(304);r(305);r(306);r(307);r(308);r(309);r(310);r(311);r(312);r(313);r(314);r(315);r(316);r(317);r(318);r(319);r(320);r(321);r(322);r(323);r(324);r(325);r(326);r(327);r(328);r(329);r(330);r(331);r(332);r(333);r(334);r(335);r(336);r(337);r(338);r(339);r(340);r(341);r(342);r(343);r(344);r(345);r(346);r(347);r(348);r(349);r(350);r(351);r(352);r(353);r(355);r(356);r(358);r(359);r(360);r(361);r(362);r(363);r(364);r(366);r(367);r(368);r(369);r(370);r(371);r(372);r(373);r(374);r(375);r(376);r(377);r(378);r(144);r(379);r(199);r(380);r(200);r(381);r(382);r(383);r(384);r(385);r(203);r(205);r(206);r(386);r(387);r(388);r(389);r(390);r(391);r(392);r(393);r(394);r(395);r(396);r(397);r(398);r(399);r(400);r(401);r(402);r(403);r(404);r(405);r(406);r(407);r(408);r(409);r(410);r(411);r(412);r(413);r(414);r(415);r(416);r(417);r(418);r(419);r(420);r(421);r(422);r(423);r(424);r(425);r(426);r(427);r(428);r(429);r(430);r(431);r(432);r(433);r(434);r(435);r(436);r(437);r(438);r(439);r(440);r(441);r(442);r(443);r(444);r(445);r(446);r(447);r(448);r(449);r(450);r(451);r(452);r(453);r(454);r(455);r(456);r(457);r(458);r(459);r(460);r(461);r(462);r(463);r(464);r(465);r(466);r(467);r(468);r(469);r(470);e.exports=r(29)},function(e,t,r){"use strict";var i=r(6);var s=r(25);var n=r(14);var a=r(0);var o=r(23);var l=r(50).KEY;var u=r(7);var d=r(98);var c=r(74);var f=r(58);var h=r(11);var p=r(181);var v=r(125);var m=r(277);var _=r(101);var y=r(4);var g=r(8);var w=r(26);var F=r(38);var b=r(57);var C=r(61);var x=r(184);var P=r(27);var M=r(15);var T=r(59);var E=P.f;var S=M.f;var A=x.f;var k=i.Symbol;var L=i.JSON;var D=L&&L.stringify;var I="prototype";var R=h("_hidden");var O=h("toPrimitive");var N={}.propertyIsEnumerable;var B=d("symbol-registry");var H=d("symbols");var V=d("op-symbols");var G=Object[I];var z=typeof k=="function";var U=i.QObject;var j=!U||!U[I]||!U[I].findChild;var q=n&&u(function(){return C(S({},"a",{get:function(){return S(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var i=E(G,t);if(i)delete G[t];S(e,t,r);if(i&&e!==G)S(G,t,i)}:S;var W=function(e){var t=H[e]=C(k[I]);t._k=e;return t};var X=z&&typeof k.iterator=="symbol"?function(e){return typeof e=="symbol"}:function(e){return e instanceof k};var Z=function e(t,r,i){if(t===G)Z(V,r,i);y(t);r=F(r,true);y(i);if(s(H,r)){if(!i.enumerable){if(!s(t,R))S(t,R,b(1,{}));t[R][r]=true}else{if(s(t,R)&&t[R][r])t[R][r]=false;i=C(i,{enumerable:b(0,false)})}return q(t,r,i)}return S(t,r,i)};var Y=function e(t,r){y(t);var i=m(r=w(r));var n=0;var a=i.length;var o;while(a>n)Z(t,o=i[n++],r[o]);return t};var J=function e(t,r){return r===undefined?C(t):Y(C(t),r)};var Q=function e(t){var r=N.call(this,t=F(t,true));if(this===G&&s(H,t)&&!s(V,t))return false;return r||!s(this,t)||!s(H,t)||s(this,R)&&this[R][t]?r:true};var K=function e(t,r){t=w(t);r=F(r,true);if(t===G&&s(H,r)&&!s(V,r))return;var i=E(t,r);if(i&&s(H,r)&&!(s(t,R)&&t[R][r]))i.enumerable=true;return i};var $=function e(t){var r=A(w(t));var i=[];var n=0;var a;while(r.length>n){if(!s(H,a=r[n++])&&a!=R&&a!=l)i.push(a)}return i};var ee=function e(t){var r=t===G;var i=A(r?V:w(t));var n=[];var a=0;var o;while(i.length>a){if(s(H,o=i[a++])&&(r?s(G,o):true))n.push(H[o])}return n};if(!z){k=function e(){if(this instanceof k)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:undefined);var r=function(e){if(this===G)r.call(V,e);if(s(this,R)&&s(this[R],t))this[R][t]=false;q(this,t,b(1,e))};if(n&&j)q(G,t,{configurable:true,set:r});return W(t)};o(k[I],"toString",function e(){return this._k});P.f=K;M.f=Z;r(62).f=x.f=$;r(86).f=Q;r(100).f=ee;if(n&&!r(51)){o(G,"propertyIsEnumerable",Q,true)}p.f=function(e){return W(h(e))}}a(a.G+a.W+a.F*!z,{Symbol:k});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)h(te[re++]);for(var ie=T(h.store),ne=0;ie.length>ne;)v(ie[ne++]);a(a.S+a.F*!z,"Symbol",{for:function(e){return s(B,e+="")?B[e]:B[e]=k(e)},keyFor:function e(t){if(!X(t))throw TypeError(t+" is not a symbol!");for(var r in B)if(B[r]===t)return r},useSetter:function(){j=true},useSimple:function(){j=false}});a(a.S+a.F*!z,"Object",{create:J,defineProperty:Z,defineProperties:Y,getOwnPropertyDescriptor:K,getOwnPropertyNames:$,getOwnPropertySymbols:ee});L&&a(a.S+a.F*(!z||u(function(){var e=k();return D([e])!="[null]"||D({a:e})!="{}"||D(Object(e))!="{}"})),"JSON",{stringify:function e(t){var r=[t];var i=1;var n,a;while(arguments.length>i)r.push(arguments[i++]);a=n=r[1];if(!g(n)&&t===undefined||X(t))return;if(!_(n))n=function(e,t){if(typeof a=="function")t=a.call(this,e,t);if(!X(t))return t};r[1]=n;return D.apply(L,r)}});k[I][O]||r(22)(k[I],O,k[I].valueOf);c(k,"Symbol");c(Math,"Math",true);c(i.JSON,"JSON",true)},function(e,t,r){var s=r(59);var l=r(100);var u=r(86);e.exports=function(e){var t=s(e);var r=l.f;if(r){var i=r(e);var n=u.f;var a=0;var o;while(i.length>a)if(n.call(e,o=i[a++]))t.push(o)}return t}},function(e,t,r){var i=r(0);i(i.S,"Object",{create:r(61)})},function(e,t,r){var i=r(0);i(i.S+i.F*!r(14),"Object",{defineProperty:r(15).f})},function(e,t,r){var i=r(0);i(i.S+i.F*!r(14),"Object",{defineProperties:r(183)})},function(e,t,r){var i=r(26);var n=r(27).f;r(40)("getOwnPropertyDescriptor",function(){return function e(t,r){return n(i(t),r)}})},function(e,t,r){var i=r(16);var n=r(28);r(40)("getPrototypeOf",function(){return function e(t){return n(i(t))}})},function(e,t,r){var i=r(16);var n=r(59);r(40)("keys",function(){return function e(t){return n(i(t))}})},function(e,t,r){r(40)("getOwnPropertyNames",function(){return r(184).f})},function(e,t,r){var i=r(8);var n=r(50).onFreeze;r(40)("freeze",function(r){return function e(t){return r&&i(t)?r(n(t)):t}})},function(e,t,r){var i=r(8);var n=r(50).onFreeze;r(40)("seal",function(r){return function e(t){return r&&i(t)?r(n(t)):t}})},function(e,t,r){var i=r(8);var n=r(50).onFreeze;r(40)("preventExtensions",function(r){return function e(t){return r&&i(t)?r(n(t)):t}})},function(e,t,r){var i=r(8);r(40)("isFrozen",function(r){return function e(t){return i(t)?r?r(t):false:true}})},function(e,t,r){var i=r(8);r(40)("isSealed",function(r){return function e(t){return i(t)?r?r(t):false:true}})},function(e,t,r){var i=r(8);r(40)("isExtensible",function(r){return function e(t){return i(t)?r?r(t):true:false}})},function(e,t,r){var i=r(0);i(i.S+i.F,"Object",{assign:r(185)})},function(e,t,r){var i=r(0);i(i.S,"Object",{is:r(186)})},function(e,t,r){var i=r(0);i(i.S,"Object",{setPrototypeOf:r(129).set})},function(e,t,r){"use strict";var i=r(75);var n={};n[r(11)("toStringTag")]="z";if(n+""!="[object z]"){r(23)(Object.prototype,"toString",function e(){return"[object "+i(this)+"]"},true)}},function(e,t,r){var i=r(0);i(i.P,"Function",{bind:r(187)})},function(e,t,r){var i=r(15).f;var n=Function.prototype;var a=/^\s*function ([^ (]*)/;var o="name";o in n||r(14)&&i(n,o,{configurable:true,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,r){"use strict";var i=r(8);var n=r(28);var a=r(11)("hasInstance");var o=Function.prototype;if(!(a in o))r(15).f(o,a,{value:function(e){if(typeof this!="function"||!i(e))return false;if(!i(this.prototype))return e instanceof this;while(e=n(e))if(this.prototype===e)return true;return false}})},function(e,t,r){var i=r(0);var n=r(189);i(i.G+i.F*(parseInt!=n),{parseInt:n})},function(e,t,r){var i=r(0);var n=r(190);i(i.G+i.F*(parseFloat!=n),{parseFloat:n})},function(e,t,r){"use strict";var i=r(6);var n=r(25);var a=r(31);var o=r(131);var d=r(38);var s=r(7);var l=r(62).f;var u=r(27).f;var c=r(15).f;var f=r(76).trim;var h="Number";var p=i[h];var v=p;var m=p.prototype;var _=a(r(61)(m))==h;var y="trim"in String.prototype;var g=function(e){var t=d(e,false);if(typeof t=="string"&&t.length>2){t=y?t.trim():f(t,3);var r=t.charCodeAt(0);var i,n,a;if(r===43||r===45){i=t.charCodeAt(2);if(i===88||i===120)return NaN}else if(r===48){switch(t.charCodeAt(1)){case 66:case 98:n=2;a=49;break;case 79:case 111:n=8;a=55;break;default:return+t}for(var o=t.slice(2),s=0,l=o.length,u;s<l;s++){u=o.charCodeAt(s);if(u<48||u>a)return NaN}return parseInt(o,n)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function e(t){var r=arguments.length<1?0:t;var i=this;return i instanceof p&&(_?s(function(){m.valueOf.call(i)}):a(i)!=h)?o(new v(g(r)),i,p):g(r)};for(var w=r(14)?l(v):("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,"+"EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,"+"MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger").split(","),F=0,b;w.length>F;F++){if(n(v,b=w[F])&&!n(p,b)){c(p,b,u(v,b))}}p.prototype=m;m.constructor=p;r(23)(i,h,p)}},function(e,t,r){"use strict";var i=r(0);var d=r(32);var c=r(191);var f=r(132);var n=1..toFixed;var a=Math.floor;var o=[0,0,0,0,0,0];var h="Number.toFixed: incorrect invocation!";var p="0";var v=function(e,t){var r=-1;var i=t;while(++r<6){i+=e*o[r];o[r]=i%1e7;i=a(i/1e7)}};var m=function(e){var t=6;var r=0;while(--t>=0){r+=o[t];o[t]=a(r/e);r=r%e*1e7}};var _=function(){var e=6;var t="";while(--e>=0){if(t!==""||e===0||o[e]!==0){var r=String(o[e]);t=t===""?r:t+f.call(p,7-r.length)+r}}return t};var y=function(e,t,r){return t===0?r:t%2===1?y(e,t-1,r*e):y(e*e,t/2,r)};var g=function(e){var t=0;var r=e;while(r>=4096){t+=12;r/=4096}while(r>=2){t+=1;r/=2}return t};i(i.P+i.F*(!!n&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(0xde0b6b3a7640080).toFixed(0)!=="1000000000000000128")||!r(7)(function(){n.call({})})),"Number",{toFixed:function e(t){var r=c(this,h);var i=d(t);var n="";var a=p;var o,s,l,u;if(i<0||i>20)throw RangeError(h);if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return String(r);if(r<0){n="-";r=-r}if(r>1e-21){o=g(r*y(2,69,1))-69;s=o<0?r*y(2,-o,1):r/y(2,o,1);s*=4503599627370496;o=52-o;if(o>0){v(0,s);l=i;while(l>=7){v(1e7,0);l-=7}v(y(10,l,1),0);l=o-1;while(l>=23){m(1<<23);l-=23}m(1<<l);v(1,1);m(2);a=_()}else{v(0,s);v(1<<-o,0);a=_()+f.call(p,i)}}if(i>0){u=a.length;a=n+(u<=i?"0."+f.call(p,i-u)+a:a.slice(0,u-i)+"."+a.slice(u-i))}else{a=n+a}return a}})},function(e,t,r){"use strict";var i=r(0);var n=r(7);var a=r(191);var o=1..toPrecision;i(i.P+i.F*(n(function(){return o.call(1,undefined)!=="1"})||!n(function(){o.call({})})),"Number",{toPrecision:function e(t){var r=a(this,"Number#toPrecision: incorrect invocation!");return t===undefined?o.call(r):o.call(r,t)}})},function(e,t,r){var i=r(0);i(i.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,r){var i=r(0);var n=r(6).isFinite;i(i.S,"Number",{isFinite:function e(t){return typeof t=="number"&&n(t)}})},function(e,t,r){var i=r(0);i(i.S,"Number",{isInteger:r(192)})},function(e,t,r){var i=r(0);i(i.S,"Number",{isNaN:function e(t){return t!=t}})},function(e,t,r){var i=r(0);var n=r(192);var a=Math.abs;i(i.S,"Number",{isSafeInteger:function e(t){return n(t)&&a(t)<=9007199254740991}})},function(e,t,r){var i=r(0);i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){var i=r(0);i(i.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,r){var i=r(0);var n=r(190);i(i.S+i.F*(Number.parseFloat!=n),"Number",{parseFloat:n})},function(e,t,r){var i=r(0);var n=r(189);i(i.S+i.F*(Number.parseInt!=n),"Number",{parseInt:n})},function(e,t,r){var i=r(0);var n=r(193);var a=Math.sqrt;var o=Math.acosh;i(i.S+i.F*!(o&&Math.floor(o(Number.MAX_VALUE))==710&&o(Infinity)==Infinity),"Math",{acosh:function e(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:n(t-1+a(t-1)*a(t+1))}})},function(e,t,r){var i=r(0);var n=Math.asinh;function a(e){return!isFinite(e=+e)||e==0?e:e<0?-a(-e):Math.log(e+Math.sqrt(e*e+1))}i(i.S+i.F*!(n&&1/n(0)>0),"Math",{asinh:a})},function(e,t,r){var i=r(0);var n=Math.atanh;i(i.S+i.F*!(n&&1/n(-0)<0),"Math",{atanh:function e(t){return(t=+t)==0?t:Math.log((1+t)/(1-t))/2}})},function(e,t,r){var i=r(0);var n=r(133);i(i.S,"Math",{cbrt:function e(t){return n(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(e,t,r){var i=r(0);i(i.S,"Math",{clz32:function e(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(e,t,r){var i=r(0);var n=Math.exp;i(i.S,"Math",{cosh:function e(t){return(n(t=+t)+n(-t))/2}})},function(e,t,r){var i=r(0);var n=r(134);i(i.S+i.F*(n!=Math.expm1),"Math",{expm1:n})},function(e,t,r){var i=r(0);i(i.S,"Math",{fround:r(194)})},function(e,t,r){var i=r(0);var u=Math.abs;i(i.S,"Math",{hypot:function e(t,r){var i=0;var n=0;var a=arguments.length;var o=0;var s,l;while(n<a){s=u(arguments[n++]);if(o<s){l=o/s;i=i*l*l+1;o=s}else if(s>0){l=s/o;i+=l*l}else i+=s}return o===Infinity?Infinity:o*Math.sqrt(i)}})},function(e,t,r){var i=r(0);var n=Math.imul;i(i.S+i.F*r(7)(function(){return n(4294967295,5)!=-5||n.length!=2}),"Math",{imul:function e(t,r){var i=65535;var n=+t;var a=+r;var o=i&n;var s=i&a;return 0|o*s+((i&n>>>16)*s+o*(i&a>>>16)<<16>>>0)}})},function(e,t,r){var i=r(0);i(i.S,"Math",{log10:function e(t){return Math.log(t)*Math.LOG10E}})},function(e,t,r){var i=r(0);i(i.S,"Math",{log1p:r(193)})},function(e,t,r){var i=r(0);i(i.S,"Math",{log2:function e(t){return Math.log(t)/Math.LN2}})},function(e,t,r){var i=r(0);i(i.S,"Math",{sign:r(133)})},function(e,t,r){var i=r(0);var n=r(134);var a=Math.exp;i(i.S+i.F*r(7)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function e(t){return Math.abs(t=+t)<1?(n(t)-n(-t))/2:(a(t-1)-a(-t-1))*(Math.E/2)}})},function(e,t,r){var i=r(0);var n=r(134);var a=Math.exp;i(i.S,"Math",{tanh:function e(t){var r=n(t=+t);var i=n(-t);return r==Infinity?1:i==Infinity?-1:(r-i)/(a(t)+a(-t))}})},function(e,t,r){var i=r(0);i(i.S,"Math",{trunc:function e(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(e,t,r){var i=r(0);var o=r(60);var s=String.fromCharCode;var n=String.fromCodePoint;i(i.S+i.F*(!!n&&n.length!=1),"String",{fromCodePoint:function e(t){var r=[];var i=arguments.length;var n=0;var a;while(i>n){a=+arguments[n++];if(o(a,1114111)!==a)throw RangeError(a+" is not a valid code point");r.push(a<65536?s(a):s(((a-=65536)>>10)+55296,a%1024+56320))}return r.join("")}})},function(e,t,r){var i=r(0);var s=r(26);var l=r(12);i(i.S,"String",{raw:function e(t){var r=s(t.raw);var i=l(r.length);var n=arguments.length;var a=[];var o=0;while(i>o){a.push(String(r[o++]));if(o<n)a.push(String(arguments[o]))}return a.join("")}})},function(e,t,r){"use strict";r(76)("trim",function(t){return function e(){return t(this,3)}})},function(e,t,r){"use strict";var i=r(102)(true);r(135)(String,"String",function(e){this._t=String(e);this._i=0},function(){var e=this._t;var t=this._i;var r;if(t>=e.length)return{value:undefined,done:true};r=i(e,t);this._i+=r.length;return{value:r,done:false}})},function(e,t,r){"use strict";var i=r(0);var n=r(102)(false);i(i.P,"String",{codePointAt:function e(t){return n(this,t)}})},function(e,t,r){"use strict";var i=r(0);var s=r(12);var l=r(137);var u="endsWith";var d=""[u];i(i.P+i.F*r(138)(u),"String",{endsWith:function e(t){var r=l(this,t,u);var i=arguments.length>1?arguments[1]:undefined;var n=s(r.length);var a=i===undefined?n:Math.min(s(i),n);var o=String(t);return d?d.call(r,o,a):r.slice(a-o.length,a)===o}})},function(e,t,r){"use strict";var i=r(0);var n=r(137);var a="includes";i(i.P+i.F*r(138)(a),"String",{includes:function e(t){return!!~n(this,t,a).indexOf(t,arguments.length>1?arguments[1]:undefined)}})},function(e,t,r){var i=r(0);i(i.P,"String",{repeat:r(132)})},function(e,t,r){"use strict";var i=r(0);var a=r(12);var o=r(137);var s="startsWith";var l=""[s];i(i.P+i.F*r(138)(s),"String",{startsWith:function e(t){var r=o(this,t,s);var i=a(Math.min(arguments.length>1?arguments[1]:undefined,r.length));var n=String(t);return l?l.call(r,n,i):r.slice(i,i+n.length)===n}})},function(e,t,r){"use strict";r(24)("anchor",function(r){return function e(t){return r(this,"a","name",t)}})},function(e,t,r){"use strict";r(24)("big",function(t){return function e(){return t(this,"big","","")}})},function(e,t,r){"use strict";r(24)("blink",function(t){return function e(){return t(this,"blink","","")}})},function(e,t,r){"use strict";r(24)("bold",function(t){return function e(){return t(this,"b","","")}})},function(e,t,r){"use strict";r(24)("fixed",function(t){return function e(){return t(this,"tt","","")}})},function(e,t,r){"use strict";r(24)("fontcolor",function(r){return function e(t){return r(this,"font","color",t)}})},function(e,t,r){"use strict";r(24)("fontsize",function(r){return function e(t){return r(this,"font","size",t)}})},function(e,t,r){"use strict";r(24)("italics",function(t){return function e(){return t(this,"i","","")}})},function(e,t,r){"use strict";r(24)("link",function(r){return function e(t){return r(this,"a","href",t)}})},function(e,t,r){"use strict";r(24)("small",function(t){return function e(){return t(this,"small","","")}})},function(e,t,r){"use strict";r(24)("strike",function(t){return function e(){return t(this,"strike","","")}})},function(e,t,r){"use strict";r(24)("sub",function(t){return function e(){return t(this,"sub","","")}})},function(e,t,r){"use strict";r(24)("sup",function(t){return function e(){return t(this,"sup","","")}})},function(e,t,r){var i=r(0);i(i.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,r){"use strict";var i=r(0);var n=r(16);var a=r(38);i(i.P+i.F*r(7)(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1}),"Date",{toJSON:function e(t){var r=n(this);var i=a(r);return typeof i=="number"&&!isFinite(i)?null:r.toISOString()}})},function(e,t,r){var i=r(0);var n=r(354);i(i.P+i.F*(Date.prototype.toISOString!==n),"Date",{toISOString:n})},function(e,t,r){"use strict";var i=r(7);var a=Date.prototype.getTime;var n=Date.prototype.toISOString;var o=function(e){return e>9?e:"0"+e};e.exports=i(function(){return n.call(new Date(-5e13-1))!="0385-07-25T07:06:39.999Z"})||!i(function(){n.call(new Date(NaN))})?function e(){if(!isFinite(a.call(this)))throw RangeError("Invalid time value");var t=this;var r=t.getUTCFullYear();var i=t.getUTCMilliseconds();var n=r<0?"-":r>9999?"+":"";return n+("00000"+Math.abs(r)).slice(n?-6:-4)+"-"+o(t.getUTCMonth()+1)+"-"+o(t.getUTCDate())+"T"+o(t.getUTCHours())+":"+o(t.getUTCMinutes())+":"+o(t.getUTCSeconds())+"."+(i>99?i:"0"+o(i))+"Z"}:n},function(e,t,r){var i=Date.prototype;var n="Invalid Date";var a="toString";var o=i[a];var s=i.getTime;if(new Date(NaN)+""!=n){r(23)(i,a,function e(){var t=s.call(this);return t===t?o.call(this):n})}},function(e,t,r){var i=r(11)("toPrimitive");var n=Date.prototype;if(!(i in n))r(22)(n,i,r(357))},function(e,t,r){"use strict";var i=r(4);var n=r(38);var a="number";e.exports=function(e){if(e!=="string"&&e!==a&&e!=="default")throw TypeError("Incorrect hint");return n(i(this),e!=a)}},function(e,t,r){var i=r(0);i(i.S,"Array",{isArray:r(101)})},function(e,t,r){"use strict";var h=r(30);var i=r(0);var p=r(16);var v=r(195);var m=r(139);var _=r(12);var y=r(140);var g=r(141);i(i.S+i.F*!r(104)(function(e){Array.from(e)}),"Array",{from:function e(t){var r=p(t);var i=typeof this=="function"?this:Array;var n=arguments.length;var a=n>1?arguments[1]:undefined;var o=a!==undefined;var s=0;var l=g(r);var u,d,c,f;if(o)a=h(a,n>2?arguments[2]:undefined,2);if(l!=undefined&&!(i==Array&&m(l))){for(f=l.call(r),d=new i;!(c=f.next()).done;s++){y(d,s,o?v(f,a,[c.value,s],true):c.value)}}else{u=_(r.length);for(d=new i(u);u>s;s++){y(d,s,o?a(r[s],s):r[s])}}d.length=s;return d}})},function(e,t,r){"use strict";var i=r(0);var n=r(140);i(i.S+i.F*r(7)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function e(){var t=0;var r=arguments.length;var i=new(typeof this=="function"?this:Array)(r);while(r>t)n(i,t,arguments[t++]);i.length=r;return i}})},function(e,t,r){"use strict";var i=r(0);var n=r(26);var a=[].join;i(i.P+i.F*(r(85)!=Object||!r(33)(a)),"Array",{join:function e(t){return a.call(n(this),t===undefined?",":t)}})},function(e,t,r){"use strict";var i=r(0);var n=r(128);var d=r(31);var c=r(60);var f=r(12);var h=[].slice;i(i.P+i.F*r(7)(function(){if(n)h.call(n)}),"Array",{slice:function e(t,r){var i=f(this.length);var n=d(this);r=r===undefined?i:r;if(n=="Array")return h.call(this,t,r);var a=c(t,i);var o=c(r,i);var s=f(o-a);var l=new Array(s);var u=0;for(;u<s;u++)l[u]=n=="String"?this.charAt(a+u):this[a+u];return l}})},function(e,t,r){"use strict";var i=r(0);var n=r(19);var a=r(16);var o=r(7);var s=[].sort;var l=[1,2,3];i(i.P+i.F*(o(function(){l.sort(undefined)})||!o(function(){l.sort(null)})||!r(33)(s)),"Array",{sort:function e(t){return t===undefined?s.call(a(this)):s.call(a(this),n(t))}})},function(e,t,r){"use strict";var i=r(0);var n=r(41)(0);var a=r(33)([].forEach,true);i(i.P+i.F*!a,"Array",{forEach:function e(t){return n(this,t,arguments[1])}})},function(e,t,r){var i=r(8);var n=r(101);var a=r(11)("species");e.exports=function(e){var t;if(n(e)){t=e.constructor;if(typeof t=="function"&&(t===Array||n(t.prototype)))t=undefined;if(i(t)){t=t[a];if(t===null)t=undefined}}return t===undefined?Array:t}},function(e,t,r){"use strict";var i=r(0);var n=r(41)(1);i(i.P+i.F*!r(33)([].map,true),"Array",{map:function e(t){return n(this,t,arguments[1])}})},function(e,t,r){"use strict";var i=r(0);var n=r(41)(2);i(i.P+i.F*!r(33)([].filter,true),"Array",{filter:function e(t){return n(this,t,arguments[1])}})},function(e,t,r){"use strict";var i=r(0);var n=r(41)(3);i(i.P+i.F*!r(33)([].some,true),"Array",{some:function e(t){return n(this,t,arguments[1])}})},function(e,t,r){"use strict";var i=r(0);var n=r(41)(4);i(i.P+i.F*!r(33)([].every,true),"Array",{every:function e(t){return n(this,t,arguments[1])}})},function(e,t,r){"use strict";var i=r(0);var n=r(196);i(i.P+i.F*!r(33)([].reduce,true),"Array",{reduce:function e(t){return n(this,t,arguments.length,arguments[1],false)}})},function(e,t,r){"use strict";var i=r(0);var n=r(196);i(i.P+i.F*!r(33)([].reduceRight,true),"Array",{reduceRight:function e(t){return n(this,t,arguments.length,arguments[1],true)}})},function(e,t,r){"use strict";var i=r(0);var n=r(99)(false);var a=[].indexOf;var o=!!a&&1/[1].indexOf(1,-0)<0;i(i.P+i.F*(o||!r(33)(a)),"Array",{indexOf:function e(t){return o?a.apply(this,arguments)||0:n(this,t,arguments[1])}})},function(e,t,r){"use strict";var i=r(0);var a=r(26);var o=r(32);var s=r(12);var l=[].lastIndexOf;var u=!!l&&1/[1].lastIndexOf(1,-0)<0;i(i.P+i.F*(u||!r(33)(l)),"Array",{lastIndexOf:function e(t){if(u)return l.apply(this,arguments)||0;var r=a(this);var i=s(r.length);var n=i-1;if(arguments.length>1)n=Math.min(n,o(arguments[1]));if(n<0)n=i+n;for(;n>=0;n--)if(n in r)if(r[n]===t)return n||0;return-1}})},function(e,t,r){var i=r(0);i(i.P,"Array",{copyWithin:r(197)});r(52)("copyWithin")},function(e,t,r){var i=r(0);i(i.P,"Array",{fill:r(143)});r(52)("fill")},function(e,t,r){"use strict";var i=r(0);var n=r(41)(5);var a="find";var o=true;if(a in[])Array(1)[a](function(){o=false});i(i.P+i.F*o,"Array",{find:function e(t){return n(this,t,arguments.length>1?arguments[1]:undefined)}});r(52)(a)},function(e,t,r){"use strict";var i=r(0);var n=r(41)(6);var a="findIndex";var o=true;if(a in[])Array(1)[a](function(){o=false});i(i.P+i.F*o,"Array",{findIndex:function e(t){return n(this,t,arguments.length>1?arguments[1]:undefined)}});r(52)(a)},function(e,t,r){r(63)("Array")},function(e,t,r){var i=r(6);var o=r(131);var n=r(15).f;var a=r(62).f;var s=r(103);var l=r(87);var u=i.RegExp;var d=u;var c=u.prototype;var f=/a/g;var h=/a/g;var p=new u(f)!==f;if(r(14)&&(!p||r(7)(function(){h[r(11)("match")]=false;return u(f)!=f||u(h)==h||u(f,"i")!="/a/i"}))){u=function e(t,r){var i=this instanceof u;var n=s(t);var a=r===undefined;return!i&&n&&t.constructor===u&&a?t:o(p?new d(n&&!a?t.source:t,r):d((n=t instanceof u)?t.source:t,n&&a?l.call(t):r),i?this:c,u)};var v=function(t){t in u||n(u,t,{configurable:true,get:function(){return d[t]},set:function(e){d[t]=e}})};for(var m=a(d),_=0;m.length>_;)v(m[_++]);c.constructor=u;u.prototype=c;r(23)(i,"RegExp",u)}r(63)("RegExp")},function(e,t,r){"use strict";r(200);var i=r(4);var n=r(87);var a=r(14);var o="toString";var s=/./[o];var l=function(e){r(23)(RegExp.prototype,o,e,true)};if(r(7)(function(){return s.call({source:"a",flags:"b"})!="/a/b"})){l(function e(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?n.call(t):undefined)})}else if(s.name!=o){l(function e(){return s.call(this)})}},function(e,t,r){"use strict";var c=r(4);var f=r(12);var h=r(146);var p=r(105);r(106)("match",1,function(n,a,u,d){return[function e(t){var r=n(this);var i=t==undefined?undefined:t[a];return i!==undefined?i.call(t,r):new RegExp(t)[a](String(r))},function(e){var t=d(u,e,this);if(t.done)return t.value;var r=c(e);var i=String(this);if(!r.global)return p(r,i);var n=r.unicode;r.lastIndex=0;var a=[];var o=0;var s;while((s=p(r,i))!==null){var l=String(s[0]);a[o]=l;if(l==="")r.lastIndex=h(i,f(r.lastIndex),n);o++}return o===0?null:a}]})},function(e,t,r){"use strict";var x=r(4);var i=r(16);var P=r(12);var M=r(32);var T=r(146);var E=r(105);var S=Math.max;var A=Math.min;var f=Math.floor;var n=/\$([$&`']|\d\d?|<[^>]*>)/g;var h=/\$([$&`']|\d\d?)/g;var k=function(e){return e===undefined?e:String(e)};r(106)("replace",2,function(a,o,F,b){return[function e(t,r){var i=a(this);var n=t==undefined?undefined:t[o];return n!==undefined?n.call(t,i,r):F.call(String(i),t,r)},function(e,t){var r=b(F,e,this,t);if(r.done)return r.value;var i=x(e);var n=String(this);var a=typeof t==="function";if(!a)t=String(t);var o=i.global;if(o){var s=i.unicode;i.lastIndex=0}var l=[];while(true){var u=E(i,n);if(u===null)break;l.push(u);if(!o)break;var d=String(u[0]);if(d==="")i.lastIndex=T(n,P(i.lastIndex),s)}var c="";var f=0;for(var h=0;h<l.length;h++){u=l[h];var p=String(u[0]);var v=S(A(M(u.index),n.length),0);var m=[];for(var _=1;_<u.length;_++)m.push(k(u[_]));var y=u.groups;if(a){var g=[p].concat(m,v,n);if(y!==undefined)g.push(y);var w=String(t.apply(undefined,g))}else{w=C(p,n,v,m,y,t)}if(v>=f){c+=n.slice(f,v)+w;f=v+p.length}}return c+n.slice(f)}];function C(a,o,s,l,u,e){var d=s+a.length;var c=l.length;var t=h;if(u!==undefined){u=i(u);t=n}return F.call(e,t,function(e,t){var r;switch(t.charAt(0)){case"$":return"$";case"&":return a;case"`":return o.slice(0,s);case"'":return o.slice(d);case"<":r=u[t.slice(1,-1)];break;default:var i=+t;if(i===0)return e;if(i>c){var n=f(i/10);if(n===0)return e;if(n<=c)return l[n-1]===undefined?t.charAt(1):l[n-1]+t.charAt(1);return e}r=l[i-1]}return r===undefined?"":r})}})},function(e,t,r){"use strict";var l=r(4);var u=r(186);var d=r(105);r(106)("search",1,function(n,a,o,s){return[function e(t){var r=n(this);var i=t==undefined?undefined:t[a];return i!==undefined?i.call(t,r):new RegExp(t)[a](String(r))},function(e){var t=s(o,e,this);if(t.done)return t.value;var r=l(e);var i=String(this);var n=r.lastIndex;if(!u(n,0))r.lastIndex=0;var a=d(r,i);if(!u(r.lastIndex,n))r.lastIndex=n;return a===null?-1:a.index}]})},function(e,t,r){"use strict";var c=r(103);var g=r(4);var w=r(88);var F=r(146);var b=r(12);var C=r(105);var f=r(145);var x=Math.min;var h=[].push;var i="split";var p="length";var v="lastIndex";var P=!!function(){try{return new RegExp("x","y")}catch(e){}}();r(106)("split",2,function(a,o,m,_){var y;if("abbc"[i](/(b)*/)[1]=="c"||"test"[i](/(?:)/,-1)[p]!=4||"ab"[i](/(?:ab)*/)[p]!=2||"."[i](/(.?)(.?)/)[p]!=4||"."[i](/()()/)[p]>1||""[i](/.?/)[p]){y=function(e,t){var r=String(this);if(e===undefined&&t===0)return[];if(!c(e))return m.call(r,e,t);var i=[];var n=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"");var a=0;var o=t===undefined?4294967295:t>>>0;var s=new RegExp(e.source,n+"g");var l,u,d;while(l=f.call(s,r)){u=s[v];if(u>a){i.push(r.slice(a,l.index));if(l[p]>1&&l.index<r[p])h.apply(i,l.slice(1));d=l[0][p];a=u;if(i[p]>=o)break}if(s[v]===l.index)s[v]++}if(a===r[p]){if(d||!s.test(""))i.push("")}else i.push(r.slice(a));return i[p]>o?i.slice(0,o):i}}else if("0"[i](undefined,0)[p]){y=function(e,t){return e===undefined&&t===0?[]:m.call(this,e,t)}}else{y=m}return[function e(t,r){var i=a(this);var n=t==undefined?undefined:t[o];return n!==undefined?n.call(t,i,r):y.call(String(i),t,r)},function(e,t){var r=_(y,e,this,t,y!==m);if(r.done)return r.value;var i=g(e);var n=String(this);var a=w(i,RegExp);var o=i.unicode;var s=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(P?"y":"g");var l=new a(P?i:"^(?:"+i.source+")",s);var u=t===undefined?4294967295:t>>>0;if(u===0)return[];if(n.length===0)return C(l,n)===null?[n]:[];var d=0;var c=0;var f=[];while(c<n.length){l.lastIndex=P?c:0;var h=C(l,P?n:n.slice(c));var p;if(h===null||(p=x(b(l.lastIndex+(P?0:c)),n.length))===d){c=F(n,c,o)}else{f.push(n.slice(d,c));if(f.length===u)return f;for(var v=1;v<=h.length-1;v++){f.push(h[v]);if(f.length===u)return f}c=d=p}}f.push(n.slice(d));return f}]})},function(e,t,r){"use strict";var i=r(51);var o=r(6);var n=r(30);var a=r(75);var s=r(0);var l=r(8);var u=r(19);var d=r(64);var c=r(65);var f=r(88);var h=r(147).set;var p=r(148)();var v=r(149);var m=r(201);var _=r(107);var y=r(202);var g="Promise";var w=o.TypeError;var F=o.process;var b=F&&F.versions;var C=b&&b.v8||"";var x=o[g];var P=a(F)=="process";var M=function(){};var T,E,S,A;var k=E=v.f;var L=!!function(){try{var e=x.resolve(1);var t=(e.constructor={})[r(11)("species")]=function(e){e(M,M)};return(P||typeof PromiseRejectionEvent=="function")&&e.then(M)instanceof t&&C.indexOf("6.6")!==0&&_.indexOf("Chrome/66")===-1}catch(e){}}();var D=function(e){var t;return l(e)&&typeof(t=e.then)=="function"?t:false};var I=function(d,r){if(d._n)return;d._n=true;var i=d._c;p(function(){var l=d._v;var u=d._s==1;var e=0;var t=function(e){var t=u?e.ok:e.fail;var r=e.resolve;var i=e.reject;var n=e.domain;var a,o,s;try{if(t){if(!u){if(d._h==2)N(d);d._h=1}if(t===true)a=l;else{if(n)n.enter();a=t(l);if(n){n.exit();s=true}}if(a===e.promise){i(w("Promise-chain cycle"))}else if(o=D(a)){o.call(a,r,i)}else r(a)}else i(l)}catch(e){if(n&&!s)n.exit();i(e)}};while(i.length>e)t(i[e++]);d._c=[];d._n=false;if(r&&!d._h)R(d)})};var R=function(a){h.call(o,function(){var e=a._v;var t=O(a);var r,i,n;if(t){r=m(function(){if(P){F.emit("unhandledRejection",e,a)}else if(i=o.onunhandledrejection){i({promise:a,reason:e})}else if((n=o.console)&&n.error){n.error("Unhandled promise rejection",e)}});a._h=P||O(a)?2:1}a._a=undefined;if(t&&r.e)throw r.v})};var O=function(e){return e._h!==1&&(e._a||e._c).length===0};var N=function(t){h.call(o,function(){var e;if(P){F.emit("rejectionHandled",t)}else if(e=o.onrejectionhandled){e({promise:t,reason:t._v})}})};var B=function(e){var t=this;if(t._d)return;t._d=true;t=t._w||t;t._v=e;t._s=2;if(!t._a)t._a=t._c.slice();I(t,true)};var H=function(e){var r=this;var i;if(r._d)return;r._d=true;r=r._w||r;try{if(r===e)throw w("Promise can't be resolved itself");if(i=D(e)){p(function(){var t={_w:r,_d:false};try{i.call(e,n(H,t,1),n(B,t,1))}catch(e){B.call(t,e)}})}else{r._v=e;r._s=1;I(r,false)}}catch(e){B.call({_w:r,_d:false},e)}};if(!L){x=function e(t){d(this,x,g,"_h");u(t);T.call(this);try{t(n(H,this,1),n(B,this,1))}catch(e){B.call(this,e)}};T=function e(t){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false};T.prototype=r(66)(x.prototype,{then:function e(t,r){var i=k(f(this,x));i.ok=typeof t=="function"?t:true;i.fail=typeof r=="function"&&r;i.domain=P?F.domain:undefined;this._c.push(i);if(this._a)this._a.push(i);if(this._s)I(this,false);return i.promise},catch:function(e){return this.then(undefined,e)}});S=function(){var e=new T;this.promise=e;this.resolve=n(H,e,1);this.reject=n(B,e,1)};v.f=k=function(e){return e===x||e===A?new S(e):E(e)}}s(s.G+s.W+s.F*!L,{Promise:x});r(74)(x,g);r(63)(g);A=r(29)[g];s(s.S+s.F*!L,g,{reject:function e(t){var r=k(this);var i=r.reject;i(t);return r.promise}});s(s.S+s.F*(i||!L),g,{resolve:function e(t){return y(i&&this===A?x:this,t)}});s(s.S+s.F*!(L&&r(104)(function(e){x.all(e)["catch"](M)})),g,{all:function e(t){var o=this;var r=k(o);var s=r.resolve;var l=r.reject;var i=m(function(){var i=[];var n=0;var a=1;c(t,false,function(e){var t=n++;var r=false;i.push(undefined);a++;o.resolve(e).then(function(e){if(r)return;r=true;i[t]=e;--a||s(i)},l)});--a||s(i)});if(i.e)l(i.v);return r.promise},race:function e(t){var r=this;var i=k(r);var n=i.reject;var a=m(function(){c(t,false,function(e){r.resolve(e).then(i.resolve,n)})});if(a.e)n(a.v);return i.promise}})},function(e,t,r){"use strict";var i=r(207);var n=r(78);var a="WeakSet";r(108)(a,function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}},{add:function e(t){return i.def(n(this,a),t,true)}},i,false,true)},function(e,t,r){"use strict";var i=r(0);var n=r(109);var a=r(150);var d=r(4);var c=r(60);var f=r(12);var o=r(8);var s=r(6).ArrayBuffer;var h=r(88);var p=a.ArrayBuffer;var v=a.DataView;var l=n.ABV&&s.isView;var m=p.prototype.slice;var u=n.VIEW;var _="ArrayBuffer";i(i.G+i.W+i.F*(s!==p),{ArrayBuffer:p});i(i.S+i.F*!n.CONSTR,_,{isView:function e(t){return l&&l(t)||o(t)&&u in t}});i(i.P+i.U+i.F*r(7)(function(){return!new p(2).slice(1,undefined).byteLength}),_,{slice:function e(t,r){if(m!==undefined&&r===undefined)return m.call(d(this),t);var i=d(this).byteLength;var n=c(t,i);var a=c(r===undefined?i:r,i);var o=new(h(this,p))(f(a-n));var s=new v(this);var l=new v(o);var u=0;while(n<a){l.setUint8(u++,s.getUint8(n++))}return o}});r(63)(_)},function(e,t,r){var i=r(0);i(i.G+i.W+i.F*!r(109).ABV,{DataView:r(150).DataView})},function(e,t,r){r(45)("Int8",1,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Uint8",1,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Uint8",1,function(n){return function e(t,r,i){return n(this,t,r,i)}},true)},function(e,t,r){r(45)("Int16",2,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Uint16",2,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Int32",4,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Uint32",4,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Float32",4,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){r(45)("Float64",8,function(n){return function e(t,r,i){return n(this,t,r,i)}})},function(e,t,r){var i=r(0);var o=r(19);var s=r(4);var l=(r(6).Reflect||{}).apply;var u=Function.apply;i(i.S+i.F*!r(7)(function(){l(function(){})}),"Reflect",{apply:function e(t,r,i){var n=o(t);var a=s(i);return l?l(n,r,a):u.call(n,r,a)}})},function(e,t,r){var i=r(0);var l=r(61);var u=r(19);var d=r(4);var c=r(8);var n=r(7);var f=r(187);var h=(r(6).Reflect||{}).construct;var p=n(function(){function e(){}return!(h(function(){},[],e)instanceof e)});var v=!n(function(){h(function(){})});i(i.S+i.F*(p||v),"Reflect",{construct:function e(t,r){u(t);d(r);var i=arguments.length<3?t:u(arguments[2]);if(v&&!p)return h(t,r,i);if(t==i){switch(r.length){case 0:return new t;case 1:return new t(r[0]);case 2:return new t(r[0],r[1]);case 3:return new t(r[0],r[1],r[2]);case 4:return new t(r[0],r[1],r[2],r[3])}var n=[null];n.push.apply(n,r);return new(f.apply(t,n))}var a=i.prototype;var o=l(c(a)?a:Object.prototype);var s=Function.apply.call(t,o,r);return c(s)?s:o}})},function(e,t,r){var n=r(15);var i=r(0);var a=r(4);var o=r(38);i(i.S+i.F*r(7)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function e(t,r,i){a(t);r=o(r,true);a(i);try{n.f(t,r,i);return true}catch(e){return false}}})},function(e,t,r){var i=r(0);var n=r(27).f;var a=r(4);i(i.S,"Reflect",{deleteProperty:function e(t,r){var i=n(a(t),r);return i&&!i.configurable?false:delete t[r]}})},function(e,t,r){"use strict";var i=r(0);var n=r(4);var a=function(e){this._t=n(e);this._i=0;var t=this._k=[];var r;for(r in e)t.push(r)};r(136)(a,"Object",function(){var e=this;var t=e._k;var r;do{if(e._i>=t.length)return{value:undefined,done:true}}while(!((r=t[e._i++])in e._t));return{value:r,done:false}});i(i.S,"Reflect",{enumerate:function e(t){return new a(t)}})},function(e,t,r){var a=r(27);var o=r(28);var s=r(25);var i=r(0);var l=r(8);var u=r(4);function d(e,t){var r=arguments.length<3?e:arguments[2];var i,n;if(u(e)===r)return e[t];if(i=a.f(e,t))return s(i,"value")?i.value:i.get!==undefined?i.get.call(r):undefined;if(l(n=o(e)))return d(n,t,r)}i(i.S,"Reflect",{get:d})},function(e,t,r){var i=r(27);var n=r(0);var a=r(4);n(n.S,"Reflect",{getOwnPropertyDescriptor:function e(t,r){return i.f(a(t),r)}})},function(e,t,r){var i=r(0);var n=r(28);var a=r(4);i(i.S,"Reflect",{getPrototypeOf:function e(t){return n(a(t))}})},function(e,t,r){var i=r(0);i(i.S,"Reflect",{has:function e(t,r){return r in t}})},function(e,t,r){var i=r(0);var n=r(4);var a=Object.isExtensible;i(i.S,"Reflect",{isExtensible:function e(t){n(t);return a?a(t):true}})},function(e,t,r){var i=r(0);i(i.S,"Reflect",{ownKeys:r(209)})},function(e,t,r){var i=r(0);var n=r(4);var a=Object.preventExtensions;i(i.S,"Reflect",{preventExtensions:function e(t){n(t);try{if(a)a(t);return true}catch(e){return false}}})},function(e,t,r){var s=r(15);var l=r(27);var u=r(28);var d=r(25);var i=r(0);var c=r(57);var f=r(4);var h=r(8);function p(e,t,r){var i=arguments.length<4?e:arguments[3];var n=l.f(f(e),t);var a,o;if(!n){if(h(o=u(e))){return p(o,t,r,i)}n=c(0)}if(d(n,"value")){if(n.writable===false||!h(i))return false;if(a=l.f(i,t)){if(a.get||a.set||a.writable===false)return false;a.value=r;s.f(i,t,a)}else s.f(i,t,c(0,r));return true}return n.set===undefined?false:(n.set.call(i,r),true)}i(i.S,"Reflect",{set:p})},function(e,t,r){var i=r(0);var n=r(129);if(n)i(i.S,"Reflect",{setPrototypeOf:function e(t,r){n.check(t,r);try{n.set(t,r);return true}catch(e){return false}}})},function(e,t,r){"use strict";var i=r(0);var n=r(99)(true);i(i.P,"Array",{includes:function e(t){return n(this,t,arguments.length>1?arguments[1]:undefined)}});r(52)("includes")},function(e,t,r){"use strict";var i=r(0);var a=r(210);var o=r(16);var s=r(12);var l=r(19);var u=r(142);i(i.P,"Array",{flatMap:function e(t){var r=o(this);var i,n;l(t);i=s(r.length);n=u(r,0);a(n,r,r,i,0,1,t,arguments[1]);return n}});r(52)("flatMap")},function(e,t,r){"use strict";var i=r(0);var a=r(210);var o=r(16);var s=r(12);var l=r(32);var u=r(142);i(i.P,"Array",{flatten:function e(){var t=arguments[0];var r=o(this);var i=s(r.length);var n=u(r,0);a(n,r,r,i,0,t===undefined?1:l(t));return n}});r(52)("flatten")},function(e,t,r){"use strict";var i=r(0);var n=r(102)(true);i(i.P,"String",{at:function e(t){return n(this,t)}})},function(e,t,r){"use strict";var i=r(0);var n=r(211);var a=r(107);i(i.P+i.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padStart:function e(t){return n(this,t,arguments.length>1?arguments[1]:undefined,true)}})},function(e,t,r){"use strict";var i=r(0);var n=r(211);var a=r(107);i(i.P+i.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padEnd:function e(t){return n(this,t,arguments.length>1?arguments[1]:undefined,false)}})},function(e,t,r){"use strict";r(76)("trimLeft",function(t){return function e(){return t(this,1)}},"trimStart")},function(e,t,r){"use strict";r(76)("trimRight",function(t){return function e(){return t(this,2)}},"trimEnd")},function(e,t,r){"use strict";var i=r(0);var a=r(39);var o=r(12);var s=r(103);var l=r(87);var u=RegExp.prototype;var d=function(e,t){this._r=e;this._s=t};r(136)(d,"RegExp String",function e(){var t=this._r.exec(this._s);return{value:t,done:t===null}});i(i.P,"String",{matchAll:function e(t){a(this);if(!s(t))throw TypeError(t+" is not a regexp!");var r=String(this);var i="flags"in u?String(t.flags):l.call(t);var n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);n.lastIndex=o(t.lastIndex);return new d(n,r)}})},function(e,t,r){r(125)("asyncIterator")},function(e,t,r){r(125)("observable")},function(e,t,r){var i=r(0);var u=r(209);var d=r(26);var c=r(27);var f=r(140);i(i.S,"Object",{getOwnPropertyDescriptors:function e(t){var r=d(t);var i=c.f;var n=u(r);var a={};var o=0;var s,l;while(n.length>o){l=i(r,s=n[o++]);if(l!==undefined)f(a,s,l)}return a}})},function(e,t,r){var i=r(0);var n=r(212)(false);i(i.S,"Object",{values:function e(t){return n(t)}})},function(e,t,r){var i=r(0);var n=r(212)(true);i(i.S,"Object",{entries:function e(t){return n(t)}})},function(e,t,r){"use strict";var i=r(0);var n=r(16);var a=r(19);var o=r(15);r(14)&&i(i.P+r(110),"Object",{__defineGetter__:function e(t,r){o.f(n(this),t,{get:a(r),enumerable:true,configurable:true})}})},function(e,t,r){"use strict";var i=r(0);var n=r(16);var a=r(19);var o=r(15);r(14)&&i(i.P+r(110),"Object",{__defineSetter__:function e(t,r){o.f(n(this),t,{set:a(r),enumerable:true,configurable:true})}})},function(e,t,r){"use strict";var i=r(0);var a=r(16);var o=r(38);var s=r(28);var l=r(27).f;r(14)&&i(i.P+r(110),"Object",{__lookupGetter__:function e(t){var r=a(this);var i=o(t,true);var n;do{if(n=l(r,i))return n.get}while(r=s(r))}})},function(e,t,r){"use strict";var i=r(0);var a=r(16);var o=r(38);var s=r(28);var l=r(27).f;r(14)&&i(i.P+r(110),"Object",{__lookupSetter__:function e(t){var r=a(this);var i=o(t,true);var n;do{if(n=l(r,i))return n.set}while(r=s(r))}})},function(e,t,r){var i=r(0);i(i.P+i.R,"Map",{toJSON:r(213)("Map")})},function(e,t,r){var i=r(0);i(i.P+i.R,"Set",{toJSON:r(213)("Set")})},function(e,t,r){r(111)("Map")},function(e,t,r){r(111)("Set")},function(e,t,r){r(111)("WeakMap")},function(e,t,r){r(111)("WeakSet")},function(e,t,r){r(112)("Map")},function(e,t,r){r(112)("Set")},function(e,t,r){r(112)("WeakMap")},function(e,t,r){r(112)("WeakSet")},function(e,t,r){var i=r(0);i(i.G,{global:r(6)})},function(e,t,r){var i=r(0);i(i.S,"System",{global:r(6)})},function(e,t,r){var i=r(0);var n=r(31);i(i.S,"Error",{isError:function e(t){return n(t)==="Error"}})},function(e,t,r){var i=r(0);i(i.S,"Math",{clamp:function e(t,r,i){return Math.min(i,Math.max(r,t))}})},function(e,t,r){var i=r(0);i(i.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,r){var i=r(0);var n=180/Math.PI;i(i.S,"Math",{degrees:function e(t){return t*n}})},function(e,t,r){var i=r(0);var o=r(215);var s=r(194);i(i.S,"Math",{fscale:function e(t,r,i,n,a){return s(o(t,r,i,n,a))}})},function(e,t,r){var i=r(0);i(i.S,"Math",{iaddh:function e(t,r,i,n){var a=t>>>0;var o=r>>>0;var s=i>>>0;return o+(n>>>0)+((a&s|(a|s)&~(a+s>>>0))>>>31)|0}})},function(e,t,r){var i=r(0);i(i.S,"Math",{isubh:function e(t,r,i,n){var a=t>>>0;var o=r>>>0;var s=i>>>0;return o-(n>>>0)-((~a&s|~(a^s)&a-s>>>0)>>>31)|0}})},function(e,t,r){var i=r(0);i(i.S,"Math",{imulh:function e(t,r){var i=65535;var n=+t;var a=+r;var o=n&i;var s=a&i;var l=n>>16;var u=a>>16;var d=(l*s>>>0)+(o*s>>>16);return l*u+(d>>16)+((o*u>>>0)+(d&i)>>16)}})},function(e,t,r){var i=r(0);i(i.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,r){var i=r(0);var n=Math.PI/180;i(i.S,"Math",{radians:function e(t){return t*n}})},function(e,t,r){var i=r(0);i(i.S,"Math",{scale:r(215)})},function(e,t,r){var i=r(0);i(i.S,"Math",{umulh:function e(t,r){var i=65535;var n=+t;var a=+r;var o=n&i;var s=a&i;var l=n>>>16;var u=a>>>16;var d=(l*s>>>0)+(o*s>>>16);return l*u+(d>>>16)+((o*u>>>0)+(d&i)>>>16)}})},function(e,t,r){var i=r(0);i(i.S,"Math",{signbit:function e(t){return(t=+t)!=t?t:t==0?1/t==Infinity:t>0}})},function(e,t,r){"use strict";var i=r(0);var n=r(29);var a=r(6);var o=r(88);var s=r(202);i(i.P+i.R,"Promise",{finally:function(t){var r=o(this,n.Promise||a.Promise);var e=typeof t=="function";return this.then(e?function(e){return s(r,t()).then(function(){return e})}:t,e?function(e){return s(r,t()).then(function(){throw e})}:t)}})},function(e,t,r){"use strict";var i=r(0);var n=r(149);var a=r(201);i(i.S,"Promise",{try:function(e){var t=n.f(this);var r=a(e);(r.e?t.reject:t.resolve)(r.v);return t.promise}})},function(e,t,r){var i=r(46);var a=r(4);var o=i.key;var s=i.set;i.exp({defineMetadata:function e(t,r,i,n){s(t,r,a(i),o(n))}})},function(e,t,r){var i=r(46);var o=r(4);var s=i.key;var l=i.map;var u=i.store;i.exp({deleteMetadata:function e(t,r){var i=arguments.length<3?undefined:s(arguments[2]);var n=l(o(r),i,false);if(n===undefined||!n["delete"](t))return false;if(n.size)return true;var a=u.get(r);a["delete"](i);return!!a.size||u["delete"](r)}})},function(e,t,r){var i=r(46);var n=r(4);var a=r(28);var o=i.has;var s=i.get;var l=i.key;var u=function(e,t,r){var i=o(e,t,r);if(i)return s(e,t,r);var n=a(t);return n!==null?u(e,n,r):undefined};i.exp({getMetadata:function e(t,r){return u(t,n(r),arguments.length<3?undefined:l(arguments[2]))}})},function(e,t,r){var a=r(205);var o=r(214);var i=r(46);var n=r(4);var s=r(28);var l=i.keys;var u=i.key;var d=function(e,t){var r=l(e,t);var i=s(e);if(i===null)return r;var n=d(i,t);return n.length?r.length?o(new a(r.concat(n))):n:r};i.exp({getMetadataKeys:function e(t){return d(n(t),arguments.length<2?undefined:u(arguments[1]))}})},function(e,t,r){var i=r(46);var n=r(4);var a=i.get;var o=i.key;i.exp({getOwnMetadata:function e(t,r){return a(t,n(r),arguments.length<3?undefined:o(arguments[2]))}})},function(e,t,r){var i=r(46);var n=r(4);var a=i.keys;var o=i.key;i.exp({getOwnMetadataKeys:function e(t){return a(n(t),arguments.length<2?undefined:o(arguments[1]))}})},function(e,t,r){var i=r(46);var n=r(4);var a=r(28);var o=i.has;var s=i.key;var l=function(e,t,r){var i=o(e,t,r);if(i)return true;var n=a(t);return n!==null?l(e,n,r):false};i.exp({hasMetadata:function e(t,r){return l(t,n(r),arguments.length<3?undefined:s(arguments[2]))}})},function(e,t,r){var i=r(46);var n=r(4);var a=i.has;var o=i.key;i.exp({hasOwnMetadata:function e(t,r){return a(t,n(r),arguments.length<3?undefined:o(arguments[2]))}})},function(e,t,r){var i=r(46);var a=r(4);var o=r(19);var s=i.key;var l=i.set;i.exp({metadata:function e(i,n){return function e(t,r){l(i,n,(r!==undefined?a:o)(t),s(r))}}})},function(e,t,r){var i=r(0);var n=r(148)();var a=r(6).process;var o=r(31)(a)=="process";i(i.G,{asap:function e(t){var r=o&&a.domain;n(r?r.bind(t):t)}})},function(e,t,r){"use strict";var i=r(0);var a=r(6);var o=r(29);var s=r(148)();var l=r(11)("observable");var u=r(19);var d=r(4);var n=r(64);var c=r(66);var f=r(22);var h=r(65);var p=h.RETURN;var v=function(e){return e==null?undefined:u(e)};var m=function(e){var t=e._c;if(t){e._c=undefined;t()}};var _=function(e){return e._o===undefined};var y=function(e){if(!_(e)){e._o=undefined;m(e)}};var g=function(t,e){d(t);this._c=undefined;this._o=t;t=new w(this);try{var r=e(t);var i=r;if(r!=null){if(typeof r.unsubscribe==="function")r=function(){i.unsubscribe()};else u(r);this._c=r}}catch(e){t.error(e);return}if(_(this))m(this)};g.prototype=c({},{unsubscribe:function e(){y(this)}});var w=function(e){this._s=e};w.prototype=c({},{next:function e(t){var r=this._s;if(!_(r)){var i=r._o;try{var n=v(i.next);if(n)return n.call(i,t)}catch(e){try{y(r)}finally{throw e}}}},error:function e(t){var r=this._s;if(_(r))throw t;var i=r._o;r._o=undefined;try{var n=v(i.error);if(!n)throw t;t=n.call(i,t)}catch(e){try{m(r)}finally{throw e}}m(r);return t},complete:function e(t){var r=this._s;if(!_(r)){var i=r._o;r._o=undefined;try{var n=v(i.complete);t=n?n.call(i,t):undefined}catch(e){try{m(r)}finally{throw e}}m(r);return t}}});var F=function e(t){n(this,F,"Observable","_f")._f=u(t)};c(F.prototype,{subscribe:function e(t){return new g(t,this._f)},forEach:function e(i){var n=this;return new(o.Promise||a.Promise)(function(e,t){u(i);var r=n.subscribe({next:function(e){try{return i(e)}catch(e){t(e);r.unsubscribe()}},error:t,complete:e})})}});c(F,{from:function e(i){var t=typeof this==="function"?this:F;var r=v(d(i)[l]);if(r){var n=d(r.call(i));return n.constructor===t?n:new t(function(e){return n.subscribe(e)})}return new t(function(t){var r=false;s(function(){if(!r){try{if(h(i,false,function(e){t.next(e);if(r)return p})===p)return}catch(e){if(r)throw e;t.error(e);return}t.complete()}});return function(){r=true}})},of:function e(){for(var t=0,r=arguments.length,i=new Array(r);t<r;)i[t]=arguments[t++];return new(typeof this==="function"?this:F)(function(t){var r=false;s(function(){if(!r){for(var e=0;e<i.length;++e){t.next(i[e]);if(r)return}t.complete()}});return function(){r=true}})}});f(F.prototype,l,function(){return this});i(i.G,{Observable:F});r(63)("Observable")},function(e,t,r){var i=r(6);var n=r(0);var a=r(107);var o=[].slice;var s=/MSIE .\./.test(a);var l=function(n){return function(e,t){var r=arguments.length>2;var i=r?o.call(arguments,2):false;return n(r?function(){(typeof e=="function"?e:Function(e)).apply(this,i)}:e,t)}};n(n.G+n.B+n.F*s,{setTimeout:l(i.setTimeout),setInterval:l(i.setInterval)})},function(e,t,r){var i=r(0);var n=r(147);i(i.G+i.B,{setImmediate:n.set,clearImmediate:n.clear})},function(e,t,r){var i=r(144);var n=r(59);var a=r(23);var o=r(6);var s=r(22);var l=r(77);var u=r(11);var d=u("iterator");var c=u("toStringTag");var f=l.Array;var h={CSSRuleList:true,CSSStyleDeclaration:false,CSSValueList:false,ClientRectList:false,DOMRectList:false,DOMStringList:false,DOMTokenList:true,DataTransferItemList:false,FileList:false,HTMLAllCollection:false,HTMLCollection:false,HTMLFormElement:false,HTMLSelectElement:false,MediaList:true,MimeTypeArray:false,NamedNodeMap:false,NodeList:true,PaintRequestList:false,Plugin:false,PluginArray:false,SVGLengthList:false,SVGNumberList:false,SVGPathSegList:false,SVGPointList:false,SVGStringList:false,SVGTransformList:false,SourceBufferList:false,StyleSheetList:true,TextTrackCueList:false,TextTrackList:false,TouchList:false};for(var p=n(h),v=0;v<p.length;v++){var m=p[v];var _=h[m];var y=o[m];var g=y&&y.prototype;var w;if(g){if(!g[d])s(g,d,f);if(!g[c])s(g,c,m);l[m]=f;if(_)for(w in i)if(!g[w])a(g,w,i[w],true)}}},function(D,e,t){(function(e){!function(r){"use strict";var e=Object.prototype;var u=e.hasOwnProperty;var l;var t=typeof Symbol==="function"?Symbol:{};var n=t.iterator||"@@iterator";var i=t.asyncIterator||"@@asyncIterator";var a=t.toStringTag||"@@toStringTag";var o=typeof D==="object";var s=r.regeneratorRuntime;if(s){if(o){D.exports=s}return}s=r.regeneratorRuntime=o?D.exports:{};function d(e,t,r,i){var n=t&&t.prototype instanceof _?t:_;var a=Object.create(n.prototype);var o=new A(i||[]);a._invoke=M(e,r,o);return a}s.wrap=d;function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}var f="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var m={};function _(){}function y(){}function g(){}var w={};w[n]=function(){return this};var F=Object.getPrototypeOf;var b=F&&F(F(k([])));if(b&&b!==e&&u.call(b,n)){w=b}var C=g.prototype=_.prototype=Object.create(w);y.prototype=C.constructor=g;g.constructor=y;g[a]=y.displayName="GeneratorFunction";function x(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}s.isGeneratorFunction=function(e){var t=typeof e==="function"&&e.constructor;return t?t===y||(t.displayName||t.name)==="GeneratorFunction":false};s.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,g)}else{e.__proto__=g;if(!(a in e)){e[a]="GeneratorFunction"}}e.prototype=Object.create(C);return e};s.awrap=function(e){return{__await:e}};function P(s){function l(e,t,r,i){var n=c(s[e],s,t);if(n.type==="throw"){i(n.arg)}else{var a=n.arg;var o=a.value;if(o&&typeof o==="object"&&u.call(o,"__await")){return Promise.resolve(o.__await).then(function(e){l("next",e,r,i)},function(e){l("throw",e,r,i)})}return Promise.resolve(o).then(function(e){a.value=e;r(a)},i)}}if(typeof r.process==="object"&&r.process.domain){l=r.process.domain.bind(l)}var t;function e(r,i){function e(){return new Promise(function(e,t){l(r,i,e,t)})}return t=t?t.then(e,e):e()}this._invoke=e}x(P.prototype);P.prototype[i]=function(){return this};s.AsyncIterator=P;s.async=function(e,t,r,i){var n=new P(d(e,t,r,i));return s.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})};function M(o,s,l){var u=f;return function e(t,r){if(u===p){throw new Error("Generator is already running")}if(u===v){if(t==="throw"){throw r}return L()}l.method=t;l.arg=r;while(true){var i=l.delegate;if(i){var n=T(i,l);if(n){if(n===m)continue;return n}}if(l.method==="next"){l.sent=l._sent=l.arg}else if(l.method==="throw"){if(u===f){u=v;throw l.arg}l.dispatchException(l.arg)}else if(l.method==="return"){l.abrupt("return",l.arg)}u=p;var a=c(o,s,l);if(a.type==="normal"){u=l.done?v:h;if(a.arg===m){continue}return{value:a.arg,done:l.done}}else if(a.type==="throw"){u=v;l.method="throw";l.arg=a.arg}}}}function T(e,t){var r=e.iterator[t.method];if(r===l){t.delegate=null;if(t.method==="throw"){if(e.iterator.return){t.method="return";t.arg=l;T(e,t);if(t.method==="throw"){return m}}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=c(r,e.iterator,t.arg);if(i.type==="throw"){t.method="throw";t.arg=i.arg;t.delegate=null;return m}var n=i.arg;if(!n){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return m}if(n.done){t[e.resultName]=n.value;t.next=e.nextLoc;if(t.method!=="return"){t.method="next";t.arg=l}}else{return n}t.delegate=null;return m}x(C);C[a]="Generator";C[n]=function(){return this};C.toString=function(){return"[object Generator]"};function E(e){var t={tryLoc:e[0]};if(1 in e){t.catchLoc=e[1]}if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(E,this);this.reset(true)}s.keys=function(r){var i=[];for(var e in r){i.push(e)}i.reverse();return function e(){while(i.length){var t=i.pop();if(t in r){e.value=t;e.done=false;return e}}e.done=true;return e}};function k(t){if(t){var e=t[n];if(e){return e.call(t)}if(typeof t.next==="function"){return t}if(!isNaN(t.length)){var r=-1,i=function e(){while(++r<t.length){if(u.call(t,r)){e.value=t[r];e.done=false;return e}}e.value=l;e.done=true;return e};return i.next=i}}return{next:L}}s.values=k;function L(){return{value:l,done:true}}A.prototype={constructor:A,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=l;this.done=false;this.delegate=null;this.method="next";this.arg=l;this.tryEntries.forEach(S);if(!e){for(var t in this){if(t.charAt(0)==="t"&&u.call(this,t)&&!isNaN(+t.slice(1))){this[t]=l}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var t=e.completion;if(t.type==="throw"){throw t.arg}return this.rval},dispatchException:function(r){if(this.done){throw r}var i=this;function e(e,t){a.type="throw";a.arg=r;i.next=e;if(t){i.method="next";i.arg=l}return!!t}for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];var a=n.completion;if(n.tryLoc==="root"){return e("end")}if(n.tryLoc<=this.prev){var o=u.call(n,"catchLoc");var s=u.call(n,"finallyLoc");if(o&&s){if(this.prev<n.catchLoc){return e(n.catchLoc,true)}else if(this.prev<n.finallyLoc){return e(n.finallyLoc)}}else if(o){if(this.prev<n.catchLoc){return e(n.catchLoc,true)}}else if(s){if(this.prev<n.finallyLoc){return e(n.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&u.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}if(n&&(e==="break"||e==="continue")&&n.tryLoc<=t&&t<=n.finallyLoc){n=null}var a=n?n.completion:{};a.type=e;a.arg=t;if(n){this.method="next";this.next=n.finallyLoc;return m}return this.complete(a)},complete:function(e,t){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&t){this.next=t}return m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e){this.complete(r.completion,r.afterLoc);S(r);return m}}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if(i.type==="throw"){var n=i.arg;S(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){this.delegate={iterator:k(e),resultName:t,nextLoc:r};if(this.method==="next"){this.arg=l}return m}}}(typeof e==="object"?e:typeof window==="object"?window:typeof self==="object"?self:this)}).call(this,t(73))},function(e,t,r){r(473);e.exports=r(29).RegExp.escape},function(e,t,r){var i=r(0);var n=r(474)(/[\\^$*+?.()|[\]{}]/g,"\\$&");i(i.S,"RegExp",{escape:function e(t){return n(t)}})},function(e,t){e.exports=function(t,r){var i=r===Object(r)?function(e){return r[e]}:r;return function(e){return String(e).replace(t,i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdApp=undefined;var i=r(1);var n=u(i);var a=r(476);var o=r(117);var s=r(504);var l=r(505);function u(e){return e&&e.__esModule?e:{default:e}}var d=function e(){(0,n.default)(this,e)};d.createDefaultViewer=a.createDefaultViewer;d.getFreedoXPath=o.getFreedoXPath;d.setSkyBox=s.setSkyBox;d.setSkyBoxOnGround=s.setSkyBoxOnGround;d.FdPModels=l.FdPModels;t.FdApp=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.createDefaultViewer=undefined;var i=r(3);var h=n(i);var p=r(117);var v=r(487);var m=r(82);function n(e){return e&&e.__esModule?e:{default:e}}window.mobilecheck=function(){var t=false;(function(e){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))t=true})(navigator.userAgent||navigator.vendor||window.opera);return t};var y={globe:false,imageryProvider:false,baseLayerPicker:false,geocoder:false,timeline:false,animation:false,vrButton:false,navigationHelpButton:false,sceneModePicker:false,fullscreenButton:false,homeButton:false,selectionIndicator:false,infoBox:false,skyBox:false,sun:false,skyAtmosphere:false};var g={imageryProvider:Freedo.createTileMapServiceImageryProvider({url:Freedo.buildModuleUrl("Assets/Textures/NaturalEarthII")}),baseLayerPicker:false,geocoder:false,timeline:false,animation:false,vrButton:false,navigationHelpButton:false,sceneModePicker:false,fullscreenButton:false,homeButton:false,selectionIndicator:false,infoBox:false,scene3DOnly:true,contextOptions:{webgl:{antialias:!mobilecheck()}}};function a(e,t,r){Freedo.Camera.DEFAULT_VIEW_RECTANGLE=Freedo.Rectangle.fromDegrees(80,5,135,55);Freedo.BingMapsApi.defaultKey="AsosOjY68GIcKsRMisb8KcmGD266hYjtDHD5-EC-YTJUHi1Cxj1K3zWhLcp-SPNZ";if(Freedo.Ion!==undefined)Freedo.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMjYwYzVmZS1lYzNiLTRlZDAtODA2OS0zMTgzMDcyNDdiN2YiLCJpZCI6MjA5MCwiaWF0IjoxNTMxNDYwMjYxfQ.B6-NHQHFkHLFuu76sV6msgGf9V-xfkRKr4fFwuGQ6mQ";var i;var n;var a;r=Freedo.defaultValue(r,Freedo.defaultValue.EMPTY_OBJECT);var o=Freedo.defaultValue(r.planeMode,false);var s=Freedo.defaultValue(r.showMouseCenterIcon,true);if(o){t=_.assign(y,t)}else{t=_.assign(g,t)}if(r.showNewDefImagery){t.imageryProvider=new Freedo.UrlTemplateImageryProvider({url:Freedo.FdApp.getFreedoXPath()+"Assets/Textures/World"+"/Z{z}/{y}/{x}.png",maximumLevel:3})}if(r.showFTPDefImagery){t.imageryProvider=new Freedo.UrlTemplateImageryProvider({url:"http://ftp.gbim360.com/zhengsicheng/world/Z{z}/{y}/{x}.png",maximumLevel:7})}var l=new Freedo.Viewer(e,t);l._cesiumWidget._creditContainer.style.display="none";l.scene._useBD=Freedo.defaultValue(r.batchDraw,false);if(l.scene._useBD&&Freedo.defined(r.batchDrawTargetFPS)){l.scene._maxTimeToBeUsedPerRender=1e3/r.batchDrawTargetFPS}l.scene.logarithmicDepthBuffer=false;l.scene.logarithmicDepthFarToNearRatio=1e5;l.scene.highDynamicRange=false;l.scene.postProcessStages.fxaa.enabled=true;n=Freedo.defaultValue(r.hasSkyBoxOnGround,true);a=Freedo.defaultValue(r.hasProvinceBoundaries,false);var u=(0,p.getFreedoXPath)();if(a){var d=new Freedo.GeoJsonDataSource;d.load(u+"Assets/Misc/china.topojson").then(function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,h.default)(e.entities.values),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=o.polygon.hierarchy._value.positions;l.entities.add({polyline:{positions:s,clampToGround:true,material:Freedo.Color.ORANGE}})}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}});l.scene.requestRender()}l.camera.percentageChanged=1e-4;if(l.scene.globe){l.scene.globe.depthTestAgainstTerrain=true}l.scene.pickTranslucentDepth=true;if(l.scene.moon){l.scene.moon.show=false}if(l.scene.sun){l.scene.sun.show=false}l.extend(Freedo.viewerFreedoPModelInspectorMixin);l.cesium3DTilesInspector.setVisibility(false);l._cesiumWidget._supportsImageRenderingPixelated=Freedo.FeatureDetection.supportsImageRenderingPixelated();l._cesiumWidget._forceResize=true;if(Freedo.FeatureDetection.supportsImageRenderingPixelated()){var c=window.devicePixelRatio;while(c>=2){c/=2}l.resolutionScale=c}l.scene.requestRenderMode=true;l.scene.maximumRenderTimeChange=Infinity;if(n&&!o){l.scene.skyBoxOnGround=new Freedo.SkyBox({sources:{positiveX:u+"Assets/Textures/SkyBoxOnGround/rightav9.jpg",negativeX:u+"Assets/Textures/SkyBoxOnGround/leftav9.jpg",positiveY:u+"Assets/Textures/SkyBoxOnGround/frontav9.jpg",negativeY:u+"Assets/Textures/SkyBoxOnGround/backav9.jpg",positiveZ:u+"Assets/Textures/SkyBoxOnGround/topav9.jpg",negativeZ:u+"Assets/Textures/SkyBoxOnGround/bottomav9.jpg"}})}if(o){l.scene.planeMode=true;l.scene._screenSpaceCameraController=new v.FdScreenSpaceCameraController(l)}if(s){l.scene.mouseHandlerCenterIcon=new Freedo.FdCamera.FdMouseHandlerCenterIcon(l);if(!l.scene.pickPositionSupported){l.scene.mouseHandlerCenterIcon.visibility=false}}if(r.watchPKey){var f=new m.FdKeyboard(l);f.enable();f.on(function(e,t){if(e==="keyUp"){if(t.keyCode===80){var r=Freedo.FdCamera.getCurrentCameraInfo(l.scene.camera);console.log(r)}}})}return l}t.createDefaultViewer=a},function(e,t,r){r(79);r(70);e.exports=r(486)},function(e,t,r){"use strict";var i=r(479);var n=r(216);var a=r(80);var o=r(67);e.exports=r(153)(Array,"Array",function(e,t){this._t=o(e);this._i=0;this._k=t},function(){var e=this._t;var t=this._k;var r=this._i++;if(!e||r>=e.length){this._t=undefined;return n(1)}if(t=="keys")return n(0,r);if(t=="values")return n(0,e[r]);return n(0,[r,e[r]])},"values");a.Arguments=a.Array;i("keys");i("values");i("entries")},function(e,t){e.exports=function(){}},function(e,t,r){"use strict";var i=r(113);var n=r(92);var a=r(93);var o={};r(54)(o,r(21)("iterator"),function(){return this});e.exports=function(e,t,r){e.prototype=i(o,{next:n(1,r)});a(e,t+" Iterator")}},function(e,t,r){var s=r(34);var l=r(47);var u=r(81);e.exports=r(43)?Object.defineProperties:function e(t,r){l(t);var i=u(r);var n=i.length;var a=0;var o;while(n>a)s.f(t,o=i[a++],r[o]);return t}},function(e,t,r){var l=r(67);var u=r(114);var d=r(483);e.exports=function(s){return function(e,t,r){var i=l(e);var n=u(i.length);var a=d(r,n);var o;if(s&&t!=t)while(n>a){o=i[a++];if(o!=o)return true}else for(;n>a;a++)if(s||a in i){if(i[a]===t)return s||a||0}return!s&&-1}}},function(e,t,r){var i=r(156);var n=Math.max;var a=Math.min;e.exports=function(e,t){e=i(e);return e<0?n(e+t,0):a(e,t)}},function(e,t,r){var i=r(69);var n=r(94);var a=r(157)("IE_PROTO");var o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){e=n(e);if(i(e,a))return e[a];if(typeof e.constructor=="function"&&e instanceof e.constructor){return e.constructor.prototype}return e instanceof Object?o:null}},function(e,t,r){var l=r(156);var u=r(152);e.exports=function(s){return function(e,t){var r=String(u(e));var i=l(t);var n=r.length;var a,o;if(i<0||i>=n)return s?"":undefined;a=r.charCodeAt(i);return a<55296||a>56319||i+1===n||(o=r.charCodeAt(i+1))<56320||o>57343?s?r.charAt(i):a:s?r.slice(i,i+2):(a-55296<<10)+(o-56320)+65536}}},function(e,t,r){var i=r(47);var n=r(160);e.exports=r(13).getIterator=function(e){var t=n(e);if(typeof t!="function")throw TypeError(e+" is not iterable!");return i(t.call(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdScreenSpaceCameraController=undefined;var i=r(221);var m=Freedo;var n;function a(e){if(!m.defined(e)){throw new DeveloperError("viewer is required.")}var t=e.scene;this.enableCollisionDetection=false;this.minimumZoomDistance=.1;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this.maximumMovementRatio=.1;this.enableInputs=true;this.enableRotate=true;this.enablePan=true;this.enableZoom=true;this.inertiaRotate=.5;this.inertiaPan=.5;this.inertiaZoom=.5;this._needUpdateBoundingSphere=true;this.defaultZoomReference=undefined;this.defaultRotateReference=undefined;this.boundingSphereCenterAsReferenceCenter=false;this.rotateEventTypes=m.CameraEventType.LEFT_DRAG;this.panEventTypes=[m.CameraEventType.RIGHT_DRAG,m.CameraEventType.MIDDLE_DRAG,m.CameraEventType.PINCH];this.zoomEventTypes=[m.CameraEventType.WHEEL,m.CameraEventType.PINCH];this._scene=t;this._aggregator=new m.CameraEventAggregator(t.canvas);this._zoomFactor=5;this._rotateFactor=1;this.maximumMovementRatio=.1;this.rotateMode=0;this.highlightMode=0;this.hightlightColor=new Freedo.Color(1,0,0,.5);this._boundingSphere=new m.BoundingSphere(new m.Cartesian3(0,0,0),0);this._handleCenter=new m.Cartesian3;this._mouseHandlerEventTypes={None:0,Translate:1,Rotate:2,Zoom:3,Pick:4,All:99999};this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._mouseEventType=this._mouseHandlerEventTypes.All;this._enablePicking=false;var r=new Freedo.ScreenSpaceEventHandler(e.scene.canvas);r.setInputAction(this.pickingComponent.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._pickingComponent=new Freedo.FdTools.FdPModelsStyleManager(e);this._lastSelectedComponent=undefined}Freedo.defineProperties(a.prototype,{needUpdateBoundingSphere:{get:function e(){return this._needUpdateBoundingSphere},set:function e(t){if(t){k(this)}this._needUpdateBoundingSphere=false}},styleManager:{get:function e(){return this._pickingComponent}}});function _(e,t){if(e<0){return 0}var r=(1-t)*25;return Math.exp(-r*e)}function y(e){return m.Cartesian2.equalsEpsilon(e.startPosition,e.endPosition,m.Math.EPSILON14)}var g=.4;function p(e,t,r,i,n,a,o){var s=a[o];if(!m.defined(s)){s=a[o]={startPosition:new m.Cartesian2,endPosition:new m.Cartesian2,motion:new m.Cartesian2,active:false}}var l=e.getButtonPressTime(t,r);var u=e.getButtonReleaseTime(t,r);var d=l&&u&&(u.getTime()-l.getTime())/1e3;var c=new Date;var f=u&&(c.getTime()-u.getTime())/1e3;if(l&&u&&d<g){var h=_(f,i);if(!s.active){var p=e.getLastMovement(t,r);if(!m.defined(p)||y(p)){return}s.motion.x=(p.endPosition.x-p.startPosition.x)*.5;s.motion.y=(p.endPosition.y-p.startPosition.y)*.5;s.startPosition=m.Cartesian2.clone(p.startPosition,s.startPosition);s.endPosition=m.Cartesian2.multiplyByScalar(s.motion,h,s.endPosition);s.endPosition=m.Cartesian2.add(s.startPosition,s.endPosition,s.endPosition);s.active=true}else{s.startPosition=m.Cartesian2.clone(s.endPosition,s.startPosition);s.endPosition=m.Cartesian2.multiplyByScalar(s.motion,h,s.endPosition);s.endPosition=m.Cartesian2.add(s.startPosition,s.endPosition,s.endPosition);s.motion=m.Cartesian2.clone(m.Cartesian2.ZERO,s.motion)}if(isNaN(s.endPosition.x)||isNaN(s.endPosition.y)||m.Cartesian2.distance(s.startPosition,s.endPosition)<.5){s.active=false;return}if(!e.isButtonDown(t,r)){var v=e.getStartMousePosition(t,r);n(a,v,s)}}else{s.active=false}}var v=[];function o(e,t,r,i,n,a){if(!m.defined(r)){return}var o=e._aggregator;if(!m.isArray(r)){v[0]=r;r=v}var s=r.length;for(var l=0;l<s;++l){var u=r[l];var d=m.defined(u.eventType)?u.eventType:u;var c=u.modifier;var f=o.isMoving(d,c)&&o.getMovement(d,c);var h=o.getStartMousePosition(d,c);if(e.enableInputs&&t){if(f){i(e,h,f)}else if(n<1){p(o,d,c,n,i,e,a)}}}}var u=new m.Cartesian2;var w=new m.Cartesian3;var F=new m.Cartesian3;var b=new m.Cartesian3;var C=new m.Cartesian3;var x=new m.Ray;var P=new m.Plane(new m.Cartesian3(0,0,1),1);var s=new m.Cartesian2;var l=new m.Cartesian3;var d=new m.Cartesian3;var c=new m.Cartesian3;var f=new m.Cartesian3;var M=new m.Cartesian2;var T=new m.Cartesian3;function h(e){var t=e.direction;var r=e.up;var i=0;if(t.z<-.99999){i=Math.atan2(r.y,r.x)}else if(t.z>.99999){i=Math.atan2(-r.y,-r.x)}else{i=Math.atan2(t.y,t.x)}if(isNaN(i)){throw new m.DeveloperError("")}return i}function E(e){var t=e.direction;var r=0;if(t.z<-.99999){r=-m.Math.PI_OVER_TWO}else if(t.z>.99999){r=m.Math.PI_OVER_TWO}else{var i=Math.sqrt(t.x*t.x+t.y*t.y);r=Math.atan(t.z/i)}if(isNaN(r)){throw new m.DeveloperError("")}return r}function S(e,t,r,i,n){r.x=Math.cos(t)*Math.cos(e);r.y=Math.cos(t)*Math.sin(e);r.z=Math.sin(t);m.Cartesian3.normalize(r,r);var a=e+m.Math.PI_OVER_TWO;i.x=Math.cos(a);i.y=Math.sin(a);i.z=0;m.Cartesian3.normalize(i,i);m.Cartesian3.cross(r,i,n);m.Cartesian3.normalize(n,n)}function A(e){if(e instanceof m.FreedoPModelset){return 1}if(e instanceof m.Model){return 1}if(m.defined(m.S3DTileset)){if(e instanceof m.S3DTileset){return 1}}return 0}function k(e){var t=e._scene;var r=t.primitives;e._boundingSphere=undefined;for(var i=0;i<r.length;i++){var n=r.get(i);if(A(n)&&n.ready){if(!Freedo.defined(e._boundingSphere)){e._boundingSphere=n.boundingSphere}else{e._boundingSphere=Freedo.BoundingSphere.union(e._boundingSphere,n.boundingSphere,e._boundingSphere)}}}if(!Freedo.defined(e._boundingSphere)){e._boundingSphere=new m.BoundingSphere(new m.Cartesian3(0,0,0),0)}e.boundingSphereCenterAsReferenceCenter=false;if(e._boundingSphere.radius<400){e.boundingSphereCenterAsReferenceCenter=true}}var L=new m.Cartesian2;function D(e,t){var r=e.canvas;var i=e.camera;var n=m.SceneTransforms.wgs84ToWindowCoordinates(e,t,L);if(!m.defined(n)){return 0}var a=r.clientLeft+r.clientWidth*0;var o=r.clientTop+r.clientHeight*0;var s=r.clientLeft+r.clientWidth*1;var l=r.clientTop+r.clientHeight*1;return!(n.x<a||n.x>=s||n.y<o||n.y>=l)}var I=new m.BoundingSphere;function R(e,t,r,i){var n=e._scene;var a=n.camera;I.center=e._boundingSphere.center;I.radius=e._boundingSphere.radius*.8;var o=n._frameState;var s=a.frustum.computeCullingVolume(a.positionWC,a.directionWC,a.upWC);var l=s.computeVisibility(I);if(l===m.Intersect.OUTSIDE){m.Cartesian3.clone(t,a.position);if(m.defined(r)){m.Cartesian3.normalize(r,a.direction)}if(m.defined(i)){m.Cartesian3.normalize(i,a.up)}if(m.defined(r)||m.defined(i)){var u=a.direction;var d=a.up;m.Cartesian3.cross(u,d,a.right)}return 0}return 1}function O(e,t,r){return m.defined(e)&&(!m.defined(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==m.Intersect.OUTSIDE&&(!m.defined(r)||!e.boundingVolume.isOccluded(r)))}function N(e,t){var r=e._frameState;var i=r.camera;var n=r.commandList;var a=r.mode===m.SceneMode.SCENE3D?r.occluder:undefined;var o=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC);var s=Number.MAX_VALUE;var l;var u=n.length;for(var d=0;d<u;++d){var c=n[d];var f=c.owner;if(m.defined(f)&&m.defined(f.primitive)&&A(f.primitive)){var h=c.boundingVolume;if(!m.defined(h)){continue}if(!O(c,o,a)){continue}var p=m.SceneTransforms.wgs84ToWindowCoordinates(e,h.center,L);if(!m.defined(p)){continue}var v=m.Cartesian2.distanceSquared(p,t);if(v<s){s=v;if(!m.defined(l)){l=new m.Cartesian3}l=m.Cartesian3.clone(h.center,l)}}}return l}a.prototype.getReferencePosition=function(e){if(this.boundingSphereCenterAsReferenceCenter){T=m.Cartesian3.clone(this._boundingSphere.center,w);return T}var t=this._scene;var r=t.camera;var i=t.canvas;var n=u;n.x=i.clientWidth/2;n.y=i.clientHeight/2;T=t.pickPosition(n,w);if(!m.defined(T)){T=N(t,e);if(!m.defined(T)){var a=m.Cartesian3.negate(r.direction,C);var o=this._boundingSphere.center;var s=m.Plane.fromPointNormal(o,a,P);var l=r.getPickRay(e,x);T=m.IntersectionTests.rayPlane(l,s,w);if(!m.defined(T)){if(m.defined(this.defaultZoomReference)){T=m.Cartesian3.clone(this.defaultZoomReference,w)}else{T=m.Cartesian3.clone(this._boundingSphere.center,w)}}}}return T};var B=new Freedo.Cartesian3(1,0,0);var H=new Freedo.Cartesian3(0,0,1);var V=new Freedo.Cartesian3(0,1,0);var G=new Freedo.Quaternion;var z=new Freedo.Quaternion;var U=new Freedo.Matrix3;var j=new Freedo.Matrix3;function q(e,t,r,i){var n=Freedo.Quaternion.fromAxisAngle(t,r,G);var a=Freedo.Quaternion.fromAxisAngle(e.right,i,z);var o=Freedo.Matrix3.fromQuaternion(n,U);var s=Freedo.Matrix3.fromQuaternion(a,j);var l=Freedo.Matrix3.multiply(o,s,o);Freedo.Matrix3.multiplyByVector(l,e.position,e.position);Freedo.Matrix3.multiplyByVector(l,e.direction,e.direction);Freedo.Matrix3.multiplyByVector(l,e.up,e.up);Freedo.Cartesian3.cross(e.direction,e.up,e.right);Freedo.Cartesian3.cross(e.right,e.direction,e.up)}function W(e,t,r){var i=e._scene;var n=i.camera;var a=i.canvas;if(y(r)){return}if(!m.Cartesian2.equalsEpsilon(M,t,m.Math.EPSILON14)){m.Cartesian2.clone(t,M);T=i.pickPosition(r.startPosition,T);if(!m.defined(T)){e.getReferencePosition(t)}}e._handleCenter=T;var o=r.startPosition.x-r.endPosition.x;var s=r.startPosition.y-r.endPosition.y;if(o!==0&&Math.abs(s)/Math.abs(o)>5){o=0}if(s!==0&&Math.abs(o)/Math.abs(s)>5){s=0}var l=o/a.clientHeight;var u=s/a.clientHeight;l=Math.min(l,e.maximumMovementRatio);u=Math.min(u,e.maximumMovementRatio);var d=e._rotateFactor*l*Math.PI*2;var c=e._rotateFactor*u*Math.PI;var f=m.Matrix4.fromTranslation(T);n.lookAtTransform(f);var h=H;if(e.rotateMode===1){h=V}else if(e.rotateMode===2){h=B}else if(e.rotateMode===3){h=n.right}q(n,h,d,c);n.lookAtTransform(m.Matrix4.IDENTITY)}function X(e,t,r){var i=e._scene;var n=i.camera;var a=i.canvas;if(y(r)){return}var o=m.Cartesian3.negate(n.direction,C);var s=i.pickPosition(r.startPosition,w);if(m.defined(s)){var l=m.Plane.fromPointNormal(s,o,P);var u=n.getPickRay(r.endPosition,x);var d=m.IntersectionTests.rayPlane(u,l,F);if(m.defined(d)){var c=m.Cartesian3.subtract(s,d,b);var f=m.clone(n.position,true);n.move(c,1);return}}var h=e.getReferencePosition(t);var l=m.Plane.fromPointNormal(h,o,P);var u=n.getPickRay(r.startPosition,x);s=m.IntersectionTests.rayPlane(u,l,w);u=n.getPickRay(r.endPosition,x);d=m.IntersectionTests.rayPlane(u,l,F);if(m.defined(s)&&m.defined(d)){var c=m.Cartesian3.subtract(s,d,b);var f=m.clone(n.position,true);n.move(c,1);return}}var L=new m.Cartesian2;var Z=new m.Ray;function Y(e,t,r){if(m.defined(r.distance)){r=r.distance}var i=e._scene;var n=i.camera;var a=i.canvas;var o=r.endPosition.y-r.startPosition.y;if(Math.abs(o)<m.Math.EPSILON14){return}var s=o/a.clientHeight;s=Math.min(s,e.maximumMovementRatio);var l=i.pickPosition(t,w);if(!m.defined(l)){l=e.getReferencePosition(t)}e._handleCenter=l;L=m.SceneTransforms.wgs84ToWindowCoordinates(i,l,L);if(m.defined(L)){var u;u=n.getPickRay(L,Z);var d=u.direction;var c=m.Cartesian3.subtract(l,n.position,b);var f=m.Cartesian3.magnitude(c);c=m.Cartesian3.normalize(c,b);f=f*s*e._zoomFactor;if(Math.abs(f)>e.maximumZoomDistance){var h=f<0?-1:1;f=h*e.maximumZoomDistance}if(Math.abs(f)<e.minimumZoomDistance){var h=f<0?-1:1;f=h*e.minimumZoomDistance}n.move(d,f);return}var c=m.Cartesian3.subtract(l,n.position,b);var f=m.Cartesian3.magnitude(c);c=m.Cartesian3.normalize(c,b);f=f*s*e._zoomFactor;if(Math.abs(f)>e.maximumZoomDistance){var h=f<0?-1:1;f=h*e.maximumZoomDistance}if(Math.abs(f)<e.minimumZoomDistance){var h=f<0?-1:1;f=h*e.minimumZoomDistance}n.move(c,f)}a.prototype.pickingComponent=function(e){if(!this._enablePicking){return}this.resetSelection();var l=this;var u={};this._pickingComponent.pickComponent(e.position,function(e,t,r){if(Freedo.defined(e)){if(r!=="Gltf"){if(l.highlightMode===0){var i=l.hightlightColor.red;var n=l.hightlightColor.green;var a=l.hightlightColor.blue;var o=l.hightlightColor.alpha;var s=e;l._pickingComponent.addHighlightComponent(t,s,"color",[i*255,n*255,a*255,o]);l._lastSelectedComponent={componentID:s,tileset:t,type:"color"}}else{var s=e;l._pickingComponent.addHighlightComponent(t,s,"visible",true);l._lastSelectedComponent={componentID:s,tileset:t,type:"visible"}}u.componentID=e;u.pModelID=t;u.ancestorComponents=r}else{l._pickingComponent.lastPickedPrimitive=t;u.componentID=e;u.pModelID=t;if(l.highlightMode===0){l._pickingComponent.highlightGltf(l.hightlightColor)}else{l._pickingComponent.separateGltfComponent(l.allModels)}}}},true);this._event.raiseEvent("Picking",u)};a.prototype.resetSelection=function(){if(Freedo.defined(this._pickingComponent.lastPickedPrimitive)){var e=this._pickingComponent.lastPickedPrimitive.primitive.gltf;var t=e.nodes;for(var r=0;r<t.length;r++){t[r].highlightComponentColor=undefined}this._pickingComponent.lastPickedPrimitive=undefined}if(Freedo.defined(this.allModels)){var i=this.allModels;for(var r=0;r<i.length;r++){var n=i[r];var a=n.models;for(var o=0;o<a.length;o++){a[o].show=true}}}if(Freedo.defined(this._lastSelectedComponent)){this._pickingComponent.deleteHighlightComponent(this._lastSelectedComponent.tileset,this._lastSelectedComponent.componentID,this._lastSelectedComponent.type);this._lastSelectedComponent=undefined}};a.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};var J=new Freedo.Cartesian2;a.prototype.rotate=function(e,t,r){var i=this._scene;var n=i.camera;var a=i.canvas;var o=m.Matrix4.fromTranslation(this._boundingSphere.center);n.lookAtTransform(o);n.rotate(t,r);n.lookAtTransform(m.Matrix4.IDENTITY)};function Q(e){var t,r,i=Y;if(e._mouseEventType===e._mouseHandlerEventTypes.All){t=W;r=X}else{if(e._mouseEventType===e._mouseHandlerEventTypes.Translate){t=X;r=X}else if(e._mouseEventType===e._mouseHandlerEventTypes.Rotate){t=W;r=X}else if(e._mouseEventType===e._mouseHandlerEventTypes.Zoom){t=Y;r=X}else{t=W;r=X}}o(e,e.enableRotate,e.rotateEventTypes,t,e.inertiaRotate,"_lastInertiaSpinMovement");o(e,e.enablePan,e.panEventTypes,r,e.inertiaPan,"_lastInertiaPanMovement");o(e,e.enableZoom,e.zoomEventTypes,i,e.inertiaZoom,"_lastInertiaZoomMovement")}a.prototype.setMouseHandlerEventType=function(e){this.resetSelection();if(e===4){this._enablePicking=true}else if(e===5){this._enablePicking=false}else{if(e<0){e=0}else if(e>3&&e!==this._mouseHandlerEventTypes.All){e=0}this._mouseEventType=e}};a.prototype.flyHome=function(e){if(!Freedo.defined(this._boundingSphere)){k(this)}if(!Freedo.defined(this._boundingSphere)){return}e=Freedo.defaultValue(e,0);Freedo.FdCamera.FdPlaneViewCameraHelper.flyToBoundingSphere(this._scene,this._boundingSphere,{offset:new Freedo.HeadingPitchRange(0,0,0),duration:e})};a.prototype.update=function(){var e=this._scene;var t=e.mode;if(t===m.SceneMode.SCENE3D){Q(this)}this._aggregator.reset()};a.prototype.isDestroyed=function(){return false};a.prototype.destroy=function(){this._eventHelper.removeAll();this._aggregator=this._aggregator&&this._aggregator.destroy();return Freedo.destroyObject(this)};var K=a;t.FdScreenSpaceCameraController=K},function(e,t,r){r(119);r(70);r(79);r(489);r(493);r(495);r(496);e.exports=r(13).Set},function(e,t,r){"use strict";var i=r(222);var n=r(164);var a="Set";e.exports=r(226)(a,function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}},{add:function e(t){return i.def(n(this,a),t=t===0?0:t,t)}},i)},function(e,t,r){var g=r(53);var w=r(151);var F=r(94);var b=r(114);var i=r(491);e.exports=function(c,e){var f=c==1;var h=c==2;var p=c==3;var v=c==4;var m=c==6;var _=c==5||m;var y=e||i;return function(e,t,r){var i=F(e);var n=w(i);var a=g(t,r,3);var o=b(n.length);var s=0;var l=f?y(e,o):h?y(e,0):undefined;var u,d;for(;o>s;s++)if(_||s in n){u=n[s];d=a(u,s,i);if(c){if(f)l[s]=d;else if(d)switch(c){case 3:return true;case 5:return u;case 6:return s;case 2:l.push(u)}else if(v)return false}}return m?-1:p||v?v:l}}},function(e,t,r){var i=r(492);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,r){var i=r(42);var n=r(227);var a=r(21)("species");e.exports=function(e){var t;if(n(e)){t=e.constructor;if(typeof t=="function"&&(t===Array||n(t.prototype)))t=undefined;if(i(t)){t=t[a];if(t===null)t=undefined}}return t===undefined?Array:t}},function(e,t,r){var i=r(17);i(i.P+i.R,"Set",{toJSON:r(228)("Set")})},function(e,t,r){var i=r(95);e.exports=function(e,t){var r=[];i(e,false,r.push,r,t);return r}},function(e,t,r){r(229)("Set")},function(e,t,r){r(230)("Set")},function(e,t,r){r(119);r(70);r(79);r(498);r(499);r(500);r(501);e.exports=r(13).Map},function(e,t,r){"use strict";var i=r(222);var n=r(164);var a="Map";e.exports=r(226)(a,function(t){return function e(){return t(this,arguments.length>0?arguments[0]:undefined)}},{get:function e(t){var r=i.getEntry(n(this,a),t);return r&&r.v},set:function e(t,r){return i.def(n(this,a),t===0?0:t,r)}},i,true)},function(e,t,r){var i=r(17);i(i.P+i.R,"Map",{toJSON:r(228)("Map")})},function(e,t,r){r(229)("Map")},function(e,t,r){r(230)("Map")},function(e,t,r){r(503);var n=r(13).Object;e.exports=function e(t,r,i){return n.defineProperty(t,r,i)}},function(e,t,r){var i=r(17);i(i.S+i.F*!r(43),"Object",{defineProperty:r(34).f})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){if(!(e instanceof Freedo.Scene)){throw new Freedo.DeveloperError("The parameter is not an instance of Freedo.Scene.")}if(!Freedo.defined(t)){throw new Freedo.DeveloperError("option is required.")}var r=t.color;var i=t.imagePaths;if(!Freedo.defined(r)&&!Freedo.defined(i)){throw new Freedo.DeveloperError("color or imagePaths is required in option.")}if(Freedo.defined(r)&&Freedo.defined(i)){throw new Freedo.DeveloperError("color & imagePaths can't be set at the same time.")}e.skyAtmosphere=undefined;if(Freedo.defined(r)){e.backgroundColor=new Freedo.Color(r[0],r[1],r[2],r[3]);e.skyBox=undefined}else{if(i.length!==6){throw new Freedo.DeveloperError("imagePaths must have six valid image path.")}e.backgroundColor=new Freedo.Color(0,0,0,1);e.skyBox=new Freedo.SkyBox({sources:{positiveX:i[0],negativeX:i[1],positiveY:i[2],negativeY:i[3],positiveZ:i[4],negativeZ:i[5]}})}e.requestRender()}function n(e,t){if(!(e instanceof Freedo.Scene)){throw new Freedo.DeveloperError("The parameter is not an instance of Freedo.Scene.")}if(!Freedo.defined(t)){throw new Freedo.DeveloperError("imagePaths is required.")}if(t.length!==6){throw new Freedo.DeveloperError("imagePaths must have six valid image path.")}e.skyBox=undefined;e.backgroundColor=new Freedo.Color(0,0,0,1);e.skyBoxOnGround=new Freedo.SkyBox({sources:{positiveX:t[0],negativeX:t[1],positiveY:t[2],negativeY:t[3],positiveZ:t[4],negativeZ:t[5]}});e.requestRender()}t.setSkyBox=i;t.setSkyBoxOnGround=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPModels=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e,h){(0,n.default)(this,t);Freedo.Check.defined("options.url",h.url);this._scene=e;this._boundingSphere=undefined;this._ready=false;this._readyPromise=Freedo.when.defer();this._models=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._clippingPlanes=undefined;var p=this;var v;Freedo.when(h.url).then(function(e){var t;v=Freedo.Resource.createIfNeeded(e);p._credits=v.credits;if(v.extension==="json"){t=v.getBaseUri(true)}else if(v.isDataUri){t=""}else{v.appendForwardSlash();v=v.getDerivedResource({url:"tileset.json"});t=v.url}p._url=v.url;p._basePath=t;return p.loadJson(v)}).then(function(e){var t=e.root;var r=t.boundingVolume.box;var i=Math.sqrt(r[3]*r[3]+r[7]*r[7]+r[11]*r[11]);p._boundingSphere=new Freedo.BoundingSphere(new Freedo.Cartesian3(r[0],r[1],r[2]),i);p._ready=true;var n=t.children.length;var a=0;var o=Freedo.defined(h.modelMatrix)?h.modelMatrix:Freedo.Matrix4.IDENTITY;var s=_.cloneDeep(h);delete s.url;if(!Freedo.defined(s.forwardAxis)){s.forwardAxis=Freedo.Axis.Y}for(var l=0;l<n;l++){var u=t.children[l].content.url;if(u.endsWith(".gltf")||u.endsWith(".glb")){var d=v.getDerivedResource({url:u});var c=_.cloneDeep(s);c.url=d.url;var f=p._scene.primitives.add(Freedo.Model.fromGltf(c));f.needHighlightComponentOfGltf=true;if(Freedo.defined(p._clippingPlanes)){f.clippingPlanes=p._clippingPlanes}f.readyPromise.then(function(e){a++;p._event.raiseEvent("addedPModel",{addedCount:a,totalCount:n});if(a===n){p._readyPromise.resolve(p)}});p._models.push(f)}else{a++;console.log("Format '"+u+"' is not supported!")}}}).otherwise(function(e){p._readyPromise.reject(e)})}(0,o.default)(t,[{key:"loadJson",value:function e(t){var r=Freedo.Resource.createIfNeeded(t);return r.fetchJson()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"clippingPlanes",get:function e(){return this._clippingPlanes},set:function e(t){Freedo.ClippingPlaneCollection.setOwner(t,this,"_clippingPlanes");for(var r=0;r<this._models.length;r++){this._models[r].clippingPlanes=t}}},{key:"models",get:function e(){return this._models}},{key:"readyPromise",get:function e(){return this._readyPromise.promise}},{key:"ready",get:function e(){return this._ready}},{key:"boundingSphere",get:function e(){if(!this.ready){throw new Freedo.DeveloperError("The tileset is not loaded.  Use FreedoPModelset.readyPromise or wait for FreedoPModelset.ready to be true.")}return this._boundingSphere}}]);return t}();t.FdPModels=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGeometric=undefined;var i=r(3);var ne=o(i);var n=r(1);var a=o(n);var P=r(83);function o(e){return e&&e.__esModule?e:{default:e}}var ae=function e(){(0,a.default)(this,e)};ae.calculateLength=function(e){var t=0;for(var r=1;r<e.length;++r){t+=Freedo.Cartesian3.distance(e[r-1],e[r])}return t};ae.getLengthText=function(e){return e>1e3?(e/1e3).toFixed(2)+"千米":e.toFixed(2)+"米"};ae.getCenter=function(e,t){var r=new Freedo.Cartesian3;Freedo.Cartesian3.add(e,t,r);Freedo.Cartesian3.multiplyByScalar(r,.5,r);return r};ae.getCenterOfPts=function(e){var t=new Freedo.Cartesian3;var r=e.length;for(var i=0;i<r;++i){Freedo.Cartesian3.add(e[i],t,t)}Freedo.Cartesian3.multiplyByScalar(t,1/r,t);return t};ae.getLongAndLatRatio=function(e){var t=e.clone();t.latitude+=1e-7;var r=new Freedo.EllipsoidGeodesic;var i=t.clone();i.longitude+=.001;r.setEndPoints(t,i);var n=.001/r.surfaceDistance;var a=new Freedo.EllipsoidGeodesic;var o=t.clone();o.latitude+=.001;a.setEndPoints(t,o);var s=.001/a.surfaceDistance;return[n,s]};ae.pickPosition=function(e,t){var r=undefined;var e=e;var i=e.scene;if(i.mode!==Freedo.SceneMode.MORPHING){var n=i.pick(t);if(i.pickPositionSupported&&Freedo.defined(n)){if(n.primitive instanceof Freedo.PointPrimitive){return undefined}if(n.primitive instanceof Freedo.Label){return undefined}r=e.scene.pickPosition(t);if(!Freedo.defined(r)){return}if(r)r.type=0}else{if(e.terrainProvider instanceof Freedo.EllipsoidTerrainProvider)r=e.camera.pickEllipsoid(t,i.globe.ellipsoid);else{var a=i.camera.getPickRay(t);if(i.globe)r=i.globe.pick(a,i)}if(!Freedo.defined(r)){return}if(r)r.type=1}}var o=Freedo.FdMisc.FdGeometric.tg(r);return r};ae.pickPositionG=function(e,t){var r=undefined;var i=this.pickPosition(e,t);if(i){r=[];var n;if(e.scene.globe){n=Freedo.Cartographic.fromCartesian(i,e.scene.globe.ellipsoid);var a=Freedo.Math.toDegrees;r[0]=a(n.longitude);r[1]=a(n.latitude);r[2]=n.height}else{r[0]=i.x;r[1]=i.y;r[2]=i.z}r[3]=i.type}return r};ae.tc=function(e){if(!Freedo.defined(e))return undefined;var t=Freedo.Math.toRadians;return Freedo.Cartesian3.fromRadians(t(e[0]),t(e[1]),e[2])};ae.tg=function(e){var t=[];var r=Freedo.Cartographic.fromCartesian(e);if(!r){return[1,1,1]}var i=Freedo.Math.toDegrees;t[0]=i(r.longitude);t[1]=i(r.latitude);t[2]=r.height;return t};ae.leftOfLine=function(e,t,r){var i=e.x;var n=e.y;var a=t.x;var o=t.y;var s=r.x;var l=r.y;var u=((i-s)*(o-l)-(n-l)*(a-s))/2;if(u>0)return 1;else return-1};ae.calcAngle2D=function(e,t,r,i){var n=[t.x-e.x,t.y-e.y];var a=[i.x-r.x,i.y-r.y];var o=(n[0]*a[0]+n[1]*a[1])/(Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))*Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)));var s=Freedo.Math.toDegrees(Math.acos(o));return s*ae.leftOfLine(e,t,i)};ae.calcAngle=function(e,t,r){var i=Freedo.Cartesian3.subtract(e,t,new Freedo.Cartesian3);var n=Freedo.Cartesian3.subtract(r,t,new Freedo.Cartesian3);var a=Freedo.Cartesian3.angleBetween(i,n);return a};ae.getNormOfPolygon=function(e){var t=[];var r=new Freedo.Cartesian3;for(var i=0;i<e.length-2;i=i+1){var n;var a=Freedo.Cartesian3.subtract(e[i+1],e[i],new Freedo.Cartesian3);var o=Freedo.Cartesian3.subtract(e[i+2],e[i+1],new Freedo.Cartesian3);var s=Freedo.Cartesian3.angleBetween(a,o);if(s/3.14*180>1){n=Freedo.Cartesian3.cross(a,o,new Freedo.Cartesian3);n=Freedo.Cartesian3.normalize(n,new Freedo.Cartesian3);t.push(n)}}var l=0,u=0,d=0;for(var i=0;i<t.length;i++){l+=Math.abs(t[i].x);u+=Math.abs(t[i].y);d+=Math.abs(t[i].z)}var c;if(t.length!=0){c=new Freedo.Cartesian3(l/t.length*t[0].x/Math.abs(t[0].x),u/t.length*t[0].y/Math.abs(t[0].y),d/t.length*t[0].z/Math.abs(t[0].z))}else{var a=Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3);var o=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);var n=Freedo.Cartesian3.cross(a,o,new Freedo.Cartesian3);c=Freedo.Cartesian3.normalize(n,new Freedo.Cartesian3)}return c};ae.getInnerHoles=function(e,t,r){var i=[];var n=[];var a=true;var o=false;var s=undefined;try{for(var l=(0,ne.default)(e),u;!(a=(u=l.next()).done);a=true){var d=u.value;n.push([d.x,d.y])}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}if(Freedo.defined(r)&&r.length>0){var c=true;var f=false;var h=undefined;try{for(var p=(0,ne.default)(r),v;!(c=(v=p.next()).done);c=true){var m=v.value;var _=false;var y=[];var g=true;var w=false;var F=undefined;try{for(var b=(0,ne.default)(m),C;!(g=(C=b.next()).done);g=true){var d=C.value;var x=Freedo.Matrix4.multiplyByPointAsVector(t,d,new Freedo.Cartesian3);y.push(x);if(P.FdMath.isPosInPoly([x.x,x.y],n)){_=true;break}}}catch(e){w=true;F=e}finally{try{if(!g&&b.return){b.return()}}finally{if(w){throw F}}}if(_)i.push(m)}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}}return i};ae.createAreaPrimitive=function(e,t){var t=Freedo.defaultValue(t,{});var r=Freedo.defaultValue(t.color,new Freedo.Color(1,1,0,.1));var i=Freedo.clone(t.holes,true);var n=Freedo.defaultValue(t.show,true);var a=e[0];var o=[];var s=true;var l=false;var u=undefined;try{for(var d=(0,ne.default)(e),c;!(s=(c=d.next()).done);s=true){var f=c.value;var h=Freedo.Cartesian3.subtract(f,a,new Freedo.Cartesian3);o.push(h)}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}var p;p=ae.getNormOfPolygon(o);var v=Freedo.Cartesian3.angleBetween(p,Freedo.Cartesian3.UNIT_Z);var m=Freedo.Cartesian3.cross(p,Freedo.Cartesian3.UNIT_Z,new Freedo.Cartesian3);var _=Freedo.Quaternion.fromAxisAngle(m,v,new Freedo.Quaternion);var y=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,_,new Freedo.Cartesian3(1,1,1));var g=Freedo.Matrix4.multiplyByPointAsVector(y,p,new Freedo.Cartesian3);var w=[];var F=true;var b=false;var C=undefined;try{for(var x=(0,ne.default)(e),P;!(F=(P=x.next()).done);F=true){var f=P.value;var M=Freedo.Matrix4.multiplyByPointAsVector(y,f,new Freedo.Cartesian3);w.push(M)}}catch(e){b=true;C=e}finally{try{if(!F&&x.return){x.return()}}finally{if(b){throw C}}}var T,E,S,A;T=w[0].x;E=w[0].y;S=w[0].x;A=w[0].y;for(var k=1;k<w.length;k++){if(w[k].x<T){T=w[k].x}if(w[k].y<E){E=w[k].y}if(w[k].x>S){S=w[k].x}if(w[k].y>A){A=w[k].y}}var L=S-T;if(A-E>L)L=A-E;if(Freedo.defined(i)&&i.length>0){i=this.getInnerHoles(w,y,i)}if(Freedo.defined(i)&&i.length>0){var D=true;var I=false;var R=undefined;try{for(var O=(0,ne.default)(i),N;!(D=(N=O.next()).done);D=true){var B=N.value;var H=true;var V=false;var G=undefined;try{for(var z=(0,ne.default)(B),U;!(H=(U=z.next()).done);H=true){var f=U.value;var j=Freedo.Matrix4.multiplyByPointAsVector(y,f,new Freedo.Cartesian3);w.push(j)}}catch(e){V=true;G=e}finally{try{if(!H&&z.return){z.return()}}finally{if(V){throw G}}}}}catch(e){I=true;R=e}finally{try{if(!D&&O.return){O.return()}}finally{if(I){throw R}}}}var q;if(false){}else{var W=[];var X=[];var Z=[];for(var k=0;k<e.length;k++){W.push(e[k].x*1);W.push(e[k].y*1);W.push(e[k].z*1);X.push(p.x);X.push(p.y);X.push(p.z);Z.push((w[k].x-T)*1/L);Z.push((w[k].y-E)*1/L)}var Y=[];if(Freedo.defined(i)&&i.length>0){Y.push(e.length);var J=e.length;for(var Q=0;Q<i.length;Q++){var B=i[Q];for(var k=0;k<B.length;k++){W.push(B[k].x*1);W.push(B[k].y*1);W.push(B[k].z*1);X.push(p.x);X.push(p.y);X.push(p.z);Z.push((w[J+k].x-T)*1/L);Z.push((w[J+k].y-E)*1/L)}if(Q>0){Y.push(J)}J+=B.length}}var K=Freedo.PolygonPipeline.triangulate(w,Y);var $=new Float64Array(W);var ee=new Float32Array(X);var te=new Float32Array(Z);var re=undefined;if(Freedo.defined(t.textureObj)){re=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:te})}q=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:$}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:true,values:ee}),st:re},indices:new Uint16Array(K),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices($)})}var ie=undefined;if(Freedo.defined(t.textureObj)){ie=new Freedo.MaterialAppearance({materialSupport:Freedo.MaterialAppearance.MaterialSupport.TEXTURED,material:t.textureObj})}else{ie=new Freedo.PerInstanceColorAppearance({flat:false,translucent:false,faceForward:true})}return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:q,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)}}),appearance:ie,show:n,asynchronous:false})};ae.createSpherePrimitive=function(e,t,r){var i=new Freedo.SphereGeometry({radius:t});var n=Freedo.SphereGeometry.createGeometry(i);var a=new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.defaultValue(r,Freedo.Color.ORANGE.withAlpha(.3))}}});var o=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:n}),appearance:new Freedo.MaterialAppearance({material:a}),modelMatrix:Freedo.Transforms.eastNorthUpToFixedFrame(e),asynchronous:false,cull:false});return o};ae.createSphereOutlinePrimitive=function(e,t,r){var i=new Freedo.SphereOutlineGeometry({radius:t});var n=Freedo.SphereOutlineGeometry.createGeometry(i);var a=new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.defaultValue(r,Freedo.Color.ORANGE.withAlpha(.7))}}});var o=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:n}),appearance:new Freedo.MaterialAppearance({material:a}),modelMatrix:Freedo.Transforms.eastNorthUpToFixedFrame(e),asynchronous:false,cull:false});return o};ae.findPts=function(e,t){for(var r=1;r<e.length;r++){var i=e[r];var n=Freedo.Cartesian3.distance(i,t);if(n<1e-4){return true}}return false};ae.clearPts=function(e){var t=[];t.push(e[0]);for(var r=1;r<e.length;r++){var i=e[r];var n=ae.findPts(t,i);if(!n){t.push(i)}}return t};ae.createPolylinePrimitive=function(e,t){var t=Freedo.defaultValue(t,{});var r=Freedo.defaultValue(t.width,2);var i=Freedo.defaultValue(t.color,new Freedo.Color(1,1,0,1));var n=Freedo.defaultValue(t.type,"Color");var a=Freedo.defaultValue(t.failType,"PolylineDash");return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:r,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:n,uniforms:{color:i}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:a,uniforms:{color:i}}})})})};ae.getRelativePoints=function(e,t){var r=[];var i=e[0];for(var n=0;n<e.length;n++){var a=e[n];var o=a.x-i.x;var s=a.y-i.y;var l=a.z-i.z;r.push(new Freedo.Cartesian3(o,s,l))}return{points:r,matrix:Freedo.Matrix4.fromTranslation(i,new Freedo.Matrix4)}};ae.createPolylinePrimitive2=function(e,t){var t=Freedo.defaultValue(t,{});var r=Freedo.defaultValue(t.width,2);var i=Freedo.defaultValue(t.color,new Freedo.Color(1,1,0,1));var n=Freedo.defaultValue(t.type,"Color");var a=Freedo.defaultValue(t.failType,"PolylineDash");if(!Freedo.defined(e)||e.length==0){return undefined}function o(e,t){var r=[];var i=e[0];for(var n=0;n<e.length;n++){var a=e[n];r.push(a.x-i.x);r.push(a.y-i.y);r.push(a.z-i.z)}return{points:r,matrix:Freedo.Matrix4.fromTranslation(i,new Freedo.Matrix4)}}var s=o(e);var l=new Float64Array(s.points);var u=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(l)})},primitiveType:Freedo.PrimitiveType.LINE_STRIP,boundingSphere:Freedo.BoundingSphere.fromVertices(l),vertexFormat:Freedo.VertexFormat.POSITION_ONLY});var d=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:u,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(i),depthFailColor:Freedo.ColorGeometryInstanceAttribute.fromColor(i)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),depthFailAppearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),modelMatrix:s.matrix,compressVertices:false,asynchronous:false});return d};t.FdGeometric=ae},function(e,t,r){r(70);r(508);e.exports=r(13).Array.from},function(e,t,r){"use strict";var h=r(53);var i=r(17);var p=r(94);var v=r(223);var m=r(224);var _=r(114);var y=r(509);var g=r(160);i(i.S+i.F*!r(233)(function(e){Array.from(e)}),"Array",{from:function e(t){var r=p(t);var i=typeof this=="function"?this:Array;var n=arguments.length;var a=n>1?arguments[1]:undefined;var o=a!==undefined;var s=0;var l=g(r);var u,d,c,f;if(o)a=h(a,n>2?arguments[2]:undefined,2);if(l!=undefined&&!(i==Array&&m(l))){for(f=l.call(r),d=new i;!(c=f.next()).done;s++){y(d,s,o?v(f,a,[c.value,s],true):c.value)}}else{u=_(r.length);for(d=new i(u);u>s;s++){y(d,s,o?a(r[s],s):r[s])}}d.length=s;return d}})},function(e,t,r){"use strict";var i=r(34);var n=r(92);e.exports=function(e,t,r){if(t in e)i.f(e,t,n(0,r));else e[t]=r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAjax=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(){(0,n.default)(this,e)};o.formatParams=function(e){var t=[];for(var r in e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]))}t.push(("v="+Math.random()).replace(".",""));return t.join("&")};o.ajax=function(t){t=t||{};t.type=(t.type||"GET").toUpperCase();t.dataType=t.dataType||"json";t.async=t.async;var e=o.formatParams(t.data);if(window.XMLHttpRequest){var r=new XMLHttpRequest}else{var r=new ActiveXObject("Microsoft.XMLHTTP")}r.onreadystatechange=function(){if(r.readyState===4){var e=r.status;if(e>=200&&e<300){t.success&&t.success(r.responseText,r.responseXML)}else{t.fail&&t.fail(e)}}};if(t.type==="GET"){r.open("GET",t.url+"?"+e,t.async);r.send(null)}else if(t.type==="POST"){r.open("POST",t.url,t.async);r.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(t.token!==undefined){r.setRequestHeader("Authorization",t.token)}r.send(e)}};t.FdAjax=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCamera=undefined;var i=r(1);var n=w(i);var a=r(512);var o=r(513);var s=r(514);var l=r(515);var u=r(516);var d=r(166);var c=r(517);var f=r(518);var h=r(519);var p=r(523);var v=r(235);var m=r(524);var _=r(525);var y=r(526);var g=r(528);function w(e){return e&&e.__esModule?e:{default:e}}var F=function e(){(0,n.default)(this,e)};F.flyAround=a.flyAround;F.gotoModel=o.gotoModel;F.aerialView=s.aerialView;F.capture=l.capture;F.flyToSouth=u.flyToSouth;F.flyToWest=u.flyToWest;F.flyToNorth=u.flyToNorth;F.flyToEast=u.flyToEast;F.flyToTop=u.flyToTop;F.setZoomFactor=u.setZoomFactor;F.getCurrentCameraInfo=d.getCurrentCameraInfo;F.flyToByCameraInfo=d.flyToByCameraInfo;F.goToByCameraInfo=d.goToByCameraInfo;F.flyToByPosition=d.flyToByPosition;F.goToByPosition=d.goToByPosition;F.screenLine=d.screenLine;F.lookLeft=c.lookLeft;F.lookRight=c.lookRight;F.enableKeyboard=f.enableKeyboard;F.setKeyboardV=f.setKeyboardV;F.FdCameraHistory=h.FdCameraHistory;F.FdManipulateCube=y.FdManipulateCube;F.FdMouseHandlerCenterIcon=_.FdMouseHandlerCenterIcon;F.FdPlaneViewCameraHelper=v.FdPlaneViewCameraHelper;F.FdTrackManager=p.FdTrackManager;F.FdZoomByRectangle=m.FdZoomByRectangle;F.FdCameraHeight=g.FdCameraHeight;t.FdCamera=F},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c=new Freedo.Matrix4;function i(e,t,r){var i=t.camera;if(!Freedo.defined(r)){r={}}var n=Freedo.defaultValue(r.duration,3);var a=Freedo.defaultValue(r.rotateAngleRange,Freedo.Math.PI*4);var o=Freedo.defaultValue(r.easingFunction,Freedo.EasingFunction.QUADRACTIC_IN_OUT);var s=Freedo.defaultValue(r.delay,0);var l=Freedo.Matrix4.clone(i.transform,c);var u=Freedo.Transforms.eastNorthUpToFixedFrame(e);i.lookAtTransform(u);var d=t.tweens.add({duration:n,easingFunction:o,startObject:{angle:0},stopObject:{angle:a},delay:s,update:function(){var r=0;return function(e){var t=e.angle-r;if(t>0){i.rotate(Freedo.Cartesian3.UNIT_Z,t)}r=e.angle}}(),complete:function e(){d.cancelTween()},cancel:function e(){i.lookAtTransform(l)}});return function(){d.cancelTween()}}t.flyAround=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){var r=t.boundingSphere;var i=Freedo.Matrix4.multiplyByPoint(t.modelMatrix,r.center,new Freedo.Cartesian3);var n=new Freedo.BoundingSphere(i,r.radius*10);e.camera.viewBoundingSphere(n,new Freedo.HeadingPitchRange(0,-.5,0));e.camera.lookAtTransform(Freedo.Matrix4.IDENTITY)}t.gotoModel=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t,r,i,n,a){if(!(e instanceof Freedo.Scene)){throw new Freedo.DeveloperError("The parameter is not an instance of Freedo.Scene.")}var o=e.camera;r=Freedo.defaultValue(r,80);i=Freedo.defaultValue(i,5);n=Freedo.defaultValue(n,135);a=Freedo.defaultValue(a,55);var s=Freedo.Rectangle.fromDegrees(r,i,n,a);var l=o._mode;if(l===Freedo.SceneMode.MORPHING){o._scene.completeMorph()}if(l===Freedo.SceneMode.SCENE2D){o.flyTo({destination:s,duration:t,endTransform:Freedo.Matrix4.IDENTITY})}else if(l===Freedo.SceneMode.SCENE3D){var u=o.getRectangleCameraCoordinates(s);var d=Freedo.Cartesian3.magnitude(u);d+=d*Freedo.Camera.DEFAULT_VIEW_FACTOR;Freedo.Cartesian3.normalize(u,u);Freedo.Cartesian3.multiplyByScalar(u,d,u);o.flyTo({destination:u,duration:t,endTransform:Freedo.Matrix4.IDENTITY})}else if(l===Freedo.SceneMode.COLUMBUS_VIEW){var c=o._projection.ellipsoid.maximumRadius;var f=new Freedo.Cartesian3(0,-1,1);f=Freedo.Cartesian3.multiplyByScalar(Freedo.Cartesian3.normalize(f,f),5*c,f);o.flyTo({destination:f,duration:t,orientation:{heading:0,pitch:-Freedo.Math.acos(Freedo.Cartesian3.normalize(f,pitchScratch).z),roll:0},endTransform:Freedo.Matrix4.IDENTITY,convert:false})}}t.aerialView=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var v;function s(e,t,r,i){if(!Freedo.defined(v)){v=document.createElement("canvas")}v.setAttribute("width",t);v.setAttribute("height",r);var n=e.canvas;var a=n.width;var o=n.height;var s,l,u,d;if(i){s=l=0;u=a;d=o}else{var c=t/a;var f=r/o;if(c>=f){u=a;d=u*r/t;s=0;l=(o-d)*.5}else{d=o;u=d*t/r;s=(a-u)*.5;l=0}}var h=v.getContext("2d");h.drawImage(n,s,l,u,d,0,0,t,r);var p=v.toDataURL("image/jpeg");return p}function i(t,r,i,n,a){i=Freedo.defaultValue(i,128);n=Freedo.defaultValue(n,128);a=Freedo.defaultValue(a,false);t.requestRender();var o=t._postRender.addEventListener(function(){var e=s(t,i,n,a);r(e,i,n);o()},null)}t.capture=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e){if(!(e instanceof Freedo.Scene)){throw new Freedo.DeveloperError("The parameter is not an instance of Freedo.Scene.")}}function n(e){if(!Freedo.defined(e)){throw new Freedo.DeveloperError("boundingSphere is required.")}}function a(t,r,i,n){var e=new Freedo.Cartographic.fromCartesian(r.center);var a=e.height;var o=function e(){t.flyToBoundingSphere(r,{offset:new Freedo.HeadingPitchRange(i,n,r.radius*3),maximumHeight:a,duration:2})};var s=t.distanceToBoundingSphere(r);if(s>r.radius*5){t.flyToBoundingSphere(r,{duration:6,offset:new Freedo.HeadingPitchRange(t.heading,t.pitch,r.radius*5),complete:o})}else{o()}}function o(e,t){i(e);n(t);var r=e.camera;a(r,t,0,0)}function s(e,t){i(e);n(t);var r=e.camera;a(r,t,Freedo.Math.toRadians(90),0)}function l(e,t){i(e);n(t);var r=e.camera;a(r,t,Freedo.Math.toRadians(180),0)}function u(e,t){i(e);n(t);var r=e.camera;a(r,t,Freedo.Math.toRadians(270),0)}function d(e,t){i(e);n(t);var r=e.camera;a(r,t,r.heading,Freedo.Math.toRadians(-90))}function c(e,t){e.scene.screenSpaceCameraController._zoomFactor=t}t.flyToSouth=o;t.flyToWest=s;t.flyToNorth=l;t.flyToEast=u;t.flyToTop=d;t.setZoomFactor=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){var r=e.positionWC;var i=Freedo.Matrix4.clone(e.transform,i);e.lookAtTransform(Freedo.Matrix4.IDENTITY);e.look(r,Freedo.Math.toRadians(t));e.lookAtTransform(i)}function n(e,t){i(e,-t)}function a(e,t){i(e,t)}t.lookLeft=n;t.lookRight=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.setKeyboardV=t.enableKeyboard=undefined;var i=r(82);var n=undefined;var a=undefined;var o=undefined;var s=10;function l(e,t){n=e.camera;if(a){o();a=undefined}a=new i.FdKeyboard(e);o=a.on(function(e,t){if(e==="timer"){if(t.metaData[37]){Freedo.FdCamera.lookLeft(n,1)}if(t.metaData[39]){Freedo.FdCamera.lookRight(n,1)}if(t.metaData[38]){n.lookUp(1/180*Freedo.Math.PI)}if(t.metaData[40]){n.lookDown(1/180*Freedo.Math.PI)}if(t.metaData[65]){n.moveLeft(s/33)}if(t.metaData[68]){n.moveRight(s/33)}if(t.metaData[87]){n.moveForward(s/33)}if(t.metaData[83]){n.moveBackward(s/33)}}});if(t){a.enable()}else{a.disable()}}function u(e){s=e}t.enableKeyboard=l;t.setKeyboardV=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCameraHistory=undefined;var i=r(520);var a=u(i);var n=r(1);var o=u(n);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=r(165);var c=function(){function n(e){var t=this;(0,o.default)(this,n);this._camera=e;if(typeof e._cameraHistory!=="undefined"){throw new Error("Current camera has already create history!")}e._cameraHistory=this;this._cameraPath=[];d.extendObservable(this,{_cameraPathCurrentIndex:-1});d.autorun(function(){t._cameraPathCurrentIndex;if(typeof t._event!=="undefined"){t._event.raiseEvent("CameraPathChanged")}});this._lastHistoryOpFrameCount=0;this._delayRecordViewValid=true;function r(e,t){if(typeof t==="undefined"){t={}}t.position=e.positionWC.clone();t.heading=e.heading;t.pitch=e.pitch;t.roll=e.roll;return t}var i=this;this._delayRecordView=_.debounce(function(){var e=i._camera;if(i._delayRecordViewValid){var t=r(e);if(i._cameraPath.length>=10){i._cameraPath.splice(0,1);i._cameraPathCurrentIndex=i._cameraPathCurrentIndex-1}i._cameraPath.splice(i._cameraPathCurrentIndex+1,i._cameraPath.length-1-i._cameraPathCurrentIndex,t);i._cameraPathCurrentIndex=i._cameraPath.length-1;i._updateCameraHistoryStatus()}},1e3);this._delayRecordView();this._camera.percentageChanged=1e-4;this._cameraChangedEventListener=this._camera.changed.addEventListener(function(){var e=i._camera;if(e._scene._frameState.frameNumber<=i._lastHistoryOpFrameCount){i._delayRecordViewValid=false}else{i._delayRecordViewValid=true;i._delayRecordView()}});this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper}(0,l.default)(n,[{key:"_updateCameraHistoryStatus",value:function e(){this._event.raiseEvent("CameraPathChanged")}},{key:"prev",value:function e(){if(this._cameraPath.length==0)return;this._camera.cancelFlight();var t={};this._lastHistoryOpFrameCount=a.default;if(this._cameraPathCurrentIndex>0){this._cameraPathCurrentIndex-=1}else{return}var r=this._cameraPath[this._cameraPathCurrentIndex];t.destination=r.position;t.orientation={heading:r.heading,pitch:r.pitch,roll:r.roll};t.duration=1;var i=this;t.complete=function(){i._lastHistoryOpFrameCount=i._camera._scene._frameState.frameNumber};t.cancel=function(){i._lastHistoryOpFrameCount=i._camera._scene._frameState.frameNumber};var n=this._camera;if(!Freedo.Matrix4.equals(n.transform,Freedo.Matrix4.IDENTITY)){t.endTransform=Freedo.Matrix4.clone(n.transform);n.lookAtTransform(Freedo.Matrix4.IDENTITY)}this._camera.flyTo(t)}},{key:"next",value:function e(){if(this._cameraPath.length==0)return;this._camera.cancelFlight();var t={};this._lastHistoryOpFrameCount=a.default;if(this._cameraPathCurrentIndex+1<this._cameraPath.length){this._cameraPathCurrentIndex=this._cameraPathCurrentIndex+1}else{return}var r=this._cameraPath[this._cameraPathCurrentIndex];t.destination=r.position;t.orientation={heading:r.heading,pitch:r.pitch,roll:r.roll};t.duration=1;var i=this;t.complete=function(){i._lastHistoryOpFrameCount=i._camera._scene._frameState.frameNumber};t.cancel=function(){i._lastHistoryOpFrameCount=i._camera._scene._frameState.frameNumber};var n=this._camera;if(!Freedo.Matrix4.equals(n.transform,Freedo.Matrix4.IDENTITY)){t.endTransform=Freedo.Matrix4.clone(n.transform);n.lookAtTransform(Freedo.Matrix4.IDENTITY)}this._camera.flyTo(t)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"dispose",value:function e(){if(typeof this._cameraChangedEventListener!=="undefined"){this._cameraChangedEventListener();this._cameraChangedEventListener=undefined}if(this._camera._cameraHistory===this){this._camera._cameraHistory=undefined}if(typeof this._delayRecordView!=="undefined"){this._delayRecordView=undefined}if(typeof this._camera!="undefined"){this._camera=undefined}this._eventHelper.removeAll();this._event=undefined;this._eventHelper=undefined}},{key:"pathLength",get:function e(){return this._cameraPath.length}},{key:"currentIndex",get:function e(){return this._cameraPathCurrentIndex}}]);return n}();t.FdCameraHistory=c},function(e,t,r){e.exports={default:r(521),__esModule:true}},function(e,t,r){r(522);e.exports=9007199254740991},function(e,t,r){var i=r(17);i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTrackManager=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e){(0,n.default)(this,t);this._scene=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper}(0,o.default)(t,[{key:"trackByBoundingSphere",value:function e(t){this._scene.screenSpaceCameraController.bimTrackByBoundingSphere(t);this._event.raiseEvent("beginTrack",t)}},{key:"cancelTrack",value:function e(){this._scene.screenSpaceCameraController.bimUnTrack();this._event.raiseEvent("cancelTrack")}},{key:"isTracking",value:function e(){return this._scene.screenSpaceCameraController.isTracking()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"dispose",value:function e(){this._scene.screenSpaceCameraController.bimUnTrack();this._eventHelper.removeAll()}}]);return t}();t.FdTrackManager=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdZoomByRectangle=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);var h=r(5);function s(e){return e&&e.__esModule?e:{default:e}}var p=new Freedo.Matrix4;var v=new Freedo.Cartesian2;var l=new Freedo.Cartesian3;var u=new Freedo.Ray;var m=new Freedo.Cartesian3;var d=function(){function t(e){(0,n.default)(this,t);this._viewer=e;this._enabled=false;this._leftDownPosition=undefined;this._currentPosition=undefined;this.registerHandlers()}(0,o.default)(t,[{key:"registerHandlers",value:function e(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.onMouseLeftDown.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(this.onMouseRightClick.bind(this),Freedo.ScreenSpaceEventType.RIGHT_CLICK);this._handler.setInputAction(this.onMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"updateQuad",value:function e(){var t=this._viewer.scene.canvas;var r=this._viewer.cesiumWidget._resolutionScale;var i=this._leftDownPosition.x;var n=this._leftDownPosition.y;var a=this._currentPosition.x-this._leftDownPosition.x;var o=this._currentPosition.y-this._leftDownPosition.y;if(this._currentPosition.x<this._leftDownPosition.x){i=this._currentPosition.x;a=-a}if(this._currentPosition.y<this._leftDownPosition.y){n=t.clientHeight*r-this._leftDownPosition.y;o=-o}else{n=t.clientHeight*r-this._currentPosition.y}this._logoQuad=new Freedo.ViewportQuad;this._logoQuad.rectangle=new Freedo.BoundingRectangle(i,n,a,o);this._logoQuad.material=new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,1,1,.5)}}});this._viewer.scene.primitives.add(this._logoQuad);this._viewer.scene.requestRender()}},{key:"deleteQuad",value:function e(){this._enabled=false;this._leftDownPosition=undefined;this._viewer.scene.primitives.remove(this._logoQuad);this._viewer.scene.requestRender()}},{key:"zoomByRectangle",value:function e(){var t=Freedo.Cartesian2.lerp(this._leftDownPosition,this._currentPosition,.5,v);var r=h.FdMisc.FdGeometric.pickPosition(this._viewer,t);var i=h.FdMisc.FdGeometric.pickPosition(this._viewer,this._leftDownPosition);var n=h.FdMisc.FdGeometric.pickPosition(this._viewer,this._currentPosition);var a=this._viewer.scene.camera;if(Freedo.defined(r)&&(Freedo.defined(i)||Freedo.defined(n))){var o=Freedo.defined(i)?i:n;var s=Freedo.Cartesian3.distance(r,o);var l=s/Math.tan(a.frustum.fov*.5);var u=Freedo.Transforms.eastNorthUpToFixedFrame(r);var d=Freedo.Matrix4.multiplyByPointAsVector(u,Freedo.Cartesian3.UNIT_Z,m);var c=Freedo.Cartesian3.multiplyByScalar(d,l,new Freedo.Cartesian3);c=Freedo.Cartesian3.add(c,r,c);var f=Freedo.Matrix4.clone(a.transform,p);a.lookAtTransform(Freedo.Matrix4.IDENTITY);a.flyTo({destination:c,orientation:{heading:0,pitch:Freedo.Math.toRadians(-90),roll:0}});a.lookAtTransform(f);return}}},{key:"onMouseLeftDown",value:function e(t){if(!this._enabled){return}if(!Freedo.defined(this._leftDownPosition)){this._leftDownPosition=Freedo.clone(t.position,true)}else{this.zoomByRectangle();this.deleteQuad()}}},{key:"onMouseRightClick",value:function e(t){if(!this._enabled){return}this.deleteQuad()}},{key:"onMouseMove",value:function e(t){if(!this._enabled||!Freedo.defined(this._leftDownPosition)){return}if(Freedo.defined(this._logoQuad)){this._viewer.scene.primitives.remove(this._logoQuad)}this._currentPosition=t.endPosition;this.updateQuad()}},{key:"start",value:function e(){this._enabled=true}}]);return t}();t.FdZoomByRectangle=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMouseHandlerCenterIcon=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAwrUlEQVR42uyde3yU1Z3/37lgmNxMkJArZAJJlRAuCQa5iBi56Na1VasQu6hsF7ev2ro/tnVpdVWqddeWXpZdV/bVle2i0hrQel1tq1BE5CIRwjWoCWQiJCQBSQi5gCSZ3x/nTDNEkmfyzPNMZpLv+/Wa12ueyZO5PM/3fM453/P9fk+Y2+1GEIShSbhcAkEQARAEQQRAEAQRAEEQRAAEQRABEARBBEAQBBEAQRBEAARBEAEQBEEEQBAEEQBBEEQABEEQARAEQQRAEAQRAEEQRAAEQRABEARBBEAQBBEAQRBEAARBEAEQBEEEQBAEEQBBEEQABEEQARAEQQRAEAQRAEEQRAAEQRABEARBBGDQM0a+m2AVYW63W65C8BIJTAXygcn6kQfEB+n3bQYOAvv0owzYDXTIrRQBEHwjF5gOXANMA6Zc6r4F6Xe/lDHtBXYBHwI7gXK5xSIAwsXMAK4DZgOzgASj+xZCAuBNE7AN2Aq8D+yQWy8CMFQpBG7Qj+uBy3o57xzwO2CjHlYfA84G6W+KA0brqco84JvA8F7O/QJ4D/izfpSKSYgADHYygBv1YwFweS/nvQm8qofMLqA9RH+vA3DqKc1twC29nHcGeAf4k34cF1MRARhMXAvcrB8TeznnWd3odwMnfRhOh5ytAUkop+ZtwH29nHcAeEs/PhDTEQEIVSKAr+vH13qZ1z8HrEc5yT4fYtfnCpSTcxFwby/+gjeA1/WjU0xKBCAUiAG+AdyuG39PSoFngE1AzSDs6c2MDNKBucB3tW+kJ68DrwC/B1rFxEQAgrXhLwTuBP7qEn9fDbyAWhY7J5frkgxHLXveDdx/ib//AXgJ2CBCIAIQTNylHz2dXF8Aj+je66j09v0aFYzVo6gn+fIKyZvAi/ohiAAMGDcBi4G/6fF6A/ConsPWyWXyixSUD+UnwKgef/stsA74o1wmEYBAMgnluLoHGNmj4T+ke6iTcpksJUmPsJ7qIQSngOdRDtX9cplEAOye538L+FtUfL43D+j5ab1cJltJRvlZnu7xehnwv8BvxD8gAmAHc4GlQHGP158E/gcVsCMEDifwdygfizclwBrUKosgAuA3I4C/148sr9dfBn6qe54uuUwDQrgeif0IuMPr9Srgv/XjtFwmEQCzXA98B7W85z3P/y4qUq1dLlFQ4EBFWT7Twz+wAfgvVM6BIALQL76rH+O9XvuFnnt+JpcnKBmD8sU86PXaYS0Mz8jlEQHwhRxtRA94vXZEi8EmpLhFsBOJ8tc8A4zzev1p/aiQSyQC0BsLgP8HfNXrtVXAr1BpuELoMBr4PrDM67W3gX9HZR4KIgAXsRT4R1RFHg+LUHHo5+XyhCRRqHyM9V6vlQP/hlopEAEQASBazxl/QHetvXeBf0IV4BBCn8nAz4H5+rgZ+CXKp9MmAjB0GQMs1/N7D0/pHiIUIvnCtWjFAbGoFNss/bvSUGG0SahoxURUARKHwXu2owp0NKKi7E6iwplrUc7PKlTqcguqMlEzobEMmqRHeA95vfYMsJIh7NQdygIwGfghKonHw716uBisQ/4wVFzCCN24J+kpSzYqeWYs9pd670IlNh0FKvWQer8WidP6EaxGFaWndc95vfYi8LOhOtobqgJwre4JPM6+U6i1/veC0HgvQ4W/pqKq6RQCE/QjJki+YytwSD9KUVWNTqDCor8IQhG9HhUj4MnjeFuP/D4QARj8zAf+GZijj3eiovwOBNnQPkMP569FVQ2egiqcEQrUoOoe7NCNqgpV5y+YpgoTUZGC0/XxFuBfUP4fEYBByleBx1A190El7/wTUB0k32+EbvSzUWvZhbr3D2Xq9ahgE6oceBXBE56biXIO3qmPPwSe0CMCEYBBxl8DK4Cr9fFq4McEh7NvjO7hv657+/GD9B4c1qOC1/UIIRicb0naDjwViD4CHgf+TwRgcPX8j3s1/p+hEnmaBvh7fQWYiUpkmYny1A8FGoHtqISq7cCnA/x9ElAJRT/0EoEVQ2EkMBQEYD6qmoxn2P84av23ZQC/05WoDUEW6jnocIYm51A+mA2ozUE+GcDvEouKB1nhNR14dLD7BAa7AFyLytef49XzPzmAjT8LKEItN04bwg3/UkKwC7U8t1n7CQZKBB7xGgls0ccfiACEHpOBf6V7qW81yvs/EMP+kVqM7tcjEct29+3s7Oxqa2traWxsbGpsbGw+efLkmfr6+jM1NTVn6+vrW+vr69tqa2vbT5w4ca69vd0nL7zD4QhPTU0dnpaW5khOTo5OTk6OSU9Pj0tOTr48KSnp8sTExPjExMSE6Ojo2IiICCvjDpp1z7taN7pTAzQd+Bcvn8DbwMMM0jiBwSoAY/Qc3xPk8xIq2i/QDr9wlFPvW6hS4an+vqHb7aa9vb21vr7+5PHjxxsqKysbKioqPq+qqmo+evRoa319va1BTMnJyVFjx46NycrKis/JybkiOzt7VEZGxqjk5OQkh8MRExZmyb6lJ1AlwH+DchoGevkwCRUl6FkdeFH7CD4TAQh+olHhnZ7w3p2oMl6BXurLRJW1/haQ528v39ra2lJTU1NbXl5+vKysrLa8vLyxoqKi5ezZswOanhwXFxeZk5MTm5ubm5ifn5+Wm5ubkZ6enhYTE2PF6OCgFoFXBuj+ldAdJ/AMKmy8TQQguHkM5ehDDyFvILBBPmGodfzvoyLOLjf7Rm1tbW0nTpyoKysrO7Jt27bP9u3bd9rlcrV1dQVn6H14eDhOpzN68uTJI2bNmjUmPz9/XGpqakp0dHS0H297BhWh+StUHEEgDXYiyjnpiRhcgYoTEAEIUpaisrw8c+wbtFMpUKToYeN3MLmW39XV1dXY2Hi6vLz86JYtWyo3bdpUU1tbe+78+fMhVXcwKioqPC0tbfjcuXPT58yZk52bmzs2MTFxRHh4uNlRwWFUea+XCOxeC0VaBDw+ih8wiFKJB5MALEBl8Xny+e9FbcUVqB+Yp3v9W7h4rwBfh/mddXV1dWVlZRWvvfba4W3btp3y1WkX7DgcjvBZs2aNvPXWW8fn5+fnpKSkpERERESYeKtTqD0XfqWnB4Ea0d1NdwJROSqr8B0RgOAhB1W5x+Pxf0pPAwKV1eeJNZiKKknVr4ZfU1NTW1pa+snLL798eMeOHYO6iu2MGTNG3HHHHeMLCwuvTE9PTzMhBB2oZKNArtFH6eG/J5X4bVSloQoRgODgP+iu4fcuaquuQHj841AOxgdRUX0+43a7qaurO1FaWnq4pKSkfPv27UNqe/CZM2deUVxcnFtYWDg+JSUl1cTqwaeogK4SVF0Cu0lCbUXmKSryNPAPIgADz3eB//Q6nkJg1mxTUGvFf4cqvuEzzc3NZ/bu3fvxCy+8UPbuu+8O6Z2E5s+fn3z33XfnT5ky5ar4+Pj+OkxrUZuyrA6QX2AyKofBw/cI8WrDoS4A1+ub73G4LUKFldrNWNSS0EL6Eb/f0dHRceTIkar169d/uGHDBldLS0snArGxsRELFy50Llq06Jpx48ZlRUZG9mca1ajv+UpUkRK7WUh3jcHDuhN4TwQg8IxAeYU9m3asQgVr2D3vH4/KHvtrVMyBTzQ1NTVu3LixdO3atYcOHjzYLM3+y+Tl5cUvWbJkwrx58woTEhL6kxjVhsre+7FulHb7A35Kd7XhDahVn9MiAIHlRyhnH6i6/UXYX7o7D5VPMB8Y1p9ef926dTs2bNhQHWrLeYEmKioqfOHChZmLFy+e0c/RwAWU/+eH2L9CMBq1vOzZd+AhLQoiAAFiLvAs3Xv13QT8yebPnIhafioCfPJct7e3t2/duvWjX//613t2797dJM3bd6ZOnZrw7W9/u2D27NlXOxwOh4//1qkb5vexP/jrRuCP+nkVcB8huCFpKApADCoQw7NL7y+0AtsZEpuHijG4AR+LbjY1NTW++OKL761evbp8oMN1Q5W4uLjI+++/P/euu+66vh9Tgi5U4M4/2jwSiNQjUM82ZCWoQLRWEQB7eQC17Adqo85C7E3SGK9F5kZfen632011dXX1mjVrtqxbt24g0lqb9Xy0UV+fJm2U7fpx3uVyXbjUPzqdzmF6juvQjxhUdtwolLNzBBZmMvrK4sWLs5YuXTonMzMz08flwk49InzQZp/AGFS5M8+GpP+AWh4UAbCJScBa1JbQoMJuX7bx87L03O42X+b8XV1dXQcOHChftWrV+5s3bw5U5uF51HLYMf1oAM65XC5LnaFOpzMKVb9glJ4Dj0Ytf0YF4kcWFRUlLVu27LqJEyfm+hhOfAF4VfuK7BTiO1DhyaC2il+CKpMuAmADv9TzO3TDvwf7tuhOQXmV78YHb39HR0fnzp0796xcufKD/fv32+3lb9ONvgKVJVfvcrkCeiOdTmcYqmBpJioSM41+rIqYUv9Jk+KXL19+7fTp0wsiIyMjfLxOL+j7aFecgAN4XgsB2k/0AxEA67lJ30xPnP3VqJBQW6afqGrB38OHdf6Ojo6OzZs373zyySe3V1dXt9t4Dep1oz8MNPQ2lA80euowSk+XcrCxknFmZqbjkUcemVlUVDTdxxWCRlSg2M+xL2JwKqqOIKh8hbvpdhCKAFjEOlSIL6iyXiuwr1DEfbrXSPOl8b/zzjvbHn/88R02FePoQtXZ3wccdrlcQe1kcjqdMVoIJqP2MbB8p6Lk5OSoFStWzFiwYMEsH0WgVt/PZ2362eGo3JNH9PFvgcUiANZxF/C7HnNzl02fNRcVXZiDygQzbPyPPfbY9lOnTtmxA84xVK28T62e0wdACKJQ+RHTtL/AUkaOHHnZE088MdNHEXDrkdP92LdU5+zha/gmqpKQCICfxOgLeYs+foCLY/+tZKLuJab50Pg7N2/evOOxxx774MSJE1Y3zgaUd/mgy+VqJ4RxOp0O1DJqId3ecktITU2NeuKJJ64tKiqa4YNPwK3F9D7sixH4Ht2rAG/qjqtVBMA//hZVFsrTMCbpubDVpOqpxb0YLPd1dXW5t2/f/tGjjz76XlVVlZUlos6hkk0+dLlcjQwinE5nIqog6hQsrIaclZUV/ZOf/OT6mTNnXh0eHm60RtiJyut/BFV30PLZCWoFwCN03wL+N5jvS3iQ200M3YUZQQX82NH4w4BvAF8zavxut5sDBw4cWrly5QcWN/7jqOWkPw22xg+gf9Of9G88btX7VlVVta1cufKDAwcOHPKhM4vQ9/gbRiM8k9Rz8fbjdxI8G7iGpAB8A1VN19P7v2nT51yHSis2rORTXV1dvWrVqvctXOrrQFW+LXG5XEcCvZwXYBFwu1yuI6iouR1YFL25f//+5lWrVr1fXV3tS+HQkfpeX2fTz3xT2yradr8hAmCOCFRVXQ+PYk+Rj0xUbMFVRic2NTU1rVmzZouFQT5ngNeAd1wuVwtDBP1b39G//YwV77l58+aTa9as2dLU1NTkw+lX6XueacPPO6lt1cPt+Jg7IgJwMV/XD1B7zL9h0++/zZfeoL29va2kpOQ9C8N7jwEvu1yug4O51zcYDRxEBXRZksW5bt26qpKSkvfa29t9mZpdp++9HW3gDW2zPe1YBKCfAuDhEayP5ApD1Xy/DxXv3vsYvaOjY+vWrbuffvppq5JLyoFXXS7XMYY4+hq8qq+J3zz99NMHt27durujo8NoepGg7/10G/wBdXTHBCAC0H+u1c4aD6/Y8BkjUOW8co1OPHr0aNWzzz5b1traakUFn93AWy6X6zSCRwROA29hQWRna2tr57PPPlt29OhRX0ZqudoGRtjws7xt9mvapkUAfORmr155NdaXegrXN+QmoxMbGxsbn3/++R2lpaVWeOY/RHn5W6XZf0kEWlGrBB/6+16lpaWNzz///I7GxkZf7tlN2hasbgtHte16Rhs3iwD4RkaPi2VHbf/RqICiPkN9Ozs7Ozdt2lS6fv16l5+f50ZtUfauy+X6Qpp7ryLwBaqqz05/7/n69etdmzZtKu3s7DQataVpW7A6WtGtbde7U8sQATDmRlREHqhouL0Wv38EMA+VwNEnlZWVR9euXXvowoUL/gpQGfBnl8slhUGMRaADVdCjzJ/3uXDhgnvt2rWHKisrfRk9TtU2YbW3fq+2YbRN3ygC4JsAeHgGFR1nJeNQEVoJfZ109uzZ5pKSkg8tKOBZDmyUnr/fI4GN+OkYPHjwYHNJScmHZ8+eNbqHCdomxln8U85xcdlwEQADClFbfHmwOnEjEpXsM6nPsZvbzd69ew+XlJT4u+R3TA/726RZ91sE2vR0wK+VkpKSkqq9e/ce9iFKcJK2jUiLf4q3DS/QNi4C0As30L2b7nOoNFgrcaJSimP7Oqmuru7Ec889t8fPvfnOogJ8GqU5mxaBRlTAkOk8/vb29q7nnntuT11dnVHsf6y2DafFP6OG7n0FL9c2LgLQhwB4WI+1zr8IYBYqT71XOjo6OkpLSz/euHFjgx+f1YHy9h+TZuy3CBxDrQ6Y9p9s3LixobS09GMfYgMmaxux0hfgpnsjEUQAemcGaqcfD7ssfv9kVI52n71/bW3tiXXr1vmbLlqKRYEtwl/8KKX+vMG6desO1NbW+jIK+CbWVzTytuXrta2LAPTgOuAy/fxZwMrNMsNQJcQKfOj9P9m1a5c/w/bjwDaXyyUbgFg3CugCtuFHFuGuXbsaS0tLP/FhFFCgbcXK6MDP6a5GdBn2JSKFtADM9nr+qsXvfTlwKwbZfg0NDQ0lJSX+9NzngM1DKbEngCLQgtr0w/SqUElJSXlDQ4PR1G6ktpXLLf4Jr/Zi6yIAqJDMWV7HVhf7zAZm9nVCV1dX1549ez4pKytr8uNz9mJfqTJBXdu9Zv+5rKysac+ePZ90dXUZjc5mapuxEm+bnoUPIehDSQCm070u/ybWpv0OQ4V6fqWvk5qamhpfeeWVjzs6Osw6Hk8BO10ul+z4a98ooBMVJXjKzP93dHS4X3nllY+bmpqMpnhf0TYzzMKvf5LuehYJ2uZFADTX9BgqWen9T0Jt5tnnnO7QoUOVu3btMut36ESV8WqSZmq7CDSh8gVMCe2uXbs+P3ToUKXBaWHaZpIs/OruHtOAa0QAFJGoIpwedlr8/jkop06vtLW1tW3ZsqWypaXFbO9dh/2bUQrdHMBkenhLS0vnli1bKtva2oyCs67WtmMl3rY9DeuDjkJSAKaiCkWCcvBYOYeO0kO5PqvR1tTUnNi0aVOtPzfW5XKdk3YZsFHAOX86ik2bNtXW1NQYLQmO0rZj5dZnLrqdmFPwIR9lKAhAvtfz32HtVl9JGDj/3G63e9++fUeOHTtm9nOPoWrOC4GlApNhwseOHWvft2/fEbdxfPBMi6cB7Vy8v0W+CMDFkXkbLX7vNAzW/ltaWs5u27btmB/Ov73S+w/YKGCvmf/t6Ohwb9u27VhLS4tRiHEBPuwO1U829mL7IgCo7a+sIkIPsVL6Oun48eO1e/bsMev8a8De7aeFvjlMdwXefrFnz57Pjx8/bjTtS9E2ZGVo8D4RgG7GoHaN8R5OW0UCFzsXLzX8p7y8/Fhtba3ZHvxTyfQb0FFAG/Cpmf+tra09V15efsyHLMFpGKSOm5gyesjTbWDICsBnQDxq2SUMa3dvTQQm9Dkha29v3bNnT63Jgh/t0vsHzSig3/6bCxcuuPfs2VPb3t5uVJ5tAj7sEN0PznrZe7xuA0N6CmAXaRhEW9XX1zccPHjQbNx/jdnhp2ApDZhMGz948GBjfX290T3MtcEPEDQMVgGI1MOrGIP5/8kjR46YjduvcLlcF6T9Dfg04AImV2GOHDnScvz4caOo0xhtS5EiAKFDrNHwv7Ozs6uysrLBZPDPeaBaml/QUK3vSb9oaWnprKysbOjs7DTKDZiAQRq5CEBwEYdBFFdra2tLZWWlWe9/rQz/g24aYCqQq7Ky8vPW1lajUWCOtikRgBAhBoMCj42NjU2VlZVmC34el3z/oJoGdGGyVkBlZWVzY2Njk8Fp4wjyXX5FAC7mCgzqvDc1NTVXVFSYWXVwY+1ypWANxzCRRFZRUXG2qanJqCMYrW1KBCBEGIdBKuepU6eaT58+bcaJdxbr9ykU/KcOE8vIp0+fvnDq1CkjARiG9SXDRQBsxHCXl9ra2iaT7/051u9VIPjPOUyWkfPRFkaLAIQOhuu2J06cMBt01CSbfASlH+ALwJSo+2gLaSIAoUOK0Qn19fVmN+gU73/wYure+GgLKSIAoUOSDzfdbAx/k7SzoKXJpAC0WWFTIgDBw0gf5n1m8/9la+/gxdS98dEWRooAhA4jfFD98ybfu13aWdBi6t74aAsjRABCB8Oa7q2trZ0iACIA/bCFy0UAQofhNr73eWlnQcv5ELUpEYBQQTIA5d6IAAiCIAIgCIIIgCAIIgCCIIgACIIgAjBYcTqdw+QqyL0RAQhu7EzXjRKzCVqiQtSmRAAs5ozRCTExMWZ3e3FIOwtaTN0bH23hjAhA6HDa6ITk5OQoEQARgH7YwmkRgNDhlNEJaWlpZhtyjLSzoMXUvfHRFk6JAIQORps9kJycHG3yvROknQUtpu6Nj7ZwUgQgdKjz4aab7clHSTsLWkaZFIAYK2xKBCB4MNwkIjU11exGDwlOp/MyaWvBhb4npkYAPtpCrQhA6GBYtz8tLc3sUP4KBmlqaIgzHJO1+320hWMiAKHDEaDP1NCRI0fGjxgxwkzgSByDtEBkiJOCie27RowYMWzkyJHxBqdd0DYlAhAifG6k2AkJCfE5OTlmpgFhDNIa8SHOaH1v+kVOTk5cQkKCkQAcw+SeAyIAA0OrkWInJiYmZGdnx5t8/wyn0ylh1MEz/w8HMsz8b3Z2dnxiYqLRFOAIg7QY7GA14rMY7BkfExMTm52dbXa/tzRkNSCYGIXJjTuys7OviImJMdr6uwIT246JAAwcLcChvk6IiIgIz87OHhUbG2smJDgKyJR2FzRkYiIPIDY2NiI7O3tURESEUTs4pG1KBCBE6AAOGg3bMjIyksaNGxdr8jNyJPssKIb/w4AcM/87bty42IyMDKMNP1q1LXWIAIQWtUB5XyckJyePysvLSzT5/ukyDQia4X+6mX/My8tLTE5ONrqH5QzSGIBgEIAxQDNqX3c3JpZx+qDRaBrgcDhiCgoK0oYNGxZm4v0dwHhpfwPOeEwkAQ0bNiysoKAgzeFwGEUBHtK2ZBVxXvberNvAkBWAz/TwyoOVy2tNwK6+TggLCyM3N3d0Wlqa2cCerzidzmhpgwM2/I8GvmLmf9PS0obn5uaODgsz1P5dWLsfpLeNH9RtYEhPAfZ5PZ9s4ft2ArsxiOHOyMhIKygoMLsaMEpGAQPe+5uahhUUFFyRkZFhtHJQp22o08LvPLkX2xcBAObZ4AfY09cJsbGxcbNmzRodGRkZZvIzpjidTgkNDnzvPxyYYuZ/IyMjw2bNmjU6NjbWaMq5x4b5/zwRgIsp83r+TawtuHES2G4wDQibPHnyuNGjR5v93NGY9EILfpFjdso4evRox+TJk8eFGY//t2NtGrBD2/ilbH/ICsBuYK9+PhxwWvje54EPgIa+TkpPT0+dO3dumh+fM11GAQHv/aeb/f+5c+empaenpxqc1qBtx8r9Bp10J5Lt1bY/5AWgg4udddMtfv8K4KO+ToiOjo6eM2dOtsmgIFCJKBOlaQaMiZhMyIqNjY2YM2dOdnR0tJHz9iMMoknNdBRez3cRBLEFwRIH8KHX89swkdRhMA14F7Xs0isTJkzInjZtmllnYARwjdPpTJC2aXvvnwBco695v5k2bdoVEyZMyDY4za1txsrhf5i27UvZ/JAXgJ10L7XcAiRZ+N4X9FDu075OSkhISLz99tuv8sMZOFJPBSKkmdrW+CN0LzrSzP9HRkaG3X777VclJCQYBX99qm3Gyt2Gk7Rto219pwhAN+XANq/jqRa/fyUGzsDw8PDwgoKCK/Pz8/3pxadY7MMQvjyHnmL2n/Pz8xMKCgquDA8PN7L77dpmrMTbprdhEKU61AQAYGuPaYCVnAFew6Cy66hRo0YVFxfn+vE5w4Eip9MZK23V8t4/FijCj2pMxcXFuaNGjTKKGzilbcXqfQBu68XWRQA07wNf6Of3YbK8Ux9zuo8wiAmIjIyMLCwsvHLatGmJfnxWBjBL6gVY2vjDgVmYzPnXc//EwsLCKyMjIyMNTt2jbcVt4U+4Qts02sbfFwH4MjuA97zvmcXvXw/8DoO0zrS0tNTFixf769EvBHKl6VpGrr6mplm8ePHEtLQ0o6W/Fm0j9RZ/f29bfk/bugjAJfiz1/NFWLsa0KnnXvt8GAVcNW/ePH8y/SKBG51Op5QO87/3Hw3cqK+pKebNmzeqsLDwKh96/33aRqwM/Q3TtnwpGxcBuIQAeOZe92IyzbMPXMBvjUYBKSkpqffee2+Bw+Hw5/rEAQucTmeiNGPTjT8RWIAfWaIOhyP83nvvLUhJSfGl9/+tthErSde2jLZtEYA+KAXe8Tqea/H7dwCbgP19SnZYGFOmTBlfXFyc5efnjQbmS8agqcYfDczHzwzR4uLirClTpoz3Ietvv7YNq4NzvG34HW3jIgB98Cev59/F+hr8R4DfYJDiGRcXF19cXHxNXl5evJ+flwvMk81E+tX4L0MlzfjlR8nLy4svLi6+Ji4uzugeNmmbsLr093Btw5eybRGAPgTggH5eiB/rvn34AjbiQxx2dnb22CVLlkwwWTDEm3zgBqfTGSnN27DxRwI36GtmmmHDhoUtWbJkQnZ29lgfTt+tbaLT4p8zhW7n5QERAN84DrzldXw31joDQdV5fxqDVM+IiIiIuXPnFi5atMjp5+eFoSLY5stIwLDnn6+vlV/3fNGiRc65c+cWRkREGEVm1mpbsHrnnzBtux7e0rYtAuADb3kN0e8Hxlr8/l2oUM8/Gp2YmJiYeM8998woLCy0wpl3DWp1QLYY/3Ljj0F5+6/x970KCwsT77nnnhmJiYm+3LM/alvosvgnjdW265livBWM1z1YBeAD4A2v49tt+IzTwP/gQ0jm2LFjs+677778mJgYK+L8pwI3O53OEdLs/9L4RwA3Y0EIeExMTMR9992XP3bsWF8cuOXaBk7b8LO8bfYNbdMiAP3gda/nT2L9fnxuVELGsxg4BCMjIyNnz5499YEHHsiz6LNzgdskTuAv6/y3YVHg1AMPPJA3e/bsqT6s+Tfpe78Ta6P+0Lb6ZC+2LALQDwHwXLjLgK/Z8BldwKv4EJrpcDiii4uLr1+8eHGWRZ89GrjD6XTmOZ3OsCHY8MOcTmcecAcWFYNdvHhxVnFx8fUOh8OXZdf39b3vsuHnfU3bbE87FgHoB53AK17HP8HaNGEP1cCvgI+NTkxISEhYunTpnKKiIqu+x+XAraiAodgh1PhjUQE+t+pr4DdFRUVJS5cunZOQkJDgw+kf63tebcPPS9K26uEVrF9dGBICAPB74A/6+Si686mt5n3gGQyyBQEyMzMzly1bdt2kSZPiLfrsSGAGUOx0OscN5tGA7vXHAcX6N1uyLDpp0qT4ZcuWXZeZmenLdm2n9L22KyHnFrorFf9B2zAiAOZoBV7yOn4KSLbhc9z6Rr1hpNZhYWFMnDhxwvLly6/NysqyMsIvA7gTtUqQOAgbfyLKy38nfmT19SQrKyt6+fLl106cOHGCD9F+nfoe/96GeT/aNp/yOn6JIN9VOBRSVjcAb3qNAu606XNOAKvwIRU0PDw8bPr06QUPP/zwjNTU1CgLv4On2OVdTqez0Ol0OgZBw3c4nc5C4C792yyL7ExNTY16+OGHZ0yfPr0gPDzcqPV7UsJX6XttB3d69f5vatsNasLcbnco2NFdqDTNvwg/1idteJgLrEaVne7TqDo6OjreeeedbY899tj2U6dOfWHDdzmGKh75qcvlOh9iDT8KtWvPNKzd8QmAkSNHXvbEE0/MXLBgwSwfPP5uVIHP+1Hx/rb8ZKDK6/ibwIsiANaxDvgb/fxJYAX2eHBBFW/4MT7sOe8Rgccff3xHfX29HY20C6hBpaoedrlcrUHe8GNQO/ZMRmXCWT7KTE5OjlqxYsUMHxs/qGi/H6OW/ewaST8OPKKPfwssDoVGFUoCcBPwAt0FIa/GvrrqccA/Ad8DEn0Rgc2bN+988sknt1dXV7fbeA3qdU92GGhwuVwXgqTRD6N7m7Qcm/w0AGRmZjoeeeSRmUVFRdN9bPyNwH8CPwfO2vS1ptJdev4UKgT4jyIA1vNL4Pv6+cvAPYBdDS5F9xp3A9E+iEDnzp0796xcufKD/fv3N9t8Hdp0r1aBWsqqd7lc7gA3+jDd0DN1o0/z5Tr5w6RJk+KXL19+7fTp0wsiIyMjfLxOL+j7WGfT13IAz6PiGUAtL/4gVBpUqAnAJGAt3Zlid2ohsIss4KeoSLVhhmP1rq6uAwcOlK9ater9zZs3nwzQNTmvxeCYfjQA56z2Geg5/XDd04/WjzQgKhA/sqioKGnZsmXXTZw4MdeHqr6gSnq/Cvyox9zcau6ge6WqDFiCQb0JEQD/eAD4D/28AZVuaecWy+OBX6CWsAx7HbfbTXV1dfWaNWu2rFu3rmoArk8zKra9UV+fJtRSVLt+nO9t6qCH8lG6V3MAMUCCbvSJwAggPtA/aPHixVlLly6dk5mZmenDUh+o5b4/AQ/q6ZJdjEEV+PB4/v8BlVmICIB9xABrUMEk6Mb5EPZus5QH/BsqT90np1ZTU1Pjiy+++N7q1avLz54924HQf0dMXFzk/fffn3vXXXdd78NmHn8ZiKHKbv0jcNDGrxeJWvN/UB+XAEsJ8nX/wSAAoJbqntVDdFAOQruLLUzU87sifNyWqr29vX3r1q0f/frXv96ze/fuJmnSvjN16tSEb3/72wWzZ8++2uFw+BoP0Qls1n6iAzZ/xRvpdvRVoVaONoXadQ5VAUDP7TxRV0d0wzxm82fmAT9DFa0Y5ss/dHR0dBw5cqRq3bp1OzZs2FB9/vz5LmnevRMVFRW+cOHCzMWLF88YN25clo+efs+c/13ghzb3/Gj/x2ZgnD5+SPuKEAEIHCOA/wIW6uNVWhTsDpgZj/Iq/zX98Ho3NTU1bty4sXTt2rWHDh482CxN/RLqmpcXv2TJkgnz5s0r7MeQH5S3///0fTls89eM0o19mT7eAHwHe2oKiAAYcD0qam+8Pl5EYMIvxwLLtfj4bKie0cD69es/3LBhg6ulpaVTmr3asnvhwoXORYsWXdPPXh+Us3MDsBI4GoCvuxBYr58fRkUXvheq1z7UBQBU1dX/9DqegsHmHxaRom/+3+FDxKA3zc3NZ/bu3fvxCy+8UPbuu+/WD+XGP3/+/OS77747f8qUKVfFx8f3NzW4FlXRZzX2rfN7MxnY63X8PVRmISIAA8t/oJYH0fPAv8Havd17Iw61GvEgKu7dZ9xuN3V1dSdKS0sPl5SUlG/fvv3zodTwZ86ceUVxcXFuYWHh+JSUlFQfl/e8+RS1AlSCfRF+3iShQnzn6+OnUct+iAAMPDnaB/BVffwUKjY7UAk081FFIKbSzxz3zs7OzpqamtrS0tJPXn755cM7duw4PZgb/owZM0bccccd4wsLC69MT09P86Fq75dmUqgQ8Ee12AeCKFTuyUP6+G3tA6gQAQgeFqDW6j215e5FhYEG6gfmoZafbqE7X6FfQlBXV1dXVlZW8dprrx3etm3bqfb29kGxYuBwOMJnzZo18tZbbx2fn5+fk5KSkmKi4YOKs38TtRx7MFBtBBUO/pw+LkfFGLwzGO7NYBIAUIEYv6Q7Wu0G1HJNoEhBhSd/h27HZL/o6urqamxsPF1eXn50y5YtlZs2baqpra09F2rLh1FRUeFpaWnD586dmz5nzpzs3NzcsYmJiSN8DOO9FIdRqz4vBWi+76GI7v38mlFx/msGS4MZbAIA8Jge/nt6jBuwPyikZ48xW48GrsePmndtbW1tJ06cqCsrKzuybdu2z/bt23fa5XK1dXUFpxaEh4fjdDqjJ0+ePGLWrFlj8vPzx6WmpqZER0f7kyR0BuVl/xWwNYAjOlDBX3/2GtGtAJ4YTI1lMApANGpJyLMn206Uo646wN8jE1Ub/lt6emCazs7OrtbW1paampra8vLy42VlZbXl5eWNFRUVLQMdZhwXFxeZk5MTm5ubm5ifn5+Wm5ubkZ6enhYTExMbERHhby2Ag6g9+14ZoPtXgqpiBMrbvxwVcyACEOSMQQVr3KWPX9KCcDLA3yMcVfzyW8BfAan+vqHb7aa9vb21vr7+5PHjxxsqKysbKioqPq+qqmo+evRoq01FSf5CcnJy1NixY2OysrLic3JyrsjOzh6VkZExKjk5OcnhcMSY8OZfihOogpq/AXZgX+GX3kjSDd5Tfu5FVJDZZ4OtoQxWAQC1ZvuvdK8MrAb+GYNNQGxiJHAtKm7gGizMqOvs7Oxqa2traWxsbGpsbGw+efLkmfr6+jM1NTVn6+vrW+vr69tqa2vbT5w4cc5Xp6LD4QhPTU0dnpaW5khOTo5OTk6OSU9Pj0tOTr48KSnp8sTExPjExMSE6OhoK3p5b5qBD/W9+gAfqjTbQALwL3Rv6/U28DCBiS0RAbCYa1Hlw+bo45/p45YB+j5Z2ql0L6pW3nAEgHOo2ofPoZy2VQP0PWJRZb1+qI+36OMPBuuFH+wCAN1r9J5NJx9HBZC0DOB3uhLlnFyIxZVyQ7Dh70SF8v4Z+GQAv0ssKqBrhT7+kMDGGogA2MhXdcO/2msk8NMBmg548xVgJqqqzEz6kVcQ4jQC21HVnLajovoGkgQ9x/f0/B9pIXh7sN+IoSIAoLL3VniJwGpU9tjJIPhuY1A5DF9HOQ3HD9J7cBjl1HsdFVMfDE61JG0H93s1/sdR2YWIAAy+kcBjXtOBl1DVf6uD5PuN0H6C2aiiJ4XYWGE3QNSjymZtQq3jVxE8qbOZqGrBd3oN+58YCj3/UBUAj0/gn+l2DO4E/p7ABgsZEY7aPisL5cicoUcI6SFyjWt0D78D5UCrAo4T+OW8vpgI/Dfd6/xbUN7/d4dSYxiKAoBuVA/RvUR4CuWQe4/ARpr5wmV6FJCKSjYqBCboR0yQfMdW4JB+lKKSdU7o3v+LYLN5VITmBroj/N5GJZB9MNQawlAVAFBxAj+kO1gI1PLcegKXRWjGeEfoRwqqTHoukI0qUjIW+/d77EIV3jgKVKKSY/aj4vNP60ewGlUUqmjMc16vvYhyCu8bio1gKAsAKOfbcrrDhtE9wb8RHM5BX6YK8ai6BLHAFXraMAZVpCQF5eQaiVphuBxV7rsv2lHx9416ZHRSN+5alNOuCvgctYx6FhW8EwqJSkmoLL6HvF57BhU2/tlQbQBDXQBA5Q48iMry8kTovYtyDu5DGCyjvZ/TXcyjGZU1+gsGWWy/CIB5luoeItfrtUWoJavzcnlCkijU0up6r9fK9QhvjVweEYCeLAD+H93OQVCVhn6F/SXHBWsZjUrJXub12tvAvzNIinmIANhDDqq+4ANerx3RfoJN2LsDkeA/kagYimfortsPqobf0wyCMl4iAIHhu/rhHZX3C21En8nlCUrGaOF+0Ou1w1oMnpHLIwLQX65Hlfda6PVagxaGt7Bva3KhfziAm3UjH+X1+gZUGbH35BKJAJhlBCpS8O/p3osQVCLLT1FbQst2XwNDOGqr+B+hEqo8VKGi/P6bEN2xRwQg+JiLWiko7vH6k6jNKVxyiQKKE7UpyyM9Xi9Befg3ySUSAbCaGFR5r7/VPY83D6CSi+rlMtlKMip55+ker5cB/4sqI9Yql0kEwE4mocKG7+HiPQAaUJFmbxIakYShRBJqz4WneszzTwHPo8J798tlEgEIJDcBi1FbkdFDCB4F3iCwNewHIynA11BVnUb1+NtvgXXAH+UyiQAMJHfpxy09Xv9Cz1FfQSXPyMX20S5RiU23o3wsl/X4+5uoJJ4X5VKJAASTf2Chnp/+1SX+vhq1VdleVC084csMR9U9uJvuCj3e/AHlZ9kg83wRgGAWgm/o3uvrl/h7KWq9ehOqcMZQvwFhqEInc1HxFYWXOOd1PYr6vTR8EYBQIUILwNf1HDbhEuc8h0pU2YVKsR1KXIEqjb4I5VDtSRPKh/K6fnSKSYkAhCrXoiLVbkaVoroUzwKvoqrpnByEI4MwlCd/KnAbcF8v5x1ARVm+xRCs0CMCMLjJAG7UjwX0vnHom1oMdqICjEI15NiBCtiZrhv9Lb2cdwaVofcn/TgupiICMNgpRG0OcgMq5+CyXs47B/wO2IgqUHIMVYknGIlDpeFOBuYB36T3TU++QMXo/1k/SsUkRACGKjOA61DlwGf14i/oOZwORoyMqQnYhioP/j6qarAgAiB4kauHzNegnGRTQlwA9qKcnB/qKU253GIRAME3IlFOs3w9rJ4M5GHh7sIW0wwc1FOVfaj4/N1IERURAMEyxhC8BUmC+bsJIgCCIHgTLpdAEEQABEEQARAEQQRAEAQRAEEQRAAEQRABEARBBEAQBBEAQRBEAARBEAEQBEEEQBAEEQBBEEQABEEQARAEQQRAEAQRAEEQRAAEQRABEARBBEAQBBEAQRBEAARBEAEQBEEEQBAEEQBBEEQABEEQARAEQQRAEAQRAEEQRAAEQegn/38A+BvRYVVWic0AAAAASUVORK5CYII=";var d=new Freedo.Cartesian3;var c=new Freedo.Cartesian2;var f=new Freedo.Cartographic;var h=new Freedo.JulianDate;var l=.1;var p=48;var v=function(){function t(e){(0,n.default)(this,t);this._viewer=e;this._scene=e.scene;this._visible=true;this._logoQuad=undefined;this._material=new Freedo.Material({fabric:{type:"Image",uniforms:{color:new Freedo.Color(1,1,1,.01),image:u}}});this._lastUpdateTime=undefined;this._autoDelete=false;this._needUpdatePerFrame=false;var a=this;var o=this._scene._screenSpaceCameraController;if(!Freedo.defined(o._aggregator)||!Freedo.defined(o._aggregator._eventMouseHander)){console.log("请更新到最新的freedo版本，否则有些功能不能正常使用！");return}var i=this._scene;var s=i.camera;var l=this._scene.planeMode?true:false;o._aggregator._eventMouseHander.addEventListener(function(n){if(!Freedo.defined(n)){return}if(!a._visible){return}var e=function e(t){d.x=s.transform[12];d.y=s.transform[13];d.z=s.transform[14];c=Freedo.SceneTransforms.wgs84ToWindowCoordinates(i,d,c);if(!Freedo.defined(c)){return}a._lastUpdateTime=Freedo.clone(Freedo.JulianDate.now(h),true);a._autoDelete=t;a.updateMouseHandlerCenterIcon()};var t=function e(t){var r=o._ellipsoid;var i=r.cartesianToCartographic(s.position,f);if(o._tiltOnEllipsoid||i.height>o._minimumCollisionTerrainHeight){return}c=n.position;a._lastUpdateTime=Freedo.clone(Freedo.JulianDate.now(h),true);a._autoDelete=t;a.updateMouseHandlerCenterIcon()};var r=function e(t){d=o._handleCenter;if(!Freedo.defined(d)){return}c=Freedo.SceneTransforms.wgs84ToWindowCoordinates(i,d,c);if(!Freedo.defined(c)){return}a._lastUpdateTime=Freedo.clone(Freedo.JulianDate.now(h),true);a._autoDelete=t;a.updateMouseHandlerCenterIcon()};if(n.type===Freedo.ScreenSpaceEventType.WHEEL){if(!l){if(o.isTracking()){e(true)}else{t(true)}}else{r(true)}}else if(n.type===Freedo.ScreenSpaceEventType.LEFT_DOWN){if(!l){if(o.isTracking()){e(false)}else if(n.ctrlKeyDown===true){t(false)}}else{a._needUpdatePerFrame=true;r(false)}}else if(n.type===Freedo.ScreenSpaceEventType.LEFT_UP){if(!l){if(o.isTracking()){a.deleteIcon()}else if(n.ctrlKeyDown===true){a.deleteIcon()}}else{o._handleCenter=undefined;a._needUpdatePerFrame=false;a.deleteIcon()}}else if(n.type===Freedo.ScreenSpaceEventType.MIDDLE_DOWN){if(!l){if(!o.isTracking()){t(false)}}}else if(n.type===Freedo.ScreenSpaceEventType.MIDDLE_UP){if(!l){if(!o.isTracking()){a.deleteIcon()}}}else if(n.type===Freedo.ScreenSpaceEventType.MOUSE_MOVE){if(l&&a._needUpdatePerFrame){r(true)}}});this._scene.preUpdate.addEventListener(function(){if(!a._visible){return}a.update()})}(0,o.default)(t,[{key:"updateMouseHandlerCenterIcon",value:function e(){if(Freedo.defined(this._logoQuad)){this._scene.primitives.remove(this._logoQuad);var t=this._scene.planeMode?true:false;if(t&&this._autoDelete){var r=this._scene._screenSpaceCameraController;r._handleCenter=undefined}}var i=this._viewer.cesiumWidget._resolutionScale;var n=this._scene.canvas;var a=p/i;this._logoQuad=new Freedo.ViewportQuad;this._logoQuad.rectangle=new Freedo.BoundingRectangle((c.x-a/2)*i,(n.clientHeight-c.y-a/2)*i,p,p);this._logoQuad.show=true;this._logoQuad.material=this._material;this._scene.primitives.add(this._logoQuad);setTimeout(function(){if(Freedo.defined(this._logoQuad))this._logoQuad.material.uniforms.color.alpha=.5}.bind(this),100);this._scene.requestRender()}},{key:"deleteIcon",value:function e(){if(Freedo.defined(this._logoQuad)){this._scene.primitives.remove(this._logoQuad);this._logoQuad=undefined;this._autoDelete=false;this._scene.requestRender()}}},{key:"update",value:function e(){if(!this._autoDelete){return}var t=Freedo.JulianDate.now(h);var r=Freedo.JulianDate.secondsDifference(t,this._lastUpdateTime);if(r>l){this.deleteIcon()}}},{key:"dispose",value:function e(){if(Freedo.defined(this._logoQuad)){this._scene.primitives.remove(this._logoQuad)}this._logoQuad=this._logoQuad&&this._logoQuad.destroy();this._material=this._material&&this._material.destroy();return Freedo.destroyObject(this)}},{key:"visibility",get:function e(){return this._visible},set:function e(t){this._visible=t}}]);return t}();t.FdMouseHandlerCenterIcon=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdManipulateCube=undefined;var i=r(1);var a=l(i);var n=r(2);var o=l(n);var s=r(527);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function n(t,e,r){(0,a.default)(this,n);r=Freedo.defaultValue(r,"http://ftp.gbim360.com/meisongjun/box_dh/0.glb");this._viewer=t;this._linkedViewer=e;t.showLogo=false;t.scene.skyBox=undefined;var i=t.scene.primitives.add(Freedo.Model.fromGltf({url:r,asynchronous:false,releaseGltfJson:true,forwardAxis:Freedo.Axis.Y}));i.readyPromise.then(function(e){t.camera.viewBoundingSphere(e.boundingSphere,new Freedo.HeadingPitchRange(0,-.5,0));t.camera.lookAtTransform(Freedo.Matrix4.IDENTITY);t.scene._screenSpaceCameraController._boundingSphere=e.boundingSphere});t.scene._screenSpaceCameraController=new s.FdScreenSpaceCameraControllerCube(t,e)}(0,o.default)(n,[{key:"linkedBoundingSphere",set:function e(t){this._viewer.scene._screenSpaceCameraController._linkedBoundingSphere=Freedo.clone(t,true);this._viewer.scene._screenSpaceCameraController._updateCamera()}}]);return n}();t.FdManipulateCube=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdScreenSpaceCameraControllerCube=undefined;var i=r(118);var n=o(i);var a=r(235);function o(e){return e&&e.__esModule?e:{default:e}}var m=Freedo;var s=new Freedo.Cartesian3;function l(e,t){if(!m.defined(e)){throw new DeveloperError("viewer is required.")}this._viewer=e;this._scene=e.scene;this._linkedViewer=t;this.enableCollisionDetection=false;this.minimumZoomDistance=1;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this.maximumMovementRatio=.1;this.enableInputs=true;this.enableRotate=true;this.enablePan=true;this.enableZoom=true;this.inertiaRotate=.5;this.inertiaPan=.5;this.inertiaZoom=.5;this.defaultZoomReference=undefined;this.defaultRotateReference=undefined;this._boundingSphere=new Freedo.BoundingSphere(new Freedo.Cartesian3(0,.00020000338554394264,1.949999988079071),1.4038524234021759);this.rotateEventTypes=m.CameraEventType.LEFT_DRAG;this._lastSelectedMesh=undefined;this._lastSelectedMeshBaseColorFactor=new Freedo.Cartesian3;this._leftBtnDown=false;this._handler=new Freedo.ScreenSpaceEventHandler(e.scene.canvas);var r=t.scene.camera;var i=this._viewer.scene.camera;var n=Freedo.clone(Freedo.JulianDate.now(),true);this._updateCamera=function(){var e=r.direction;e=Freedo.Cartesian3.normalize(e,e);var t=Freedo.Cartesian3.multiplyByScalar(e,-3.2,s);t=Freedo.Cartesian3.add(s,this._boundingSphere.center,t);Freedo.Cartesian3.clone(t,i.position);i.direction=Freedo.clone(r.direction,true);i.up=Freedo.clone(r.up,true);i._setTransform(Freedo.Matrix4.IDENTITY)};var a=this;r.changed.addEventListener(function(){if(!Freedo.defined(a._boundingSphere)){return}var e=Freedo.clone(Freedo.JulianDate.now(),true);if(Freedo.JulianDate.secondsDifference(e,n)>.5){a._updateCamera()}});this._scene=e.scene;this._aggregator=new m.CameraEventAggregator(e.scene.canvas)}var u=new Freedo.Cartesian3;var d=new Freedo.Matrix4;var c=new Freedo.Matrix4;var f=new Freedo.Quaternion;var h=new Freedo.Matrix3;var p=new Freedo.Cartographic;var v=new Freedo.HeadingPitchRoll;function _(e,t,r,i){v.heading=Freedo.defaultValue(r,0);v.pitch=Freedo.defaultValue(i,-Freedo.Math.PI_OVER_TWO);v.roll=0;var n=e.camera;var a=n.position;var o=Freedo.Matrix4.fromTranslation(a,c);v.heading=v.heading-Freedo.Math.PI_OVER_TWO;var s=Freedo.Quaternion.fromHeadingPitchRoll(v,f);var l=Freedo.Matrix3.fromQuaternion(s,h);Freedo.Matrix3.getColumn(l,0,n.direction);Freedo.Matrix3.getColumn(l,2,n.up);Freedo.Cartesian3.cross(n.direction,n.up,n.right);n._setTransform(Freedo.Matrix4.IDENTITY)}l.prototype.createEdgeByBoundingSphere=function(){var e=new Freedo.Cartesian3(0,0,2);var t=.52;var r=new Freedo.Cartesian3;r.x=-t;r.y=-t;r.z=t;var i=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=-t;r.y=t;r.z=t;var n=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=t;r.y=t;r.z=t;var a=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=t;r.y=-t;r.z=t;var o=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=-t;r.y=-t;r.z=-t;var s=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=-t;r.y=t;r.z=-t;var l=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=t;r.y=t;r.z=-t;var u=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);r.x=t;r.y=-t;r.z=-t;var d=Freedo.Cartesian3.add(e,r,new Freedo.Cartesian3);var c=function e(t,r,i,n){return new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:[t,r,i,n,t],width:4,followSurface:false,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})})};var f=[];f.push(c(i,n,a,o));f.push(c(s,l,u,d));f.push(c(i,n,l,s));f.push(c(n,l,u,a));f.push(c(i,o,d,s));f.push(c(o,a,u,d));this._viewer.scene.primitives.add(new Freedo.Primitive({geometryInstances:f,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(.6,.6,.6,1)}}})})}))};var y=new Freedo.Cartesian3(1,0,0);var g=new Freedo.Cartesian3(-1,0,0);var w=new Freedo.Cartesian3(0,1,0);var F=new Freedo.Cartesian3(0,-1,0);var b=new Freedo.Cartesian3(0,0,1);var C=new Freedo.Cartesian3(0,0,-1);l.prototype.onMouseClick=function(e){if(!Freedo.defined(this._linkedBoundingSphere)){return}var t=this._viewer.scene.pick(e.position);if(Freedo.defined(t)){var r=this._linkedViewer.scene.camera;var i=this._linkedBoundingSphere;if(t.mesh.name==="Mesh_13"||t.mesh.name==="Mesh_21"){_(r,i,Freedo.Math.toRadians(90),0)}else if(t.mesh.name==="Mesh_12"||t.mesh.name==="Mesh_18"){_(r,i,Freedo.Math.toRadians(270),0)}else if(t.mesh.name==="Mesh_11"||t.mesh.name==="Mesh_20"){_(r,i,0,0)}else if(t.mesh.name==="Mesh_14"||t.mesh.name==="Mesh_19"){_(r,i,Freedo.Math.toRadians(180),0)}else if(t.mesh.name==="Mesh_16"){_(r,i,r.heading,Freedo.Math.toRadians(90))}else if(t.mesh.name==="Mesh_15"){_(r,i,r.heading,Freedo.Math.toRadians(-90))}}};var x=new n.default(["Mesh_13","Mesh_21","Mesh_12","Mesh_18","Mesh_11","Mesh_20","Mesh_14","Mesh_19","Mesh_16","Mesh_15"]);l.prototype.onMouseMove=function(e){if(Freedo.defined(this._lastSelectedMesh)){this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.x=this._lastSelectedMeshBaseColorFactor.x;this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.y=this._lastSelectedMeshBaseColorFactor.y;this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.z=this._lastSelectedMeshBaseColorFactor.z}var t=this._viewer.scene.pick(e.startPosition);if(Freedo.defined(t)&&Freedo.defined(t.mesh)){if(x.has(t.mesh.name)){this._lastSelectedMesh=t.mesh;this._lastSelectedMeshBaseColorFactor.x=this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.x;this._lastSelectedMeshBaseColorFactor.y=this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.y;this._lastSelectedMeshBaseColorFactor.z=this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.z;this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.x=1;this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.y=1;this._lastSelectedMesh.materials[0]._uniformMap.values.baseColorFactor.value.z=0}}this._viewer.scene.requestRender()};function P(e,t){if(e<0){return 0}var r=(1-t)*25;return Math.exp(-r*e)}function M(e){return m.Cartesian2.equalsEpsilon(e.startPosition,e.endPosition,m.Math.EPSILON14)}var T=.4;function E(e,t,r,i,n,a,o){var s=a[o];if(!m.defined(s)){s=a[o]={startPosition:new m.Cartesian2,endPosition:new m.Cartesian2,motion:new m.Cartesian2,active:false}}var l=e.getButtonPressTime(t,r);var u=e.getButtonReleaseTime(t,r);var d=l&&u&&(u.getTime()-l.getTime())/1e3;var c=new Date;var f=u&&(c.getTime()-u.getTime())/1e3;if(l&&u&&d<T){var h=P(f,i);if(!s.active){var p=e.getLastMovement(t,r);if(!m.defined(p)||M(p)){return}s.motion.x=(p.endPosition.x-p.startPosition.x)*.5;s.motion.y=(p.endPosition.y-p.startPosition.y)*.5;s.startPosition=m.Cartesian2.clone(p.startPosition,s.startPosition);s.endPosition=m.Cartesian2.multiplyByScalar(s.motion,h,s.endPosition);s.endPosition=m.Cartesian2.add(s.startPosition,s.endPosition,s.endPosition);s.active=true}else{s.startPosition=m.Cartesian2.clone(s.endPosition,s.startPosition);s.endPosition=m.Cartesian2.multiplyByScalar(s.motion,h,s.endPosition);s.endPosition=m.Cartesian2.add(s.startPosition,s.endPosition,s.endPosition);s.motion=m.Cartesian2.clone(m.Cartesian2.ZERO,s.motion)}if(isNaN(s.endPosition.x)||isNaN(s.endPosition.y)||m.Cartesian2.distance(s.startPosition,s.endPosition)<.5){s.active=false;return}if(!e.isButtonDown(t,r)){var v=e.getStartMousePosition(t,r);n(a,v,s)}}else{s.active=false}}var S=[];function A(e,t,r,i,n,a){if(!m.defined(r)){return}var o=e._aggregator;if(!m.isArray(r)){S[0]=r;r=S}var s=r.length;for(var l=0;l<s;++l){var u=r[l];var d=m.defined(u.eventType)?u.eventType:u;var c=u.modifier;var f=o.isMoving(d,c)&&o.getMovement(d,c);var h=o.getStartMousePosition(d,c);if(e.enableInputs&&t){if(f){i(e,h,f)}else if(n<1){E(o,d,c,n,i,e,a)}}}}var k=new Freedo.Cartesian2;function L(e,t,r){if(!Freedo.defined(e._boundingSphere)){return}var i=e._scene;var n=i.camera;var a=e._linkedViewer.scene.camera;var o=i.canvas;var s=r.startPosition.x-r.endPosition.x;var l=r.startPosition.y-r.endPosition.y;var u=s/o.clientHeight;var d=l/o.clientHeight;u=Math.min(u,e.maximumMovementRatio);d=Math.min(d,e.maximumMovementRatio);var c=.2*u*Math.PI*2;var f=.2*d*Math.PI;var h=m.Matrix4.fromTranslation(e._boundingSphere.center);n.lookAtTransform(h);n.rotate(n.up,-c);n.rotate(n.right,-f);n.lookAtTransform(m.Matrix4.IDENTITY);if(Freedo.defined(e._linkedBoundingSphere)){e._linkedViewer.scene._screenSpaceCameraController.rotate(k,a.up,-c);e._linkedViewer.scene._screenSpaceCameraController.rotate(k,a.right,-f)}}function D(e){A(e,e.enableRotate,e.rotateEventTypes,L,e.inertiaRotate,"_lastInertiaSpinMovement")}l.prototype.update=function(){var e=this._scene;var t=e.mode;if(t===m.SceneMode.SCENE3D){D(this)}this._aggregator.reset()};l.prototype.isDestroyed=function(){return false};l.prototype.destroy=function(){this._eventHelper.removeAll();this._tweens.removeAll();this._aggregator=this._aggregator&&this._aggregator.destroy();return destroyObject(this)};t.FdScreenSpaceCameraControllerCube=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCameraHeight=undefined;var i=r(18);var d=u(i);var n=r(3);var c=u(n);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var f=function(){function i(e,t){var r=this;(0,o.default)(this,i);this._camera=e;this._data=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._lastHeight=999999999999;this._timer=setInterval(function(){r.onTimer()},500)}(0,l.default)(i,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onTimer",value:function e(){var t=this._camera.position;var r=Freedo.FdMisc.FdGeometric.tg(t);var i=r[2];var n=true;var a=false;var o=undefined;try{for(var s=(0,c.default)(this._data),l;!(n=(l=s.next()).done);n=true){var u=l.value;if(u.type=="less"){if(this._lastHeight<u.start){if(i>u.start){this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:false}))}else{if(u.ed!=true){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}}}else{if(i<u.start){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}else{}}}if(u.type=="more"){if(this._lastHeight>u.end){if(i<u.end){this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:false}))}else{if(u.ed!=true){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}}}else{if(i>u.end){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}else{}}}if(u.type=="range"){if(this._lastHeight>u.start&&this._lastHeight<u.end){if(i<u.start||i>u.end){this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:false}))}else{if(u.ed!=true){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}}}else{if(i>u.start&&i<u.end){u.ed=true;this._event.raiseEvent("CameraHeightChanged",(0,d.default)({},u,{state:true}))}else{}}}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}this._lastHeight=i}},{key:"dispose",value:function e(){this._eventHelper.removeAll();this._event=undefined;this._eventHelper=undefined;clearInterval(this._timer)}}]);return i}();t.FdCameraHeight=f},function(e,t,r){r(530);e.exports=r(13).Object.assign},function(e,t,r){var i=r(17);i(i.S+i.F,"Object",{assign:r(531)})},function(e,t,r){"use strict";var h=r(81);var p=r(167);var v=r(97);var m=r(94);var _=r(151);var n=Object.assign;e.exports=!n||r(68)(function(){var e={};var t={};var r=Symbol();var i="abcdefghijklmnopqrst";e[r]=7;i.split("").forEach(function(e){t[e]=e});return n({},e)[r]!=7||Object.keys(n({},t)).join("")!=i})?function e(t,r){var i=m(t);var n=arguments.length;var a=1;var o=p.f;var s=v.f;while(n>a){var l=_(arguments[a++]);var u=o?h(l).concat(o(l)):h(l);var d=u.length;var c=0;var f;while(d>c)if(s.call(l,f=u[c++]))i[f]=l[f]}return i}:n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMicroApp=undefined;var i=r(1);var n=b(i);var a=r(533);var o=r(553);var s=r(554);var l=r(557);var u=r(559);var d=r(10);var c=r(560);var f=r(564);var h=r(170);var p=r(171);var v=r(568);var m=r(569);var _=r(570);var y=r(571);var g=r(246);var w=r(579);var F=r(584);function b(e){return e&&e.__esModule?e:{default:e}}var C=function e(){(0,n.default)(this,e)};C.FdAnalysisManager=a.FdAnalysisManager;C.FdClipPlane=l.FdClipPlane;C.FdDrawPolyline=v.FdDrawPolyline;C.FdDrawRoad=o.FdDrawRoad;C.FdEraseGroundHandler=f.FdEraseGroundHandler;C.FdFirstPersonControl=_.FdFirstPersonControl;C.FdGeologySimulationHandler=c.FdGeologySimulationHandler;C.FdLabelsHandler=m.FdLabelsHandler;C.FdPathsManager=s.FdPathsManager;C.FdPickPMComponent=p.FdPickPMComponent;C.FdPickPModel=u.FdPickPModel;C.FdPolylineEditor=d.FdPolylineEditor;C.FdTransformHelper=h.FdTransformHelper;C.FdProcessDiff=y.FdProcessDiff;C.FdModelAnimation=g.FdModelAnimation;C.FdBuildingUtil=w.FdBuildingUtil;C.FdModelAnimationManager=F.FdModelAnimationManager;t.FdMicroApp=C},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisManager=undefined;var i=r(1);var n=h(i);var a=r(2);var o=h(a);var s=r(534);var l=r(545);var u=r(546);var d=r(550);var c=r(551);var f=r(552);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function t(e){(0,n.default)(this,t);this._viewer=e;this._survey=undefined;this._depthTestAgainstTerrain=true;this._mode="";this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._surveyLine=new s.FdAnalysisLineDistance(this._viewer);this._surveyPoint=new l.FdAnalysisPoint(this._viewer);this._surveyArea=new u.FdAnalysisArea(this._viewer);this._surveyHeight=new d.FdAnalysisHeight(this._viewer);this._surveyAngle=new c.FdAnalysisAngle(this._viewer);this._surveySpatial=new f.FdAnalysisSpatial(this._viewer);this._lsnr=undefined}(0,o.default)(t,[{key:"surveyOptions",get:function e(){return this.getData()},set:function e(t){if(!Freedo.defined(t)){return}this._surveyLine.setData(t);this._surveyPoint.setData(t.point);this._surveyArea.setData(t.area);this._surveyHeight.setData(t.height);this._surveyAngle.setData(t.angle)}}]);return t}();p.prototype.start=function(e){this.setMode(e)};p.prototype.setMode=function(e){if(e=="CANCEL"){this.reset();return}if(e!=="LINE_DISTANCE"&&e!=="SEGMENTS_DISTANCE"&&e!=="SINGLE_POINT"&&e!=="AREA"&&e!=="HEIGHT"&&e!=="ANGLE"&&e!=="SPATIAL"){console.warn("不支持此种量测模式："+e);return}this.reset();this._mode=e;if(e==="LINE_DISTANCE"||e==="SEGMENTS_DISTANCE"){this._survey=this._surveyLine}if(e==="SINGLE_POINT"){this._survey=this._surveyPoint}if(e==="AREA"){this._survey=this._surveyArea}if(e==="HEIGHT"){this._survey=this._surveyHeight}if(e==="ANGLE"){this._survey=this._surveyAngle}if(e==="SPATIAL"){this._survey=this._surveySpatial}var r=this;this._lsnr=this._survey.on(function(e,t){if(e=="Point"){r._event.raiseEvent("Point",t)}if(e=="HeightPoint"){r._event.raiseEvent("Point",t)}if(e=="DataChanged"){r._event.raiseEvent(e,t)}if(e=="AnaFinished"){r._event.raiseEvent(e,t)}});this._survey.run(this._mode);this._event.raiseEvent("Start",{mode:this._mode})};p.prototype.getMode=function(){return this._mode};p.prototype.setSingleMode=function(e){if(this._mode=="SINGLE_POINT"){this._survey.setSingleMode(e)}};p.prototype.setHAVMode=function(e){if(this._mode=="LINE_DISTANCE"){this._survey.setHAVMode(e)}};p.prototype.setSumPointMode=function(e){if(this._mode=="SEGMENTS_DISTANCE"){this._survey.setSumPointMode(e)}};p.prototype.setBoxInfos=function(e,t,r){if(this._mode=="SPATIAL"){this._survey.setBoxInfos(e,t,r)}};p.prototype.getData=function(){var e=this._surveyLine.getData();var t=this._surveyPoint.getData();var r=this._surveyArea.getData();var i=this._surveyHeight.getData();var n=this._surveyAngle.getData();var a=this._surveySpatial.getData();return{line:e.line,polyline:e.polyline,point:t.point,area:r.area,height:i.height,angle:n.angle}};p.prototype.cancel=function(){this.reset();this._event.raiseEvent("Cancel",{mode:this._mode})};p.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};p.prototype.reset=function(){if(this._survey)this._survey.reset();if(this._lsnr)this._lsnr()};p.prototype.removeAll=function(){this._surveyLine.removeAll();this._surveyPoint.removeAll();this._surveyArea.removeAll();this._surveyHeight.removeAll();this._surveyAngle.removeAll();this._surveySpatial.removeAll();this._event.raiseEvent("DataChanged",{});this._viewer.scene.requestRender()};p.prototype.dispose=function(){this.reset()};t.FdAnalysisManager=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisLineDistance=undefined;var i=r(3);var p=l(i);var n=r(1);var a=l(n);var o=r(5);var s=r(120);function l(e){return e&&e.__esModule?e:{default:e}}var u=function e(t){(0,a.default)(this,e);this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3};this.ResultType={StraightLine:1,HorizontalAndVertical:2};this._viewer=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._data={line:[],polyline:[]};this._results=[];this._startPoint=undefined;this._tempPoint=undefined;this._polylineCollection=new Freedo.PolylineCollection;this._viewer.scene.primitives.add(this._polylineCollection);this._collection=new Freedo.PrimitiveCollection;this._viewer.scene.primitives.add(this._collection);this._tempLine;this._tempPointEntities=[null,null];this._tempSumLabelEntity=undefined;this._lastLabel=undefined;this._points=[];this._pointsCalced=[];this._handler={};this._ballSize=.5;this._lineWidth=3;this._fontSize="14px 黑体";this._bInSurvey=false;this._surveyType="";this._useDepthPicking=true;this._pickTranslucentDepth=true;this._bRmStarting=false;this._startPointLabel=[];this._endPointLabel=[];this._sumPointMode=false;this._sumPointLabel=[];this._setHAVMode=true};u.prototype.pickPosition=function(e){var t=Freedo.FdMisc.FdGeometric.pickPosition(this._viewer,e);if(t){return{type:this.PositionType.ON_TERRAIN,position:t}}else{return{type:this.PositionType.NONE,position:t}}};u.prototype.removeTmpLine=function(){this._removeListener&&this._removeListener();if(this._tempLine){this._viewer.scene.primitives.remove(this._tempLine);this._tempLine=undefined}if(this._tempSumLabelEntity){this._viewer.entities.remove(this._tempSumLabelEntity);this._tempSumLabelEntity=undefined}for(var e=0;e<this._tempPointEntities.length;e++){if(!!this._tempPointEntities[e]){this._viewer.entities.remove(this._tempPointEntities[e]);this._tempPointEntities[e]=null}}if(this._surveyType=="LINE_DISTANCE"){this._startPoint=undefined;this._tempPoint=undefined}this._bRmStarting=false;this._viewer.scene.requestRender()};u.prototype.calcLineType=function(e,t){if(!this._viewer.scene.globe)return this.ResultType.StraightLine;var r=Freedo.Cartographic.fromCartesian(e.position);var i=Freedo.Cartographic.fromCartesian(t.position);var n=Freedo.FdMisc.FdGeometric.calculateLength([e.position,t.position]);var a=Math.abs(r.height-i.height);if(a>n/10)return this.ResultType.HorizontalAndVertical;else return this.ResultType.StraightLine};u.prototype.createLinePrimitive=function(e,t){var r,i;if(this._viewer.scene.globe){i=true}else{i=false}r=new Freedo.PolylineGeometry({positions:[e,t],width:2,followSurface:i,arcType:this._viewer.scene.planeMode?Freedo.ArcType.NONE:undefined,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT});return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:r}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})};u.prototype.createLabel=function(e,t){return this._viewer.entities.add({position:e,label:{style:Freedo.LabelStyle.FILL_AND_OUTLINE,text:t,show:true,fillColor:Freedo.Color.BLACK,showBackground:true,backgroundColor:new Freedo.Color(.835,.835,.835,.835),font:this._fontSize,horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,pixelOffset:new Freedo.Cartesian2(1,1),disableDepthTestDistance:Number.POSITIVE_INFINITY}})};u.prototype.addResult=function(e){var t=Freedo.FdMisc.FdGeometric;var r=this.calcLineType(this._startPoint,e);if(r===this.ResultType.HorizontalAndVertical&&this._setHAVMode===false)r=this.ResultType.StraightLine;this._points.pop();this._points.push(e.position);this._points.push(e.position);this._ballSize=t.calculateLength(this._points)/1e3;var i=[this._startPoint.position,e.position];var n=t.calculateLength(i);if(n<.01){this._points.pop();return}if(r===this.ResultType.StraightLine){var a=this._viewer.scene.primitives.add(this.createLinePrimitive(this._startPoint.position,e.position));var o=t.getCenter(this._startPoint.position,e.position);var s=t.calculateLength(i);var l=void 0;if(this._surveyType==="LINE_DISTANCE")l=this.getLengthText(s);else l="段长:"+this.getLengthText(s);var u=this.createLabel(o,l);var d=this._viewer.entities.add({position:this._startPoint.position,show:true,point:{color:Freedo.Color.YELLOW,pixelSize:7,show:true,point:false,disableDepthTestDistance:Number.POSITIVE_INFINITY}});var c=this._viewer.entities.add({position:e.position,show:true,point:{color:Freedo.Color.YELLOW,pixelSize:7,show:true,point:false,disableDepthTestDistance:Number.POSITIVE_INFINITY}});this._results.push({type:r,labelEntity:u,line:a,startPointEntity:d,endPointEntity:c});var f={pointsG:[t.tg(this._startPoint.position),t.tg(e.position)],pointsC:[this._startPoint.position,e.position],length:s,vLength:0,hLength:0};if(this._surveyType=="LINE_DISTANCE"){this._data.line.push(f);this._event.raiseEvent("DataChanged",f);this._event.raiseEvent("AnaFinished",f)}if(this._surveyType=="SEGMENTS_DISTANCE"){this._pointsCalced.push(f)}}else if(r===this.ResultType.HorizontalAndVertical){var h=Freedo.Cartographic.fromCartesian(this._startPoint.position);var p=Freedo.Cartographic.fromCartesian(e.position);var v,m,_,y;if(h.height>p.height){m=this._startPoint.position;v=e.position;_=h.height-p.height}else{m=e.position;v=this._startPoint.position;_=p.height-h.height}var g=new Freedo.Cartesian3;Freedo.Cartesian3.normalize(v,g);Freedo.Cartesian3.multiplyByScalar(g,_,g);var w=new Freedo.Cartesian3;Freedo.Cartesian3.add(v,g,w);y=Freedo.Cartesian3.distance(w,m);var a=this._viewer.scene.primitives.add(this.createLinePrimitive(m,v));var F,b;var C=void 0;if(this._surveyType=="LINE_DISTANCE"){F=this._viewer.scene.primitives.add(this.createLinePrimitive(v,w));b=this._viewer.scene.primitives.add(this.createLinePrimitive(m,w));C=this.getLengthText(n)}else{C="段长:"+this.getLengthText(n)}var x=t.getCenter(m,v);var P=t.calculateLength([m,v]);var M=this.createLabel(x,C);var T,E;if(this._surveyType=="LINE_DISTANCE"){x=t.getCenter(w,v);C="垂直:"+this.getLengthText(_);T=this.createLabel(x,C);x=t.getCenter(w,m);C="水平:"+this.getLengthText(y);E=this.createLabel(x,C)}var d=this._viewer.entities.add({position:this._startPoint.position,point:{color:Freedo.Color.YELLOW,pixelSize:7,show:true,point:false,disableDepthTestDistance:Number.POSITIVE_INFINITY}});var c=this._viewer.entities.add({position:e.position,point:{color:Freedo.Color.YELLOW,show:true,pixelSize:7,point:false,disableDepthTestDistance:Number.POSITIVE_INFINITY}});this._results.push({type:r,line:a,verticalLine:F,horizontalLine:b,lineLabelEntity:M,verticalLineLabelEntity:T,horizontalLineLabelEntity:E,startPointEntity:d,endPointEntity:c});var f={pointsG:[t.tg(this._startPoint.position),t.tg(e.position)],pointsC:[this._startPoint.position,e.position],length:P,vLength:_,hLength:y};if(this._surveyType=="LINE_DISTANCE"){this._data.line.push(f);this._event.raiseEvent("DataChanged",f);this._event.raiseEvent("AnaFinished",f)}if(this._surveyType=="SEGMENTS_DISTANCE"){this._pointsCalced.push(f)}}if(this._points.length>3&&this._surveyType=="SEGMENTS_DISTANCE"){if(this._lastLabel==undefined){var S="总长:"+this.getLengthText(t.calculateLength(this._points));this._lastLabel=this.createLabel(e.position,S)}else{if(this._sumPointMode){var A=this._lastLabel.label.text._value;var k=A.indexOf(":")+1;A=A.substring(k,A.length);var L="累计长:"+A;var D=this.createLabel(this._lastLabel.position,L);this._sumPointLabel.push(D)}this._lastLabel.position=e.position;this._lastLabel.label.text="总长:"+this.getLengthText(t.calculateLength(this._points))}}if(this._temPrimitive&&!this._temPrimitive.isDestroyed())this._viewer.scene.primitives.remove(this._temPrimitive);for(var I=0;I<R.length;I++){this._viewer.scene.primitives.remove(R[I])}if(this._surveyType=="SEGMENTS_DISTANCE"){this._startPoint=Freedo.clone(e,true)}e=undefined;this._viewer.scene.requestRender()};u.prototype.clearResults=function(){this.removeTmpLine();if(this._lastLabel){this._viewer.entities.remove(this._lastLabel);this._lastLabel=undefined}for(var e=0;e<this._results.length;++e){if(this._results[e].type===this.ResultType.StraightLine){this._viewer.scene.primitives.remove(this._results[e].line);this._viewer.entities.remove(this._results[e].labelEntity);this._viewer.entities.remove(this._results[e].startPointEntity);this._viewer.entities.remove(this._results[e].endPointEntity)}else if(this._results[e].type===this.ResultType.HorizontalAndVertical){this._viewer.scene.primitives.remove(this._results[e].line);this._viewer.scene.primitives.remove(this._results[e].verticalLine);this._viewer.scene.primitives.remove(this._results[e].horizontalLine);this._viewer.entities.remove(this._results[e].lineLabelEntity);this._viewer.entities.remove(this._results[e].verticalLineLabelEntity);this._viewer.entities.remove(this._results[e].horizontalLineLabelEntity);this._viewer.entities.remove(this._results[e].startPointEntity);this._viewer.entities.remove(this._results[e].endPointEntity)}}this._viewer.scene.primitives.remove(this._polylineCollection);this._results=[];this._data={line:[],polyline:[]};this._points=[];this._pointsCalced=[];if(this._startPointLabel.length!==0){for(var e=0;e<this._startPointLabel.length;e++){this._viewer.entities.remove(this._startPointLabel[e])}}if(this._endPointLabel.length!==0){for(var e=0;e<this._endPointLabel.length;e++){this._viewer.entities.remove(this._endPointLabel[e])}}if(this._sumPointLabel.length!==0){for(var e=0;e<this._sumPointLabel.length;e++){this._viewer.entities.remove(this._sumPointLabel[e])}}this._viewer.scene.requestRender()};u.prototype.pickStartPoint=function(e){this._points=[];this._pointsCalced=[];var t=this.pickPosition(e);if(t.type!==this.PositionType.NONE){this._startPoint=t;this._points.push(t.position);this._points.push(t.position);this._tempPointEntities[0]=this._viewer.entities.add({position:this._startPoint.position,show:true,point:{color:Freedo.Color.YELLOW,pixelSize:7,show:false,point:false,disableDepthTestDistance:Number.POSITIVE_INFINITY}});var r=this.createLabel(this._startPoint.position,"起点");this._startPointLabel.push(r)}this.addTempLine()};u.prototype.getLengthText=function(e){return e>1e3?(e/1e3).toFixed(2)+"千米":e.toFixed(2)+"米"};u.prototype.pickEndPoint=function(e){var t=this.pickPosition(e);if(t.type!==this.PositionType.NONE){this.addResult(t);this._bRmStarting=true;this.removeTmpLine();if(this._surveyType=="SEGMENTS_DISTANCE"){this.addTempLine()}else if(this._surveyType=="LINE_DISTANCE"){var r=this.createLabel(t.position,"终点");this._endPointLabel.push(r)}}};u.prototype.setHAVMode=function(e){this._setHAVMode=e};u.prototype.setSumPointMode=function(e){this._sumPointMode=e};u.prototype.handleLeftClick=function(e){if(this._bInSurvey==false)return;if(this._startPoint){this.pickEndPoint(e.position)}else{this.pickStartPoint(e.position)}};u.prototype.addSumLabel=function(){if(this._surveyType=="SEGMENTS_DISTANCE"){var e=Freedo.FdMisc.FdGeometric.calculateLength(this._points);if(this._points.length>=2){if(this._lastLabel!==undefined){this._endPointLabel.push(this._lastLabel);this._lastLabel=undefined}this._data.polyline.push({lines:Freedo.clone(this._pointsCalced,true),sumPointMode:Freedo.clone(this._sumPointMode,true),sumLenght:e});this._event.raiseEvent("DataChanged",{lines:Freedo.clone(this._pointsCalced,true),sumLenght:e})}}this._viewer.scene.requestRender()};u.prototype.handleRightClick=function(e){this._tempPoint=undefined;this.removeTmpLine();for(var t=0;t<R.length;t++){this._viewer.scene.primitives.remove(R[t])}this._viewer.scene.primitives.remove(this._temPrimitive);if(this._bInSurvey==false)return;if(!!this._startPoint){this._startPoint=undefined;this.addSumLabel()}};u.prototype.callbackPosition=function(){this._viewer.scene.requestRender();if(this._startPoint&&this._tempPoint)return[this._startPoint.position,this._tempPoint.position]};u.prototype.handleMouseMove=function(e){this._viewer.scene.requestRender();if(this._bInSurvey==false||this._bRmStarting)return;if(!!this._startPoint&&!Freedo.Cartesian3.equals(e.endPosition,e.startPosition)){var t=this.pickPosition(e.endPosition);if(Freedo.defined(t.position))this._tempPoint=t;else return}};var R=[];u.prototype.addTempLine=function(){var i=this;var e=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})});var t=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})});var n=this._tempLine=new s.FdChangeablePrimitive({appearance:e,depthFailAppearance:t,geometryInstances:[]});this._viewer.scene.primitives.add(n);this._removeListener=this._viewer.scene.postRender.addEventListener(function(){var e=i.callbackPosition();if(!e)return;var t=new Freedo.PolylineGeometry({positions:e.slice(),width:2,arcType:i._viewer.scene.planeMode?Freedo.ArcType.NONE:undefined});if(!t)return;var r=new Freedo.GeometryInstance({geometry:t});n.setAttribute("geometryInstances",r)})};u.prototype.onKeyDown=function(){if(this._bInSurvey==false)return;if(window.event.keyCode==27){this.handleRightClick()}};u.prototype.getData=function(e){return Freedo.clone(this._data,true)};u.prototype.setData=function(e){this._surveyType="LINE_DISTANCE";if(!e)return;var t=true;var r=false;var i=undefined;try{for(var n=(0,p.default)(e.line),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._points=[];this._startPoint={position:o.pointsC[0]};this.addResult({position:o.pointsC[1]})}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}if(!e.polyline)return;this._surveyType="SEGMENTS_DISTANCE";var s=true;var l=false;var u=undefined;try{for(var d=(0,p.default)(e.polyline),c;!(s=(c=d.next()).done);s=true){var o=c.value;this._points=[];var f=o;for(var h=0;h<f.lines.length;h++){if(h==0){this._points.push(f.lines[h].pointsC[0]);this._points.push(f.lines[h].pointsC[0])}this._startPoint={position:f.lines[h].pointsC[0]};this.addResult({position:f.lines[h].pointsC[1]})}this.addSumLabel()}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}this._startPoint=undefined};u.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};u.prototype.run=function(e){this._surveyType=e;this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.handleLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(this.handleRightClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);this._handler.setInputAction(this.handleRightClick.bind(this),Freedo.ScreenSpaceEventType.RIGHT_CLICK);this._handler.setInputAction(this.handleMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);window.addEventListener("keydown",this.onKeyDown.bind(this));this._bInSurvey=true};u.prototype.reset=function(){this._bInSurvey=false;this._handler.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK);this._handler.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);this._handler.removeInputAction(Freedo.ScreenSpaceEventType.RIGHT_CLICK);this._handler.removeInputAction(Freedo.ScreenSpaceEventType.MOUSE_MOVE);window.removeEventListener("keydown",this.onKeyDown.bind(this))};u.prototype.removeAll=function(){this.clearResults()};u.prototype.dispose=function(){this.reset();this.clearResults()};t.FdAnalysisLineDistance=u},function(e,t,r){e.exports={default:r(536),__esModule:true}},function(e,t,r){r(70);r(79);e.exports=r(168).f("iterator")},function(e,t,r){e.exports={default:r(538),__esModule:true}},function(e,t,r){r(539);r(119);r(543);r(544);e.exports=r(13).Symbol},function(e,t,r){"use strict";var i=r(20);var s=r(69);var n=r(43);var a=r(17);var o=r(218);var l=r(163).KEY;var u=r(68);var d=r(158);var c=r(93);var f=r(115);var h=r(21);var p=r(168);var v=r(169);var m=r(540);var _=r(227);var y=r(47);var g=r(42);var w=r(67);var F=r(155);var b=r(92);var C=r(113);var x=r(541);var P=r(542);var M=r(34);var T=r(81);var E=P.f;var S=M.f;var A=x.f;var k=i.Symbol;var L=i.JSON;var D=L&&L.stringify;var I="prototype";var R=h("_hidden");var O=h("toPrimitive");var N={}.propertyIsEnumerable;var B=d("symbol-registry");var H=d("symbols");var V=d("op-symbols");var G=Object[I];var z=typeof k=="function";var U=i.QObject;var j=!U||!U[I]||!U[I].findChild;var q=n&&u(function(){return C(S({},"a",{get:function(){return S(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var i=E(G,t);if(i)delete G[t];S(e,t,r);if(i&&e!==G)S(G,t,i)}:S;var W=function(e){var t=H[e]=C(k[I]);t._k=e;return t};var X=z&&typeof k.iterator=="symbol"?function(e){return typeof e=="symbol"}:function(e){return e instanceof k};var Z=function e(t,r,i){if(t===G)Z(V,r,i);y(t);r=F(r,true);y(i);if(s(H,r)){if(!i.enumerable){if(!s(t,R))S(t,R,b(1,{}));t[R][r]=true}else{if(s(t,R)&&t[R][r])t[R][r]=false;i=C(i,{enumerable:b(0,false)})}return q(t,r,i)}return S(t,r,i)};var Y=function e(t,r){y(t);var i=m(r=w(r));var n=0;var a=i.length;var o;while(a>n)Z(t,o=i[n++],r[o]);return t};var J=function e(t,r){return r===undefined?C(t):Y(C(t),r)};var Q=function e(t){var r=N.call(this,t=F(t,true));if(this===G&&s(H,t)&&!s(V,t))return false;return r||!s(this,t)||!s(H,t)||s(this,R)&&this[R][t]?r:true};var K=function e(t,r){t=w(t);r=F(r,true);if(t===G&&s(H,r)&&!s(V,r))return;var i=E(t,r);if(i&&s(H,r)&&!(s(t,R)&&t[R][r]))i.enumerable=true;return i};var $=function e(t){var r=A(w(t));var i=[];var n=0;var a;while(r.length>n){if(!s(H,a=r[n++])&&a!=R&&a!=l)i.push(a)}return i};var ee=function e(t){var r=t===G;var i=A(r?V:w(t));var n=[];var a=0;var o;while(i.length>a){if(s(H,o=i[a++])&&(r?s(G,o):true))n.push(H[o])}return n};if(!z){k=function e(){if(this instanceof k)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:undefined);var r=function(e){if(this===G)r.call(V,e);if(s(this,R)&&s(this[R],t))this[R][t]=false;q(this,t,b(1,e))};if(n&&j)q(G,t,{configurable:true,set:r});return W(t)};o(k[I],"toString",function e(){return this._k});P.f=K;M.f=Z;r(236).f=x.f=$;r(97).f=Q;r(167).f=ee;if(n&&!r(90)){o(G,"propertyIsEnumerable",Q,true)}p.f=function(e){return W(h(e))}}a(a.G+a.W+a.F*!z,{Symbol:k});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;te.length>re;)h(te[re++]);for(var ie=T(h.store),ne=0;ie.length>ne;)v(ie[ne++]);a(a.S+a.F*!z,"Symbol",{for:function(e){return s(B,e+="")?B[e]:B[e]=k(e)},keyFor:function e(t){if(!X(t))throw TypeError(t+" is not a symbol!");for(var r in B)if(B[r]===t)return r},useSetter:function(){j=true},useSimple:function(){j=false}});a(a.S+a.F*!z,"Object",{create:J,defineProperty:Z,defineProperties:Y,getOwnPropertyDescriptor:K,getOwnPropertyNames:$,getOwnPropertySymbols:ee});L&&a(a.S+a.F*(!z||u(function(){var e=k();return D([e])!="[null]"||D({a:e})!="{}"||D(Object(e))!="{}"})),"JSON",{stringify:function e(t){var r=[t];var i=1;var n,a;while(arguments.length>i)r.push(arguments[i++]);a=n=r[1];if(!g(n)&&t===undefined||X(t))return;if(!_(n))n=function(e,t){if(typeof a=="function")t=a.call(this,e,t);if(!X(t))return t};r[1]=n;return D.apply(L,r)}});k[I][O]||r(54)(k[I],O,k[I].valueOf);c(k,"Symbol");c(Math,"Math",true);c(i.JSON,"JSON",true)},function(e,t,r){var s=r(81);var l=r(167);var u=r(97);e.exports=function(e){var t=s(e);var r=l.f;if(r){var i=r(e);var n=u.f;var a=0;var o;while(i.length>a)if(n.call(e,o=i[a++]))t.push(o)}return t}},function(e,t,r){var i=r(67);var n=r(236).f;var a={}.toString;var o=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var s=function(e){try{return n(e)}catch(e){return o.slice()}};e.exports.f=function e(t){return o&&a.call(t)=="[object Window]"?s(t):n(i(t))}},function(e,t,r){var i=r(97);var n=r(92);var a=r(67);var o=r(155);var s=r(69);var l=r(217);var u=Object.getOwnPropertyDescriptor;t.f=r(43)?u:function e(t,r){t=a(t);r=o(r,true);if(l)try{return u(t,r)}catch(e){}if(s(t,r))return n(!i.f.call(t,r),t[r])}},function(e,t,r){r(169)("asyncIterator")},function(e,t,r){r(169)("observable")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisPoint=undefined;var i=r(3);var c=s(i);var n=r(1);var a=s(n);var o=r(5);function s(e){return e&&e.__esModule?e:{default:e}}var l=function e(t){(0,a.default)(this,e);this._viewer=t;this._tempPoint=undefined;this._points=[];this._data=[];this._labels=[];this._bInSurvey=false;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._tmpPoint=undefined;this._singleMode=false};l.prototype.addPoint=function(e){var t=Freedo.FdMisc.FdGeometric.tc(e);if(!Freedo.defined(this._viewer.scene.globe))t={x:e[0],y:e[1],z:e[2]};if(this._tmpPoint){}this._tmpPoint=this._viewer.entities.add({position:t,point:{color:Freedo.Color.YELLOW,pixelSize:5,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:true}});var r=Freedo.FdMisc.FdMath.round;var i;if(this._viewer.scene.globe)i=this.createLabel(t,"经度："+r(e[0],8)+"\n"+"纬度："+r(e[1],8)+"\n"+"高度："+r(e[2],4));else i=this.createLabel(t,"X："+r(e[0],8)+"\n"+"Y："+r(e[1],8)+"\n"+"Z："+r(e[2],4));this._labels.push(i);this._points.push(this._tmpPoint);var n={};n.pointG=[r(e[0],8),r(e[1],8),r(e[2],8)];n.pointC=t;this._data.push(n);this._event.raiseEvent("Point",{point:e});this._event.raiseEvent("DataChanged",n);this._viewer.scene.requestRender()};l.prototype.pickPosition=function(e){var t=Freedo.FdMisc.FdGeometric.pickPositionG(this._viewer,e);if(t){this.addPoint(t)}};l.prototype.createLabel=function(e,t){return this._viewer.entities.add({position:e,label:o.FdMisc.getLabelOpt(t)})};l.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};l.prototype.handleLeftClick=function(e){if(this._bInSurvey==false)return;if(this._singleMode){this.removeAll()}this.pickPosition(e.position)};l.prototype.setSingleMode=function(e){this._singleMode=e};l.prototype.getData=function(){return{point:Freedo.clone(this._data,true)}};l.prototype.setData=function(e){if(!e)return;var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this.addPoint(o.pointG)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};l.prototype.run=function(e){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.handleLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._bInSurvey=true};l.prototype.reset=function(){this._bInSurvey=false;this._handler.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK)};l.prototype.removeAll=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,c.default)(this._points),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.entities.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,c.default)(this._labels),d;!(o=(d=u.next()).done);o=true){var a=d.value;this._viewer.entities.remove(a)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}this._points=[];this._data=[]};l.prototype.dispose=function(){this.reset();this.removeAll()};t.FdAnalysisPoint=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisArea=undefined;var i=r(3);var C=s(i);var n=r(1);var a=s(n);var f=r(5);var o=r(10);function s(e){return e&&e.__esModule?e:{default:e}}var l=function e(t){(0,a.default)(this,e);this._viewer=t;this._scene=this._viewer.scene;this._polygons=[];this._polygons3D=[];this._labels=[];this._data=[];this._lsner=undefined;this._currentType=undefined;this._ple=new o.FdPolylineEditor(t);this._ple.setAutoDelLines(true);this._ple.setHeightOffset(0);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper};l.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};l.prototype.run=function(e){this._ple.run();if(this._lsner){this._lsner();this._lsner=undefined}var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){r.onPLAdd(t)}if(e=="PointAdded"){if(r._currentType==undefined){if(Freedo.defined(t.position[3])&&t.position[3]==0){r._currentType="OnModel"}else r._currentType="OnEarth"}}});this._event.raiseEvent("Start",{})};l.prototype.createAreaPrimitive=function(e){var t;var r=new Freedo.Cartesian3;var i=Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3);var n=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);t=Freedo.Cartesian3.cross(i,n,new Freedo.Cartesian3);t=Freedo.Cartesian3.normalize(t,new Freedo.Cartesian3);var a=Freedo.Cartesian3.angleBetween(t,Freedo.Cartesian3.UNIT_Z);var o=Freedo.Cartesian3.cross(t,Freedo.Cartesian3.UNIT_Z,new Freedo.Cartesian3);var s=Freedo.Quaternion.fromAxisAngle(o,a,new Freedo.Quaternion);var l=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,s,new Freedo.Cartesian3(1,1,1));var u=Freedo.Matrix4.multiplyByPointAsVector(l,t,new Freedo.Cartesian3);var d=[];var c=true;var f=false;var h=undefined;try{for(var p=(0,C.default)(e),v;!(c=(v=p.next()).done);c=true){var m=v.value;var _=Freedo.Matrix4.multiplyByPointAsVector(l,m,new Freedo.Cartesian3);d.push(_)}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}var y;if(false){}else{var g=[];for(var w=0;w<e.length;w++){g.push(e[w].x*1);g.push(e[w].y*1);g.push(e[w].z*1)}var F=Freedo.PolygonPipeline.triangulate(d);var b=new Float64Array(g);y=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:b})},indices:new Uint16Array(F),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(b)})}return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:y,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(Freedo.Color.ORANGE.withAlpha(.5))}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:10,units:-1},depthTest:{enabled:false,func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false})};l.prototype.addArea=function(e){var t;if(this._viewer.scene.globe){if(this._currentType=="OnEarth"||this._currentType==""||this._currentType==undefined){t=this._viewer.entities.add({name:"AREAGEO",polygon:{hierarchy:new Freedo.PolygonHierarchy(e),material:Freedo.Color.ORANGE.withAlpha(.5),outline:true,outlineColor:Freedo.Color.BLACK}})}else{t=this._viewer.scene.primitives.add(this.createAreaPrimitive(e))}}else{t=this._viewer.scene.primitives.add(this.createAreaPrimitive(e))}var r=this.xyzCenter(e);var i=[];for(var n=0;n<e.length-1;n++){var a=this.toLonLat(e[n]);i.push(a)}var o=[];var s=[];var l=[];for(var n=0;n<e.length-1;n++){var a=this.toLonLat(e[n]);o.push(a.lon);s.push(a.lat);l.push([a.lon,a.lat])}var u=0;if(this._viewer.scene.globe&&this._currentType!="OnModel")u=this.calcArea3D(e);else u=this.calcArea3D(e);if(u<0)u*=-1;u=Freedo.FdMisc.FdMath.round(u,2);var d=this._viewer.entities.add({label:f.FdMisc.getLabelOpt("")});if(u>1e6){u=Freedo.FdMisc.FdMath.round(u/1e6,2);d.label.text=u+"平方公里"}else{d.label.text=u+"平方米"}if(this._viewer.scene.globe&&this._currentType!="OnModel")d.position=Freedo.Cartesian3.fromDegrees(r.lon,r.lat,r.height+.1);else d.position=new Freedo.Cartesian3(r.lon,r.lat,r.height);d.label.show=true;this._labels.push(d);if(this._viewer.scene.globe)this._polygons.push(t);else this._polygons3D.push(t);var c={pointsG:l,pointsC:e,area:u,type:this._currentType};this._data.push(c);this._event.raiseEvent("DataChanged",c);this._viewer.scene.requestRender();this._currentType=undefined};l.prototype.onPLAdd=function(e){if(!e.polyline)return;if(e.polyline.pts.length==2){this._ple.delResult();return}this.addArea(e.polyline.pts)};l.prototype.toLonLat=function(e){var t=Freedo.Cartographic.fromCartesian(e);var r=Freedo.Math.toDegrees(t.longitude);var i=Freedo.Math.toDegrees(t.latitude);var n=t.height;var a={lon:r,lat:i,height:n};return a};l.prototype.getData=function(){return{area:this._data}};l.prototype.setData=function(e){if(!e)return;var t=true;var r=false;var i=undefined;try{for(var n=(0,C.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._currentType=o.type;this.addArea(o.pointsC)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};l.prototype.xyzCenter=function(e){var t=Number.MAX_VALUE;var r=Number.MAX_VALUE;var i=Number.MAX_VALUE;var n=-Number.MAX_VALUE;var a=-Number.MAX_VALUE;var o=-Number.MAX_VALUE;if(e.length==0){console.error("只有一个点，无法计算")}else if(e.length==1){console.error("有两个点，无法计算")}else{for(var s=0;s<e.length;s++){if(e[s].x<t){t=e[s].x}if(e[s].y<r){r=e[s].y}if(e[s].z<i){i=e[s].z}if(e[s].x>n){n=e[s].x}if(e[s].y>a){a=e[s].y}if(e[s].z>o){o=e[s].z}}var l=new Freedo.Cartesian3((n+t)/2,(a+r)/2,(o+i)/2);if(this._viewer.scene.globe&&this._currentType!="OnModel"){var u=this._viewer.scene.globe.ellipsoid;var d=u.cartesianToCartographic(l);var c=Freedo.Math.toDegrees(d.longitude);var f=Freedo.Math.toDegrees(d.latitude);var h=d.height;return{lon:c,lat:f,height:h}}else{return{lon:l.x,lat:l.y,height:l.z}}}};l.prototype.calcArea3D=function(e){var t,r,i;t=e.length;r=Freedo.clone(e,true);r.push(e[0]);r.push(e[1]);var n=new Freedo.Cartesian3;var a=Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3);var o=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);i=Freedo.Cartesian3.cross(a,o,new Freedo.Cartesian3);i=Freedo.Cartesian3.normalize(i,new Freedo.Cartesian3);var s=0;var l,u,d,c;var f;var h,p,v;u=i.x>0?i.x:-i.x;d=i.y>0?i.y:-i.y;c=i.z>0?i.z:-i.z;f=3;if(u>d){if(u>c)f=1}else if(d>c)f=2;for(h=1,p=2,v=0;h<=t;h++,p++,v++){switch(f){case 1:s+=r[h].y*(r[p].z-r[v].z);continue;case 2:s+=r[h].x*(r[p].z-r[v].z);continue;case 3:s+=r[h].x*(r[p].y-r[v].y);continue}}l=Math.sqrt(u*u+d*d+c*c);switch(f){case 1:s*=l/(2*u);break;case 2:s*=l/(2*d);break;case 3:s*=l/(2*c)}return s};l.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel();this._event.raiseEvent("Cancel",{})};l.prototype.removeAll=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,C.default)(this._polygons),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.entities.remove(a);this._viewer.scene.primitives.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,C.default)(this._polygons3D),d;!(o=(d=u.next()).done);o=true){var a=d.value;this._viewer.scene.primitives.remove(a)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var c=true;var f=false;var h=undefined;try{for(var p=(0,C.default)(this._labels),v;!(c=(v=p.next()).done);c=true){var a=v.value;this._viewer.entities.remove(a)}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}this._polygons=[];this._polygons3D=[];this._labels=[];this._data=[];this._ple.removeAll();this._viewer.scene.requestRender()};l.prototype.dispose=function(){this.reset();this.removeAll()};t.FdAnalysisArea=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTransformManipulator=undefined;var i=r(1);var n=o(i);var a=r(5);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t){(0,n.default)(this,e);this._viewer=t;this._bInTransform=false;this._transType="MOVE";this._bInRun=false;this._xAxisPL=undefined;this._yAxisPL=undefined;this._zAxisPL=undefined;this._XYPlane=undefined;this._XYCirclePlane=undefined;this._YZPlane=undefined;this._XZPlane=undefined;this._XYCircle=undefined;this._XZCircle=undefined;this._YZCircle=undefined;this._basePt=undefined;this._basePtOriPosition=undefined;this._basePtOri=undefined;this._selectedAxis="";this._mouseDownPos=undefined;this._initSphere=undefined;this._useDepthPicking=true;this._pickTranslucentDepth=true;this._fixedAxis="";this._DISPERRAD=111e3;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._oldPt=undefined;this._started=false;this._mouseDown=false;this._lastDis=-1;this._alpha=.5;this._axisZoom=1;this._axisSize=4;this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3};this._handler=undefined;this._mouseDownXY=undefined;this._xPts=undefined};s.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};s.prototype.startTransform=function(e){this._transType=e;if(this._bInTransform)return;this._bInTransform=true;this.addListeners();this._bInRun=true};s.prototype.start=function(e){this.startTransform(e)};s.prototype.createLinePrimitive=function(e){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:6,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineArrow",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",width:1,uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})};s.prototype.redraw=function(){this.calcAxisZoom()};s.prototype.updateSceneSphere=function(e){this._initSphere=Freedo.clone(e,true);if(this._xAxisPL===undefined)this.showAxis()};s.prototype.updatePosition=function(e,t,r){var i=Freedo.Cartesian3.fromDegrees(e,t,r);this._initSphere={center:i};if(this._xAxisPL===undefined)this.showAxis()};s.prototype.updateBasePt=function(e,t,r){this._basePtOriPosition=Freedo.Cartesian3.fromDegrees(e,t,r)};s.prototype.cancelTransform=function(){this.reset()};s.prototype.cancel=function(){this.reset()};s.prototype.addListeners=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.onLeftDown.bind(this),Freedo.ScreenSpaceEventType.LEFT_DOWN);this._handler.setInputAction(this.onMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._handler.setInputAction(this.onLeftUp.bind(this),Freedo.ScreenSpaceEventType.LEFT_UP);this._handler.setInputAction(this.onWheel.bind(this),Freedo.ScreenSpaceEventType.WHEEL);this._handler.setInputAction(this.onClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);var e=this;this._viewer.scene.camera.changed.addEventListener(s.prototype.onWheel,this);window.addEventListener("keydown",this.onKeyDown.bind(this))};s.prototype.calcFixedAxis=function(){if(this._selectedAxis==="X_AXIS"){this._fixedAxis="X";return}if(this._selectedAxis==="Y_AXIS"){this._fixedAxis="Y";return}if(this._selectedAxis==="Z_AXIS"){this._fixedAxis="Z";return}};s.prototype.calcAxisZoom=function(){if(this._bInTransform===false){this._axisZoom=1;return}if(!this._initSphere)return;var e=this._initSphere.center;var t=this._viewer.camera.positionWC;var r=1;r=Freedo.Cartesian3.distance(e,t)/this._axisSize;this._axisZoom=r;if(this._viewer.scene._mode===Freedo.SceneMode.COLUMBUS_VIEW)this._axisZoom=this._viewer.camera.positionWC.x/3;if(this._axisZoom>4e5)this._axisZoom=4e5};s.prototype.setAxisSize=function(e){this._axisSize=e};s.prototype.onWheel=function(){if(this._bInTransform===false)return;this.calcAxisZoom()};s.prototype.onKeyDown=function(){if(this._bInTransform===false)return;if(window.event.keyCode===27){if(this._selectedAxis!==""){this._event.raiseEvent("OnKeyDown",{keyCode:window.event.keyCode});this._selectedAxis="";this.onLeftUp()}}};s.prototype.onMouseMove=function(e){if(this._selectedAxis!=""){var t=undefined;var r=["XY_QCIRCLE","XY","XY_CIRCLE","X_AXIS","Y_AXIS","Z_AXIS"];var i=["YZ","YZ_CIRCLE"];var n=["XZ","XZ_CIRCLE"];if(r.indexOf(this._selectedAxis)>-1)t=this.pickPositionOnEllipsoid(e.endPosition);if(i.indexOf(this._selectedAxis)>-1)if(this._selectedAxis==="YZ"||this._selectedAxis==="YZ_CIRCLE")t=this.pickPositionOnPlane(e.endPosition,"YZ");if(n.indexOf(this._selectedAxis)>-1)if(this._selectedAxis==="XZ"||this._selectedAxis==="XZ_CIRCLE")t=this.pickPositionOnPlane(e.endPosition,"XZ");this._event.raiseEvent("Transforming",{MouseDownPos:this._mouseDownPos,MouseMovePos:t,MouseDownXY:this._mouseDownXY,MouseMoveXY:e.endPosition,SelectedAxis:this._selectedAxis,FixedAxis:this._fixedAxis});return}};s.prototype.onClick=function(e){var t=this.pickPosition(e.position);this._event.raiseEvent("GotoPoint",t)};s.prototype.onLeftDown=function(e){if(!this._bInTransform)return;var t=["X_AXIS","Y_AXIS","Z_AXIS","YZ","XZ","XY_QCIRCLE","XY","XY_CIRCLE","YZ_CIRCLE","XZ_CIRCLE"];this._mouseDown=true;this._oldPt=undefined;this._started=false;this._lastDis=-1;var r=this._viewer.scene.pick(e.position);if(!Freedo.defined(r)){return}if(Freedo.defined(r.id)&&Freedo.defined(r.id._name)){var i=r.id._name;if((i==="X_AXIS"||i==="Y_AXIS"||i==="Z_AXIS")&&this._transType.indexOf("MOVE")>=0){r.id.polyline.material.color=new Freedo.Color(1,1,0,1)}if(i==="YZ"||i==="XZ"){r.id.wall.material.color=new Freedo.Color(1,0,0,.2)}if(i==="XY_QCIRCLE"||i==="XY"){r.id.polygon.material.color=new Freedo.Color(1,1,0,1)}if(i==="XY_CIRCLE"||i==="YZ_CIRCLE"||i==="XZ_CIRCLE"){r.id.polyline.material.color=new Freedo.Color(1,1,0,1)}if(t.indexOf(i)>-1){this._selectedAxis=Freedo.clone(i,true);this._viewer.scene.screenSpaceCameraController.enableRotate=false;this._viewer.scene.screenSpaceCameraController.enableLook=false;this._mouseDownPos=undefined;this._event.raiseEvent("Transform",{})}}var n=["XY_QCIRCLE","XY","XY_CIRCLE","X_AXIS","Y_AXIS"];var a=["YZ","YZ_CIRCLE"];var o=["XZ","XZ_CIRCLE","Z_AXIS"];if(n.indexOf(this._selectedAxis)>-1){this._mouseDownPos=this.pickPositionOnEllipsoid(e.position);if(this._transType.indexOf("MOVE")>=0)this.calcFixedAxis()}if(a.indexOf(this._selectedAxis)>-1){this._mouseDownPos=this.pickPositionOnPlane(e.position,"YZ");if(this._transType.indexOf("MOVE")>=0)this.calcFixedAxis()}if(o.indexOf(this._selectedAxis)>-1){this._mouseDownPos=this.pickPositionOnPlane(e.position,"XZ");if(this._transType.indexOf("MOVE")>=0)this.calcFixedAxis()}if(this._fixedAxis==="X"){this._xAxisPL.polyline.material.color=Freedo.Color.YELLOW}if(this._fixedAxis==="Y"){this._yAxisPL.polyline.material.color=Freedo.Color.YELLOW}if(this._fixedAxis==="Z"){this._zAxisPL.polyline.material.color=Freedo.Color.YELLOW}this._mouseDownXY=e.position};s.prototype.backToEnableRotate=function(e){if(this._selectedAxis===""){this._viewer.scene.screenSpaceCameraController.enableRotate=true;this._viewer.scene.screenSpaceCameraController.enableLook=true}};s.prototype.onLeftUp=function(e){setTimeout(this.backToEnableRotate.bind(this),500);this._mouseDownPos=undefined;this._mouseDown=false;switch(this._selectedAxis){case"XY_QCIRCLE":this._XYCirclePlane.polygon.material.color=new Freedo.Color(0,0,1,this._alpha);break;case"XY":this._XYPlane.polygon.material.color=new Freedo.Color(0,0,1,this._alpha);break;case"XY_CIRCLE":this._XYCircle.polyline.material.color=new Freedo.Color(0,0,1,this._alpha);break;case"XZ_CIRCLE":this._XZCircle.polyline.material.color=new Freedo.Color(0,1,0,this._alpha);break;case"YZ_CIRCLE":this._YZCircle.polyline.material.color=new Freedo.Color(1,0,0,this._alpha);break;case"X_AXIS":this._xAxisPL.polyline.material.color=Freedo.Color.RED;break;case"Y_AXIS":this._yAxisPL.polyline.material.color=Freedo.Color.GREEN;break;case"Z_AXIS":this._zAxisPL.polyline.material.color=Freedo.Color.BLUE}if(this._selectedAxis!==""){this._event.raiseEvent("Transformed",{})}this.calcAxisZoom();this._selectedAxis="";this._fixedAxis=""};s.prototype.clearAxis2=function(){if(this._xAxisPL!=undefined){this._viewer.entities.remove(this._basePt);this._viewer.entities.remove(this._basePtOri);this._viewer.scene.primitives.remove(this._xAxisPL);this._viewer.scene.primitives.remove(this._yAxisPL);this._viewer.scene.primitives.remove(this._zAxisPL);this._viewer.entities.remove(this._XZPlane);this._viewer.entities.remove(this._YZPlane);this._viewer.entities.remove(this._XYPlane);this._viewer.entities.remove(this._XYCircle);this._viewer.entities.remove(this._XZCircle);this._viewer.entities.remove(this._YZCircle)}this._basePt=undefined;this._basePtOri=undefined;this._xAxisPL=undefined;this._yAxisPL=undefined;this._zAxisPL=undefined;this._XZPlane=undefined;this._YZPlane=undefined;this._XYPlane=undefined;this._XYCircle=undefined;this._XZCircle=undefined;this._YZCircle=undefined;this._selectedAxis=""};s.prototype.clearAxis=function(){if(this._xAxisPL!=undefined){this._viewer.entities.remove(this._basePt);this._viewer.entities.remove(this._basePtOri);this._viewer.entities.remove(this._xAxisPL);this._viewer.entities.remove(this._yAxisPL);this._viewer.entities.remove(this._zAxisPL);this._viewer.entities.remove(this._XZPlane);this._viewer.entities.remove(this._YZPlane);this._viewer.entities.remove(this._XYPlane);this._viewer.entities.remove(this._XYCirclePlane);this._viewer.entities.remove(this._XYCircle);this._viewer.entities.remove(this._XZCircle);this._viewer.entities.remove(this._YZCircle)}this._basePt=undefined;this._basePtOri=undefined;this._xAxisPL=undefined;this._yAxisPL=undefined;this._zAxisPL=undefined;this._XZPlane=undefined;this._YZPlane=undefined;this._XYPlane=undefined;this._XYCirclePlane=undefined;this._XYCircle=undefined;this._XZCircle=undefined;this._YZCircle=undefined;this._selectedAxis=""};var l=undefined;var m=undefined;var _=undefined;var c=undefined;var f=undefined;var h=undefined;s.prototype.calcCallbackArgs=function(){l=this._initSphere.center;_=Freedo.Cartographic.fromCartesian(l);c=Freedo.Math.toDegrees(_.longitude);f=Freedo.Math.toDegrees(_.latitude);h=_.height;m=this._axisZoom;this._viewer.scene.requestRender()};s.prototype.pickPositionOnEllipsoid=function(e){var t=Freedo.Cartographic.fromCartesian(this._initSphere.center);var r=Freedo.clone(Freedo.Ellipsoid.WGS84,true);r.radii.x+=t.height;r.radii.y+=t.height;r.radii.z+=t.height;var i=new Freedo.Ellipsoid(r.radii.x,r.radii.y,r.radii.z);var n=this._viewer.camera.pickEllipsoid(e,i,new Freedo.Cartesian3);if(n===undefined)return undefined;var a=Freedo.Cartographic.fromCartesian(n);return a};s.prototype.pickPositionOnPlane=function(e,t){this.calcCallbackArgs();var r=this._axisZoom*1e-5;var i=Freedo.Cartesian3.fromRadians(_.longitude-r,_.latitude,-2e3);var n=Freedo.Cartesian3.fromRadians(_.longitude,_.latitude,_.height+m*.95+1e3);var a=Freedo.Cartesian3.fromRadians(_.longitude+r,_.latitude,-2e3);if(t==="YZ"){i=Freedo.Cartesian3.fromRadians(_.longitude,_.latitude-r,-2e3);n=Freedo.Cartesian3.fromRadians(_.longitude,_.latitude,_.height+m*.95+1e3);a=Freedo.Cartesian3.fromRadians(_.longitude,_.latitude+r,-2e3)}var o=this._viewer.camera.getPickRay(e);var s=0;var l=0;var u=0;var d=Freedo.Cartographic.fromCartesian(this._initSphere.center);s=Math.cos(d.longitude);l=Math.sin(d.longitude);var c=new Freedo.Plane.fromPointNormal(new Freedo.Cartesian3(0,0,0),new Freedo.Cartesian3(s,l,u));var f={};f.x=o.origin.x+o.direction.x*1e6;f.y=o.origin.y+o.direction.y*1e6;f.z=o.origin.z+o.direction.z*1e6;if(0){var h}var p=Freedo.IntersectionTests.lineSegmentTriangle(o.origin,f,i,n,a);if(p===undefined)return undefined;if(0){}var v=Freedo.Cartographic.fromCartesian(p);return v};s.prototype.pickPosition=function(e){var t,r=this.PositionType.NONE;var i,n;if(this._viewer.scene.pickPositionSupported){var i=this._viewer.scene.drillPick(e);if(Freedo.defined(i)&&i.length>0){for(var a=0;a<i.length;++a){if(i[a]instanceof Freedo.FreedoPModelFeature){t=this._viewer.scene.pickPosition(e);if(Freedo.defined(t)){r=this.PositionType.ON_MODEL;break}}}}}if(r===this.PositionType.NONE){this._useDepthPicking=Freedo.clone(this._viewer.scene.useDepthPicking,true);this._pickTranslucentDepth=Freedo.clone(this._viewer.scene.pickTranslucentDepth,true);if(this._viewer.scene.pickPositionSupported){t=this._viewer.scene.pickPosition(e,new Freedo.Cartesian3);var o=Freedo.Cartographic.fromCartesian(t);if(Freedo.defined(t))r=this.PositionType.ON_TERRAIN}this._viewer.scene.useDepthPicking=Freedo.clone(this._useDepthPicking,true);this._viewer.scene.pickTranslucentDepth=Freedo.clone(this._pickTranslucentDepth,true)}if(r===this.PositionType.NONE){t=this._viewer.camera.pickEllipsoid(e,this._viewer.scene.globe.ellipsoid);if(Freedo.defined(t))r=this.PositionType.ON_ELLIPSOID}return{type:r,position:t}};s.prototype.callbackXY=function(e,t){this.calcCallbackArgs();var r=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var i=Freedo.Math.toDegrees(m*.5*r[0]);var n=Freedo.Math.toDegrees(m*.5*r[1]);t=Freedo.Cartesian3.fromDegreesArray([c,f,c-i,f,c-i,f-n,c,f-n,c,f]);return new Freedo.PolygonHierarchy(t)};s.prototype.callbackQXY=function(e,t){this.calcCallbackArgs();var r=[];var i=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var n=Freedo.Math.toDegrees(m*.55*i[0]);var a=Freedo.Math.toDegrees(m*.55*i[1]);r.push(Freedo.Cartesian3.fromRadians(_.longitude,_.latitude,_.height));for(var o=0;o<=Math.PI/2;o=o+.001){var s=c+n*Math.cos(o);var l=f+a*Math.sin(o);var u=Freedo.Cartesian3.fromDegrees(s,l,h);r.push(u)}t=r;return new Freedo.PolygonHierarchy(t)};s.prototype.callbackXYHalfCircle=function(e,t){this.calcCallbackArgs();var r=[];var i=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var n=Freedo.Math.toDegrees(m*.65*i[0]);var a=Freedo.Math.toDegrees(m*.65*i[1]);for(var o=0;o<=Math.PI/2;o=o+.001){var s=c+n*Math.cos(o);var l=f+a*Math.sin(o);var u=Freedo.Cartesian3.fromDegrees(s,l,h);r.push(u)}t=r;return t};s.prototype.callbackXZHalfCircle=function(e,t){this.calcCallbackArgs();var r=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var i=Freedo.Math.toDegrees(m*.65*r[0]);var n=Freedo.Math.toDegrees(m*.65*r[1]);var a=[];for(var o=Math.PI/2;o>=0;o=o-.001){var s=c+i*Math.cos(o);var l=f;var u=h+m*.65*Math.sin(o);var d=Freedo.Cartesian3.fromDegrees(s,l,u);a.push(d)}t=a;return t};s.prototype.callbackYZHalfCircle=function(e,t){this.calcCallbackArgs();var r=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var i=Freedo.Math.toDegrees(m*.65*r[0]);var n=Freedo.Math.toDegrees(m*.65*r[1]);var a=[];for(var o=Math.PI/2;o>=0;o=o-.001){var s=c;var l=f+n*Math.cos(o);var u=h+m*.65*Math.sin(o);var d=Freedo.Cartesian3.fromDegrees(s,l,u);a.push(d)}t=a;return t};s.prototype.callbackXYShow=function(e,t){this.calcCallbackArgs();t=true;if(this._selectedAxis=="XY_CIRCLE")t=false;return t};s.prototype.callbackXYH=function(e,t){return h+.1};s.prototype.callbackXZ=function(e,t){this.calcCallbackArgs();var r=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var i=Freedo.Math.toDegrees(m*.5*r[0]);t=Freedo.Cartesian3.fromDegreesArray([c,f,c+i,f]);return t};s.prototype.callbackXZMinimumHeights=function(e,t){this.calcCallbackArgs();t=[h,h];return t};s.prototype.callbackXZMaximumHeights=function(e,t){this.calcCallbackArgs();t=[h+m*.5,h+m*.5];return t};s.prototype.callbackYZ=function(e,t){this.calcCallbackArgs();t=Freedo.Cartesian3.fromDegreesArray([c,f,c,f+m*.5/this._DISPERRAD]);return t};s.prototype.callbackXYCCBP=function(e,t){this.calcCallbackArgs();t=Freedo.Cartesian3.fromDegrees(c,f);return t};s.prototype.callbackX=function(e,t){this.calcCallbackArgs();var r=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(_);var i=Freedo.Math.toDegrees(m*r[0]);t=Freedo.Cartesian3.fromDegreesArrayHeights([c,f,h,c+i,f,h]);return t};s.prototype.callbackY=function(e,t){this.calcCallbackArgs();t=Freedo.Cartesian3.fromDegreesArrayHeights([c,f,h,c,f+m/this._DISPERRAD,h]);return t};s.prototype.callbackZ=function(e,t){this.calcCallbackArgs();t=Freedo.Cartesian3.fromDegreesArrayHeights([c,f,h,c,f,h+m]);return t};s.prototype.callbackH=function(e,t){this.calcCallbackArgs();t=h;return t};s.prototype.callbackBasePt=function(e,t){this.calcCallbackArgs();t=l.clone();return t};s.prototype.callbackBasePtOri=function(e,t){t=this._basePtOriPosition.clone();return t};s.prototype.showAxis=function(){this.clearAxis();this.calcAxisZoom();var e=new Freedo.CallbackProperty(this.callbackXY.bind(this),false);var t=new Freedo.CallbackProperty(this.callbackQXY.bind(this),false);var r=new Freedo.CallbackProperty(this.callbackXYHalfCircle.bind(this),false);var i=new Freedo.CallbackProperty(this.callbackXZHalfCircle.bind(this),false);var n=new Freedo.CallbackProperty(this.callbackYZHalfCircle.bind(this),false);var a=new Freedo.CallbackProperty(this.callbackXYShow.bind(this),false);var o=new Freedo.CallbackProperty(this.callbackXYH.bind(this),false);var s=new Freedo.CallbackProperty(this.callbackXZ.bind(this),false);var l=new Freedo.CallbackProperty(this.callbackXZMaximumHeights.bind(this),false);var u=new Freedo.CallbackProperty(this.callbackXZMinimumHeights.bind(this),false);var d=new Freedo.CallbackProperty(this.callbackYZ.bind(this),false);var c=new Freedo.CallbackProperty(this.callbackXYCCBP.bind(this),false);var f=new Freedo.CallbackProperty(this.callbackX.bind(this),false);var h=new Freedo.CallbackProperty(this.callbackY.bind(this),false);var p=new Freedo.CallbackProperty(this.callbackZ.bind(this),false);var v=new Freedo.CallbackProperty(this.callbackH.bind(this),false);var m=new Freedo.CallbackProperty(this.callbackBasePt.bind(this),false);var _=new Freedo.CallbackProperty(this.callbackBasePtOri.bind(this),false);this._basePt=this._viewer.entities.add({position:m,point:{pixelSize:10,color:Freedo.Color.YELLOW.withAlpha(.9)}});this._basePtOri=this._viewer.entities.add({name:"xxxx",position:_,point:{pixelSize:10,color:Freedo.Color.GREEN.withAlpha(.9)}});this._xAxisPL=this._viewer.entities.add({name:"X_AXIS",polyline:{positions:f,width:16,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.RED)}});this._yAxisPL=this._viewer.entities.add({name:"Y_AXIS",polyline:{positions:h,width:16,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.GREEN)}});this._zAxisPL=this._viewer.entities.add({name:"Z_AXIS",polyline:{positions:p,width:16,show:true,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.BLUE)}});if(this._transType.indexOf("SCALE")>=0){this._XYCirclePlane=this._viewer.entities.add({name:"XY_QCIRCLE",polygon:{hierarchy:t,height:v,outline:false,show:true,outlineColor:Freedo.Color.WHITE,outlineWidth:0,material:new Freedo.Color(0,0,1,this._alpha)}})}if(this._transType.indexOf("MOVE")>=0){this._XYPlane=this._viewer.entities.add({name:"XY",polygon:{hierarchy:e,height:v,outline:false,show:true,outlineColor:Freedo.Color.WHITE,outlineWidth:0,material:new Freedo.Color(0,0,1,this._alpha)}})}if(this._transType.indexOf("ROTATE")>=0){this._XYCircle=this._viewer.entities.add({name:"XY_CIRCLE",polyline:{positions:r,width:4,show:true,material:new Freedo.Color(0,0,1,this._alpha)}})}if(this._transType.indexOf("ROTATE")>=0){this._XZCircle=this._viewer.entities.add({name:"XZ_CIRCLE",polyline:{positions:i,width:4,show:true,material:new Freedo.Color(0,1,0,this._alpha)}});this._YZCircle=this._viewer.entities.add({name:"YZ_CIRCLE",polyline:{positions:n,width:4,show:true,material:new Freedo.Color(1,0,0,this._alpha)}})}};s.prototype.reset=function(){if(this._handler!==undefined&&!this._handler.isDestroyed())this._handler.destroy();this._viewer.scene.camera.changed.removeEventListener(s.prototype.onWheel,this);this._bInTransform=false;this.clearAxis();this._mouseDownPos=undefined;this._initSphere=undefined;this._fixedAxis=""};s.prototype.dispose=function(){this.reset()};t.FdTransformManipulator=s},function(e,t){e.exports=function e(t){return t&&typeof t==="object"&&typeof t.copy==="function"&&typeof t.fill==="function"&&typeof t.readUInt8==="function"}},function(e,t){if(typeof Object.create==="function"){e.exports=function e(t,r){t.super_=r;t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{e.exports=function e(t,r){t.super_=r;var i=function(){};i.prototype=r.prototype;t.prototype=new i;t.prototype.constructor=t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisHeight=undefined;var i=r(3);var s=d(i);var n=r(18);var a=d(n);var o=r(1);var l=d(o);var u=r(5);function d(e){return e&&e.__esModule?e:{default:e}}var c=function e(t){(0,l.default)(this,e);this._viewer=t;this._data=[];this._collection=this._viewer.scene.primitives.add(new Freedo.PrimitiveCollection);this._points=this._collection.add(new Freedo.PointPrimitiveCollection);this._labels=this._collection.add(new Freedo.LabelCollection);this._points.validWhenPicking=false;this._labels.validWhenPicking=false;this._vLines=[];this._bInSurvey=false;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._tmpPoint=undefined;this._tmpPosition=undefined;this._tmpLabel=undefined;this._tmpVLine=undefined};c.prototype.addPoint=function(e){var t=Freedo.FdMisc.FdGeometric.tc(e);if(!Freedo.defined(this._viewer.scene.globe))t={x:e[0],y:e[1],z:e[2]};this._points.add({position:t,color:Freedo.Color.YELLOW,pixelSize:5,disableDepthTestDistance:Number.POSITIVE_INFINITY});var r=Freedo.FdMisc.FdMath.round;var i;if(this._viewer.scene.globe)this.createLabel(t,"高度："+r(e[2],4));else this.createLabel(t,"X："+r(e[0],8)+"\n"+"Y："+r(e[1],8)+"\n"+"Z："+r(e[2],4));if(this._viewer.scene.globe){var n=Freedo.FdMisc.FdGeometric.tc([e[0],e[1],0]);var a=this._viewer.scene.primitives.add(this.createLinePrimitive([t,n]));this._vLines.push(a)}var o={};o.pointG=[r(e[0],8),r(e[1],8),r(e[2],8)];o.pointC=t;this._data.push(o);this._event.raiseEvent("HeightPoint",{point:e});this._event.raiseEvent("DataChanged",o);this._viewer.scene.requestRender()};c.prototype.createLinePrimitive=function(e){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,0,0,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.5,.5,.5)}}})})})};c.prototype.callbackPosition=function(){return Freedo.FdMisc.FdGeometric.tc(this._tmpPosition)};c.prototype.callbackPositionHalf=function(){return Freedo.FdMisc.FdGeometric.tc(this._tmpPosition)};c.prototype.callbackVLine=function(){var e=Freedo.clone(this._tmpPosition,true);e[2]=0;return[Freedo.FdMisc.FdGeometric.tc(this._tmpPosition),Freedo.FdMisc.FdGeometric.tc(e)]};c.prototype.callbackVLineText=function(){if(!Freedo.defined(this._tmpPosition))return"";var e=Freedo.FdMisc.FdMath.round;return"高程："+e(this._tmpPosition[2],2)};c.prototype.updateTmpPoint=function(){if(this._tmpPoint==undefined){var e=new Freedo.CallbackProperty(this.callbackPosition.bind(this),false);this._tmpPoint=this._viewer.entities.add({position:e,point:{color:Freedo.Color.YELLOW,pixelSize:5,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:false}})}if(this._tmpLabel==undefined){var t=new Freedo.CallbackProperty(this.callbackPositionHalf.bind(this),false);var r=new Freedo.CallbackProperty(this.callbackVLineText.bind(this),false);this._tmpLabel=this._viewer.entities.add({position:t,label:u.FdMisc.getLabelOpt(r)})}if(this._tmpVLine==undefined){var e=new Freedo.CallbackProperty(this.callbackVLine.bind(this),false);this._tmpVLine=this._viewer.entities.add({polyline:{positions:e,width:2,show:false,material:Freedo.Color.RED,depthFailMaterial:Freedo.Color.RED}})}this._viewer.scene.requestRender()};c.prototype.createLabel=function(e,t){var r=u.FdMisc.getLabelOpt(t);var i=(0,a.default)({position:e},r);return this._labels.add(i)};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.handleLeftClick=function(e){if(this._bInSurvey==false)return;if(this._tmpPosition){this.addPoint(this._tmpPosition)}};c.prototype.handleMouseMove=function(e){if(this._bInSurvey==false)return;var t=e.endPosition;t.x-=0;t.y-=0;var r=Freedo.FdMisc.FdGeometric.pickPositionG(this._viewer,t);if(r)this._tmpPosition=r;else{}this.updateTmpPoint()};c.prototype.getData=function(){return{height:Freedo.clone(this._data,true)}};c.prototype.setData=function(e){if(!e)return;var t=true;var r=false;var i=undefined;try{for(var n=(0,s.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this.addPoint(o.pointG)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};c.prototype.run=function(e){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.handleLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(this.handleMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._bInSurvey=true};c.prototype.delTmpEntities=function(){this._viewer.entities.remove(this._tmpLabel);this._viewer.entities.remove(this._tmpPoint);this._viewer.entities.remove(this._tmpVLine);this._tmpPoint=undefined;this._tmpPosition=undefined;this._tmpLabel=undefined;this._tmpVLine=undefined;this._viewer.scene.requestRender()};c.prototype.reset=function(){this._bInSurvey=false;this._handler.removeInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK);this.delTmpEntities()};c.prototype.removeAll=function(){this._points.removeAll();this._labels.removeAll();var e=true;var t=false;var r=undefined;try{for(var i=(0,s.default)(this._vLines),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.scene.primitives.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this.delTmpEntities();this._data=[]};c.prototype.dispose=function(){this.reset();this.removeAll()};t.FdAnalysisHeight=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisAngle=undefined;var i=r(3);var m=s(i);var n=r(1);var a=s(n);var h=r(5);var o=r(10);function s(e){return e&&e.__esModule?e:{default:e}}var l=function e(t){(0,a.default)(this,e);this._viewer=t;this._scene=this._viewer.scene;this._entsOnEarth=[];this._ents=[];this._labels=[];this._polylines=[];this._data=[];this._lsner=undefined;this._currentType=undefined;this._ple=new o.FdPolylineEditor(t);this._ple.setAutoDelLines(true);this._ple.setHeightOffset(0);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._tmpPts=[]};l.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};l.prototype.run=function(e){this._ple.run();if(this._lsner){this._lsner();this._lsner=undefined}var i=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){}if(e=="PointAdded"){if(i._currentType==undefined){if(Freedo.defined(t.position[3])&&t.position[3]==0){i._currentType="OnModel"}else i._currentType="OnEarth"}if(i._tmpPts.length<3){var r=Freedo.FdMisc.FdGeometric.tc(t.position);i._tmpPts.push(r)}if(i._tmpPts.length==3){i._ple.forceFinish();i.addAngle(Freedo.clone(i._tmpPts,true));i._tmpPts=[]}}});this._event.raiseEvent("Start",{})};l.prototype.calcRelArcPts=function(e,t,r){var i=Freedo.Cartesian3.subtract(e,t,new Freedo.Cartesian3);var n=Freedo.Cartesian3.subtract(r,t,new Freedo.Cartesian3);var a=Freedo.Cartesian3.lerp(t,e,.5,new Freedo.Cartesian3);var o=Freedo.Cartesian3.cross(i,n,new Freedo.Cartesian3);var s=[];var l=Freedo.Cartesian3.angleBetween(i,n);for(var u=0;u<l;u=u+.01){var d=Freedo.Quaternion.fromAxisAngle(o,u);var c=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,d,new Freedo.Cartesian3(1,1,1));var f=Freedo.Matrix4.multiplyByPointAsVector(c,a,new Freedo.Cartesian3);s.push(f)}return s};l.prototype.calcArcPts=function(e){var t,r,i;if(e.length!=3){console.error("calcArcPts:计算夹角需要三个点");return}t=e[0];r=Freedo.clone(e[1],true);i=e[2];t=Freedo.Cartesian3.subtract(t,r,new Freedo.Cartesian3);i=Freedo.Cartesian3.subtract(i,r,new Freedo.Cartesian3);r.x=0;r.y=0;r.z=0;var n=Freedo.Cartesian3.distance(r,t);var a=Freedo.Cartesian3.distance(r,i);var o=[];if(n<a){o=this.calcRelArcPts(t,r,i)}else{o=this.calcRelArcPts(i,r,t)}var s=[];s.push(e[1]);for(var l=0;l<o.length;l++){var u=Freedo.Cartesian3.add(o[l],e[1],new Freedo.Cartesian3);s.push(u)}s.push(e[1]);return s};l.prototype.addAngle=function(e){var t=[];var r=Freedo.Cartesian3.subtract(e[0],e[1],new Freedo.Cartesian3);var i=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);var n=Freedo.Cartesian3.angleBetween(r,i);n=Freedo.Math.toDegrees(n);n=Freedo.FdMisc.FdMath.round(n,2);t=this.calcArcPts(e);var a;var o;if(this._currentType=="OnEarth"||this._currentType==""||this._currentType==undefined){a=this._viewer.entities.add({name:"AREAGEO",polygon:{hierarchy:new Freedo.PolygonHierarchy(t),material:Freedo.Color.ORANGE.withAlpha(.5),outline:true,outlineColor:Freedo.Color.BLACK}});o=this._viewer.scene.primitives.add(Freedo.FdMisc.FdGeometric.createPolylinePrimitive(e));this._entsOnEarth.push(a);this._ents.push(o)}else{var s=h.FdMisc.FdMath.addDelta2Height(t);a=this._viewer.scene.primitives.add(Freedo.FdMisc.FdGeometric.createAreaPrimitive(s));o=this._viewer.scene.primitives.add(Freedo.FdMisc.FdGeometric.createPolylinePrimitive(e));this._ents.push(a);this._ents.push(o)}var l=this.xyzCenter(t);var u=this._viewer.entities.add({label:h.FdMisc.getLabelOpt("")});u.label.text=n+"度";if(this._viewer.scene.globe&&this._currentType!="OnModel")u.position=Freedo.Cartesian3.fromDegrees(l.lon,l.lat,l.height);else u.position=new Freedo.Cartesian3(l.lon,l.lat,l.height);u.label.show=true;this._labels.push(u);var d=[];for(var c=0;c<e.length;c++){d.push(Freedo.FdMisc.FdGeometric.tg(e[c]))}var f={pointsG:d,pointsC:e,angle:n,type:this._currentType};this._data.push(f);this._event.raiseEvent("DataChanged",f);this._viewer.scene.requestRender();this._currentType=undefined};l.prototype.getData=function(){return{angle:this._data}};l.prototype.setData=function(e){if(!e)return;var t=true;var r=false;var i=undefined;try{for(var n=(0,m.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._currentType=o.type;this.addAngle(o.pointsC)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};l.prototype.xyzCenter=function(e){var t=Number.MAX_VALUE;var r=Number.MAX_VALUE;var i=Number.MAX_VALUE;var n=-Number.MAX_VALUE;var a=-Number.MAX_VALUE;var o=-Number.MAX_VALUE;if(e.length==0){console.error("只有一个点，无法计算")}else if(e.length==1){console.error("有两个点，无法计算")}else{for(var s=0;s<e.length;s++){if(e[s].x<t){t=e[s].x}if(e[s].y<r){r=e[s].y}if(e[s].z<i){i=e[s].z}if(e[s].x>n){n=e[s].x}if(e[s].y>a){a=e[s].y}if(e[s].z>o){o=e[s].z}}var l=new Freedo.Cartesian3((n+t)/2,(a+r)/2,(o+i)/2);if(this._viewer.scene.globe&&this._currentType!="OnModel"){var u=this._viewer.scene.globe.ellipsoid;var d=u.cartesianToCartographic(l);var c=Freedo.Math.toDegrees(d.longitude);var f=Freedo.Math.toDegrees(d.latitude);var h=d.height;return{lon:c,lat:f,height:h}}else{return{lon:l.x,lat:l.y,height:l.z}}}};l.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel();this._event.raiseEvent("Cancel",{})};l.prototype.removeAll=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,m.default)(this._ents),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.scene.primitives.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,m.default)(this._entsOnEarth),d;!(o=(d=u.next()).done);o=true){var a=d.value;this._viewer.entities.remove(a)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var c=true;var f=false;var h=undefined;try{for(var p=(0,m.default)(this._labels),v;!(c=(v=p.next()).done);c=true){var a=v.value;this._viewer.entities.remove(a)}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}this._entsOnEarth=[];this._ents=[];this._labels=[];this._data=[];this._ple.removeAll();this._viewer.scene.requestRender()};l.prototype.dispose=function(){this.reset();this.removeAll()};t.FdAnalysisAngle=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdAnalysisSpatial=undefined;var i=r(3);var l=d(i);var n=r(1);var a=d(n);var o=r(5);var s=r(10);var u=r(83);function d(e){return e&&e.__esModule?e:{default:e}}var c=function e(t){(0,a.default)(this,e);this._viewer=t;this._scene=this._viewer.scene;this._sphere=undefined;this._sphereOutline=undefined;this._boxInfos=[];this._runCallback=undefined;this._endCallBack=undefined;this._data=[];this._ple=new s.FdPolylineEditor(t);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.run=function(e){if(this._endCallBack!=undefined){this._endCallBack();this.removeAll()}this._ple.run();if(this._lsner){this._lsner();this._lsner=undefined}var r=this;var i=1;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){if(i<=1)r._data.center=Freedo.FdMisc.FdGeometric.tc(t.position);else if(i>=2){r._data.radius=Freedo.Cartesian3.distance(r._data.center,Freedo.FdMisc.FdGeometric.tc(t.position));r._ple.cancel();r._ple.removeAll();r.build()}i+=1}});this._event.raiseEvent("Start",{})};c.prototype.setBoxInfos=function(e,t,r){this._boxInfos=e;this._runCallBack=t;this._endCallBack=r};c.prototype.build=function(){var e=this;var t=this._data;var r=t.center;var i=t.radius;this._sphere=this._viewer.scene.primitives.add(Freedo.FdMisc.FdGeometric.createSpherePrimitive(r,i));this._sphereOutline=this._viewer.scene.primitives.add(Freedo.FdMisc.FdGeometric.createSphereOutlinePrimitive(r,i));this.runAnalysis(new Freedo.BoundingSphere(r,i));if(!Freedo.defined(this._screenSpaceEventHandler)){this._screenSpaceEventHandler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._screenSpaceEventHandler.setInputAction(function(){e._endCallBack();e.removeAll()},Freedo.ScreenSpaceEventType.RIGHT_CLICK)}this._viewer.scene.requestRender()};c.prototype.runAnalysis=function(e){if(this._boxInfos.length>0){var t=true;var r=false;var i=undefined;try{for(var n=(0,l.default)(this._boxInfos),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=u.FdMath.boxInSphere(e,o.boxInfo,o.length);if(s==1){this._runCallBack(o.entityInfo)}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}}};c.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel();this._event.raiseEvent("Cancel",{})};c.prototype.removeAll=function(){this._viewer.scene.primitives.remove(this._sphere);this._viewer.scene.primitives.remove(this._sphereOutline);if(Freedo.defined(this._screenSpaceEventHandler)){this._screenSpaceEventHandler.destroy();this._screenSpaceEventHandler=undefined}this._ple.removeAll();this._viewer.scene.requestRender()};c.prototype.clear=function(){this._data=[];this._boxInfos=[];this._runCallBack=undefined;this._endCallBack=undefined;this._sphere=undefined;this._sphereOutline=undefined;this._viewer.scene.requestRender()};c.prototype.getData=function(){};c.prototype.setData=function(e){};c.prototype.dispose=function(){this.reset();this.removeAll();this.clear()};t.FdAnalysisSpatial=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDrawRoad=undefined;var i=r(3);var c=u(i);var n=r(1);var a=u(n);var o=r(2);var s=u(o);var f=r(56);var h=r(5);var l=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function t(e){(0,a.default)(this,t);this._viewer=e;this._scene=this._viewer.scene;this._pts=[];this._roads=[];this._centerLines=[];this._roadsOptions=[];this._lsner=undefined;this._ple=new l.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._handler=undefined;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._level=undefined;this._smoothRate=5;this._nearRate=4;this._hideCenterLine=true;this._currentId=undefined}(0,s.default)(t,[{key:"roadsOptions",get:function e(){return this._roadsOptions},set:function e(t){if(!Freedo.defined(t)){return}this.clearRoads();var r=true;var i=false;var n=undefined;try{for(var a=(0,c.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this.addRoad(s["id"],s["pts"],s["level"],s["width"])}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._event.raiseEvent("DataChanged",this)}}]);return t}();d.prototype.getData=function(){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(this._roadsOptions),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=o.getData();if(s)e.push(s)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}return e};d.prototype.getDataPropName=function(){return"road"};d.prototype.setData=function(e){if(!Freedo.defined(e))return;var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this.add(o.type,o.option,o.id)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};d.prototype.start=function(e,t){if(!Freedo.defined(e)){console.error("start：参数level无效");return}this._level=e;if(!Freedo.defined(t)){this._ple.run();this.addLsnr()}else{for(var r=0;r<t.length;r++){var i=Freedo.FdMisc.FdGeometric.tc(t[r]);this._pts.push(i)}this.addRoad(undefined,this._pts,this._level,5)}this._event.raiseEvent("Start",{})};d.prototype.addLsnr=function(){if(this._lsner)this._lsner();var l=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){l._pts=t.polyline.pts;l.onPLAdd(t)}if(e=="EditEnd"){var r=true;var i=false;var n=undefined;try{for(var a=(0,c.default)(l._roadsOptions),o;!(r=(o=a.next()).done);r=true){var s=o.value;if(l._currentId==s.id){s.pts=Freedo.clone(t.pts)}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}l.reDraw()}})};d.prototype.onPLAdd=function(e){this.addRoad(undefined,e.polyline.pts,this._level,5)};d.prototype.addRoad=function(e,t,r,i){if(!Freedo.defined(t))return;t=h.FdMisc.FdMath.washPts(t);if(!Freedo.defined(e))e=Freedo.createGuid();var n=this.getRoadUrlByLevel(r);var a=[];var o=Freedo.Math.toDegrees;for(var s=0;s<t.length;s++){var l=Freedo.Cartographic.fromCartesian(t[s]);a.push({lon:o(l.longitude),lat:o(l.latitude),height:l.height+3})}var u=this.drawRoad(a,i,n);if(!this._hideCenterLine){var d=this._viewer.scene.primitives.add(this.createLinePrimitive(t));this._centerLines.push(d)}this._roads.push(u);var c={id:e,pts:t,level:r,width:i};this._roadsOptions.push(c);this._event.raiseEvent("RoadAdd",this);this._event.raiseEvent("DataChanged",this)};d.prototype.TransfPointToCartesian3=function(e){var t=[];for(var r=0;r<e.length;r++){t[r]=Freedo.Cartesian3.fromDegrees(e[r].lon,e[r].lat,e[r].height)}return t};var H=new Freedo.Cartesian3;d.prototype.TransfCartesian3ToSelf=function(e){var t=[];for(var r=0;r<e.length;r++){t[r]=new Freedo.Cartesian3(e[r].x-H.x,e[r].y-H.y,e[r].z-H.z)}return t};d.prototype.getPointArray=function(e,t,r){var i=new Freedo.Cartesian3;var n=new Freedo.Cartesian3;var a=new Freedo.Cartesian3;var o=new Freedo.Cartesian3;var s=new Freedo.Cartesian3;var l=new Freedo.Cartesian3;var u=new Freedo.Cartesian3;var d=new Freedo.Cartesian3;var c=new Freedo.Cartesian3;var f=new Freedo.Cartesian3;var h=null;var p=null;var v=[];switch(t.length){case 0:break;case 1:break;case 2:Freedo.Cartesian3.subtract(t[1],t[0],i);Freedo.Cartesian3.cross(e[0],i,a);Freedo.Cartesian3.cross(i,e[0],o);Freedo.Cartesian3.normalize(a,s);Freedo.Cartesian3.normalize(o,l);s.x=s.x*r;s.y=s.y*r;s.z=s.z*r;l.x=l.x*r;l.y=l.y*r;l.z=l.z*r;Freedo.Cartesian3.add(t[0],s,c);Freedo.Cartesian3.add(t[0],l,f);v.push(new Freedo.Cartesian3(c.x,c.y,c.z));v.push(new Freedo.Cartesian3(f.x,f.y,f.z));Freedo.Cartesian3.add(t[1],s,c);Freedo.Cartesian3.add(t[1],l,f);v.push(new Freedo.Cartesian3(c.x,c.y,c.z));v.push(new Freedo.Cartesian3(f.x,f.y,f.z));break;default:for(var m=1;m<t.length-1;m++){Freedo.Cartesian3.subtract(t[m],t[m-1],i);Freedo.Cartesian3.subtract(t[m+1],t[m],n);if(Freedo.Cartesian3.angleBetween(i,n)==0){t.splice(m--,1)}}for(var _=0;_<t.length;_++){if(_==0){Freedo.Cartesian3.subtract(t[_+1],t[_],i);Freedo.Cartesian3.cross(e[_],i,a);Freedo.Cartesian3.cross(i,e[_],o);Freedo.Cartesian3.normalize(a,s);Freedo.Cartesian3.normalize(o,l);s.x=s.x*r;s.y=s.y*r;s.z=s.z*r;l.x=l.x*r;l.y=l.y*r;l.z=l.z*r;Freedo.Cartesian3.add(t[_],s,c);Freedo.Cartesian3.add(t[_],l,f);v.push(new Freedo.Cartesian3(c.x,c.y,c.z));v.push(new Freedo.Cartesian3(f.x,f.y,f.z))}else if(_==t.length-1){Freedo.Cartesian3.subtract(t[_],t[_-1],i);Freedo.Cartesian3.cross(e[_],i,a);Freedo.Cartesian3.cross(i,e[_],o);Freedo.Cartesian3.normalize(a,s);Freedo.Cartesian3.normalize(o,l);s.x=s.x*r;s.y=s.y*r;s.z=s.z*r;l.x=l.x*r;l.y=l.y*r;l.z=l.z*r;Freedo.Cartesian3.add(t[_],s,c);Freedo.Cartesian3.add(t[_],l,f);v.push(new Freedo.Cartesian3(c.x,c.y,c.z));v.push(new Freedo.Cartesian3(f.x,f.y,f.z))}else{Freedo.Cartesian3.subtract(t[_-1],t[_],i);Freedo.Cartesian3.subtract(t[_+1],t[_],n);p=Freedo.Cartesian3.angleBetween(i,n)/2;h=r/Math.sin(p);Freedo.Cartesian3.subtract(t[_+1],t[_],i);Freedo.Cartesian3.subtract(t[_],t[_-1],n);Freedo.Cartesian3.normalize(i,i);Freedo.Cartesian3.normalize(n,n);Freedo.Cartesian3.add(i,n,u);Freedo.Cartesian3.cross(e[_],u,a);Freedo.Cartesian3.normalize(a,s);s.x=s.x*h;s.y=s.y*h;s.z=s.z*h;Freedo.Cartesian3.add(t[_],s,c);Freedo.Cartesian3.cross(u,e[_],o);Freedo.Cartesian3.normalize(o,l);l.x=l.x*h;l.y=l.y*h;l.z=l.z*h;Freedo.Cartesian3.add(t[_],l,f);v.push(new Freedo.Cartesian3(c.x,c.y,c.z));v.push(new Freedo.Cartesian3(f.x,f.y,f.z))}}}return v};d.prototype.getRoadUrlByLevel=function(e){var t=null;if(e=="一级"){t=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road1.jpg"}else if(e=="二级"){t=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road2.jpg"}else if(e=="三级"){t=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road3.jpg"}else{t=null}return t};d.prototype.calcCP=function(e,t,r){var i,n,a;i=e.position;n=t.position;a=r.position;var o=[];var s=Freedo.Cartesian3.subtract(i,n,new Freedo.Cartesian3);var l=Freedo.Cartesian3.subtract(a,n,new Freedo.Cartesian3);var u=Freedo.Cartesian3.cross(s,l,new Freedo.Cartesian3);var d=Freedo.Cartesian3.normalize(s,new Freedo.Cartesian3);var c=Freedo.Cartesian3.normalize(l,new Freedo.Cartesian3);var f=Freedo.Cartesian3.add(d,c,new Freedo.Cartesian3);var h=Freedo.Quaternion.fromAxisAngle(u,Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion);var p=Freedo.Quaternion.fromAxisAngle(u,-1*Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion);var v=Freedo.Matrix3.fromQuaternion(h,new Freedo.Matrix3);var m=Freedo.Matrix3.fromQuaternion(p,new Freedo.Matrix3);var _=Freedo.Matrix3.multiplyByVector(v,f,new Freedo.Cartesian3);var y=Freedo.Matrix3.multiplyByVector(m,f,new Freedo.Cartesian3);var g=Freedo.Cartesian3.normalize(_,new Freedo.Cartesian3);var w=Freedo.Cartesian3.normalize(y,new Freedo.Cartesian3);var F=Freedo.Cartesian3.distance(i,n);var b=Freedo.Cartesian3.distance(a,n);var C=1;if(F<b){C=F/this._nearRate}else C=b/this._nearRate;g=Freedo.Cartesian3.multiplyByScalar(g,C,new Freedo.Cartesian3);w=Freedo.Cartesian3.multiplyByScalar(w,C,new Freedo.Cartesian3);var x=Freedo.Cartesian3.add(n,g,new Freedo.Cartesian3);var P=Freedo.Cartesian3.add(n,w,new Freedo.Cartesian3);var M=Freedo.Cartesian3.distance(i,x);var T=Freedo.Cartesian3.distance(i,P);if(M<T)return[x,P];else return[P,x]};d.prototype.smoothPolyline=function(e){var t=[];if(e.length<3){for(var r=0;r<e.length;r++){t.push(e[r].position)}}else{for(var r=0;r<=e.length-2;r++){var i={},n={},a={},o={};if(r==0){i=e[0];n.position=this.calcCP(e[0],e[1],e[2])[0];a=e[0];o=e[1]}else if(r==e.length-2){i.position=this.calcCP(e[r-1],e[r],e[r+1])[1];n=e[r+1];a=e[r];o=e[r+1]}else{i.position=this.calcCP(e[r-1],e[r],e[r+1])[1];n.position=this.calcCP(e[r],e[r+1],e[r+2])[0];a=e[r];o=e[r+1]}var s=new f.FdBezierCurveAlgorithm(a,o,i,n);var l=s.getVertexForCurve(this._smoothRate);t=t.concat(l)}}var u=[];for(var r=0;r<t.length;r++){var d={};d=t[r];if(u.length>0){var c=Freedo.Cartesian3.distance(u[u.length-1],d);if(c>1e-4)u.push(d)}else u.push(d)}return u};d.prototype.drawRoad=function(e,t,r){var i=this.TransfPointToCartesian3(e);var n=[];for(var a=0;a<i.length;a++){n[a]={position:i[a]}}i=this.smoothPolyline(n);H.x=i[0].x;H.y=i[0].y;H.z=i[0].z;var o=this.TransfCartesian3ToSelf(i);var s=this.getPointArray(i,o,t);var l=s;var u=[];for(var d=0;d<e.length;d++){u[d]={lon:e[d].lon,lat:e[d].lat,height:e[d].height-3}}var c=t+4;var f=this.TransfPointToCartesian3(u);n=[];for(var h=0;h<f.length;h++){n[h]={position:f[h]}}f=this.smoothPolyline(n);var p=this.TransfCartesian3ToSelf(f);var v=this.getPointArray(f,p,c);var m=v;var _=[];for(var y=0;y<m.length;y++){if(y%2==0){_.push(m[y].x);_.push(m[y].y);_.push(m[y].z);_.push(l[y].x);_.push(l[y].y);_.push(l[y].z)}else{_.push(l[y].x);_.push(l[y].y);_.push(l[y].z);_.push(m[y].x);_.push(m[y].y);_.push(m[y].z)}}var g=new Float64Array(_);var w=[];var F=null;var b=null;var C=null;var x=0;w.push(x,0);w.push(x,.1);w.push(x,.9);w.push(x,.99);var P=s.length/2-1;var M=t*2+Math.sqrt(4*4+3*3)*2;for(var T=0;T<P;T++){F=Freedo.Cartesian3.distance(l[2*T+2],l[2*T])/M;b=Freedo.Cartesian3.distance(l[2*T+3],l[2*T+1])/M;C=(F+b)/2;x=x+C;w.push(x,0);w.push(x,.1);w.push(x,.9);w.push(x,.99)}var E=new Float32Array(w);var S=[];var A=(s.length/2-2)*4+2;for(var k=0;k<=A;k++){if((k-3)%4!=0){S.push(k+0);S.push(k+4);S.push(k+5);S.push(k+5);S.push(k+1);S.push(k+0)}}var L=new Uint16Array(S);var D=[];for(var I=0;I<i.length;I++){D.push(i[I].x);D.push(i[I].y);D.push(i[I].z)}var R=Freedo.BoundingSphere.fromVertices(D);var O=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:g}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:E})},indices:L,primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(g)});var N=new Freedo.GeometryInstance({geometry:O,modelMatrix:new Freedo.Matrix4(1,0,0,H.x,0,1,0,H.y,0,0,1,H.z,0,0,0,1),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(Freedo.Color.RED)},id:"trangle"});var B=this._viewer.scene.primitives.add(new Freedo.Primitive({geometryInstances:N,appearance:new Freedo.MaterialAppearance({material:new Freedo.Material({fabric:{type:"Image",uniforms:{image:r}}})}),asynchronous:false,show:true}));return{primitive:B,boundingsphere:R}};d.prototype.createLinePrimitive=function(e){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})};d.prototype.cancel=function(){this._pts=[];if(this._lsner)this._lsner();this._lsner=undefined;if(Freedo.defined(this._ple))this._ple.cancel();this._event.raiseEvent("Cancel",{})};d.prototype.setSmoothRate=function(e){this._smoothRate=e;this.reDraw()};d.prototype.setNearRate=function(e){this._nearRate=e;this.reDraw()};d.prototype.setCenterLineHide=function(e){this._hideCenterLine=e;this.reDraw()};d.prototype.reDraw=function(){var e=Freedo.clone(this.roadsOptions,true);this.clearRoads();this._data=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;this.addRoad(o["id"],o["pts"],o["level"],o["width"])}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.startEdit=function(e){this.addLsnr();var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(this._roadsOptions),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(o.id==e){this._currentId=e;this._ple.startEdit(o.pts)}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};d.prototype.editPre=function(){this._ple.editPre()};d.prototype.editNext=function(){this._ple.editNext()};d.prototype.endEdit=function(){this._ple.endEdit()};d.prototype.clearRoads=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,c.default)(this._roads),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.scene.primitives.remove(a.primitive)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,c.default)(this._centerLines),d;!(o=(d=u.next()).done);o=true){var a=d.value;this._viewer.scene.primitives.remove(a)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}this._roads=[];this._roadsOptions=[];this._centerLines=[]};d.prototype.getData=function(){return Freedo.clone(this._roadsOptions,true)};d.prototype.removeAll=function(){this.clearRoads()};d.prototype.reset=function(){this.clearRoads();if(this._lsner)this._lsner();this._lsner=undefined;if(Freedo.defined(this._ple))this._ple.cancel()};d.prototype.dispose=function(){this.reset();this.clearRoads()};t.FdDrawRoad=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPathsManager=undefined;var i=r(3);var d=v(i);var n=r(55);var o=v(n);var a=r(1);var s=v(a);var l=r(2);var u=v(l);var c=r(555);var f=r(556);var h=r(5);var p=r(10);function v(e){return e&&e.__esModule?e:{default:e}}var m=function(){function n(e){var r=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;(0,s.default)(this,n);this._viewer=e;this._pathsOpts=t;if(i=="3")this._pa=new f.FdPathTimeAnimator(e);else this._pa=new c.FdPathAnimator(e);this._pa.on(function(e,t){if(e=="ConfigChanged"&&r._currentGroupID&&r._pathsOpts[r._currentGroupID]){console.log(t);(0,o.default)(r._pathsOpts[r._currentGroupID],t);a._event.raiseEvent("DataChanged",a._pathsOpts[a._currentGroupID])}r.pathAnimatorEventCallback(e,t)});this._ple=new p.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._currentPlayingGroupID=undefined;this._currentGroupID=undefined;var a=this;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){a.appendPathPoint(a._currentGroupID,t)}if(e=="PLAdd"){a._ple.cancel();a.reloadPA();a._event.raiseEvent("DataChanged",a._pathsOpts[a._currentGroupID])}if(e=="EditEnd"){var r=a._pathsOpts[a._currentGroupID].list;if(!t.pts){return}for(var i=0;i<t.pts.length;i++){var n=h.FdMisc.FdGeometric.tg(t.pts[i]);r[i].position=n}a.reloadPA(a._currentGroupID);a._event.raiseEvent("DataChanged",a._pathsOpts[a._currentGroupID])}})}(0,u.default)(n,[{key:"pathsOptions",get:function e(){return this._pathsOpts},set:function e(t){if(!Freedo.defined(t)){return}this._pathsOpts=t;this._event.raiseEvent("DataChanged");this._event.raiseEvent("GroupsChanged")}}]);return n}();m.prototype.getDataPropName=function(){return"path"};m.prototype.getData=function(){return Freedo.clone(this._pathsOpts,true)};m.prototype.setData=function(e){this.pathsOptions=e};m.prototype.pathAnimatorEventCallback=function(e,t){this._event.raiseEvent(e,t)};m.prototype.createGroup=function(e,t){if(typeof t==="undefined"){t=Freedo.createGuid()}this._pathsOpts[t]={id:t,name:e,smoothRate:this._pa.getSmoothRate(),smoothRadius:this._pa.getSmoothRadius?this._pa.getSmoothRadius():undefined,speed:this._pa.getSpeed(),height:this._pa.getHeight(),offsetH:this._pa.getOffsetH(),list:[]};this.setCurrentGroupID(t);this._event.raiseEvent("GroupsChanged");this._event.raiseEvent("DataChanged");return t};m.prototype.removeGroup=function(e){if(typeof this._pathsOpts[e]=="undefined"){return false}if(this._currentGroupID===e){this._pa.reset();this._currentGroupID=undefined}if(this._currentPlayingGroupID===e){}delete this._pathsOpts[e];this._event.raiseEvent("GroupsChanged");this._event.raiseEvent("DataChanged");return true};m.prototype.getGroupName=function(e){if(typeof this._pathsOpts[e]=="undefined"){return""}return this._pathsOpts[e].name};m.prototype.setGroupName=function(e,t){if(typeof this._pathsOpts[e]=="undefined"){return""}this._pathsOpts[e].name=t;this._event.raiseEvent("DataChanged")};m.prototype.getGroupSmooth=function(e){if(typeof this._pathsOpts[e]=="undefined"){return-1}if(!this._pathsOpts[e].smooth)return 5;return this._pathsOpts[e].smooth};m.prototype.setGroupSmoothRate=function(e,t){if(typeof this._pathsOpts[e]=="undefined"){return false}this._pathsOpts[e].smooth=t;this._pa.setSmoothRate(t);this._event.raiseEvent("DataChanged");return true};m.prototype.getGroupOptions=function(e){if(typeof this._pathsOpts[e]=="undefined"){return undefined}var t=Freedo.clone(this._pathsOpts[e],true);return t};m.prototype.removeAllGroups=function(){this._pathsOpts={};this._currentPlayingGroupID=undefined;this._event.raiseEvent("GroupsChanged");this._event.raiseEvent("DataChanged");return true};m.prototype.getAllGroupIDs=function(){var e=[];for(var t in this._pathsOpts){e.push(t)}return e};m.prototype.changeStartPoint=function(e){this._pa.changeStartPoint(e)};m.prototype.preAppendPathPoint=function(){if(!Freedo.defined(this._currentGroupID)||this._currentGroupID.length==0)return;var e=this._pathsOpts[this._currentGroupID].list;if(e&&e.length>=1){var t=e[e.length-1];this._ple.setStartPt(Freedo.FdMisc.FdGeometric.tc(t.position))}this._ple.run()};m.prototype.endAppendPathPoint=function(){this._ple.cancel();if(this._lsner){this._lsner();this._lsner=undefined}};m.prototype.appendPathPoint=function(e,t){if(typeof this._pathsOpts[e]=="undefined"){return false}var r=Freedo.clone(t,true);r.name=Freedo.defaultValue(r.name,"路径点_"+(new Date).getTime());this._pathsOpts[e].list.push(r);this._event.raiseEvent("GroupChanged",e);return true};m.prototype.insertPathPoint=function(e,t,r){if(typeof this._pathsOpts[e]=="undefined"){return false}var i=Freedo.clone(t,true);this._pathsOpts[e].list.splice(r,0,i);this._event.raiseEvent("GroupChanged",e);this._event.raiseEvent("DataChanged");return true};m.prototype.removePathPoint=function(e,t){if(typeof this._pathsOpts[e]==="undefined"){return false}if(typeof this._pathsOpts[e].list[t]==="undefined"){return false}this._pathsOpts[e].list.splice(t,1);this._event.raiseEvent("GroupChanged",e);this._event.raiseEvent("DataChanged");this.reloadPA(e);return true};m.prototype.getPathsLength=function(e){if(typeof this._pathsOpts[e]==="undefined"){throw new Error("getPathsLength error!")}return this._pathsOpts[e].list.length};m.prototype.setPathPoint=function(e,t,r){if(typeof this._pathsOpts[e]==="undefined"){return false}if(typeof this._pathsOpts[e].list[t]==="undefined"){return false}var i=Freedo.clone(r,true);this._pathsOpts[e].list[t]=i;this._event.raiseEvent("DataChanged");return true};m.prototype.getPathPoint=function(e,t){if(typeof this._pathsOpts[e]==="undefined"){throw new Error("getPath error")}if(typeof this._pathsOpts[e].list[t]==="undefined"){return new Error("getPath error")}var r=this._pathsOpts[e].list[t];var i=Freedo.clone(r,true);return i};m.prototype.flyTo=function(e,t){if(typeof this._pathsOpts[e]==="undefined"){return false}if(typeof this._pathsOpts[e].list[t]==="undefined"){return false}var r=this._pathsOpts[e].list[t];var i=this._pa.getTotalLength();var n=new Freedo.BoundingSphere(Freedo.FdMisc.FdGeometric.tc(r.position),i/400);this._viewer.scene.camera.flyToBoundingSphere(n);return true};m.prototype.goto=function(e,t){if(typeof this._pathsOpts[e]==="undefined"){return false}if(typeof this._pathsOpts[e].list[t]==="undefined"){return false}var r=this._pathsOpts[e].list[t];var i=r.cameraInfo;if(typeof i==="undefined"){return false}return true};m.prototype.start=function(){this.reloadPA();this._pa.start()};m.prototype.play=function(){this.reloadPA();this._pa.start()};m.prototype.pause=function(){this._pa.pause()};m.prototype.stop=function(){this._pa.stop()};m.prototype.getGroupPlayingStatus=function(){};m.prototype.getGroupPlayingGroupID=function(){return this._currentPlayingGroupID};m.prototype.getCurrentGroupID=function(){return this._currentGroupID};m.prototype.setCurrentGroupID=function(e){if(this._currentGroupID==e)return;this._currentGroupID=e;this.reloadPA(e);this._event.raiseEvent("GroupChanged",e)};m.prototype.startEdit=function(e){if(e)this._currentGroupID=e;var t=this._pathsOpts[this._currentGroupID].list;var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,d.default)(t),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=h.FdMisc.FdGeometric.tc(l.position);r.push(u)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}this._ple.startEdit(r)};m.prototype.editPre=function(){this._ple.editPre()};m.prototype.editNext=function(){this._ple.editNext()};m.prototype.endEdit=function(){this._ple.endEdit()};m.prototype.reloadPA=function(e){if(!e)e=this._currentGroupID;var t=this._pathsOpts[e];if(typeof t==="undefined"){throw new Error("getPath error")}if(typeof t.list==="undefined"){return new Error("getPath error")}var r=[];var i=[];for(var n=0;n<t.list.length;n++){r.push(t.list[n].position);i.push(t.list[n].name)}this._pa.setName(i);this._pa.setPoints(r);if(this._pa.setModel)this._pa.setModel(t.modelUrl);var a=parseFloat(t.modelDistance);if(typeof a=="number")this._pa.setModelDistance(a)};m.prototype.setPathNameShow=function(e){this._pa.setPathNameShow(e)};m.prototype.setPathShow=function(e){this._pa.setPathShow(e)};m.prototype.setLoop=function(e){this._pa.setLoop(e)};m.prototype.getKBStatus=function(){return this._pa.getKeyboardStatus()};m.prototype.setKBStatus=function(e){if(e)this._pa.enable();else this._pa.disable()};m.prototype.getPitch=function(){return this._pa.getPitch()};m.prototype.setPitch=function(e){this._pa.setPitch(e)};m.prototype.setPathViewMode=function(e){this._pa.setPathViewMode(e)};m.prototype.getSpeed=function(){this._pa.getSpeed()};m.prototype.setSpeed=function(e){this._pa.setSpeed(e)};m.prototype.setSmoothRate=function(e){this._pa.setSmoothRate(e)};m.prototype.getHeight=function(){return this._pa.getHeight()};m.prototype.setHeight=function(e){this._pa.setHeight(e)};m.prototype.setHeading=function(e){this._pa.setHeading(e)};m.prototype.setRoll=function(e){this._pa.setRoll(e)};m.prototype.setNearRate=function(e){this._pa.setNearRate(e)};m.prototype.setOffsetH=function(e){this._pa.setOffsetH(e)};m.prototype.setSmoothRadius=function(e){this._pa.setSmoothRadius(e)};m.prototype.getSmoothRadius=function(){return this._pa.getSmoothRadius()};m.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};m.prototype.reset=function(){this.removeAllGroups();this._pa.reset()};m.prototype.setModel=function(e){if(this._pa instanceof f.FdPathTimeAnimator){this._pa.setModel(e);var t=this._pa.getModel().model.uri.getValue(new Freedo.JulianDate);this._pathsOpts[this._currentGroupID].modelUrl=t}};m.prototype.getModel=function(e){if(this._pa instanceof f.FdPathTimeAnimator){return this._pa.getModel()}};m.prototype.setModelDistance=function(e){if(this._pa instanceof f.FdPathTimeAnimator){this._pa.setModelDistance(e);this._pathsOpts[this._currentGroupID].modelDistance=e}};m.prototype.getModelDistance=function(){if(this._pa instanceof f.FdPathTimeAnimator){return this._pa.getModelDistance()}};m.prototype.dispose=function(){this.reset();this._eventHelper.removeAll();if(this._lsner){this._lsner();this._lsner=undefined}};t.FdPathsManager=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPathAnimator=undefined;var i=r(3);var p=d(i);var n=r(1);var a=d(n);var o=r(56);var s=r(82);var l=r(5);var u=r(48);function d(e){return e&&e.__esModule?e:{default:e}}var c=function e(t){(0,a.default)(this,e);this._viewer=t;this._points={};this._ptsSmoothed=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._kb=new s.FdKeyboard(t);this._kbCallback=undefined;this._bKBActive=false;this._labels=[];this._name=[];this._lines=[];this._bStop=true;this._bPause=true;this._bPauseMannul=0;this._bRun=false;this._dPitch=15;this._dOffsetH=0;this._dHeight=100;this._dSpeed=1e3;this._bLock=1;this._lastTS=0;this._timeUsed=0;this._totalLen=0;this._passedLen=0;this._dHeading=0;this._pathPL=undefined;this._smoothRate=0;this._nearRate=4;this.addKBLsnr();this._showPath=false;this._showPathName=false;this._loop=false;this._pathViewMode=false;this._pathPoints=null;this._originPts=[];this._centerPt=undefined;this._lengths=[];this._newIndex=[];this._listenIndex=[]};c.prototype.start=function(){if(!this._bRun){var e=this;this._bRun=true;this._viewer.scene.postRender.addEventListener(function(){e.tick()})}if(!this._bStop&&this._bPauseMannul!=1)return;if(this._bStop){this._bStop=false;this._bPause=false;this._bPauseMannul=2;this._startTime=0;this._timeUsed=0}if(this._bPauseMannul==1){this._bPauseMannul=2}this._event.raiseEvent("StatusChanged",{status:"play"});this._kb.setFocus()};c.prototype.enable=function(){this._bKBActive=true;this._kb.enable()};c.prototype.disable=function(){this._bKBActive=false;this._kb.disable()};c.prototype.getKeyboardStatus=function(){return this._bKBActive};c.prototype.addKBLsnr=function(){var r=this;this._kbCallback=this._kb.on(function(e,t){if(e==="timer"){r.onKeyboard(t.metaData);return}if(e!=="timer"){r._event.raiseEvent(e,t)}})};c.prototype.onKeyboard=function(e){if(!this._bKBActive)return;if(this._points.length==0)return;if(e[33]){this._bPauseMannul=1;var t=33.3/1e3*this._dSpeed;this.kbtick(t)}if(e[34]){this._bPauseMannul=1;var t=-33.3/1e3*this._dSpeed;this.kbtick(t)}};c.prototype.stop=function(){if(this._bStop)return;this._bStop=true;this._lengths=[];this._newIndex=[];this._listenIndex=[];this._event.raiseEvent("StatusChanged",{status:"stop"});this._kb.setFocus();if(this._centerPt){this._viewer.entities.remove(this._centerPt);this._centerPt=undefined}this._viewer.scene.requestRender();this._viewer.camera.lookAtTransform(Freedo.Matrix4.IDENTITY)};c.prototype.pause=function(){if(this._bStop)return;this._bPauseMannul=1;viewer.camera.lookAtTransform(Freedo.Matrix4.IDENTITY);this._event.raiseEvent("StatusChanged",{status:"pause"});this._kb.setFocus()};c.prototype.getSpeed=function(){return this._dSpeed};c.prototype.setSpeed=function(e){this._dSpeed=e};c.prototype.setNearRate=function(e){this._nearRate=e};c.prototype.getPitch=function(){return this._dPitch};c.prototype.setPitch=function(e){this._dPitch=e*-1};c.prototype.setOffsetH=function(e){this._dOffsetH=e;this.smoothPath()};c.prototype.getOffsetH=function(e){return this._dOffsetH};c.prototype.setPathViewMode=function(e){this._pathViewMode=e};c.prototype.setSmoothRate=function(e){this._smoothRate=e;this.smoothPath()};c.prototype.getSmoothRate=function(e){return this._smoothRate};c.prototype.getHeight=function(){return this._dHeight};c.prototype.setHeight=function(e){this._dHeight=e};c.prototype.setHeading=function(e){this._dHeading=e};c.prototype.setPathNameShow=function(e){if(this._showPathName!==e){this._event.raiseEvent("PathStatusChanged",{status:this._showPathName})}this._showPathName=e;this.showPathName()};c.prototype.setPathShow=function(e){if(this._showPath!==e){this._event.raiseEvent("PathStatusChanged",{status:this._showPath})}this._showPath=e;this.showPath()};c.prototype.getStatus=function(){if(this._bStop)return"stop";else if(this._bPauseMannul==1)return"pause";else return"play";this._kb.setFocus()};c.prototype.showPathName=function(){if(this._showPathName){var e=true;var t=false;var r=undefined;try{for(var i=(0,p.default)(this._labels),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.entities.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this._labels=[];for(var o=0;o<this._points.length;o++){var s=Freedo.Cartesian3.fromDegrees(this._points[o][0],this._points[o][1],this._points[o][2]+this._dOffsetH);var l=this._viewer.entities.add({position:s,label:{text:this._name[o],font:"16px sans-serif",fillColor:Freedo.Color.BLACK,outlineColor:Freedo.Color.WHITE.withAlpha(.5),outlineWidth:4,showBackground:false,style:Freedo.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Freedo.Cartesian2(18,-2),horizontalOrigin:Freedo.HorizontalOrigin.LEFT,verticalOrigin:Freedo.VerticalOrigin.CENTER,disableDepthTestDistance:Number.POSITIVE_INFINITY}});this._labels.push(l)}}else{var u=true;var d=false;var c=undefined;try{for(var f=(0,p.default)(this._labels),h;!(u=(h=f.next()).done);u=true){var a=h.value;this._viewer.entities.remove(a)}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}this._labels=[]}this._viewer.scene.requestRender()};c.prototype.showPath=function(){if(this._pathPL!==undefined){this._viewer.scene.primitives.remove(this._pathPL);this._pathPL=undefined}if(this._pathPoints){this._viewer.scene.primitives.remove(this._pathPoints);this._pathPoints=undefined}if(this._showPath){this._originPts=[];for(var e=0;e<this._points.length;e++){var t=Freedo.Cartesian3.fromDegrees(this._points[e][0],this._points[e][1],this._points[e][2]+this._dOffsetH);this._originPts.push(t)}if(this._originPts.length!=0){var r=Freedo.FdMisc.FdGeometric.getRelativePoints(this._originPts);this._pathPoints=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection({modelMatrix:r.matrix}));for(var i=0;i<r.points.length;i++){this._pathPoints.add({position:r.points[i],color:Freedo.Color.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY})}if(this._ptsSmoothed.length!=0){var n=Freedo.FdMisc.FdGeometric.createPolylinePrimitive2(this._ptsSmoothed);this._pathPL=this._viewer.scene.primitives.add(n)}}}this._kb.setFocus();this._viewer.scene.requestRender()};c.prototype.calVectorOri=function(e,t){var r=Freedo.Cartographic.fromCartesian(e);var i=Freedo.Cartographic.fromCartesian(t);if(i.longitude>r.longitude&&i.latitude>r.latitude)return 1;if(i.longitude>r.longitude&&i.latitude<r.latitude)return 2;if(i.longitude<r.longitude&&i.latitude<r.latitude)return 3;if(i.longitude<r.longitude&&i.latitude>r.latitude)return 4};c.prototype.calVectorHeading=function(e,t){var r=Freedo.Cartographic.fromCartesian(e);var i=Freedo.Cartographic.fromCartesian(t);return Math.atan((i.longitude-r.longitude)/(i.latitude-r.latitude))};c.prototype.smoothPolyline=function(e){if(e instanceof Array&&e.length==0)return[];for(var t=0;t<e.length;t++){e[t]=e[t].position}var r=u.FdLoft.smoothByPolyline(e,[e[0]],360/this._smoothRate,undefined);return r.line};c.prototype.calcHeading=function(e){var t=this.calVectorHeading(this._ptsSmoothed[e],this._ptsSmoothed[e+1]);var r=this.calVectorOri(this._ptsSmoothed[e],this._ptsSmoothed[e+1]);t=Freedo.Math.toDegrees(t);if(r==1)t=t+0;if(r==2)t=t+180;if(r==3)t=t+180;if(r==4)t=t+360;return t};c.prototype.smoothPath=function(){if(!this._points)return;var e=[];var t=[];for(var r=0;r<this._points.length;r++){var i=Freedo.Cartesian3.fromDegrees(this._points[r][0],this._points[r][1],this._points[r][2]+this._dOffsetH);e.push({position:i});t.push(i)}if(this._smoothRate==0)this._ptsSmoothed=t;else this._ptsSmoothed=this.smoothPolyline(e);this.showPath();this.showPathName();this._totalLen=Freedo.FdMisc.FdGeometric.calculateLength(this._ptsSmoothed);this._kb.setFocus()};c.prototype.saveLengths=function(){var e=0;if(this._lengths.length!==0)return;for(var t=0;t<this._ptsSmoothed.length-1;t++){e+=Freedo.Cartesian3.distance(this._ptsSmoothed[t],this._ptsSmoothed[t+1]);this._lengths.push(e)}};c.prototype.getTotalLength=function(){return this._totalLen};c.prototype.setName=function(e){this._name=e};c.prototype.setPoints=function(e){this._points=e;this.smoothPath();this.saveLengths();this.getNewIndex()};c.prototype.setLoop=function(e){this._loop=e};c.prototype.setModelDistance=function(){};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.callbackCenter=function(e,t){t=this._center;return t};c.prototype.gotoSubByLength=function(e,t,r){var i=0;var n=0;var a=0;var o=0;i=this.calcHeading(e);if(e==this._ptsSmoothed.length-2)n=i;else n=this.calcHeading(e+1);var a=i+t/r*(n-i);if(i+180<n){var s=360-n+i;if(t/r<i/s){a=i-t/r/(i/s)*i;if(a<0)a+=360}else{a=360-(t/r-i/s)/((360-n)/s)*(360-n)}}if(i-180>n){var s=360-i+n;if(t/r<(360-i)/s){a=i+t/r/((360-i)/s)*(360-i);if(a>360)a-=360}else{a=(t/r-(360-i)/s)/(n/s)*n}}var l={};l.x=this._ptsSmoothed[e].x+t/r*(this._ptsSmoothed[e+1].x-this._ptsSmoothed[e].x);l.y=this._ptsSmoothed[e].y+t/r*(this._ptsSmoothed[e+1].y-this._ptsSmoothed[e].y);l.z=this._ptsSmoothed[e].z+t/r*(this._ptsSmoothed[e+1].z-this._ptsSmoothed[e].z);var u=Freedo.Cartographic.fromCartesian(l);var d=Freedo.Math.toDegrees(u.longitude);var c=Freedo.Math.toDegrees(u.latitude);var f=Freedo.Cartesian3.fromDegrees(d,c,u.height);this._center=f;if(!this._centerPt){var h=new Freedo.CallbackProperty(this.callbackCenter.bind(this),false);this._centerPt=this._viewer.entities.add({position:h,point:{color:Freedo.Color.GREEN,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY,show:false}})}a=Freedo.Math.toRadians(a+this._dHeading);o=Freedo.Math.toRadians(this._dPitch);if(this._dHeight<1)this._dHeight=100;this._viewer.camera.lookAt(f,new Freedo.HeadingPitchRange(a,o,this._dHeight));this._viewer.scene.requestRender()};c.prototype.getNewIndex=function(){if(this._newIndex.length!==0)return;var e=[];for(var t=0;t<this._points.length;t++){e.push(Freedo.FdMisc.FdGeometric.tc(this._points[t]))}for(var r=0;r<e.length;r++){var i=undefined,n=0;for(var a=0;a<this._ptsSmoothed.length;a++){var o=Freedo.Cartesian3.distance(this._ptsSmoothed[a],e[r]);if(!i)i=o;if(o<i){i=o;n=a}}this._newIndex.push(n)}};c.prototype.changeStartPoint=function(e){this._listenIndex=[];var t=this._lengths[this._newIndex[e]];this._timeUsed=t/this._dSpeed*1e3};c.prototype.gotoSubByLengthUsePathViewMode=function(e,t,r){var i={};i.x=this._ptsSmoothed[e].x+t/r*(this._ptsSmoothed[e+1].x-this._ptsSmoothed[e].x);i.y=this._ptsSmoothed[e].y+t/r*(this._ptsSmoothed[e+1].y-this._ptsSmoothed[e].y);i.z=this._ptsSmoothed[e].z+t/r*(this._ptsSmoothed[e+1].z-this._ptsSmoothed[e].z);var n=Freedo.Cartographic.fromCartesian(i);var a=Freedo.Math.toDegrees(n.longitude);var o=Freedo.Math.toDegrees(n.latitude);var s=Freedo.Cartesian3.fromDegrees(a,o,n.height+this._dHeight);var l=Freedo.Cartesian3.subtract(this._ptsSmoothed[e+1],this._ptsSmoothed[e],new Freedo.Cartesian3);var u=Freedo.Cartesian3.normalize(l,new Freedo.Cartesian3);var d=Freedo.Cartesian3.normalize(s,new Freedo.Cartesian3);this._viewer.camera.setView({destination:s,orientation:{direction:u,up:d}});s=null;l=null;d=null};c.prototype.gotoByLength=function(e){var t=0;var r=0;for(var i=0;i<this._ptsSmoothed.length-1;i++){r=Freedo.Cartesian3.distance(this._ptsSmoothed[i],this._ptsSmoothed[i+1]);if(e>t&&e<t+r){if(this._pathViewMode)this.gotoSubByLengthUsePathViewMode(i,e-t,r);else this.gotoSubByLength(i,e-t,r);break}t+=r;for(var n=0;n<this._lengths.length;n++){if(this._lengths[n]>=t){for(var a=0;a<this._newIndex.length;a++){if(this._ptsSmoothed[n+1]!==this._ptsSmoothed[this._newIndex[a]])continue;if(this._listenIndex.indexOf(a)!==-1)continue;this._listenIndex.push(a);this._event.raiseEvent("Passed",{index:a,oldPoint:this._points[a],newPoint:this._ptsSmoothed[this._newIndex[a]]})}break}}}};c.prototype.tick=function(){var e=(new Date).getTime();if(this._bStop){this._lastTS=0;this._timeUsed=0;return}if(!this._bStop&&!this._bPause&&Freedo.defined(e)&&(this._bPauseMannul==0||this._bPauseMannul==2)){if(this._lastTS==0){this._lastTS=e}else{this._timeUsed+=e-this._lastTS;this._passedLen=this._timeUsed/1e3*this._dSpeed;if(this._passedLen<this._totalLen){this.gotoByLength(this._passedLen)}else{this.stop();this._event.raiseEvent("Finished",{status:"Finished"});if(this._loop)this.start()}}}this._lastTS=e};c.prototype.kbtick=function(e){this._timeUsed+=33*e/Math.abs(e);this._passedLen+=e;if(this._passedLen<=0){this._passedLen=0;this._timeUsed=0;console.log("重新播放:"+this._passedLen)}if(this._passedLen<this._totalLen)this.gotoByLength(this._passedLen);else{this._passedLen=0;this._timeUsed=0}};c.prototype.clear=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,p.default)(this._lines),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.entities.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}if(this._pathPL){this._viewer.scene.primitives.remove(this._pathPL);this._pathPL=undefined}if(this._centerPt){this._viewer.entities.remove(this._centerPt);this._centerPt=undefined}var o=true;var s=false;var l=undefined;try{for(var u=(0,p.default)(this._labels),d;!(o=(d=u.next()).done);o=true){var a=d.value;this._viewer.entities.remove(a)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}this._labels=[];this._name=[];this._viewer.scene.requestRender()};c.prototype.reset=function(){this.clear();this._bStop=true;this._points=undefined};c.prototype.dispose=function(){this.reset()};t.FdPathAnimator=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPathTimeAnimator=undefined;var c=r(48);function i(e){this._viewer=e;e.clock.shouldAnimate=true;this._time=new Freedo.JulianDate;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._pause=false;this._smoothRate=.1;this._smoothRadius=0;this._positions=null;this._cPositions=null;this._positionProperty=null;this._viewHeight=5;this._pathOffsetHeight=0;this._speed=10;this._viewHpr=new Freedo.HeadingPitchRoll;this._vectorProperty=null;this._keyPt=[];this._keyPtAccumulatedLen=[];this._passedKeyPtIdx=-1;this._passedLen=0;this._pathNames=undefined;this._pathPoints=null;this._pathPL=undefined;this._pathNameLabels=undefined;this._modelEntity=undefined;this._viewDistance=75}i.prototype.initSmoothedPath=function(){this._positions&&this.setPoints(this._positions)};i.prototype.setPoints=function(e){var n=this;this._positions=e;var t=this._keyPt=this._originPts=this._cPositions=e.map(function(e){return Freedo.Cartesian3.fromDegrees(e[0],e[1],e[2]+n._pathOffsetHeight)});if(this._smoothRate&&this._smoothRate>0&&t.length>=2){var r=c.FdLoft.smoothByPolyline(t,[t[0]],360/this._smoothRate,this._smoothRadius);this._cPositions=t=r.line;this._keyPt=[];for(var i=0;r.gline&&i<r.gline.length;i++){var a=r.gline[i];var o=parseInt((a.length-1)/2);this._keyPt.push(a[o])}}if(t.length>=2){this._keyPtAccumulatedLen.length=0;this._keyPt.reduce(function(e,t,r){var i=r<1?0:Freedo.Cartesian3.distance(t,n._keyPt[r-1])+e[r-1];e.push(i);return e},this._keyPtAccumulatedLen);this._positionProperty=new Freedo.SampledPositionProperty;this._vectorProperty=new Freedo.VelocityVectorProperty(this._positionProperty,true);this._orientationProperty=new Freedo.VelocityOrientationProperty(this._positionProperty);var s=this._times=[new Freedo.JulianDate];for(var l=1;l<t.length;l++){var u=Freedo.Cartesian3.distance(t[l],t[l-1]);var d=u;s.push(Freedo.JulianDate.addSeconds(s[s.length-1],d,new Freedo.JulianDate))}this._positionProperty.addSamples(s,t)}this._event.raiseEvent("PointChanged",e);this.setPathShow(this._showPath)};i.prototype.start=function(){if(this._positions.length<2){console.log("至少需要两个点");return}this._pause&&(this._pause=!this._pause);!this._removeCallback&&(this._removeCallback=this.regCameraUpdate())};i.prototype.regCameraUpdate=function(){var s=this;var l=null,u=null;var d=new Freedo.Cartesian3,c=new Freedo.Cartesian3,f=new Freedo.Cartesian3,h=new Freedo.Cartesian3,p=new Freedo.Quaternion,v=new Freedo.Cartesian3;return this._viewer.scene.postRender.addEventListener(function(e,t){s._viewer.clock.canAnimate=true;if(!s._pause){var r=l?Freedo.JulianDate.secondsDifference(t,l)*s._speed:0;Freedo.JulianDate.addSeconds(s._time,r,s._time);var i=s._positionProperty.getValue(s._time,d),n=s._vectorProperty.getValue(s._time,c);if(Freedo.JulianDate.greaterThan(s._time,s._times[s._times.length-1])){s.stop();s._loop&&s.start();s._event.raiseEvent("End")}if(!i||!n)return;s.updateModelPosition(i.clone(v),s._orientationProperty.getValue(s._time,p));var a=Freedo.Cartesian3.clone(i,f);var o=s.computePositionOrientation(s._viewHpr,i,{direction:n,up:a});s.updateKeyPointPassedStatus(i,u);u=i.clone(h)}l=t},this)};var u=new Freedo.Cartesian3;var d=new Freedo.Matrix4;var f=new Freedo.Cartesian3;var h=new Freedo.Matrix4;i.prototype.computePositionOrientation=function(e,t,r){var i=r.direction,n=r.up;if(typeof this._viewHeight=="number"&&this._viewHeight!=0){var a=Freedo.Cartesian3.magnitude(t);Freedo.Cartesian3.multiplyByScalar(t,(a+this._viewHeight)/a,t)}if(this._modelEntity){var o=Freedo.Transforms.eastNorthUpToFixedFrame(t,undefined,d);var s=Freedo.Matrix4.inverse(o,h);var l=Freedo.Cartesian3.multiplyByScalar(i,this._viewDistance,f);Freedo.Cartesian3.negate(l,l);Freedo.Matrix4.multiplyByPointAsVector(s,l,l);Freedo.Matrix4.multiplyByPoint(o,l,t);e.pitch=Math.atan2(this._viewHeight,this._viewDistance)}if(e.heading!==0){this.rotateVector(t,i,e.heading,i)}if(e.pitch!==0){this.rotateVector(Freedo.Cartesian3.cross(t,i,u),i,e.pitch,i)}if(e.roll!==0){this.rotateVector(i,n,e.roll,n)}this._viewer.camera.setView({destination:t,orientation:r})};i.prototype.updateModelPosition=function(e,t){if(!(this._modelEntity instanceof Freedo.Entity))return;if(!e||!t)return;this._modelEntity.position=e;this._modelEntity.orientation=t};i.prototype.updateKeyPointPassedStatus=function(e,t){this._passedLen+=!t?0:Freedo.Cartesian3.distance(t,e);if(this._passedLen==0&&this._passedKeyPtIdx<0)n.call(this,0);if(this._passedLen<this._keyPtAccumulatedLen[this._passedKeyPtIdx+1])return;for(var r=this._passedKeyPtIdx+1;r<this._keyPtAccumulatedLen.length;r++){var i=this._keyPtAccumulatedLen[r];if(i<=this._passedLen&&this._keyPtAccumulatedLen[r+1]>this._passedLen){n.call(this,r);break}}function n(e){if(e==this._passedKeyPtIdx)return;this._event.raiseEvent("Passed",{index:e,oldPoint:this._keyPt[this._passedKeyPtIdx],newPoint:this._keyPt[e]});this._passedKeyPtIdx=e}};i.prototype.changeStartPoint=function(e){e=parseInt(e);if(this._keyPt.length>e&&e>-1){var t=this._keyPt[e];var r=this._cPositions.findIndex(function(e){return t.equals(e)});this._time=this._times[r];this._passedKeyPtIdx=e-1;this._passedLen=this._keyPtAccumulatedLen[e];this.start()}};i.prototype.stop=function(){this._removeCallback&&this._removeCallback();this._removeCallback=undefined;this.clear()};i.prototype.pause=function(){this._pause=!this._pause};i.prototype.setSmoothRadius=function(e){this.setConf("smoothRadius",parseFloat(e))};i.prototype.getSmoothRadius=function(){return this._smoothRadius};i.prototype.setSpeed=function(e){if(e==""||e==null)return;this._speed=parseFloat(e);this._event.raiseEvent("ConfigChanged",{speed:e})};i.prototype.getSpeed=function(){return this._speed};i.prototype.setLoop=function(e){this._loop=!!e};i.prototype.getLoop=function(){return this._loop};i.prototype.setSmoothRate=function(e){this.setConf("smoothRate",parseFloat(e))};i.prototype.getSmoothRate=function(e){return this._smoothRate};i.prototype.setPathShow=function(e){this._showPath=!!e;if(this._pathPL){this._viewer.scene.primitives.remove(this._pathPL);this._pathPL=undefined}if(this._pathPoints){this._viewer.scene.primitives.remove(this._pathPoints);this._pathPoints=undefined}if(this._showPath&&this._cPositions&&this._cPositions.length>0){var t=Freedo.FdMisc.FdGeometric.createPolylinePrimitive2(this._cPositions);this._pathPL=this._viewer.scene.primitives.add(t);var r=Freedo.FdMisc.FdGeometric.getRelativePoints(this._originPts);this._pathPoints=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection({modelMatrix:r.matrix}));for(var i=0;i<r.points.length;i++){this._pathPoints.add({position:r.points[i],color:Freedo.Color.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY})}}this._viewer.scene.requestRender()};i.prototype.setPathNameShow=function(e){this._showPathName=!!e;if(!this._pathNames)return;if(this._pathNameLabels){this._viewer.scene.primitives.remove(this._pathNameLabels);this._pathNameLabels=undefined}if(this._showPathName&&!this._pathNameLabels){this._pathNameLabels=this._viewer.scene.primitives.add(new Freedo.LabelCollection);for(var t=0;t<this._pathNames.length;t++){this._pathNameLabels.add({position:this._originPts[t],text:""+this._pathNames[t],font:"16px sans-serif",fillColor:Freedo.Color.BLACK,outlineColor:Freedo.Color.WHITE.withAlpha(.5),outlineWidth:4,showBackground:false,style:Freedo.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Freedo.Cartesian2(18,-2),horizontalOrigin:Freedo.HorizontalOrigin.LEFT,verticalOrigin:Freedo.VerticalOrigin.CENTER,disableDepthTestDistance:Number.POSITIVE_INFINITY})}}};i.prototype.enable=function(){};i.prototype.setHeight=function(e){this._viewHeight=parseFloat(e);this._event.raiseEvent("ConfigChanged",{height:e})};i.prototype.getHeight=function(e){return this._viewHeight};i.prototype.setPathViewMode=function(e){};i.prototype.setOffsetH=function(e){this._pathOffsetHeight=e;this.setConf("pathOffsetHeight",parseFloat(e))};i.prototype.getOffsetH=function(e){return this._pathOffsetHeight};i.prototype.setHeading=function(e){this._viewHpr.heading=e%Math.PI;this._event.raiseEvent("ConfigChanged",{heading:e})};i.prototype.getHeading=function(){return this._viewHpr.heading};i.prototype.setPitch=function(e){this._viewHpr.pitch=e%Math.PI;this._event.raiseEvent("ConfigChanged",{pitch:e})};i.prototype.getPitch=function(){return this._viewHpr.pitch};i.prototype.setRoll=function(e){this._viewHpr.roll=e%Math.PI;this._event.raiseEvent("ConfigChanged",{roll:e})};i.prototype.getRoll=function(){return this._viewHpr.roll};i.prototype.disable=function(){};i.prototype.setName=function(e){this._pathNames=e};i.prototype.setNearRate=function(e){};i.prototype.setModel=function(e){if(this._modelEntity){this._viewer.entities.remove(this._modelEntity)}if(e instanceof Freedo.Entity){this._modelEntity=e;if(!this._viewer.entities.contains(this._modelEntity))this._viewer.entities.add(this._modelEntity)}else if(typeof e=="string"){this._modelEntity=this._viewer.entities.add({model:{uri:e}})}};i.prototype.getModel=function(){return this._modelEntity};i.prototype.setModelDistance=function(e){e=parseFloat(e);if(e!=NaN)this._viewDistance=e};i.prototype.getModelDistance=function(){return this._viewDistance};i.prototype.setConf=function(e,t){if(this["_"+e]==t)return;this["_"+e]=t;this.initSmoothedPath();this.setPathShow(this._showPath);var r={};r[e]=t;this._event.raiseEvent("ConfigChanged",r)};i.prototype.getConf=function(e){var t={speed:this._speed,smoothRate:this._smoothRate,smoothRadius:this._smoothRadius,height:this._viewHeight,offsetH:this._pathOffsetHeight,heading:this._viewHpr.heading,pitch:this._viewHpr.pitch,roll:this._viewHpr.roll};if(!e)return t;else return t[e]};i.prototype.clear=function(){if(this._pathPL){this._viewer.scene.primitives.remove(this._pathPL);this._pathPL=undefined}if(this._pathPoints){this._viewer.scene.primitives.remove(this._pathPoints);this._pathPoints=undefined}if(this._pathNameLabels){this._viewer.scene.primitives.remove(this._pathNameLabels);this._pathNameLabels=undefined}if(this._modelEntity){this._viewer.entities.remove(this._modelEntity);this._modelEntity=undefined}this._pathNames=undefined;this._pause=false;this._time=new Freedo.JulianDate;this._passedLen=0;this._passedKeyPtIdx=-1;this._viewer.scene.requestRender()};i.prototype.reset=function(e){this.stop()};i.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};i.prototype.rotateVector=function(e,t,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:new Freedo.Cartesian3;var n=Freedo.Quaternion.fromAxisAngle(e,r,new Freedo.Quaternion);var a=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,n,new Freedo.Cartesian3(1,1,1));Freedo.Matrix4.multiplyByPointAsVector(a,t,i);return i};t.FdPathTimeAnimator=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdClipPlane=undefined;var i=r(3);var b=u(i);var n=r(1);var a=u(n);var o=r(2);var s=u(o);var l=r(558);var S=r(5);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function n(e,t,r,i){(0,a.default)(this,n);this._viewer=e;this._tilesets=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._mani=new l.FdClipPlaneEditor(e,r,i);this._selectedAxis="";this._transType="CLIP";this._mouseDown12Arg={};this._axisZoom=1;this._isPlaneMode=r;this._t12={TMoveX:0,TMoveY:0,TMoveZ:0,THeading:0,TPitch:0,TRoll:0,TScaleX:1,TScaleY:1,TScaleZ:1,TBaseX:0,TBaseY:0,TBaseZ:0};this._q4=new Freedo.Quaternion(0,0,0,1);this._lsner=undefined}(0,s.default)(n,[{key:"clipOptions",get:function e(){return{type:"CLIPXY",Q4:this._q4,TMoveX:this._t12.TMoveX,TMoveY:this._t12.TMoveY,TMoveZ:this._t12.TMoveZ,TPitch:this._t12.TPitch,TRoll:this._t12.TRoll}},set:function e(t){if(!Freedo.defined(t)){return}if(Freedo.defined(t.type)){this.start(t.type,t)}}}]);return n}();d.prototype.setSceneObjectIDs=function(e){this._aSceneObjectId=Freedo.clone(e,true)};d.prototype.calcSceneBS=function(){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,b.default)(this._tilesets),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=o;var l=s.boundingSphere;e.push(l)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._sceneSphere=Freedo.BoundingSphere.fromBoundingSpheres(e,new Freedo.BoundingSphere)};d.prototype.getType=function(){return this._transType};d.prototype.start=function(e,t){if(!e)e="CLIPXY";this.startClip(e,t)};d.prototype.enableClipPlaneMove=function(e){this._mani.enableClipPlaneMove(e)};d.prototype.setArcLength=function(e){this._mani.setArcLength(e)};d.prototype.startClip=function(e,t){this._transType=e;this._bInClip=true;this.calcSceneBS();var r=this;if(this._lsner){this._lsner();this._lsner=undefined;this._q4=new Freedo.Quaternion(0,0,0,1)}this._lsner=this._mani.on(function(e,t){if(e=="Transform"){r.onTransformStart()}if(e=="Transformed"){r.onTransformEnd()}if(e=="Transforming"){r.onTransforming(t)}});this._mani.startClip("CLIPXY");if(e=="CLIPXY"||e=="CLIPXYNEG"||e=="CLIPYZ"||e=="CLIPXZ")this._selectedAxis="Z_AXIS";else{console.warn("不支持此种类型："+e)}if(!Freedo.defined(t))this.reset12Args();else{this._t12.TMoveX=t.TMoveX;this._t12.TMoveY=t.TMoveY;this._t12.TMoveZ=t.TMoveZ;this._q4=Freedo.clone(t.Q4)}if(e=="CLIPYZ"){this._t12.TPitch=90}if(e=="CLIPXZ"){this._t12.TRoll=90}if(e=="CLIPXYNEG"){this._t12.TPitch=180}this.onTransformStart();var i=Freedo.clone(this._mouseDown12Arg,true);this.updatePlane(i);if(e=="CLIPYZ"||e=="CLIPXZ"||e=="CLIPXYNEG"){var n,a,o;var s=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);if(s){n=s.longitude;a=s.latitude;o=s.height}if(this._isPlaneMode){n=this._sceneSphere.center.x;a=this._sceneSphere.center.y;o=this._sceneSphere.center.z}if(e=="CLIPXYNEG"||e=="CLIPYZ")this._selectedAxis="XZ_CIRCLE";if(e=="CLIPXZ")this._selectedAxis="YZ_CIRCLE";var l=new Freedo.Matrix3;var u=new Freedo.Quaternion;var d=this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,n,a,o,l,u);Freedo.Quaternion.multiply(this._q4,u,this._q4)}if(e=="CLIPYZ"){this._t12.TPitch=0}if(e=="CLIPXZ"){this._t12.TRoll=0}if(e=="CLIPXYNEG"){this._t12.TPitch=0}this._mani.show(this._sceneSphere);this._event.raiseEvent("Start",{})};d.prototype.getMatrix=function(e,t,r,i,n,a,o,s,l,u,d,c){var f=Freedo.Cartesian3.fromRadians(s,l,u);var h=Freedo.Cartesian3.fromRadians(s+t,l+r,u+i);if(this._isPlaneMode){f=new Freedo.Cartesian3(s,l,u);h=new Freedo.Cartesian3(s+t,l+r,u+i)}var p=Freedo.clone(e,true);a=Freedo.Math.toRadians(a);o=Freedo.Math.toRadians(o);var v;var m;var _;if(this._selectedAxis=="XZ_CIRCLE"){var y=Freedo.Quaternion.fromAxisAngle(new Freedo.Cartesian3(1,0,0),o,new Freedo.Quaternion);v=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,y,new Freedo.Cartesian3(1,1,1));var g=Freedo.Matrix4.getRotation(v,new Freedo.Matrix3);var w=Freedo.Matrix3.multiplyByVector(g,new Freedo.Cartesian3(0,-1,0),new Freedo.Cartesian3);w=new Freedo.Cartesian3(0,-1,0);_=Freedo.Quaternion.fromAxisAngle(w,a,new Freedo.Quaternion)}else{var y=Freedo.Quaternion.fromAxisAngle(new Freedo.Cartesian3(0,-1,0),a,new Freedo.Quaternion);v=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,y,new Freedo.Cartesian3(1,1,1));var g=Freedo.Matrix4.getRotation(v,new Freedo.Matrix3);var w=Freedo.Matrix3.multiplyByVector(g,new Freedo.Cartesian3(1,0,0),new Freedo.Cartesian3);w=new Freedo.Cartesian3(1,0,0);_=Freedo.Quaternion.fromAxisAngle(w,o,new Freedo.Quaternion)}Freedo.Quaternion.multiply(p,_,p);for(var F in _){if(c)c[F]=_[F]}m=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3(0,0,0),p,new Freedo.Cartesian3(1,1,1));var b=Freedo.Transforms.eastNorthUpToFixedFrame(f);if(this._isPlaneMode){b=Freedo.Matrix4.fromTranslation(f)}var C=Freedo.Matrix4.inverse(b,new Freedo.Matrix4);var x=Freedo.Transforms.eastNorthUpToFixedFrame(h);if(this._isPlaneMode){x=Freedo.Matrix4.fromTranslation(h)}var P=Freedo.Matrix4.multiply(v,C,new Freedo.Matrix4);var M=Freedo.Matrix4.multiply(m,P,new Freedo.Matrix4);var T=Freedo.Matrix4.multiply(x,M,new Freedo.Matrix4);var E=Freedo.Matrix4.getRotation(T,new Freedo.Matrix3);for(var F in E){if(d)d[F]=E[F]}return T};d.prototype.calcAxisZoom=function(){if(this._bInClip===false){this._axisZoom=1;return}var e=this._sceneSphere.center;var t=this._viewer.camera.positionWC;var r=1,i=1;r=Freedo.Cartesian3.distance(e,t)/6;i=this._viewer.camera.getPixelSize(this._sceneSphere,100,100);this._axisZoom=r;if(this._axisZoom>4e5)this._axisZoom=4e5;if(this._axisZoom<20)this._axisZoom=20};d.prototype.onTransforming=function(e){var t=e.SelectedAxis;this._selectedAxis=t;var r=[0,0,0];var i=1,n=1,a=1,o=0,s=0,l=0;this.calcAxisZoom();var u=Freedo.clone(this._mouseDown12Arg,true);var d=S.FdMisc.FdGeometric.calcAngle2D(e.MouseDownStartXY,e.MouseDownXY,e.MouseDownStartXY,e.MouseMoveXY);if(t==="Z_AXIS"||t==="clipPlaneGeo"){var c=Math.sqrt(Math.pow(e.MouseDownXY.y-e.MouseMoveXY.y,2)+Math.pow(e.MouseDownXY.x-e.MouseMoveXY.x,2))*this._axisZoom/200;if(c==0)return;var f=[e.MouseDownEndXY.x-e.MouseDownStartXY.x,e.MouseDownEndXY.y-e.MouseDownStartXY.y];var h=[e.MouseMoveXY.x-e.MouseDownXY.x,e.MouseMoveXY.y-e.MouseDownXY.y];var p=(f[0]*h[0]+f[1]*h[1])/(Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2))*Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2)));var v=Math.acos(p);var m,_,y;if(this._isPlaneMode){m={};m.longitude=this._sceneSphere.center.x;m.latitude=this._sceneSphere.center.y;m.height=this._sceneSphere.center.z;_=new Freedo.Cartesian3(this._sceneSphere.center.x,this._sceneSphere.center.y,this._sceneSphere.center.z+1);y=Freedo.Cartesian3.subtract(_,this._sceneSphere.center,new Freedo.Cartesian3)}else{m=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);_=Freedo.Cartesian3.fromRadians(m.longitude,m.latitude,m.height+1);y=Freedo.Cartesian3.subtract(_,this._sceneSphere.center,new Freedo.Cartesian3)}var g=new Freedo.Matrix3;this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,m.longitude,m.latitude,m.height,g);var w=Freedo.Matrix3.multiplyByVector(g,y,new Freedo.Cartesian3);var F=Freedo.Transforms.eastNorthUpToFixedFrame(this._sceneSphere.center);if(this._isPlaneMode){F=Freedo.Matrix4.fromTranslation(this._sceneSphere.center)}var b=Freedo.Matrix4.inverse(F,new Freedo.Matrix4);g=Freedo.Matrix4.getRotation(b,new Freedo.Matrix3);var C=Freedo.Matrix3.multiplyByVector(g,w,new Freedo.Cartesian3);var x=[1,1];if(this._isPlaneMode){x=[1,1]}else{x=S.FdMisc.FdGeometric.getLongAndLatRatio(m)}r[0]=x[1]*c*C.x*Math.cos(v);r[1]=x[0]*c*C.y*Math.cos(v);r[2]=c*C.z*Math.cos(v)}if(t==="XZ_CIRCLE"){var P=Freedo.Cartesian3.subtract(e.Ori.yAxis[1],e.Ori.yAxis[0],new Freedo.Cartesian3);var M=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(P,e.Ori.rayDirection));if(M>90)s=d;else s=-1*d}if(t==="YZ_CIRCLE"){var T=Freedo.Cartesian3.subtract(e.Ori.xAxis[1],e.Ori.xAxis[0],new Freedo.Cartesian3);var M=Freedo.Math.toDegrees(Freedo.Cartesian3.angleBetween(T,e.Ori.rayDirection));if(M>90)l=-1*d;else l=d}var E={TMoveX:r[0],TMoveY:r[1],TMoveZ:r[2],THeading:0,TPitch:s,TRoll:l,TScaleX:1,TScaleY:1,TScaleZ:1};u.TMoveX+=E.TMoveX;u.TMoveY+=E.TMoveY;u.TMoveZ+=E.TMoveZ;u.TRoll=E.TRoll;u.TPitch=E.TPitch;this._t12.TMoveX=u.TMoveX;this._t12.TMoveY=u.TMoveY;this._t12.TMoveZ=u.TMoveZ;this._t12.TPitch=u.TPitch;this._t12.TRoll=u.TRoll;this.refineArgs();this._event.raiseEvent("Cliping",this.clipOptions);this._event.raiseEvent("DataChanged",this.clipOptions);this.updatePlane(this._t12);this._viewer.scene.requestRender()};d.prototype.updatePlane=function(e){var t,r,i;var n=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);if(n){t=n.longitude;r=n.latitude;i=n.height}if(this._isPlaneMode){t=this._sceneSphere.center.x;r=this._sceneSphere.center.y;i=this._sceneSphere.center.z}var a=undefined;var o=undefined;var s=new Freedo.Matrix3;var l=new Freedo.Matrix4;if(this._selectedAxis==="clipPlaneGeo"||this._selectedAxis==="Z_AXIS"||this._selectedAxis==="XZ_CIRCLE"||this._selectedAxis==="YZ_CIRCLE"){var u,d;if(this._isPlaneMode){u=Freedo.clone(this._sceneSphere.center,true);u.z-=1;var d=Freedo.clone(u,true)}else{u=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);u.height-=1;var d=Freedo.Cartesian3.fromRadians(u.longitude,u.latitude,u.height)}var c=Freedo.Cartesian3.subtract(d,this._sceneSphere.center,new Freedo.Cartesian3);l=this.getMatrix(this._q4,e.TMoveX,e.TMoveY,e.TMoveZ,e.THeading,e.TPitch,e.TRoll,t,r,i,s);var f=Freedo.Matrix3.multiplyByVector(s,c,new Freedo.Cartesian3);if(isNaN(f.x)){console.warn("出现异常v2");return}a=Freedo.Cartesian3.normalize(f,new Freedo.Cartesian3)}if(a!==undefined){var o=new Freedo.Plane(new Freedo.Cartesian3(0,0,1),0);var h=Freedo.Transforms.eastNorthUpToFixedFrame(this._sceneSphere.center);if(this._isPlaneMode){var h=Freedo.Matrix4.fromTranslation(this._sceneSphere.center)}Freedo.Matrix4.multiply(l,h,h);var p=[o];this._event.raiseEvent("ClipPlaneUpdate",{plane:o,modelMatrix:h});var v=true;var m=false;var _=undefined;try{for(var y=(0,b.default)(this._tilesets),g;!(v=(g=y.next()).done);v=true){var w=g.value;var F=w;F.clippingPlanes=new Freedo.ClippingPlaneCollection({planes:p,edgeWidth:1,modelMatrix:h,useGltfModelMatrix:false})}}catch(e){m=true;_=e}finally{try{if(!v&&y.return){y.return()}}finally{if(m){throw _}}}}this._mani.updateMatrix4(l)};d.prototype.refineArgs=function(){this._t12.TMoveX=S.FdMisc.FdMath.round(this._t12.TMoveX,8);this._t12.TMoveY=S.FdMisc.FdMath.round(this._t12.TMoveY,8);this._t12.TMoveZ=S.FdMisc.FdMath.round(this._t12.TMoveZ,6);this._t12.TPitch=S.FdMisc.FdMath.round(this._t12.TPitch,4);this._t12.TRoll=S.FdMisc.FdMath.round(this._t12.TRoll,4)};d.prototype.getData=function(){return{type:this._transType,TMoveX:this._t12.TMoveX,TMoveY:this._t12.TMoveY,TMoveZ:this._t12.TMoveZ,TPitch:this._t12.TPitch,TRoll:this._t12.TRoll}};d.prototype.setData=function(e){this._tilesets=e};d.prototype.reset12Args=function(){this._t12.TMoveX=0;this._t12.TMoveY=0;this._t12.TMoveZ=0;this._t12.TPitch=0;this._t12.TRoll=0};d.prototype.onTransformStart=function(e){this._event.raiseEvent("ClipStart",{});this.refineArgs();this._mouseDown12Arg=Freedo.clone(this._t12,true)};d.prototype.onTransformEnd=function(e){var t,r,i;if(this._isPlaneMode){t=this._sceneSphere.center.x;r=this._sceneSphere.center.y;i=this._sceneSphere.center.z}else{var n=Freedo.Cartographic.fromCartesian(this._sceneSphere.center);t=n.longitude;r=n.latitude;i=n.height}var a=new Freedo.Quaternion;var o=this.getMatrix(this._q4,this._t12.TMoveX,this._t12.TMoveY,this._t12.TMoveZ,this._t12.THeading,this._t12.TPitch,this._t12.TRoll,t,r,i,new Freedo.Matrix3,a);Freedo.Quaternion.multiply(this._q4,a,this._q4);this.refineArgs();this._event.raiseEvent("ClipEnd",Freedo.clone(this._t12,true))};d.prototype.backToOriginPlane=function(){var e=this._transType;this.cancel();this.start(e);this._event.raiseEvent("ClipReset",Freedo.clone(this._t12,true))};d.prototype.hideAxis=function(){this._mani.hideAxis()};d.prototype.showAxis=function(){this._mani.hideAxis(false)};d.prototype.hideAxis=function(){this._mani.hideAxis(true)};d.prototype.cancelClip=function(){this.reset();this._event.raiseEvent("Cancel",{})};d.prototype.cancel=function(){this.cancelClip()};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.reset=function(){this._bInClip=false;this._sceneSphere=null;this.reset12Args();this._mani.reset();if(this._lsner)this._lsner();this._lsner=undefined;this._q4=new Freedo.Quaternion(0,0,0,1);var e=true;var t=false;var r=undefined;try{for(var i=(0,b.default)(this._tilesets),n;!(e=(n=i.next()).done);e=true){var a=n.value;var o=a;if(Freedo.defined(o.clippingPlanes)){o.clippingPlanes.enabled=false;o.clippingPlanes.removeAll()}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}};d.prototype.dispose=function(){this.reset()};t.FdClipPlane=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdClipPlaneEditor=undefined;var i=r(1);var n=o(i);var a=r(5);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t,r,i){(0,n.default)(this,e);this._viewer=t;this._bInTransform=false;this._transType="MOVE";this._bInRun=false;this._startPt;this._endPt;this._points2;this._xAxisPL;this._yAxisPL;this._zAxisPL;this._XYPlane;this._XZCircle;this._YZCircle;this._selectedAxis="";this._mouseDownPos;this._mouseDownXY;this._mouseDownStartXY;this._mouseDownEndXY;this._initSphere;this._useDepthPicking=true;this._pickTranslucentDepth=true;this._fixedAxis="";this._DISPERRAD=111e3;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._oldPt;this._started=false;this._mouseDown=false;this._lastDis=-1;this._alpha=.5;this._axisZoom=1;this._color=Freedo.defaultValue(i,new Freedo.Color(1,1,1,.4));this.PositionType={NONE:0,ON_MODEL:1,ON_TERRAIN:2,ON_ELLIPSOID:3};this._t12=undefined;this._handler=undefined;this._oriObj={};this._m4=undefined;this._isPlaneMode=r;this._planeGeo=undefined;this._oldGeos=[];this._timer=setInterval(this.clearOldGeos.bind(this),500);this._showAxis=true;this._enableClipPlaneMove=true;this._arcLength=.3};s.prototype.clearOldGeos=function(){var e=this._oldGeos;this._oldGeos=[];for(var t=0;t<e.length;t++){this._viewer.scene.primitives.remove(e[t])}};s.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};s.prototype.startClip=function(e){this._transType=e;if(this._bInTransform)return;this._bInTransform=true;this.addListeners();this._bInRun=true};s.prototype.enableClipPlaneMove=function(e){this._enableClipPlaneMove=e};s.prototype.setArcLength=function(e){this._arcLength=e};s.prototype.show=function(e){this._initSphere=Freedo.clone(e,true);this.calcAxisZoom();this.calcCallbackArgs();this.showAxis()};s.prototype.updateMatrix4=function(e){this._m4=Freedo.clone(e,true)};s.prototype.updateSceneSphere=function(e){this._initSphere=Freedo.clone(e,true)};s.prototype.addListeners=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.onLeftDown.bind(this),Freedo.ScreenSpaceEventType.LEFT_DOWN);this._handler.setInputAction(this.onMouseMove.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._handler.setInputAction(this.onLeftUp.bind(this),Freedo.ScreenSpaceEventType.LEFT_UP);this._handler.setInputAction(this.onWheel.bind(this),Freedo.ScreenSpaceEventType.WHEEL);var e=this;window.addEventListener("keydown",this.onKeyDown.bind(this))};s.prototype.calcAxisZoom=function(){if(this._bInTransform===false){this._axisZoom=1;return}var e=this._initSphere.center;var t=this._viewer.camera.positionWC;var r=1,i=1;r=Freedo.Cartesian3.distance(e,t)/4;i=this._viewer.camera.getPixelSize(this._initSphere,100,100);this._axisZoom=r;if(this._axisZoom>4e5)this._axisZoom=4e5;if(this._axisZoom<20)this._axisZoom=20};s.prototype.onWheel=function(){if(this._bInTransform===false)return;this.calcAxisZoom()};s.prototype.onKeyDown=function(){if(this._bInTransform===false)return};s.prototype.onMouseMove=function(e){if(!this._bInTransform)return;if(this._selectedAxis!=""){this._event.raiseEvent("Transforming",{MouseDownStartXY:this._mouseDownStartXY,MouseDownEndXY:this._mouseDownEndXY,MouseDownXY:this._mouseDownXY,MouseMoveXY:e.endPosition,SelectedAxis:this._selectedAxis,Ori:this._oriObj});this.regenPts()}this._viewer.scene.requestRender()};s.prototype.regenPts=function(){if(this._points2===undefined)this._points2=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);if(this._points2.length>0){this._points2.removeAll()}var e=Freedo.Cartesian3.fromDegreesArrayHeights([h,p,v,h,p,v+f]);if(this._isPlaneMode){e=[new Freedo.Cartesian3(h,p,v),new Freedo.Cartesian3(h,p,v+f)]}if(this._m4!==undefined){e[0]=Freedo.Matrix4.multiplyByPoint(this._m4,e[0],new Freedo.Cartesian3);e[1]=Freedo.Matrix4.multiplyByPoint(this._m4,e[1],new Freedo.Cartesian3)}this._points2.add({position:e[0],pixelSize:10,show:false,color:Freedo.Color.YELLOW});this._points2.add({position:e[1],pixelSize:10,show:false,color:Freedo.Color.YELLOW})};s.prototype.onLeftDown=function(e){if(!this._bInTransform)return;this.regenPts();this._mouseDown=true;this._oldPt;this._started=false;this._lastDis=-1;var t=this._viewer.scene.pick(e.position);if(!Freedo.defined(t)||!Freedo.defined(t.id)||!Freedo.defined(t.id._name)){var r=this._viewer.scene.drillPick(e.position);for(var i=0;i<r.length;i++){if(Freedo.defined(r[i].id)&&Freedo.defined(r[i].id._name)){t=r[i];break}}if(!Freedo.defined(t))return}var n=undefined;if(Freedo.defined(t.id)&&Freedo.defined(t.id._name)){n=t.id._name;if((n==="X_AXIS"||n==="Y_AXIS"||n==="Z_AXIS")&&this._transType.indexOf("CLIP")>=0){t.id.polyline.material.color=new Freedo.Color(1,1,0,1)}if(n==="YZ_CIRCLE"||n==="XZ_CIRCLE"){t.id.polyline.material.color=new Freedo.Color(1,1,0,1)}}if(Freedo.defined(t.primitive)&&Freedo.defined(t.primitive.name)){n=t.primitive.name}if(n==="XZ_CIRCLE"||n==="YZ_CIRCLE"||n==="X_AXIS"||n==="Y_AXIS"||n==="Z_AXIS"||n==="clipPlaneGeo"&&this._enableClipPlaneMove){this._selectedAxis=Freedo.clone(n,true);this._viewer.scene.screenSpaceCameraController.enableRotate=false;this._viewer.scene.screenSpaceCameraController.enableLook=false;this._mouseDownPos;var a=this._viewer.camera.getPickRay(e.position);this._oriObj.rayDirection=a.direction;this._event.raiseEvent("Transform",{})}this._mouseDownXY=e.position;var o=this._points2.get(0);var s=this._points2.get(1);this._mouseDownStartXY=o.computeScreenSpacePosition(this._viewer.scene,new Freedo.Cartesian2);this._mouseDownEndXY=s.computeScreenSpacePosition(this._viewer.scene,new Freedo.Cartesian2);this._viewer.scene.requestRender()};s.prototype.backToEnableRotate=function(e){if(this._selectedAxis===""){this._viewer.scene.screenSpaceCameraController.enableRotate=true;this._viewer.scene.screenSpaceCameraController.enableLook=true}};s.prototype.onLeftUp=function(e){setTimeout(this.backToEnableRotate.bind(this),500);if(!this._bInTransform)return;this._mouseDown=false;if(this._selectedAxis==="XZ_CIRCLE"){this._XZCircle.polyline.material.color=new Freedo.Color(0,1,0,this._alpha)}if(this._selectedAxis==="YZ_CIRCLE"){this._YZCircle.polyline.material.color=new Freedo.Color(1,0,0,this._alpha)}if(this._selectedAxis==="X_AXIS"){this._xAxisPL.polyline.material.color=Freedo.Color.RED}if(this._selectedAxis==="Y_AXIS"){this._yAxisPL.polyline.material.color=Freedo.Color.GREEN}if(this._selectedAxis==="Z_AXIS"){this._zAxisPL.polyline.material.color=Freedo.Color.BLUE}if(this._selectedAxis!==""){this._event.raiseEvent("Transformed",{})}this._selectedAxis="";this._viewer.scene.requestRender()};s.prototype.clearAxis=function(){if(this._xAxisPL){this._viewer.entities.remove(this._xAxisPL);this._viewer.entities.remove(this._yAxisPL);this._viewer.entities.remove(this._zAxisPL);this._viewer.scene.primitives.remove(this._planeGeo);this._points2.removeAll();this._viewer.entities.remove(this._XYPlane);this._viewer.entities.remove(this._XZCircle);this._viewer.entities.remove(this._YZCircle)}this._selectedAxis="";this._viewer.scene.requestRender()};var l=undefined;var f=undefined;var u=undefined;var h=undefined;var p=undefined;var v=undefined;var m=[];s.prototype.calcCallbackArgs=function(){l=this._initSphere.center;f=this._initSphere.radius*4;if(f>160)f=160;u=Freedo.Cartographic.fromCartesian(l);if(this._isPlaneMode){h=l.x;p=l.y;v=l.z;m=[1,1]}else{h=Freedo.Math.toDegrees(u.longitude);p=Freedo.Math.toDegrees(u.latitude);v=u.height;m=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(u)}f=this._axisZoom;if(this._planeGeo)this._planeGeo.modelMatrix=this._m4};s.prototype.callbackXZHalfCircle=function(e,t){this.calcCallbackArgs();var r=Freedo.Math.toDegrees(f*.9*m[0]);var i=Freedo.Math.toDegrees(f*.9*m[1]);if(this._isPlaneMode){var r=f*.9;var i=f*.9}var n=[];var a=Math.PI/2+this._arcLength;var o=Math.PI/2-this._arcLength;if(this._selectedAxis=="XZ_CIRCLE"){a=Math.PI*2;o=0}for(var s=a;s>=o;s=s-.001){var l=h+r*Math.cos(s);var u=p;var d=v+f*.9*Math.sin(s);var c;if(this._isPlaneMode){c=new Freedo.Cartesian3(l,u,d)}else c=Freedo.Cartesian3.fromDegrees(l,u,d);n.push(c)}t=n;this.reCalcPos(t);return t};s.prototype.callbackYZHalfCircle=function(e,t){this.calcCallbackArgs();var r=Freedo.Math.toDegrees(f*.9*m[0]);var i=Freedo.Math.toDegrees(f*.9*m[1]);if(this._isPlaneMode){var r=f*.9;var i=f*.9}var n=[];var a=Math.PI/2+this._arcLength;var o=Math.PI/2-this._arcLength;if(this._selectedAxis=="YZ_CIRCLE"){a=Math.PI*2;o=0}for(var s=a;s>=o;s=s-.001){var l=h;var u=p+i*Math.cos(s);var d=v+f*.9*Math.sin(s);var c;if(this._isPlaneMode){c=new Freedo.Cartesian3(l,u,d)}else c=Freedo.Cartesian3.fromDegrees(l,u,d);n.push(c)}t=n;this.reCalcPos(t);return t};s.prototype.callbackXYRect=function(e,t){this.calcCallbackArgs();var r=Freedo.Math.toDegrees(f*1.2*m[0]);var i=Freedo.Math.toDegrees(f*1.2*m[1]);if(this._isPlaneMode){r=f*1.2;i=f*1.2;t=[new Freedo.Cartesian3(h+r,p+i,v),new Freedo.Cartesian3(h-r,p+i,v),new Freedo.Cartesian3(h-r,p-i,v),new Freedo.Cartesian3(h+r,p-i,v),new Freedo.Cartesian3(h+r,p+i,v)]}else{t=Freedo.Cartesian3.fromDegreesArrayHeights([h+r,p+i,v,h-r,p+i,v,h-r,p-i,v,h+r,p-i,v,h+r,p+i,v])}this.reCalcPos(t);return t};s.prototype.callbackX=function(e,t){this.calcCallbackArgs();var r=0;if(this._isPlaneMode){r=f;t=[new Freedo.Cartesian3(h,p,v),new Freedo.Cartesian3(h+r,p,v)]}else{r=Freedo.Math.toDegrees(f*m[0]);t=Freedo.Cartesian3.fromDegreesArrayHeights([h,p,v,h+r,p,v])}if(this._m4!==undefined){t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3);t[1]=Freedo.Matrix4.multiplyByPoint(this._m4,t[1],new Freedo.Cartesian3)}this._oriObj.xAxis=t;return t};s.prototype.callbackY=function(e,t){this.calcCallbackArgs();var r=0;if(this._isPlaneMode){r=f;t=[new Freedo.Cartesian3(h,p,v),new Freedo.Cartesian3(h,p+r,v)]}else{r=f/this._DISPERRAD;t=Freedo.Cartesian3.fromDegreesArrayHeights([h,p,v,h,p+r,v])}if(this._m4!==undefined){t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3);t[1]=Freedo.Matrix4.multiplyByPoint(this._m4,t[1],new Freedo.Cartesian3)}this._oriObj.yAxis=t;return t};s.prototype.callbackZ=function(e,t){this.calcCallbackArgs();if(this._isPlaneMode){t=[new Freedo.Cartesian3(h,p,v),new Freedo.Cartesian3(h,p,v+f)]}else{t=Freedo.Cartesian3.fromDegreesArrayHeights([h,p,v-f,h,p,v+f])}if(this._m4!==undefined){t[0]=Freedo.Matrix4.multiplyByPoint(this._m4,t[0],new Freedo.Cartesian3);t[1]=Freedo.Matrix4.multiplyByPoint(this._m4,t[1],new Freedo.Cartesian3)}return t};s.prototype.reCalcPos=function(e){if(this._m4!==undefined){for(var t in e){e[t]=Freedo.Matrix4.multiplyByPoint(this._m4,e[t],new Freedo.Cartesian3)}}};s.prototype.updateClipPlaneGeo=function(e){if(!this._bInTransform)return;if(this._planeGeo){this._planeGeo.show=false;this._oldGeos.push(this._planeGeo)}if(true){var t=[];var r=Freedo.Math.toDegrees(f*1.2*m[0]);var i=Freedo.Math.toDegrees(f*1.2*m[1]);if(this._isPlaneMode){r=f*1.2;i=f*1.2;t=[new Freedo.Cartesian3(h+r,p+i,v),new Freedo.Cartesian3(h-r,p+i,v),new Freedo.Cartesian3(h-r,p-i,v),new Freedo.Cartesian3(h+r,p-i,v),new Freedo.Cartesian3(h+r,p+i,v)]}else{t=Freedo.Cartesian3.fromDegreesArrayHeights([h+r,p+i,v,h-r,p+i,v,h-r,p-i,v,h+r,p-i,v,h+r,p+i,v])}var n=this._color;this._planeGeo=this._viewer.scene.primitives.add(this.createAreaPrimitive(t,{color:n}));this._planeGeo.name="clipPlaneGeo"}};s.prototype.createAreaPrimitive=function(e,t){t=t||{};var r;if(false){}else{var i=[];for(var n=0;n<e.length;n++){i.push(e[n].x*1);i.push(e[n].y*1);i.push(e[n].z*1)}var a=Freedo.PolygonPipeline.triangulate(e);var o=new Float64Array(i);r=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:o})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(o)})}var s;if(!t.color)s=new Freedo.Color(1,1,1,.4);else s=t.color;return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:r,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(s)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:true}),show:this._showAxis,asynchronous:false,allowPicking:false})};s.prototype.showAxis=function(){var e=new Freedo.CallbackProperty(this.callbackXYRect.bind(this),false);var t=new Freedo.CallbackProperty(this.callbackXZHalfCircle.bind(this),false);var r=new Freedo.CallbackProperty(this.callbackYZHalfCircle.bind(this),false);var i=new Freedo.CallbackProperty(this.callbackX.bind(this),false);var n=new Freedo.CallbackProperty(this.callbackY.bind(this),false);var a=new Freedo.CallbackProperty(this.callbackZ.bind(this),false);this._xAxisPL=this._viewer.entities.add({name:"X_AXIS",polyline:{positions:i,width:0,show:this._showAxis,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.RED)}});this._yAxisPL=this._viewer.entities.add({name:"Y_AXIS",polyline:{positions:n,width:0,show:this._showAxis,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.GREEN)}});this._zAxisPL=this._viewer.entities.add({name:"Z_AXIS",polyline:{positions:a,width:8,show:this._transType=="CLIPXY"&&this._showAxis,followSurface:false,material:new Freedo.PolylineArrowMaterialProperty(Freedo.Color.BLUE)}});if(this._transType.indexOf("CLIP")>=0){this._XYPlane=this._viewer.entities.add({name:"XY_RECT",polyline:{positions:e,width:0,show:this._showAxis||true,followSurface:false,material:new Freedo.Color(1,1,1,this._alpha)}});this.updateClipPlaneGeo()}if(this._transType.indexOf("CLIPXY")>=0){this._XZCircle=this._viewer.entities.add({name:"XZ_CIRCLE",polyline:{positions:t,width:4,show:this._showAxis,material:new Freedo.Color(0,1,0,this._alpha)}});this._YZCircle=this._viewer.entities.add({name:"YZ_CIRCLE",polyline:{positions:r,width:4,show:this._showAxis,material:new Freedo.Color(1,0,0,this._alpha)}})}this.regenPts();this._viewer.scene.requestRender()};s.prototype.hideAxis=function(e){if(this._initSphere==undefined)return;this._showAxis=!e;this._zAxisPL.polyline.show=this._showAxis;this._XZCircle.polyline.show=this._showAxis;this._YZCircle.polyline.show=this._showAxis;this._planeGeo.show=this._showAxis};s.prototype.reset=function(){this._handler=this._handler&&this._handler.destroy();this._bInTransform=false;this.clearAxis();this._mouseDownPos=undefined;this._initSphere=undefined;this._fixedAxis=""};s.prototype.dispose=function(){this.reset()};t.FdClipPlaneEditor=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPickPModel=undefined;var i=r(3);var h=u(i);var n=r(118);var a=u(n);var o=r(1);var s=u(o);var l=r(5);function u(e){return e&&e.__esModule?e:{default:e}}var d=function e(t){(0,s.default)(this,e);this._viewer=t;this._bInSurvey=false;this._tss=new a.default;this._clickMode=Freedo.ScreenSpaceEventType.LEFT_CLICK;this._highlightColor=Freedo.Color.RED.withAlpha(.8);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper};d.prototype.setClickMode=function(e){this._clickMode=e};d.prototype.setHighlightColor=function(e,t,r,i){this._highlightColor=new Freedo.Color(e/255,t/255,r/255,i)};d.prototype.start=function(){this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.handleLeftClick.bind(this),this._clickMode);this._bInSurvey=true};d.prototype.cancel=function(){this.reset()};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.handleLeftClick=function(e){if(this._bInSurvey==false)return;this.pickModel(e.position)};d.prototype.pickModel=function(e){var t=this._viewer.scene;var r=t.drillPick(e);if(Freedo.defined(r)&&r.length>0){for(var i=0;i<r.length;i++){var n=r[i].tileset;if(!n)n=r[i].primitive;if(n.style!=undefined&&n.style.color!=undefined)continue;this._tss.add(r[i]);if(Freedo.defined(r[i].id)&&r[i].id.name=="PINICON"){console.info(r[i].id.sceneObjectID)}var a=this._highlightColor;var o=new Freedo.FreedoPModelStyle;o.color={evaluateColor:function e(t,r,i){return Freedo.Color.clone(a,i)}};n.style=o;this._event.raiseEvent("DataChanged",{tileset:n})}}else{var s=true;var l=false;var u=undefined;try{for(var d=(0,h.default)(this._tss.keys()),c;!(s=(c=d.next()).done);s=true){var f=c.value;if(f.tileset)f.tileset.style=undefined;if(f.primitive)f.primitive.style=undefined}}catch(e){l=true;u=e}finally{try{if(!s&&d.return){d.return()}}finally{if(l){throw u}}}this._tss.clear();this._event.raiseEvent("DataChanged",undefined)}this._viewer.scene.requestRender()};d.prototype.getData=function(){if(Freedo.defined(this._tss)){var e=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,h.default)(this._tss.keys()),a;!(t=(a=n.next()).done);t=true){var o=a.value;e.push(o.tileset.url)}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}return e}};d.prototype.highlightModel=function(e){var n=this._highlightColor;var t=new Freedo.FreedoPModelStyle;t.color={evaluateColor:function e(t,r,i){return Freedo.Color.clone(n,i)}};e.style=t};d.prototype.reset=function(){this._bInSurvey=false;this._handler=this._handler&&this._handler.destroy();var e=true;var t=false;var r=undefined;try{for(var i=(0,h.default)(this._tss.keys()),n;!(e=(n=i.next()).done);e=true){var a=n.value;a.tileset.style=undefined}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}this._tss.clear()};t.FdPickPModel=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGeologySimulationHandler=undefined;var i=r(1);var a=u(i);var n=r(2);var o=u(n);var s=r(10);var l=r(238);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function n(e,t,r){(0,a.default)(this,n);if(!Freedo.defined(t)){throw new Freedo.DeveloperError("geologySimulationManager Is Required!")}this._viewer=e;this._scene=this._viewer.scene;this._ple=new s.FdPolylineEditor(e);this._ple.setAutoDelLines(true);if(typeof t==="string"){this._geologySimulationManager=new FdTools.FdGeologySimulationManager(e.scene,JSON.parse(t),r)}else{this._geologySimulationManager=t}this._data=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var i=this;this._geologySimulationManager.on(function(e,t){if(e==="dataAdded"){i._data.push(t);i._event.raiseEvent("dataChanged",t)}})}(0,o.default)(n,[{key:"getData",value:function e(){return this._data}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"start",value:function e(){this._ple.run();if(this._lsner){this._lsner();this._lsner=undefined}var r=this;this._lsner=this._ple.on(function(e,t){if(e==="PLAdd"){r.onPLAdd(t)}});this._event.raiseEvent("start",{})}},{key:"cancel",value:function e(){this._ple.cancel();this._event.raiseEvent("cancel",{})}},{key:"onPLAdd",value:function e(t){if(!t.polyline)return;if(t.polyline.pts.length===2){this._ple.delResult();return}var r=t.polyline.pts;var i=[];for(var n=0;n<r.length;n++){i.push(Freedo.Cartographic.fromCartesian(r[n]))}this._geologySimulationManager.addGeologySimulation(i,1,5,5,undefined,true)}},{key:"reset",value:function e(){if(this._lsner)this._lsner();this._lsner=undefined;this._data=[];this._ple.cancel()}},{key:"dispose",value:function e(){this.reset();this._event.raiseEvent("dispose",{});this._eventHelper.removeAll()}},{key:"geologySimulationManager",get:function e(){return this._geologySimulationManager}}]);return n}();t.FdGeologySimulationHandler=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DrillData=undefined;var i=r(1);var n=o(i);var a=r(562);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t){(0,n.default)(this,e);this.name=t.name;this.waterDepth=parseFloat(t.water_depth);var r=t.pos.split(",");this.cartographic=Freedo.Cartographic.fromDegrees(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2]));this.cartesian=Freedo.Cartesian3.fromRadians(this.cartographic.longitude,this.cartographic.latitude,this.cartographic.height);this.cartesianOnZeroHeight=Freedo.Cartesian3.fromRadians(this.cartographic.longitude,this.cartographic.latitude,0);this.pos=t.pos;this.layers=[];for(var i=t.layer.length-1;i>=0;i--){this.layers.push(new a.LayerData(t.layer[i]))}this.layers.sort(function(e,t){return e.depth-t.depth});for(var i=0;i<this.layers.length;i++){this.layers[i].thickness=i>0?this.layers[i].depth-this.layers[i-1].depth:this.layers[i].depth}};t.DrillData=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LayerData=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t){(0,n.default)(this,e);this.name=t.name;this.depth=parseFloat(t.depth)};t.LayerData=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getSimulateDrill=t.getOffsetPoint=t.interpolate=undefined;var i=r(35);var F=n(i);function n(e){return e&&e.__esModule?e:{default:e}}var d=new Freedo.Cartesian3;var a=new Freedo.Cartesian3;function o(e,t,r){var i=[];var n=Freedo.Cartesian3.fromRadians(e.longitude,e.latitude,e.height);var a=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);var o=Freedo.Cartesian3.distance(n,a);if(o>r){var s=o/r;for(var l=0;l<s-1;++l){Freedo.Cartesian3.lerp(n,a,(l+1)/s,d);var u=Freedo.Cartographic.fromCartesian(d);i.push(u)}}return i}function b(e,t){if(!Freedo.defined(t)){t=[]}for(var r=0;r<e.length;r++){t.push({name:e[r].name,depth:e[r].depth,thickness:e[r].thickness})}return t}function s(e,t,r){var i=new Freedo.Cartesian3;Freedo.Cartesian3.multiplyByScalar(t,r,i);Freedo.Cartesian3.add(e,i,i);return i}function l(e,t,r){var i=[];var n=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,0);var a=0;for(var o=0;o<e._drillDataArray.length;o++){var s=e._drillDataArray[o];var l=Freedo.Cartesian3.distance(s.cartesianOnZeroHeight,n);if(l<=r){i.push({name:s.name,waterDepth:s.waterDepth,layers:b(s.layers),weight:1/l,pos:s.pos});a+=1/l}}var u=i.length;if(u<1){var d=Number.MAX_VALUE;var c=-1;for(var o=0;o<e._drillDataArray.length;o++){var l=Freedo.Cartesian3.distance(e._drillDataArray[o].cartesianOnZeroHeight,n);if(l<=d){c=o}}return{waterDepth:e._drillDataArray[c].waterDepth,drillsInfo:[{drillName:e._drillDataArray[c].name,drillPos:e._drillDataArray[c].pos,layers:e._drillDataArray[c].layers}],layers:b(e._drillDataArray[c].layers)}}var f=0;var h=[];for(var o=0;o<u;o++){i[o].weight/=a;f+=i[o].waterDepth*i[o].weight;h.push({drillName:i[o].name,drillPos:i[o].pos,layers:Freedo.clone(i[o].layers)})}var p=[];while(true){var v=false;for(var o=0;o<u;o++){if(i[o].layers.length>0){v=true;break}}if(!v){break}var m=new F.default;for(var o=0;o<u;o++){if(i[o].layers.length>0){var _=i[o].layers[0].name;if(!m.has(_)){m.set(_,{weight:i[o].weight,thickness:i[o].layers[0].thickness*i[o].weight})}else{m.set(_,{weight:m.get(_).weight+i[o].weight,thickness:m.get(_).thickness+i[o].layers[0].thickness*i[o].weight})}}}var y=0;var g;var w=0;m.forEach(function(e,t){if(y<e.weight){y=e.weight;g=t;w=e.thickness}});for(var o=0;o<u;o++){if(i[o].layers.length>0&&i[o].layers[0].name===g){i[o].layers.shift()}}p.push({name:g,thickness:w,depth:w+(p.length>0?p[p.length-1].depth:0)})}return{waterDepth:f,drillsInfo:h,pos:t,layers:p}}t.interpolate=o;t.getOffsetPoint=s;t.getSimulateDrill=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdEraseGroundHandler=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(10);var l=r(239);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function i(e,t){(0,n.default)(this,i);this._viewer=e;this._lsner=undefined;if(!Freedo.defined(t)){t=new FdTools.FdEraseGroundManager(e)}this._eraseGroundManager=t;this._ple=new s.FdPolylineEditor(e);this._ple.setAutoDelLines(true);this._data=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var r=this;this._eraseGroundManager.on(function(e,t){if(e==="dataAdded"){r._data.push(t);r._event.raiseEvent("dataChanged",t)}})}(0,o.default)(i,[{key:"getData",value:function e(){return this._data}},{key:"start",value:function e(r){r=Freedo.defaultValue(r,[0,0,0,1]);this._ple.run();if(this._lsner){this._lsner();this._lsner=undefined}var i=this;this._lsner=this._ple.on(function(e,t){if(e==="PLAdd"){i.onPLAdd(t,r)}});this._event.raiseEvent("start",{})}},{key:"onPLAdd",value:function e(t,r){if(!t.polyline)return;if(t.polyline.pts.length===2){this._ple.delResult();return}this._eraseGroundManager.eraseGroudByPointsArray(t.polyline.pts,r)}},{key:"cancel",value:function e(){this._ple.cancel();this._event.raiseEvent("cancel",{})}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){if(this._lsner)this._lsner();this._lsner=undefined;this._data=[];this._ple.cancel()}},{key:"dispose",value:function e(){this.reset()}},{key:"eraseGoundManager",get:function e(){return this._eraseGroundManager}}]);return i}();t.FdEraseGroundHandler=d},function(e,t,r){e.exports={default:r(566),__esModule:true}},function(e,t,r){r(79);r(70);e.exports=r(567)},function(e,t,r){var i=r(116);var n=r(21)("iterator");var a=r(80);e.exports=r(13).isIterable=function(e){var t=Object(e);return t[n]!==undefined||"@@iterator"in t||a.hasOwnProperty(i(t))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDrawPolyline=undefined;var i=r(3);var c=d(i);var n=r(1);var a=d(n);var o=r(2);var s=d(o);var f=r(56);var l=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function t(e){(0,a.default)(this,t);this._viewer=e;this._polylines=[];this._data=[];this._lsner=undefined;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._handler=undefined;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._smoothRate=0;this._currentIndex=0}(0,s.default)(t,[{key:"polylinesOptions",get:function e(){return this._data},set:function e(t){if(!Freedo.defined(t)){console.error("polyline数据错误");return}this.clearPolylines();var r=true;var i=false;var n=undefined;try{for(var a=(0,c.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this.addPolyline(s["pts"])}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}}]);return t}();h.prototype.start=function(){this._ple.run();this.addLsnr();this._event.raiseEvent("Start",{})};h.prototype.addLsnr=function(){if(this._lsner){this._lsner();this._lsner=undefined}var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){r.onPLAdd(t)}if(e=="EditEnd"){r.polylinesOptions[r._currentIndex].pts=Freedo.clone(t.pts);r.reDraw()}})};h.prototype.onPLAdd=function(e){this.addPolyline(e.polyline.pts)};h.prototype.calcCP=function(e,t,r){var i,n,a;i=e.position;n=t.position;a=r.position;var o=[];var s=Freedo.Cartesian3.subtract(i,n,new Freedo.Cartesian3);var l=Freedo.Cartesian3.subtract(a,n,new Freedo.Cartesian3);var u=Freedo.Cartesian3.cross(s,l,new Freedo.Cartesian3);var d=Freedo.Cartesian3.normalize(s,new Freedo.Cartesian3);var c=Freedo.Cartesian3.normalize(l,new Freedo.Cartesian3);var f=Freedo.Cartesian3.add(d,c,new Freedo.Cartesian3);var h=Freedo.Quaternion.fromAxisAngle(u,Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion);var p=Freedo.Quaternion.fromAxisAngle(u,-1*Freedo.Math.PI_OVER_TWO,new Freedo.Quaternion);var v=Freedo.Matrix3.fromQuaternion(h,new Freedo.Matrix3);var m=Freedo.Matrix3.fromQuaternion(p,new Freedo.Matrix3);var _=Freedo.Matrix3.multiplyByVector(v,f,new Freedo.Cartesian3);var y=Freedo.Matrix3.multiplyByVector(m,f,new Freedo.Cartesian3);var g=Freedo.Cartesian3.normalize(_,new Freedo.Cartesian3);var w=Freedo.Cartesian3.normalize(y,new Freedo.Cartesian3);var F=Freedo.Cartesian3.distance(i,n);var b=Freedo.Cartesian3.distance(a,n);var C=1;if(F<b){C=F/4}else C=b/4;g=Freedo.Cartesian3.multiplyByScalar(g,C,new Freedo.Cartesian3);w=Freedo.Cartesian3.multiplyByScalar(w,C,new Freedo.Cartesian3);var x=Freedo.Cartesian3.add(n,g,new Freedo.Cartesian3);var P=Freedo.Cartesian3.add(n,w,new Freedo.Cartesian3);var M=Freedo.Cartesian3.distance(i,x);var T=Freedo.Cartesian3.distance(i,P);if(M<T)return[x,P];else return[P,x]};h.prototype.smoothPolyline=function(e){var t=[];if(e.length<3){for(var r=0;r<e.length;r++){t.push(e[r].position)}}else{for(var r=0;r<=e.length-2;r++){var i={},n={},a={},o={};if(r==0){i=e[0];n.position=this.calcCP(e[0],e[1],e[2])[0];a=e[0];o=e[1]}else if(r==e.length-2){i.position=this.calcCP(e[r-1],e[r],e[r+1])[1];n=e[r+1];a=e[r];o=e[r+1]}else{i.position=this.calcCP(e[r-1],e[r],e[r+1])[1];n.position=this.calcCP(e[r],e[r+1],e[r+2])[0];a=e[r];o=e[r+1]}var s=new f.FdBezierCurveAlgorithm(a,o,i,n);var l=s.getVertexForCurve(this._smoothRate);t=t.concat(l)}}var u=[];for(var r=0;r<t.length;r++){var d={};d=t[r];if(u.length>0){var c=Freedo.Cartesian3.distance(u[u.length-1],d);if(c>1e-4)u.push(d)}else u.push(d)}return u};h.prototype.createLinePrimitive=function(e){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:new Freedo.Color(1,.3,.3,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"PolylineDash",uniforms:{color:new Freedo.Color(1,.3,.3,.5)}}})})})};h.prototype.addPolyline=function(e){var t={};t.pts=e;var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,c.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u={position:l};r.push(u)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}if(this._smoothRate==0)t.smoothPts=e;else t.smoothPts=this.smoothPolyline(r);var d;d=this._viewer.scene.primitives.add(this.createLinePrimitive(t.smoothPts));t.polyline=d;this._polylines.push(t);this._data.push({pts:e});this._event.raiseEvent("PolylineAdd",e);this._event.raiseEvent("DataChanged",{pts:e});this._viewer.scene.requestRender()};h.prototype.createLinePrimitive=function(e){return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:2,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",width:2,uniforms:{color:new Freedo.Color(1,1,0,1)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-100,units:-100},depthTest:{enabled:true,func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",width:2,uniforms:{color:new Freedo.Color(1,1,0,1)}}})})})};h.prototype.cancel=function(){this._ple.cancel();this._event.raiseEvent("Cancel",{})};h.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};h.prototype.setSmoothRate=function(e){this._smoothRate=e;this.reDraw()};h.prototype.clearPolylines=function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,c.default)(this._polylines),a;!(t=(a=n.next()).done);t=true){var o=a.value;this._viewer.scene.primitives.remove(o["polyline"])}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._polylines=[];this._viewer.scene.requestRender()};h.prototype.getData=function(){return Freedo.clone(this._data,true)};h.prototype.startEdit=function(e){this.addLsnr();this._currentIndex=e;this._ple.startEdit(this.polylinesOptions[e].pts)};h.prototype.editPre=function(){this._ple.editPre()};h.prototype.editNext=function(){this._ple.editNext()};h.prototype.endEdit=function(){this._ple.endEdit()};h.prototype.removeAll=function(){this.clearPolylines();this._data=[]};h.prototype.reDraw=function(e){this.clearPolylines();var t=Freedo.clone(this._data,true);this._data=[];var r=true;var i=false;var n=undefined;try{for(var a=(0,c.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this.addPolyline(s["pts"])}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}};h.prototype.setHeightOffset=function(e){this._ple.setHeightOffset(e)};h.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this.clearPolylines();this._data=[]};h.prototype.dispose=function(){};t.FdDrawPolyline=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLabelsHandler=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(240);var l=r(171);function u(e){return e&&e.__esModule?e:{default:e}}var d=new Freedo.Cartesian3;var h=new Freedo.Color(1,.8,.5,1);var c=new Freedo.Color(1,1,1,1);var f="iFreedoUniqueID_";var p="_ErrorIcon";var v=function(){function r(e,t){(0,n.default)(this,r);this._viewer=e;this._labelsManager=new Freedo.FdTools.FdLabelsManager(e,undefined,true,true);this._enabled=false;this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(this.onMouseLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._lastSelectedBillboard=undefined;this._lastSelectedLabel=undefined;this._lastPickedObject=undefined;this._tilesets=t;this._onlySelectLabel=true;this._timer=setInterval(this.highlightSelectedPrimitive.bind(this),500);this._pickingComponent=new l.FdPickPMComponent(e);this._lastSelectedCloseIcon=undefined}(0,o.default)(r,[{key:"onMouseMove",value:function e(t){if(Freedo.defined(this._lastSelectedCloseIcon)){this._lastSelectedCloseIcon.show=false;this._lastSelectedCloseIcon=undefined;this._viewer.scene.requestRender()}if(this._labelsManager._billboards1.length===0){return}var r=this._viewer.scene.pick(t.endPosition);if(!Freedo.defined(r)){return}if(Freedo.defined(r.id)&&r.id.startsWith(f)){var i=r.id.substr(f.length);var n=i;var a=f+n;var o=a+p;for(var s=0;s<this._labelsManager._billboards1.length;s++){var l=this._labelsManager._billboards1.get(s);if(l.id===o){this._lastSelectedCloseIcon=l;l.show=true;break}}this._viewer.scene.requestRender()}}},{key:"onMouseLeftClick",value:function e(t){if(!this._enabled){return}if(this._onlySelectLabel&&this._labelsManager._billboards.length===0){return}this.resetHighlight();var r=this._viewer.scene.pick(t.position);if(!Freedo.defined(r)){return}this._lastPickedObject=r;var i;if(!this._onlySelectLabel){if(Freedo.defined(r.tileset)){i=r.getProperty("component")}else if(Freedo.defined(r.node)){i=r.node.name}}if(Freedo.defined(r.id)&&r.id.startsWith(f)){i=r.id.substr(f.length);if(i.endsWith(p)){i=i.substr(0,i.length-p.length);this._event.raiseEvent("DeleteComponentLabel",{component:i});return}if(r.primitive instanceof Freedo.Billboard){this._lastSelectedBillboard=r.primitive}else if(r.primitive instanceof Freedo.Label){this._lastSelectedLabel=r.primitive}}this.highlightByComponentId(i,true);var n=f+i;if(!Freedo.defined(this._lastSelectedBillboard)){for(var a=0;a<this._labelsManager._billboards.length;a++){var o=this._labelsManager._billboards.get(a);if(o.id===n){this._lastSelectedBillboard=o;break}}}if(!Freedo.defined(this._lastSelectedLabel)){for(var a=0;a<this._labelsManager._texts.length;a++){var s=this._labelsManager._texts.get(a);if(s.id===n){this._lastSelectedLabel=s;break}}}var l;var u;var s;if(Freedo.defined(this._lastSelectedLabel)&&Freedo.defined(this._lastSelectedBillboard)){l=this._lastSelectedBillboard.position;u=this._lastSelectedBillboard.image;s=this._lastSelectedLabel.text}else{l=this._viewer.scene.pickPosition(t.position,d);s=undefined;u=undefined}this._event.raiseEvent("EditComponentLabel",{position:l,image:u,text:s,component:i});return}},{key:"highlightByComponentId",value:function e(t,r){var i=this._tilesets;if(i.length===0){return}var n=i[0]instanceof Freedo.FreedoPModelset;if(n){for(var a=0;a<i.length;a++){if(r){this._pickingComponent.highlightComponent(t,i[a],255,0,0,.3)}}}else{for(var a=0;a<i.length;a++){var o=i[a].models;for(var s=0;s<o.length;s++){var l=o[s];var u=l.getNode(t);if(!Freedo.defined(u)){continue}this._lastPickedObject={node:u,primitive:l};var d=l.gltf;var c=d.nodes;for(var f=0;f<c.length;f++){if(c[f].name===t){if(r){c[f].highlightComponentColor=Freedo.clone(h,true)}else{c[f].highlightComponentColor=undefined}}}}}}}},{key:"highlightSelectedPrimitive",value:function e(){if(!Freedo.defined(this._lastSelectedLabel)||!Freedo.defined(this._lastSelectedBillboard)){return}var t=this._lastSelectedBillboard;var r=this._lastSelectedLabel;if(r.scale===1){r.scale=1.2;t.scale=1.2;r.fillColor=h;t.color=h}else{r.scale=1;t.scale=1;r.fillColor=c;t.color=c}this._viewer.scene.requestRender()}},{key:"resetHighlight",value:function e(){var t=this._lastPickedObject;if(Freedo.defined(t)&&Freedo.defined(t.node)){this.highlightByComponentId(t.node.name,false)}this._pickingComponent.unhighlightAllComponents();if(Freedo.defined(this._lastSelectedLabel)&&Freedo.defined(this._lastSelectedBillboard)){this._lastSelectedLabel.scale=1;this._lastSelectedLabel.fillColor=c;this._lastSelectedBillboard.scale=1;this._lastSelectedBillboard.color=c}this._lastPickedObject=undefined;this._lastSelectedLabel=undefined;this._lastSelectedBillboard=undefined}},{key:"start",value:function e(){this._enabled=true}},{key:"cancel",value:function e(){this._enabled=false;this.resetHighlight()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"addLabel",value:function e(t){if(!Freedo.defined(this.maxVisibleDistance)){if(Freedo.defined(this._viewer.scene.screenSpaceCameraController._boundingSphere)){this.maxVisibleDistance=this._viewer.scene.screenSpaceCameraController._boundingSphere.radius*10}else{this.maxVisibleDistance=5e3}this.maxVisibleDistance=Math.min(this.maxVisibleDistance,5e3)}var r=this;this._labelsManager.addLabel({id:f+t.id,position:t.position,text:t.text,image:t.image,show:true,asynchronous:false,distanceDisplayCondition:new Freedo.DistanceDisplayCondition(1,r.maxVisibleDistance)})}},{key:"deleteLabel",value:function e(t){var r=t.component;var i=f+r;var n=i+p;for(var a=0;a<this._labelsManager._billboards.length;a++){var o=this._labelsManager._billboards.get(a);if(o.id===i){this._labelsManager._billboards.remove(o);break}}for(var a=0;a<this._labelsManager._texts.length;a++){var s=this._labelsManager._texts.get(a);if(s.id===i){this._labelsManager._texts.remove(s);break}}for(var a=0;a<this._labelsManager._points.length;a++){var l=this._labelsManager._points.get(a);if(l.id===i){this._labelsManager._points.remove(l);break}}for(var a=0;a<this._labelsManager._billboards1.length;a++){var u=this._labelsManager._billboards1.get(a);if(u.id===n){this._labelsManager._billboards1.remove(u);break}}this._viewer.scene.requestRender()}},{key:"reset",value:function e(){if(this._lsner)this._lsner();this._labelsManager.dispose();this._labelsManager=undefined;this._event.raiseEvent("Dispose",{})}},{key:"dispose",value:function e(){this.reset();this._eventHelper.removeAll()}},{key:"visibility",get:function e(){return this._labelsManager._collection.show},set:function e(t){this._labelsManager._collection.show=t;this._viewer.scene.requestRender()}}]);return r}();t.FdLabelsHandler=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdFirstPersonControl=undefined;var i=r(1);var a=l(i);var n=r(2);var o=l(n);var s=r(237);function l(e){return e&&e.__esModule?e:{default:e}}var _=new Freedo.Cartesian3;var y=new Freedo.Cartesian3;var g=new Freedo.Ray;var u=new Freedo.Cartesian3;var d=new Freedo.Cartesian3;var c=new Freedo.Cartesian3;var f=new Freedo.Cartesian3;var z=new Freedo.Cartographic;var h=new Freedo.Cartesian2;var U=2;var j=new Freedo.Cartesian3;var p=function(){function t(o,l){(0,a.default)(this,t);this.firstPersonControlFlags={moveForward:false,moveBackward:false,moveUp:false,moveDown:false,moveLeft:false,moveRight:false,moveSpace:false,directionUp:false,directionDown:false,directionLeft:false,directionRight:false,doingAnimation:false,enabled:false};this.firstPersonControlStartPosition=undefined;this.firstPersonControlEndPosition=undefined;this.firstPersonControlSpeed=0;this.firstPersonControlStartTime=undefined;this.firstPersonControlEyeHeight=1.6;this.moveSpeed=5;this.rotateSpeed=1;this.leftBtnDownEvent=undefined;this.leftBtnUpEvent=undefined;this.wheelEvent=undefined;this.sceneCameraRotate=undefined;this.sceneCameraTranslate=undefined;this.sceneCameraZoom=undefined;this.sceneCameraTilt=undefined;this.sceneCameraLook=undefined;this.keyDownTime=undefined;this.maxMoveSpeed=50;this.acceleration=(this.maxMoveSpeed-this.moveSpeed)/2;this._initialized=false;this.cameraHeightValid=false;this._viewer=o;this.addedModel=undefined;this.AdjustMode=true;var k=.6;this._myScreenSpaceEventHandler=new Freedo.ScreenSpaceEventHandler(o.canvas);var e=this._myScreenSpaceEventHandler;var f=o.scene;var L=o.scene.globe.ellipsoid;o.scene.camera.frustum.near=.001;var D=this;var I=new Freedo.Ray;var R=new Freedo.Ray;var O=new Freedo.Ray;var N=new Freedo.Cartesian3;var B=new Freedo.Cartesian3;var H=undefined;var s=new Freedo.Matrix4;var u=new Freedo.Quaternion;var d=new Freedo.HeadingPitchRoll;var c=new Freedo.Cartesian3(1,1,1);var V=false;function n(){if(!V){return true}if(!D.addedModel.ready){return false}for(var e=0;e<D.addedModel.activeAnimations.length;e++){var t=D.addedModel.activeAnimations.get(e);if(t._state===Freedo.ModelAnimationState.ANIMATING){return true}}return false}var h=function e(t,r){var i=o.camera.heading;d.heading=i+Freedo.Math.PI/2;d.pitch=0;d.roll=0;N=L.geodeticSurfaceNormal(t,N);Freedo.Cartesian3.cross(N,o.camera.right,N);Freedo.Cartesian3.multiplyByScalar(N,U*r,N);Freedo.Cartesian3.add(t,N,t);var n=Freedo.Transforms.eastNorthUpToFixedFrame(t,undefined,s);u=Freedo.Quaternion.fromHeadingPitchRoll(d,u);var a=Freedo.Matrix4.fromTranslationQuaternionRotationScale(Freedo.Cartesian3.ZERO,u,c);Freedo.Matrix4.multiply(n,a,n);return n};this.calcCameraPosition=h;f.camera.changed.addEventListener(function(){if(!D._initialized||!D.firstPersonControlFlags.enabled)return;if(!D.addedModel){return}if(D.AdjustMode){var e=f.camera;var t=Freedo.Cartographic.fromCartesian(e.position);var r=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height-D.firstPersonControlEyeHeight);var i=h(r,1);D.addedModel.modelMatrix=i;D.AdjustMode=false;D.addedModel.show=true}if(D.addedModel.ready){if(!n()){D.addedModel.activeAnimations.addAll({loop:Freedo.ModelAnimationLoop.NONE})}}});function p(e,t){var r=e._viewer;var i=r.scene.pickPosition(t.position);if(!Freedo.defined(i)){var n=r.camera.getPickRay(t.position);i=f.globe.pick(n,f)}if(!Freedo.defined(i))return;var a=L.geodeticSurfaceNormal(i);var o=r.camera.position;var s=Freedo.Cartesian3.subtract(i,o,new Freedo.Cartesian3);s=Freedo.Cartesian3.normalize(s,new Freedo.Cartesian3);var l=Freedo.Cartesian3.cross(s,a,new Freedo.Cartesian3);l=Freedo.Cartesian3.normalize(l,new Freedo.Cartesian3);s=Freedo.Cartesian3.cross(a,l,new Freedo.Cartesian3);s=Freedo.Cartesian3.normalize(s,new Freedo.Cartesian3);var u=h(i,1);if(e.addedModel){e.addedModel.show=false;e.addedModel.modelMatrix=u;j=L.geodeticSurfaceNormal(i,j);Freedo.Cartesian3.cross(j,r.camera.right,j);Freedo.Cartesian3.multiplyByScalar(j,U*-1,j);Freedo.Cartesian3.add(i,j,i)}else{U=0}var d=Freedo.Cartographic.fromCartesian(i);var c=r.scene.globe.getHeight(d);if(c>d.height){d.height=c}d.height+=e.firstPersonControlEyeHeight;e.cameraHeightValid=true;i=Freedo.Cartesian3.fromRadians(d.longitude,d.latitude,d.height);r.camera.flyTo({destination:i,orientation:{direction:s,up:a},duration:3,complete:function e(){D.AdjustMode=true;f.camera.changed.raiseEvent(1)}})}e.setInputAction(function(e){if(D._initialized&&D.firstPersonControlFlags.enabled){p(D,e);return}if(D._initialized||!D.firstPersonControlFlags.enabled)return;var t=D._viewer;var r=t.scene.pickPosition(e.position);if(!Freedo.defined(r)){var i=t.camera.getPickRay(e.position);r=f.globe.pick(i,f)}if(!Freedo.defined(r))return;var n=t.camera.heading;var a=h(r,0);if(!D.addedModel&&l&&l.length>0){D.addedModel=t.scene.primitives.add(Freedo.Model.fromGltf({url:l,allowPicking:false}));D.addedModel.readyPromise.then(function(e){e.activeAnimations.addAll({loop:Freedo.ModelAnimationLoop.NONE})}).otherwise(function(e){D.addedModel=undefined;U=0})}if(D.addedModel){D.addedModel.show=true;D.addedModel.modelMatrix=a;j=L.geodeticSurfaceNormal(r,j);Freedo.Cartesian3.cross(j,t.camera.right,j);Freedo.Cartesian3.multiplyByScalar(j,U*-1,j);Freedo.Cartesian3.add(r,j,r)}else{U=0}var o=Freedo.Cartographic.fromCartesian(r);var s=t.scene.globe.getHeight(o);if(s>o.height){o.height=s}o.height+=D.firstPersonControlEyeHeight;D.cameraHeightValid=true;r=Freedo.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);G(r);t.camera.setView({destination:r,orientation:{heading:n,pitch:0,roll:0}});D.firstPersonControlFlags.enabled=true;D._initialized=true},Freedo.ScreenSpaceEventType.LEFT_CLICK);document.addEventListener("keydown",function(e){if(!D._initialized||!D.firstPersonControlFlags.enabled||D.firstPersonControlFlags.doingAnimation)return;var t=D.getFlagForKeyCode(e.keyCode);if(typeof t!=="undefined"){D.firstPersonControlFlags[t]=true;V=true;if(!Freedo.defined(D.keyDownTime)){D.keyDownTime=Freedo.JulianDate.now(D.keyDownTime)}}},false);document.addEventListener("keyup",function(e){if(!D._initialized||!D.firstPersonControlFlags.enabled||D.firstPersonControlFlags.doingAnimation)return;var t=D.getFlagForKeyCode(e.keyCode);if(typeof t!=="undefined"){D.firstPersonControlFlags[t]=false;D.firstPersonControlStartTime=undefined;D.keyDownTime=undefined}},false);function G(e){if(D.addedModel){var t=Freedo.Cartographic.fromCartesian(e);var r=Freedo.Cartesian3.fromRadians(t.longitude,t.latitude,t.height-D.firstPersonControlEyeHeight);var i=h(r,1);D.addedModel.modelMatrix=i}}o.clock.onTick.addEventListener(function(e){if(!D._initialized||!D.firstPersonControlFlags.enabled)return;H=Freedo.JulianDate.now(H);var t=D._viewer;var r=t.camera;if(D.firstPersonControlFlags.doingAnimation){V=false;D.doing_animating(H);return}if(D.firstPersonControlFlags.moveSpace){var i=Freedo.Cartographic.fromCartesian(r.position);D.firstPersonControlFlags.doingAnimation=true;D.firstPersonControlStartPosition=i;D.firstPersonControlEndPosition=i;D.firstPersonControlStartTime=Freedo.JulianDate.clone(H);D.firstPersonControlSpeed=4.427188724235731;D.firstPersonControlFlags.moveSpace=false;if(D.firstPersonControlFlags.moveForward){D.firstPersonControlFlags.mode=0}else if(D.firstPersonControlFlags.moveBackward){D.firstPersonControlFlags.mode=1}else if(D.firstPersonControlFlags.moveLeft){D.firstPersonControlFlags.mode=2}else if(D.firstPersonControlFlags.moveRight){D.firstPersonControlFlags.mode=3}return}if(D.firstPersonControlFlags.directionUp||D.firstPersonControlFlags.directionDown){D.CameraDirectionUpDown();return}if(D.firstPersonControlFlags.directionLeft||D.firstPersonControlFlags.directionRight){D.CameraDirectionLeftRight();return}var n=0;if(D.firstPersonControlStartTime!==undefined){n=Freedo.JulianDate.secondsDifference(H,D.firstPersonControlStartTime)}D.firstPersonControlStartTime=Freedo.JulianDate.clone(H);if(n==0)return;var a=0;var o=D.moveSpeed;if(Freedo.defined(D.keyDownTime)){var s=Freedo.JulianDate.secondsDifference(H,D.keyDownTime);if(s<2){a=o*n}else{if(s<4){o=D.moveSpeed+D.acceleration*(s-2);a=o*n+.5*D.acceleration*n*n}else{a=D.maxMoveSpeed*n}}}var l=Freedo.clone(r.direction,true);var u=Freedo.clone(r.up,true);var d=Freedo.clone(r.right,true);var c=Freedo.clone(r.position,true);var f;var h=function e(){Freedo.Cartesian3.clone(l,j);Freedo.Cartesian3.multiplyByScalar(j,-U,j);Freedo.Cartesian3.add(c,j,c);G(c);t.camera.setView({destination:c,orientation:{direction:l,up:u}})};if(D.firstPersonControlFlags.moveUp||D.firstPersonControlFlags.moveDown){if(D.firstPersonControlFlags.moveUp){f=D.movePosition(c,u,a)}else if(D.firstPersonControlFlags.moveDown){f=D.movePosition(c,u,-a)}G(f);t.camera.setView({destination:f,orientation:{direction:l,up:u}});return}if(D.firstPersonControlFlags.moveForward){f=D.movePosition(c,l,a)}else if(D.firstPersonControlFlags.moveBackward){f=D.movePosition(c,l,-a)}if(D.firstPersonControlFlags.moveLeft){f=D.movePosition(c,d,-a/2)}else if(D.firstPersonControlFlags.moveRight){f=D.movePosition(c,d,a/2)}if(!Freedo.defined(f)){return}Freedo.Cartesian3.clone(l,j);Freedo.Cartesian3.multiplyByScalar(j,U,j);Freedo.Cartesian3.add(f,j,f);Freedo.Cartesian3.add(c,j,c);N=L.geodeticSurfaceNormal(f,N);var p=Freedo.Cartographic.fromCartesian(f);var v=Freedo.Cartographic.fromCartesian(c);var m=v.height+k;var _=Freedo.Cartesian3.fromRadians(p.longitude,p.latitude,m);Freedo.Cartesian3.negate(N,N);I.origin=_;I.direction=N;var y=Freedo.Cartesian3.fromRadians(v.longitude,v.latitude,m);var g;if(D.firstPersonControlFlags.moveForward||D.firstPersonControlFlags.moveBackward||D.firstPersonControlFlags.moveLeft||D.firstPersonControlFlags.moveRight){var w=D.firstPersonControlFlags.moveForward||D.firstPersonControlFlags.moveBackward;var F=D.firstPersonControlFlags.moveLeft||D.firstPersonControlFlags.moveRight;C=.5;b=.6;var b,C;if(w&&!F){O.origin=Freedo.Cartesian3.add(y,Freedo.Cartesian3.multiplyByScalar(d,-C/2,B),O.origin);O.direction=d;R.origin=y;if(D.firstPersonControlFlags.moveForward){R.direction=l}else if(D.firstPersonControlFlags.moveBackward){Freedo.Cartesian3.negate(l,R.direction)}}else if(!w&&F){R.origin=Freedo.Cartesian3.add(y,Freedo.Cartesian3.multiplyByScalar(l,-b/2,B),R.origin);R.direction=l;O.origin=y;if(D.firstPersonControlFlags.moveRight){O.direction=d}else if(D.firstPersonControlFlags.moveLeft){Freedo.Cartesian3.negate(d,O.direction)}}else if(w&&F){O.origin=c;R.origin=c;if(D.firstPersonControlFlags.moveForward){R.direction=l}else if(D.firstPersonControlFlags.moveBackward){Freedo.Cartesian3.negate(l,R.direction)}if(D.firstPersonControlFlags.moveRight){O.direction=d}else if(D.firstPersonControlFlags.moveLeft){Freedo.Cartesian3.negate(d,O.direction)}}var x=D.getRayIntersection(R);var P=Freedo.defined(x);if(P){var M=x;P=Freedo.defined(M)&&Freedo.Cartesian3.distanceSquared(M,y)<b*b}if(P){h();return}var T=D.getRayIntersection(O);var E=Freedo.defined(T);if(E){var M=T;E=Freedo.defined(M)&&Freedo.Cartesian3.distanceSquared(O.origin,M)<C*C}if(E){h();return}var S=D.getRayIntersection(I);if(Freedo.defined(S)){g=S;var p=Freedo.Cartographic.fromCartesian(g,undefined,z);if(Math.abs(p.height-r.positionCartographic.height)>100){g=Freedo.Cartesian3.fromRadians(p.longitude,p.latitude,v.height,undefined,g)}}}if(!Freedo.defined(g)){h();return}Freedo.Cartesian3.negate(j,j);Freedo.Cartesian3.add(g,j,g);var i=Freedo.Cartographic.fromCartesian(g);i.height+=D.firstPersonControlEyeHeight;if(D.cameraHeightValid&&i.height-v.height>k){h();return}D.cameraHeightValid=true;if(i.height-v.height>-.5){var A=Freedo.Cartesian3.fromRadians(i.longitude,i.latitude,i.height);G(A);t.camera.setView({destination:A,orientation:{direction:l,up:u}})}else{var A=Freedo.Cartesian3.fromRadians(i.longitude,i.latitude,v.height);G(A);t.camera.setView({destination:A,orientation:{direction:l,up:u}});D.firstPersonControlFlags.doingAnimation=true;if(!Freedo.defined(D.firstPersonControlStartPosition)){D.firstPersonControlStartPosition=new Freedo.Cartographic}D.firstPersonControlStartPosition.longitude=i.longitude;D.firstPersonControlStartPosition.latitude=i.latitude;D.firstPersonControlStartPosition.height=v.height;D.firstPersonControlEndPosition=i;D.firstPersonControlSpeed=0;D.cameraHeightValid=false;D.resetFlags()}})}(0,o.default)(t,[{key:"setMaxSpeed",value:function e(t){if(t>this.moveSpeed){this.maxMoveSpeed=t;this.acceleration=(this.maxMoveSpeed-this.moveSpeed)/2}}},{key:"getFlagForKeyCode",value:function e(t){switch(t){case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):return"moveBackward";case"D".charCodeAt(0):return"moveRight";case"A".charCodeAt(0):return"moveLeft";case" ".charCodeAt(0):return"moveSpace";case 40:return"directionUp";case 38:return"directionDown";case 39:return"directionLeft";case 37:return"directionRight";case 69:return"directionLeft";case 81:return"directionRight";default:return undefined}}},{key:"movePosition",value:function e(t,r,i){Freedo.Cartesian3.multiplyByScalar(r,i,_);Freedo.Cartesian3.add(t,_,_);return _}},{key:"getRayIntersection",value:function e(t,r){var i=false;if(this.addedModel&&this.addedModel.show){i=this.addedModel.show;this.addedModel.show=false}var n=this._viewer.scene;var a=n.pickPositionFromRay(t,r);if(this.addedModel&&i){this.addedModel.show=true}return a}},{key:"doing_animating",value:function e(t){var f=this._viewer;var r=f.camera;var i=Freedo.clone(r.direction,true);var n=Freedo.clone(r.up,true);var a=Freedo.clone(r.right,true);var o=Freedo.JulianDate.secondsDifference(t,this.firstPersonControlStartTime);if(o==0)return;var s=.5*9.8*o*o-this.firstPersonControlSpeed*o;if(s>=this.firstPersonControlStartPosition.height-this.firstPersonControlEndPosition.height){this.firstPersonControlFlags.doingAnimation=false;s=this.firstPersonControlStartPosition.height-this.firstPersonControlEndPosition.height;this.firstPersonControlStartTime=undefined;this.resetFlags()}var l=.35;if(Freedo.defined(this.firstPersonControlFlags.mode)){var u=function e(t,r){var i=f.scene.globe.ellipsoid;y=Freedo.Cartesian3.fromRadians(h.longitude,h.latitude,h.height);var n=Freedo.clone(y,true);Freedo.Cartesian3.multiplyByScalar(t,r,_);Freedo.Cartesian3.add(y,_,y);Freedo.Cartesian3.clone(t,j);Freedo.Cartesian3.multiplyByScalar(j,U,j);Freedo.Cartesian3.add(y,j,y);Freedo.Cartesian3.add(n,j,n);var a=Freedo.Cartographic.fromCartesian(y);h=Freedo.Cartographic.fromCartesian(n);var o=i.geodeticSurfaceNormal(y);g.origin=y;g.direction=o;var s=1;var l=p.getRayIntersection(g);if(Freedo.defined(l)){var u=Freedo.Cartographic.fromCartesian(l);var d=u-h.height;if(d>0&&d<1){s=d}}g.origin=Freedo.Cartesian3.fromRadians(a.longitude,a.latitude,a.height+s);g.direction=Freedo.Cartesian3.negate(o,o);var c=p.getRayIntersection(g);g.origin=Freedo.Cartesian3.fromRadians(h.longitude,h.latitude,h.height+s);g.direction=t;l=p.getRayIntersection(g);if(Freedo.defined(l)){var u=Freedo.Cartographic.fromCartesian(l);if(Freedo.Cartesian3.distanceSquared(l,g.origin)<=r*r){return}}if(Freedo.defined(c)){var u=Freedo.Cartographic.fromCartesian(c);p.firstPersonControlEndPosition.height=u.height+p.firstPersonControlEyeHeight;y=Freedo.Cartesian3.fromRadians(a.longitude,a.latitude,p.firstPersonControlEndPosition.height)}Freedo.Cartesian3.negate(j,j);Freedo.Cartesian3.add(y,j,y);p.firstPersonControlStartPosition=Freedo.Cartographic.fromCartesian(y);p.cameraHeightValid=false};var h=Freedo.clone(this.firstPersonControlStartPosition,true);var p=this;if(this.firstPersonControlFlags.mode===0){u(i,l)}else if(this.firstPersonControlFlags.mode===1){u(i,-l)}else if(this.firstPersonControlFlags.mode===2){u(a,-l)}else if(this.firstPersonControlFlags.mode===3){u(a,l)}this.firstPersonControlFlags.mode=undefined}var d=Freedo.Cartesian3.fromRadians(this.firstPersonControlStartPosition.longitude,this.firstPersonControlStartPosition.latitude,this.firstPersonControlStartPosition.height-s);if(this.addedModel){var c=Freedo.Cartographic.fromCartesian(d);var v=Freedo.Cartesian3.fromRadians(c.longitude,c.latitude,c.height-this.firstPersonControlEyeHeight);var m=this.calcCameraPosition(v,1);this.addedModel.modelMatrix=m}f.camera.setView({destination:d,orientation:{direction:i,up:n}})}},{key:"CameraDirectionUpDown",value:function e(){var t=this._viewer;var r=t.camera.position;var i=t.camera.heading;var n=t.camera.pitch;var a=t.camera.roll;if(this.firstPersonControlFlags.directionUp){n-=Freedo.Math.RADIANS_PER_DEGREE*this.rotateSpeed*.5}else{n+=Freedo.Math.RADIANS_PER_DEGREE*this.rotateSpeed*.5}this.AdjustMode=true;t.camera.setView({destination:r,orientation:{heading:i,pitch:n,roll:a}})}},{key:"CameraDirectionLeftRight",value:function e(){var t=this._viewer;var r=t.camera.position;var i=t.camera.heading;var n=t.camera.pitch;var a=t.camera.roll;if(this.firstPersonControlFlags.directionLeft){i+=Freedo.Math.RADIANS_PER_DEGREE*this.rotateSpeed}else{i-=Freedo.Math.RADIANS_PER_DEGREE*this.rotateSpeed}this.AdjustMode=true;t.camera.setView({destination:r,orientation:{heading:i,pitch:n,roll:a}})}},{key:"resetFlags",value:function e(){this.firstPersonControlFlags["moveForward"]=false;this.firstPersonControlFlags["moveBackward"]=false;this.firstPersonControlFlags["moveUp"]=false;this.firstPersonControlFlags["moveDown"]=false;this.firstPersonControlFlags["moveRight"]=false;this.firstPersonControlFlags["moveLeft"]=false;this.firstPersonControlFlags["moveSpace"]=false;this.firstPersonControlFlags["directionUp"]=false;this.firstPersonControlFlags["directionDown"]=false;this.firstPersonControlFlags["directionLeft"]=false;this.firstPersonControlFlags["directionRight"]=false}},{key:"enabled",set:function e(t){var r=this._viewer;var i=this._myScreenSpaceEventHandler;var n=r.scene;if(this.firstPersonControlFlags.enabled===true&&t===false){if(this.addedModel){this.addedModel.show=false}if(Freedo.defined(this.leftBtnDownEvent))i.setInputAction(this.leftBtnDownEvent,Freedo.ScreenSpaceEventType.LEFT_DOWN);if(Freedo.defined(this.leftBtnUpEvent))i.setInputAction(this.leftBtnUpEvent,Freedo.ScreenSpaceEventType.LEFT_UP);if(Freedo.defined(this.wheelEvent))i.setInputAction(this.wheelEvent,Freedo.ScreenSpaceEventType.WHEEL);if(Freedo.defined(this.sceneCameraInputs))n.screenSpaceCameraController.enableInputs=this.sceneCameraInputs;if(Freedo.defined(this.sceneCameraRotate))n.screenSpaceCameraController.enableRotate=this.sceneCameraRotate;if(Freedo.defined(this.sceneCameraTranslate))n.screenSpaceCameraController.enableTranslate=this.sceneCameraTranslate;if(Freedo.defined(this.sceneCameraZoom))n.screenSpaceCameraController.enableZoom=this.sceneCameraZoom;if(Freedo.defined(this.sceneCameraTilt))n.screenSpaceCameraController.enableTilt=this.sceneCameraTilt;if(Freedo.defined(this.sceneCameraLook))n.screenSpaceCameraController.enableLook=this.sceneCameraLook;this._initialized=false}else if(this.firstPersonControlFlags.enabled===false&&t===true){this.leftBtnDownEvent=i.getInputAction(Freedo.ScreenSpaceEventType.LEFT_DOWN);this.leftBtnUpEvent=i.getInputAction(Freedo.ScreenSpaceEventType.LEFT_UP);this.wheelEvent=i.getInputAction(Freedo.ScreenSpaceEventType.WHEEL);this.sceneCameraInputs=n.screenSpaceCameraController.enableInputs;this.sceneCameraRotate=n.screenSpaceCameraController.enableRotate;this.sceneCameraTranslate=n.screenSpaceCameraController.enableTranslate;this.sceneCameraZoom=n.screenSpaceCameraController.enableZoom;this.sceneCameraTilt=n.screenSpaceCameraController.enableTilt;this.sceneCameraLook=n.screenSpaceCameraController.enableLook;n.screenSpaceCameraController.enableInputs=false;n.screenSpaceCameraController.enableRotate=false;n.screenSpaceCameraController.enableTranslate=false;n.screenSpaceCameraController.enableZoom=false;n.screenSpaceCameraController.enableTilt=false;n.screenSpaceCameraController.enableLook=false}this.firstPersonControlFlags.enabled=t;if(t){var a=this._viewer.container;a.onclick=function(e){a.setAttribute("tabindex",1);a.focus()}}else{var a=this._viewer.container;a.onclick=undefined}},get:function e(){return this.firstPersonControlFlags.enabled}}]);return t}();t.FdFirstPersonControl=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdProcessDiff=undefined;var i=r(96);var a=h(i);var n=r(49);var o=h(n);var s=r(35);var l=h(s);var u=r(1);var d=h(u);var c=r(2);var f=h(c);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function n(e,t,r){var i=this;(0,d.default)(this,n);this._viewer=e;this._schedule=t;this._colors=new l.default;this._colors.set(n.ProcessState.NoPlan,t.prop.colors.noPlan);this._colors.set(n.ProcessState.Finish,t.prop.colors.finish);this._colors.set(n.ProcessState.DelayFinish,t.prop.colors.delayFinish);this._colors.set(n.ProcessState.Prefinish,t.prop.colors.preFinish);this._colors.set(n.ProcessState.Unfinish,t.prop.colors.unFinish);this._colors.set(n.ProcessState.Unstart,t.prop.colors.unStart);this._tasks=t.tasks;this._PModelSet=[];this._features=new l.default;this._time="";this._ready=false;this.readyPromise=this.loadModel(r).then(function(e){i.update();return i})}(0,f.default)(n,[{key:"getUid",value:function e(t){var r=void 0;if(t.hasProperty("component")){r=t.getProperty("component");var i=r.split("@");var n=parseInt(i[1])-1;r=i[0]+"@"+n}return r}},{key:"loadModel",value:function e(i){var n=this;return new o.default(function(t,e){n._PModelSet.forEach(function(e){return n._viewer.scene.primitives.remove(e)});if(typeof i==="string"){n._PModelSet.push(new Freedo.FreedoPModelset({url:i}))}else if(i instanceof Freedo.FreedoPModelset){n._PModelSet.push(i)}else if(Array.isArray(i)){i.forEach(function(e){if(typeof e==="string"){n._PModelSet.push(new Freedo.FreedoPModelset({url:e}))}else if(e instanceof Freedo.FreedoPModelset){n._PModelSet.push(e)}})}else{throw new Error("model参数异常！")}n._PModelSet.forEach(function(e){if(!n._viewer.scene.primitives.contains(e)){n._viewer.scene.primitives.add(e)}});n._ready=!n._PModelSet.find(function(e){return!e.ready});if(n.ready){t(n)}else{var r=n._PModelSet.filter(function(e){return!e.ready}).map(function(e){return e.readyPromise});Freedo.when.all(r).then(function(e){n._ready=true;t(n)},e).otherwise(function(e){return console.error(e)})}})}},{key:"update",value:function e(){var t=this._time;var r=void 0;if(!t){r=this._tasks}else{r=this._tasks.filter(function(e){return t>e.planStart})}this.updateStyle(r);this._viewer.scene.requestRender()}},{key:"updateStyle",value:function e(n){var a=this;var t=new Freedo.FreedoPModelStyle({show:{evaluate:function e(t){var r=a.getUid(t);return!!n.find(function(e){return e.uid.indexOf(r)>-1})}},color:{evaluateColor:function e(t){var r=a.getUid(t);var i=n.find(function(e){return e.uid.indexOf(r)>-1});return a.getColor(i)}}});this._PModelSet.forEach(function(e){return e.style=t})}},{key:"getTaskState",value:function e(t){if(t.planStart==t.realStart&&t.planEnd==t.realEnd&&t.realEnd){return n.ProcessState.Finish}else if(!t.realStart&&t.planStart){return n.ProcessState.Unstart}else if(t.realEnd&&t.planEnd>t.realEnd){return n.ProcessState.Prefinish}else if(t.planEnd<t.realEnd){return n.ProcessState.DelayFinish}else if(t.realStart&&!t.realEnd){return n.ProcessState.Unfinish}else{return n.ProcessState.NoPlan}}},{key:"getColor",value:function e(t){var r;if(!t)return Freedo.Color.WHITE;var i=this.getTaskState(t);var n=this._colors.get(i);return(r=Freedo.Color).fromBytes.apply(r,(0,a.default)(n))}},{key:"reset",value:function e(){this.time=""}},{key:"dispose",value:function e(){var t=this;this._PModelSet.forEach(function(e){return t._viewer.scene.primitives.remove(e)})}},{key:"ready",get:function e(){return this._ready}},{key:"time",set:function e(t){this._time=t;this.update()}},{key:"showTasks",set:function e(t){if(!Array.isArray(t)){t=[t]}this.updateStyle(t);this._viewer.scene.requestRender()}}]);return n}();p.ProcessState={Unstart:0,Prefinish:1,Finish:2,DelayFinish:3,Unfinish:4};t.FdProcessDiff=p},function(e,t,r){r(119);r(70);r(79);r(573);r(577);r(578);e.exports=r(13).Promise},function(e,t,r){"use strict";var i=r(90);var o=r(20);var n=r(53);var a=r(116);var s=r(17);var l=r(42);var u=r(91);var d=r(162);var c=r(95);var f=r(242);var h=r(243).set;var p=r(575)();var v=r(173);var m=r(244);var _=r(576);var y=r(245);var g="Promise";var w=o.TypeError;var F=o.process;var b=F&&F.versions;var C=b&&b.v8||"";var x=o[g];var P=a(F)=="process";var M=function(){};var T,E,S,A;var k=E=v.f;var L=!!function(){try{var e=x.resolve(1);var t=(e.constructor={})[r(21)("species")]=function(e){e(M,M)};return(P||typeof PromiseRejectionEvent=="function")&&e.then(M)instanceof t&&C.indexOf("6.6")!==0&&_.indexOf("Chrome/66")===-1}catch(e){}}();var D=function(e){var t;return l(e)&&typeof(t=e.then)=="function"?t:false};var I=function(d,r){if(d._n)return;d._n=true;var i=d._c;p(function(){var l=d._v;var u=d._s==1;var e=0;var t=function(e){var t=u?e.ok:e.fail;var r=e.resolve;var i=e.reject;var n=e.domain;var a,o,s;try{if(t){if(!u){if(d._h==2)N(d);d._h=1}if(t===true)a=l;else{if(n)n.enter();a=t(l);if(n){n.exit();s=true}}if(a===e.promise){i(w("Promise-chain cycle"))}else if(o=D(a)){o.call(a,r,i)}else r(a)}else i(l)}catch(e){if(n&&!s)n.exit();i(e)}};while(i.length>e)t(i[e++]);d._c=[];d._n=false;if(r&&!d._h)R(d)})};var R=function(a){h.call(o,function(){var e=a._v;var t=O(a);var r,i,n;if(t){r=m(function(){if(P){F.emit("unhandledRejection",e,a)}else if(i=o.onunhandledrejection){i({promise:a,reason:e})}else if((n=o.console)&&n.error){n.error("Unhandled promise rejection",e)}});a._h=P||O(a)?2:1}a._a=undefined;if(t&&r.e)throw r.v})};var O=function(e){return e._h!==1&&(e._a||e._c).length===0};var N=function(t){h.call(o,function(){var e;if(P){F.emit("rejectionHandled",t)}else if(e=o.onrejectionhandled){e({promise:t,reason:t._v})}})};var B=function(e){var t=this;if(t._d)return;t._d=true;t=t._w||t;t._v=e;t._s=2;if(!t._a)t._a=t._c.slice();I(t,true)};var H=function(e){var r=this;var i;if(r._d)return;r._d=true;r=r._w||r;try{if(r===e)throw w("Promise can't be resolved itself");if(i=D(e)){p(function(){var t={_w:r,_d:false};try{i.call(e,n(H,t,1),n(B,t,1))}catch(e){B.call(t,e)}})}else{r._v=e;r._s=1;I(r,false)}}catch(e){B.call({_w:r,_d:false},e)}};if(!L){x=function e(t){d(this,x,g,"_h");u(t);T.call(this);try{t(n(H,this,1),n(B,this,1))}catch(e){B.call(this,e)}};T=function e(t){this._c=[];this._a=undefined;this._s=0;this._d=false;this._v=undefined;this._h=0;this._n=false};T.prototype=r(161)(x.prototype,{then:function e(t,r){var i=k(f(this,x));i.ok=typeof t=="function"?t:true;i.fail=typeof r=="function"&&r;i.domain=P?F.domain:undefined;this._c.push(i);if(this._a)this._a.push(i);if(this._s)I(this,false);return i.promise},catch:function(e){return this.then(undefined,e)}});S=function(){var e=new T;this.promise=e;this.resolve=n(H,e,1);this.reject=n(B,e,1)};v.f=k=function(e){return e===x||e===A?new S(e):E(e)}}s(s.G+s.W+s.F*!L,{Promise:x});r(93)(x,g);r(225)(g);A=r(13)[g];s(s.S+s.F*!L,g,{reject:function e(t){var r=k(this);var i=r.reject;i(t);return r.promise}});s(s.S+s.F*(i||!L),g,{resolve:function e(t){return y(i&&this===A?x:this,t)}});s(s.S+s.F*!(L&&r(233)(function(e){x.all(e)["catch"](M)})),g,{all:function e(t){var o=this;var r=k(o);var s=r.resolve;var l=r.reject;var i=m(function(){var i=[];var n=0;var a=1;c(t,false,function(e){var t=n++;var r=false;i.push(undefined);a++;o.resolve(e).then(function(e){if(r)return;r=true;i[t]=e;--a||s(i)},l)});--a||s(i)});if(i.e)l(i.v);return r.promise},race:function e(t){var r=this;var i=k(r);var n=i.reject;var a=m(function(){c(t,false,function(e){r.resolve(e).then(i.resolve,n)})});if(a.e)n(a.v);return i.promise}})},function(e,t){e.exports=function(e,t,r){var i=r===undefined;switch(t.length){case 0:return i?e():e.call(r);case 1:return i?e(t[0]):e.call(r,t[0]);case 2:return i?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var s=r(20);var l=r(243).set;var u=s.MutationObserver||s.WebKitMutationObserver;var d=s.process;var c=s.Promise;var f=r(89)(d)=="process";e.exports=function(){var r,i,n;var e=function(){var e,t;if(f&&(e=d.domain))e.exit();while(r){t=r.fn;r=r.next;try{t()}catch(e){if(r)n();else i=undefined;throw e}}i=undefined;if(e)e.enter()};if(f){n=function(){d.nextTick(e)}}else if(u&&!(s.navigator&&s.navigator.standalone)){var t=true;var a=document.createTextNode("");new u(e).observe(a,{characterData:true});n=function(){a.data=t=!t}}else if(c&&c.resolve){var o=c.resolve(undefined);n=function(){o.then(e)}}else{n=function(){l.call(s,e)}}return function(e){var t={fn:e,next:undefined};if(i)i.next=t;if(!r){r=t;n()}i=t}}},function(e,t,r){var i=r(20);var n=i.navigator;e.exports=n&&n.userAgent||""},function(e,t,r){"use strict";var i=r(17);var n=r(13);var a=r(20);var o=r(242);var s=r(245);i(i.P+i.R,"Promise",{finally:function(t){var r=o(this,n.Promise||a.Promise);var e=typeof t=="function";return this.then(e?function(e){return s(r,t()).then(function(){return e})}:t,e?function(e){return s(r,t()).then(function(){throw e})}:t)}})},function(e,t,r){"use strict";var i=r(17);var n=r(173);var a=r(244);i(i.S,"Promise",{try:function(e){var t=n.f(this);var r=a(e);(r.e?t.reject:t.resolve)(r.v);return t.promise}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdBuildingUtil=undefined;var i=r(172);var S=d(i);var n=r(35);var a=d(n);var o=r(1);var s=d(o);var l=r(3);var A=d(l);var u=r(247);function d(e){return e&&e.__esModule?e:{default:e}}var p="elementType";var v="floor_";var H=new Freedo.BoundingSphere;function c(e,t,r,i,n){for(var a in e){var o=e[a];if(o.name==="tileset.json"){var s=r.replace("{matrix}",t).replace("{filepath}",o.path);i.push(s)}else if(o.name.endsWith(".xml")){var l=r.replace("{matrix}",t).replace("{filepath}",o.path);n.push(l)}if(o.cnodes){c(o.cnodes,t,r,i,n)}}}function m(e,t){var r=e;var i=r;if(Array.isArray(i)){var n=true;var a=false;var o=undefined;try{for(var s=(0,A.default)(i),l;!(n=(l=s.next()).done);n=true){var u=l.value;m(u,t)}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}else{if(!r["Node"]){var d=e["@uid"];if(!d){d=e["uid"]}t.push(d);return}m(i["Node"],t)}}function h(e,t,r){var i=e;if(Array.isArray(i)){var n=true;var a=false;var o=undefined;try{for(var s=(0,A.default)(i),l;!(n=(l=s.next()).done);n=true){var u=l.value;var d=u["@"+p];if(d===t){r.push(u["@uid"]?u["@uid"]:u["uid"])}else{var c=u["childVal"]?u["childVal"]:u["Node"];if(c){h(c,t,r)}}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}else{var d=i["@"+p];if(d===t){r.push(i["@uid"]?i["@uid"]:i["uid"])}var c=i["childVal"]?i["childVal"]:i["Node"];if(c){h(c,t,r)}}}function _(e,t,r,i){var n=e;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,A.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=d["@uid"]?d["@uid"]:d["uid"];var f=d["childVal"]?d["childVal"]:d["Node"];if(c===t){if(f){h(f,r,i)}}else{if(f){_(f,t,r,i)}}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}}else{var c=n["@uid"]?n["@uid"]:n["uid"];var f=n["childVal"]?n["childVal"]:n["Node"];if(c===t){if(f){h(f,r,i)}}else{if(f){_(f,t,r,i)}}}}function y(e,t,r){var i=e;if(Array.isArray(i)){var n=true;var a=false;var o=undefined;try{for(var s=(0,A.default)(i),l;!(n=(l=s.next()).done);n=true){var u=l.value;var d=u["@uid"]?u["@uid"]:u["uid"];if(t.indexOf(d)!==-1){m(i,r);return true}var c=u["childVal"]?u["childVal"]:u["Node"];if(c){var f=y(c,t,r);if(f){return true}}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}return false}else{var d=e["@uid"]?i["@uid"]:i["uid"];if(t.indexOf(d)!==-1){m(i,r);return true}var c=i["childVal"]?i["childVal"]:i["Node"];if(c){var f=y(c,t,r);return true}return false}}function g(e,t,r){var i=v+t;var n=e;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,A.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=d["@uid"]?d["@uid"]:d["uid"];if(c.startsWith(i)){m(n,r);return true}var f=d["childVal"]?d["childVal"]:d["Node"];if(f){var h=g(f,t,r);if(h){return true}}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}return false}else{var c=e["@uid"]?e["@uid"]:e["uid"];if(c.startsWith(i)){m(n,r);return true}var f=n["childVal"]?n["childVal"]:n["Node"];if(f){var h=g(f,t,r);return true}return false}}function k(e,t,r,i){var n=e;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,A.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=d["@uid"]?d["@uid"]:d["uid"];if(c===t){var f=[];var h=d["childVal"]?d["childVal"]:d["Node"];if(h){m(h,f)}return{bbmin:d["@BoundsMin"],bbmax:d["@BoundsMax"],components:f}}var h=d["childVal"]?d["childVal"]:d["Node"];if(h){var p=k(h,t,r,i);if(p){return p}}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}return undefined}else{var c=e["@uid"]?n["@uid"]:n["uid"];if(c===t){var f=[];var h=n["childVal"]?n["childVal"]:n["Node"];if(h){m(h,f)}return{bbmin:e["@BoundsMin"],bbmax:e["@BoundsMax"],components:f}}var h=n["childVal"]?n["childVal"]:n["Node"];if(h){var p=k(h,t,r,i);return p}return undefined}}function V(e,t,r,i){var n=e;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,A.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=d["@uid"]?d["@uid"]:d["uid"];if(c===t){return{bbmin:d["@BoundsMin"],bbmax:d["@BoundsMax"]}}var f=d["childVal"]?d["childVal"]:d["Node"];if(f){var h=V(f,t,r,i);if(h){return h}}}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}return undefined}else{var c=e["@uid"]?n["@uid"]:n["uid"];if(c===t){return{bbmin:e["@BoundsMin"],bbmax:e["@BoundsMax"]}}var f=n["childVal"]?n["childVal"]:n["Node"];if(f){var h=V(f,t,r,i);return h}return undefined}}function w(e,u){var t=new Freedo.Resource(e);t.fetchText().then(function(e){u.treeRootLength--;var t=$.xml2json(e);var r=t["Node"];if(Array.isArray(r)){for(var i=0;i<r.length;i++){var n=r[i];var a={title:n["@name"],uid:n["@uid"],name:n["@name"],BoundsMin:n["@BoundsMin"],BoundsMax:n["@BoundsMax"],elementType:n["@"+p],child:[],childVal:n["Node"]};u.modelTree.addRootTree=a}}else{var o={title:r["@name"],uid:r["@uid"],name:r["@name"],BoundsMin:r["@BoundsMin"],BoundsMax:r["@BoundsMax"],elementType:r["@"+p],child:[],childVal:r["Node"]};u.modelTree.addRootTree=o}if(u.treeRootLength===0){var s=u.modelTree.createTree({onNodeClick:u.nodeClick.bind(u),onNodeExpand:u.nodeExpand.bind(u),onNodeSelected:u.nodeSelected.bind(u)});var l=u.treeDiv;if(!!window.ActiveXObject||"ActiveXObject"in window){l.appendChild(s)}else{l.append(s)}}}).otherwise(function(e){u.treeRootLength--})}var f={Unknown:0,Room:1,EntranceGuard:2,Camera:3,Monitor:4};var F=function e(){(0,s.default)(this,e);this._boundingSphere=undefined;this.treeRootLength=0;this.modelTree=new u.Tree;this.treeDiv=undefined;this.loadedGLTFs=[];this.lastHighlightedComponents=[];this.highlightColor=new Freedo.Cartesian3(1,1,0);this.lastClickedItemName="";this.labelManager=undefined;this.labelEntities=[];this.trackLineEntities=[];this.heatmapEntities=new a.default;this.labelUniqueIdCounter=9e7;this.trackLineUniqueIdCounter=91e6;this.heatmapUniqueIdCounter=92e6;this.nodePassMap=new a.default;this.videoObjectsMap=new a.default};F.prototype.init=function(e,t){this.divElement=e;var h=Freedo.FdApp.createDefaultViewer(e,{},{});h.scene.requestRenderMode=false;this._viewer=h;this.labelManager=new Freedo.FdModel.FdModelManager(h);var r=new Freedo.Resource(t);var p=this;p.modelMatrix=Freedo.Transforms.eastNorthUpToFixedFrame(Freedo.Cartesian3.fromDegrees(116,40,20));function s(e,c){var f=new Freedo.Resource(e);f.fetchJson().then(function(e){var t=e;var r=t.root;p.ready=true;var i;if(typeof r.transform!=="undefined"){i=Freedo.Matrix4.fromArray(r.transform)}var n=r.children.length;var a=0;for(var o=0;o<n;o++){var s=r.children[o].content.url;var l=s.substring(5);l=l.substr(0,l.length-4);var u=f.getDerivedResource({url:s});var d=h.scene.primitives.add(Freedo.Model.fromGltf({url:u.url,opaquePass:Freedo.Pass.CESIUM_3D_TILE,id:{name:l},forwardAxis:Freedo.Axis.Y}));if(Freedo.defined(i)){p.modelMatrix=i}d.modelMatrix=p.modelMatrix;d.needHighlightComponentOfGltf=true;p.loadedGLTFs.push(d);d.readyPromise.then(function(e){a++;if(a===n&&p.treeDiv!=undefined){w(c,p)}var t=Freedo.BoundingSphere.transform(e.boundingSphere,e._computedModelMatrix,t);if(!p._boundingSphere){p._boundingSphere=Freedo.BoundingSphere.clone(t)}else{Freedo.BoundingSphere.union(p._boundingSphere,t,p._boundingSphere)}h.camera.viewBoundingSphere(p._boundingSphere,new Freedo.HeadingPitchRange(0,-.5,0));h.camera.lookAtTransform(Freedo.Matrix4.IDENTITY)})}})}r.fetchJson().then(function(e){var t=e;var r=[];var i=[];t.contents.matrixsets.map(function(e){var t=e.resourceurl.find(function(e){return e.type==="file"}).template;c(e.matrix.cnodes,e.matrix.id,t,r,i)});p.treeRootLength=r.length;for(var n=0;n<r.length;n++){var a=r[n];var o=i[n];s(a,o)}}).otherwise(function(){})};F.prototype.flyTo=function(e,t,r){var i=this;var n=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var a=e;var o=t;if(!Array.isArray(e)){a=n(e);o=n(t)}H.center.x=(o[0]+a[0])/2;H.center.y=-(o[2]+a[2])/2;H.center.z=(o[1]+a[1])/2;H.radius=Math.sqrt((o[0]-a[0])*(o[0]-a[0])+(o[1]-a[1])*(o[1]-a[1])+(o[2]-a[2])*(o[2]-a[2]));var s=Freedo.BoundingSphere.transform(H,i.modelMatrix,H);i._viewer.camera.flyToBoundingSphere(s,{offset:new Freedo.HeadingPitchRange(0,-.5,0),complete:r});i._viewer.camera.lookAtTransform(Freedo.Matrix4.IDENTITY)};F.prototype.unhighlightComponents=function(e){var t=this;for(var r in t.loadedGLTFs){var i=t.loadedGLTFs[r].gltf;var n=i.nodes;for(var a=0;a<n.length;a++){if(e.indexOf(n[a].name)!==-1){n[a].highlightComponentColor=undefined}}}};F.prototype.highlightComponents=function(e,t){var r=this;for(var i in r.loadedGLTFs){var n=r.loadedGLTFs[i].gltf;var a=n.nodes;for(var o=0;o<a.length;o++){if(e.indexOf(a[o].name)!==-1){a[o].highlightComponentColor=Freedo.clone(t,true)}}}};F.prototype.showComponents=function(e,t){var r=this;for(var i in r.loadedGLTFs){var n=r.loadedGLTFs[i]._nodeCommands;for(var a=0;a<n.length;a++){var o=n[a].command.owner;if(!Freedo.defined(o)){continue}var s=o.node.name;if(e.indexOf(s)!==-1){n[a].show=t}}}};F.prototype.nodeClick=function(e,t,r){var i=this;var n=false;var a=e.uid;if(a===i.lastClickedItemName){n=true}i.lastClickedItemName=a;var o=e.BoundsMin;var s=e.BoundsMax;i.flyTo(o,s);if(i.lastHighlightedComponents.length>0){i.unhighlightComponents(i.lastHighlightedComponents);i.lastHighlightedComponents=[];if(n){return}}var l=[];if(e.childVal){m(e.childVal,l)}else{l.push(e.uid)}i.highlightComponents(l,i.highlightColor);i.lastHighlightedComponents=l};F.prototype.nodeExpand=function(e,t){var r=this;var i=e.childVal;if(!i)return;if(e.child.length>0)return;e.child=[];var n=i;if(Array.isArray(n)){var a=true;var o=false;var s=undefined;try{for(var l=(0,A.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c={title:d["@name"],uid:d["@uid"],name:d["@name"],BoundsMin:d["@BoundsMin"],BoundsMax:d["@BoundsMax"],elementType:d["@"+p],child:[],childVal:d["Node"]};e.child.push(c)}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}}else{var f=n;var h={title:f["@name"],uid:f["@uid"],name:f["@name"],BoundsMin:f["@BoundsMin"],BoundsMax:f["@BoundsMax"],elementType:f["@"+p],child:[],childVal:f["Node"]};e.child.push(h)}r.modelTree.addNode(e,t)};F.prototype.nodeSelected=function(e,t,r){var i=this;var n=e.uid;var a=true;if(!r){a=false}var o=[];if(e.childVal){m(e.childVal,o)}else{o.push(n)}i.showComponents(o,a)};F.prototype.getElementsByType=function(e){var t=this.modelTree.tree;var r=[];for(var i in t){var n=t[i];h(n,e,r)}return r};F.prototype.getElementsByIdAndType=function(e,t){var r=this.modelTree.tree;var i=[];for(var n in r){var a=r[n];_(a,e,t,i)}return i};F.prototype.showModels=function(e,t){var r=this.modelTree.tree;var i=[];for(var n in r){var a=r[n];g(a,e,i)}this.showComponents(i,t);return true};F.prototype.showModel=function(e,t){var r=this.modelTree.tree;var i=[];for(var n in r){var a=r[n];y(a,e,i)}this.showComponents(i,t);return true};F.prototype.enterFirstPersonMode=function(){if(!this.firstPersonControl){var e="./static/Models/jiedai_nvz/jiedai_nvz.gltf";this.firstPersonControl=new FdMicroApp.FdFirstPersonControl(this._viewer,e)}this.firstPersonControl.enabled=true};F.prototype.exitFirstPersonMode=function(){if(!this.firstPersonControl){return}this.firstPersonControl.enabled=false};F.prototype.addLabel=function(e,t){var r=this;var i=r.modelTree.tree;var n;var a=e;for(var o=0;o<i.length;o++){var s=i[o];if(s.uid===a){n={bbmin:s.BoundsMin,bbmax:s.BoundsMax};break}n=V(s.childVal,a);if(n){break}}if(!n){return-1}var l=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var u=n.bbmin;var d=n.bbmax;if(!Array.isArray(u)){u=l(u);d=l(d)}H.center.x=(d[0]+u[0])/2;H.center.y=-(d[2]+u[2])/2;H.center.z=(d[1]+u[1])/2;var c=Freedo.BoundingSphere.transform(H,r.modelMatrix,H);var f=Freedo.Cartographic.fromCartesian(H.center);var h=this.labelUniqueIdCounter++;var p=new Freedo.Color.fromBytes(t.textInfo.colorR,t.textInfo.colorG,t.textInfo.colorB);var v=r.labelManager.add("Label",{position:[Freedo.Math.toDegrees(f.longitude),Freedo.Math.toDegrees(f.latitude),f.height],text:t.textInfo.text,id:h,image:t.imageUrl,labelOption:{color:p,font:t.textInfo.fontName},billboardOption:{width:t.width,height:t.height},pointOption:{color:p}});this.labelEntities.push(v);return h};F.prototype.removeLabel=function(e){for(var t=0;t<this.labelEntities.length;t++){var r=this.labelEntities[t];if(r._data.id===e){r.remove();return true}}return false};F.prototype.showLabel=function(e,t){for(var r=0;r<this.labelEntities.length;r++){var i=this.labelEntities[r];if(i._data.id===e){if(t){i.show()}else{i.hide()}return true}}return false};F.prototype.flytoRoom=function(e,t){var r=this;var i=r.modelTree.tree;var n;var a=e;for(var o=0;o<i.length;o++){var s=i[o];if(s.uid===a){n={bbmin:s.BoundsMin,bbmax:s.BoundsMax};break}n=k(s.childVal,a);if(n){break}}if(!n){return false}this.flyTo(n.bbmin,n.bbmax,t);var l=n.components;var u=new Freedo.Color(.5,.5,.5,.1);for(var d in r.loadedGLTFs){var c=r.loadedGLTFs[d]._nodeCommands;for(var o=0;o<c.length;o++){var f=c[o].command.owner;if(!Freedo.defined(f)){continue}var h=f.node.name;if(l.indexOf(h)===-1){r.nodePassMap.set(h,c[o].command.pass);c[o].command.pass=Freedo.Pass.TRANSLUCENT}}}return true};F.prototype.resetModelsTransparency=function(){var e=this;for(var t in e.loadedGLTFs){var r=e.loadedGLTFs[t]._nodeCommands;for(var i=0;i<r.length;i++){var n=r[i].command.owner;if(!Freedo.defined(n)){continue}var a=n.node.name;var o=e.nodePassMap.get(a);if(Freedo.defined(o)){r[i].command.pass=o}}}};F.prototype.flytoPerson=function(e,t,r){var i=this;var n=i.modelTree.tree;var a;for(var o=0;o<n.length;o++){var s=n[o];if(s.uid===componentId){a={bbmin:s.BoundsMin,bbmax:s.BoundsMax};break}a=V(s.childVal,e);if(a){break}}if(!a){return false}this.flyTo(a.bbmin,a.bbmax,r);var l=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var u=a.bbmin;var d=a.bbmax;if(!Array.isArray(bbmin)){u=l(bbmin);d=l(bbmax)}H.center.x=(d[0]+u[0])/2;H.center.y=-(d[2]+u[2])/2;H.center.z=(d[1]+u[1])/2;Freedo.Matrix4.multiplyByPoint(i.modelMatrix,H.center,H.center);var c=Freedo.Cartographic.fromCartesian(H.center);var f=this.labelUniqueIdCounter++;var h=this.this.labelManager.add("Label",{position:[Freedo.Math.toDegrees(c.longitude),Freedo.Math.toDegrees(c.latitude),c.height],text:"",id:f,image:t});this.labelEntities.push(h);return f};F.prototype.generateTrackLine=function(e,t,r){var o=this;var i=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var n=function e(t){var r=o.modelTree.tree;var i;for(var n=0;n<r.length;n++){var a=r[n];if(a.uid===componentId){i={bbmin:a.BoundsMin,bbmax:a.BoundsMax};break}i=V(a.childVal,componentId);if(i){break}}return i};var a=[];for(var s=0;s<t.length;s++){var l=t[s];var u=n(l);var d=u.bbmin;var c=u.bbmax;if(!Array.isArray(bbmin)){d=i(bbmin);c=i(bbmax)}H.center.x=(c[0]+d[0])/2;H.center.y=-(c[2]+d[2])/2;H.center.z=(c[1]+d[1])/2;Freedo.Matrix4.multiplyByPoint(o.modelMatrix,H.center,H.center);var f=Freedo.Cartographic.fromCartesian(H.center);a.push([Freedo.Math.toDegrees(f.longitude),Freedo.Math.toDegrees(f.latitude),f.height])}var h=e;var p=this.labelManager.add("Polyline",{pts:a,id:h,lineWidth:r.width,lineColor:[r.r,r.g,r.b,1]});this.trackLineEntities.push(p);return h};F.prototype.destroyTrackLine=function(e){for(var t=0;t<this.trackLineEntities.length;t++){var r=this.trackLineEntities[t];if(r._data.id===e){r.remove();return true}}return false};F.prototype.mergeVideo=function(e){var g=this;var t;for(var r in g.loadedGLTFs){var i=g.loadedGLTFs[r].id.name;if(i===e){t=g.loadedGLTFs[r]}else{if(!g.videoObjectsMap.has(i)){g.loadedGLTFs[r].show=false}}}if(!Freedo.defined(t)){return false}var n=g.modelTree.tree;var a;var o=e;for(var s=0;s<n.length;s++){var l=n[s];if(l.uid===o){a={bbmin:l.BoundsMin,bbmax:l.BoundsMax};break}a=k(l.childVal,o);if(a){break}}if(!a){return false}this.flyTo(a.bbmin,a.bbmax);var u=a.components;function d(e){var t=document.createElement("VIDEO");t.setAttribute("width","0px");t.setAttribute("height","0px");t.setAttribute("autoplay","true");t.setAttribute("loop","true");t.setAttribute("crossorigin","anonymous");t.setAttribute("controls","controls");t.setAttribute("src",e);document.body.appendChild(t);var r=new Freedo.ImageMaterialProperty;r.image=t;return r}var c=[{src:"../../sampleData/video/1.mp4",position:new Freedo.Cartesian3(.0302917330519025,-17.872444169727384,8.652259000000003),center:new Freedo.Cartesian3(.0302917330519025,-15.761009633743692,5.902259000000002),up:Freedo.Cartesian3.UNIT_Z}];var f=new Freedo.Cartesian3;var h=new Freedo.Cartesian3;var p=new Freedo.Cartesian3;function v(e,t,r){r=Freedo.defaultValue(r,Freedo.Cartesian3.UNIT_Z);var i=Freedo.Cartesian3.subtract(e,t,new Freedo.Cartesian3);f=Freedo.Cartesian3.normalize(i,f);var n=Freedo.Cartesian3.cross(i,r,new Freedo.Cartesian3);h=Freedo.Cartesian3.normalize(n,h);var a=Freedo.Cartesian3.cross(n,i,new Freedo.Cartesian3);p=Freedo.Cartesian3.normalize(a,p);return Freedo.Matrix4.computeView(t,f,p,h,new Freedo.Matrix4)}var m=[];var _=[];for(var s=0;s<c.length;s++){var y=c[s];Freedo.Matrix4.multiplyByPoint(g.modelMatrix,y.center,y.center);Freedo.Matrix4.multiplyByPoint(g.modelMatrix,y.position,y.position);var w=v(y.center,y.position,y.up);var F=1920;var b=1080;var C=Freedo.Matrix4.computePerspectiveFieldOfView(Freedo.Math.PI/4,F/b,.1,2000.1,new Freedo.Matrix4);var x=Freedo.Matrix4.computeViewportTransformation({x:0,y:0,width:F,height:b},0,1,new Freedo.Matrix4);var P=new Freedo.Matrix4(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);var M=Freedo.Matrix4.multiply(C,w,new Freedo.Matrix4);var T=Freedo.Matrix4.multiply(P,M,new Freedo.Matrix4);m.push({matrix:T,matrixViewport:g.modelMatrix,width:F,height:b});var E=d(y.src);_.push(E)}g.videoObjectsMap.set(e,{videoObjects:m,imageMaterialProperties:_,gltfModel:t});t.videoObject=m;if(!Freedo.defined(g.removeEventListenFunc)){g.removeEventListenFunc=g._viewer.scene.preUpdate.addEventListener(function(e,t){var r=e.frameState;var i=r.context;var n=true;var a=false;var o=undefined;try{for(var s=(0,A.default)(g.videoObjectsMap),l;!(n=(l=s.next()).done);n=true){var u=(0,S.default)(l.value,2),d=u[0],c=u[1];var f=c.videoObjects;var h=c.imageMaterialProperties;for(var p=0;p<h.length;p++){var v=f[p];var m=h[p];var _;_=Freedo.MaterialProperty.getValue(t,m,_);var y=_.uniforms.image;if(y.readyState>=2){if(Freedo.defined(v.texture)){if(v.texture!==i.defaultTexture){v.texture.destroy()}v.texture=undefined}if(!Freedo.defined(v.texture)||v.texture===i.defaultTexture){v.texture=new Freedo.Texture({context:i,source:y})}}}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}})}};F.prototype.removeVideo=function(e){var t=this;var r=t.videoObjectsMap.get(e);if(!Freedo.defined(r)){return false}var i=r.gltfModel;i.videoObject=[];t.videoObjectsMap.delete(e);if(t.videoObjectsMap.size===0){for(var n in t.loadedGLTFs){t.loadedGLTFs[n].show=true}}t._viewer.scene.requestRender()};F.prototype.generateHeatmap=function(e,t,r){var s=this;s.destroyHeatmap();var i=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var n=function e(t){var r=s.modelTree.tree;var i=t;var n;for(var a=0;a<r.length;a++){var o=r[a];if(o.uid===i){n={bbmin:o.BoundsMin,bbmax:o.BoundsMax};break}n=V(o.childVal,i);if(n){break}}return n};var a=[];var o=360,l=-360,u=360,d=-360;var c=0;for(var f=0;f<e.length;f++){var h=function e(t,r,i){if(t<u){u=t}if(t>d){d=t}if(r<o){o=r}if(r>l){l=r}a.push([t,r,i])};var p=function e(){return(Math.floor(Math.random()*(8-2))+2)/10};var v=e[f].roomId;var m=n(v);var _=m.bbmin;var y=m.bbmax;if(!Array.isArray(_)){_=i(_);y=i(y)}H.center.x=(y[0]+_[0])/2;H.center.y=-(y[2]+_[2])/2;H.center.z=(y[1]+_[1])/2;Freedo.Matrix4.multiplyByPoint(s.modelMatrix,H.center,H.center);var g=Freedo.Cartographic.fromCartesian(H.center);var w=Freedo.Math.toDegrees(g.longitude);var F=Freedo.Math.toDegrees(g.latitude);h(w,F,e[f].persons/2);c+=g.height;var b=Math.floor(e[f].persons/2);if(b<2){b=e[f].persons}var C=e[f].persons-b;if(C>=2){var x=C;var P=Math.floor(Math.random()*(C-10))+10;for(var M=0;M<P;M++){var T=Math.floor(Math.random()*x);x-=T;H.center.x=_[0]+p()*(y[0]-_[0]);H.center.y=-(_[2]+p()*(y[2]-_[2]));H.center.z=_[1]+p()*(y[1]-_[1]);Freedo.Matrix4.multiplyByPoint(s.modelMatrix,H.center,H.center);var g=Freedo.Cartographic.fromCartesian(H.center);var w=Freedo.Math.toDegrees(g.longitude);var F=Freedo.Math.toDegrees(g.latitude);h(w,F,T)}}}c/=e.length;var E=t;var S=r;var A=[];var k=a[0][2];for(var f=0;f<a.length;f++){var g=a[f];var L={x:Math.floor((g[1]-o)/(l-o)*E),y:Math.floor((g[0]-u)/(d-u)*S),value:g[2]};k=Math.max(k,g[2]);A.push(L)}var D=document.createElement("div");D.style.width=E+"px";D.style.height=S+"px";D.style.visibility="hidden";this.divElement.appendChild(D);var I=h337.create({container:D});var R={max:k,data:A};I.setData(R);var O=I.getDataURL();var N=s.heatmapUniqueIdCounter++;var B=s._viewer.scene.primitives.add(new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.RectangleGeometry({rectangle:Freedo.Rectangle.fromDegrees(u,o,d,l),vertexFormat:Freedo.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat,height:c}),id:N}),appearance:new Freedo.MaterialAppearance({materialSupport:Freedo.MaterialAppearance.MaterialSupport.TEXTURED,material:new Freedo.Material({fabric:{type:"Image",uniforms:{color:new Freedo.Color(1,1,1,1),image:O}}})})}));s.heatmapEntities.set(N,B);s._viewer.scene.requestRender();return N};F.prototype.destroyHeatmap=function(e){var t=this;if(t.heatmapEntities.size===0){return false}var r=t.heatmapEntities.get(e);if(r){r.destroy();t.heatmapEntities.delete(e)}return true};t.FdBuildingUtil=F},function(e,t,r){var i=r(13);var n=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function e(t){return n.stringify.apply(n,arguments)}},function(e,t,r){var i=r(582);if(typeof i==="string")i=[[e.i,i,""]];var n;var a;var o={hmr:true};o.transform=n;o.insertInto=undefined;var s=r(249)(i,o);if(i.locals)e.exports=i.locals;if(false){}},function(e,t,r){t=e.exports=r(248)(false);t.push([e.i,'/* 结构树样式表 */\r\n\r\n.fd__tree_ul {\r\n    width: 100%;\r\n    background: #F5FAFE;\r\n    padding-top: 2.5px;\r\n    padding-left: 2px;\r\n}\r\n\r\n.fd__tree_li {\r\n    font-size: 0px;\r\n    width: 100%;\r\n    height: 30px;\r\n    background: #C4C7D8;\r\n    overflow: hidden;\r\n    border-bottom: 2px solid #f5fafe;\r\n}\r\n\r\n.fd__tree_ul .fd__tree_li:last-child {\r\n    border-bottom: none;\r\n}\r\n\r\n.fd__tree_li.active {\r\n    height: auto;\r\n}\r\n\r\n.fd__tree_li>.fd__tree_ul {\r\n    padding-left: 12px;\r\n}\r\n\r\n.fd_tree_toggle {\r\n    line-height: 30px;\r\n    width: 30px;\r\n    height: 30px;\r\n    display: inline-block;\r\n    text-align: center;\r\n    cursor: pointer;\r\n}\r\n\r\n.fd_tree_toggle i {\r\n    height: 0px;\r\n    width: 0px;\r\n    border-bottom: 7px solid transparent;\r\n    border-top: 7px solid transparent;\r\n    border-left: 7px solid #fff;\r\n    line-height: 30px;\r\n    display: inline-block;\r\n    transition: all .3s ease-in-out;\r\n    vertical-align: middle;\r\n}\r\n\r\n.fd__tree_li.active>.fd_tree_toggle i {\r\n    transform: rotate(90deg);\r\n}\r\n\r\n.fd_tree_span {\r\n    display: inline-block;\r\n    vertical-align: middle;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    color: #2a2a2a;\r\n    font-size: 14px;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n    width: calc(100% - 60px);\r\n    cursor: pointer;\r\n}\r\n\r\n.fd_tree_span.active {\r\n    color: yellow;\r\n}\r\n\r\n/* 单选框 */\r\n\r\n.FD-radio-label {\r\n    margin: 3px 0px 0 0;\r\n    display: inline-block;\r\n}\r\n\r\n.FD-radio-radio {\r\n    display: none\r\n}\r\n\r\n.FD-radio-radioInput {\r\n    background-color: #fff;\r\n    border: 1px solid rgba(0, 0, 0, 0.15);\r\n    display: inline-block;\r\n    height: 16px;\r\n    margin-right: 10px;\r\n    margin-top: -1px;\r\n    vertical-align: middle;\r\n    width: 16px;\r\n    line-height: 1;\r\n    cursor: pointer;\r\n}\r\n\r\n.FD-radio-radio.checked+.FD-radio-radioInput:after {\r\n    position: relative;\r\n    left: 1px;\r\n    top: 1px;\r\n    background-color: #57ad68;\r\n    content: "";\r\n    display: inline-block;\r\n    height: 12px;\r\n    margin: 0px;\r\n    width: 12px;\r\n}',""])},function(e,t){e.exports=function(e){var t=typeof window!=="undefined"&&window.location;if(!t){throw new Error("fixUrls requires window.location")}if(!e||typeof e!=="string"){return e}var n=t.protocol+"//"+t.host;var a=n+t.pathname.replace(/\/[^\/]*$/,"/");var r=e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var r=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)){return e}var i;if(r.indexOf("//")===0){i=r}else if(r.indexOf("/")===0){i=n+r}else{i=a+r.replace(/^\.\//,"")}return"url("+JSON.stringify(i)+")"});return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelAnimationManager=undefined;var i=r(585);var n=_(i);var a=r(588);var o=_(a);var s=r(18);var l=_(s);var u=r(1);var d=_(u);var c=r(2);var f=_(c);var h=r(246);var p=r(591);var v=r(592);var m=r(10);function _(e){return e&&e.__esModule?e:{default:e}}var y=function(){function r(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};(0,d.default)(this,r);this._viewer=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._defaultSpeed=Freedo.defaultValue(t.speed,r.Config.speed);this._defaultOffsetHeight=Freedo.defaultValue(t.offsetHeight,r.Config.offsetHeight);this._defaultLoop=Freedo.defaultValue(t.loop,r.Config.loop);this.initPLE();this._currenAnimator=undefined;this._animators={};this._data={}}(0,f.default)(r,[{key:"initPLE",value:function e(){var a=this;this._ple=new m.FdPolylineEditor(this._viewer);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._pleRemoveCallback=this._ple.on(function(e,t){if(e==="PLAdd"){var r=t.polyline.ptsG;if(a._currenAnimator){var i=a._currenAnimator._path?a._currenAnimator._path.concat(r):r;a._currenAnimator&&a.setPositions(i)}a._ple.cancel();a._event.raiseEvent("PointAdded");a._event.raiseEvent("PLAdded")}else if(e==="Transformed"){var n=a._ple._editPts;a.setPositions(n.map(function(e){return Freedo.FdMisc.FdGeometric.tg(e)}))}})}},{key:"addAnimator",value:function e(t,r){var i=this;if(!Freedo.defined(t)||typeof t!=="string"){console.error("必须设置name参数！");return false}if(this._data.hasOwnProperty(t)){console.error("name重复！");return false}var n=undefined;if(r.type==3){n=new v.FdModelAnimation3(this._viewer,(0,l.default)({loop:this._defaultLoop},r))}else if(r.type==2){n=new p.FdModelAnimation2(this._viewer,(0,l.default)({loop:this._defaultLoop},r))}else{n=new h.FdModelAnimation(this._viewer,(0,l.default)({speed:this._defaultSpeed,loop:this._defaultLoop,offsetHeight:this._defaultOffsetHeight},r))}this._data[t]=r;this._animators[t]=n;this._currenAnimator=n;this._event.raiseEvent("DataChanged");this._event.raiseEvent("AnimatorAdded");n.on(function(e){i._event.raiseEvent(e,n)});return n}},{key:"removeAnimator",value:function e(t){var r=void 0,i=void 0;if(typeof t==="string"){r=this._animators[t]}else if((t instanceof h.FdModelAnimation||t instanceof p.FdModelAnimation2||t instanceof v.FdModelAnimation3)&&(0,o.default)(this._animators).indexOf(t)>-1){r=t}if(!r){return}i=(0,n.default)(this._animators).find(function(e){return e[1]===r})[0];if(r){r.destroy();delete this._animators[i];delete this._data[i];if(this._currenAnimator===r){this._currenAnimator=undefined}}this._event.raiseEvent("DataChanged");this._event.raiseEvent("AnimatorRemoved")}},{key:"setCurrentAnimator",value:function e(t){var r=void 0;if(typeof t==="string"){r=this._animators[t]}else if((t instanceof h.FdModelAnimation||t instanceof p.FdModelAnimation2||t instanceof v.FdModelAnimation3)&&(0,o.default)(this._animators).indexOf(t)>-1){r=t}if(!r){console.error("animator不存在！");return false}this._currenAnimator=r;return true}},{key:"getCurrentAnimator",value:function e(){return this._currenAnimator}},{key:"renameAnimator",value:function e(t,r){if(this._data.hasOwnProperty(r)){console.error("name重复！");return false}if(!r){return}this._animators[r]=this._animators[t];this._data[r]=this._data[t];delete this._data[t];delete this._animators[t];this._event.raiseEvent("DataChanged")}},{key:"preAppendPoint",value:function e(t){t&&this.setCurrentAnimator(t);if(!this._currenAnimator)return;if(this._currenAnimator._path){var r=this._currenAnimator._path;this._ple.setStartPt(Freedo.FdMisc.FdGeometric.tc(r[r.length-1]))}else{this._ple.setStartPt(undefined)}this._ple.run()}},{key:"play",value:function e(t){t&&this.setCurrentAnimator(t);this._currenAnimator.play()}},{key:"pause",value:function e(t){t&&this.setCurrentAnimator(t);this._currenAnimator.pause()}},{key:"stop",value:function e(t){t&&this.setCurrentAnimator(t);this._currenAnimator.stop()}},{key:"setPositions",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator.setPositions(t);this._event.raiseEvent("DataChanged")}},{key:"showPath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var r=arguments[1];r&&this.setCurrentAnimator(r);this._currenAnimator.showPath(t);this._event.raiseEvent("DataChanged")}},{key:"isShowPath",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator.isShowPath()}},{key:"removePoint",value:function e(t,r){r&&this.setCurrentAnimator(r);if(t===undefined){this.setPositions([])}else{var i=this._currenAnimator._path;i.splice(t,1);this.setPositions(i)}this._event.raiseEvent("DataChanged");this._event.raiseEvent("PointRemoved")}},{key:"flyToPath",value:function e(t,r,i){var n=this.getAnimatorByName(t);if(!n){return}r=Number(r);var a=n.getPath(false);if(!isNaN(r)){r=r<0?0:r;r=r>=a.length?a.length-1:r;a=[a[r]]}var o=Freedo.BoundingSphere.fromPoints(a);this._viewer.camera.flyToBoundingSphere(o,{complete:i})}},{key:"appendPoint",value:function e(t,r,i){i&&this.setCurrentAnimator(i);var n=this._currenAnimator._path;r=Freedo.defaultValue(r,this._currenAnimator._path.length);var a=n.splice(0,r).concat(t).concat(n.splice(r));this.setPositions(a);this._event.raiseEvent("DataChanged");this._event.raiseEvent("PointAdded")}},{key:"setDelay",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator&&this._currenAnimator.setDelay(t);this._event.raiseEvent("DataChanged")}},{key:"getDelay",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator?this._currenAnimator.getDelay():undefined}},{key:"setSpeed",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator&&this._currenAnimator.setSpeed(t);this._event.raiseEvent("DataChanged")}},{key:"getSpeed",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator?this._currenAnimator.getSpeed():undefined}},{key:"setScale",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator&&this._currenAnimator.setScale(t);this._event.raiseEvent("DataChanged")}},{key:"getScale",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator?this._currenAnimator.getScale():undefined}},{key:"setOffsetHeight",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator&&this._currenAnimator.setOffsetHeight(t);this._event.raiseEvent("DataChanged")}},{key:"getOffsetHeight",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator?this._currenAnimator.getOffsetHeight():undefined}},{key:"setLoop",value:function e(t,r){r&&this.setCurrentAnimator(r);this._currenAnimator&&this._currenAnimator.setLoop(t);this._event.raiseEvent("DataChanged")}},{key:"getLoop",value:function e(t){t&&this.setCurrentAnimator(t);return this._currenAnimator?this._currenAnimator.getLoop():undefined}},{key:"setData",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};for(var r in t){this.addAnimator(r,t[r])}this._event.raiseEvent("DataChanged")}},{key:"startEdit",value:function e(t){t&&this.setCurrentAnimator(t);var r=this._currenAnimator&&this._currenAnimator.getPath(false);this._ple.startEdit(r)}},{key:"editPre",value:function e(){this._ple.editPre()}},{key:"editNext",value:function e(){this._ple.editNext()}},{key:"editPt",value:function e(t){this._ple.editPtByIndex(t)}},{key:"endEdit",value:function e(){this._ple.endEdit()}},{key:"getAnimatorByName",value:function e(t){return this._animators[t]}},{key:"getNameByAnimator",value:function e(t){var r=(0,n.default)(this._animators).find(function(e){return e[1]===t});return r?r[0]:undefined}},{key:"getPath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=arguments[1];r&&this.setCurrentAnimator(r);return this._currenAnimator?this._currenAnimator.getPath(t):[]}},{key:"getData",value:function e(){var t={};for(var r in this._animators){var i=this._animators[r];t[r]=i.getData()}return Freedo.clone(t)}},{key:"reset",value:function e(){for(var t in this._animators){var r=this._animators[t];r.destroy()}this._currenAnimator=undefined;this._animators={};this._data={};this._event.raiseEvent("AnimatorRemoved");this._event.raiseEvent("PointRemoved");this._event.raiseEvent("DataChanged")}},{key:"getDataPropName",value:function e(){return"model"}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}}]);return r}();y.Config={speed:10,offsetHeight:0,loop:true,scale:1};t.FdModelAnimationManager=y},function(e,t,r){e.exports={default:r(586),__esModule:true}},function(e,t,r){r(587);e.exports=r(13).Object.entries},function(e,t,r){var i=r(17);var n=r(250)(true);i(i.S,"Object",{entries:function e(t){return n(t)}})},function(e,t,r){e.exports={default:r(589),__esModule:true}},function(e,t,r){r(590);e.exports=r(13).Object.values},function(e,t,r){var i=r(17);var n=r(250)(false);i(i.S,"Object",{values:function e(t){return n(t)}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelAnimation2=undefined;var i=r(18);var n=u(i);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,o.default)(this,r);this._viewer=e;this._data=this._option=Freedo.clone(t);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._timeIntval=10;if(!t.url)throw new Error("请传入Gltf模型数据地址！");this.initOptions();this.loadModel();this.parsePath()}(0,l.default)(r,[{key:"initOptions",value:function e(){var t=this._option;this._speed=Freedo.defaultValue(t.speed,1);this._pause=false;this._stop=false;this._loop=Freedo.defaultValue(this._option.loop,false);this._scale=Freedo.defaultValue(this._option.scale,1);this._offsetHeight=Freedo.defaultValue(this._option.offsetHeight,0);this._delay=Freedo.defaultValue(this._option.delay,0);this._modelOption=Freedo.defaultValue(this._option.modelOption,{});this._showPath=Freedo.defaultValue(this._option.showPath,false)}},{key:"loadModel",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._option.url;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._model){this._viewer.scene.primitives.remove(this._model)}this._option.url=t;this._modelOption=(0,n.default)({},this._modelOption,r,{url:t});this._ready=false;this._scale=Freedo.defaultValue(r.scale,this._scale);this._model=Freedo.Model.fromGltf((0,n.default)({scale:this._scale},this._modelOption));this._viewer.scene.primitives.add(this._model);this._readyPromise=this._model.readyPromise.then(this.onModelReady.bind(this));return this._readyPromise}},{key:"track",value:function e(){var t=new Freedo.HeadingPitchRange(0,0,100);this.trackBoundingSphere(t)}},{key:"unTrack",value:function e(){this.trackBoundingSphere(false)}},{key:"cancelTrack",value:function e(){this.unTrack()}},{key:"freeTrack",value:function e(){this._viewer.trackedEntity=this._model}},{key:"unFreeTrack",value:function e(){this._viewer.trackedEntity=this._model}},{key:"onModelReady",value:function e(t){this._ready=true;this.updateModelMatrix();this._event.raiseEvent("DataChanged");return t}},{key:"setPositions",value:function e(){return this.parsePath.apply(this,arguments)}},{key:"parsePath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._option.positions;this.stop();this._time=new Freedo.JulianDate;if(!t){return}this._option.positions=t;var r=[];var i=[];this._distance=0;this._sampledPositionProperty=new Freedo.SampledPositionProperty;this._sampledPositionProperty.forwardExtrapolationType=Freedo.ExtrapolationType.HOLD;this._sampledPositionProperty.setInterpolationOptions({interpolationDegree:Freedo.defaultValue(this._option.interpolationDegree,2),interpolationAlgorithm:Freedo.HermitePolynomialApproximation});this._velocityOrientationProperty=new Freedo.VelocityOrientationProperty(this._sampledPositionProperty);for(var n=0;n<t.length;n++){var a=Freedo.Cartesian3.fromDegrees(t[n][0],t[n][1],t[n][2]+this._offsetHeight);var o=n==0?0:this._timeIntval;this._distance+=n==0?0:Freedo.Cartesian3.distance(a,i[n-1]);var s=n==0?new Freedo.JulianDate:Freedo.JulianDate.addSeconds(r[n-1],o,new Freedo.JulianDate);r.push(s);i.push(a);this._sampledPositionProperty.addSample(s,a)}this._times=r;this._pts=i;this._endTime=r[r.length-1];this._path=t;this.showPath(this._showPath)}},{key:"registerRenderEvent",value:function e(){if(this._RenderRemoveCallback)this._RenderRemoveCallback();var n=void 0;var a=this;this._RenderRemoveCallback=this._viewer.scene.postRender.addEventListener(function(e){a._viewer.scene.requestRender();var t=new Date;if(!n||a._pause){n=a._pause?undefined:t;return}var r=(t.getTime()-n.getTime())/1e3*a._speed;Freedo.JulianDate.addSeconds(a._time,r,a._time);if(Freedo.JulianDate.compare(a._time,a._endTime)>=0){a.stop();a._loop&&a.start();a._event.raiseEvent("End");return}n=t;var i=a.updateModelMatrix();a.updateTrackView(i)});a._viewer.scene.requestRender()}},{key:"updateModelMatrix",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._time;if(!this._sampledPositionProperty)return;var r=this._sampledPositionProperty.getValue(t,c);var i=this._velocityOrientationProperty.getValue(t,f);var n=Freedo.Matrix4.fromTranslationQuaternionRotationScale(r,i,h);this._model.modelMatrix=n;return n}},{key:"updateTrackView",value:function e(t){if(!this._track)return;var r=this._viewer.camera;var i=this._trackOffset;var n=Freedo.Matrix4.getTranslation(t,p);var a=i.range;var o=new Freedo.BoundingSphere(n,a);r.viewBoundingSphere(o)}},{key:"start",value:function e(){var t=this;if(!this._ready){throw new Error("请等待模型加载完成再开始播放!")}if(!this._path){throw new Error("请等先设置路径参数再开始播放!")}setTimeout(function(){t.registerRenderEvent();t._event.raiseEvent("Start")},this._delay*1e3)}},{key:"play",value:function e(){if(this._pause){this._pause=false}else{this.start()}}},{key:"pause",value:function e(){if(this._RenderRemoveCallback)this._pause=true;this._event.raiseEvent("Pause")}},{key:"stop",value:function e(){if(this._RenderRemoveCallback){this._RenderRemoveCallback();this._RenderRemoveCallback=undefined}this._time=new Freedo.JulianDate;this._pause=false;this._stop=true;this._event.raiseEvent("Stop")}},{key:"reset",value:function e(){this.stop();this.updateModelMatrix(new Freedo.JulianDate)}},{key:"setLoop",value:function e(t){this._loop=!!t}},{key:"getLoop",value:function e(){return this._loop}},{key:"setScale",value:function e(t){this._scale=Number(t);this._model&&(this._model.scale=this._scale)}},{key:"getScale",value:function e(){return this._scale}},{key:"setDelay",value:function e(t){this._delay=Number(t)}},{key:"getDelay",value:function e(){return this._delay}},{key:"setSpeed",value:function e(t){this._speed=Number(t)}},{key:"getSpeed",value:function e(){return this._speed}},{key:"setOffsetHeight",value:function e(t){this._offsetHeight=Number(t);this.setPositions()}},{key:"getOffsetHeight",value:function e(t){return this._offsetHeight}},{key:"showPath",value:function e(t){var r=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this._showPath=!!t;if(this._pathEntity){this._viewer.entities.remove(this._pathEntity);this._viewer.scene.primitives.remove(this._pathPoints)}if(this._showPath&&Freedo.defined(this._path)&&this._path.length>1){var n=this.getPath(false);var a=this.getPath(i);this._pathEntity=this._viewer.entities.add({polyline:{positions:a,material:new Freedo.PolylineGlowMaterialProperty({glowPower:.1,color:Freedo.Color.YELLOW}),depthFailMaterial:Freedo.Color.YELLOW}});this._pathPoints=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);n.forEach(function(e){r._pathPoints.add({position:e,color:Freedo.Color.RED,pixelSize:5,disableDepthTestDistance:Infinity})})}this._viewer.scene.requestRender()}},{key:"isShowPath",value:function e(){return this._showPath}},{key:"getPath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!this._path)return[];if(!t)return this._path.map(function(e){return Freedo.Cartesian3.fromDegrees(e[0],e[1],e[2])});var r=new Freedo.JulianDate;var i=[];var n=this._timeIntval/3;while(Freedo.JulianDate.compare(r,this._endTime)<0){var a=this._sampledPositionProperty.getValue(r);a&&i.push(a);Freedo.JulianDate.addSeconds(r,n,r)}i.push(this._sampledPositionProperty.getValue(this._endTime));return i}},{key:"trackBoundingSphere",value:function e(t){if(t){this._trackOffset=t;this._track=true}else if(t==false){this._track=false}}},{key:"destroy",value:function e(){this.stop();this.showPath(false);this._model&&this._viewer.scene.primitives.remove(this._model);this.play=e;this.stop=e;function e(){throw new Error("This object has been destroyed!")}}},{key:"getData",value:function e(){return(0,n.default)({},this._data,{loop:this._loop,offsetHeight:this._offsetHeight,showPath:this._showPath,scale:this._scale})}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"ready",get:function e(){return this._ready}},{key:"loop",get:function e(){return this._loop},set:function e(t){this._loop=!!t}},{key:"readyPromise",get:function e(){return this._readyPromise}},{key:"state",get:function e(){if(!this._ready){return"unready"}else if(this._RenderRemoveCallback&&!this._pause){return"play"}else if(this._RenderRemoveCallback&&this._pause){return"pause"}else if(this._stop){return"stop"}}}]);return r}();var c=new Freedo.Cartesian3;var f=new Freedo.Quaternion;var h=new Freedo.Cartesian3(1,1,1);var p=new Freedo.Cartesian3;t.FdModelAnimation2=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelAnimation3=undefined;var i=r(18);var n=u(i);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,o.default)(this,r);this._viewer=e;this._data=this._option=Freedo.clone(t);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;if(!t.url)throw new Error("请传入Gltf模型数据地址！");this.initOptions();this.parsePath()}(0,l.default)(r,[{key:"initOptions",value:function e(){this._modelOption=Freedo.defaultValue(this._option.modelOption,{});this._showPath=Freedo.defaultValue(this._option.showPath,false)}},{key:"track",value:function e(){this._viewer.trackedEntity=this._model}},{key:"unTrack",value:function e(){this._viewer.trackedEntity=undefined}},{key:"showPath",value:function e(t){this._model.path.show=t}},{key:"setPositions",value:function e(){return this.parsePath.apply(this,arguments)}},{key:"parsePath",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._option.positions;if(!t||t.length==0){return}this._option.positions=t;var r=Freedo.defaultValue(this._option.delay,0);var i=t[t.length-1].time;var n=Freedo.JulianDate.fromDate(new Date(2015,2,25,16));if(!this._viewer.clock.startTime.equals(n)){this._viewer.clock.startTime=n.clone();this._viewer.clock.currentTime=n.clone();var a=Freedo.JulianDate.addSeconds(n,i+r,new Freedo.JulianDate);this._viewer.clock.stopTime=a.clone()}var o=Freedo.JulianDate.addSeconds(this._viewer.clock.currentTime,r,new Freedo.JulianDate);var s=Freedo.JulianDate.addSeconds(o,i,new Freedo.JulianDate);this._spp=new Freedo.SampledPositionProperty;this._spp.forwardExtrapolationType=Freedo.ExtrapolationType.HOLD;this._velocityOrientationProperty=new Freedo.VelocityOrientationProperty(this._spp);for(var l=0;l<t.length;l++){var u=t[l];var d=Freedo.Cartesian3.fromDegrees(u.longitude,u.latitude,u.height);var c=l==0?o:Freedo.JulianDate.addSeconds(o,u.time,new Freedo.JulianDate);this._spp.addSample(c,d)}if(Freedo.JulianDate.lessThan(this._viewer.clock.stopTime,s)){this._viewer.clock.stopTime=s.clone()}this._startTime=o;this._stopTime=s;this._viewer.clock.clockRange=Freedo.ClockRange.CLAMPED;this._viewer.clock.multiplier=this._option.multiplier;if(Freedo.defined(this._viewer.timeline)){this._viewer.timeline.zoomTo(n,s)}this._model=this._viewer.entities.add({position:this._spp,orientation:new Freedo.VelocityOrientationProperty(this._spp),model:{uri:this._option.url,minimumPixelSize:this._modelOption.minimumPixelSize,scale:this._modelOption.scale},path:{resolution:1,material:new Freedo.PolylineGlowMaterialProperty({glowPower:.1,color:Freedo.Color.YELLOW}),width:10,show:this._showPath}})}},{key:"start",value:function e(){this._viewer.clock.currentTime=this._startTime;this._event.raiseEvent("Start")}},{key:"pause",value:function e(){this._event.raiseEvent("Pause")}},{key:"stop",value:function e(){this._viewer.clock.currentTime=this._viewer.clock.stopTime;this._event.raiseEvent("Stop")}},{key:"reset",value:function e(){this.stop()}},{key:"getDelay",value:function e(){return this._option.delay}},{key:"isShowPath",value:function e(){return this._showPath}},{key:"destroy",value:function e(){this.stop();this._model&&this._viewer.entities.remove(this._model);this.start=e;this.stop=e;function e(){throw new Error("This object has been destroyed!")}}},{key:"getData",value:function e(){return(0,n.default)({},this._data,{showPath:this._showPath})}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}}]);return r}();t.FdModelAnimation3=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTools=undefined;var i=r(1);var n=I(i);var a=r(240);var o=r(594);var s=r(595);var l=r(596);var u=r(82);var d=r(239);var c=r(238);var f=r(598);var h=r(599);var p=r(600);var v=r(601);var m=r(251);var _=r(602);var y=r(603);var g=r(604);var w=r(221);var F=r(681);var b=r(682);var C=r(683);var x=r(684);var P=r(685);var M=r(686);var T=r(687);var E=r(688);var S=r(691);var A=r(692);var k=r(693);var L=r(694);var D=r(695);function I(e){return e&&e.__esModule?e:{default:e}}var R=function e(){(0,n.default)(this,e);throw new Error("FdTools should not be instatiated!")};R.FdCloud=p.FdCloud;R.FdConfig=y.FdConfig;R.FdCustomClip=b.FdCustomClip;R.FdEraseGroundManager=d.FdEraseGroundManager;R.FdGeologySimulationManager=c.FdGeologySimulationManager;R.FdImageryLayersManager=o.FdImageryLayersManager;R.FdKeyboard=u.FdKeyboard;R.FdLabelsManager=a.FdLabelsManager;R.FdModelTransform=C.FdModelTransform;R.FdMultiViewSync=T.FdMultiViewSync;R.FdNavigationMixin=g.viewerFreedoNavigationMixin;R.FdPanoramaViewer=x.FdPanoramaViewer;R.FdPanoramaManager=P.FdPanoramaManager;R.FdPanoramaDataSource=M.FdPanoramaDataSource;R.FdPModelsStyleManager=w.FdPModelsStyleManager;R.FdPMTSManager=f.FdPMTSManager;R.FdPMTSUtilTools=_.FdPMTSUtilTools;R.FdSnowRain=F.FdSnowRain;R.FdStyler=m.FdStyler;R.FdTerrain=s.FdTerrain;R.FdViewportAuto=v.FdViewportAuto;R.FdViewPointsManager=l.FdViewPointsManager;R.FdViewSwitcher=h.FdViewSwitcher;R.FdMultiViewSync=T.FdMultiViewSync;R.FdMapboxProvider=E.FdMapboxProvider;R.FdCameraManager=S.FdCameraManager;R.FdVideo=A.FdVideo;R.FdSkyline=k.FdSkyline;R.FdScreenLine=L.FdScreenLine;R.FdBatchTree=D.FdBatchTree;t.FdTools=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdImageryLayersManager=undefined;var i=r(18);var c=u(i);var n=r(121);var f=u(n);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function t(e){(0,o.default)(this,t);this._imageryLayersOpts=[{}];this._viewer=e;this._imageryLayers=e.imageryLayers;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._imageryLayers.layerAdded.addEventListener(t.prototype._rawEventCallback,this);this._imageryLayers.layerMoved.addEventListener(t.prototype._rawEventCallback,this);this._imageryLayers.layerRemoved.addEventListener(t.prototype._rawEventCallback,this);this._imageryLayers.layerShownOrHidden.addEventListener(t.prototype._rawEventCallback,this)}(0,l.default)(t,[{key:"_rawEventCallback",value:function e(){this._event.raiseEvent("Changed");this._event.raiseEvent("DataChanged")}},{key:"addDefault",value:function e(){this.addDefaultImageryLayer()}},{key:"addDefaultImageryLayer",value:function e(){var t={name:"谷歌影像",type:"UrlTemplate",iconUrl:"../../Freedo/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:true,alpha:1},providerOptions:{url:"//{s}.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}",maximumLevel:20,subdomains:["mt0","mt1","mt2","mt3"],tilingScheme:"WebMercator"}};var r=this._imageryLayers.length;this.add(t,r)}},{key:"addTianDiTuImageryLayer",value:function e(){var t={name:"天地图全球影像服务",type:"WMTS",iconUrl:"//res.gbim360.com/lib/freedo/rel/1.5.8/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:true,alpha:1},providerOptions:{url:"//{s}.tianditu.com/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&tk=6ac0730ef5e5d74b5aa65e408896e182&style=default&format=tiles",layer:"img",style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18,tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],tilingScheme:"Geographic",tileDiscardPolicy:{missingImageUrl:"//t0.tianditu.com/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix=19&TileRow=0&TileCol=0&style=default&format=tiles&tk=6ac0730ef5e5d74b5aa65e408896e182",pixelsToCheck:[[0,0],[120,140],[130,160],[200,50],[200,200]],disableCheckIfAllPixelsAreTransparent:true}}};var r=this._imageryLayers.length;this.add(t,r)}},{key:"addTianDiTuZhuJiImageryLayer",value:function e(){var t={name:"天地图全球影像中文注记服务",type:"WMTS",iconUrl:"//res.gbim360.com/lib/freedo/rel/1.5.8/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:true,alpha:1},providerOptions:{url:"//{s}.tianditu.com/cia_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=c&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&tk=6ac0730ef5e5d74b5aa65e408896e182&style=default.jpg",layer:"cia",style:"default",format:"tiles",tileMatrixSetID:"c",maximumLevel:18,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tilingScheme:"Geographic",tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]}};var r=this._imageryLayers.length;this.add(t,r)}},{key:"getLayerProperty",value:function e(t,r){var i=this._imageryLayersOpts[t];if(typeof i==="undefined"){throw new Error("FdImageryLayersManager.getLayerProperty: cannot get property!")}if(i.layerOption&&typeof i.layerOption[r]!=="undefined"){return i.layerOption[r]}else{var n=this._imageryLayers.get(t);if((0,f.default)(n[r]!=="undefined")){return n[r]}else{throw new Error("FdImageryLayersManager.getLayerProperty: cannot get property!")}}}},{key:"setLayerProperty",value:function e(t,r,i){var n=this._imageryLayersOpts[t];if(typeof n==="undefined"){throw new Error("FdImageryLayersManager.setLayerProperty: cannot get property!")}var a=this.getLayerProperty(t,r);if(_.isEqual(a,i)){return}var o=this._imageryLayers.get(t);if((0,f.default)(o[r]!=="undefined")){o[r]=i}else{throw new Error("FdImageryLayersManager.setLayerProperty: cannot get property!")}if(typeof n.layerOption==="undefined"){n.layerOption={}}n.layerOption[r]=i;this._event.raiseEvent("Changed");this._viewer.scene.requestRender()}},{key:"add",value:function e(t,r){if(this._imageryLayersOpts.length===0){}if(typeof r==="undefined"){r=this._imageryLayersOpts.length;this._imageryLayersOpts.push(t)}else{this._imageryLayersOpts.splice(r,0,t)}var i=Freedo.clone(t.providerOptions,true);var n;switch(t.type){case"BingMaps":{if(i.mapStyle==="AERIAL"){i.mapStyle=Freedo.BingMapsStyle.AERIAL}else if(i.mapStyle==="AERIAL_WITH_LABELS"){i.mapStyle=Freedo.BingMapsStyle.AERIAL_WITH_LABELS}else if(i.mapStyle==="ROAD"){i.mapStyle=Freedo.BingMapsStyle.ROAD}n=new Freedo.BingMapsImageryProvider(i);break}case"Mapbox":{n=new Freedo.MapboxImageryProvider(i);break}case"ESRI":{n=new Freedo.ArcGisMapServerImageryProvider(i);break}case"OpenStreetMap":{n=Freedo.createOpenStreetMapImageryProvider(i);break}case"WMTS":{if(i.tilingScheme==="Geographic"){i.tilingScheme=new Freedo.GeographicTilingScheme}if(i.tileDiscardPolicy){var a=i.tileDiscardPolicy;if(a.pixelsToCheck){var o=i.tileDiscardPolicy.pixelsToCheck;var s=[];for(var l=0;l<o.length;++l){s.push(new Freedo.Cartesian2(o[l][0],o[l][1]))}a.pixelsToCheck=s}i.tileDiscardPolicy=new Freedo.DiscardMissingTileImagePolicy(a)}n=new Freedo.WebMapTileServiceImageryProvider(i);break}case"WMS":{n=new Freedo.WebMapServiceImageryProvider(i);break}case"TileMapService":{if(i.tilingScheme==="WebMercator"){i.tilingScheme=new Freedo.WebMercatorTilingScheme}else if(i.tilingScheme==="Geographic"){i.tilingScheme=new Freedo.GeographicTilingScheme}n=Freedo.createTileMapServiceImageryProvider(i);break}case"UrlTemplate":{if(i.tilingScheme==="WebMercator"){i.tilingScheme=new Freedo.WebMercatorTilingScheme}else if(i.tilingScheme==="Geographic"){i.tilingScheme=new Freedo.GeographicTilingScheme}n=new Freedo.UrlTemplateImageryProvider(i);break}case"MapboxVector":{if(i.tilingScheme==="Geographic")i.tilingScheme=new Freedo.GeographicTilingScheme;else i.tilingScheme=new Freedo.WebMercatorTilingScheme;n=new Freedo.FdTools.FdMapboxProvider((0,c.default)({},i,{viewer:this._viewer}));break}}n.myName=t.name;n.myType=t.myType;this._imageryLayers.addImageryProvider(n,r);var u=this._imageryLayers.get(r);for(var d in t.layerOption){this.setLayerProperty(r,d,t.layerOption[d]);if((0,f.default)(u[d]!=="undefined")){u[d]=t.layerOption[d]}else{throw new Error("FdImageryLayersManager.add: cannot get property("+d+")!")}}u.myName=t.name;u.myType=t.myType;if(!t.stillness)this._event.raiseEvent("DataChanged");return u}},{key:"addByPMTS",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var r=t.url,C=t.autoFly,i=t.show,x=i===undefined?true:i,n=t.name,P=n===undefined?"用户影像":n,a=t.alpha,M=a===undefined?1:a,T=t.stillness,E=t.myType;var S=this;function o(e){var t={},r=[];var i=e.split("?");if(i.length>1){r=i[1].split("=")}for(var n=0;n<r.length;n+=2){t[r[n]]=r[n+1]}return t}var A=o(r);Freedo.Resource.fetchXML({url:r}).then(function(e){var t=e.getElementsByTagName("Layer")[0];var r=t.getElementsByTagName("ResourceURL")[0].getAttribute("template");if(A.hasOwnProperty())r=r.indexOf("?")>0?r:r+"?";for(var i in A){if(r.indexOf("=")>0)r+="&";if(r.indexOf(i)<0)r+i+"="+A[i]}var n=t.getElementsByTagName("TileMatrixLimits");var a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0,f=void 0;for(var h=0;h<n.length;h++){var p=n[h].getElementsByTagName("TileMatrix")[0].innerHTML.split(":");var v=parseInt(p[p.length-1]);if(s==undefined||v<s){s=v;a=h}if(l==undefined||v>l){l=v;o=h}}u=parseInt(n[o].getElementsByTagName("MinTileRow")[0].innerHTML);d=parseInt(n[o].getElementsByTagName("MaxTileRow")[0].innerHTML);c=parseInt(n[o].getElementsByTagName("MinTileCol")[0].innerHTML);f=parseInt(n[o].getElementsByTagName("MaxTileCol")[0].innerHTML);var m=Freedo.defined(e.childNodes[0].attributes["xmlns:ows"])?e.childNodes[0].attributes["xmlns:ows"].value:"*";var _=e.getElementsByTagNameNS(m,"SupportedCRS")[0];var y=_&&(_.innerHTML.indexOf("3857")>0||_.innerHTML.indexOf("102100")>0||_.innerHTML.indexOf("102113")>0);var g=Freedo.FdMisc.FdMath.tile2rect(u,d,c,f,l,y);var w=Math.abs(g[0])<=180&&Math.abs(g[2])<=180&&Math.abs(g[1])<=90&&Math.abs(g[3])<=90;var F=t.getElementsByTagNameNS(m,"Title")[0];P=Freedo.defined(F)&&P==="用户影像"?F.innerHTML:P;for(var b=0;b<g.length;b++){g[b]*=Freedo.Math.RADIANS_PER_DEGREE}r=y?r.replace("{TileMatrix}","{z}").replace("{TileCol}","{y}").replace("{TileRow}","{x}"):r.replace("{TileMatrix}","{z}").replace("{TileCol}","{x}").replace("{TileRow}","{y}");S.add({name:P,myType:E,type:"UrlTemplate",iconUrl:"http://res.gbim360.com/lib/freedo/rel/1.4.2/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:x,alpha:M},stillness:T,providerOptions:{url:r,minimumLevel:s,maximumLevel:l,rectangle:w?new Freedo.Rectangle(g[0],g[1],g[2],g[3]):undefined,tilingScheme:y?"WebMercator":"Geographic"}},S._imageryLayers.length);if(C&&w){S._viewer.camera.setView({destination:new Freedo.Rectangle(g[0],g[1],g[2],g[3])})}if(!T){S._event.raiseEvent("DataChanged")}})}},{key:"raise",value:function e(t){if(t>=0&&t<this.length-1){var r=this._imageryLayersOpts[t];this._imageryLayersOpts[t]=this._imageryLayersOpts[t+1];this._imageryLayersOpts[t+1]=r;var i=this._imageryLayers.get(t);this._imageryLayers.raise(i);this._viewer.scene.requestRender()}}},{key:"lower",value:function e(t){if(t>0&&t<this.length){var r=this._imageryLayersOpts[t];this._imageryLayersOpts[t]=this._imageryLayersOpts[t-1];this._imageryLayersOpts[t-1]=r;var i=this._imageryLayers.get(t);this._imageryLayers.lower(i);this._viewer.scene.requestRender()}}},{key:"remove",value:function e(t){if(t>=0&&t<this.length){this._imageryLayersOpts.splice(t,1);var r=this._imageryLayers.get(t);this._imageryLayers.remove(r);this._event.raiseEvent("DataRemoved")}}},{key:"removeAll",value:function e(){this._imageryLayersOpts.splice(1,this.length);var t=this._imageryLayers.length;for(var r=1;r<t;r++){this._imageryLayers.remove(this._imageryLayers.get(1))}this._event.raiseEvent("DataChanged")}},{key:"getAllLayers",value:function e(){return Freedo.clone(this._imageryLayersOpts,true)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){this.removeAll()}},{key:"dispose",value:function e(){this.reset()}},{key:"getDataPropName",value:function e(){return"image"}},{key:"getData",value:function e(){return Freedo.clone(this._imageryLayersOpts)}},{key:"setData",value:function e(t){if(!t)return;for(var r=1;r<t.length;r++){if(t[r].url===undefined){this.add(t[r])}else{this.addByPMTS({url:t[r].url,autoFly:true,stillness:true})}}}},{key:"imageryLayersOptions",get:function e(){return this._imageryLayersOpts}},{key:"length",get:function e(){return this._imageryLayersOpts.length}}]);return t}();t.FdImageryLayersManager=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTerrain=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e){(0,n.default)(this,t);this._viewer=e;this._scene=this._viewer.scene;this._terrainOption={};this._showTerrain=false;this._terrain=new Freedo.EllipsoidTerrainProvider;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._defaultTerrain=new Freedo.EllipsoidTerrainProvider}(0,o.default)(t,[{key:"setTerrain",value:function e(t,r,i){if(typeof t==="string"){if(r==="HM"){this._terrain=new Freedo.FreedoTerrainProvider({url:t,constraintRegions:i,requestWaterMask:false})}else if(r==="STK"){this._terrain=new Freedo.FreedoTerrainProvider({url:t,constraintRegions:i,requestWaterMask:false})}else if(r==="STK_G"){if(Freedo.defined(Freedo.createWorldTerrain))this._terrain=Freedo.createWorldTerrain();else{console.warn("需要升级freedo.js到最新版才支持STK_G类型的地形")}}else if(r==="WETS"){this._terrain=new Freedo.WETSTerrainProvider({sources:[{capabilitiesUrl:t}],constraintRegions:i})}else{throw new Freedo.RuntimeError("The Terrain Type:"+r+" is not supported at present!");return}this._terrainOption.type=r;this._terrainOption.show=true;this._terrainOption.options=t;this._terrainOption.constraintRegions=i;this._event.raiseEvent("TypeChanged",{type:r});this.visible=true}else{this.setWETSTerrain(t,i)}this._event.raiseEvent("DataChanged",{terrainUri:t,type:r,constraintRegions:i})}},{key:"setTerrainByPMTS",value:function e(){var g=this;var w=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var t=w.url,F=w.autoFly,r=w.show,i=r===undefined?true:r,n=w.name,a=n===undefined?"地形":n,o=w.alpha,s=o===undefined?1:o,b=w.stillness;var C=this;function l(e){var t={},r=e.split("?")[1].split("=");for(var i=0;i<r.length;i+=2){t[r[i]]=r[i+1]}return t}var x=l(t);Freedo.Resource.fetchXML({url:t}).then(function(e){var t=e.getElementsByTagName("ResourceURL")[0].getAttribute("template");if(x.hasOwnProperty())t=t.indexOf("?")>0?t:t+"?";for(var r in x){if(t.indexOf("=")>0)t+="&";if(t.indexOf(r)<0)t+r+"="+x[r]}var i=e.getElementsByTagName("TileMatrixLimits");var n=void 0,a=void 0,o=void 0,s=void 0,l=void 0,u=void 0,d=void 0,c=void 0;for(var f=0;f<i.length;f++){var h=parseInt(i[f].getElementsByTagName("TileMatrix")[0].innerHTML);if(o==undefined||h<o){o=h;n=f}if(s==undefined||h>s){s=h;a=f}}l=parseInt(i[a].getElementsByTagName("MinTileRow")[0].innerHTML);u=parseInt(i[a].getElementsByTagName("MaxTileRow")[0].innerHTML);d=parseInt(i[a].getElementsByTagName("MinTileCol")[0].innerHTML);c=parseInt(i[a].getElementsByTagName("MaxTileCol")[0].innerHTML);var p=Freedo.defined(e.childNodes[0].attributes["xmlns:ows"])?e.childNodes[0].attributes["xmlns:ows"].value:"*";var v=e.getElementsByTagNameNS(p,"SupportedCRS")[0];var m=!(v&&v.innerHTML.indexOf("4326")>0);var _=Freedo.FdMisc.FdMath.tile2rect(l,u,d,c,s,m);for(var y=0;y<_.length;y++){_[y]*=Freedo.Math.RADIANS_PER_DEGREE}t=m?t.replace("{TileMatrix}","{z}").replace("{TileCol}","{y}").replace("{TileRow}","{x}"):t.replace("{TileMatrix}","{z}").replace("{TileCol}","{x}").replace("{TileRow}","{y}");C.setTerrain(t.replace("{z}/{x}/{y}.terrain",""),"HM");if(F){C._viewer.camera.setView({destination:new Freedo.Rectangle(_[0],_[1],_[2],_[3])})}if(!b){g._imageryLayersOpts.push(w);C._event.raiseEvent("DataChanged")}})}},{key:"getElevationContourMaterial",value:function e(){return new Freedo.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:false})}},{key:"getColorRamp",value:function e(t){var r=[0,.045,.1,.15,.37,.54,1];var i=document.createElement("canvas");i.width=100;i.height=1;var n=i.getContext("2d");var a;if(t==="elevation"){a=r}var o=n.createLinearGradient(0,0,100,0);o.addColorStop(a[0],"#000000");o.addColorStop(a[1],"#2747E0");o.addColorStop(a[2],"#D33B7D");o.addColorStop(a[3],"#D33038");o.addColorStop(a[4],"#FF9742");o.addColorStop(a[5],"#ffd700");o.addColorStop(a[6],"#ffffff");n.fillStyle=o;n.fillRect(0,0,100,1);return i}},{key:"enableColorMode",value:function e(t,r){this._viewer.scene.globe.enableLighting=true;var i=t;var n=r;var a=Freedo.Color.RED.clone();var o={};var s={};var l=false;var u="elevation";var d=this._viewer.scene.globe;var c;if(u==="elevation"){c=Freedo.Material.fromType("ElevationRamp");s=c.uniforms;s.minimumHeight=i;s.maximumHeight=n}if(u!=="none"){s.image=this.getColorRamp(u)}d.material=c}},{key:"disableColorMode",value:function e(){this._viewer.scene.globe.material=undefined}},{key:"setWETSTerrain",value:function e(t,r){if(!(t instanceof Array)){throw new Error("The parameter of setWETSTerrain must be an Array!");return}if(t.length<1){return}if(!r instanceof Array){r=undefined}this._terrain=new Freedo.WETSTerrainProvider({sources:t,constraintRegions:r});this._terrainOption.type="WETS";this._terrainOption.show=true;this._terrainOption.options=t;this._event.raiseEvent("TypeChanged",{type:"WETS"});this.visible=true}},{key:"enableTerrainReverseSkirt",value:function e(){var t=this._terrain;if(!(t instanceof Freedo.WETSTerrainProvider)){throw new Error("The current Terrain is not The Freedo.WETSTerrainProvider Object!");return}var r=this._viewer;r.scene.screenSpaceCameraController.enableCollisionDetection=false;var i=r.camera;i.showTerrainWhenUnderGround=true;i.reverseSkirtWhenUnderGround=true;t.addReverseSkirt=true;t._hideSkirtIndexBufferWithContext=[];t._reverseSkirtIndexBufferWithContext=[];t._heightmapWidth1=65;t._heightmapHeight1=65;t.getHideSkirtIndexBuffer=function(){return function(e){var t=this._hideSkirtIndexBufferWithContext[e.id];if(!t){t=this._hideSkirtIndexBufferWithContext[e.id]=Freedo.Buffer.createIndexBuffer({context:e,typedArray:r(this._heightmapWidth1,this._heightmapHeight1),usage:Freedo.BufferUsage.STATIC_DRAW,indexDatatype:Freedo.IndexDatatype.UNSIGNED_SHORT});t.vertexArrayDestroyable=false;t.referenceCount=1}return t};function r(e,t){var r=new Uint16Array((e-1)*(t-1)*6);var i=0;var n=0;for(var a=0;a<t+1;++a){for(var o=0;o<e+1;++o){if(a>0&&a<t&&o>0&&o<e){var s=i;var l=s+e+2;var u=l+1;var d=s+1;r[n++]=s;r[n++]=l;r[n++]=d;r[n++]=d;r[n++]=l;r[n++]=u}++i}++i}return r}}();t.getReverseSkirtIndexBuffer=function(){return function(e){var t=this._reverseSkirtIndexBufferWithContext[e.id];if(!t){t=this._reverseSkirtIndexBufferWithContext[e.id]=Freedo.Buffer.createIndexBuffer({context:e,typedArray:r(this._heightmapWidth1,this._heightmapHeight1),usage:Freedo.BufferUsage.STATIC_DRAW,indexDatatype:Freedo.IndexDatatype.UNSIGNED_SHORT});t.vertexArrayDestroyable=false;t.referenceCount=1}return t};function r(e,t){var r=new Uint16Array((e+1)*(t+1)*6);var i=0;var n=0;var a=(e+2)*(t+2);for(var o=0;o<t+1;++o){for(var s=0;s<e+1;++s){var l=i;var u=l+e+2;var d=u+1;var c=l+1;if(o===0){l=a+s;c=l+1;if(s===0){u=a+(e+2)}else if(s===e){d=a+(e+2)+1}}else if(o===t){u=a+(e+2+2*t)+s;d=u+1;if(s===0){l=a+(e+2+2*(t-1))}else if(s===e){c=a+(e+2+2*(t-1))+1}}else if(s===0){l=a+(e+2)+2*(o-1)+s;u=l+2}else if(s===e){c=a+(e+2)+2*(o-1)+1;d=c+2}r[n++]=l;r[n++]=u;r[n++]=c;r[n++]=c;r[n++]=u;r[n++]=d;++i}++i}return r}}()}},{key:"setDepthTest",value:function e(t){this._viewer.scene.globe.depthTestAgainstTerrain=t;this._viewer.scene.requestRender()}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){this.visible=false;this._terrainOption={};this._terrain=null}},{key:"dispose",value:function e(){this.reset();this._terrainOption={};this._terrain=null;this._eventHelper.removeAll()}},{key:"getDataPropName",value:function e(){return"terrain"}},{key:"getData",value:function e(){return Freedo.clone(this._terrainOption)}},{key:"setData",value:function e(t){if(!t)return;var r=t.options,i=t.type,n=t.constraintRegions;this.setTerrain(r,i,n)}},{key:"visible",get:function e(){return this._showTerrain},set:function e(t){if(this._showTerrain&&t===false){this._viewer.terrainProvider=this._defaultTerrain;this._showTerrain=false}else if(!this._showTerrain&&t===true){this._viewer.terrainProvider=this._terrain;this._showTerrain=true}else if(this._showTerrain&&t===true){this._viewer.terrainProvider=this._terrain;this._showTerrain=true}this._terrainOption.show=t;this._event.raiseEvent("StatusChanged",{status:t});this._viewer.scene.requestRender()}},{key:"terrain",get:function e(){return this._terrain}},{key:"terrainOptions",get:function e(){return this._terrainOption}}]);return t}();t.FdTerrain=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdViewPointsManager=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(166);var l=r(597);function u(e){return e&&e.__esModule?e:{default:e}}var d=new Freedo.Matrix4;var c=function(){function t(e){(0,n.default)(this,t);this._viewpointOpts={};this._viewer=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._flytoControl=new l.FdFlyToController(e.scene.camera);this._currentPlayingGroupID=undefined;this._currentGroupID=undefined;var r=this;this._flytoControl.on(function(e,t){r.flyToEventCallback(e,t)})}(0,o.default)(t,[{key:"getDataPropName",value:function e(){return"view"}},{key:"getData",value:function e(){return Freedo.clone(this._viewpointOpts,true)}},{key:"setData",value:function e(t){this.viewPointsOptions=t;this._event.raiseEvent("DataChanged")}},{key:"flyToEventCallback",value:function e(t,r){if(t==="CurrentIndexChanged"){this._event.raiseEvent("PlayingGroupCurrentIndexChanged",r)}else if(t==="StatusChanged"){this._event.raiseEvent("PlayingGroupStatusChanged",r)}else if(t==="PropertyChanged"){this._event.raiseEvent("PlayingGroupPropertyChanged",r)}}},{key:"createGroup",value:function e(t,r){if(typeof r==="undefined"){r=Freedo.createGuid()}this._viewpointOpts[r]={id:r,name:t,list:[]};this._currentGroupID=r;this._event.raiseEvent("GroupsChanged");this._event.raiseEvent("DataChanged");return r}},{key:"removeGroup",value:function e(t){if(typeof this._viewpointOpts[t]==="undefined"){return false}if(this._currentGroupID===t){this._flytoControl.reset();this._currentGroupID=undefined}if(this._currentPlayingGroupID===t){this._flytoControl.reset()}delete this._viewpointOpts[t];this._event.raiseEvent("GroupsChanged",t);this._event.raiseEvent("DataChanged");return true}},{key:"getGroupName",value:function e(t){if(typeof this._viewpointOpts[t]==="undefined"){return""}return this._viewpointOpts[t].name}},{key:"setGroupName",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){return""}this._viewpointOpts[t].name=r;this._event.raiseEvent("DataChanged")}},{key:"getGroupOptions",value:function e(t){if(typeof this._viewpointOpts[t]==="undefined"){return undefined}var r=Freedo.clone(this._viewpointOpts[t],true);return r}},{key:"removeAllGroups",value:function e(){this._flytoControl.reset();this._viewpointOpts={};this._currentPlayingGroupID=undefined;this._event.raiseEvent("GroupsChanged");this._event.raiseEvent("DataChanged");return true}},{key:"getAllGroupIDs",value:function e(){var t=[];for(var r in this._viewpointOpts){t.push(r)}return t}},{key:"appendViewpoint",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){return false}var i=Freedo.clone(r,true);this._viewpointOpts[t].list.push(i);this._event.raiseEvent("GroupChanged",t);this._event.raiseEvent("DataChanged",t);return true}},{key:"insertViewpoint",value:function e(t,r,i){if(typeof this._viewpointOpts[t]==="undefined"){return false}var n=Freedo.clone(r,true);this._viewpointOpts[t].list.splice(i,0,n);this._event.raiseEvent("GroupChanged",t);this._event.raiseEvent("DataChanged",t);return true}},{key:"removeViewpoint",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){return false}if(typeof this._viewpointOpts[t].list[r]==="undefined"){return false}this._viewpointOpts[t].list.splice(r,1);this._event.raiseEvent("GroupChanged",t);this._event.raiseEvent("DataChanged");return true}},{key:"getViewpointsLength",value:function e(t){if(typeof this._viewpointOpts[t]==="undefined"){throw new Error("getViewpointsLength error!")}return this._viewpointOpts[t].list.length}},{key:"setViewpoint",value:function e(t,r,i){if(typeof this._viewpointOpts[t]==="undefined"){return false}if(typeof this._viewpointOpts[t].list[r]==="undefined"){return false}var n=Freedo.clone(i,true);this._viewpointOpts[t].list[r]=n;this._event.raiseEvent("ViewPointChanged",n);this._event.raiseEvent("DataChanged");return true}},{key:"getViewPoint",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){throw new Error("getViewPoint error")}if(typeof this._viewpointOpts[t].list[r]==="undefined"){return new Error("getViewPoint error")}var i=this._viewpointOpts[t].list[r];var n=Freedo.clone(i,true);return n}},{key:"flyTo",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){return false}if(typeof this._viewpointOpts[t].list[r]==="undefined"){return false}var i=this._viewpointOpts[t].list[r];var n=i.cameraInfo;if(typeof n==="undefined"){return false}var a=this._viewer.scene.camera;(0,s.flyToByCameraInfo)(a,n);return true}},{key:"goTo",value:function e(t,r){if(typeof this._viewpointOpts[t]==="undefined"){return false}if(typeof this._viewpointOpts[t].list[r]==="undefined"){return false}var i=this._viewpointOpts[t].list[r];var n=i.cameraInfo;if(typeof n==="undefined"){return false}var a=this._viewer.scene.camera;(0,s.goToByCameraInfo)(a,n);return true}},{key:"startOrResumeGroup",value:function e(t){if(typeof t==="undefined"){if(typeof this._currentPlayingGroupID!=="undefined"){t=this._currentPlayingGroupID}else{throw new Error("FdViewPointsManager startOrResume should have argument!")}}if(typeof this._currentPlayingGroupID!=="undefined"){if(t!==this._currentPlayingGroupID){this._flytoControl.stop();this._flytoControl._setViewpoints(null);this._flytoControl._setViewpoints(this._viewpointOpts[t].list);this._currentPlayingGroupID=t;this._flytoControl.startOrResume()}else{this._flytoControl.startOrResume()}}else{this._flytoControl._setViewpoints(this._viewpointOpts[t].list);this._currentPlayingGroupID=t;this._flytoControl.startOrResume()}}},{key:"pauseGroup",value:function e(){this._flytoControl.pause()}},{key:"stopGroup",value:function e(){this._flytoControl.stop()}},{key:"getGroupPlayingStatus",value:function e(){return this._flytoControl.status}},{key:"getGroupPlayingIndex",value:function e(){return this._flytoControl.currentIndex}},{key:"setGroupPlayingIndex",value:function e(t){this._flytoControl.currentIndex=t}},{key:"getGroupPlayingGroupID",value:function e(){return this._currentPlayingGroupID}},{key:"getCurrentGroupID",value:function e(){return this._currentGroupID}},{key:"setCurrentGroupID",value:function e(t){this._currentGroupID=t;this._event.raiseEvent("GroupChanged",t)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){this.removeAllGroups();this._flytoControl.reset()}},{key:"dispose",value:function e(){this.reset();this._flytoControl.dispose();this._eventHelper.removeAll()}},{key:"viewPointsOptions",get:function e(){return this._viewpointOpts},set:function e(t){if(!Freedo.defined(t)||t instanceof Array){return}this._viewpointOpts=t;this._event.raiseEvent("DataChanged");this._event.raiseEvent("GroupsChanged")}},{key:"playingLoop",get:function e(){return this._flytoControl.loop},set:function e(t){if(this._flytoControl.loop!==t){this._flytoControl.loop=t}}}]);return t}();t.FdViewPointsManager=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdFlyToController=undefined;var i=r(1);var n=l(i);var a=r(2);var o=l(a);var s=r(166);function l(e){return e&&e.__esModule?e:{default:e}}var u=new Freedo.Matrix4;var d=function(){function t(e){(0,n.default)(this,t);this._viewpoints=null;this._camera=e;this._currentIndex=-1;this._status="Stopped";this._flyingToIndex=-1;this._loop=false;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._timeoutID=undefined}(0,o.default)(t,[{key:"startOrResume",value:function e(){switch(this._status){case"Playing":break;case"Stopped":this._play();break;case"Paused":this._play();break;default:throw new Error("ViewpointsManager FdFlyToController error")}}},{key:"pause",value:function e(){switch(this._status){case"Playing":this._pause();break;case"Stopped":break;case"Paused":break;default:throw new Error("ViewpointsManager FdFlyToController error")}}},{key:"stop",value:function e(){switch(this._status){case"Playing":this._stop();break;case"Stopped":break;case"Paused":this._stop();break;default:throw new Error("ViewpointsManager FdFlyToController error")}}},{key:"reset",value:function e(){this._stop();this._viewpoints=null}},{key:"dispose",value:function e(){this._viewpoints=null}},{key:"_setViewpoints",value:function e(t){this._stop();this._viewpoints=t}},{key:"_getViewpoints",value:function e(){return this._viewpoints}},{key:"_play",value:function e(){if(this._viewpoints===null){throw new Error("FdFlyToController play error!")}this._flytoNext();this._setStatus("Playing")}},{key:"_pause",value:function e(){this._cancel();this._setStatus("Paused")}},{key:"_stop",value:function e(){this._cancel();this._setCurrentIndex(-1);this._setStatus("Stopped")}},{key:"_completeCallback",value:function e(){this._setCurrentIndex(this._flyingToIndex);if(this._currentIndex>=this._viewpoints.length){this._setCurrentIndex(-1)}this._flyingToIndex=-1;var t=this;this._timeoutID=setTimeout(function(){t._flytoNext()},1e3)}},{key:"_flytoNext",value:function e(){this._cancel();var t;if(this._currentIndex>=this._viewpoints.length-1){if(this._loop&&this._viewpoints.length!==1){this._flyingToIndex=0}else{this._stop()}}else{this._flyingToIndex=this._currentIndex+1}if(this._flyingToIndex!==-1){t=this._viewpoints[this._flyingToIndex].cameraInfo;if(typeof t!=="undefined"){var r=this;(0,s.flyToByCameraInfo)(r._camera,t,{complete:function e(){r._completeCallback()}})}}}},{key:"_cancel",value:function e(){clearTimeout(this._timeoutID);this._timeoutID=undefined;this._camera.cancelFlight();this._flyingToIndex=-1}},{key:"_goto",value:function e(t){if(t>=this._viewpoints.length){throw new Error("FdFlyToController inde error")}this._cancel();var r=this._viewpoints.list[t];var i=r.cameraInfo;if(typeof i==="undefined"){throw new Error("FdFlyToController cameraInfo error")}(0,s.goToByCameraInfo)(this._camera,i)}},{key:"_setStatus",value:function e(t){this._status=t;this._event.raiseEvent("StatusChanged",t)}},{key:"_setCurrentIndex",value:function e(t){this._currentIndex=t;this._event.raiseEvent("CurrentIndexChanged",t)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){this._setViewpoints(null);this._stop()}},{key:"dispose",value:function e(){this.reset();this._eventHelper.removeAll()}},{key:"currentIndex",get:function e(){return this._currentIndex},set:function e(t){this._goto(t);this._setCurrentIndex(t)}},{key:"status",get:function e(){return this._status}},{key:"loop",get:function e(){return this._loop},set:function e(t){this._loop=t;this._event.raiseEvent("PropertyChanged")}}]);return t}();t.FdFlyToController=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPMTSManager=undefined;var i=r(3);var F=h(i);var n=r(18);var m=h(n);var a=r(35);var o=h(a);var s=r(1);var l=h(s);var u=r(2);var d=h(u);var _=r(251);var y=r(170);var c=r(171);var f=r(252);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function r(e,t){(0,l.default)(this,r);this._pmtsOpts=new Freedo.AssociativeArray;this._pmtsCollection=new o.default;this._viewer=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._unReadyPModelNum=0;this._maxTryTimes=100;this._currentTime=0;this._flyed=false;this._requestStatus=new o.default;this._planeMode=Freedo.defaultValue(t,false)}(0,d.default)(r,[{key:"add",value:function e(o,s){if(typeof o.id==="undefined"){o.id=Freedo.createGuid()}else if(this._pmtsCollection.has(o.id)){console.error("The key("+o.id+") of pmts is repeat.");return}o.show=Freedo.defaultValue(o.show,true);if(!Freedo.defined(s)&&Freedo.defined(o.token)){s=o.token}this._flyed=false;var i=o.url;if(i.indexOf("token")>-1){s=new URL(i).searchParams.get("token")}var n=o.autoFlyto=Freedo.defaultValue(o.autoFlyto,true);var a=o.flytoOrGoto=Freedo.defaultValue(o.flytoOrGoto,false);var l=Freedo.defaultValue(o.maximumScreenSpaceError,16);var u=Freedo.defaultValue(o.maximumMemoryUsage,32);var d=o.lightColor;var c=Freedo.defaultValue(o.maximumAbsoluteMemoryUsage,1024*4);var f=Freedo.defaultValue(o.rateOfRadius,1);this._pmtsOpts.set(o.id,Freedo.clone(o,true));var h={token:s,styler:new _.FdStyler(this._viewer),editor:new y.FdTransformHelper(this._viewer),url:o.url,maximumScreenSpaceError:o.maximumScreenSpaceError,maximumMemoryUsage:o.maximumMemoryUsage,maximumAbsoluteMemoryUsage:o.maximumAbsoluteMemoryUsage};h.editor.hideAxis();this._pmtsCollection.set(o.id,h);var p=this;var v=0;Freedo.FdServer.FdPMTSServer.getResource(i,s,function(t,e){if(e){console.error("FdServer.FdShareServer.getLayerAccesskeyResource got error: "+e);p._pmtsCollection.delete(o.id);return}if(t==undefined||t.contents==undefined){console.error("ErrorUrl:"+i);p._pmtsCollection.delete(o.id);return}h.pModelInfos=[];h.jsonPMTSCapabilities=t;t.contents.layers.forEach(function(a){var e=Freedo.FdServer.FdPMTSParser.getMatrixSets(t,a);e.forEach(function(n){n.matrix.forEach(function(e){var t=Freedo.FdServer.FdPMTSParser.getPModelURL(a,n,e,s);p._unReadyPModelNum++;var r=p._viewer.scene.primitives.add(new Freedo.FreedoPModelset((0,m.default)({url:t,maximumScreenSpaceError:l,maximumMemoryUsage:u,maximumAbsoluteMemoryUsage:c,lightColor:d},o.rawOption)));r.readyPromise.then(function(e){p._unReadyPModelNum--;if(o.resetModelMatrix){e.modelMatrix=Freedo.Matrix4.inverse(e._root.transform,new Freedo.Matrix4);if(p._planeMode){Freedo.FdCamera.FdPlaneViewCameraHelper.flyToBoundingSphere(p._viewer.scene,e.boundingSphere)}}});if(typeof o.modelMatrix!=="undefined"){r.modelMatrix=Freedo.Matrix4.fromArray(o.modelMatrix)}r.style=new Freedo.FreedoPModelStyle;if(o.pointColor!=""&&o.pointColor!=undefined){var i=o.pointColor;if(i.indexOf("#")<0)i="#"+i;r.style.color="color('"+i+"')"}if(o.pointSize!=""&&o.pointSize!=undefined){r.style.pointSize=o.pointSize}h.pModelInfos.push({pModel:r,matrix:e,matrixSet:n,layer:a});r.show=o.show;h.styler.addPModel(r);h.editor.addPModel(r);v++})})});function r(){var t=Freedo.when.defer();var e=function e(){p._currentTime++;if(p._unReadyPModelNum==0||p._currentTime>p._maxTryTimes){p._currentTime=0;t.resolve()}else{setTimeout(e,50)}};e();return t.promise}r().then(function(){if(typeof o.transform!=="undefined"){var e=o.transform;try{if(Freedo.defined(e[3])){h.editor.applyTransformDelta(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}else{h.editor.applyTransformDelta(e[0],e[1],e[2],0,0,0,1,1,1)}}catch(e){}}if(n&&!p._flyed){var t=h.pModelInfos.length>1?h.pModelInfos[0].matrix.uid:undefined;var r=h.pModelInfos.length>1?h.pModelInfos[0].pModel:undefined;p.getUidBoundingSphere(o.id,t,s,function(e){if(Freedo.defined(e)){var t=Freedo.clone(e,true);t.radius*=f;var r={duration:o.duration,complete:typeof o.complete=="function"?o.complete:undefined};if(a){r.duration=0}if(p._planeMode){Freedo.FdCamera.FdPlaneViewCameraHelper.flyToBoundingSphere(p._viewer.scene,t,r)}else{p._viewer.camera.flyToBoundingSphere(t,r)}p._flyed=true}else{console.log("获取包围盒getUidBoundingSphere失败 "+o.id)}},{pModel:r})}p._event.raiseEvent("PModelLoaded",o.id)});p._event.raiseEvent("PmtsLoaded",o.id)},{position:o.position});this._event.raiseEvent("DataChanged");return o.id}},{key:"getPmts",value:function e(t){var r=this._pmtsCollection.get(t);if(Freedo.defined(r)){return r}else{console.error("未找到PMTS："+t);return undefined}}},{key:"getAllPmts",value:function e(){var i=[];var t=this._pmtsCollection;t.forEach(function(e,t,r){i.push(e)});return i}},{key:"getLayer",value:function e(t){var r=true;var i=false;var n=undefined;try{for(var a=(0,F.default)(this._pmtsCollection.values()),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=true;var u=false;var d=undefined;try{for(var c=(0,F.default)(s.jsonPMTSCapabilities.contents.layers),f;!(l=(f=c.next()).done);l=true){var h=f.value;if(h.identifier==t)return h}}catch(e){u=true;d=e}finally{try{if(!l&&c.return){c.return()}}finally{if(u){throw d}}}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}throw"没有找到指定layer:"+t}},{key:"getToken",value:function e(t){var r=this._pmtsOpts.get(t);return Freedo.defaultValue(r.token,undefined)}},{key:"setOptionValue",value:function e(t,r,i){var n=this._pmtsOpts.get(t);n[r]=Freedo.clone(i,true);this._event.raiseEvent("DataChanged")}},{key:"getPmtsIdByPModel",value:function e(n){var a=undefined;this._pmtsCollection.forEach(function(e,t){var r=e.pModelInfos;if(r!=undefined){for(var i=0;i<r.length;i++){if(r[i].pModel==n){a=t}}}});return a}},{key:"getPModelByMatrix",value:function e(n){var a=undefined;this._pmtsCollection.forEach(function(e,t){var r=e.pModelInfos;if(r!=undefined){for(var i=0;i<r.length;i++){if(r[i].matrix==n){a=r[i].pModel}}}});return a}},{key:"getPModelArrayByMatrixSet",value:function e(a){var o=[];this._pmtsCollection.forEach(function(e,t){var r=e.pModelInfos;if(r!=undefined){for(var i=0;i<r.length;i++){if(r[i].matrixSet==a){var n=r[i].pModel;o.push(n)}}}});return o}},{key:"getPModelByMatrix",value:function e(n){var a=undefined;this._pmtsCollection.forEach(function(e,t){var r=e.pModelInfos;for(var i=0;i<r.length;i++){if(r[i].matrix==n){a=r[i].pModel}}});return a}},{key:"setModelMatrix",value:function e(t,r,i){var n=Freedo.Matrix4.fromArray(r);var a=this._pmtsCollection.get(t);a.pModelInfos.forEach(function(e){if(i){var t=new Freedo.Matrix4;Freedo.Matrix4.multiply(n,e.pModel.modelMatrix,t);e.pModel.modelMatrix=t}else e.pModel.modelMatrix=n});var o=this._pmtsOpts.get(t);o.modelMatrix=r;this._event.raiseEvent("DataChanged")}},{key:"getModelMatrix",value:function e(t){var r=this._pmtsOpts.get(t);var i=r.modelMatrix;return i}},{key:"getData",value:function e(){return Freedo.clone(this._pmtsOpts.values,true)}},{key:"getDataPropName",value:function e(){return"pmts"}},{key:"setData",value:function e(t){if(!Freedo.defined(t))return;var r=t.length;var i=0;var n=this;function a(){if(i<r){console.log("添加数据："+t[i].url);n.add(t[i++]);setTimeout(function(){a()},50)}}a()}},{key:"getPropFromKeyValue",value:function e(t,r,i,n,a,o){var s=this.getPmts(t);i=encodeURIComponent(i);s.pModelInfos.forEach(function(e){var t=Freedo.defaultValue(o,undefined);if(Freedo.defined(t)&&Freedo.defined(t.pModel)){if(e.pModel!=t.pModel)return}else{t={pModel:e.pModel}}console.info("正在搜索");Freedo.FdServer.FdPMTSParser.getKeyValueJson(e.layer,e.matrixSet,e.matrix,r,i,n,a,t)})}},{key:"getUidBoundingBoxVertex",value:function e(_,y,t,g){var w=this;this.getUidProp(_,y,t,function(e){var t=w.getPmts(_);var r=true;var i=false;var n=undefined;try{for(var a=(0,F.default)(t.pModelInfos),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=true;var u=false;var d=undefined;try{for(var c=(0,F.default)(e),f;!(l=(f=c.next()).done);l=true){var h=f.value;if(s.matrix.identifier==h.cmatrix||s.matrixSet.identifier==h.matrixId){var p=s.matrix.metadata.position;var v=s.pModel.modelMatrix;var m=Freedo.FdMisc.FdMath.getBoundingBoxVertexFromBoundsMinMax(h.BoundsMin,h.BoundsMax,p,v);g({id:_,uid:y,vertex:m});break}}}catch(e){u=true;d=e}finally{try{if(!l&&c.return){c.return()}}finally{if(u){throw d}}}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}})}},{key:"getUidBoundingSphere",value:function e(t,r,i,n,a){var o=this.getPmts(t);for(var s=0;s<o.pModelInfos.length;s++){var l=o.pModelInfos[s];if(r===undefined){r=l.matrix.uid}if(Freedo.defined(a)&&Freedo.defined(a.pModel)){if(a.pModel!=l.pModel){continue}}Freedo.FdServer.FdPMTSParser.getUidBoundingSphere(l.layer,l.matrixSet,l.matrix,r,i,l.pModel.modelMatrix,n)}}},{key:"getAidProp",value:function e(t,r,i,n,a,o){var s=this;var l=1;function u(e){if(e.length==0&&i.length>l){s.getUidProp(t,i[l++],n,u,o);console.log("发送父节点属性请求")}else{a(e)}}if(!Freedo.defined(t))t=this.getPmtsIdByPModel(o.pModel);this.getUidProp(t,r,n,u,o)}},{key:"getAidProp1",value:function e(t,r,i,u,d,n){var a=this;if(!Freedo.defined(t))t=this.getPmtsIdByPModel(n.pModel);if(!Freedo.defined(n)){n={}}var o=this.getPmts(t);var s=Freedo.createGuid();this._requestStatus.set(s,{requestSend:0,requestReceive:0,result:[]});function c(r,i,n,a,o,s){if(s===0){a=a}else{a=o[s-1]}if(!a){return}if(a.lastIndexOf(":")!==-1){var e=a.split(":");a=e[e.length-1].split("@")[0];Freedo.FdServer.FdPMTSParser.getTagJson(r,i,n,a,u,function(e,t){s++;if(typeof t==="undefined"){if(Array.isArray(e)&&e.length===0){return}d(e)}else{c(r,i,n,a,o,s)}})}else if(a.lastIndexOf("[")!==-1){var t=a.lastIndexOf("[");var l=a.lastIndexOf("]");a=a.substring(t+1,l);Freedo.FdServer.FdPMTSParser.getTagJson(r,i,n,a,u,function(e,t){s++;if(typeof t==="undefined"){if(Array.isArray(e)&&e.length===0){return false}d(e)}else{c(r,i,n,a,o,s)}})}else{Freedo.FdServer.FdPMTSParser.getPropJson(r,i,n,a,u,function(e,t){s++;if(typeof t==="undefined"){d(e)}else{if(!o[s-1]){return}if(o[s-1].indexOf("?")!==-1){s++}c(r,i,n,a,o,s)}})}}for(var l=0;l<o.pModelInfos.length;l++){var f=o.pModelInfos[l];if(Freedo.defined(n.pModel)&&f.pModel!=n.pModel){continue}if(r===undefined){r=f.matrix.uid}this._requestStatus.get(s).requestSend++;if(r.indexOf(",")!==-1){var h=r.split(",");r=h[h.length-1]}c(f.layer,f.matrixSet,f.matrix,r,i,0)}}},{key:"getUidProp",value:function e(t,r,i,n,a){if(!Freedo.defined(a)){a={}}var o=this.getPmts(t);var s=Freedo.createGuid();this._requestStatus.set(s,{requestSend:0,requestReceive:0,result:[]});var l=this;function u(e,t){l._requestStatus.get(s).requestReceive++;if(Freedo.defined(e)){var r=Array.isArray(e)?e[0]:e;l._requestStatus.get(s).result.push(r)}}for(var d=0;d<o.pModelInfos.length;d++){var c=o.pModelInfos[d];if(Freedo.defined(a.pModel)&&c.pModel!=a.pModel){continue}if(r===undefined){r=c.matrix.uid}this._requestStatus.get(s).requestSend++;if(r.indexOf(",")!==-1){var f=r.split(",");r=f[f.length-1]}if(r.lastIndexOf(":")!==-1){var h=r.split(":");r=h[h.length-1].split("@")[0];Freedo.FdServer.FdPMTSParser.getTagJson(c.layer,c.matrixSet,c.matrix,r,i,u)}else if(r.lastIndexOf("[")!==-1){if(c.matrix.url&&c.matrix.url!=""){Freedo.FdServer.FdPMTSParser.getPropJson(c.layer,c.matrixSet,c.matrix,r,i,u)}else{var p=r.lastIndexOf("[");var v=r.lastIndexOf("]");r=r.substring(p+1,v);Freedo.FdServer.FdPMTSParser.getTagJson(c.layer,c.matrixSet,c.matrix,r,i,u)}}else{Freedo.FdServer.FdPMTSParser.getPropJson(c.layer,c.matrixSet,c.matrix,r,i,u)}}function m(){var t=Freedo.when.defer();var e=function e(){if(l._requestStatus.get(s).requestSend==l._requestStatus.get(s).requestReceive){t.resolve()}else{setTimeout(e,50)}};e();return t.promise}var _=m().then(function(){n(l._requestStatus.get(s).result)})}},{key:"getUidTag",value:function e(t,r,i,n){var a=this.getPmts(t);a.pModelInfos.forEach(function(e){if(r===undefined){r=e.matrix.uid}Freedo.FdServer.FdPMTSParser.getTagJson(e.layer,e.matrixSet,e.matrix,r,i,n)})}},{key:"setBaseColor",value:function e(t,r,i,n,a){var o=this.getPmts(t);if(Freedo.defined(o)){o.styler.setBaseColor(r,i,n,a)}}},{key:"highlightComponent",value:function e(t,r,i,n,a,o){this.setComponentColor(t,r,i,n,a,o)}},{key:"setComponentColor",value:function e(t,r,i,n,a,o){var s=this.getPmts(t);if(Freedo.defined(s)){s.styler.setColor(r,i,n,a,o)}}},{key:"unhighlightComponent",value:function e(t,r){var i=this.getPmts(t);if(Freedo.defined(i)){i.styler.restoreColor(r)}}},{key:"unhighlightAllComponents",value:function e(t){var r=this.getPmts(t);if(Freedo.defined(r)){r.styler.restoreAllColor()}}},{key:"showComponent",value:function e(t,r,i){var n=this.getPmts(t);if(Freedo.defined(n)){n.styler.setShow(r,i)}}},{key:"showAllComponents",value:function e(t){var r=this.getPmts(t);if(Freedo.defined(r)){r.styler.showAll()}}},{key:"hideAllComponents",value:function e(t){var r=this.getPmts(t);if(Freedo.defined(r)){r.styler.hideAll()}}},{key:"remove",value:function e(t){var r=this;this._pmtsOpts.remove(t);var i=this._pmtsCollection.get(t);if(Freedo.defined(i)&&Freedo.defined(i.pModelInfos)){i.pModelInfos.forEach(function(e){r._viewer.scene.primitives.remove(e.pModel)})}this._pmtsCollection.delete(t);this._event.raiseEvent("DataRemoved",t)}},{key:"showAll",value:function e(r,i){i=Freedo.defaultValue(i,[]);this._pmtsCollection.forEach(function(e,t){if(i.indexOf(t)==-1){if(e.pModelInfos){e.pModelInfos.forEach(function(e){e.pModel.show=r})}}})}},{key:"removeAll",value:function e(){this._pmtsOpts.removeAll();var r=this;this._pmtsCollection.forEach(function(e,t){r.remove(t)});this._pmtsCollection=new o.default}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"reset",value:function e(){this.removeAll()}},{key:"dispose",value:function e(){this.reset();this._eventHelper.removeAll()}},{key:"planeMode",get:function e(){return this._planeMode}}]);return r}();function v(e,t){if(typeof g_pmtsServer==="undefined"){g_pmtsServer="cfgateway.gbim360.cn"}return"//"+g_pmtsServer+"/freeserver-pmts/services/share/"+e+"/pmts/1.0.0/PMTSCapabilities.json?accesskey="+t}p.getPublicSharedPmtsURL=v;t.FdPMTSManager=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdViewSwitcher=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t){(0,n.default)(this,e);this._viewer=t;this._tempBall=null;this._spSize=0;this._oldType="";this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._skyBoxOnGround=undefined};o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};o.prototype.checkModelExist=function(){return false};o.prototype.getMode=function(){return this._oldType};o.prototype.start=function(e){var t=this;if(e==="MODEL_VIEW"){if(this._viewer.scene.skyAtmosphere)this._viewer.scene.skyAtmosphere.show=false;this._viewer.scene.fog.enabled=false;this._viewer.scene.globe.show=false;this._skyBoxOnGround=this._viewer.scene.skyBoxOnGround;this._viewer.scene.skyBoxOnGround=undefined;for(var r=0;r<this._viewer.dataSources.length;r++){var i=this._viewer.dataSources.get(r);i.show=false}}if(e==="COLUMBUS_VIEW"){this._viewer.scene.mode=Freedo.SceneMode.COLUMBUS_VIEW;if(this._oldType=="MODEL_VIEW"){this._viewer.terrainProvider=new Freedo.EllipsoidTerrainProvider}for(var r=0;r<this._viewer.dataSources.length;r++){var i=this._viewer.dataSources.get(r);i.show=true}this._viewer.scene.globe.show=true}if(e==="2D"){if(this._tempBall==null){this._viewer.entities.remove(this._tempBall);this._tempBall=null}this._viewer.scene.morphTo2D(.02);this._viewer.terrainProvider=new Freedo.EllipsoidTerrainProvider;for(var r=0;r<this._viewer.dataSources.length;r++){var i=this._viewer.dataSources.get(r);i.show=true}this._viewer.trackedEntity=undefined}if(e==="NORMAL_VIEW"){this.cancel()}this._oldType=e;this._event.raiseEvent("Start",{mode:this._oldType});this._event.raiseEvent("DataChanged",{mode:this._oldType});this._viewer.scene.requestRender()};o.prototype.morphTo3D=function(){this._viewer.scene.mode=Freedo.SceneMode.SCENE3D};o.prototype.cancel=function(){if(this._oldType=="MODEL_VIEW"){}this._viewer.scene.globe.show=true;if(this._viewer.scene.skyAtmosphere)this._viewer.scene.skyAtmosphere.show=true;this._viewer.scene.fog.enabled=true;this._viewer.scene.skyBoxOnGround=this._skyBoxOnGround;setTimeout(this.morphTo3D.bind(this),500);for(var e=0;e<this._viewer.dataSources.length;e++){var t=this._viewer.dataSources.get(e);t.show=true}if(this._tempBall!=null){this._viewer.entities.remove(this._tempBall);this._tempBall=null}this._event.raiseEvent("Cancel",{mode:this._oldType});this._oldType="NORMAL_VIEW";this._event.raiseEvent("DataChanged",{mode:this._oldType});this._viewer.scene.requestRender()};o.prototype.reset=function(){this.cancel()};o.prototype.dispose=function(){this.reset()};o.prototype.getData=function(){return this._oldType};o.prototype.getDataPropName=function(){return"viewSwh"};o.prototype.setData=function(e){this.start(e)};t.FdViewSwitcher=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCloud=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t){(0,n.default)(this,e);this._viewer=t;this._scene=this._viewer.scene;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._offset=new Freedo.Cartesian2(Math.random(),0);this._color=new Freedo.Color(1,1,1,.001);this._img=new Image;this._imgLoaded=false;this._img.onload=this.imgOnload.bind(this);this._bReady=false;this.loadImg();this.addLsnr();this.loadCloud();this.lastAlpha=.2};o.prototype.loadImg=function(){this._img.src=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/earth_clouds_8K-zch.png"};o.prototype.onCameraChanged=function(){if(!this._bReady)return;var e=Freedo.FdCamera.getCurrentCameraInfo(this._viewer.camera);var t=e[2];if(t<4e6){var r=t/4e6/10;this._color.alpha=r;if(r>this.lastAlpha)this._color.alpha=this.lastAlpha}else{this._color.alpha=this.lastAlpha}if(this._color.alpha<.02){this._cloudEnt.show=false}if(this._color.alpha>=.02){this._cloudEnt.show=true}};o.prototype.addLsnr=function(){this._viewer.camera.changed.addEventListener(this.onCameraChanged.bind(this))};o.prototype.moveCloud=function(){if(this._offset.x>1){this._offset.x=0}this._offset.x+=1e-4};o.prototype.cloudLoadP1=function(){if(!this._imgLoaded)return;this._color.alpha+=.01;if(this._color.alpha>this.lastAlpha){clearInterval(this._alphaTimer);this._bReady=true}};o.prototype.loadCloud=function(){setInterval(this.moveCloud.bind(this),100);this._alphaTimer=setInterval(this.cloudLoadP1.bind(this),100)};o.prototype.imgOnload=function(){this._img.onload=null;this._imgLoaded=true;var e=new Freedo.Material({fabric:{type:"DiffuseMap",uniforms:{color:this._color,offset:this._offset,image:this._img.src,repeat:new Freedo.Cartesian2(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st+offset)).channels*1.6",alpha:"texture2D(image, fract(repeat * materialInput.st+offset)).a * color.a"}}});this._cloudEnt=this._viewer.scene.primitives.add(new Freedo.Primitive({show:true,asynchronous:false,depthTestAgainstTerrain:false,appearance:new Freedo.MaterialAppearance({materialSupport:Freedo.MaterialAppearance.MaterialSupport.TEXTURED,material:e}),geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.RectangleGeometry({rectangle:Freedo.Rectangle.fromDegrees(-179.99999,-89.99999,179.99999,89.99999),vertexFormat:Freedo.EllipsoidSurfaceAppearance.VERTEX_FORMAT,height:1e5})})}))};o.prototype.remove=function(){if(this._cloudEnt!==undefined){this._viewer.scene.primitives.remove(this._cloudEnt)}};t.FdCloud=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdViewportAuto=undefined;var i=r(84);var n=s(i);var a=r(1);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function e(t,r,i){(0,o.default)(this,e);this._viewer=t;this._id=r;this._autoSave=i;this.readViewport()};l.prototype.readViewport=function(){var e=this.readFromLocalStorage(this._id);if(e){Freedo.FdCamera.goToByCameraInfo(this._viewer.scene.camera,e)}var t=this;if(autoSave){setInterval(function(){t.writeToLocalStorage()},5e3)}};l.prototype.readFromLocalStorage=function(e){var t=void 0;if(typeof localStorage[e]!=="undefined"){try{t=JSON.parse(localStorage[e])}catch(e){console.log(e)}}return t};l.prototype.saveViewport=function(){this.writeToLocalStorage()};l.prototype.writeToLocalStorage=function(e){var t=this.readFromLocalStorage(this._id);var r=Freedo.FdCamera.getCurrentCameraInfo(this._viewer.scene.camera);if(Freedo.defined(r)&&(t==undefined||t.toString()!=r.toString())){localStorage[this._id]=(0,n.default)(r)}};t.FdViewportAuto=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPMTSUtilTools=undefined;var i=r(1);var o=a(i);var n=r(2);var s=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function d(e){var t=e.split(",");return[parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]}var l=new Freedo.Cartesian3;var c=new Freedo.Cartesian3;var f=new Freedo.Cartesian3;var h=new Freedo.Cartesian3;var p=new Freedo.Matrix4;var u=function(){function a(e,t){(0,o.default)(this,a);if(!Freedo.defined(t)||t.length===0){throw new Freedo.DeveloperError("pModelInfoArray should be defined!")}this._layerId=t[0].layer.identifier;var r=d(t[0].matrix.metadata.position);this._matrix=Freedo.Transforms.eastNorthUpToFixedFrame(Freedo.Cartesian3.fromDegrees(r[1],r[0],r[2]));var i=Freedo.Resource.createIfNeeded(e);var n=i.getBaseUri(true);this._resource=Freedo.Resource.createIfNeeded(n)}(0,s.default)(a,[{key:"getBoundingSphereByUID",value:function e(t,n){var r=this._layerId;var a=this;var i=this._resource.getDerivedResource({url:"id/"+r+"/"+t});Freedo.when(i.fetchJson()).then(function(e){var t=d(e[0].BoundsMax);var r=d(e[0].BoundsMin);l.x=(t[0]+r[0])/2;l.y=-(t[2]+r[2])/2;l.z=(t[1]+r[1])/2;var i=Math.sqrt((t[0]-r[0])*(t[0]-r[0])+(t[1]-r[1])*(t[1]-r[1])+(t[2]-r[2])*(t[2]-r[2]));Freedo.Matrix4.multiplyByPoint(a._matrix,l,l);n(l,i)})}}],[{key:"getCombinedBoundingSphere",value:function e(t){if(!Freedo.defined(t)){return}var r;var i;for(var n=0;n<t.length;n++){var a=t[n].matrix.metadata.localbounds;if(n===0){i=d(t[n].matrix.metadata.position)}var o=d(a.max);var s=d(a.min);c.x=s[0];c.y=-s[2];c.z=s[1];f.x=o[0];f.y=-o[2];f.z=o[1];var l=Freedo.BoundingSphere.fromCornerPoints(c,f,new Freedo.BoundingSphere);if(!Freedo.defined(r)){r=l}else{Freedo.BoundingSphere.union(r,l,r)}}if(!(Math.abs(i[0])<1e-4&&Math.abs(i[1])<1e-4)){Freedo.Cartesian3.fromDegrees(i[1],i[0],i[2],Freedo.Ellipsoid.WGS84,h);var u=Transforms.eastNorthUpToFixedFrame(h,Freedo.Ellipsoid.WGS84,p);Freedo.BoundingSphere.transform(r,u,r)}return r}}]);return a}();t.FdPMTSUtilTools=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdConfig=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t){(0,n.default)(this,e);this._viewer=t;this._configs={replace:false,render:false,collision:false,through:true,cloud:false,fog:true,groundAtmosphere:true,highDynamicRange:true};this._clould=undefined;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper};o.prototype.setConfig=function(e){for(var t in e){this._configs[t]=e[t]}this._viewer.scene.context.uniformState.highlightModeRepalce=this._configs.replace;this._viewer.scene.requestRenderMode=this._configs.render;this._viewer.scene.screenSpaceCameraController.enableCollisionDetection=this._configs.collision;this._viewer.scene.globe.showGroundAtmosphere=this._configs.groundAtmosphere;this._viewer.scene.highDynamicRange=this._configs.highDynamicRange;this._viewer.scene.fog.enabled=this._configs.fog;this._viewer.scene.screenSpaceCameraController.disableThrough=!this._configs.through;if(this._configs.cloud&&this._cloud===undefined){this._cloud=new Freedo.FdTools.FdCloud(this._viewer)}else if(!this._configs.cloud&&this._cloud!==undefined){this._cloud.remove();this._cloud=undefined}this._event.raiseEvent("DataChanged")};o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};o.prototype.reset=function(){this._configs={replace:false,render:false,collision:false,through:true,cloud:false,fog:true,groundAtmosphere:true,highDynamicRange:true}};o.prototype.getData=function(){return this._configs};o.prototype.getDataPropName=function(){return"config"};o.prototype.setData=function(e){this.setConfig(e)};t.FdConfig=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.viewerFreedoNavigationMixin=undefined;var s=r(605);var i=r(679);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=t.viewerFreedoNavigationMixin=function(a,o,i){"use strict";function e(t,e){if(!a(t)){throw new i("viewer is required.")}var r=n(t,e);r.addOnDestroyListener(function(e){return function(){delete e.freedoNavigation}}(t));o(t,{freedoNavigation:{configurable:true,get:function e(){return t.cesiumWidget.freedoNavigation}}})}e.mixinWidget=function(e,t){return n.apply(undefined,arguments)};var n=function e(t,r){var i=new s.FreedoNavigation(t,r);var n=a(t.cesiumWidget)?t.cesiumWidget:t;o(n,{freedoNavigation:{configurable:true,get:function e(){return i}}});i.addOnDestroyListener(function(e){return function(){delete e.freedoNavigation}}(n));return i};return e}(Freedo.defined,Freedo.defineProperties,Freedo.DeveloperError)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FreedoNavigation=undefined;var o=r(606);var s=r(666);var l=r(669);var i=t.FreedoNavigation=function(n,a){"use strict";var e=function e(t){r.apply(this,arguments);this._onDestroyListeners=[]};e.prototype.distanceLegendViewModel=undefined;e.prototype.navigationViewModel=undefined;e.prototype.navigationDiv=undefined;e.prototype.distanceLegendDiv=undefined;e.prototype.terria=undefined;e.prototype.container=undefined;e.prototype._onDestroyListeners=undefined;e.prototype.destroy=function(){if(n(this.navigationViewModel)){this.navigationViewModel.destroy()}if(n(this.distanceLegendViewModel)){this.distanceLegendViewModel.destroy()}if(n(this.navigationDiv)){this.navigationDiv.parentNode.removeChild(this.navigationDiv)}delete this.navigationDiv;if(n(this.distanceLegendDiv)){this.distanceLegendDiv.parentNode.removeChild(this.distanceLegendDiv)}delete this.distanceLegendDiv;if(n(this.container)){this.container.parentNode.removeChild(this.container)}delete this.container;for(var e=0;e<this._onDestroyListeners.length;e++){this._onDestroyListeners[e]()}};e.prototype.addOnDestroyListener=function(e){if(typeof e==="function"){this._onDestroyListeners.push(e)}};function r(e,t){if(!n(e)){throw new DeveloperError("FreedoWidget or Viewer is required.")}var r=n(e.cesiumWidget)?e.cesiumWidget:e;var i=document.createElement("div");i.className="cesium-widget-cesiumNavigationContainer";r.container.appendChild(i);this.terria=e;this.terria.options=n(t)?t:{};this.terria.afterWidgetChanged=new a;this.terria.beforeWidgetChanged=new a;this.container=i;(0,o.registerKnockoutBindings)();if(!n(this.terria.options.enableDistanceLegend)||this.terria.options.enableDistanceLegend){this.distanceLegendDiv=document.createElement("div");i.appendChild(this.distanceLegendDiv);this.distanceLegendDiv.setAttribute("id","distanceLegendDiv");this.distanceLegendViewModel=s.DistanceLegendViewModel.create({container:this.distanceLegendDiv,terria:this.terria,mapElement:i,enableDistanceLegend:true})}if((!n(this.terria.options.enableZoomControls)||this.terria.options.enableZoomControls)&&(!n(this.terria.options.enableCompass)||this.terria.options.enableCompass)){this.navigationDiv=document.createElement("div");this.navigationDiv.setAttribute("id","navigationDiv");i.appendChild(this.navigationDiv);this.navigationViewModel=l.NavigationViewModel.create({container:this.navigationDiv,terria:this.terria,enableZoomControls:true,enableCompass:true})}else if(n(this.terria.options.enableZoomControls)&&!this.terria.options.enableZoomControls&&(!n(this.terria.options.enableCompass)||this.terria.options.enableCompass)){this.navigationDiv=document.createElement("div");this.navigationDiv.setAttribute("id","navigationDiv");i.appendChild(this.navigationDiv);this.navigationViewModel=l.NavigationViewModel.create({container:this.navigationDiv,terria:this.terria,enableZoomControls:false,enableCompass:true})}else if((!n(this.terria.options.enableZoomControls)||this.terria.options.enableZoomControls)&&n(this.terria.options.enableCompass)&&!this.terria.options.enableCompass){this.navigationDiv=document.createElement("div");this.navigationDiv.setAttribute("id","navigationDiv");i.appendChild(this.navigationDiv);this.navigationViewModel=l.NavigationViewModel.create({container:this.navigationDiv,terria:this.terria,enableZoomControls:true,enableCompass:false})}else if(n(this.terria.options.enableZoomControls)&&!this.terria.options.enableZoomControls&&n(this.terria.options.enableCompass)&&!this.terria.options.enableCompass){}}return e}(Freedo.defined,Freedo.Event,r(71))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.registerKnockoutBindings=undefined;var i=r(607);var n=r(662);var a=t.registerKnockoutBindings=function(t,s){"use strict";var e=function e(){t.register(s);i.KnockoutMarkdownBinding.register(s);n.KnockoutHammerBinding.register(s);s.bindingHandlers.embeddedComponent={init:function e(t,r,i,n,a){var o=s.unwrap(r());o.show(t);return{controlsDescendantBindings:true}},update:function e(t,r,i,n,a){}}};return e}(Freedo.SvgPathBindingHandler,r(71))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=t.KnockoutMarkdownBinding=function(e,t){"use strict";var u=/<html(.|\s)*>(.|\s)*<\/html>/im;var d=new t({html:true,linkify:true});d.use(e,{imageClass:"",removeUnbalanced:false,removeUnknown:false});var r={register:function e(l){l.bindingHandlers.markdown={init:function e(){return{controlsDescendantBindings:true}},update:function e(t,r){while(t.firstChild){l.removeNode(t.firstChild)}var i=l.unwrap(r());var n;if(u.test(i)){n=i}else{n=d.render(i)}var a=l.utils.parseHtmlFragment(n,t);t.className=t.className+" markdown";for(var o=0;o<a.length;++o){var s=a[o];c(s);t.appendChild(s)}}}}};function c(e){if(e instanceof HTMLAnchorElement){e.target="_blank"}if(e.childNodes&&e.childNodes.length>0){for(var t=0;t<e.childNodes.length;++t){c(e.childNodes[t])}}}return r}(r(608),r(609))},function(e,t,r){"use strict";e.exports=function e(t,r){var i=t.linkify,s=t.utils.escapeHtml,n='<a\\s([^<>]*href="[^"<>]*"[^<>]*)\\s?>',l=RegExp(n,"i"),a='<img\\s([^<>]*src="[^"<>]*"[^<>]*)\\s?\\/?>',u=RegExp(a,"i"),d=/^(?:https?:)?\/\//i,c=/^(?:https?:\/\/|ftp:\/\/|\/\/|mailto:|xmpp:)/i;r=r?r:{};var f=typeof r.removeUnknown!=="undefined"?r.removeUnknown:false;var o=typeof r.removeUnbalanced!=="undefined"?r.removeUnbalanced:false;var h=typeof r.imageClass!=="undefined"?r.imageClass:"";var p=false;var v;var m=["a","b","blockquote","code","em","h1","h2","h3","h4","h5","h6","li","ol","p","pre","s","sub","sup","strong","ul"];var _=new Array(m.length);var y=new Array(m.length);for(v=0;v<m.length;v++){_[v]=0}for(v=0;v<m.length;v++){y[v]=false}function g(e){var t=i.match(e);if(t&&t.length===1&&t[0].index===0&&t[0].lastIndex===e.length){return t[0].url}return null}function w(e){e=e.replace(/<[^<>]*>?/gi,function(e){var t,r,i,n,a,o;if(/(^<->|^<-\s|^<3\s)/.test(e)){return e}t=e.match(u);if(t){r=t[1];i=g(r.match(/src="([^"<>]*)"/i)[1]);n=r.match(/alt="([^"<>]*)"/i);n=n&&typeof n[1]!=="undefined"?n[1]:"";a=r.match(/title="([^"<>]*)"/i);a=a&&typeof a[1]!=="undefined"?a[1]:"";if(i&&d.test(i)){if(h!==""){return'<img src="'+i+'" alt="'+n+'" title="'+a+'" class="'+h+'">'}return'<img src="'+i+'" alt="'+n+'" title="'+a+'">'}}o=m.indexOf("a");t=e.match(l);if(t){r=t[1];i=g(r.match(/href="([^"<>]*)"/i)[1]);a=r.match(/title="([^"<>]*)"/i);a=a&&typeof a[1]!=="undefined"?a[1]:"";if(i&&c.test(i)){p=true;_[o]+=1;return'<a href="'+i+'" title="'+a+'" target="_blank">'}}t=/<\/a>/i.test(e);if(t){p=true;_[o]-=1;if(_[o]<0){y[o]=true}return"</a>"}t=e.match(/<(br|hr)\s?\/?>/i);if(t){return"<"+t[1].toLowerCase()+">"}t=e.match(/<(\/?)(b|blockquote|code|em|h[1-6]|li|ol(?: start="\d+")?|p|pre|s|sub|sup|strong|ul)>/i);if(t&&!/<\/ol start="\d+"/i.test(e)){p=true;o=m.indexOf(t[2].toLowerCase().split(" ")[0]);if(t[1]==="/"){_[o]-=1}else{_[o]+=1}if(_[o]<0){y[o]=true}return"<"+t[1]+t[2].toLowerCase()+">"}if(f===true){return""}return s(e)});return e}function F(e){var t,r,i;for(v=0;v<m.length;v++){_[v]=0}for(v=0;v<m.length;v++){y[v]=false}p=false;for(r=0;r<e.tokens.length;r++){if(e.tokens[r].type==="html_block"){e.tokens[r].content=w(e.tokens[r].content)}if(e.tokens[r].type!=="inline"){continue}i=e.tokens[r].children;for(t=0;t<i.length;t++){if(i[t].type==="html_inline"){i[t].content=w(i[t].content)}}}}function b(e){if(p===false){return}var t,r;function i(e,t){var r,i;if(t==="a"){r=RegExp('<a href="[^"<>]*" title="[^"<>]*" target="_blank">',"g")}else if(t==="ol"){r=/<ol(?: start="\d+")?>/g}else{r=RegExp("<"+t+">","g")}i=RegExp("</"+t+">","g");if(o===true){e=e.replace(r,"");e=e.replace(i,"")}else{e=e.replace(r,function(e){return s(e)});e=e.replace(i,function(e){return s(e)})}return e}function n(e){var t;for(t=0;t<m.length;t++){if(y[t]===true){e=i(e,m[t])}}return e}for(v=0;v<m.length;v++){if(_[v]!==0){y[v]=true}}for(t=0;t<e.tokens.length;t++){if(e.tokens[t].type==="html_block"){e.tokens[t].content=n(e.tokens[t].content);continue}if(e.tokens[t].type!=="inline"){continue}r=e.tokens[t].children;for(v=0;v<r.length;v++){if(r[v].type==="html_inline"){r[v].content=n(r[v].content)}}}}t.core.ruler.after("linkify","sanitize_inline",F);t.core.ruler.after("sanitize_inline","sanitize_balance",b)}},function(e,t,r){"use strict";e.exports=r(610)},function(e,t,r){"use strict";var i=r(9);var n=r(618);var a=r(619);var o=r(620);var s=r(628);var l=r(642);var u=r(655);var d=r(254);var c=r(657);var f={default:r(659),zero:r(660),commonmark:r(661)};var h=/^(vbscript|javascript|file|data):/;var p=/^data:image\/(gif|png|jpeg|webp);/;function v(e){var t=e.trim().toLowerCase();return h.test(t)?p.test(t)?true:false:true}var m=["http:","https:","mailto:"];function _(e){var t=d.parse(e,true);if(t.hostname){if(!t.protocol||m.indexOf(t.protocol)>=0){try{t.hostname=c.toASCII(t.hostname)}catch(e){}}}return d.encode(d.format(t))}function y(e){var t=d.parse(e,true);if(t.hostname){if(!t.protocol||m.indexOf(t.protocol)>=0){try{t.hostname=c.toUnicode(t.hostname)}catch(e){}}}return d.decode(d.format(t))}function g(e,t){if(!(this instanceof g)){return new g(e,t)}if(!t){if(!i.isString(e)){t=e||{};e="default"}}this.inline=new l;this.block=new s;this.core=new o;this.renderer=new a;this.linkify=new u;this.validateLink=v;this.normalizeLink=_;this.normalizeLinkText=y;this.utils=i;this.helpers=n;this.options={};this.configure(e);if(t){this.set(t)}}g.prototype.set=function(e){i.assign(this.options,e);return this};g.prototype.configure=function(t){var r=this,e;if(i.isString(t)){e=t;t=f[e];if(!t){throw new Error('Wrong `markdown-it` preset "'+e+'", check name')}}if(!t){throw new Error("Wrong `markdown-it` preset, can't be empty")}if(t.options){r.set(t.options)}if(t.components){Object.keys(t.components).forEach(function(e){if(t.components[e].rules){r[e].ruler.enableOnly(t.components[e].rules)}if(t.components[e].rules2){r[e].ruler2.enableOnly(t.components[e].rules2)}})}return this};g.prototype.enable=function(t,e){var r=[];if(!Array.isArray(t)){t=[t]}["core","block","inline"].forEach(function(e){r=r.concat(this[e].ruler.enable(t,true))},this);r=r.concat(this.inline.ruler2.enable(t,true));var i=t.filter(function(e){return r.indexOf(e)<0});if(i.length&&!e){throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+i)}return this};g.prototype.disable=function(t,e){var r=[];if(!Array.isArray(t)){t=[t]}["core","block","inline"].forEach(function(e){r=r.concat(this[e].ruler.disable(t,true))},this);r=r.concat(this.inline.ruler2.disable(t,true));var i=t.filter(function(e){return r.indexOf(e)<0});if(i.length&&!e){throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+i)}return this};g.prototype.use=function(e){var t=[this].concat(Array.prototype.slice.call(arguments,1));e.apply(e,t);return this};g.prototype.parse=function(e,t){var r=new this.core.State(e,this,t);this.core.process(r);return r.tokens};g.prototype.render=function(e,t){t=t||{};return this.renderer.render(this.parse(e,t),this.options,t)};g.prototype.parseInline=function(e,t){var r=new this.core.State(e,this,t);r.inlineMode=true;this.core.process(r);return r.tokens};g.prototype.renderInline=function(e,t){t=t||{};return this.renderer.render(this.parseInline(e,t),this.options,t)};e.exports=g},function(e){e.exports={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}},function(e,t,r){"use strict";var n={};function u(e){var t,r,i=n[e];if(i){return i}i=n[e]=[];for(t=0;t<128;t++){r=String.fromCharCode(t);if(/^[0-9a-z]$/i.test(r)){i.push(r)}else{i.push("%"+("0"+t.toString(16).toUpperCase()).slice(-2))}}for(t=0;t<e.length;t++){i[e.charCodeAt(t)]=e[t]}return i}function d(e,t,r){var i,n,a,o,s,l="";if(typeof t!=="string"){r=t;t=d.defaultChars}if(typeof r==="undefined"){r=true}s=u(t);for(i=0,n=e.length;i<n;i++){a=e.charCodeAt(i);if(r&&a===37&&i+2<n){if(/^[0-9a-f]{2}$/i.test(e.slice(i+1,i+3))){l+=e.slice(i,i+3);i+=2;continue}}if(a<128){l+=s[a];continue}if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&i+1<n){o=e.charCodeAt(i+1);if(o>=56320&&o<=57343){l+=encodeURIComponent(e[i]+e[i+1]);i++;continue}}l+="%EF%BF%BD";continue}l+=encodeURIComponent(e[i])}return l}d.defaultChars=";/?:@&=+$,-_.!~*'()#";d.componentChars="-_.!~*'()";e.exports=d},function(e,t,r){"use strict";var n={};function i(e){var t,r,i=n[e];if(i){return i}i=n[e]=[];for(t=0;t<128;t++){r=String.fromCharCode(t);i.push(r)}for(t=0;t<e.length;t++){r=e.charCodeAt(t);i[r]="%"+("0"+r.toString(16).toUpperCase()).slice(-2)}return i}function a(e,t){var u;if(typeof t!=="string"){t=a.defaultChars}u=i(t);return e.replace(/(%[a-f0-9]{2})+/gi,function(e){var t,r,i,n,a,o,s,l="";for(t=0,r=e.length;t<r;t+=3){i=parseInt(e.slice(t+1,t+3),16);if(i<128){l+=u[i];continue}if((i&224)===192&&t+3<r){n=parseInt(e.slice(t+4,t+6),16);if((n&192)===128){s=i<<6&1984|n&63;if(s<128){l+="��"}else{l+=String.fromCharCode(s)}t+=3;continue}}if((i&240)===224&&t+6<r){n=parseInt(e.slice(t+4,t+6),16);a=parseInt(e.slice(t+7,t+9),16);if((n&192)===128&&(a&192)===128){s=i<<12&61440|n<<6&4032|a&63;if(s<2048||s>=55296&&s<=57343){l+="���"}else{l+=String.fromCharCode(s)}t+=6;continue}}if((i&248)===240&&t+9<r){n=parseInt(e.slice(t+4,t+6),16);a=parseInt(e.slice(t+7,t+9),16);o=parseInt(e.slice(t+10,t+12),16);if((n&192)===128&&(a&192)===128&&(o&192)===128){s=i<<18&1835008|n<<12&258048|a<<6&4032|o&63;if(s<65536||s>1114111){l+="����"}else{s-=65536;l+=String.fromCharCode(55296+(s>>10),56320+(s&1023))}t+=9;continue}}l+="�"}return l})}a.defaultChars=";/?:@&=+$,#";a.componentChars="";e.exports=a},function(e,t,r){"use strict";e.exports=function e(t){var r="";r+=t.protocol||"";r+=t.slashes?"//":"";r+=t.auth?t.auth+"@":"";if(t.hostname&&t.hostname.indexOf(":")!==-1){r+="["+t.hostname+"]"}else{r+=t.hostname||""}r+=t.port?":"+t.port:"";r+=t.pathname||"";r+=t.search||"";r+=t.hash||"";return r}},function(e,t,r){"use strict";function i(){this.protocol=null;this.slashes=null;this.auth=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.pathname=null}var P=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,M=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,a=["<",">",'"',"`"," ","\r","\n","\t"],o=["{","}","|","\\","^","`"].concat(a),s=["'"].concat(o),T=["%","/","?",";","#"].concat(s),E=["/","?","#"],S=255,A=/^[+a-z0-9A-Z_-]{0,63}$/,k=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,L={javascript:true,"javascript:":true},D={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true};function l(e,t){if(e&&e instanceof i){return e}var r=new i;r.parse(e,t);return r}i.prototype.parse=function(e,t){var r,i,n,a,o,s=e;s=s.trim();if(!t&&e.split("#").length===1){var l=M.exec(s);if(l){this.pathname=l[1];if(l[2]){this.search=l[2]}return this}}var u=P.exec(s);if(u){u=u[0];n=u.toLowerCase();this.protocol=u;s=s.substr(u.length)}if(t||u||s.match(/^\/\/[^@\/]+@[^@\/]+/)){o=s.substr(0,2)==="//";if(o&&!(u&&L[u])){s=s.substr(2);this.slashes=true}}if(!L[u]&&(o||u&&!D[u])){var d=-1;for(r=0;r<E.length;r++){a=s.indexOf(E[r]);if(a!==-1&&(d===-1||a<d)){d=a}}var c,f;if(d===-1){f=s.lastIndexOf("@")}else{f=s.lastIndexOf("@",d)}if(f!==-1){c=s.slice(0,f);s=s.slice(f+1);this.auth=c}d=-1;for(r=0;r<T.length;r++){a=s.indexOf(T[r]);if(a!==-1&&(d===-1||a<d)){d=a}}if(d===-1){d=s.length}if(s[d-1]===":"){d--}var h=s.slice(0,d);s=s.slice(d);this.parseHost(h);this.hostname=this.hostname||"";var p=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!p){var v=this.hostname.split(/\./);for(r=0,i=v.length;r<i;r++){var m=v[r];if(!m){continue}if(!m.match(A)){var _="";for(var y=0,g=m.length;y<g;y++){if(m.charCodeAt(y)>127){_+="x"}else{_+=m[y]}}if(!_.match(A)){var w=v.slice(0,r);var F=v.slice(r+1);var b=m.match(k);if(b){w.push(b[1]);F.unshift(b[2])}if(F.length){s=F.join(".")+s}this.hostname=w.join(".");break}}}}if(this.hostname.length>S){this.hostname=""}if(p){this.hostname=this.hostname.substr(1,this.hostname.length-2)}}var C=s.indexOf("#");if(C!==-1){this.hash=s.substr(C);s=s.slice(0,C)}var x=s.indexOf("?");if(x!==-1){this.search=s.substr(x);s=s.slice(0,x)}if(s){this.pathname=s}if(D[n]&&this.hostname&&!this.pathname){this.pathname=""}return this};i.prototype.parseHost=function(e){var t=n.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e){this.hostname=e}};e.exports=l},function(e,t,r){"use strict";t.Any=r(255);t.Cc=r(256);t.Cf=r(617);t.P=r(174);t.Z=r(257)},function(e,t){e.exports=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804\uDCBD|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/},function(e,t,r){"use strict";t.parseLinkLabel=r(175);t.parseLinkDestination=r(122);t.parseLinkTitle=r(123)},function(e,t,r){"use strict";var i=r(9).assign;var f=r(9).unescapeAll;var h=r(9).escapeHtml;var n={};n.code_inline=function(e,t,r,i,n){var a=e[t];return"<code"+n.renderAttrs(a)+">"+h(e[t].content)+"</code>"};n.code_block=function(e,t,r,i,n){var a=e[t];return"<pre"+n.renderAttrs(a)+"><code>"+h(e[t].content)+"</code></pre>\n"};n.fence=function(e,t,r,i,n){var a=e[t],o=a.info?f(a.info).trim():"",s="",l,u,d,c;if(o){s=o.split(/\s+/g)[0]}if(r.highlight){l=r.highlight(a.content,s)||h(a.content)}else{l=h(a.content)}if(l.indexOf("<pre")===0){return l+"\n"}if(o){u=a.attrIndex("class");d=a.attrs?a.attrs.slice():[];if(u<0){d.push(["class",r.langPrefix+s])}else{d[u][1]+=" "+r.langPrefix+s}c={attrs:d};return"<pre><code"+n.renderAttrs(c)+">"+l+"</code></pre>\n"}return"<pre><code"+n.renderAttrs(a)+">"+l+"</code></pre>\n"};n.image=function(e,t,r,i,n){var a=e[t];a.attrs[a.attrIndex("alt")][1]=n.renderInlineAsText(a.children,r,i);return n.renderToken(e,t,r)};n.hardbreak=function(e,t,r){return r.xhtmlOut?"<br />\n":"<br>\n"};n.softbreak=function(e,t,r){return r.breaks?r.xhtmlOut?"<br />\n":"<br>\n":"\n"};n.text=function(e,t){return h(e[t].content)};n.html_block=function(e,t){return e[t].content};n.html_inline=function(e,t){return e[t].content};function a(){this.rules=i({},n)}a.prototype.renderAttrs=function e(t){var r,i,n;if(!t.attrs){return""}n="";for(r=0,i=t.attrs.length;r<i;r++){n+=" "+h(t.attrs[r][0])+'="'+h(t.attrs[r][1])+'"'}return n};a.prototype.renderToken=function e(t,r,i){var n,a="",o=false,s=t[r];if(s.hidden){return""}if(s.block&&s.nesting!==-1&&r&&t[r-1].hidden){a+="\n"}a+=(s.nesting===-1?"</":"<")+s.tag;a+=this.renderAttrs(s);if(s.nesting===0&&i.xhtmlOut){a+=" /"}if(s.block){o=true;if(s.nesting===1){if(r+1<t.length){n=t[r+1];if(n.type==="inline"||n.hidden){o=false}else if(n.nesting===-1&&n.tag===s.tag){o=false}}}}a+=o?">\n":">";return a};a.prototype.renderInline=function(e,t,r){var i,n="",a=this.rules;for(var o=0,s=e.length;o<s;o++){i=e[o].type;if(typeof a[i]!=="undefined"){n+=a[i](e,o,t,r,this)}else{n+=this.renderToken(e,o,t)}}return n};a.prototype.renderInlineAsText=function(e,t,r){var i="";for(var n=0,a=e.length;n<a;n++){if(e[n].type==="text"){i+=e[n].content}else if(e[n].type==="image"){i+=this.renderInlineAsText(e[n].children,t,r)}}return i};a.prototype.render=function(e,t,r){var i,n,a,o="",s=this.rules;for(i=0,n=e.length;i<n;i++){a=e[i].type;if(a==="inline"){o+=this.renderInline(e[i].children,t,r)}else if(typeof s[a]!=="undefined"){o+=s[e[i].type](e,i,t,r,this)}else{o+=this.renderToken(e,i,t,r)}}return o};e.exports=a},function(e,t,r){"use strict";var i=r(176);var n=[["normalize",r(621)],["block",r(622)],["inline",r(623)],["linkify",r(624)],["replacements",r(625)],["smartquotes",r(626)]];function a(){this.ruler=new i;for(var e=0;e<n.length;e++){this.ruler.push(n[e][0],n[e][1])}}a.prototype.process=function(e){var t,r,i;i=this.ruler.getRules("");for(t=0,r=i.length;t<r;t++){i[t](e)}};a.prototype.State=r(627);e.exports=a},function(e,t,r){"use strict";var i=/\r[\n\u0085]?|[\u2424\u2028\u0085]/g;var n=/\u0000/g;e.exports=function e(t){var r;r=t.src.replace(i,"\n");r=r.replace(n,"�");t.src=r}},function(e,t,r){"use strict";e.exports=function e(t){var r;if(t.inlineMode){r=new t.Token("inline","",0);r.content=t.src;r.map=[0,1];r.children=[];t.tokens.push(r)}else{t.md.block.parse(t.src,t.md,t.env,t.tokens)}}},function(e,t,r){"use strict";e.exports=function e(t){var r=t.tokens,i,n,a;for(n=0,a=r.length;n<a;n++){i=r[n];if(i.type==="inline"){t.md.inline.parse(i.content,t.md,t.env,i.children)}}}},function(e,t,r){"use strict";var w=r(9).arrayReplaceAt;function F(e){return/^<a[>\s]/i.test(e)}function b(e){return/^<\/a\s*>/i.test(e)}e.exports=function e(t){var r,i,n,a,o,s,l,u,d,c,f,h,p,v,m,_,y=t.tokens,g;if(!t.md.options.linkify){return}for(i=0,n=y.length;i<n;i++){if(y[i].type!=="inline"||!t.md.linkify.pretest(y[i].content)){continue}a=y[i].children;p=0;for(r=a.length-1;r>=0;r--){s=a[r];if(s.type==="link_close"){r--;while(a[r].level!==s.level&&a[r].type!=="link_open"){r--}continue}if(s.type==="html_inline"){if(F(s.content)&&p>0){p--}if(b(s.content)){p++}}if(p>0){continue}if(s.type==="text"&&t.md.linkify.test(s.content)){d=s.content;g=t.md.linkify.match(d);l=[];h=s.level;f=0;for(u=0;u<g.length;u++){v=g[u].url;m=t.md.normalizeLink(v);if(!t.md.validateLink(m)){continue}_=g[u].text;if(!g[u].schema){_=t.md.normalizeLinkText("http://"+_).replace(/^http:\/\//,"")}else if(g[u].schema==="mailto:"&&!/^mailto:/i.test(_)){_=t.md.normalizeLinkText("mailto:"+_).replace(/^mailto:/,"")}else{_=t.md.normalizeLinkText(_)}c=g[u].index;if(c>f){o=new t.Token("text","",0);o.content=d.slice(f,c);o.level=h;l.push(o)}o=new t.Token("link_open","a",1);o.attrs=[["href",m]];o.level=h++;o.markup="linkify";o.info="auto";l.push(o);o=new t.Token("text","",0);o.content=_;o.level=h;l.push(o);o=new t.Token("link_close","a",-1);o.level=--h;o.markup="linkify";o.info="auto";l.push(o);f=g[u].lastIndex}if(f<d.length){o=new t.Token("text","",0);o.content=d.slice(f);o.level=h;l.push(o)}y[i].children=a=w(a,r,l)}}}}},function(e,t,r){"use strict";var n=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/;var i=/\((c|tm|r|p)\)/i;var a=/\((c|tm|r|p)\)/gi;var o={c:"©",r:"®",p:"§",tm:"™"};function s(e,t){return o[t.toLowerCase()]}function l(e){var t,r,i=0;for(t=e.length-1;t>=0;t--){r=e[t];if(r.type==="text"&&!i){r.content=r.content.replace(a,s)}if(r.type==="link_open"&&r.info==="auto"){i--}if(r.type==="link_close"&&r.info==="auto"){i++}}}function u(e){var t,r,i=0;for(t=e.length-1;t>=0;t--){r=e[t];if(r.type==="text"&&!i){if(n.test(r.content)){r.content=r.content.replace(/\+-/g,"±").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1—$2").replace(/(^|\s)--(\s|$)/gm,"$1–$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1–$2")}}if(r.type==="link_open"&&r.info==="auto"){i--}if(r.type==="link_close"&&r.info==="auto"){i++}}}e.exports=function e(t){var r;if(!t.md.options.typographer){return}for(r=t.tokens.length-1;r>=0;r--){if(t.tokens[r].type!=="inline"){continue}if(i.test(t.tokens[r].content)){l(t.tokens[r].children)}if(n.test(t.tokens[r].content)){u(t.tokens[r].children)}}}},function(e,t,r){"use strict";var C=r(9).isWhiteSpace;var x=r(9).isPunctChar;var P=r(9).isMdAsciiPunct;var i=/['"]/;var M=/['"]/g;var T="’";function E(e,t,r){return e.substr(0,t)+r+e.substr(t+1)}function n(e,t){var r,i,n,a,o,s,l,u,d,c,f,h,p,v,m,_,y,g,w,F,b;w=[];for(r=0;r<e.length;r++){i=e[r];l=e[r].level;for(y=w.length-1;y>=0;y--){if(w[y].level<=l){break}}w.length=y+1;if(i.type!=="text"){continue}n=i.content;o=0;s=n.length;e:while(o<s){M.lastIndex=o;a=M.exec(n);if(!a){break}m=_=true;o=a.index+1;g=a[0]==="'";d=32;if(a.index-1>=0){d=n.charCodeAt(a.index-1)}else{for(y=r-1;y>=0;y--){if(e[y].type!=="text"){continue}d=e[y].content.charCodeAt(e[y].content.length-1);break}}c=32;if(o<s){c=n.charCodeAt(o)}else{for(y=r+1;y<e.length;y++){if(e[y].type!=="text"){continue}c=e[y].content.charCodeAt(0);break}}f=P(d)||x(String.fromCharCode(d));h=P(c)||x(String.fromCharCode(c));p=C(d);v=C(c);if(v){m=false}else if(h){if(!(p||f)){m=false}}if(p){_=false}else if(f){if(!(v||h)){_=false}}if(c===34&&a[0]==='"'){if(d>=48&&d<=57){_=m=false}}if(m&&_){m=false;_=h}if(!m&&!_){if(g){i.content=E(i.content,a.index,T)}continue}if(_){for(y=w.length-1;y>=0;y--){u=w[y];if(w[y].level<l){break}if(u.single===g&&w[y].level===l){u=w[y];if(g){F=t.md.options.quotes[2];b=t.md.options.quotes[3]}else{F=t.md.options.quotes[0];b=t.md.options.quotes[1]}i.content=E(i.content,a.index,b);e[u.token].content=E(e[u.token].content,u.pos,F);o+=b.length-1;if(u.token===r){o+=F.length-1}n=i.content;s=n.length;w.length=y;continue e}}}if(m){w.push({token:r,pos:a.index,single:g,level:l})}else if(_&&g){i.content=E(i.content,a.index,T)}}}}e.exports=function e(t){var r;if(!t.md.options.typographer){return}for(r=t.tokens.length-1;r>=0;r--){if(t.tokens[r].type!=="inline"||!i.test(t.tokens[r].content)){continue}n(t.tokens[r].children,t)}}},function(e,t,r){"use strict";var i=r(177);function n(e,t,r){this.src=e;this.env=r;this.tokens=[];this.inlineMode=false;this.md=t}n.prototype.Token=i;e.exports=n},function(e,t,r){"use strict";var i=r(176);var n=[["table",r(629),["paragraph","reference"]],["code",r(630)],["fence",r(631),["paragraph","reference","blockquote","list"]],["blockquote",r(632),["paragraph","reference","list"]],["hr",r(633),["paragraph","reference","blockquote","list"]],["list",r(634),["paragraph","reference","blockquote"]],["reference",r(635)],["heading",r(636),["paragraph","reference","blockquote"]],["lheading",r(637)],["html_block",r(638),["paragraph","reference","blockquote"]],["paragraph",r(640)]];function a(){this.ruler=new i;for(var e=0;e<n.length;e++){this.ruler.push(n[e][0],n[e][1],{alt:(n[e][2]||[]).slice()})}}a.prototype.tokenize=function(e,t,r){var i,n,a=this.ruler.getRules(""),o=a.length,s=t,l=false,u=e.md.options.maxNesting;while(s<r){e.line=s=e.skipEmptyLines(s);if(s>=r){break}if(e.sCount[s]<e.blkIndent){break}if(e.level>=u){e.line=r;break}for(n=0;n<o;n++){i=a[n](e,s,r,false);if(i){break}}e.tight=!l;if(e.isEmpty(e.line-1)){l=true}s=e.line;if(s<r&&e.isEmpty(s)){l=true;s++;if(s<r&&e.parentType==="list"&&e.isEmpty(s)){break}e.line=s}}};a.prototype.parse=function(e,t,r,i){var n;if(!e){return}n=new this.State(e,t,r,i);this.tokenize(n,n.line,n.lineMax)};a.prototype.State=r(641);e.exports=a},function(e,t,r){"use strict";function _(e,t){var r=e.bMarks[t]+e.blkIndent,i=e.eMarks[t];return e.src.substr(r,i-r)}function y(e){var t=[],r=0,i=e.length,n,a=0,o=0,s=false,l=0;n=e.charCodeAt(r);while(r<i){if(n===96&&a%2===0){s=!s;l=r}else if(n===124&&a%2===0&&!s){t.push(e.substring(o,r));o=r+1}else if(n===92){a++}else{a=0}r++;if(r===i&&s){s=false;r=l+1}n=e.charCodeAt(r)}t.push(e.substring(o));return t}e.exports=function e(t,r,i,n){var a,o,s,l,u,d,c,f,h,p,v,m;if(r+2>i){return false}u=r+1;if(t.sCount[u]<t.blkIndent){return false}s=t.bMarks[u]+t.tShift[u];if(s>=t.eMarks[u]){return false}a=t.src.charCodeAt(s);if(a!==124&&a!==45&&a!==58){return false}o=_(t,r+1);if(!/^[-:| ]+$/.test(o)){return false}d=o.split("|");h=[];for(l=0;l<d.length;l++){p=d[l].trim();if(!p){if(l===0||l===d.length-1){continue}else{return false}}if(!/^:?-+:?$/.test(p)){return false}if(p.charCodeAt(p.length-1)===58){h.push(p.charCodeAt(0)===58?"center":"right")}else if(p.charCodeAt(0)===58){h.push("left")}else{h.push("")}}o=_(t,r).trim();if(o.indexOf("|")===-1){return false}d=y(o.replace(/^\||\|$/g,""));c=d.length;if(c>h.length){return false}if(n){return true}f=t.push("table_open","table",1);f.map=v=[r,0];f=t.push("thead_open","thead",1);f.map=[r,r+1];f=t.push("tr_open","tr",1);f.map=[r,r+1];for(l=0;l<d.length;l++){f=t.push("th_open","th",1);f.map=[r,r+1];if(h[l]){f.attrs=[["style","text-align:"+h[l]]]}f=t.push("inline","",0);f.content=d[l].trim();f.map=[r,r+1];f.children=[];f=t.push("th_close","th",-1)}f=t.push("tr_close","tr",-1);f=t.push("thead_close","thead",-1);f=t.push("tbody_open","tbody",1);f.map=m=[r+2,0];for(u=r+2;u<i;u++){if(t.sCount[u]<t.blkIndent){break}o=_(t,u);if(o.indexOf("|")===-1){break}d=y(o.replace(/^\||\|\s*$/g,""));f=t.push("tr_open","tr",1);for(l=0;l<c;l++){f=t.push("td_open","td",1);if(h[l]){f.attrs=[["style","text-align:"+h[l]]]}f=t.push("inline","",0);f.content=d[l]?d[l].trim():"";f.children=[];f=t.push("td_close","td",-1)}f=t.push("tr_close","tr",-1)}f=t.push("tbody_close","tbody",-1);f=t.push("table_close","table",-1);v[1]=m[1]=u;t.line=u;return true}},function(e,t,r){"use strict";e.exports=function e(t,r,i){var n,a,o,s=0;if(t.sCount[r]-t.blkIndent<4){return false}a=n=r+1;while(n<i){if(t.isEmpty(n)){s++;if(s>=2&&t.parentType==="list"){break}n++;continue}s=0;if(t.sCount[n]-t.blkIndent>=4){n++;a=n;continue}break}t.line=a;o=t.push("code_block","code",0);o.content=t.getLines(r,a,4+t.blkIndent,true);o.map=[r,t.line];return true}},function(e,t,r){"use strict";e.exports=function e(t,r,i,n){var a,o,s,l,u,d,c,f=false,h=t.bMarks[r]+t.tShift[r],p=t.eMarks[r];if(h+3>p){return false}a=t.src.charCodeAt(h);if(a!==126&&a!==96){return false}u=h;h=t.skipChars(h,a);o=h-u;if(o<3){return false}c=t.src.slice(u,h);s=t.src.slice(h,p);if(s.indexOf("`")>=0){return false}if(n){return true}l=r;for(;;){l++;if(l>=i){break}h=u=t.bMarks[l]+t.tShift[l];p=t.eMarks[l];if(h<p&&t.sCount[l]<t.blkIndent){break}if(t.src.charCodeAt(h)!==a){continue}if(t.sCount[l]-t.blkIndent>=4){continue}h=t.skipChars(h,a);if(h-u<o){continue}h=t.skipSpaces(h);if(h<p){continue}f=true;break}o=t.sCount[r];t.line=l+(f?1:0);d=t.push("fence","code",0);d.info=s;d.content=t.getLines(r+1,l,o,true);d.markup=c;d.map=[r,t.line];return true}},function(e,t,r){"use strict";var C=r(9).isSpace;e.exports=function e(t,r,i,n){var a,o,s,l,u,d,c,f,h,p,v,m,_,y,g,w,F=t.bMarks[r]+t.tShift[r],b=t.eMarks[r];if(t.src.charCodeAt(F++)!==62){return false}if(n){return true}if(t.src.charCodeAt(F)===32){F++}d=t.blkIndent;t.blkIndent=0;h=p=t.sCount[r]+F-(t.bMarks[r]+t.tShift[r]);u=[t.bMarks[r]];t.bMarks[r]=F;while(F<b){v=t.src.charCodeAt(F);if(C(v)){if(v===9){p+=4-p%4}else{p++}}else{break}F++}o=F>=b;l=[t.sCount[r]];t.sCount[r]=p-h;s=[t.tShift[r]];t.tShift[r]=F-t.bMarks[r];m=t.md.block.ruler.getRules("blockquote");for(a=r+1;a<i;a++){if(t.sCount[a]<d){break}F=t.bMarks[a]+t.tShift[a];b=t.eMarks[a];if(F>=b){break}if(t.src.charCodeAt(F++)===62){if(t.src.charCodeAt(F)===32){F++}h=p=t.sCount[a]+F-(t.bMarks[a]+t.tShift[a]);u.push(t.bMarks[a]);t.bMarks[a]=F;while(F<b){v=t.src.charCodeAt(F);if(C(v)){if(v===9){p+=4-p%4}else{p++}}else{break}F++}o=F>=b;l.push(t.sCount[a]);t.sCount[a]=p-h;s.push(t.tShift[a]);t.tShift[a]=F-t.bMarks[a];continue}if(o){break}w=false;for(y=0,g=m.length;y<g;y++){if(m[y](t,a,i,true)){w=true;break}}if(w){break}u.push(t.bMarks[a]);s.push(t.tShift[a]);l.push(t.sCount[a]);t.sCount[a]=-1}c=t.parentType;t.parentType="blockquote";_=t.push("blockquote_open","blockquote",1);_.markup=">";_.map=f=[r,0];t.md.block.tokenize(t,r,a);_=t.push("blockquote_close","blockquote",-1);_.markup=">";t.parentType=c;f[1]=t.line;for(y=0;y<s.length;y++){t.bMarks[y+r]=u[y];t.tShift[y+r]=s[y];t.sCount[y+r]=l[y]}t.blkIndent=d;return true}},function(e,t,r){"use strict";var c=r(9).isSpace;e.exports=function e(t,r,i,n){var a,o,s,l,u=t.bMarks[r]+t.tShift[r],d=t.eMarks[r];a=t.src.charCodeAt(u++);if(a!==42&&a!==45&&a!==95){return false}o=1;while(u<d){s=t.src.charCodeAt(u++);if(s!==a&&!c(s)){return false}if(s===a){o++}}if(o<3){return false}if(n){return true}t.line=r+1;l=t.push("hr","hr",0);l.map=[r,t.line];l.markup=Array(o+1).join(String.fromCharCode(a));return true}},function(e,t,r){"use strict";var I=r(9).isSpace;function R(e,t){var r,i,n,a;i=e.bMarks[t]+e.tShift[t];n=e.eMarks[t];r=e.src.charCodeAt(i++);if(r!==42&&r!==45&&r!==43){return-1}if(i<n){a=e.src.charCodeAt(i);if(!I(a)){return-1}}return i}function O(e,t){var r,i=e.bMarks[t]+e.tShift[t],n=i,a=e.eMarks[t];if(n+1>=a){return-1}r=e.src.charCodeAt(n++);if(r<48||r>57){return-1}for(;;){if(n>=a){return-1}r=e.src.charCodeAt(n++);if(r>=48&&r<=57){if(n-i>=10){return-1}continue}if(r===41||r===46){break}return-1}if(n<a){r=e.src.charCodeAt(n);if(!I(r)){return-1}}return n}function N(e,t){var r,i,n=e.level+2;for(r=t+2,i=e.tokens.length-2;r<i;r++){if(e.tokens[r].level===n&&e.tokens[r].type==="paragraph_open"){e.tokens[r+2].hidden=true;e.tokens[r].hidden=true;r+=2}}}e.exports=function e(t,r,i,n){var a,o,s,l,u,d,c,f,h,p,v,m,_,y,g,w,F,b,C,x,P,M,T,E=true,S,A,k,L,D;if((v=O(t,r))>=0){b=true}else if((v=R(t,r))>=0){b=false}else{return false}F=t.src.charCodeAt(v-1);if(n){return true}x=t.tokens.length;if(b){p=t.bMarks[r]+t.tShift[r];w=Number(t.src.substr(p,v-p-1));A=t.push("ordered_list_open","ol",1);if(w!==1){A.attrs=[["start",w]]}}else{A=t.push("bullet_list_open","ul",1)}A.map=M=[r,0];A.markup=String.fromCharCode(F);a=r;P=false;S=t.md.block.ruler.getRules("list");while(a<i){_=v;y=t.eMarks[a];o=s=t.sCount[a]+v-(t.bMarks[r]+t.tShift[r]);while(_<y){m=t.src.charCodeAt(_);if(I(m)){if(m===9){s+=4-s%4}else{s++}}else{break}_++}C=_;if(C>=y){g=1}else{g=s-o}if(g>4){g=1}l=o+g;A=t.push("list_item_open","li",1);A.markup=String.fromCharCode(F);A.map=T=[r,0];d=t.blkIndent;f=t.tight;u=t.tShift[r];c=t.sCount[r];h=t.parentType;t.blkIndent=l;t.tight=true;t.parentType="list";t.tShift[r]=C-t.bMarks[r];t.sCount[r]=s;if(C>=y&&t.isEmpty(r+1)){t.line=Math.min(t.line+2,i)}else{t.md.block.tokenize(t,r,i,true)}if(!t.tight||P){E=false}P=t.line-r>1&&t.isEmpty(t.line-1);t.blkIndent=d;t.tShift[r]=u;t.sCount[r]=c;t.tight=f;t.parentType=h;A=t.push("list_item_close","li",-1);A.markup=String.fromCharCode(F);a=r=t.line;T[1]=a;C=t.bMarks[r];if(a>=i){break}if(t.isEmpty(a)){break}if(t.sCount[a]<t.blkIndent){break}D=false;for(k=0,L=S.length;k<L;k++){if(S[k](t,a,i,true)){D=true;break}}if(D){break}if(b){v=O(t,a);if(v<0){break}}else{v=R(t,a);if(v<0){break}}if(F!==t.src.charCodeAt(v-1)){break}}if(b){A=t.push("ordered_list_close","ol",-1)}else{A=t.push("bullet_list_close","ul",-1)}A.markup=String.fromCharCode(F);M[1]=a;t.line=a;if(E){N(t,x)}return true}},function(e,t,r){"use strict";var x=r(122);var P=r(123);var M=r(9).normalizeReference;var T=r(9).isSpace;e.exports=function e(t,r,i,n){var a,o,s,l,u,d,c,f,h,p,v,m,_,y,g,w=0,F=t.bMarks[r]+t.tShift[r],b=t.eMarks[r],C=r+1;if(t.src.charCodeAt(F)!==91){return false}while(++F<b){if(t.src.charCodeAt(F)===93&&t.src.charCodeAt(F-1)!==92){if(F+1===b){return false}if(t.src.charCodeAt(F+1)!==58){return false}break}}l=t.lineMax;y=t.md.block.ruler.getRules("reference");for(;C<l&&!t.isEmpty(C);C++){if(t.sCount[C]-t.blkIndent>3){continue}if(t.sCount[C]<0){continue}_=false;for(d=0,c=y.length;d<c;d++){if(y[d](t,C,l,true)){_=true;break}}if(_){break}}m=t.getLines(r,C,t.blkIndent,false).trim();b=m.length;for(F=1;F<b;F++){a=m.charCodeAt(F);if(a===91){return false}else if(a===93){h=F;break}else if(a===10){w++}else if(a===92){F++;if(F<b&&m.charCodeAt(F)===10){w++}}}if(h<0||m.charCodeAt(h+1)!==58){return false}for(F=h+2;F<b;F++){a=m.charCodeAt(F);if(a===10){w++}else if(T(a)){}else{break}}p=x(m,F,b);if(!p.ok){return false}u=t.md.normalizeLink(p.str);if(!t.md.validateLink(u)){return false}F=p.pos;w+=p.lines;o=F;s=w;v=F;for(;F<b;F++){a=m.charCodeAt(F);if(a===10){w++}else if(T(a)){}else{break}}p=P(m,F,b);if(F<b&&v!==F&&p.ok){g=p.str;F=p.pos;w+=p.lines}else{g="";F=o;w=s}while(F<b){a=m.charCodeAt(F);if(!T(a)){break}F++}if(F<b&&m.charCodeAt(F)!==10){if(g){g="";F=o;w=s;while(F<b){a=m.charCodeAt(F);if(!T(a)){break}F++}}}if(F<b&&m.charCodeAt(F)!==10){return false}f=M(m.slice(1,h));if(!f){return false}if(n){return true}if(typeof t.env.references==="undefined"){t.env.references={}}if(typeof t.env.references[f]==="undefined"){t.env.references[f]={title:g,href:u}}t.line=r+w+1;return true}},function(e,t,r){"use strict";var c=r(9).isSpace;e.exports=function e(t,r,i,n){var a,o,s,l,u=t.bMarks[r]+t.tShift[r],d=t.eMarks[r];a=t.src.charCodeAt(u);if(a!==35||u>=d){return false}o=1;a=t.src.charCodeAt(++u);while(a===35&&u<d&&o<=6){o++;a=t.src.charCodeAt(++u)}if(o>6||u<d&&a!==32){return false}if(n){return true}d=t.skipSpacesBack(d,u);s=t.skipCharsBack(d,35,u);if(s>u&&c(t.src.charCodeAt(s-1))){d=s}t.line=r+1;l=t.push("heading_open","h"+String(o),1);l.markup="########".slice(0,o);l.map=[r,t.line];l=t.push("inline","",0);l.content=t.src.slice(u,d).trim();l.map=[r,t.line];l.children=[];l=t.push("heading_close","h"+String(o),-1);l.markup="########".slice(0,o);return true}},function(e,t,r){"use strict";e.exports=function e(t,r,i){var n,a,o,s,l,u,d,c,f,h=r+1,p=t.md.block.ruler.getRules("paragraph");for(;h<i&&!t.isEmpty(h);h++){if(t.sCount[h]-t.blkIndent>3){continue}if(t.sCount[h]>=t.blkIndent){u=t.bMarks[h]+t.tShift[h];d=t.eMarks[h];if(u<d){f=t.src.charCodeAt(u);if(f===45||f===61){u=t.skipChars(u,f);u=t.skipSpaces(u);if(u>=d){c=f===61?1:2;break}}}}if(t.sCount[h]<0){continue}a=false;for(o=0,s=p.length;o<s;o++){if(p[o](t,h,i,true)){a=true;break}}if(a){break}}if(!c){return false}n=t.getLines(r,h,t.blkIndent,false).trim();t.line=h+1;l=t.push("heading_open","h"+String(c),1);l.markup=String.fromCharCode(f);l.map=[r,t.line];l=t.push("inline","",0);l.content=n;l.map=[r,t.line-1];l.children=[];l=t.push("heading_close","h"+String(c),-1);l.markup=String.fromCharCode(f);return true}},function(e,t,r){"use strict";var i=r(639);var n=r(258).HTML_OPEN_CLOSE_TAG_RE;var c=[[/^<(script|pre|style)(?=(\s|>|$))/i,/<\/(script|pre|style)>/i,true],[/^<!--/,/-->/,true],[/^<\?/,/\?>/,true],[/^<![A-Z]/,/>/,true],[/^<!\[CDATA\[/,/\]\]>/,true],[new RegExp("^</?("+i.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,true],[new RegExp(n.source+"\\s*$"),/^$/,false]];e.exports=function e(t,r,i,n){var a,o,s,l,u=t.bMarks[r]+t.tShift[r],d=t.eMarks[r];if(!t.md.options.html){return false}if(t.src.charCodeAt(u)!==60){return false}l=t.src.slice(u,d);for(a=0;a<c.length;a++){if(c[a][0].test(l)){break}}if(a===c.length){return false}if(n){return c[a][2]}o=r+1;if(!c[a][1].test(l)){for(;o<i;o++){if(t.sCount[o]<t.blkIndent){break}u=t.bMarks[o]+t.tShift[o];d=t.eMarks[o];l=t.src.slice(u,d);if(c[a][1].test(l)){if(l.length!==0){o++}break}}}t.line=o;s=t.push("html_block","",0);s.map=[r,o];s.content=t.getLines(r,o,t.blkIndent,true);return true}},function(e,t,r){"use strict";e.exports=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","meta","nav","noframes","ol","optgroup","option","p","param","pre","section","source","title","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"]},function(e,t,r){"use strict";e.exports=function e(t,r){var i,n,a,o,s,l=r+1,u=t.md.block.ruler.getRules("paragraph"),d=t.lineMax;for(;l<d&&!t.isEmpty(l);l++){if(t.sCount[l]-t.blkIndent>3){continue}if(t.sCount[l]<0){continue}n=false;for(a=0,o=u.length;a<o;a++){if(u[a](t,l,d,true)){n=true;break}}if(n){break}}i=t.getLines(r,l,t.blkIndent,false).trim();t.line=l;s=t.push("paragraph_open","p",1);s.map=[r,t.line];s=t.push("inline","",0);s.content=i;s.map=[r,t.line];s.children=[];s=t.push("paragraph_close","p",-1);return true}},function(e,t,r){"use strict";var n=r(177);var h=r(9).isSpace;function i(e,t,r,i){var n,a,o,s,l,u,d,c;this.src=e;this.md=t;this.env=r;this.tokens=i;this.bMarks=[];this.eMarks=[];this.tShift=[];this.sCount=[];this.blkIndent=0;this.line=0;this.lineMax=0;this.tight=false;this.parentType="root";this.ddIndent=-1;this.level=0;this.result="";a=this.src;c=false;for(o=s=u=d=0,l=a.length;s<l;s++){n=a.charCodeAt(s);if(!c){if(h(n)){u++;if(n===9){d+=4-d%4}else{d++}continue}else{c=true}}if(n===10||s===l-1){if(n!==10){s++}this.bMarks.push(o);this.eMarks.push(s);this.tShift.push(u);this.sCount.push(d);c=false;u=0;d=0;o=s+1}}this.bMarks.push(a.length);this.eMarks.push(a.length);this.tShift.push(0);this.sCount.push(0);this.lineMax=this.bMarks.length-1}i.prototype.push=function(e,t,r){var i=new n(e,t,r);i.block=true;if(r<0){this.level--}i.level=this.level;if(r>0){this.level++}this.tokens.push(i);return i};i.prototype.isEmpty=function e(t){return this.bMarks[t]+this.tShift[t]>=this.eMarks[t]};i.prototype.skipEmptyLines=function e(t){for(var r=this.lineMax;t<r;t++){if(this.bMarks[t]+this.tShift[t]<this.eMarks[t]){break}}return t};i.prototype.skipSpaces=function e(t){var r;for(var i=this.src.length;t<i;t++){r=this.src.charCodeAt(t);if(!h(r)){break}}return t};i.prototype.skipSpacesBack=function e(t,r){if(t<=r){return t}while(t>r){if(!h(this.src.charCodeAt(--t))){return t+1}}return t};i.prototype.skipChars=function e(t,r){for(var i=this.src.length;t<i;t++){if(this.src.charCodeAt(t)!==r){break}}return t};i.prototype.skipCharsBack=function e(t,r,i){if(t<=i){return t}while(t>i){if(r!==this.src.charCodeAt(--t)){return t+1}}return t};i.prototype.getLines=function e(t,r,i,n){var a,o,s,l,u,d,c,f=t;if(t>=r){return""}d=new Array(r-t);for(a=0;f<r;f++,a++){o=0;c=l=this.bMarks[f];if(f+1<r||n){u=this.eMarks[f]+1}else{u=this.eMarks[f]}while(l<u&&o<i){s=this.src.charCodeAt(l);if(h(s)){if(s===9){o+=4-o%4}else{o++}}else if(l-c<this.tShift[f]){o++}else{break}l++}d[a]=this.src.slice(l,u)}return d.join("")};i.prototype.Token=n;e.exports=i},function(e,t,r){"use strict";var i=r(176);var n=[["text",r(643)],["newline",r(644)],["escape",r(645)],["backticks",r(646)],["strikethrough",r(259).tokenize],["emphasis",r(260).tokenize],["link",r(647)],["image",r(648)],["autolink",r(649)],["html_inline",r(650)],["entity",r(651)]];var a=[["balance_pairs",r(652)],["strikethrough",r(259).postProcess],["emphasis",r(260).postProcess],["text_collapse",r(653)]];function o(){var e;this.ruler=new i;for(e=0;e<n.length;e++){this.ruler.push(n[e][0],n[e][1])}this.ruler2=new i;for(e=0;e<a.length;e++){this.ruler2.push(a[e][0],a[e][1])}}o.prototype.skipToken=function(e){var t,r,i=e.pos,n=this.ruler.getRules(""),a=n.length,o=e.md.options.maxNesting,s=e.cache;if(typeof s[i]!=="undefined"){e.pos=s[i];return}if(e.level<o){for(r=0;r<a;r++){e.level++;t=n[r](e,true);e.level--;if(t){break}}}else{e.pos=e.posMax}if(!t){e.pos++}s[i]=e.pos};o.prototype.tokenize=function(e){var t,r,i=this.ruler.getRules(""),n=i.length,a=e.posMax,o=e.md.options.maxNesting;while(e.pos<a){if(e.level<o){for(r=0;r<n;r++){t=i[r](e,false);if(t){break}}}if(t){if(e.pos>=a){break}continue}e.pending+=e.src[e.pos++]}if(e.pending){e.pushPending()}};o.prototype.parse=function(e,t,r,i){var n,a,o;var s=new this.State(e,t,r,i);this.tokenize(s);a=this.ruler2.getRules("");o=a.length;for(n=0;n<o;n++){a[n](s)}};o.prototype.State=r(654);e.exports=o},function(e,t,r){"use strict";function n(e){switch(e){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return true;default:return false}}e.exports=function e(t,r){var i=t.pos;while(i<t.posMax&&!n(t.src.charCodeAt(i))){i++}if(i===t.pos){return false}if(!r){t.pending+=t.src.slice(t.pos,i)}t.pos=i;return true}},function(e,t,r){"use strict";e.exports=function e(t,r){var i,n,a=t.pos;if(t.src.charCodeAt(a)!==10){return false}i=t.pending.length-1;n=t.posMax;if(!r){if(i>=0&&t.pending.charCodeAt(i)===32){if(i>=1&&t.pending.charCodeAt(i-1)===32){t.pending=t.pending.replace(/ +$/,"");t.push("hardbreak","br",0)}else{t.pending=t.pending.slice(0,-1);t.push("softbreak","br",0)}}else{t.push("softbreak","br",0)}}a++;while(a<n&&t.src.charCodeAt(a)===32){a++}t.pos=a;return true}},function(e,t,r){"use strict";var o=r(9).isSpace;var s=[];for(var i=0;i<256;i++){s.push(0)}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(e){s[e.charCodeAt(0)]=1});e.exports=function e(t,r){var i,n=t.pos,a=t.posMax;if(t.src.charCodeAt(n)!==92){return false}n++;if(n<a){i=t.src.charCodeAt(n);if(i<256&&s[i]!==0){if(!r){t.pending+=t.src[n]}t.pos+=2;return true}if(i===10){if(!r){t.push("hardbreak","br",0)}n++;while(n<a){i=t.src.charCodeAt(n);if(!o(i)){break}n++}t.pos=n;return true}}if(!r){t.pending+="\\"}t.pos++;return true}},function(e,t,r){"use strict";e.exports=function e(t,r){var i,n,a,o,s,l,u=t.pos,d=t.src.charCodeAt(u);if(d!==96){return false}i=u;u++;n=t.posMax;while(u<n&&t.src.charCodeAt(u)===96){u++}a=t.src.slice(i,u);o=s=u;while((o=t.src.indexOf("`",s))!==-1){s=o+1;while(s<n&&t.src.charCodeAt(s)===96){s++}if(s-o===a.length){if(!r){l=t.push("code_inline","code",0);l.markup=a;l.content=t.src.slice(u,o).replace(/[ \n]+/g," ").trim()}t.pos=s;return true}}if(!r){t.pending+=a}t.pos+=a.length;return true}},function(e,t,r){"use strict";var _=r(175);var y=r(122);var g=r(123);var w=r(9).normalizeReference;var F=r(9).isSpace;e.exports=function e(t,r){var i,n,a,o,s,l,u,d,c,f,h="",p=t.pos,v=t.posMax,m=t.pos;if(t.src.charCodeAt(t.pos)!==91){return false}s=t.pos+1;o=_(t,t.pos,true);if(o<0){return false}l=o+1;if(l<v&&t.src.charCodeAt(l)===40){l++;for(;l<v;l++){n=t.src.charCodeAt(l);if(!F(n)&&n!==10){break}}if(l>=v){return false}m=l;u=y(t.src,l,t.posMax);if(u.ok){h=t.md.normalizeLink(u.str);if(t.md.validateLink(h)){l=u.pos}else{h=""}}m=l;for(;l<v;l++){n=t.src.charCodeAt(l);if(!F(n)&&n!==10){break}}u=g(t.src,l,t.posMax);if(l<v&&m!==l&&u.ok){c=u.str;l=u.pos;for(;l<v;l++){n=t.src.charCodeAt(l);if(!F(n)&&n!==10){break}}}else{c=""}if(l>=v||t.src.charCodeAt(l)!==41){t.pos=p;return false}l++}else{if(typeof t.env.references==="undefined"){return false}if(l<v&&t.src.charCodeAt(l)===91){m=l+1;l=_(t,l);if(l>=0){a=t.src.slice(m,l++)}else{l=o+1}}else{l=o+1}if(!a){a=t.src.slice(s,o)}d=t.env.references[w(a)];if(!d){t.pos=p;return false}h=d.href;c=d.title}if(!r){t.pos=s;t.posMax=o;f=t.push("link_open","a",1);f.attrs=i=[["href",h]];if(c){i.push(["title",c])}t.md.inline.tokenize(t);f=t.push("link_close","a",-1)}t.pos=l;t.posMax=v;return true}},function(e,t,r){"use strict";var g=r(175);var w=r(122);var F=r(123);var b=r(9).normalizeReference;var C=r(9).isSpace;e.exports=function e(t,r){var i,n,a,o,s,l,u,d,c,f,h,p,v,m="",_=t.pos,y=t.posMax;if(t.src.charCodeAt(t.pos)!==33){return false}if(t.src.charCodeAt(t.pos+1)!==91){return false}l=t.pos+2;s=g(t,t.pos+1,false);if(s<0){return false}u=s+1;if(u<y&&t.src.charCodeAt(u)===40){u++;for(;u<y;u++){n=t.src.charCodeAt(u);if(!C(n)&&n!==10){break}}if(u>=y){return false}v=u;c=w(t.src,u,t.posMax);if(c.ok){m=t.md.normalizeLink(c.str);if(t.md.validateLink(m)){u=c.pos}else{m=""}}v=u;for(;u<y;u++){n=t.src.charCodeAt(u);if(!C(n)&&n!==10){break}}c=F(t.src,u,t.posMax);if(u<y&&v!==u&&c.ok){f=c.str;u=c.pos;for(;u<y;u++){n=t.src.charCodeAt(u);if(!C(n)&&n!==10){break}}}else{f=""}if(u>=y||t.src.charCodeAt(u)!==41){t.pos=_;return false}u++}else{if(typeof t.env.references==="undefined"){return false}if(u<y&&t.src.charCodeAt(u)===91){v=u+1;u=g(t,u);if(u>=0){o=t.src.slice(v,u++)}else{u=s+1}}else{u=s+1}if(!o){o=t.src.slice(l,s)}d=t.env.references[b(o)];if(!d){t.pos=_;return false}m=d.href;f=d.title}if(!r){a=t.src.slice(l,s);t.md.inline.parse(a,t.md,t.env,p=[]);h=t.push("image","img",0);h.attrs=i=[["src",m],["alt",""]];h.children=p;h.content=a;if(f){i.push(["title",f])}}t.pos=u;t.posMax=y;return true}},function(e,t,r){"use strict";var d=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/;var c=/^<([a-zA-Z][a-zA-Z0-9+.\-]{1,31}):([^<>\x00-\x20]*)>/;e.exports=function e(t,r){var i,n,a,o,s,l,u=t.pos;if(t.src.charCodeAt(u)!==60){return false}i=t.src.slice(u);if(i.indexOf(">")<0){return false}if(c.test(i)){n=i.match(c);o=n[0].slice(1,-1);s=t.md.normalizeLink(o);if(!t.md.validateLink(s)){return false}if(!r){l=t.push("link_open","a",1);l.attrs=[["href",s]];l.markup="autolink";l.info="auto";l=t.push("text","",0);l.content=t.md.normalizeLinkText(o);l=t.push("link_close","a",-1);l.markup="autolink";l.info="auto"}t.pos+=n[0].length;return true}if(d.test(i)){a=i.match(d);o=a[0].slice(1,-1);s=t.md.normalizeLink("mailto:"+o);if(!t.md.validateLink(s)){return false}if(!r){l=t.push("link_open","a",1);l.attrs=[["href",s]];l.markup="autolink";l.info="auto";l=t.push("text","",0);l.content=t.md.normalizeLinkText(o);l=t.push("link_close","a",-1);l.markup="autolink";l.info="auto"}t.pos+=a[0].length;return true}return false}},function(e,t,r){"use strict";var l=r(258).HTML_TAG_RE;function u(e){var t=e|32;return t>=97&&t<=122}e.exports=function e(t,r){var i,n,a,o,s=t.pos;if(!t.md.options.html){return false}a=t.posMax;if(t.src.charCodeAt(s)!==60||s+2>=a){return false}i=t.src.charCodeAt(s+1);if(i!==33&&i!==63&&i!==47&&!u(i)){return false}n=t.src.slice(s).match(l);if(!n){return false}if(!r){o=t.push("html_inline","",0);o.content=t.src.slice(s,s+n[0].length)}t.pos+=n[0].length;return true}},function(e,t,r){"use strict";var l=r(253);var u=r(9).has;var d=r(9).isValidEntityCode;var c=r(9).fromCodePoint;var f=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i;var h=/^&([a-z][a-z0-9]{1,31});/i;e.exports=function e(t,r){var i,n,a,o=t.pos,s=t.posMax;if(t.src.charCodeAt(o)!==38){return false}if(o+1<s){i=t.src.charCodeAt(o+1);if(i===35){a=t.src.slice(o).match(f);if(a){if(!r){n=a[1][0].toLowerCase()==="x"?parseInt(a[1].slice(1),16):parseInt(a[1],10);t.pending+=d(n)?c(n):c(65533)}t.pos+=a[0].length;return true}}else{a=t.src.slice(o).match(h);if(a){if(u(l,a[1])){if(!r){t.pending+=l[a[1]]}t.pos+=a[0].length;return true}}}}if(!r){t.pending+="&"}t.pos++;return true}},function(e,t,r){"use strict";e.exports=function e(t){var r,i,n,a,o=t.delimiters,s=t.delimiters.length;for(r=0;r<s;r++){n=o[r];if(!n.close){continue}i=r-n.jump-1;while(i>=0){a=o[i];if(a.open&&a.marker===n.marker&&a.end<0&&a.level===n.level){n.jump=r-i;n.open=false;a.end=r;a.jump=0;break}i-=a.jump+1}}}},function(e,t,r){"use strict";e.exports=function e(t){var r,i,n=0,a=t.tokens,o=t.tokens.length;for(r=i=0;r<o;r++){n+=a[r].nesting;a[r].level=n;if(a[r].type==="text"&&r+1<o&&a[r+1].type==="text"){a[r+1].content=a[r].content+a[r+1].content}else{if(r!==i){a[i]=a[r]}i++}}if(r!==i){a.length=i}}},function(e,t,r){"use strict";var n=r(177);var m=r(9).isWhiteSpace;var _=r(9).isPunctChar;var y=r(9).isMdAsciiPunct;function i(e,t,r,i){this.src=e;this.env=r;this.md=t;this.tokens=i;this.pos=0;this.posMax=this.src.length;this.level=0;this.pending="";this.pendingLevel=0;this.cache={};this.delimiters=[]}i.prototype.pushPending=function(){var e=new n("text","",0);e.content=this.pending;e.level=this.pendingLevel;this.tokens.push(e);this.pending="";return e};i.prototype.push=function(e,t,r){if(this.pending){this.pushPending()}var i=new n(e,t,r);if(r<0){this.level--}i.level=this.level;if(r>0){this.level++}this.pendingLevel=this.level;this.tokens.push(i);return i};i.prototype.scanDelims=function(e,t){var r=e,i,n,a,o,s,l,u,d,c,f=true,h=true,p=this.posMax,v=this.src.charCodeAt(e);i=e>0?this.src.charCodeAt(e-1):32;while(r<p&&this.src.charCodeAt(r)===v){r++}a=r-e;n=r<p?this.src.charCodeAt(r):32;u=y(i)||_(String.fromCharCode(i));c=y(n)||_(String.fromCharCode(n));l=m(i);d=m(n);if(d){f=false}else if(c){if(!(l||u)){f=false}}if(l){h=false}else if(u){if(!(d||c)){h=false}}if(!t){o=f&&(!h||u);s=h&&(!f||c)}else{o=f;s=h}return{can_open:o,can_close:s,length:a}};i.prototype.Token=n;e.exports=i},function(e,t,s){"use strict";function r(r){var e=Array.prototype.slice.call(arguments,1);e.forEach(function(t){if(!t){return}Object.keys(t).forEach(function(e){r[e]=t[e]})});return r}function i(e){return Object.prototype.toString.call(e)}function l(e){return i(e)==="[object String]"}function u(e){return i(e)==="[object Object]"}function d(e){return i(e)==="[object RegExp]"}function c(e){return i(e)==="[object Function]"}function f(e){return e.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var n={fuzzyLink:true,fuzzyEmail:true,fuzzyIP:false};function a(e){return Object.keys(e||{}).reduce(function(e,t){return e||n.hasOwnProperty(t)},false)}var o={"http:":{validate:function(e,t,r){var i=e.slice(t);if(!r.re.http){r.re.http=new RegExp("^\\/\\/"+r.re.src_auth+r.re.src_host_port_strict+r.re.src_path,"i")}if(r.re.http.test(i)){return i.match(r.re.http)[0].length}return 0}},"https:":"http:","ftp:":"http:","//":{validate:function(e,t,r){var i=e.slice(t);if(!r.re.no_http){r.re.no_http=new RegExp("^"+r.re.src_auth+"(?:localhost|(?:(?:"+r.re.src_domain+")\\.)+"+r.re.src_domain_root+")"+r.re.src_port+r.re.src_host_terminator+r.re.src_path,"i")}if(r.re.no_http.test(i)){if(t>=3&&e[t-3]===":"){return 0}if(t>=3&&e[t-3]==="/"){return 0}return i.match(r.re.no_http)[0].length}return 0}},"mailto:":{validate:function(e,t,r){var i=e.slice(t);if(!r.re.mailto){r.re.mailto=new RegExp("^"+r.re.src_email_name+"@"+r.re.src_host_strict,"i")}if(r.re.mailto.test(i)){return i.match(r.re.mailto)[0].length}return 0}}};var h="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]";var p="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function v(e){e.__index__=-1;e.__text_cache__=""}function m(i){return function(e,t){var r=e.slice(t);if(i.test(r)){return r.match(i)[0].length}return 0}}function _(){return function(e,t){t.normalize(e)}}function y(i){var t=i.re=s(656)(i.__opts__);var e=i.__tlds__.slice();i.onCompile();if(!i.__tlds_replaced__){e.push(h)}e.push(t.src_xn);t.src_tlds=e.join("|");function r(e){return e.replace("%TLDS%",t.src_tlds)}t.email_fuzzy=RegExp(r(t.tpl_email_fuzzy),"i");t.link_fuzzy=RegExp(r(t.tpl_link_fuzzy),"i");t.link_no_ip_fuzzy=RegExp(r(t.tpl_link_no_ip_fuzzy),"i");t.host_fuzzy_test=RegExp(r(t.tpl_host_fuzzy_test),"i");var n=[];i.__compiled__={};function a(e,t){throw new Error('(LinkifyIt) Invalid schema "'+e+'": '+t)}Object.keys(i.__schemas__).forEach(function(e){var t=i.__schemas__[e];if(t===null){return}var r={validate:null,link:null};i.__compiled__[e]=r;if(u(t)){if(d(t.validate)){r.validate=m(t.validate)}else if(c(t.validate)){r.validate=t.validate}else{a(e,t)}if(c(t.normalize)){r.normalize=t.normalize}else if(!t.normalize){r.normalize=_()}else{a(e,t)}return}if(l(t)){n.push(e);return}a(e,t)});n.forEach(function(e){if(!i.__compiled__[i.__schemas__[e]]){return}i.__compiled__[e].validate=i.__compiled__[i.__schemas__[e]].validate;i.__compiled__[e].normalize=i.__compiled__[i.__schemas__[e]].normalize});i.__compiled__[""]={validate:null,normalize:_()};var o=Object.keys(i.__compiled__).filter(function(e){return e.length>0&&i.__compiled__[e]}).map(f).join("|");i.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+t.src_ZPCc+"))("+o+")","i");i.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+t.src_ZPCc+"))("+o+")","ig");i.re.pretest=RegExp("("+i.re.schema_test.source+")|("+i.re.host_fuzzy_test.source+")|@","i");v(i)}function g(e,t){var r=e.__index__,i=e.__last_index__,n=e.__text_cache__.slice(r,i);this.schema=e.__schema__.toLowerCase();this.index=r+t;this.lastIndex=i+t;this.raw=n;this.text=n;this.url=n}function w(e,t){var r=new g(e,t);e.__compiled__[r.schema].normalize(r,e);return r}function F(e,t){if(!(this instanceof F)){return new F(e,t)}if(!t){if(a(e)){t=e;e={}}}this.__opts__=r({},n,t);this.__index__=-1;this.__last_index__=-1;this.__schema__="";this.__text_cache__="";this.__schemas__=r({},o,e);this.__compiled__={};this.__tlds__=p;this.__tlds_replaced__=false;this.re={};y(this)}F.prototype.add=function e(t,r){this.__schemas__[t]=r;y(this);return this};F.prototype.set=function e(t){this.__opts__=r(this.__opts__,t);return this};F.prototype.test=function e(t){this.__text_cache__=t;this.__index__=-1;if(!t.length){return false}var r,i,n,a,o,s,l,u,d;if(this.re.schema_test.test(t)){l=this.re.schema_search;l.lastIndex=0;while((r=l.exec(t))!==null){a=this.testSchemaAt(t,r[2],l.lastIndex);if(a){this.__schema__=r[2];this.__index__=r.index+r[1].length;this.__last_index__=r.index+r[0].length+a;break}}}if(this.__opts__.fuzzyLink&&this.__compiled__["http:"]){u=t.search(this.re.host_fuzzy_test);if(u>=0){if(this.__index__<0||u<this.__index__){if((i=t.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null){o=i.index+i[1].length;if(this.__index__<0||o<this.__index__){this.__schema__="";this.__index__=o;this.__last_index__=i.index+i[0].length}}}}}if(this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]){d=t.indexOf("@");if(d>=0){if((n=t.match(this.re.email_fuzzy))!==null){o=n.index+n[1].length;s=n.index+n[0].length;if(this.__index__<0||o<this.__index__||o===this.__index__&&s>this.__last_index__){this.__schema__="mailto:";this.__index__=o;this.__last_index__=s}}}}return this.__index__>=0};F.prototype.pretest=function e(t){return this.re.pretest.test(t)};F.prototype.testSchemaAt=function e(t,r,i){if(!this.__compiled__[r.toLowerCase()]){return 0}return this.__compiled__[r.toLowerCase()].validate(t,i,this)};F.prototype.match=function e(t){var r=0,i=[];if(this.__index__>=0&&this.__text_cache__===t){i.push(w(this,r));r=this.__last_index__}var n=r?t.slice(r):t;while(this.test(n)){i.push(w(this,r));n=n.slice(this.__last_index__);r+=this.__last_index__}if(i.length){return i}return null};F.prototype.tlds=function e(t,r){t=Array.isArray(t)?t:[t];if(!r){this.__tlds__=t.slice();this.__tlds_replaced__=true;y(this);return this}this.__tlds__=this.__tlds__.concat(t).sort().filter(function(e,t,r){return e!==r[t-1]}).reverse();y(this);return this};F.prototype.normalize=function e(t){if(!t.schema){t.url="http://"+t.url}if(t.schema==="mailto:"&&!/^mailto:/i.test(t.url)){t.url="mailto:"+t.url}};F.prototype.onCompile=function e(){};e.exports=F},function(e,t,i){"use strict";e.exports=function(e){var t={};t.src_Any=i(255).source;t.src_Cc=i(256).source;t.src_Z=i(257).source;t.src_P=i(174).source;t.src_ZPCc=[t.src_Z,t.src_P,t.src_Cc].join("|");t.src_ZCc=[t.src_Z,t.src_Cc].join("|");var r="[><｜]";t.src_pseudo_letter="(?:(?!"+r+"|"+t.src_ZPCc+")"+t.src_Any+")";t.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)";t.src_auth="(?:(?:(?!"+t.src_ZCc+"|[@/\\[\\]()]).)+@)?";t.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?";t.src_host_terminator="(?=$|"+r+"|"+t.src_ZPCc+")(?!-|_|:\\d|\\.-|\\.(?!$|"+t.src_ZPCc+"))";t.src_path="(?:"+"[/?#]"+"(?:"+"(?!"+t.src_ZCc+"|"+r+"|[()[\\]{}.,\"'?!\\-]).|"+"\\[(?:(?!"+t.src_ZCc+"|\\]).)*\\]|"+"\\((?:(?!"+t.src_ZCc+"|[)]).)*\\)|"+"\\{(?:(?!"+t.src_ZCc+"|[}]).)*\\}|"+'\\"(?:(?!'+t.src_ZCc+'|["]).)+\\"|'+"\\'(?:(?!"+t.src_ZCc+"|[']).)+\\'|"+"\\'(?="+t.src_pseudo_letter+"|[-]).|"+"\\.{2,3}[a-zA-Z0-9%/]|"+"\\.(?!"+t.src_ZCc+"|[.]).|"+(e&&e["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+"\\,(?!"+t.src_ZCc+").|"+"\\!(?!"+t.src_ZCc+"|[!]).|"+"\\?(?!"+t.src_ZCc+"|[?])."+")+"+"|\\/"+")?";t.src_email_name='[\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]+';t.src_xn="xn--[a-z0-9\\-]{1,59}";t.src_domain_root="(?:"+t.src_xn+"|"+t.src_pseudo_letter+"{1,63}"+")";t.src_domain="(?:"+t.src_xn+"|"+"(?:"+t.src_pseudo_letter+")"+"|"+"(?:"+t.src_pseudo_letter+"(?:-|"+t.src_pseudo_letter+"){0,61}"+t.src_pseudo_letter+")"+")";t.src_host="(?:"+"(?:(?:(?:"+t.src_domain+")\\.)*"+t.src_domain+")"+")";t.tpl_host_fuzzy="(?:"+t.src_ip4+"|"+"(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))"+")";t.tpl_host_no_ip_fuzzy="(?:(?:(?:"+t.src_domain+")\\.)+(?:%TLDS%))";t.src_host_strict=t.src_host+t.src_host_terminator;t.tpl_host_fuzzy_strict=t.tpl_host_fuzzy+t.src_host_terminator;t.src_host_port_strict=t.src_host+t.src_port+t.src_host_terminator;t.tpl_host_port_fuzzy_strict=t.tpl_host_fuzzy+t.src_port+t.src_host_terminator;t.tpl_host_port_no_ip_fuzzy_strict=t.tpl_host_no_ip_fuzzy+t.src_port+t.src_host_terminator;t.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+t.src_ZPCc+"|>|$))";t.tpl_email_fuzzy="(^|"+r+"|\\(|"+t.src_ZCc+")("+t.src_email_name+"@"+t.tpl_host_fuzzy_strict+")";t.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+t.src_ZPCc+"))"+"((?![$+<=>^`|｜])"+t.tpl_host_port_fuzzy_strict+t.src_path+")";t.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+t.src_ZPCc+"))"+"((?![$+<=>^`|｜])"+t.tpl_host_port_no_ip_fuzzy_strict+t.src_path+")";return t}},function(e,N,B){(function(I,R){var O;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(e){var t=true&&N&&!N.nodeType&&N;var r=true&&I&&!I.nodeType&&I;var i=typeof R=="object"&&R;if(i.global===i||i.window===i||i.self===i){e=i}var n,_=2147483647,y=36,g=1,w=26,a=38,o=700,F=72,b=128,C="-",s=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=y-g,x=Math.floor,P=String.fromCharCode,f;function M(e){throw new RangeError(d[e])}function h(e,t){var r=e.length;var i=[];while(r--){i[r]=t(e[r])}return i}function p(e,t){var r=e.split("@");var i="";if(r.length>1){i=r[0]+"@";e=r[1]}e=e.replace(u,".");var n=e.split(".");var a=h(n,t).join(".");return i+a}function T(e){var t=[],r=0,i=e.length,n,a;while(r<i){n=e.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){a=e.charCodeAt(r++);if((a&64512)==56320){t.push(((n&1023)<<10)+(a&1023)+65536)}else{t.push(n);r--}}else{t.push(n)}}return t}function m(e){return h(e,function(e){var t="";if(e>65535){e-=65536;t+=P(e>>>10&1023|55296);e=56320|e&1023}t+=P(e);return t}).join("")}function E(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return y}function S(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function A(e,t,r){var i=0;e=r?x(e/o):e>>1;e+=x(e/t);for(;e>c*w>>1;i+=y){e=x(e/c)}return x(i+(c+1)*e/(e+a))}function v(e){var t=[],r=e.length,i,n=0,a=b,o=F,s,l,u,d,c,f,h,p,v;s=e.lastIndexOf(C);if(s<0){s=0}for(l=0;l<s;++l){if(e.charCodeAt(l)>=128){M("not-basic")}t.push(e.charCodeAt(l))}for(u=s>0?s+1:0;u<r;){for(d=n,c=1,f=y;;f+=y){if(u>=r){M("invalid-input")}h=E(e.charCodeAt(u++));if(h>=y||h>x((_-n)/c)){M("overflow")}n+=h*c;p=f<=o?g:f>=o+w?w:f-o;if(h<p){break}v=y-p;if(c>x(_/v)){M("overflow")}c*=v}i=t.length+1;o=A(n-d,i,d==0);if(x(n/i)>_-a){M("overflow")}a+=x(n/i);n%=i;t.splice(n++,0,a)}return m(t)}function k(e){var t,r,i,n,a,o,s,l,u,d,c,f=[],h,p,v,m;e=T(e);h=e.length;t=b;r=0;a=F;for(o=0;o<h;++o){c=e[o];if(c<128){f.push(P(c))}}i=n=f.length;if(n){f.push(C)}while(i<h){for(s=_,o=0;o<h;++o){c=e[o];if(c>=t&&c<s){s=c}}p=i+1;if(s-t>x((_-r)/p)){M("overflow")}r+=(s-t)*p;t=s;for(o=0;o<h;++o){c=e[o];if(c<t&&++r>_){M("overflow")}if(c==t){for(l=r,u=y;;u+=y){d=u<=a?g:u>=a+w?w:u-a;if(l<d){break}m=l-d;v=y-d;f.push(P(S(d+m%v,0)));l=x(m/v)}f.push(P(S(l,0)));a=A(r,p,i==n);r=0;++i}}++r;++t}return f.join("")}function L(e){return p(e,function(e){return s.test(e)?v(e.slice(4).toLowerCase()):e})}function D(e){return p(e,function(e){return l.test(e)?"xn--"+k(e):e})}n={version:"1.4.1",ucs2:{decode:T,encode:m},decode:v,encode:k,toASCII:D,toUnicode:L};if(true){!(O=function(){return n}.call(N,B,N,I),O!==undefined&&(I.exports=O))}else{}})(this)}).call(this,B(658)(e),B(73))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){e.deprecate=function(){};e.paths=[];if(!e.children)e.children=[];Object.defineProperty(e,"loaded",{enumerable:true,get:function(){return e.l}});Object.defineProperty(e,"id",{enumerable:true,get:function(){return e.i}});e.webpackPolyfill=1}return e}},function(e,t,r){"use strict";e.exports={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}}},function(e,t,r){"use strict";e.exports={options:{html:false,xhtmlOut:false,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","text_collapse"]}}}},function(e,t,r){"use strict";e.exports={options:{html:true,xhtmlOut:true,breaks:false,langPrefix:"language-",linkify:false,typographer:false,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","text_collapse"]}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=t.KnockoutHammerBinding=function(e,l){"use strict";var t={register:function e(s){s.bindingHandlers.swipeLeft={init:function e(t,r,i,n,a){var o=s.unwrap(r());new l(t).on("swipeleft",function(e){var t=a.$data;o.apply(t,arguments)})}};s.bindingHandlers.swipeRight={init:function e(t,r,i,n,a){var o=s.unwrap(r());new l(t).on("swiperight",function(e){var t=a.$data;o.apply(t,arguments)})}}}};return t}(r(71),r(665))},function(t,r,i){var n,a,o;
/*!
 * Knockout JavaScript library v3.4.2
 * (c) The Knockout.js team - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
/*!
 * Knockout JavaScript library v3.4.2
 * (c) The Knockout.js team - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(){var R=true;(function(k){var E=this||(0,eval)("this"),S=E["document"],L=E["navigator"],D=E["jQuery"],I=E["JSON"];(function(e){if(true){!(a=[r,i],n=e,o=typeof n==="function"?n.apply(r,a):n,o!==k&&(t.exports=o))}else{}})(function(e,h){var A=typeof e!=="undefined"?e:{};A.exportSymbol=function(e,t){var r=e.split(".");var i=A;for(var n=0;n<r.length-1;n++)i=i[r[n]];i[r[r.length-1]]=t};A.exportProperty=function(e,t,r){e[t]=r};A.version="3.4.2";A.exportSymbol("version",A.version);A.options={deferUpdates:false,useOnlyNativeEvents:false};A.utils=function(){function h(e,t){for(var r in e){if(e.hasOwnProperty(r)){t(r,e[r])}}}function e(e,t){if(t){for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}}return e}function t(e,t){e.__proto__=t;return e}var r={__proto__:[]}instanceof Array;var i=!R&&typeof Symbol==="function";var n={},a={};var o=L&&/Firefox\/2/i.test(L.userAgent)?"KeyboardEvent":"UIEvents";n[o]=["keyup","keydown","keypress"];n["MouseEvents"]=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];h(n,function(e,t){if(t.length){for(var r=0,i=t.length;r<i;r++)a[t[r]]=e}});var s={propertychange:true};var l=S&&function(){var e=3,t=S.createElement("div"),r=t.getElementsByTagName("i");while(t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",r[0]){}return e>4?e:k}();var u=l===6,d=l===7;function c(e,t){if(A.utils.tagNameLower(e)!=="input"||!e.type)return false;if(t.toLowerCase()!="click")return false;var r=e.type;return r=="checkbox"||r=="radio"}var f=/\S+/g;function p(t,e,r){var i;if(e){if(typeof t.classList==="object"){i=t.classList[r?"add":"remove"];A.utils.arrayForEach(e.match(f),function(e){i.call(t.classList,e)})}else if(typeof t.className["baseVal"]==="string"){v(t.className,"baseVal",e,r)}else{v(t,"className",e,r)}}}function v(e,t,r,i){var n=e[t].match(f)||[];A.utils.arrayForEach(r.match(f),function(e){A.utils.addOrRemoveItem(n,e,i)});e[t]=n.join(" ")}return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(e,t){for(var r=0,i=e.length;r<i;r++)t(e[r],r)},arrayIndexOf:function(e,t){if(typeof Array.prototype.indexOf=="function")return Array.prototype.indexOf.call(e,t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},arrayFirst:function(e,t,r){for(var i=0,n=e.length;i<n;i++)if(t.call(r,e[i],i))return e[i];return null},arrayRemoveItem:function(e,t){var r=A.utils.arrayIndexOf(e,t);if(r>0){e.splice(r,1)}else if(r===0){e.shift()}},arrayGetDistinctValues:function(e){e=e||[];var t=[];for(var r=0,i=e.length;r<i;r++){if(A.utils.arrayIndexOf(t,e[r])<0)t.push(e[r])}return t},arrayMap:function(e,t){e=e||[];var r=[];for(var i=0,n=e.length;i<n;i++)r.push(t(e[i],i));return r},arrayFilter:function(e,t){e=e||[];var r=[];for(var i=0,n=e.length;i<n;i++)if(t(e[i],i))r.push(e[i]);return r},arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var r=0,i=t.length;r<i;r++)e.push(t[r]);return e},addOrRemoveItem:function(e,t,r){var i=A.utils.arrayIndexOf(A.utils.peekObservable(e),t);if(i<0){if(r)e.push(t)}else{if(!r)e.splice(i,1)}},canSetPrototype:r,extend:e,setPrototypeOf:t,setPrototypeOfOrExtend:r?t:e,objectForEach:h,objectMap:function(e,t){if(!e)return e;var r={};for(var i in e){if(e.hasOwnProperty(i)){r[i]=t(e[i],i,e)}}return r},emptyDomNode:function(e){while(e.firstChild){A.removeNode(e.firstChild)}},moveCleanedNodesToContainerElement:function(e){var t=A.utils.makeArray(e);var r=t[0]&&t[0].ownerDocument||S;var i=r.createElement("div");for(var n=0,a=t.length;n<a;n++){i.appendChild(A.cleanNode(t[n]))}return i},cloneNodes:function(e,t){for(var r=0,i=e.length,n=[];r<i;r++){var a=e[r].cloneNode(true);n.push(t?A.cleanNode(a):a)}return n},setDomNodeChildren:function(e,t){A.utils.emptyDomNode(e);if(t){for(var r=0,i=t.length;r<i;r++)e.appendChild(t[r])}},replaceDomNodes:function(e,t){var r=e.nodeType?[e]:e;if(r.length>0){var i=r[0];var n=i.parentNode;for(var a=0,o=t.length;a<o;a++)n.insertBefore(t[a],i);for(var a=0,o=r.length;a<o;a++){A.removeNode(r[a])}}},fixUpContinuousNodeArray:function(e,t){if(e.length){t=t.nodeType===8&&t.parentNode||t;while(e.length&&e[0].parentNode!==t)e.splice(0,1);while(e.length>1&&e[e.length-1].parentNode!==t)e.length--;if(e.length>1){var r=e[0],i=e[e.length-1];e.length=0;while(r!==i){e.push(r);r=r.nextSibling}e.push(i)}}return e},setOptionNodeSelectionState:function(e,t){if(l<7)e.setAttribute("selected",t);else e.selected=t},stringTrim:function(e){return e===null||e===k?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},stringStartsWith:function(e,t){e=e||"";if(t.length>e.length)return false;return e.substring(0,t.length)===t},domNodeIsContainedBy:function(e,t){if(e===t)return true;if(e.nodeType===11)return false;if(t.contains)return t.contains(e.nodeType===3?e.parentNode:e);if(t.compareDocumentPosition)return(t.compareDocumentPosition(e)&16)==16;while(e&&e!=t){e=e.parentNode}return!!e},domNodeIsAttachedToDocument:function(e){return A.utils.domNodeIsContainedBy(e,e.ownerDocument.documentElement)},anyDomNodeIsAttachedToDocument:function(e){return!!A.utils.arrayFirst(e,A.utils.domNodeIsAttachedToDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},catchFunctionErrors:function(e){return A["onError"]?function(){try{return e.apply(this,arguments)}catch(e){A["onError"]&&A["onError"](e);throw e}}:e},setTimeout:function(e,t){return setTimeout(A.utils.catchFunctionErrors(e),t)},deferError:function(e){setTimeout(function(){A["onError"]&&A["onError"](e);throw e},0)},registerEventHandler:function(t,e,r){var i=A.utils.catchFunctionErrors(r);var n=l&&s[e];if(!A.options["useOnlyNativeEvents"]&&!n&&D){D(t)["bind"](e,i)}else if(!n&&typeof t.addEventListener=="function")t.addEventListener(e,i,false);else if(typeof t.attachEvent!="undefined"){var a=function(e){i.call(t,e)},o="on"+e;t.attachEvent(o,a);A.utils.domNodeDisposal.addDisposeCallback(t,function(){t.detachEvent(o,a)})}else throw new Error("Browser doesn't support addEventListener or attachEvent")},triggerEvent:function(e,t){if(!(e&&e.nodeType))throw new Error("element must be a DOM node when calling triggerEvent");var r=c(e,t);if(!A.options["useOnlyNativeEvents"]&&D&&!r){D(e)["trigger"](t)}else if(typeof S.createEvent=="function"){if(typeof e.dispatchEvent=="function"){var i=a[t]||"HTMLEvents";var n=S.createEvent(i);n.initEvent(t,true,true,E,0,0,0,0,0,false,false,false,false,0,e);e.dispatchEvent(n)}else throw new Error("The supplied element doesn't support dispatchEvent")}else if(r&&e.click){e.click()}else if(typeof e.fireEvent!="undefined"){e.fireEvent("on"+t)}else{throw new Error("Browser doesn't support triggering events")}},unwrapObservable:function(e){return A.isObservable(e)?e():e},peekObservable:function(e){return A.isObservable(e)?e.peek():e},toggleDomNodeCssClass:p,setTextContent:function(e,t){var r=A.utils.unwrapObservable(t);if(r===null||r===k)r="";var i=A.virtualElements.firstChild(e);if(!i||i.nodeType!=3||A.virtualElements.nextSibling(i)){A.virtualElements.setDomNodeChildren(e,[e.ownerDocument.createTextNode(r)])}else{i.data=r}A.utils.forceRefresh(e)},setElementName:function(e,t){e.name=t;if(l<=7){try{e.mergeAttributes(S.createElement("<input name='"+e.name+"'/>"),false)}catch(e){}}},forceRefresh:function(e){if(l>=9){var t=e.nodeType==1?e:e.parentNode;if(t.style)t.style.zoom=t.style.zoom}},ensureSelectElementIsRenderedCorrectly:function(e){if(l){var t=e.style.width;e.style.width=0;e.style.width=t}},range:function(e,t){e=A.utils.unwrapObservable(e);t=A.utils.unwrapObservable(t);var r=[];for(var i=e;i<=t;i++)r.push(i);return r},makeArray:function(e){var t=[];for(var r=0,i=e.length;r<i;r++){t.push(e[r])}return t},createSymbolOrString:function(e){return i?Symbol(e):e},isIe6:u,isIe7:d,ieVersion:l,getFormFields:function(e,t){var r=A.utils.makeArray(e.getElementsByTagName("input")).concat(A.utils.makeArray(e.getElementsByTagName("textarea")));var i=typeof t=="string"?function(e){return e.name===t}:function(e){return t.test(e.name)};var n=[];for(var a=r.length-1;a>=0;a--){if(i(r[a]))n.push(r[a])}return n},parseJson:function(e){if(typeof e=="string"){e=A.utils.stringTrim(e);if(e){if(I&&I.parse)return I.parse(e);return new Function("return "+e)()}}return null},stringifyJson:function(e,t,r){if(!I||!I.stringify)throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return I.stringify(A.utils.unwrapObservable(e),t,r)},postJson:function(e,t,r){r=r||{};var i=r["params"]||{};var n=r["includeFields"]||this.fieldsIncludedWithJsonPost;var a=e;if(typeof e=="object"&&A.utils.tagNameLower(e)==="form"){var o=e;a=o.action;for(var s=n.length-1;s>=0;s--){var l=A.utils.getFormFields(o,n[s]);for(var u=l.length-1;u>=0;u--)i[l[u].name]=l[u].value}}t=A.utils.unwrapObservable(t);var d=S.createElement("form");d.style.display="none";d.action=a;d.method="post";for(var c in t){var f=S.createElement("input");f.type="hidden";f.name=c;f.value=A.utils.stringifyJson(A.utils.unwrapObservable(t[c]));d.appendChild(f)}h(i,function(e,t){var r=S.createElement("input");r.type="hidden";r.name=e;r.value=t;d.appendChild(r)});S.body.appendChild(d);r["submitter"]?r["submitter"](d):d.submit();setTimeout(function(){d.parentNode.removeChild(d)},0)}}}();A.exportSymbol("utils",A.utils);A.exportSymbol("utils.arrayForEach",A.utils.arrayForEach);A.exportSymbol("utils.arrayFirst",A.utils.arrayFirst);A.exportSymbol("utils.arrayFilter",A.utils.arrayFilter);A.exportSymbol("utils.arrayGetDistinctValues",A.utils.arrayGetDistinctValues);A.exportSymbol("utils.arrayIndexOf",A.utils.arrayIndexOf);A.exportSymbol("utils.arrayMap",A.utils.arrayMap);A.exportSymbol("utils.arrayPushAll",A.utils.arrayPushAll);A.exportSymbol("utils.arrayRemoveItem",A.utils.arrayRemoveItem);A.exportSymbol("utils.extend",A.utils.extend);A.exportSymbol("utils.fieldsIncludedWithJsonPost",A.utils.fieldsIncludedWithJsonPost);A.exportSymbol("utils.getFormFields",A.utils.getFormFields);A.exportSymbol("utils.peekObservable",A.utils.peekObservable);A.exportSymbol("utils.postJson",A.utils.postJson);A.exportSymbol("utils.parseJson",A.utils.parseJson);A.exportSymbol("utils.registerEventHandler",A.utils.registerEventHandler);A.exportSymbol("utils.stringifyJson",A.utils.stringifyJson);A.exportSymbol("utils.range",A.utils.range);A.exportSymbol("utils.toggleDomNodeCssClass",A.utils.toggleDomNodeCssClass);A.exportSymbol("utils.triggerEvent",A.utils.triggerEvent);A.exportSymbol("utils.unwrapObservable",A.utils.unwrapObservable);A.exportSymbol("utils.objectForEach",A.utils.objectForEach);A.exportSymbol("utils.addOrRemoveItem",A.utils.addOrRemoveItem);A.exportSymbol("utils.setTextContent",A.utils.setTextContent);A.exportSymbol("unwrap",A.utils.unwrapObservable);if(!Function.prototype["bind"]){Function.prototype["bind"]=function(t){var r=this;if(arguments.length===1){return function(){return r.apply(t,arguments)}}else{var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice(0);e.push.apply(e,arguments);return r.apply(t,e)}}}}A.utils.domData=new function(){var n=0;var a="__ko__"+(new Date).getTime();var o={};function s(e,t){var r=e[a];var i=r&&r!=="null"&&o[r];if(!i){if(!t)return k;r=e[a]="ko"+n++;o[r]={}}return o[r]}return{get:function(e,t){var r=s(e,false);return r===k?k:r[t]},set:function(e,t,r){if(r===k){if(s(e,false)===k)return}var i=s(e,true);i[t]=r},clear:function(e){var t=e[a];if(t){delete o[t];e[a]=null;return true}return false},nextKey:function(){return n+++a}}};A.exportSymbol("utils.domData",A.utils.domData);A.exportSymbol("utils.domData.clear",A.utils.domData.clear);A.utils.domNodeDisposal=new function(){var i=A.utils.domData.nextKey();var n={1:true,8:true,9:true};var a={1:true,9:true};function o(e,t){var r=A.utils.domData.get(e,i);if(r===k&&t){r=[];A.utils.domData.set(e,i,r)}return r}function s(e){A.utils.domData.set(e,i,k)}function l(e){var t=o(e,false);if(t){t=t.slice(0);for(var r=0;r<t.length;r++)t[r](e)}A.utils.domData.clear(e);A.utils.domNodeDisposal["cleanExternalData"](e);if(a[e.nodeType])u(e)}function u(e){var t,r=e.firstChild;while(t=r){r=t.nextSibling;if(t.nodeType===8)l(t)}}return{addDisposeCallback:function(e,t){if(typeof t!="function")throw new Error("Callback must be a function");o(e,true).push(t)},removeDisposeCallback:function(e,t){var r=o(e,false);if(r){A.utils.arrayRemoveItem(r,t);if(r.length==0)s(e)}},cleanNode:function(e){if(n[e.nodeType]){l(e);if(a[e.nodeType]){var t=[];A.utils.arrayPushAll(t,e.getElementsByTagName("*"));for(var r=0,i=t.length;r<i;r++)l(t[r])}}return e},removeNode:function(e){A.cleanNode(e);if(e.parentNode)e.parentNode.removeChild(e)},cleanExternalData:function(e){if(D&&typeof D["cleanData"]=="function")D["cleanData"]([e])}}};A.cleanNode=A.utils.domNodeDisposal.cleanNode;A.removeNode=A.utils.domNodeDisposal.removeNode;A.exportSymbol("cleanNode",A.cleanNode);A.exportSymbol("removeNode",A.removeNode);A.exportSymbol("utils.domNodeDisposal",A.utils.domNodeDisposal);A.exportSymbol("utils.domNodeDisposal.addDisposeCallback",A.utils.domNodeDisposal.addDisposeCallback);A.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",A.utils.domNodeDisposal.removeDisposeCallback);(function(){var r=[0,"",""],e=[1,"<table>","</table>"],t=[2,"<table><tbody>","</tbody></table>"],i=[3,"<table><tbody><tr>","</tr></tbody></table>"],n=[1,"<select multiple='multiple'>","</select>"],a={thead:e,tbody:e,tfoot:e,tr:t,td:i,th:i,option:n,optgroup:n},l=A.utils.ieVersion<=8;function u(e){var t=e.match(/^<([a-z]+)[ >]/);return t&&a[t[1]]||r}function o(e,t){t||(t=S);var r=t["parentWindow"]||t["defaultView"]||E;var i=A.utils.stringTrim(e).toLowerCase(),n=t.createElement("div"),a=u(i),o=a[0];var s="ignored<div>"+a[1]+e+a[2]+"</div>";if(typeof r["innerShiv"]=="function"){n.appendChild(r["innerShiv"](s))}else{if(l){t.appendChild(n)}n.innerHTML=s;if(l){n.parentNode.removeChild(n)}}while(o--)n=n.lastChild;return A.utils.makeArray(n.lastChild.childNodes)}function s(e,t){if(D["parseHTML"]){return D["parseHTML"](e,t)||[]}else{var r=D["clean"]([e],t);if(r&&r[0]){var i=r[0];while(i.parentNode&&i.parentNode.nodeType!==11)i=i.parentNode;if(i.parentNode)i.parentNode.removeChild(i)}return r}}A.utils.parseHtmlFragment=function(e,t){return D?s(e,t):o(e,t)};A.utils.setHtml=function(e,t){A.utils.emptyDomNode(e);t=A.utils.unwrapObservable(t);if(t!==null&&t!==k){if(typeof t!="string")t=t.toString();if(D){D(e)["html"](t)}else{var r=A.utils.parseHtmlFragment(t,e.ownerDocument);for(var i=0;i<r.length;i++)e.appendChild(r[i])}}}})();A.exportSymbol("utils.parseHtmlFragment",A.utils.parseHtmlFragment);A.exportSymbol("utils.setHtml",A.utils.setHtml);A.memoization=function(){var i={};function e(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function r(){return e()+e()}function s(e,t){if(!e)return;if(e.nodeType==8){var r=A.memoization.parseMemoText(e.nodeValue);if(r!=null)t.push({domNode:e,memoId:r})}else if(e.nodeType==1){for(var i=0,n=e.childNodes,a=n.length;i<a;i++)s(n[i],t)}}return{memoize:function(e){if(typeof e!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var t=r();i[t]=e;return"\x3c!--[ko_memo:"+t+"]--\x3e"},unmemoize:function(e,t){var r=i[e];if(r===k)throw new Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized.");try{r.apply(null,t||[]);return true}finally{delete i[e]}},unmemoizeDomNodeAndDescendants:function(e,t){var r=[];s(e,r);for(var i=0,n=r.length;i<n;i++){var a=r[i].domNode;var o=[a];if(t)A.utils.arrayPushAll(o,t);A.memoization.unmemoize(r[i].memoId,o);a.nodeValue="";if(a.parentNode)a.parentNode.removeChild(a)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}();A.exportSymbol("memoization",A.memoization);A.exportSymbol("memoization.memoize",A.memoization.memoize);A.exportSymbol("memoization.unmemoize",A.memoization.unmemoize);A.exportSymbol("memoization.parseMemoText",A.memoization.parseMemoText);A.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",A.memoization.unmemoizeDomNodeAndDescendants);A.tasks=function(){var e,i=[],n=0,r=1,a=0;if(E["MutationObserver"]){e=function(e){var t=S.createElement("div");new MutationObserver(e).observe(t,{attributes:true});return function(){t.classList.toggle("foo")}}(o)}else if(S&&"onreadystatechange"in S.createElement("script")){e=function(e){var t=S.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null;S.documentElement.removeChild(t);t=null;e()};S.documentElement.appendChild(t)}}else{e=function(e){setTimeout(e,0)}}function t(){if(n){var e=n,t=0;for(var r;a<n;){if(r=i[a++]){if(a>e){if(++t>=5e3){a=n;A.utils.deferError(Error("'Too much recursion' after processing "+t+" task groups."));break}e=n}try{r()}catch(e){A.utils.deferError(e)}}}}}function o(){t();a=n=i.length=0}function s(){A.tasks["scheduler"](o)}var l={scheduler:e,schedule:function(e){if(!n){s()}i[n++]=e;return r++},cancel:function(e){var t=e-(r-n);if(t>=a&&t<n){i[t]=null}},resetForTesting:function(){var e=n-a;a=n=i.length=0;return e},runEarly:t};return l}();A.exportSymbol("tasks",A.tasks);A.exportSymbol("tasks.schedule",A.tasks.schedule);A.exportSymbol("tasks.runEarly",A.tasks.runEarly);A.extenders={throttle:function(t,r){t["throttleEvaluation"]=r;var i=null;return A.dependentObservable({read:t,write:function(e){clearTimeout(i);i=A.utils.setTimeout(function(){t(e)},r)}})},rateLimit:function(e,t){var r,i,n;if(typeof t=="number"){r=t}else{r=t["timeout"];i=t["method"]}e._deferUpdates=false;n=i=="notifyWhenChangesStop"?o:a;e.limit(function(e){return n(e,r)})},deferred:function(i,e){if(e!==true){throw new Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.")}if(!i._deferUpdates){i._deferUpdates=true;i.limit(function(e){var t,r=false;return function(){if(!r){A.tasks.cancel(t);t=A.tasks.schedule(e);try{r=true;i["notifySubscribers"](k,"dirty")}finally{r=false}}}})}},notify:function(e,t){e["equalityComparer"]=t=="always"?null:r}};var i={undefined:1,boolean:1,number:1,string:1};function r(e,t){var r=e===null||typeof e in i;return r?e===t:false}function a(e,t){var r;return function(){if(!r){r=A.utils.setTimeout(function(){r=k;e()},t)}}}function o(e,t){var r;return function(){clearTimeout(r);r=A.utils.setTimeout(e,t)}}function t(e){var i=this;if(e){A.utils.objectForEach(e,function(e,t){var r=A.extenders[e];if(typeof r=="function"){i=r(i,t)||i}})}return i}A.exportSymbol("extenders",A.extenders);A.subscription=function(e,t,r){this._target=e;this.callback=t;this.disposeCallback=r;this.isDisposed=false;A.exportProperty(this,"dispose",this.dispose)};A.subscription.prototype.dispose=function(){this.isDisposed=true;this.disposeCallback()};A.subscribable=function(){A.utils.setPrototypeOfOrExtend(this,n);n.init(this)};var u="change";function d(e,t){if(!t||t===u){this._limitChange(e)}else if(t==="beforeChange"){this._limitBeforeChange(e)}else{this._origNotifySubscribers(e,t)}}var n={init:function(e){e._subscriptions={change:[]};e._versionNumber=1},subscribe:function(e,t,r){var i=this;r=r||u;var n=t?e.bind(t):e;var a=new A.subscription(i,n,function(){A.utils.arrayRemoveItem(i._subscriptions[r],a);if(i.afterSubscriptionRemove)i.afterSubscriptionRemove(r)});if(i.beforeSubscriptionAdd)i.beforeSubscriptionAdd(r);if(!i._subscriptions[r])i._subscriptions[r]=[];i._subscriptions[r].push(a);return a},notifySubscribers:function(e,t){t=t||u;if(t===u){this.updateVersion()}if(this.hasSubscriptionsForEvent(t)){var r=t===u&&this._changeSubscriptions||this._subscriptions[t].slice(0);try{A.dependencyDetection.begin();for(var i=0,n;n=r[i];++i){if(!n.isDisposed)n.callback(e)}}finally{A.dependencyDetection.end()}}},getVersion:function(){return this._versionNumber},hasChanged:function(e){return this.getVersion()!==e},updateVersion:function(){++this._versionNumber},limit:function(e){var t=this,r=A.isObservable(t),i,n,a,o,s="beforeChange";if(!t._origNotifySubscribers){t._origNotifySubscribers=t["notifySubscribers"];t["notifySubscribers"]=d}var l=e(function(){t._notificationIsPending=false;if(r&&o===t){o=t._evalIfChanged?t._evalIfChanged():t()}var e=n||t.isDifferent(a,o);n=i=false;if(e){t._origNotifySubscribers(a=o)}});t._limitChange=function(e){t._changeSubscriptions=t._subscriptions[u].slice(0);t._notificationIsPending=i=true;o=e;l()};t._limitBeforeChange=function(e){if(!i){a=e;t._origNotifySubscribers(e,s)}};t._notifyNextChangeIfValueIsDifferent=function(){if(t.isDifferent(a,t.peek(true))){n=true}}},hasSubscriptionsForEvent:function(e){return this._subscriptions[e]&&this._subscriptions[e].length},getSubscriptionsCount:function(e){if(e){return this._subscriptions[e]&&this._subscriptions[e].length||0}else{var r=0;A.utils.objectForEach(this._subscriptions,function(e,t){if(e!=="dirty")r+=t.length});return r}},isDifferent:function(e,t){return!this["equalityComparer"]||!this["equalityComparer"](e,t)},extend:t};A.exportProperty(n,"subscribe",n.subscribe);A.exportProperty(n,"extend",n.extend);A.exportProperty(n,"getSubscriptionsCount",n.getSubscriptionsCount);if(A.utils.canSetPrototype){A.utils.setPrototypeOf(n,Function.prototype)}A.subscribable["fn"]=n;A.isSubscribable=function(e){return e!=null&&typeof e.subscribe=="function"&&typeof e["notifySubscribers"]=="function"};A.exportSymbol("subscribable",A.subscribable);A.exportSymbol("isSubscribable",A.isSubscribable);A.computedContext=A.dependencyDetection=function(){var t=[],r,e=0;function i(){return++e}function n(e){t.push(r);r=e}function a(){r=t.pop()}return{begin:n,end:a,registerDependency:function(e){if(r){if(!A.isSubscribable(e))throw new Error("Only subscribable things can act as dependencies");r.callback.call(r.callbackTarget,e,e._id||(e._id=i()))}},ignore:function(e,t,r){try{n();return e.apply(t,r||[])}finally{a()}},getDependenciesCount:function(){if(r)return r.computed.getDependenciesCount()},isInitial:function(){if(r)return r.isInitial}}}();A.exportSymbol("computedContext",A.computedContext);A.exportSymbol("computedContext.getDependenciesCount",A.computedContext.getDependenciesCount);A.exportSymbol("computedContext.isInitial",A.computedContext.isInitial);A.exportSymbol("ignoreDependencies",A.ignoreDependencies=A.dependencyDetection.ignore);var s=A.utils.createSymbolOrString("_latestValue");A.observable=function(e){function t(){if(arguments.length>0){if(t.isDifferent(t[s],arguments[0])){t.valueWillMutate();t[s]=arguments[0];t.valueHasMutated()}return this}else{A.dependencyDetection.registerDependency(t);return t[s]}}t[s]=e;if(!A.utils.canSetPrototype){A.utils.extend(t,A.subscribable["fn"])}A.subscribable["fn"].init(t);A.utils.setPrototypeOfOrExtend(t,l);if(A.options["deferUpdates"]){A.extenders["deferred"](t,true)}return t};var l={equalityComparer:r,peek:function(){return this[s]},valueHasMutated:function(){this["notifySubscribers"](this[s])},valueWillMutate:function(){this["notifySubscribers"](this[s],"beforeChange")}};if(A.utils.canSetPrototype){A.utils.setPrototypeOf(l,A.subscribable["fn"])}var c=A.observable.protoProperty="__ko_proto__";l[c]=A.observable;A.hasPrototype=function(e,t){if(e===null||e===k||e[c]===k)return false;if(e[c]===t)return true;return A.hasPrototype(e[c],t)};A.isObservable=function(e){return A.hasPrototype(e,A.observable)};A.isWriteableObservable=function(e){if(typeof e=="function"&&e[c]===A.observable)return true;if(typeof e=="function"&&e[c]===A.dependentObservable&&e.hasWriteFunction)return true;return false};A.exportSymbol("observable",A.observable);A.exportSymbol("isObservable",A.isObservable);A.exportSymbol("isWriteableObservable",A.isWriteableObservable);A.exportSymbol("isWritableObservable",A.isWriteableObservable);A.exportSymbol("observable.fn",l);A.exportProperty(l,"peek",l.peek);A.exportProperty(l,"valueHasMutated",l.valueHasMutated);A.exportProperty(l,"valueWillMutate",l.valueWillMutate);A.observableArray=function(e){e=e||[];if(typeof e!="object"||!("length"in e))throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");var t=A.observable(e);A.utils.setPrototypeOfOrExtend(t,A.observableArray["fn"]);return t.extend({trackArrayChanges:true})};A.observableArray["fn"]={remove:function(t){var e=this.peek();var r=[];var i=typeof t=="function"&&!A.isObservable(t)?t:function(e){return e===t};for(var n=0;n<e.length;n++){var a=e[n];if(i(a)){if(r.length===0){this.valueWillMutate()}r.push(a);e.splice(n,1);n--}}if(r.length){this.valueHasMutated()}return r},removeAll:function(t){if(t===k){var e=this.peek();var r=e.slice(0);this.valueWillMutate();e.splice(0,e.length);this.valueHasMutated();return r}if(!t)return[];return this["remove"](function(e){return A.utils.arrayIndexOf(t,e)>=0})},destroy:function(t){var e=this.peek();var r=typeof t=="function"&&!A.isObservable(t)?t:function(e){return e===t};this.valueWillMutate();for(var i=e.length-1;i>=0;i--){var n=e[i];if(r(n))e[i]["_destroy"]=true}this.valueHasMutated()},destroyAll:function(t){if(t===k)return this["destroy"](function(){return true});if(!t)return[];return this["destroy"](function(e){return A.utils.arrayIndexOf(t,e)>=0})},indexOf:function(e){var t=this();return A.utils.arrayIndexOf(t,e)},replace:function(e,t){var r=this["indexOf"](e);if(r>=0){this.valueWillMutate();this.peek()[r]=t;this.valueHasMutated()}}};if(A.utils.canSetPrototype){A.utils.setPrototypeOf(A.observableArray["fn"],A.observable["fn"])}A.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(r){A.observableArray["fn"][r]=function(){var e=this.peek();this.valueWillMutate();this.cacheDiffForKnownOperation(e,r,arguments);var t=e[r].apply(e,arguments);this.valueHasMutated();return t===e?this:t}});A.utils.arrayForEach(["slice"],function(t){A.observableArray["fn"][t]=function(){var e=this();return e[t].apply(e,arguments)}});A.exportSymbol("observableArray",A.observableArray);var f="arrayChange";A.extenders["trackArrayChanges"]=function(i,e){i.compareArrayOptions={};if(e&&typeof e=="object"){A.utils.extend(i.compareArrayOptions,e)}i.compareArrayOptions["sparse"]=true;if(i.cacheDiffForKnownOperation){return}var m=false,_=null,t,y=0,n,r=i.beforeSubscriptionAdd,a=i.afterSubscriptionRemove;i.beforeSubscriptionAdd=function(e){if(r)r.call(i,e);if(e===f){o()}};i.afterSubscriptionRemove=function(e){if(a)a.call(i,e);if(e===f&&!i.hasSubscriptionsForEvent(f)){if(n){i["notifySubscribers"]=n;n=k}t.dispose();m=false}};function o(){if(m){return}m=true;n=i["notifySubscribers"];i["notifySubscribers"]=function(e,t){if(!t||t===u){++y}return n.apply(this,arguments)};var r=[].concat(i.peek()||[]);_=null;t=i.subscribe(function(e){e=[].concat(e||[]);if(i.hasSubscriptionsForEvent(f)){var t=s(r,e)}r=e;_=null;y=0;if(t&&t.length){i["notifySubscribers"](t,f)}})}function s(e,t){if(!_||y>1){_=A.utils.compareArrays(e,t,i.compareArrayOptions)}return _}i.cacheDiffForKnownOperation=function(e,t,r){if(!m||y){return}var i=[],n=e.length,a=r.length,o=0;function s(e,t,r){return i[i.length]={status:e,value:t,index:r}}switch(t){case"push":o=n;case"unshift":for(var l=0;l<a;l++){s("added",r[l],o+l)}break;case"pop":o=n-1;case"shift":if(n){s("deleted",e[o],o)}break;case"splice":var u=Math.min(Math.max(0,r[0]<0?n+r[0]:r[0]),n),d=a===1?n:Math.min(u+(r[1]||0),n),c=u+a-2,f=Math.max(d,c),h=[],p=[];for(var l=u,v=2;l<f;++l,++v){if(l<d)p.push(s("deleted",e[l],l));if(l<c)h.push(s("added",r[v],l))}A.utils.findMovesInArrayComparison(p,h);break;default:return}_=i}};var p=A.utils.createSymbolOrString("_state");A.computed=A.dependentObservable=function(e,t,r){if(typeof e==="object"){r=e}else{r=r||{};if(e){r["read"]=e}}if(typeof r["read"]!="function")throw Error("Pass a function that returns the value of the ko.computed");var i=r["write"];var n={latestValue:k,isStale:true,isDirty:true,isBeingEvaluated:false,suppressDisposalUntilDisposeWhenReturnsFalse:false,isDisposed:false,pure:false,isSleeping:false,readFunction:r["read"],evaluatorFunctionTarget:t||r["owner"],disposeWhenNodeIsRemoved:r["disposeWhenNodeIsRemoved"]||r.disposeWhenNodeIsRemoved||null,disposeWhen:r["disposeWhen"]||r.disposeWhen,domNodeDisposalCallback:null,dependencyTracking:{},dependenciesCount:0,evaluationTimeoutInstance:null};function a(){if(arguments.length>0){if(typeof i==="function"){i.apply(n.evaluatorFunctionTarget,arguments)}else{throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")}return this}else{A.dependencyDetection.registerDependency(a);if(n.isDirty||n.isSleeping&&a.haveDependenciesChanged()){a.evaluateImmediate()}return n.latestValue}}a[p]=n;a.hasWriteFunction=typeof i==="function";if(!A.utils.canSetPrototype){A.utils.extend(a,A.subscribable["fn"])}A.subscribable["fn"].init(a);A.utils.setPrototypeOfOrExtend(a,_);if(r["pure"]){n.pure=true;n.isSleeping=true;A.utils.extend(a,y)}else if(r["deferEvaluation"]){A.utils.extend(a,g)}if(A.options["deferUpdates"]){A.extenders["deferred"](a,true)}if(R){a["_options"]=r}if(n.disposeWhenNodeIsRemoved){n.suppressDisposalUntilDisposeWhenReturnsFalse=true;if(!n.disposeWhenNodeIsRemoved.nodeType){n.disposeWhenNodeIsRemoved=null}}if(!n.isSleeping&&!r["deferEvaluation"]){a.evaluateImmediate()}if(n.disposeWhenNodeIsRemoved&&a.isActive()){A.utils.domNodeDisposal.addDisposeCallback(n.disposeWhenNodeIsRemoved,n.domNodeDisposalCallback=function(){a.dispose()})}return a};function v(e,t){if(t!==null&&t.dispose){t.dispose()}}function m(e,t){var r=this.computedObservable,i=r[p];if(!i.isDisposed){if(this.disposalCount&&this.disposalCandidates[t]){r.addDependencyTracking(t,e,this.disposalCandidates[t]);this.disposalCandidates[t]=null;--this.disposalCount}else if(!i.dependencyTracking[t]){r.addDependencyTracking(t,e,i.isSleeping?{_target:e}:r.subscribeToDependency(e))}if(e._notificationIsPending){e._notifyNextChangeIfValueIsDifferent()}}}var _={equalityComparer:r,getDependenciesCount:function(){return this[p].dependenciesCount},addDependencyTracking:function(e,t,r){if(this[p].pure&&t===this){throw Error("A 'pure' computed must not be called recursively")}this[p].dependencyTracking[e]=r;r._order=this[p].dependenciesCount++;r._version=t.getVersion()},haveDependenciesChanged:function(){var e,t,r=this[p].dependencyTracking;for(e in r){if(r.hasOwnProperty(e)){t=r[e];if(this._evalDelayed&&t._target._notificationIsPending||t._target.hasChanged(t._version)){return true}}}},markDirty:function(){if(this._evalDelayed&&!this[p].isBeingEvaluated){this._evalDelayed(false)}},isActive:function(){var e=this[p];return e.isDirty||e.dependenciesCount>0},respondToChange:function(){if(!this._notificationIsPending){this.evaluatePossiblyAsync()}else if(this[p].isDirty){this[p].isStale=true}},subscribeToDependency:function(e){if(e._deferUpdates&&!this[p].disposeWhenNodeIsRemoved){var t=e.subscribe(this.markDirty,this,"dirty"),r=e.subscribe(this.respondToChange,this);return{_target:e,dispose:function(){t.dispose();r.dispose()}}}else{return e.subscribe(this.evaluatePossiblyAsync,this)}},evaluatePossiblyAsync:function(){var e=this,t=e["throttleEvaluation"];if(t&&t>=0){clearTimeout(this[p].evaluationTimeoutInstance);this[p].evaluationTimeoutInstance=A.utils.setTimeout(function(){e.evaluateImmediate(true)},t)}else if(e._evalDelayed){e._evalDelayed(true)}else{e.evaluateImmediate(true)}},evaluateImmediate:function(e){var t=this,r=t[p],i=r.disposeWhen,n=false;if(r.isBeingEvaluated){return}if(r.isDisposed){return}if(r.disposeWhenNodeIsRemoved&&!A.utils.domNodeIsAttachedToDocument(r.disposeWhenNodeIsRemoved)||i&&i()){if(!r.suppressDisposalUntilDisposeWhenReturnsFalse){t.dispose();return}}else{r.suppressDisposalUntilDisposeWhenReturnsFalse=false}r.isBeingEvaluated=true;try{n=this.evaluateImmediate_CallReadWithDependencyDetection(e)}finally{r.isBeingEvaluated=false}if(!r.dependenciesCount){t.dispose()}return n},evaluateImmediate_CallReadWithDependencyDetection:function(e){var t=this,r=t[p],i=false;var n=r.pure?k:!r.dependenciesCount,a={computedObservable:t,disposalCandidates:r.dependencyTracking,disposalCount:r.dependenciesCount};A.dependencyDetection.begin({callbackTarget:a,callback:m,computed:t,isInitial:n});r.dependencyTracking={};r.dependenciesCount=0;var o=this.evaluateImmediate_CallReadThenEndDependencyDetection(r,a);if(t.isDifferent(r.latestValue,o)){if(!r.isSleeping){t["notifySubscribers"](r.latestValue,"beforeChange")}r.latestValue=o;if(R)t._latestValue=o;if(r.isSleeping){t.updateVersion()}else if(e){t["notifySubscribers"](r.latestValue)}i=true}if(n){t["notifySubscribers"](r.latestValue,"awake")}return i},evaluateImmediate_CallReadThenEndDependencyDetection:function(e,t){try{var r=e.readFunction;return e.evaluatorFunctionTarget?r.call(e.evaluatorFunctionTarget):r()}finally{A.dependencyDetection.end();if(t.disposalCount&&!e.isSleeping){A.utils.objectForEach(t.disposalCandidates,v)}e.isStale=e.isDirty=false}},peek:function(e){var t=this[p];if(t.isDirty&&(e||!t.dependenciesCount)||t.isSleeping&&this.haveDependenciesChanged()){this.evaluateImmediate()}return t.latestValue},limit:function(e){A.subscribable["fn"].limit.call(this,e);this._evalIfChanged=function(){if(this[p].isStale){this.evaluateImmediate()}else{this[p].isDirty=false}return this[p].latestValue};this._evalDelayed=function(e){this._limitBeforeChange(this[p].latestValue);this[p].isDirty=true;if(e){this[p].isStale=true}this._limitChange(this)}},dispose:function(){var e=this[p];if(!e.isSleeping&&e.dependencyTracking){A.utils.objectForEach(e.dependencyTracking,function(e,t){if(t.dispose)t.dispose()})}if(e.disposeWhenNodeIsRemoved&&e.domNodeDisposalCallback){A.utils.domNodeDisposal.removeDisposeCallback(e.disposeWhenNodeIsRemoved,e.domNodeDisposalCallback)}e.dependencyTracking=null;e.dependenciesCount=0;e.isDisposed=true;e.isStale=false;e.isDirty=false;e.isSleeping=false;e.disposeWhenNodeIsRemoved=null}};var y={beforeSubscriptionAdd:function(e){var n=this,a=n[p];if(!a.isDisposed&&a.isSleeping&&e=="change"){a.isSleeping=false;if(a.isStale||n.haveDependenciesChanged()){a.dependencyTracking=null;a.dependenciesCount=0;if(n.evaluateImmediate()){n.updateVersion()}}else{var r=[];A.utils.objectForEach(a.dependencyTracking,function(e,t){r[t._order]=e});A.utils.arrayForEach(r,function(e,t){var r=a.dependencyTracking[e],i=n.subscribeToDependency(r._target);i._order=t;i._version=r._version;a.dependencyTracking[e]=i})}if(!a.isDisposed){n["notifySubscribers"](a.latestValue,"awake")}}},afterSubscriptionRemove:function(e){var r=this[p];if(!r.isDisposed&&e=="change"&&!this.hasSubscriptionsForEvent("change")){A.utils.objectForEach(r.dependencyTracking,function(e,t){if(t.dispose){r.dependencyTracking[e]={_target:t._target,_order:t._order,_version:t._version};t.dispose()}});r.isSleeping=true;this["notifySubscribers"](k,"asleep")}},getVersion:function(){var e=this[p];if(e.isSleeping&&(e.isStale||this.haveDependenciesChanged())){this.evaluateImmediate()}return A.subscribable["fn"].getVersion.call(this)}};var g={beforeSubscriptionAdd:function(e){if(e=="change"||e=="beforeChange"){this.peek()}}};if(A.utils.canSetPrototype){A.utils.setPrototypeOf(_,A.subscribable["fn"])}var w=A.observable.protoProperty;A.computed[w]=A.observable;_[w]=A.computed;A.isComputed=function(e){return A.hasPrototype(e,A.computed)};A.isPureComputed=function(e){return A.hasPrototype(e,A.computed)&&e[p]&&e[p].pure};A.exportSymbol("computed",A.computed);A.exportSymbol("dependentObservable",A.computed);A.exportSymbol("isComputed",A.isComputed);A.exportSymbol("isPureComputed",A.isPureComputed);A.exportSymbol("computed.fn",_);A.exportProperty(_,"peek",_.peek);A.exportProperty(_,"dispose",_.dispose);A.exportProperty(_,"isActive",_.isActive);A.exportProperty(_,"getDependenciesCount",_.getDependenciesCount);A.pureComputed=function(e,t){if(typeof e==="function"){return A.computed(e,t,{pure:true})}else{e=A.utils.extend({},e);e["pure"]=true;return A.computed(e,t)}};A.exportSymbol("pureComputed",A.pureComputed);(function(){var r=10;A.toJS=function(e){if(arguments.length==0)throw new Error("When calling ko.toJS, pass the object you want to convert.");return s(e,function(e){for(var t=0;A.isObservable(e)&&t<r;t++)e=e();return e})};A.toJSON=function(e,t,r){var i=A.toJS(e);return A.utils.stringifyJson(i,t,r)};function s(i,n,a){a=a||new l;i=n(i);var e=typeof i=="object"&&i!==null&&i!==k&&!(i instanceof RegExp)&&!(i instanceof Date)&&!(i instanceof String)&&!(i instanceof Number)&&!(i instanceof Boolean);if(!e)return i;var o=i instanceof Array?[]:{};a.save(i,o);t(i,function(e){var t=n(i[e]);switch(typeof t){case"boolean":case"number":case"string":case"function":o[e]=t;break;case"object":case"undefined":var r=a.get(t);o[e]=r!==k?r:s(t,n,a);break}});return o}function t(e,t){if(e instanceof Array){for(var r=0;r<e.length;r++)t(r);if(typeof e["toJSON"]=="function")t("toJSON")}else{for(var i in e){t(i)}}}function l(){this.keys=[];this.values=[]}l.prototype={constructor:l,save:function(e,t){var r=A.utils.arrayIndexOf(this.keys,e);if(r>=0)this.values[r]=t;else{this.keys.push(e);this.values.push(t)}},get:function(e){var t=A.utils.arrayIndexOf(this.keys,e);return t>=0?this.values[t]:k}}})();A.exportSymbol("toJS",A.toJS);A.exportSymbol("toJSON",A.toJSON);(function(){var s="__ko__hasDomDataOptionValue__";A.selectExtensions={readValue:function(e){switch(A.utils.tagNameLower(e)){case"option":if(e[s]===true)return A.utils.domData.get(e,A.bindingHandlers.options.optionValueDomDataKey);return A.utils.ieVersion<=7?e.getAttributeNode("value")&&e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return e.selectedIndex>=0?A.selectExtensions.readValue(e.options[e.selectedIndex]):k;default:return e.value}},writeValue:function(e,t,r){switch(A.utils.tagNameLower(e)){case"option":switch(typeof t){case"string":A.utils.domData.set(e,A.bindingHandlers.options.optionValueDomDataKey,k);if(s in e){delete e[s]}e.value=t;break;default:A.utils.domData.set(e,A.bindingHandlers.options.optionValueDomDataKey,t);e[s]=true;e.value=typeof t==="number"?t:"";break}break;case"select":if(t===""||t===null)t=k;var i=-1;for(var n=0,a=e.options.length,o;n<a;++n){o=A.selectExtensions.readValue(e.options[n]);if(o==t||o==""&&t===k){i=n;break}}if(r||i>=0||t===k&&e.size>1){e.selectedIndex=i}break;default:if(t===null||t===k)t="";e.value=t;break}}}})();A.exportSymbol("selectExtensions",A.selectExtensions);A.exportSymbol("selectExtensions.readValue",A.selectExtensions.readValue);A.exportSymbol("selectExtensions.writeValue",A.selectExtensions.writeValue);A.expressionRewriting=function(){var r=["true","false","null","undefined"];var i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;function u(e){if(A.utils.arrayIndexOf(r,e)>=0)return false;var t=e.match(i);return t===null?false:t[1]?"Object("+t[1]+")"+t[2]:e}var e='"(?:[^"\\\\]|\\\\.)*"',t="'(?:[^'\\\\]|\\\\.)*'",n="/(?:[^/\\\\]|\\\\.)*/w*",a=",\"'{}()/:[\\]",o="[^\\s:,/][^"+a+"]*[^\\s"+a+"]",s="[^\\s]",c=RegExp(e+"|"+t+"|"+n+"|"+o+"|"+s,"g"),f=/[\])"'A-Za-z0-9_$]+$/,h={in:1,return:1,typeof:1};function d(e){var t=A.utils.stringTrim(e);if(t.charCodeAt(0)===123)t=t.slice(1,-1);var r=[],i=t.match(c),n,a=[],o=0;if(i){i.push(",");for(var s=0,l;l=i[s];++s){var u=l.charCodeAt(0);if(u===44){if(o<=0){r.push(n&&a.length?{key:n,value:a.join("")}:{unknown:n||a.join("")});n=o=0;a=[];continue}}else if(u===58){if(!o&&!n&&a.length===1){n=a.pop();continue}}else if(u===47&&s&&l.length>1){var d=i[s-1].match(f);if(d&&!h[d[0]]){t=t.substr(t.indexOf(l)+1);i=t.match(c);i.push(",");s=-1;l="/"}}else if(u===40||u===123||u===91){++o}else if(u===41||u===125||u===93){--o}else if(!n&&!a.length&&(u===34||u===39)){l=l.slice(1,-1)}a.push(l)}}return r}var p={};function l(e,t){t=t||{};function n(t,r){var e;function i(e){return e&&e["preprocess"]?r=e["preprocess"](r,t,n):true}if(!l){if(!i(A["getBindingHandler"](t)))return;if(p[t]&&(e=u(r))){o.push("'"+t+"':function(_z){"+e+"=_z}")}}if(s){r="function(){return "+r+" }"}a.push("'"+t+"':"+r)}var a=[],o=[],s=t["valueAccessors"],l=t["bindingParams"],r=typeof e==="string"?d(e):e;A.utils.arrayForEach(r,function(e){n(e.key||e["unknown"],e.value)});if(o.length)n("_ko_property_writers","{"+o.join(",")+" }");return a.join(",")}return{bindingRewriteValidators:[],twoWayBindings:p,parseObjectLiteral:d,preProcessBindings:l,keyValueArrayContainsKey:function(e,t){for(var r=0;r<e.length;r++)if(e[r]["key"]==t)return true;return false},writeValueToProperty:function(e,t,r,i,n){if(!e||!A.isObservable(e)){var a=t.get("_ko_property_writers");if(a&&a[r])a[r](i)}else if(A.isWriteableObservable(e)&&(!n||e.peek()!==i)){e(i)}}}}();A.exportSymbol("expressionRewriting",A.expressionRewriting);A.exportSymbol("expressionRewriting.bindingRewriteValidators",A.expressionRewriting.bindingRewriteValidators);A.exportSymbol("expressionRewriting.parseObjectLiteral",A.expressionRewriting.parseObjectLiteral);A.exportSymbol("expressionRewriting.preProcessBindings",A.expressionRewriting.preProcessBindings);A.exportSymbol("expressionRewriting._twoWayBindings",A.expressionRewriting.twoWayBindings);A.exportSymbol("jsonExpressionRewriting",A.expressionRewriting);A.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",A.expressionRewriting.preProcessBindings);(function(){var r=S&&S.createComment("test").text==="\x3c!--test--\x3e";var i=r?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/;var t=r?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/;var a={ul:true,ol:true};function o(e){return e.nodeType==8&&i.test(r?e.text:e.nodeValue)}function s(e){return e.nodeType==8&&t.test(r?e.text:e.nodeValue)}function n(e,t){var r=e;var i=1;var n=[];while(r=r.nextSibling){if(s(r)){i--;if(i===0)return n}n.push(r);if(o(r))i++}if(!t)throw new Error("Cannot find closing comment tag to match: "+e.nodeValue);return null}function l(e,t){var r=n(e,t);if(r){if(r.length>0)return r[r.length-1].nextSibling;return e.nextSibling}else return null}function u(e){var t=e.firstChild,r=null;if(t){do{if(r)r.push(t);else if(o(t)){var i=l(t,true);if(i)t=i;else r=[t]}else if(s(t)){r=[t]}}while(t=t.nextSibling)}return r}A.virtualElements={allowedBindings:{},childNodes:function(e){return o(e)?n(e):e.childNodes},emptyNode:function(e){if(!o(e))A.utils.emptyDomNode(e);else{var t=A.virtualElements.childNodes(e);for(var r=0,i=t.length;r<i;r++)A.removeNode(t[r])}},setDomNodeChildren:function(e,t){if(!o(e))A.utils.setDomNodeChildren(e,t);else{A.virtualElements.emptyNode(e);var r=e.nextSibling;for(var i=0,n=t.length;i<n;i++)r.parentNode.insertBefore(t[i],r)}},prepend:function(e,t){if(!o(e)){if(e.firstChild)e.insertBefore(t,e.firstChild);else e.appendChild(t)}else{e.parentNode.insertBefore(t,e.nextSibling)}},insertAfter:function(e,t,r){if(!r){A.virtualElements.prepend(e,t)}else if(!o(e)){if(r.nextSibling)e.insertBefore(t,r.nextSibling);else e.appendChild(t)}else{e.parentNode.insertBefore(t,r.nextSibling)}},firstChild:function(e){if(!o(e))return e.firstChild;if(!e.nextSibling||s(e.nextSibling))return null;return e.nextSibling},nextSibling:function(e){if(o(e))e=l(e);if(e.nextSibling&&s(e.nextSibling))return null;return e.nextSibling},hasBindingValue:o,virtualNodeBindingValue:function(e){var t=(r?e.text:e.nodeValue).match(i);return t?t[1]:null},normaliseVirtualElementDomStructure:function(e){if(!a[A.utils.tagNameLower(e)])return;var t=e.firstChild;if(t){do{if(t.nodeType===1){var r=u(t);if(r){var i=t.nextSibling;for(var n=0;n<r.length;n++){if(i)e.insertBefore(r[n],i);else e.appendChild(r[n])}}}}while(t=t.nextSibling)}}}})();A.exportSymbol("virtualElements",A.virtualElements);A.exportSymbol("virtualElements.allowedBindings",A.virtualElements.allowedBindings);A.exportSymbol("virtualElements.emptyNode",A.virtualElements.emptyNode);A.exportSymbol("virtualElements.insertAfter",A.virtualElements.insertAfter);A.exportSymbol("virtualElements.prepend",A.virtualElements.prepend);A.exportSymbol("virtualElements.setDomNodeChildren",A.virtualElements.setDomNodeChildren);(function(){var r="data-bind";A.bindingProvider=function(){this.bindingCache={}};A.utils.extend(A.bindingProvider.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return e.getAttribute(r)!=null||A.components["getComponentNameForNode"](e);case 8:return A.virtualElements.hasBindingValue(e);default:return false}},getBindings:function(e,t){var r=this["getBindingsString"](e,t),i=r?this["parseBindingsString"](r,t,e):null;return A.components.addBindingsForCustomElement(i,e,t,false)},getBindingAccessors:function(e,t){var r=this["getBindingsString"](e,t),i=r?this["parseBindingsString"](r,t,e,{valueAccessors:true}):null;return A.components.addBindingsForCustomElement(i,e,t,true)},getBindingsString:function(e,t){switch(e.nodeType){case 1:return e.getAttribute(r);case 8:return A.virtualElements.virtualNodeBindingValue(e);default:return null}},parseBindingsString:function(t,e,r,i){try{var n=a(t,this.bindingCache,i);return n(e,r)}catch(e){e.message="Unable to parse bindings.\nBindings value: "+t+"\nMessage: "+e.message;throw e}}});A.bindingProvider["instance"]=new A.bindingProvider;function a(e,t,r){var i=e+(r&&r["valueAccessors"]||"");return t[i]||(t[i]=n(e,r))}function n(e,t){var r=A.expressionRewriting.preProcessBindings(e,t),i="with($context){with($data||{}){return{"+r+"}}}";return new Function("$context","$element",i)}})();A.exportSymbol("bindingProvider",A.bindingProvider);(function(){A.bindingHandlers={};var o={script:true,textarea:true,template:true};A["getBindingHandler"]=function(e){return A.bindingHandlers[e]};A.bindingContext=function(r,i,n,a,e){function t(){var e=l?r():r,t=A.utils.unwrapObservable(e);if(i){if(i._subscribable)i._subscribable();A.utils.extend(s,i);s._subscribable=d}else{s["$parents"]=[];s["$root"]=t;s["ko"]=A}s["$rawData"]=e;s["$data"]=t;if(n)s[n]=t;if(a)a(s,i,t);return s["$data"]}function o(){return u&&!A.utils.anyDomNodeIsAttachedToDocument(u)}var s=this,l=typeof r=="function"&&!A.isObservable(r),u,d;if(e&&e["exportDependencies"]){t()}else{d=A.dependentObservable(t,null,{disposeWhen:o,disposeWhenNodeIsRemoved:true});if(d.isActive()){s._subscribable=d;d["equalityComparer"]=null;u=[];d._addNode=function(e){u.push(e);A.utils.domNodeDisposal.addDisposeCallback(e,function(e){A.utils.arrayRemoveItem(u,e);if(!u.length){d.dispose();s._subscribable=d=k}})}}}};A.bindingContext.prototype["createChildContext"]=function(e,t,r,i){return new A.bindingContext(e,this,t,function(e,t){e["$parentContext"]=t;e["$parent"]=t["$data"];e["$parents"]=(t["$parents"]||[]).slice(0);e["$parents"].unshift(e["$parent"]);if(r)r(e)},i)};A.bindingContext.prototype["extend"]=function(r){return new A.bindingContext(this._subscribable||this["$data"],this,null,function(e,t){e["$rawData"]=t["$rawData"];A.utils.extend(e,typeof r=="function"?r():r)})};A.bindingContext.prototype.createStaticChildContext=function(e,t){return this["createChildContext"](e,t,null,{exportDependencies:true})};function i(e){return function(){return e}}function h(e){return e()}function n(r){return A.utils.objectMap(A.dependencyDetection.ignore(r),function(e,t){return function(){return r()[t]}})}function a(e,t,r){if(typeof e==="function"){return n(e.bind(null,t,r))}else{return A.utils.objectMap(e,i)}}function p(e,t){return n(this["getBindings"].bind(this,e,t))}function v(e){var t=A.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function s(e,t,r){var i,n=A.virtualElements.firstChild(t),a=A.bindingProvider["instance"],o=a["preprocessNode"];if(o){while(i=n){n=A.virtualElements.nextSibling(i);o.call(a,i)}n=A.virtualElements.firstChild(t)}while(i=n){n=A.virtualElements.nextSibling(i);l(e,i,r)}}function l(e,t,r){var i=true;var n=t.nodeType===1;if(n)A.virtualElements.normaliseVirtualElementDomStructure(t);var a=n&&r||A.bindingProvider["instance"]["nodeHasBindings"](t);if(a)i=u(t,null,e,r)["shouldBindDescendants"];if(i&&!o[A.utils.tagNameLower(t)]){s(e,t,!n)}}var m=A.utils.domData.nextKey();function _(i){var n=[],a={},o=[];A.utils.objectForEach(i,function t(e){if(!a[e]){var r=A["getBindingHandler"](e);if(r){if(r["after"]){o.push(e);A.utils.arrayForEach(r["after"],function(e){if(i[e]){if(A.utils.arrayIndexOf(o,e)!==-1){throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+o.join(", "))}else{t(e)}}});o.length--}n.push({key:e,handler:r})}a[e]=true}});return n}function u(n,e,a,t){var r=A.utils.domData.get(n,m);if(!e){if(r){throw Error("You cannot apply bindings multiple times to the same element.")}A.utils.domData.set(n,m,true)}if(!r&&t)A.storedBindingContextForNode(n,a);var o;if(e&&typeof e!=="function"){o=e}else{var i=A.bindingProvider["instance"],s=i["getBindingAccessors"]||p;var l=A.dependentObservable(function(){o=e?e(a,n):s.call(i,n,a);if(o&&a._subscribable)a._subscribable();return o},null,{disposeWhenNodeIsRemoved:n});if(!o||!l.isActive())l=null}var u;if(o){var d=l?function(e){return function(){return h(l()[e])}}:function(e){return o[e]};function c(){return A.utils.objectMap(l?l():o,h)}c["get"]=function(e){return o[e]&&h(d(e))};c["has"]=function(e){return e in o};var f=_(o);A.utils.arrayForEach(f,function(e){var t=e.handler["init"],r=e.handler["update"],i=e.key;if(n.nodeType===8){v(i)}try{if(typeof t=="function"){A.dependencyDetection.ignore(function(){var e=t(n,d(i),c,a["$data"],a);if(e&&e["controlsDescendantBindings"]){if(u!==k)throw new Error("Multiple bindings ("+u+" and "+i+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=i}})}if(typeof r=="function"){A.dependentObservable(function(){r(n,d(i),c,a["$data"],a)},null,{disposeWhenNodeIsRemoved:n})}}catch(e){e.message='Unable to process binding "'+i+": "+o[i]+'"\nMessage: '+e.message;throw e}})}return{shouldBindDescendants:u===k}}var r=A.utils.domData.nextKey();A.storedBindingContextForNode=function(e,t){if(arguments.length==2){A.utils.domData.set(e,r,t);if(t._subscribable)t._subscribable._addNode(e)}else{return A.utils.domData.get(e,r)}};function d(e){return e&&e instanceof A.bindingContext?e:new A.bindingContext(e)}A.applyBindingAccessorsToNode=function(e,t,r){if(e.nodeType===1)A.virtualElements.normaliseVirtualElementDomStructure(e);return u(e,t,d(r),true)};A.applyBindingsToNode=function(e,t,r){var i=d(r);return A.applyBindingAccessorsToNode(e,a(t,i,e),i)};A.applyBindingsToDescendants=function(e,t){if(t.nodeType===1||t.nodeType===8)s(d(e),t,true)};A.applyBindings=function(e,t){if(!D&&E["jQuery"]){D=E["jQuery"]}if(t&&t.nodeType!==1&&t.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");t=t||E.document.body;l(d(e),t,true)};A.contextFor=function(e){switch(e.nodeType){case 1:case 8:var t=A.storedBindingContextForNode(e);if(t)return t;if(e.parentNode)return A.contextFor(e.parentNode);break}return k};A.dataFor=function(e){var t=A.contextFor(e);return t?t["$data"]:k};A.exportSymbol("bindingHandlers",A.bindingHandlers);A.exportSymbol("applyBindings",A.applyBindings);A.exportSymbol("applyBindingsToDescendants",A.applyBindingsToDescendants);A.exportSymbol("applyBindingAccessorsToNode",A.applyBindingAccessorsToNode);A.exportSymbol("applyBindingsToNode",A.applyBindingsToNode);A.exportSymbol("contextFor",A.contextFor);A.exportSymbol("dataFor",A.dataFor)})();(function(l){var o={},s={};A.components={get:function(e,t){var r=u(s,e);if(r){if(r.isSynchronousComponent){A.dependencyDetection.ignore(function(){t(r.definition)})}else{A.tasks.schedule(function(){t(r.definition)})}}else{i(e,t)}},clearCachedDefinition:function(e){delete s[e]},_getFirstResultFromLoaders:d};function u(e,t){return e.hasOwnProperty(t)?e[t]:l}function i(i,e){var n=u(o,i),a;if(!n){n=o[i]=new A.subscribable;n.subscribe(e);t(i,function(e,t){var r=!!(t&&t["synchronous"]);s[i]={definition:e,isSynchronousComponent:r};delete o[i];if(a||r){n["notifySubscribers"](e)}else{A.tasks.schedule(function(){n["notifySubscribers"](e)})}});a=true}else{n.subscribe(e)}}function t(e,r){d("getConfig",[e],function(t){if(t){d("loadComponent",[e,t],function(e){r(e,t)})}else{r(null,null)}})}function d(t,r,i,n){if(!n){n=A.components["loaders"].slice(0)}var e=n.shift();if(e){var a=e[t];if(a){var o=false,s=a.apply(e,r.concat(function(e){if(o){i(null)}else if(e!==null){i(e)}else{d(t,r,i,n)}}));if(s!==l){o=true;if(!e["suppressLoaderExceptions"]){throw new Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}}}else{d(t,r,i,n)}}else{i(null)}}A.components["loaders"]=[];A.exportSymbol("components",A.components);A.exportSymbol("components.get",A.components.get);A.exportSymbol("components.clearCachedDefinition",A.components.clearCachedDefinition)})();(function(e){var i={};A.components.register=function(e,t){if(!t){throw new Error("Invalid configuration for "+e)}if(A.components.isRegistered(e)){throw new Error("Component "+e+" is already registered")}i[e]=t};A.components.isRegistered=function(e){return i.hasOwnProperty(e)};A.components.unregister=function(e){delete i[e];A.components.clearCachedDefinition(e)};A.components.defaultLoader={getConfig:function(e,t){var r=i.hasOwnProperty(e)?i[e]:null;t(r)},loadComponent:function(t,e,r){var i=f(t);c(i,e,function(e){n(t,i,e,r)})},loadTemplate:function(e,t,r){a(f(e),t,r)},loadViewModel:function(e,t,r){o(f(e),t,r)}};var u="createViewModel";function n(t,e,r,i){var n={},a=2,o=function(){if(--a===0){i(n)}},s=r["template"],l=r["viewModel"];if(s){c(e,s,function(e){A.components._getFirstResultFromLoaders("loadTemplate",[t,e],function(e){n["template"]=e;o()})})}else{o()}if(l){c(e,l,function(e){A.components._getFirstResultFromLoaders("loadViewModel",[t,e],function(e){n[u]=e;o()})})}else{o()}}function a(e,t,r){if(typeof t==="string"){r(A.utils.parseHtmlFragment(t))}else if(t instanceof Array){r(t)}else if(d(t)){r(A.utils.makeArray(t.childNodes))}else if(t["element"]){var i=t["element"];if(l(i)){r(s(i))}else if(typeof i==="string"){var n=S.getElementById(i);if(n){r(s(n))}else{e("Cannot find element with ID "+i)}}else{e("Unknown element type: "+i)}}else{e("Unknown template value: "+t)}}function o(e,t,r){if(typeof t==="function"){r(function(e){return new t(e)})}else if(typeof t[u]==="function"){r(t[u])}else if("instance"in t){var i=t["instance"];r(function(e,t){return i})}else if("viewModel"in t){o(e,t["viewModel"],r)}else{e("Unknown viewModel value: "+t)}}function s(e){switch(A.utils.tagNameLower(e)){case"script":return A.utils.parseHtmlFragment(e.text);case"textarea":return A.utils.parseHtmlFragment(e.value);case"template":if(d(e.content)){return A.utils.cloneNodes(e.content.childNodes)}}return A.utils.cloneNodes(e.childNodes)}function l(e){if(E["HTMLElement"]){return e instanceof HTMLElement}else{return e&&e.tagName&&e.nodeType===1}}function d(e){if(E["DocumentFragment"]){return e instanceof DocumentFragment}else{return e&&e.nodeType===11}}function c(e,t,r){if(typeof t["require"]==="string"){if(h||E["require"]){(h||E["require"])([t["require"]],r)}else{e("Uses require, but no AMD loader is present")}}else{r(t)}}function f(t){return function(e){throw new Error("Component '"+t+"': "+e)}}A.exportSymbol("components.register",A.components.register);A.exportSymbol("components.isRegistered",A.components.isRegistered);A.exportSymbol("components.unregister",A.components.unregister);A.exportSymbol("components.defaultLoader",A.components.defaultLoader);A.components["loaders"].push(A.components.defaultLoader);A.components._allRegisteredComponents=i})();(function(e){A.components["getComponentNameForNode"]=function(e){var t=A.utils.tagNameLower(e);if(A.components.isRegistered(t)){if(t.indexOf("-")!=-1||""+e=="[object HTMLUnknownElement]"||A.utils.ieVersion<=8&&e.tagName===t){return t}}};A.components.addBindingsForCustomElement=function(e,t,r,i){if(t.nodeType===1){var n=A.components["getComponentNameForNode"](t);if(n){e=e||{};if(e["component"]){throw new Error('Cannot use the "component" binding on a custom element matching a component')}var a={name:n,params:s(t,r)};e["component"]=i?function(){return a}:a}}return e};var o=new A.bindingProvider;function s(i,e){var t=i.getAttribute("params");if(t){var r=o["parseBindingsString"](t,e,i,{valueAccessors:true,bindingParams:true}),n=A.utils.objectMap(r,function(e,t){return A.computed(e,null,{disposeWhenNodeIsRemoved:i})}),a=A.utils.objectMap(n,function(t,e){var r=t.peek();if(!t.isActive()){return r}else{return A.computed({read:function(){return A.utils.unwrapObservable(t())},write:A.isWriteableObservable(r)&&function(e){t()(e)},disposeWhenNodeIsRemoved:i})}});if(!a.hasOwnProperty("$raw")){a["$raw"]=n}return a}else{return{$raw:{}}}}if(A.utils.ieVersion<9){A.components["register"]=function(t){return function(e){S.createElement(e);return t.apply(this,arguments)}}(A.components["register"]);S.createDocumentFragment=function(i){return function(){var e=i(),t=A.components._allRegisteredComponents;for(var r in t){if(t.hasOwnProperty(r)){e.createElement(r)}}return e}}(S.createDocumentFragment)}})();(function(f){var h=0;A.bindingHandlers["component"]={init:function(o,t,e,r,s){var l,u,d=function(){var e=l&&l["dispose"];if(typeof e==="function"){e.call(l)}l=null;u=null},c=A.utils.makeArray(A.virtualElements.childNodes(o));A.utils.domNodeDisposal.addDisposeCallback(o,d);A.computed(function(){var e=A.utils.unwrapObservable(t()),i,n;if(typeof e==="string"){i=e}else{i=A.utils.unwrapObservable(e["name"]);n=A.utils.unwrapObservable(e["params"])}if(!i){throw new Error("No component name specified")}var a=u=++h;A.components.get(i,function(e){if(u!==a){return}d();if(!e){throw new Error("Unknown component '"+i+"'")}p(i,e,o);var t=v(e,o,c,n),r=s["createChildContext"](t,f,function(e){e["$component"]=t;e["$componentTemplateNodes"]=c});l=t;A.applyBindingsToDescendants(r,o)})},null,{disposeWhenNodeIsRemoved:o});return{controlsDescendantBindings:true}}};A.virtualElements.allowedBindings["component"]=true;function p(e,t,r){var i=t["template"];if(!i){throw new Error("Component '"+e+"' has no template")}var n=A.utils.cloneNodes(i);A.virtualElements.setDomNodeChildren(r,n)}function v(e,t,r,i){var n=e["createViewModel"];return n?n.call(e,i,{element:t,templateNodes:r}):i}})();var F={class:"className",for:"htmlFor"};A.bindingHandlers["attr"]={update:function(i,e,t){var r=A.utils.unwrapObservable(e())||{};A.utils.objectForEach(r,function(e,t){t=A.utils.unwrapObservable(t);var r=t===false||t===null||t===k;if(r)i.removeAttribute(e);if(A.utils.ieVersion<=8&&e in F){e=F[e];if(r)i.removeAttribute(e);else i[e]=t}else if(!r){i.setAttribute(e,t.toString())}if(e==="name"){A.utils.setElementName(i,r?"":t.toString())}})}};(function(){A.bindingHandlers["checked"]={after:["value","attr"],init:function(n,a,o){var s=A.pureComputed(function(){if(o["has"]("checkedValue")){return A.utils.unwrapObservable(o.get("checkedValue"))}else if(o["has"]("value")){return A.utils.unwrapObservable(o.get("value"))}return n.value});function e(){var e=n.checked,t=f?s():e;if(A.computedContext.isInitial()){return}if(l&&!e){return}var r=A.dependencyDetection.ignore(a);if(u){var i=d?r.peek():r;if(c!==t){if(e){A.utils.addOrRemoveItem(i,t,true);A.utils.addOrRemoveItem(i,c,false)}c=t}else{A.utils.addOrRemoveItem(i,t,e)}if(d&&A.isWriteableObservable(r)){r(i)}}else{A.expressionRewriting.writeValueToProperty(r,o,"checked",t,true)}}function t(){var e=A.utils.unwrapObservable(a());if(u){n.checked=A.utils.arrayIndexOf(e,s())>=0}else if(r){n.checked=e}else{n.checked=s()===e}}var r=n.type=="checkbox",l=n.type=="radio";if(!r&&!l){return}var i=a(),u=r&&A.utils.unwrapObservable(i)instanceof Array,d=!(u&&i.push&&i.splice),c=u?s():k,f=l||u;if(l&&!n.name)A.bindingHandlers["uniqueName"]["init"](n,function(){return true});A.computed(e,null,{disposeWhenNodeIsRemoved:n});A.utils.registerEventHandler(n,"click",e);A.computed(t,null,{disposeWhenNodeIsRemoved:n});i=k}};A.expressionRewriting.twoWayBindings["checked"]=true;A.bindingHandlers["checkedValue"]={update:function(e,t){e.value=A.utils.unwrapObservable(t())}}})();var b="__ko__cssValue";A.bindingHandlers["css"]={update:function(r,e){var t=A.utils.unwrapObservable(e());if(t!==null&&typeof t=="object"){A.utils.objectForEach(t,function(e,t){t=A.utils.unwrapObservable(t);A.utils.toggleDomNodeCssClass(r,e,t)})}else{t=A.utils.stringTrim(String(t||""));A.utils.toggleDomNodeCssClass(r,r[b],false);r[b]=t;A.utils.toggleDomNodeCssClass(r,t,true)}}};A.bindingHandlers["enable"]={update:function(e,t){var r=A.utils.unwrapObservable(t());if(r&&e.disabled)e.removeAttribute("disabled");else if(!r&&!e.disabled)e.disabled=true}};A.bindingHandlers["disable"]={update:function(e,t){A.bindingHandlers["enable"]["update"](e,function(){return!A.utils.unwrapObservable(t())})}};function C(o){A.bindingHandlers[o]={init:function(e,t,r,i,n){var a=function(){var e={};e[o]=t();return e};return A.bindingHandlers["event"]["init"].call(this,e,a,r,i,n)}}}A.bindingHandlers["event"]={init:function(e,o,s,l,u){var t=o()||{};A.utils.objectForEach(t,function(a){if(typeof a=="string"){A.utils.registerEventHandler(e,a,function(e){var t;var r=o()[a];if(!r)return;try{var i=A.utils.makeArray(arguments);l=u["$data"];i.unshift(l);t=r.apply(l,i)}finally{if(t!==true){if(e.preventDefault)e.preventDefault();else e.returnValue=false}}var n=s.get(a+"Bubble")!==false;if(!n){e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation()}})}})}};A.bindingHandlers["foreach"]={makeTemplateValueAccessor:function(r){return function(){var e=r(),t=A.utils.peekObservable(e);if(!t||typeof t.length=="number")return{foreach:e,templateEngine:A.nativeTemplateEngine.instance};A.utils.unwrapObservable(e);return{foreach:t["data"],as:t["as"],includeDestroyed:t["includeDestroyed"],afterAdd:t["afterAdd"],beforeRemove:t["beforeRemove"],afterRender:t["afterRender"],beforeMove:t["beforeMove"],afterMove:t["afterMove"],templateEngine:A.nativeTemplateEngine.instance}}},init:function(e,t,r,i,n){return A.bindingHandlers["template"]["init"](e,A.bindingHandlers["foreach"].makeTemplateValueAccessor(t))},update:function(e,t,r,i,n){return A.bindingHandlers["template"]["update"](e,A.bindingHandlers["foreach"].makeTemplateValueAccessor(t),r,i,n)}};A.expressionRewriting.bindingRewriteValidators["foreach"]=false;A.virtualElements.allowedBindings["foreach"]=true;var x="__ko_hasfocusUpdating";var P="__ko_hasfocusLastValue";A.bindingHandlers["hasfocus"]={init:function(n,a,o){var e=function(e){n[x]=true;var t=n.ownerDocument;if("activeElement"in t){var r;try{r=t.activeElement}catch(e){r=t.body}e=r===n}var i=a();A.expressionRewriting.writeValueToProperty(i,o,"hasfocus",e,true);n[P]=e;n[x]=false};var t=e.bind(null,true);var r=e.bind(null,false);A.utils.registerEventHandler(n,"focus",t);A.utils.registerEventHandler(n,"focusin",t);A.utils.registerEventHandler(n,"blur",r);A.utils.registerEventHandler(n,"focusout",r)},update:function(e,t){var r=!!A.utils.unwrapObservable(t());if(!e[x]&&e[P]!==r){r?e.focus():e.blur();if(!r&&e[P]){e.ownerDocument.body.focus()}A.dependencyDetection.ignore(A.utils.triggerEvent,null,[e,r?"focusin":"focusout"])}}};A.expressionRewriting.twoWayBindings["hasfocus"]=true;A.bindingHandlers["hasFocus"]=A.bindingHandlers["hasfocus"];A.expressionRewriting.twoWayBindings["hasFocus"]=true;A.bindingHandlers["html"]={init:function(){return{controlsDescendantBindings:true}},update:function(e,t){A.utils.setHtml(e,t())}};function M(e,d,c,f){A.bindingHandlers[e]={init:function(a,o,e,t,s){var l,u;A.computed(function(){var e=o(),t=A.utils.unwrapObservable(e),r=!c!==!t,i=!u,n=i||d||r!==l;if(n){if(i&&A.computedContext.getDependenciesCount()){u=A.utils.cloneNodes(A.virtualElements.childNodes(a),true)}if(r){if(!i){A.virtualElements.setDomNodeChildren(a,A.utils.cloneNodes(u))}A.applyBindingsToDescendants(f?f(s,e):s,a)}else{A.virtualElements.emptyNode(a)}l=r}},null,{disposeWhenNodeIsRemoved:a});return{controlsDescendantBindings:true}}};A.expressionRewriting.bindingRewriteValidators[e]=false;A.virtualElements.allowedBindings[e]=true}M("if");M("ifnot",false,true);M("with",true,false,function(e,t){return e.createStaticChildContext(t)});var T={};A.bindingHandlers["options"]={init:function(e){if(A.utils.tagNameLower(e)!=="select")throw new Error("options binding applies only to SELECT elements");while(e.length>0){e.remove(0)}return{controlsDescendantBindings:true}},update:function(o,e,s){function t(){return A.utils.arrayFilter(o.options,function(e){return e.selected})}var r=o.length==0,i=o.multiple,n=!r&&i?o.scrollTop:null,a=A.utils.unwrapObservable(e()),l=s.get("valueAllowUnset")&&s["has"]("value"),u=s.get("optionsIncludeDestroyed"),d={},c,f,h=[];if(!l){if(i){h=A.utils.arrayMap(t(),A.selectExtensions.readValue)}else if(o.selectedIndex>=0){h.push(A.selectExtensions.readValue(o.options[o.selectedIndex]))}}if(a){if(typeof a.length=="undefined")a=[a];f=A.utils.arrayFilter(a,function(e){return u||e===k||e===null||!A.utils.unwrapObservable(e["_destroy"])});if(s["has"]("optionsCaption")){c=A.utils.unwrapObservable(s.get("optionsCaption"));if(c!==null&&c!==k){f.unshift(T)}}}else{}function p(e,t,r){var i=typeof t;if(i=="function")return t(e);else if(i=="string")return e[t];else return r}var v=false;function m(e,t,r){if(r.length){h=!l&&r[0].selected?[A.selectExtensions.readValue(r[0])]:[];v=true}var i=o.ownerDocument.createElement("option");if(e===T){A.utils.setTextContent(i,s.get("optionsCaption"));A.selectExtensions.writeValue(i,k)}else{var n=p(e,s.get("optionsValue"),e);A.selectExtensions.writeValue(i,A.utils.unwrapObservable(n));var a=p(e,s.get("optionsText"),n);A.utils.setTextContent(i,a)}return[i]}d["beforeRemove"]=function(e){o.removeChild(e)};function _(e,t){if(v&&l){A.selectExtensions.writeValue(o,A.utils.unwrapObservable(s.get("value")),true)}else if(h.length){var r=A.utils.arrayIndexOf(h,A.selectExtensions.readValue(t[0]))>=0;A.utils.setOptionNodeSelectionState(t[0],r);if(v&&!r){A.dependencyDetection.ignore(A.utils.triggerEvent,null,[o,"change"])}}}var y=_;if(s["has"]("optionsAfterRender")&&typeof s.get("optionsAfterRender")=="function"){y=function(e,t){_(e,t);A.dependencyDetection.ignore(s.get("optionsAfterRender"),null,[t[0],e!==T?e:k])}}A.utils.setDomNodeChildrenFromArrayMapping(o,f,m,d,y);A.dependencyDetection.ignore(function(){if(l){A.selectExtensions.writeValue(o,A.utils.unwrapObservable(s.get("value")),true)}else{var e;if(i){e=h.length&&t().length<h.length}else{e=h.length&&o.selectedIndex>=0?A.selectExtensions.readValue(o.options[o.selectedIndex])!==h[0]:h.length||o.selectedIndex>=0}if(e){A.utils.triggerEvent(o,"change")}}});A.utils.ensureSelectElementIsRenderedCorrectly(o);if(n&&Math.abs(n-o.scrollTop)>20)o.scrollTop=n}};A.bindingHandlers["options"].optionValueDomDataKey=A.utils.domData.nextKey();A.bindingHandlers["selectedOptions"]={after:["options","foreach"],init:function(r,i,n){A.utils.registerEventHandler(r,"change",function(){var e=i(),t=[];A.utils.arrayForEach(r.getElementsByTagName("option"),function(e){if(e.selected)t.push(A.selectExtensions.readValue(e))});A.expressionRewriting.writeValueToProperty(e,n,"selectedOptions",t)})},update:function(e,t){if(A.utils.tagNameLower(e)!="select")throw new Error("values binding applies only to SELECT elements");var r=A.utils.unwrapObservable(t()),i=e.scrollTop;if(r&&typeof r.length=="number"){A.utils.arrayForEach(e.getElementsByTagName("option"),function(e){var t=A.utils.arrayIndexOf(r,A.selectExtensions.readValue(e))>=0;if(e.selected!=t){A.utils.setOptionNodeSelectionState(e,t)}})}e.scrollTop=i}};A.expressionRewriting.twoWayBindings["selectedOptions"]=true;A.bindingHandlers["style"]={update:function(r,e){var t=A.utils.unwrapObservable(e()||{});A.utils.objectForEach(t,function(e,t){t=A.utils.unwrapObservable(t);if(t===null||t===k||t===false){t=""}r.style[e]=t})}};A.bindingHandlers["submit"]={init:function(i,n,e,t,a){if(typeof n()!="function")throw new Error("The value for a submit binding must be a function");A.utils.registerEventHandler(i,"submit",function(e){var t;var r=n();try{t=r.call(a["$data"],i)}finally{if(t!==true){if(e.preventDefault)e.preventDefault();else e.returnValue=false}}})}};A.bindingHandlers["text"]={init:function(){return{controlsDescendantBindings:true}},update:function(e,t){A.utils.setTextContent(e,t())}};A.virtualElements.allowedBindings["text"]=true;(function(){if(E&&E.navigator){var e=function(e){if(e){return parseFloat(e[1])}};var f=E.opera&&E.opera.version&&parseInt(E.opera.version()),t=E.navigator.userAgent,h=e(t.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),p=e(t.match(/Firefox\/([^ ]*)/))}if(A.utils.ieVersion<10){var i=A.utils.domData.nextKey(),n=A.utils.domData.nextKey();var a=function(e){var t=this.activeElement,r=t&&A.utils.domData.get(t,n);if(r){r(e)}};var v=function(e,t){var r=e.ownerDocument;if(!A.utils.domData.get(r,i)){A.utils.domData.set(r,i,true);A.utils.registerEventHandler(r,"selectionchange",a)}A.utils.domData.set(e,n,t)}}A.bindingHandlers["textInput"]={init:function(r,i,n){var a=r.value,o,s;var l=function(e){clearTimeout(o);s=o=k;var t=r.value;if(a!==t){if(R&&e)r["_ko_textInputProcessedEvent"]=e.type;a=t;A.expressionRewriting.writeValueToProperty(i(),n,"textInput",t)}};var t=function(e){if(!o){s=r.value;var t=R?l.bind(r,{type:e.type}):l;o=A.utils.setTimeout(t,4)}};var u=A.utils.ieVersion==9?t:l;var d=function(){var e=A.utils.unwrapObservable(i());if(e===null||e===k){e=""}if(s!==k&&e===s){A.utils.setTimeout(d,4);return}if(r.value!==e){a=e;r.value=e}};var c=function(e,t){A.utils.registerEventHandler(r,e,t)};if(R&&A.bindingHandlers["textInput"]["_forceUpdateOn"]){A.utils.arrayForEach(A.bindingHandlers["textInput"]["_forceUpdateOn"],function(e){if(e.slice(0,5)=="after"){c(e.slice(5),t)}else{c(e,l)}})}else{if(A.utils.ieVersion<10){c("propertychange",function(e){if(e.propertyName==="value"){u(e)}});if(A.utils.ieVersion==8){c("keyup",l);c("keydown",l)}if(A.utils.ieVersion>=8){v(r,u);c("dragend",t)}}else{c("input",l);if(h<5&&A.utils.tagNameLower(r)==="textarea"){c("keydown",t);c("paste",t);c("cut",t)}else if(f<11){c("keydown",t)}else if(p<4){c("DOMAutoComplete",l);c("dragdrop",l);c("drop",l)}}}c("change",l);A.computed(d,null,{disposeWhenNodeIsRemoved:r})}};A.expressionRewriting.twoWayBindings["textInput"]=true;A.bindingHandlers["textinput"]={preprocess:function(e,t,r){r("textInput",e)}}})();A.bindingHandlers["uniqueName"]={init:function(e,t){if(t()){var r="ko_unique_"+ ++A.bindingHandlers["uniqueName"].currentIndex;A.utils.setElementName(e,r)}}};A.bindingHandlers["uniqueName"].currentIndex=0;A.bindingHandlers["value"]={after:["options","foreach"],init:function(a,o,s){if(a.tagName.toLowerCase()=="input"&&(a.type=="checkbox"||a.type=="radio")){A.applyBindingAccessorsToNode(a,{checkedValue:o});return}var e=["change"];var t=s.get("valueUpdate");var r=false;var l=null;if(t){if(typeof t=="string")t=[t];A.utils.arrayPushAll(e,t);e=A.utils.arrayGetDistinctValues(e)}var i=function(){l=null;r=false;var e=o();var t=A.selectExtensions.readValue(a);A.expressionRewriting.writeValueToProperty(e,s,"value",t)};var n=A.utils.ieVersion&&a.tagName.toLowerCase()=="input"&&a.type=="text"&&a.autocomplete!="off"&&(!a.form||a.form.autocomplete!="off");if(n&&A.utils.arrayIndexOf(e,"propertychange")==-1){A.utils.registerEventHandler(a,"propertychange",function(){r=true});A.utils.registerEventHandler(a,"focus",function(){r=false});A.utils.registerEventHandler(a,"blur",function(){if(r){i()}})}A.utils.arrayForEach(e,function(e){var t=i;if(A.utils.stringStartsWith(e,"after")){t=function(){l=A.selectExtensions.readValue(a);A.utils.setTimeout(i,0)};e=e.substring("after".length)}A.utils.registerEventHandler(a,e,t)});var u=function(){var e=A.utils.unwrapObservable(o());var t=A.selectExtensions.readValue(a);if(l!==null&&e===l){A.utils.setTimeout(u,0);return}var r=e!==t;if(r){if(A.utils.tagNameLower(a)==="select"){var i=s.get("valueAllowUnset");var n=function(){A.selectExtensions.writeValue(a,e,i)};n();if(!i&&e!==A.selectExtensions.readValue(a)){A.dependencyDetection.ignore(A.utils.triggerEvent,null,[a,"change"])}else{A.utils.setTimeout(n,0)}}else{A.selectExtensions.writeValue(a,e)}}};A.computed(u,null,{disposeWhenNodeIsRemoved:a})},update:function(){}};A.expressionRewriting.twoWayBindings["value"]=true;A.bindingHandlers["visible"]={update:function(e,t){var r=A.utils.unwrapObservable(t());var i=!(e.style.display=="none");if(r&&!i)e.style.display="";else if(!r&&i)e.style.display="none"}};C("click");A.templateEngine=function(){};A.templateEngine.prototype["renderTemplateSource"]=function(e,t,r,i){throw new Error("Override renderTemplateSource")};A.templateEngine.prototype["createJavaScriptEvaluatorBlock"]=function(e){throw new Error("Override createJavaScriptEvaluatorBlock")};A.templateEngine.prototype["makeTemplateSource"]=function(e,t){if(typeof e=="string"){t=t||S;var r=t.getElementById(e);if(!r)throw new Error("Cannot find template with ID "+e);return new A.templateSources.domElement(r)}else if(e.nodeType==1||e.nodeType==8){return new A.templateSources.anonymousTemplate(e)}else throw new Error("Unknown template type: "+e)};A.templateEngine.prototype["renderTemplate"]=function(e,t,r,i){var n=this["makeTemplateSource"](e,i);return this["renderTemplateSource"](n,t,r,i)};A.templateEngine.prototype["isTemplateRewritten"]=function(e,t){if(this["allowTemplateRewriting"]===false)return true;return this["makeTemplateSource"](e,t)["data"]("isRewritten")};A.templateEngine.prototype["rewriteTemplate"]=function(e,t,r){var i=this["makeTemplateSource"](e,r);var n=t(i["text"]());i["text"](n);i["data"]("isRewritten",true)};A.exportSymbol("templateEngine",A.templateEngine);A.templateRewriting=function(){var r=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi;var i=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;function s(e){var t=A.expressionRewriting.bindingRewriteValidators;for(var r=0;r<e.length;r++){var i=e[r]["key"];if(t.hasOwnProperty(i)){var n=t[i];if(typeof n==="function"){var a=n(e[r]["value"]);if(a)throw new Error(a)}else if(!n){throw new Error("This template engine does not support the '"+i+"' binding within its templates")}}}}function n(e,t,r,i){var n=A.expressionRewriting.parseObjectLiteral(e);s(n);var a=A.expressionRewriting.preProcessBindings(n,{valueAccessors:true});var o="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a+" } })()},'"+r.toLowerCase()+"')";return i["createJavaScriptEvaluatorBlock"](o)+t}return{ensureTemplateIsRewritten:function(e,t,r){if(!t["isTemplateRewritten"](e,r))t["rewriteTemplate"](e,function(e){return A.templateRewriting.memoizeBindingAttributeSyntax(e,t)},r)},memoizeBindingAttributeSyntax:function(e,t){return e.replace(r,function(){return n(arguments[4],arguments[1],arguments[2],t)}).replace(i,function(){return n(arguments[1],"\x3c!-- ko --\x3e","#comment",t)})},applyMemoizedBindingsToNextSibling:function(i,n){return A.memoization.memoize(function(e,t){var r=e.nextSibling;if(r&&r.nodeName.toLowerCase()===n){A.applyBindingAccessorsToNode(r,i,t)}})}}}();A.exportSymbol("__tr_ambtns",A.templateRewriting.applyMemoizedBindingsToNextSibling);(function(){A.templateSources={};var r=1,i=2,n=3,a=4;A.templateSources.domElement=function(e){this.domElement=e;if(e){var t=A.utils.tagNameLower(e);this.templateType=t==="script"?r:t==="textarea"?i:t=="template"&&e.content&&e.content.nodeType===11?n:a}};A.templateSources.domElement.prototype["text"]=function(){var e=this.templateType===r?"text":this.templateType===i?"value":"innerHTML";if(arguments.length==0){return this.domElement[e]}else{var t=arguments[0];if(e==="innerHTML")A.utils.setHtml(this.domElement,t);else this.domElement[e]=t}};var t=A.utils.domData.nextKey()+"_";A.templateSources.domElement.prototype["data"]=function(e){if(arguments.length===1){return A.utils.domData.get(this.domElement,t+e)}else{A.utils.domData.set(this.domElement,t+e,arguments[1])}};var o=A.utils.domData.nextKey();function s(e){return A.utils.domData.get(e,o)||{}}function l(e,t){A.utils.domData.set(e,o,t)}A.templateSources.domElement.prototype["nodes"]=function(){var e=this.domElement;if(arguments.length==0){var t=s(e),r=t.containerData;return r||(this.templateType===n?e.content:this.templateType===a?e:k)}else{var i=arguments[0];l(e,{containerData:i})}};A.templateSources.anonymousTemplate=function(e){this.domElement=e};A.templateSources.anonymousTemplate.prototype=new A.templateSources.domElement;A.templateSources.anonymousTemplate.prototype.constructor=A.templateSources.anonymousTemplate;A.templateSources.anonymousTemplate.prototype["text"]=function(){if(arguments.length==0){var e=s(this.domElement);if(e.textData===k&&e.containerData)e.textData=e.containerData.innerHTML;return e.textData}else{var t=arguments[0];l(this.domElement,{textData:t})}};A.exportSymbol("templateSources",A.templateSources);A.exportSymbol("templateSources.domElement",A.templateSources.domElement);A.exportSymbol("templateSources.anonymousTemplate",A.templateSources.anonymousTemplate)})();(function(){var d;A.setTemplateEngine=function(e){if(e!=k&&!(e instanceof A.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");d=e};function i(e,t,r){var i,n=e,a=A.virtualElements.nextSibling(t);while(n&&(i=n)!==a){n=A.virtualElements.nextSibling(i);r(i,n)}}function c(e,t){if(e.length){var n=e[0],a=e[e.length-1],r=n.parentNode,o=A.bindingProvider["instance"],s=o["preprocessNode"];if(s){i(n,a,function(e,t){var r=e.previousSibling;var i=s.call(o,e);if(i){if(e===n)n=i[0]||t;if(e===a)a=i[i.length-1]||r}});e.length=0;if(!n){return}if(n===a){e.push(n)}else{e.push(n,a);A.utils.fixUpContinuousNodeArray(e,r)}}i(n,a,function(e){if(e.nodeType===1||e.nodeType===8)A.applyBindings(t,e)});i(n,a,function(e){if(e.nodeType===1||e.nodeType===8)A.memoization.unmemoizeDomNodeAndDescendants(e,[t])});A.utils.fixUpContinuousNodeArray(e,r)}}function f(e){return e.nodeType?e:e.length>0?e[0]:null}function h(e,t,r,i,n){n=n||{};var a=e&&f(e);var o=(a||r||{}).ownerDocument;var s=n["templateEngine"]||d;A.templateRewriting.ensureTemplateIsRewritten(r,s,o);var l=s["renderTemplate"](r,i,n,o);if(typeof l.length!="number"||l.length>0&&typeof l[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var u=false;switch(t){case"replaceChildren":A.virtualElements.setDomNodeChildren(e,l);u=true;break;case"replaceNode":A.utils.replaceDomNodes(e,l);u=true;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+t)}if(u){c(l,i);if(n["afterRender"])A.dependencyDetection.ignore(n["afterRender"],null,[l,i["$data"]])}return l}function p(e,t,r){if(A.isObservable(e)){return e()}else if(typeof e==="function"){return e(t,r)}else{return e}}A.renderTemplate=function(i,n,a,o,s){a=a||{};if((a["templateEngine"]||d)==k)throw new Error("Set a template engine before calling renderTemplate");s=s||"replaceChildren";if(o){var l=f(o);var e=function(){return!l||!A.utils.domNodeIsAttachedToDocument(l)};var t=l&&s=="replaceNode"?l.parentNode:l;return A.dependentObservable(function(){var e=n&&n instanceof A.bindingContext?n:new A.bindingContext(n,null,null,null,{exportDependencies:true});var t=p(i,e["$data"],e),r=h(o,s,t,e,a);if(s=="replaceNode"){o=r;l=f(o)}},null,{disposeWhen:e,disposeWhenNodeIsRemoved:t})}else{return A.memoization.memoize(function(e){A.renderTemplate(i,n,a,e,"replaceNode")})}};A.renderTemplateForEach=function(i,r,n,a,o){var s;var l=function(e,t){s=o["createChildContext"](e,n["as"],function(e){e["$index"]=t});var r=p(i,e,s);return h(null,"ignoreTargetNode",r,s,n)};var u=function(e,t,r){c(t,s);if(n["afterRender"])n["afterRender"](t,e);s=null};return A.dependentObservable(function(){var e=A.utils.unwrapObservable(r)||[];if(typeof e.length=="undefined")e=[e];var t=A.utils.arrayFilter(e,function(e){return n["includeDestroyed"]||e===k||e===null||!A.utils.unwrapObservable(e["_destroy"])});A.dependencyDetection.ignore(A.utils.setDomNodeChildrenFromArrayMapping,null,[a,t,l,n,u])},null,{disposeWhenNodeIsRemoved:a})};var n=A.utils.domData.nextKey();function v(e,t){var r=A.utils.domData.get(e,n);if(r&&typeof r.dispose=="function")r.dispose();A.utils.domData.set(e,n,t&&t.isActive()?t:k)}A.bindingHandlers["template"]={init:function(e,t){var r=A.utils.unwrapObservable(t());if(typeof r=="string"||r["name"]){A.virtualElements.emptyNode(e)}else if("nodes"in r){var i=r["nodes"]||[];if(A.isObservable(i)){throw new Error('The "nodes" option must be a plain, non-observable array.')}var n=A.utils.moveCleanedNodesToContainerElement(i);new A.templateSources.anonymousTemplate(e)["nodes"](n)}else{var a=A.virtualElements.childNodes(e),n=A.utils.moveCleanedNodesToContainerElement(a);new A.templateSources.anonymousTemplate(e)["nodes"](n)}return{controlsDescendantBindings:true}},update:function(e,t,r,i,n){var a=t(),o=A.utils.unwrapObservable(a),s=true,l=null,u;if(typeof o=="string"){u=a;o={}}else{u=o["name"];if("if"in o)s=A.utils.unwrapObservable(o["if"]);if(s&&"ifnot"in o)s=!A.utils.unwrapObservable(o["ifnot"])}if("foreach"in o){var d=s&&o["foreach"]||[];l=A.renderTemplateForEach(u||e,d,o,e,n)}else if(!s){A.virtualElements.emptyNode(e)}else{var c="data"in o?n.createStaticChildContext(o["data"],o["as"]):n;l=A.renderTemplate(u||e,c,o,e)}v(e,l)}};A.expressionRewriting.bindingRewriteValidators["template"]=function(e){var t=A.expressionRewriting.parseObjectLiteral(e);if(t.length==1&&t[0]["unknown"])return null;if(A.expressionRewriting.keyValueArrayContainsKey(t,"name"))return null;return"This template engine does not support anonymous templates nested within its templates"};A.virtualElements.allowedBindings["template"]=true})();A.exportSymbol("setTemplateEngine",A.setTemplateEngine);A.exportSymbol("renderTemplate",A.renderTemplate);A.utils.findMovesInArrayComparison=function(e,t,r){if(e.length&&t.length){var i,n,a,o,s;for(i=n=0;(!r||i<r)&&(o=e[n]);++n){for(a=0;s=t[a];++a){if(o["value"]===s["value"]){o["moved"]=s["index"];s["moved"]=o["index"];t.splice(a,1);i=a=0;break}}i+=a}}};A.utils.compareArrays=function(){var i="added",n="deleted";function e(e,t,r){r=typeof r==="boolean"?{dontLimitMoves:r}:r||{};e=e||[];t=t||[];if(e.length<t.length)return a(e,t,i,n,r);else return a(t,e,n,i,r)}function a(e,t,r,i,n){var a=Math.min,o=Math.max,s=[],l,u=e.length,d,c=t.length,f=c-u||1,h=u+c+1,p,v,m,_;for(l=0;l<=u;l++){v=p;s.push(p=[]);m=a(c,l+f);_=o(0,l-1);for(d=_;d<=m;d++){if(!d)p[d]=l+1;else if(!l)p[d]=d+1;else if(e[l-1]===t[d-1])p[d]=v[d-1];else{var y=v[d]||h;var g=p[d-1]||h;p[d]=a(y,g)+1}}}var w=[],F,b=[],C=[];for(l=u,d=c;l||d;){F=s[l][d]-1;if(d&&F===s[l][d-1]){b.push(w[w.length]={status:r,value:t[--d],index:d})}else if(l&&F===s[l-1][d]){C.push(w[w.length]={status:i,value:e[--l],index:l})}else{--d;--l;if(!n["sparse"]){w.push({status:"retained",value:t[d]})}}}A.utils.findMovesInArrayComparison(C,b,!n["dontLimitMoves"]&&u*10);return w.reverse()}return e}();A.exportSymbol("utils.compareArrays",A.utils.compareArrays);(function(){function T(t,r,i,n,a){var o=[];var e=A.dependentObservable(function(){var e=r(i,a,A.utils.fixUpContinuousNodeArray(o,t))||[];if(o.length>0){A.utils.replaceDomNodes(o,e);if(n)A.dependencyDetection.ignore(n,null,[i,e,a])}o.length=0;A.utils.arrayPushAll(o,e)},null,{disposeWhenNodeIsRemoved:t,disposeWhen:function(){return!A.utils.anyDomNodeIsAttachedToDocument(o)}});return{mappedNodes:o,dependentObservable:e.isActive()?e:k}}var E=A.utils.domData.nextKey(),S=A.utils.domData.nextKey();A.utils.setDomNodeChildrenFromArrayMapping=function(r,e,t,i,n){e=e||[];i=i||{};var a=A.utils.domData.get(r,E)===k;var o=A.utils.domData.get(r,E)||[];var s=A.utils.arrayMap(o,function(e){return e.arrayEntry});var l=A.utils.compareArrays(s,e,i["dontLimitMoves"]);var u=[];var d=0;var c=0;var f=[];var h=[];var p=[];var v=[];var m=[];var _;function y(e,t){_=o[t];if(c!==t)v[e]=_;_.indexObservable(c++);A.utils.fixUpContinuousNodeArray(_.mappedNodes,r);u.push(_);h.push(_)}function g(t,r){if(t){for(var i=0,e=r.length;i<e;i++){if(r[i]){A.utils.arrayForEach(r[i].mappedNodes,function(e){t(e,i,r[i].arrayEntry)})}}}}for(var w=0,F,b;F=l[w];w++){b=F["moved"];switch(F["status"]){case"deleted":if(b===k){_=o[d];if(_.dependentObservable){_.dependentObservable.dispose();_.dependentObservable=k}if(A.utils.fixUpContinuousNodeArray(_.mappedNodes,r).length){if(i["beforeRemove"]){u.push(_);h.push(_);if(_.arrayEntry===S){_=null}else{p[w]=_}}if(_){f.push.apply(f,_.mappedNodes)}}}d++;break;case"retained":y(w,d++);break;case"added":if(b!==k){y(w,b)}else{_={arrayEntry:F["value"],indexObservable:A.observable(c++)};u.push(_);h.push(_);if(!a)m[w]=_}break}}A.utils.domData.set(r,E,u);g(i["beforeMove"],v);A.utils.arrayForEach(f,i["beforeRemove"]?A.cleanNode:A.removeNode);for(var w=0,C=A.virtualElements.firstChild(r),x,P;_=h[w];w++){if(!_.mappedNodes)A.utils.extend(_,T(r,t,_.arrayEntry,n,_.indexObservable));for(var M=0;P=_.mappedNodes[M];C=P.nextSibling,x=P,M++){if(P!==C)A.virtualElements.insertAfter(r,P,x)}if(!_.initialized&&n){n(_.arrayEntry,_.mappedNodes,_.indexObservable);_.initialized=true}}g(i["beforeRemove"],p);for(w=0;w<p.length;++w){if(p[w]){p[w].arrayEntry=S}}g(i["afterMove"],v);g(i["afterAdd"],m)}})();A.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",A.utils.setDomNodeChildrenFromArrayMapping);A.nativeTemplateEngine=function(){this["allowTemplateRewriting"]=false};A.nativeTemplateEngine.prototype=new A.templateEngine;A.nativeTemplateEngine.prototype.constructor=A.nativeTemplateEngine;A.nativeTemplateEngine.prototype["renderTemplateSource"]=function(e,t,r,i){var n=!(A.utils.ieVersion<9),a=n?e["nodes"]:null,o=a?e["nodes"]():null;if(o){return A.utils.makeArray(o.cloneNode(true).childNodes)}else{var s=e["text"]();return A.utils.parseHtmlFragment(s,i)}};A.nativeTemplateEngine.instance=new A.nativeTemplateEngine;A.setTemplateEngine(A.nativeTemplateEngine.instance);A.exportSymbol("nativeTemplateEngine",A.nativeTemplateEngine);(function(){A.jqueryTmplTemplateEngine=function(){var e=this.jQueryTmplVersion=function(){if(!D||!D["tmpl"])return 0;try{if(D["tmpl"]["tag"]["tmpl"]["open"].toString().indexOf("__")>=0){return 2}}catch(e){}return 1}();function u(){if(e<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function d(e,t,r){return D["tmpl"](e,t,r)}this["renderTemplateSource"]=function(e,t,r,i){i=i||S;r=r||{};u();var n=e["data"]("precompiled");if(!n){var a=e["text"]()||"";a="{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}";n=D["template"](null,a);e["data"]("precompiled",n)}var o=[t["$data"]];var s=D["extend"]({koBindingContext:t},r["templateOptions"]);var l=d(n,o,s);l["appendTo"](i.createElement("div"));D["fragments"]={};return l};this["createJavaScriptEvaluatorBlock"]=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"};this["addTemplate"]=function(e,t){S.write("<script type='text/html' id='"+e+"'>"+t+"<"+"/script>")};if(e>0){D["tmpl"]["tag"]["ko_code"]={open:"__.push($1 || '');"};D["tmpl"]["tag"]["ko_with"]={open:"with($1) {",close:"} "}}};A.jqueryTmplTemplateEngine.prototype=new A.templateEngine;A.jqueryTmplTemplateEngine.prototype.constructor=A.jqueryTmplTemplateEngine;var e=new A.jqueryTmplTemplateEngine;if(e.jQueryTmplVersion>0)A.setTemplateEngine(e);A.exportSymbol("jqueryTmplTemplateEngine",A.jqueryTmplTemplateEngine)})()})})()})()},function(i,e,t){
/*! WeakMap shim
 * (The MIT License)
 *
 * Copyright (c) 2012 Brandon Benvie <http://bbenvie.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the 'Software'), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included with all copies or
 * substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING
 * BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY  CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
void function(p,v,m){var s=Object.getOwnPropertyNames,l=typeof window==="object"?Object.getOwnPropertyNames(window):[],u=Object.defineProperty,t=Function.prototype.toString,d=Object.create,c=Object.prototype.hasOwnProperty,r=/^\n?function\s?(\w*)?_?\(/;function _(e,t,r){if(typeof t==="function"){r=t;t=y(r).replace(/_$/,"")}return u(e,t,{configurable:true,writable:true,value:r})}function y(e){return typeof e!=="function"?"":"_name"in e?e._name:"name"in e?e.name:t.call(e).match(r)[1]}function g(e,t){t._name=e;return t}var w=function(){var a={value:{writable:true,value:m}},t=d(null),r=function(){var e=Math.random().toString(36).slice(2);return e in t?r():t[e]=e},n=r(),o=function(e){if(c.call(e,n))return e[n];if(!Object.isExtensible(e))throw new TypeError("Object must be extensible");var t=d(null);u(e,n,{value:t});return t};_(Object,g("getOwnPropertyNames",function e(t){var r=Object(t),i;if(r!==Window.prototype&&"toString"in r&&r.toString()==="[object Window]"){try{i=s(t)}catch(e){i=l}}else{i=s(t)}if(c.call(t,n))i.splice(i.indexOf(n),1);return i}));function e(){var i=r(),n={};this.unlock=function(e){var t=o(e);if(c.call(t,i))return t[i](n);var r=d(null,a);u(t,i,{value:function(e){if(e===n)return r}});return r}}_(e.prototype,g("get",function e(t){return this.unlock(t).value}));_(e.prototype,g("set",function e(t,r){this.unlock(t).value=r}));return e}();var n=function(i){var n=function(e){if(e==null||typeof e!=="object"&&typeof e!=="function")throw new TypeError("Invalid WeakMap key")};var t=function(e,t){var r=i.unlock(e);if(r.value)throw new TypeError("Object is already a WeakMap");r.value=t};var a=function(e){var t=i.unlock(e).value;if(!t)throw new TypeError("WeakMap is not generic");return t};var r=function(r,i){if(i!==null&&typeof i==="object"&&typeof i.forEach==="function"){i.forEach(function(e,t){if(e instanceof Array&&e.length===2)s.call(r,i[t][0],i[t][1])})}};function o(e){if(this===p||this==null||this===o.prototype)return new o(e);t(this,new w);r(this,e)}function e(e){n(e);var t=a(this).get(e);return t===v?m:t}function s(e,t){n(e);a(this).set(e,t===m?v:t)}function l(e){n(e);return a(this).get(e)!==m}function u(e){n(e);var t=a(this),r=t.get(e)!==m;t.set(e,m);return r}function d(){a(this);return"[object WeakMap]"}e._name="get";s._name="set";l._name="has";d._name="toString";var c=(""+Object).split("Object");var f=g("toString",function e(){return c[0]+y(this)+c[1]});_(f,f);var h={__proto__:[]}instanceof Array?function(e){e.__proto__=f}:function(e){_(e,f)};h(o);[d,e,s,l,u].forEach(function(e){_(o.prototype,e);h(e)});return o}(new w);var a=Object.create?function(){return Object.create(null)}:function(){return{}};function e(r){var i=new n;r||(r=a);function e(e,t){if(t||arguments.length===2){i.set(e,t)}else{t=i.get(e);if(t===m){t=r(e);i.set(e,t)}}return t}return e}if(true){i.exports=n}else{}n.createStorage=e;if(p.WeakMap)p.WeakMap.createStorage=e}(function(){return this}())},function(Ct,xt,Pt){var Mt;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
(function(a,i,e,c){"use strict";var o=["","webkit","Moz","MS","ms","o"];var t=i.createElement("div");var r="function";var s=Math.round;var f=Math.abs;var h=Date.now;function l(e,t,r){return setTimeout(y(e,r),t)}function n(e,t,r){if(Array.isArray(e)){u(e,r[t],r);return true}return false}function u(e,t,r){var i;if(!e){return}if(e.forEach){e.forEach(t,r)}else if(e.length!==c){i=0;while(i<e.length){t.call(r,e[i],i,e);i++}}else{for(i in e){e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}}}function d(i,e,t){var n="DEPRECATED METHOD: "+e+"\n"+t+" AT \n";return function(){var e=new Error("get-stack-trace");var t=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace";var r=a.console&&(a.console.warn||a.console.log);if(r){r.call(a.console,n,t)}return i.apply(this,arguments)}}var p;if(typeof Object.assign!=="function"){p=function e(t){if(t===c||t===null){throw new TypeError("Cannot convert undefined or null to object")}var r=Object(t);for(var i=1;i<arguments.length;i++){var n=arguments[i];if(n!==c&&n!==null){for(var a in n){if(n.hasOwnProperty(a)){r[a]=n[a]}}}}return r}}else{p=Object.assign}var v=d(function e(t,r,i){var n=Object.keys(r);var a=0;while(a<n.length){if(!i||i&&t[n[a]]===c){t[n[a]]=r[n[a]]}a++}return t},"extend","Use `assign`.");var m=d(function e(t,r){return v(t,r,true)},"merge","Use `assign`.");function _(e,t,r){var i=t.prototype,n;n=e.prototype=Object.create(i);n.constructor=e;n._super=i;if(r){p(n,r)}}function y(t,r){return function e(){return t.apply(r,arguments)}}function g(e,t){if(typeof e==r){return e.apply(t?t[0]||c:c,t)}return e}function w(e,t){return e===c?t:e}function F(t,e,r){u(P(e),function(e){t.addEventListener(e,r,false)})}function b(t,e,r){u(P(e),function(e){t.removeEventListener(e,r,false)})}function C(e,t){while(e){if(e==t){return true}e=e.parentNode}return false}function x(e,t){return e.indexOf(t)>-1}function P(e){return e.trim().split(/\s+/g)}function M(e,t,r){if(e.indexOf&&!r){return e.indexOf(t)}else{var i=0;while(i<e.length){if(r&&e[i][r]==t||!r&&e[i]===t){return i}i++}return-1}}function T(e){return Array.prototype.slice.call(e,0)}function E(e,i,t){var r=[];var n=[];var a=0;while(a<e.length){var o=i?e[a][i]:e[a];if(M(n,o)<0){r.push(e[a])}n[a]=o;a++}if(t){if(!i){r=r.sort()}else{r=r.sort(function e(t,r){return t[i]>r[i]})}}return r}function S(e,t){var r,i;var n=t[0].toUpperCase()+t.slice(1);var a=0;while(a<o.length){r=o[a];i=r?r+n:t;if(i in e){return i}a++}return c}var A=1;function k(){return A++}function L(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}var D=/mobile|tablet|ip(ad|hone|od)|android/i;var I="ontouchstart"in a;var R=S(a,"PointerEvent")!==c;var O=I&&D.test(navigator.userAgent);var N="touch";var B="pen";var H="mouse";var V="kinect";var G=25;var z=1;var U=2;var j=4;var q=8;var W=1;var X=2;var Z=4;var Y=8;var J=16;var Q=X|Z;var K=Y|J;var $=Q|K;var ee=["x","y"];var te=["clientX","clientY"];function re(t,e){var r=this;this.manager=t;this.callback=e;this.element=t.element;this.target=t.options.inputTarget;this.domHandler=function(e){if(g(t.options.enable,[t])){r.handler(e)}};this.init()}re.prototype={handler:function(){},init:function(){this.evEl&&F(this.element,this.evEl,this.domHandler);this.evTarget&&F(this.target,this.evTarget,this.domHandler);this.evWin&&F(L(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&b(this.element,this.evEl,this.domHandler);this.evTarget&&b(this.target,this.evTarget,this.domHandler);this.evWin&&b(L(this.element),this.evWin,this.domHandler)}};function ie(e){var t;var r=e.options.inputClass;if(r){t=r}else if(R){t=xe}else if(O){t=Le}else if(!I){t=ge}else{t=Oe}return new t(e,ne)}function ne(e,t,r){var i=r.pointers.length;var n=r.changedPointers.length;var a=t&z&&i-n===0;var o=t&(j|q)&&i-n===0;r.isFirst=!!a;r.isFinal=!!o;if(a){e.session={}}r.eventType=t;ae(e,r);e.emit("hammer.input",r);e.recognize(r);e.session.prevInput=r}function ae(e,t){var r=e.session;var i=t.pointers;var n=i.length;if(!r.firstInput){r.firstInput=le(t)}if(n>1&&!r.firstMultiple){r.firstMultiple=le(t)}else if(n===1){r.firstMultiple=false}var a=r.firstInput;var o=r.firstMultiple;var s=o?o.center:a.center;var l=t.center=ue(i);t.timeStamp=h();t.deltaTime=t.timeStamp-a.timeStamp;t.angle=he(s,l);t.distance=fe(s,l);oe(r,t);t.offsetDirection=ce(t.deltaX,t.deltaY);var u=de(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x;t.overallVelocityY=u.y;t.overallVelocity=f(u.x)>f(u.y)?u.x:u.y;t.scale=o?ve(o.pointers,i):1;t.rotation=o?pe(o.pointers,i):0;t.maxPointers=!r.prevInput?t.pointers.length:t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers;se(r,t);var d=e.element;if(C(t.srcEvent.target,d)){d=t.srcEvent.target}t.target=d}function oe(e,t){var r=t.center;var i=e.offsetDelta||{};var n=e.prevDelta||{};var a=e.prevInput||{};if(t.eventType===z||a.eventType===j){n=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0};i=e.offsetDelta={x:r.x,y:r.y}}t.deltaX=n.x+(r.x-i.x);t.deltaY=n.y+(r.y-i.y)}function se(e,t){var r=e.lastInterval||t,i=t.timeStamp-r.timeStamp,n,a,o,s;if(t.eventType!=q&&(i>G||r.velocity===c)){var l=t.deltaX-r.deltaX;var u=t.deltaY-r.deltaY;var d=de(i,l,u);a=d.x;o=d.y;n=f(d.x)>f(d.y)?d.x:d.y;s=ce(l,u);e.lastInterval=t}else{n=r.velocity;a=r.velocityX;o=r.velocityY;s=r.direction}t.velocity=n;t.velocityX=a;t.velocityY=o;t.direction=s}function le(e){var t=[];var r=0;while(r<e.pointers.length){t[r]={clientX:s(e.pointers[r].clientX),clientY:s(e.pointers[r].clientY)};r++}return{timeStamp:h(),pointers:t,center:ue(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ue(e){var t=e.length;if(t===1){return{x:s(e[0].clientX),y:s(e[0].clientY)}}var r=0,i=0,n=0;while(n<t){r+=e[n].clientX;i+=e[n].clientY;n++}return{x:s(r/t),y:s(i/t)}}function de(e,t,r){return{x:t/e||0,y:r/e||0}}function ce(e,t){if(e===t){return W}if(f(e)>=f(t)){return e<0?X:Z}return t<0?Y:J}function fe(e,t,r){if(!r){r=ee}var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.sqrt(i*i+n*n)}function he(e,t,r){if(!r){r=ee}var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.atan2(n,i)*180/Math.PI}function pe(e,t){return he(t[1],t[0],te)+he(e[1],e[0],te)}function ve(e,t){return fe(t[0],t[1],te)/fe(e[0],e[1],te)}var me={mousedown:z,mousemove:U,mouseup:j};var _e="mousedown";var ye="mousemove mouseup";function ge(){this.evEl=_e;this.evWin=ye;this.pressed=false;re.apply(this,arguments)}_(ge,re,{handler:function e(t){var r=me[t.type];if(r&z&&t.button===0){this.pressed=true}if(r&U&&t.which!==1){r=j}if(!this.pressed){return}if(r&j){this.pressed=false}this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:H,srcEvent:t})}});var we={pointerdown:z,pointermove:U,pointerup:j,pointercancel:q,pointerout:q};var Fe={2:N,3:B,4:H,5:V};var be="pointerdown";var Ce="pointermove pointerup pointercancel";if(a.MSPointerEvent&&!a.PointerEvent){be="MSPointerDown";Ce="MSPointerMove MSPointerUp MSPointerCancel"}function xe(){this.evEl=be;this.evWin=Ce;re.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}_(xe,re,{handler:function e(t){var r=this.store;var i=false;var n=t.type.toLowerCase().replace("ms","");var a=we[n];var o=Fe[t.pointerType]||t.pointerType;var s=o==N;var l=M(r,t.pointerId,"pointerId");if(a&z&&(t.button===0||s)){if(l<0){r.push(t);l=r.length-1}}else if(a&(j|q)){i=true}if(l<0){return}r[l]=t;this.callback(this.manager,a,{pointers:r,changedPointers:[t],pointerType:o,srcEvent:t});if(i){r.splice(l,1)}}});var Pe={touchstart:z,touchmove:U,touchend:j,touchcancel:q};var Me="touchstart";var Te="touchstart touchmove touchend touchcancel";function Ee(){this.evTarget=Me;this.evWin=Te;this.started=false;re.apply(this,arguments)}_(Ee,re,{handler:function e(t){var r=Pe[t.type];if(r===z){this.started=true}if(!this.started){return}var i=Se.call(this,t,r);if(r&(j|q)&&i[0].length-i[1].length===0){this.started=false}this.callback(this.manager,r,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:t})}});function Se(e,t){var r=T(e.touches);var i=T(e.changedTouches);if(t&(j|q)){r=E(r.concat(i),"identifier",true)}return[r,i]}var Ae={touchstart:z,touchmove:U,touchend:j,touchcancel:q};var ke="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=ke;this.targetIds={};re.apply(this,arguments)}_(Le,re,{handler:function e(t){var r=Ae[t.type];var i=De.call(this,t,r);if(!i){return}this.callback(this.manager,r,{pointers:i[0],changedPointers:i[1],pointerType:N,srcEvent:t})}});function De(e,t){var r=T(e.touches);var i=this.targetIds;if(t&(z|U)&&r.length===1){i[r[0].identifier]=true;return[r,r]}var n,a,o=T(e.changedTouches),s=[],l=this.target;a=r.filter(function(e){return C(e.target,l)});if(t===z){n=0;while(n<a.length){i[a[n].identifier]=true;n++}}n=0;while(n<o.length){if(i[o[n].identifier]){s.push(o[n])}if(t&(j|q)){delete i[o[n].identifier]}n++}if(!s.length){return}return[E(a.concat(s),"identifier",true),s]}var Ie=2500;var Re=25;function Oe(){re.apply(this,arguments);var e=y(this.handler,this);this.touch=new Le(this.manager,e);this.mouse=new ge(this.manager,e);this.primaryTouch=null;this.lastTouches=[]}_(Oe,re,{handler:function e(t,r,i){var n=i.pointerType==N,a=i.pointerType==H;if(a&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents){return}if(n){Ne.call(this,r,i)}else if(a&&He.call(this,i)){return}this.callback(t,r,i)},destroy:function e(){this.touch.destroy();this.mouse.destroy()}});function Ne(e,t){if(e&z){this.primaryTouch=t.changedPointers[0].identifier;Be.call(this,t)}else if(e&(j|q)){Be.call(this,t)}}function Be(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var i=this.lastTouches;var n=function(){var e=i.indexOf(r);if(e>-1){i.splice(e,1)}};setTimeout(n,Ie)}}function He(e){var t=e.srcEvent.clientX,r=e.srcEvent.clientY;for(var i=0;i<this.lastTouches.length;i++){var n=this.lastTouches[i];var a=Math.abs(t-n.x),o=Math.abs(r-n.y);if(a<=Re&&o<=Re){return true}}return false}var Ve=S(t.style,"touchAction");var Ge=Ve!==c;var ze="compute";var Ue="auto";var je="manipulation";var qe="none";var We="pan-x";var Xe="pan-y";var Ze=Qe();function Ye(e,t){this.manager=e;this.set(t)}Ye.prototype={set:function(e){if(e==ze){e=this.compute()}if(Ge&&this.manager.element.style&&Ze[e]){this.manager.element.style[Ve]=e}this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];u(this.manager.recognizers,function(e){if(g(e.options.enable,[e])){t=t.concat(e.getTouchAction())}});return Je(t.join(" "))},preventDefaults:function(e){var t=e.srcEvent;var r=e.offsetDirection;if(this.manager.session.prevented){t.preventDefault();return}var i=this.actions;var n=x(i,qe)&&!Ze[qe];var a=x(i,Xe)&&!Ze[Xe];var o=x(i,We)&&!Ze[We];if(n){var s=e.pointers.length===1;var l=e.distance<2;var u=e.deltaTime<250;if(s&&l&&u){return}}if(o&&a){return}if(n||a&&r&Q||o&&r&K){return this.preventSrc(t)}},preventSrc:function(e){this.manager.session.prevented=true;e.preventDefault()}};function Je(e){if(x(e,qe)){return qe}var t=x(e,We);var r=x(e,Xe);if(t&&r){return qe}if(t||r){return t?We:Xe}if(x(e,je)){return je}return Ue}function Qe(){if(!Ge){return false}var t={};var r=a.CSS&&a.CSS.supports;["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(e){t[e]=r?a.CSS.supports("touch-action",e):true});return t}var Ke=1;var $e=2;var et=4;var tt=8;var rt=tt;var it=16;var nt=32;function at(e){this.options=p({},this.defaults,e||{});this.id=k();this.manager=null;this.options.enable=w(this.options.enable,true);this.state=Ke;this.simultaneous={};this.requireFail=[]}at.prototype={defaults:{},set:function(e){p(this.options,e);this.manager&&this.manager.touchAction.update();return this},recognizeWith:function(e){if(n(e,"recognizeWith",this)){return this}var t=this.simultaneous;e=lt(e,this);if(!t[e.id]){t[e.id]=e;e.recognizeWith(this)}return this},dropRecognizeWith:function(e){if(n(e,"dropRecognizeWith",this)){return this}e=lt(e,this);delete this.simultaneous[e.id];return this},requireFailure:function(e){if(n(e,"requireFailure",this)){return this}var t=this.requireFail;e=lt(e,this);if(M(t,e)===-1){t.push(e);e.requireFailure(this)}return this},dropRequireFailure:function(e){if(n(e,"dropRequireFailure",this)){return this}e=lt(e,this);var t=M(this.requireFail,e);if(t>-1){this.requireFail.splice(t,1)}return this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(t){var r=this;var e=this.state;function i(e){r.manager.emit(e,t)}if(e<tt){i(r.options.event+ot(e))}i(r.options.event);if(t.additionalEvent){i(t.additionalEvent)}if(e>=tt){i(r.options.event+ot(e))}},tryEmit:function(e){if(this.canEmit()){return this.emit(e)}this.state=nt},canEmit:function(){var e=0;while(e<this.requireFail.length){if(!(this.requireFail[e].state&(nt|Ke))){return false}e++}return true},recognize:function(e){var t=p({},e);if(!g(this.options.enable,[this,t])){this.reset();this.state=nt;return}if(this.state&(rt|it|nt)){this.state=Ke}this.state=this.process(t);if(this.state&($e|et|tt|it)){this.tryEmit(t)}},process:function(e){},getTouchAction:function(){},reset:function(){}};function ot(e){if(e&it){return"cancel"}else if(e&tt){return"end"}else if(e&et){return"move"}else if(e&$e){return"start"}return""}function st(e){if(e==J){return"down"}else if(e==Y){return"up"}else if(e==X){return"left"}else if(e==Z){return"right"}return""}function lt(e,t){var r=t.manager;if(r){return r.get(e)}return e}function ut(){at.apply(this,arguments)}_(ut,at,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return t===0||e.pointers.length===t},process:function(e){var t=this.state;var r=e.eventType;var i=t&($e|et);var n=this.attrTest(e);if(i&&(r&q||!n)){return t|it}else if(i||n){if(r&j){return t|tt}else if(!(t&$e)){return $e}return t|et}return nt}});function dt(){ut.apply(this,arguments);this.pX=null;this.pY=null}_(dt,ut,{defaults:{event:"pan",threshold:10,pointers:1,direction:$},getTouchAction:function(){var e=this.options.direction;var t=[];if(e&Q){t.push(Xe)}if(e&K){t.push(We)}return t},directionTest:function(e){var t=this.options;var r=true;var i=e.distance;var n=e.direction;var a=e.deltaX;var o=e.deltaY;if(!(n&t.direction)){if(t.direction&Q){n=a===0?W:a<0?X:Z;r=a!=this.pX;i=Math.abs(e.deltaX)}else{n=o===0?W:o<0?Y:J;r=o!=this.pY;i=Math.abs(e.deltaY)}}e.direction=n;return r&&i>t.threshold&&n&t.direction},attrTest:function(e){return ut.prototype.attrTest.call(this,e)&&(this.state&$e||!(this.state&$e)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX;this.pY=e.deltaY;var t=st(e.direction);if(t){e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}});function ct(){ut.apply(this,arguments)}_(ct,ut,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[qe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&$e)},emit:function(e){if(e.scale!==1){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}});function ft(){at.apply(this,arguments);this._timer=null;this._input=null}_(ft,at,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ue]},process:function(e){var t=this.options;var r=e.pointers.length===t.pointers;var i=e.distance<t.threshold;var n=e.deltaTime>t.time;this._input=e;if(!i||!r||e.eventType&(j|q)&&!n){this.reset()}else if(e.eventType&z){this.reset();this._timer=l(function(){this.state=rt;this.tryEmit()},t.time,this)}else if(e.eventType&j){return rt}return nt},reset:function(){clearTimeout(this._timer)},emit:function(e){if(this.state!==rt){return}if(e&&e.eventType&j){this.manager.emit(this.options.event+"up",e)}else{this._input.timeStamp=h();this.manager.emit(this.options.event,this._input)}}});function ht(){ut.apply(this,arguments)}_(ht,ut,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[qe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&$e)}});function pt(){ut.apply(this,arguments)}_(pt,ut,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|K,pointers:1},getTouchAction:function(){return dt.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction;var r;if(t&(Q|K)){r=e.overallVelocity}else if(t&Q){r=e.overallVelocityX}else if(t&K){r=e.overallVelocityY}return this._super.attrTest.call(this,e)&&t&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(r)>this.options.velocity&&e.eventType&j},emit:function(e){var t=st(e.offsetDirection);if(t){this.manager.emit(this.options.event+t,e)}this.manager.emit(this.options.event,e)}});function vt(){at.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0}_(vt,at,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[je]},process:function(e){var t=this.options;var r=e.pointers.length===t.pointers;var i=e.distance<t.threshold;var n=e.deltaTime<t.time;this.reset();if(e.eventType&z&&this.count===0){return this.failTimeout()}if(i&&n&&r){if(e.eventType!=j){return this.failTimeout()}var a=this.pTime?e.timeStamp-this.pTime<t.interval:true;var o=!this.pCenter||fe(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp;this.pCenter=e.center;if(!o||!a){this.count=1}else{this.count+=1}this._input=e;var s=this.count%t.taps;if(s===0){if(!this.hasRequireFailures()){return rt}else{this._timer=l(function(){this.state=rt;this.tryEmit()},t.interval,this);return $e}}}return nt},failTimeout:function(){this._timer=l(function(){this.state=nt},this.options.interval,this);return nt},reset:function(){clearTimeout(this._timer)},emit:function(){if(this.state==rt){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input)}}});function mt(e,t){t=t||{};t.recognizers=w(t.recognizers,mt.defaults.preset);return new gt(e,t)}mt.VERSION="2.0.7";mt.defaults={domEvents:false,touchAction:ze,enable:true,inputTarget:null,inputClass:null,preset:[[ht,{enable:false}],[ct,{enable:false},["rotate"]],[pt,{direction:Q}],[dt,{direction:Q},["swipe"]],[vt],[vt,{event:"doubletap",taps:2},["tap"]],[ft]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var _t=1;var yt=2;function gt(e,t){this.options=p({},mt.defaults,t||{});this.options.inputTarget=this.options.inputTarget||e;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=e;this.input=ie(this);this.touchAction=new Ye(this,this.options.touchAction);wt(this,true);u(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]);e[3]&&t.requireFailure(e[3])},this)}gt.prototype={set:function(e){p(this.options,e);if(e.touchAction){this.touchAction.update()}if(e.inputTarget){this.input.destroy();this.input.target=e.inputTarget;this.input.init()}return this},stop:function(e){this.session.stopped=e?yt:_t},recognize:function(e){var t=this.session;if(t.stopped){return}this.touchAction.preventDefaults(e);var r;var i=this.recognizers;var n=t.curRecognizer;if(!n||n&&n.state&rt){n=t.curRecognizer=null}var a=0;while(a<i.length){r=i[a];if(t.stopped!==yt&&(!n||r==n||r.canRecognizeWith(n))){r.recognize(e)}else{r.reset()}if(!n&&r.state&($e|et|tt)){n=t.curRecognizer=r}a++}},get:function(e){if(e instanceof at){return e}var t=this.recognizers;for(var r=0;r<t.length;r++){if(t[r].options.event==e){return t[r]}}return null},add:function(e){if(n(e,"add",this)){return this}var t=this.get(e.options.event);if(t){this.remove(t)}this.recognizers.push(e);e.manager=this;this.touchAction.update();return e},remove:function(e){if(n(e,"remove",this)){return this}e=this.get(e);if(e){var t=this.recognizers;var r=M(t,e);if(r!==-1){t.splice(r,1);this.touchAction.update()}}return this},on:function(e,t){if(e===c){return}if(t===c){return}var r=this.handlers;u(P(e),function(e){r[e]=r[e]||[];r[e].push(t)});return this},off:function(e,t){if(e===c){return}var r=this.handlers;u(P(e),function(e){if(!t){delete r[e]}else{r[e]&&r[e].splice(M(r[e],t),1)}});return this},emit:function(e,t){if(this.options.domEvents){Ft(e,t)}var r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length){return}t.type=e;t.preventDefault=function(){t.srcEvent.preventDefault()};var i=0;while(i<r.length){r[i](t);i++}},destroy:function(){this.element&&wt(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null}};function wt(r,i){var n=r.element;if(!n.style){return}var a;u(r.options.cssProps,function(e,t){a=S(n.style,t);if(i){r.oldCssProps[a]=n.style[a];n.style[a]=e}else{n.style[a]=r.oldCssProps[a]||""}});if(!i){r.oldCssProps={}}}function Ft(e,t){var r=i.createEvent("Event");r.initEvent(e,true,true);r.gesture=t;t.target.dispatchEvent(r)}p(mt,{INPUT_START:z,INPUT_MOVE:U,INPUT_END:j,INPUT_CANCEL:q,STATE_POSSIBLE:Ke,STATE_BEGAN:$e,STATE_CHANGED:et,STATE_ENDED:tt,STATE_RECOGNIZED:rt,STATE_CANCELLED:it,STATE_FAILED:nt,DIRECTION_NONE:W,DIRECTION_LEFT:X,DIRECTION_RIGHT:Z,DIRECTION_UP:Y,DIRECTION_DOWN:J,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:K,DIRECTION_ALL:$,Manager:gt,Input:re,TouchAction:Ye,TouchInput:Le,MouseInput:ge,PointerEventInput:xe,TouchMouseInput:Oe,SingleTouchInput:Ee,Recognizer:at,AttrRecognizer:ut,Tap:vt,Pan:dt,Swipe:pt,Pinch:ct,Rotate:ht,Press:ft,on:F,off:b,each:u,merge:m,extend:v,assign:p,inherit:_,bindFn:y,prefixed:S});var bt=typeof a!=="undefined"?a:typeof self!=="undefined"?self:{};bt.Hammer=mt;if(true){!(Mt=function(){return mt}.call(xt,Pt,xt,Ct),Mt!==c&&(Ct.exports=Mt))}else{}})(window,document,"Hammer")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DistanceLegendViewModel=undefined;var i=r(261);var n=t.DistanceLegendViewModel=function(_,n,e,y,g,a,o,s){"use strict";var r=function e(t){if(!_(t)||!_(t.terria)){throw new n("options.terria is required.")}this.terria=t.terria;this._removeSubscription=undefined;this._lastLegendUpdate=undefined;this.eventHelper=new a;this.distanceLabel=undefined;this.barWidth=undefined;this.enableDistanceLegend=_(t.enableDistanceLegend)?t.enableDistanceLegend:true;o.track(this,["distanceLabel","barWidth"]);this.eventHelper.add(this.terria.afterWidgetChanged,function(){if(_(this._removeSubscription)){this._removeSubscription();this._removeSubscription=undefined}},this);var i=this;function r(){if(_(i.terria)){var e=i.terria.scene;i._removeSubscription=e.postRender.addEventListener(function(){l(this,e)},i)}else if(_(i.terria.leaflet)){var t=i.terria.leaflet.map;var r=function e(){u(i,t)};i._removeSubscription=function(){t.off("zoomend",r);t.off("moveend",r)};t.on("zoomend",r);t.on("moveend",r);u(i,t)}}r();this.eventHelper.add(this.terria.afterWidgetChanged,function(){r()},this)};r.prototype.destroy=function(){this.eventHelper.removeAll()};r.prototype.show=function(e){var t;if(this.enableDistanceLegend){t='<div class="distance-legend" data-bind="visible: distanceLabel && barWidth">'+'<div class="distance-legend-label" data-bind="text: distanceLabel"></div>'+"<div class=\"distance-legend-scale-bar\" data-bind=\"style: { width: barWidth + 'px', left: (-1 + (125 - barWidth) / 2) + 'px' }\"></div>"+"</div>"}else{t='<div class="distance-legend"  style="display: none;" data-bind="visible: distanceLabel && barWidth">'+'<div class="distance-legend-label"  data-bind="text: distanceLabel"></div>'+"<div class=\"distance-legend-scale-bar\"  data-bind=\"style: { width: barWidth + 'px', left: (-1 + (125 - barWidth) / 2) + 'px' }\"></div>"+"</div>"}(0,i.loadView)(t,e,this)};r.create=function(e){var t=new r(e);t.show(e.container);return t};var w=new e;var F=[1,2,3,5,10,20,30,50,100,200,300,500,1e3,2e3,3e3,5e3,1e4,2e4,3e4,5e4,1e5,2e5,3e5,5e5,1e6,2e6,3e6,5e6,1e7,2e7,3e7,5e7];function l(e,t){if(!e.enableDistanceLegend){e.barWidth=undefined;e.distanceLabel=undefined;return}var r=g();if(r<e._lastLegendUpdate+250){return}e._lastLegendUpdate=r;var i=t.canvas.clientWidth;var n=t.canvas.clientHeight;var a=t.camera.getPickRay(new y(i/2|0,n-1));var o=t.camera.getPickRay(new y(1+i/2|0,n-1));var s=t.globe;var l=s.pick(a,t);var u=s.pick(o,t);if(!_(l)||!_(u)){e.barWidth=undefined;e.distanceLabel=undefined;return}var d=s.ellipsoid.cartesianToCartographic(l);var c=s.ellipsoid.cartesianToCartographic(u);w.setEndPoints(d,c);var f=w.surfaceDistance;var h=100;var p;for(var v=F.length-1;!_(p)&&v>=0;--v){if(F[v]/f<h){p=F[v]}}if(_(p)){var m;if(p>=1e3){m=(p/1e3).toString()+" km"}else{m=p.toString()+" m"}e.barWidth=p/f|0;e.distanceLabel=m}else{e.barWidth=undefined;e.distanceLabel=undefined}}function u(e,t){var r=t.getSize().y/2;var i=100;var n=t.containerPointToLatLng([0,r]).distanceTo(t.containerPointToLatLng([i,r]));var a=s.control.scale()._getRoundNum(n);var o=a<1e3?a+" m":a/1e3+" km";e.barWidth=a/n*i;e.distanceLabel=o}return r}(Freedo.defined,Freedo.DeveloperError,Freedo.EllipsoidGeodesic,Freedo.Cartesian2,Freedo.getTimestamp,Freedo.EventHelper,r(71),r(668))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=t.createFragmentFromTemplate=function(){"use strict";var e=function e(t){var r=document.createElement("div");r.innerHTML=t;var i=document.createDocumentFragment();while(r.firstChild){i.appendChild(r.firstChild)}return i};return e}()},function(r,i,n){var a,o;(function(w,F,b){var e=w.L,C={};C.version="0.7.7";if(true&&typeof r.exports==="object"){r.exports=C}else if(true){!(a=C,o=typeof a==="function"?a.call(i,n,i,r):a,o!==b&&(r.exports=o))}C.noConflict=function(){w.L=e;return this};w.L=C;C.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1),r,i,n,a;for(i=0,n=t.length;i<n;i++){a=t[i]||{};for(r in a){if(a.hasOwnProperty(r)){e[r]=a[r]}}}return e},bind:function(e,t){var r=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,r||arguments)}},stamp:function(){var t=0,r="_leaflet_id";return function(e){e[r]=e[r]||++t;return e[r]}}(),invokeEach:function(e,t,r){var i,n;if(typeof e==="object"){n=Array.prototype.slice.call(arguments,3);for(i in e){t.apply(r,[i,e[i]].concat(n))}return true}return false},limitExecByInterval:function(r,i,n){var a,o;return function e(){var t=arguments;if(a){o=true;return}a=true;setTimeout(function(){a=false;if(o){e.apply(n,t);o=false}},i);r.apply(n,t)}},falseFn:function(){return false},formatNum:function(e,t){var r=Math.pow(10,t||5);return Math.round(e*r)/r},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},splitWords:function(e){return C.Util.trim(e).split(/\s+/)},setOptions:function(e,t){e.options=C.extend({},e.options,t);return e.options},getParamString:function(e,t,r){var i=[];for(var n in e){i.push(encodeURIComponent(r?n.toUpperCase():n)+"="+encodeURIComponent(e[n]))}return(!t||t.indexOf("?")===-1?"?":"&")+i.join("&")},template:function(e,i){return e.replace(/\{ *([\w_]+) *\}/g,function(e,t){var r=i[t];if(r===b){throw new Error("No value provided for variable "+e)}else if(typeof r==="function"){r=r(i)}return r})},isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="};(function(){function e(e){var t,r,i=["webkit","moz","o","ms"];for(t=0;t<i.length&&!r;t++){r=w[i[t]+e]}return r}var i=0;function n(e){var t=+new Date,r=Math.max(0,16-(t-i));i=t+r;return w.setTimeout(e,r)}var a=w.requestAnimationFrame||e("RequestAnimationFrame")||n;var t=w.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){w.clearTimeout(e)};C.Util.requestAnimFrame=function(e,t,r,i){e=C.bind(e,t);if(r&&a===n){e()}else{return a.call(w,e,i)}};C.Util.cancelAnimFrame=function(e){if(e){t.call(w,e)}}})();C.extend=C.Util.extend;C.bind=C.Util.bind;C.stamp=C.Util.stamp;C.setOptions=C.Util.setOptions;C.Class=function(){};C.Class.extend=function(e){var t=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks){this.callInitHooks()}};var r=function(){};r.prototype=this.prototype;var i=new r;i.constructor=t;t.prototype=i;for(var n in this){if(this.hasOwnProperty(n)&&n!=="prototype"){t[n]=this[n]}}if(e.statics){C.extend(t,e.statics);delete e.statics}if(e.includes){C.Util.extend.apply(null,[i].concat(e.includes));delete e.includes}if(e.options&&i.options){e.options=C.extend({},i.options,e.options)}C.extend(i,e);i._initHooks=[];var a=this;t.__super__=a.prototype;i.callInitHooks=function(){if(this._initHooksCalled){return}if(a.prototype.callInitHooks){a.prototype.callInitHooks.call(this)}this._initHooksCalled=true;for(var e=0,t=i._initHooks.length;e<t;e++){i._initHooks[e].call(this)}};return t};C.Class.include=function(e){C.extend(this.prototype,e)};C.Class.mergeOptions=function(e){C.extend(this.prototype.options,e)};C.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1);var r=typeof e==="function"?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[];this.prototype._initHooks.push(r)};var p="_leaflet_events";C.Mixin={};C.Mixin.Events={addEventListener:function(e,t,r){if(C.Util.invokeEach(e,this.addEventListener,this,t,r)){return this}var i=this[p]=this[p]||{},n=r&&r!==this&&C.stamp(r),a,o,s,l,u,d,c;e=C.Util.splitWords(e);for(a=0,o=e.length;a<o;a++){s={action:t,context:r||this};l=e[a];if(n){u=l+"_idx";d=u+"_len";c=i[u]=i[u]||{};if(!c[n]){c[n]=[];i[d]=(i[d]||0)+1}c[n].push(s)}else{i[l]=i[l]||[];i[l].push(s)}}return this},hasEventListeners:function(e){var t=this[p];return!!t&&(e in t&&t[e].length>0||e+"_idx"in t&&t[e+"_idx_len"]>0)},removeEventListener:function(e,t,r){if(!this[p]){return this}if(!e){return this.clearAllEventListeners()}if(C.Util.invokeEach(e,this.removeEventListener,this,t,r)){return this}var i=this[p],n=r&&r!==this&&C.stamp(r),a,o,s,l,u,d,c,f,h;e=C.Util.splitWords(e);for(a=0,o=e.length;a<o;a++){s=e[a];d=s+"_idx";c=d+"_len";f=i[d];if(!t){delete i[s];delete i[d];delete i[c]}else{l=n&&f?f[n]:i[s];if(l){for(u=l.length-1;u>=0;u--){if(l[u].action===t&&(!r||l[u].context===r)){h=l.splice(u,1);h[0].action=C.Util.falseFn}}if(r&&f&&l.length===0){delete f[n];i[c]--}}}}return this},clearAllEventListeners:function(){delete this[p];return this},fireEvent:function(e,t){if(!this.hasEventListeners(e)){return this}var r=C.Util.extend({},t,{type:e,target:this});var i=this[p],n,a,o,s,l;if(i[e]){n=i[e].slice();for(a=0,o=n.length;a<o;a++){n[a].action.call(n[a].context,r)}}s=i[e+"_idx"];for(l in s){n=s[l].slice();if(n){for(a=0,o=n.length;a<o;a++){n[a].action.call(n[a].context,r)}}}return this},addOneTimeEventListener:function(e,t,r){if(C.Util.invokeEach(e,this.addOneTimeEventListener,this,t,r)){return this}var i=C.bind(function(){this.removeEventListener(e,t,r).removeEventListener(e,i,r)},this);return this.addEventListener(e,t,r).addEventListener(e,i,r)}};C.Mixin.Events.on=C.Mixin.Events.addEventListener;C.Mixin.Events.off=C.Mixin.Events.removeEventListener;C.Mixin.Events.once=C.Mixin.Events.addOneTimeEventListener;C.Mixin.Events.fire=C.Mixin.Events.fireEvent;(function(){var e="ActiveXObject"in w,t=e&&!F.addEventListener,r=navigator.userAgent.toLowerCase(),i=r.indexOf("webkit")!==-1,n=r.indexOf("chrome")!==-1,a=r.indexOf("phantom")!==-1,o=r.indexOf("android")!==-1,s=r.search("android [23]")!==-1,l=r.indexOf("gecko")!==-1,u=typeof orientation!==b+"",d=!w.PointerEvent&&w.MSPointerEvent,c=w.PointerEvent&&w.navigator.pointerEnabled||d,f="devicePixelRatio"in w&&w.devicePixelRatio>1||"matchMedia"in w&&w.matchMedia("(min-resolution:144dpi)")&&w.matchMedia("(min-resolution:144dpi)").matches,h=F.documentElement,p=e&&"transition"in h.style,v="WebKitCSSMatrix"in w&&"m11"in new w.WebKitCSSMatrix&&!s,m="MozPerspective"in h.style,_="OTransition"in h.style,y=!w.L_DISABLE_3D&&(p||v||m||_)&&!a;var g=!w.L_NO_TOUCH&&!a&&(c||"ontouchstart"in w||w.DocumentTouch&&F instanceof w.DocumentTouch);C.Browser={ie:e,ielt9:t,webkit:i,gecko:l&&!i&&!w.opera&&!e,android:o,android23:s,chrome:n,ie3d:p,webkit3d:v,gecko3d:m,opera3d:_,any3d:y,mobile:u,mobileWebkit:u&&i,mobileWebkit3d:u&&v,mobileOpera:u&&w.opera,touch:g,msPointer:d,pointer:c,retina:f}})();C.Point=function(e,t,r){this.x=r?Math.round(e):e;this.y=r?Math.round(t):t};C.Point.prototype={clone:function(){return new C.Point(this.x,this.y)},add:function(e){return this.clone()._add(C.point(e))},_add:function(e){this.x+=e.x;this.y+=e.y;return this},subtract:function(e){return this.clone()._subtract(C.point(e))},_subtract:function(e){this.x-=e.x;this.y-=e.y;return this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){this.x/=e;this.y/=e;return this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){this.x*=e;this.y*=e;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},distanceTo:function(e){e=C.point(e);var t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)},equals:function(e){e=C.point(e);return e.x===this.x&&e.y===this.y},contains:function(e){e=C.point(e);return Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+C.Util.formatNum(this.x)+", "+C.Util.formatNum(this.y)+")"}};C.point=function(e,t,r){if(e instanceof C.Point){return e}if(C.Util.isArray(e)){return new C.Point(e[0],e[1])}if(e===b||e===null){return e}return new C.Point(e,t,r)};C.Bounds=function(e,t){if(!e){return}var r=t?[e,t]:e;for(var i=0,n=r.length;i<n;i++){this.extend(r[i])}};C.Bounds.prototype={extend:function(e){e=C.point(e);if(!this.min&&!this.max){this.min=e.clone();this.max=e.clone()}else{this.min.x=Math.min(e.x,this.min.x);this.max.x=Math.max(e.x,this.max.x);this.min.y=Math.min(e.y,this.min.y);this.max.y=Math.max(e.y,this.max.y)}return this},getCenter:function(e){return new C.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new C.Point(this.min.x,this.max.y)},getTopRight:function(){return new C.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,r;if(typeof e[0]==="number"||e instanceof C.Point){e=C.point(e)}else{e=C.bounds(e)}if(e instanceof C.Bounds){t=e.min;r=e.max}else{t=r=e}return t.x>=this.min.x&&r.x<=this.max.x&&t.y>=this.min.y&&r.y<=this.max.y},intersects:function(e){e=C.bounds(e);var t=this.min,r=this.max,i=e.min,n=e.max,a=n.x>=t.x&&i.x<=r.x,o=n.y>=t.y&&i.y<=r.y;return a&&o},isValid:function(){return!!(this.min&&this.max)}};C.bounds=function(e,t){if(!e||e instanceof C.Bounds){return e}return new C.Bounds(e,t)};C.Transformation=function(e,t,r,i){this._a=e;this._b=t;this._c=r;this._d=i};C.Transformation.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){t=t||1;e.x=t*(this._a*e.x+this._b);e.y=t*(this._c*e.y+this._d);return e},untransform:function(e,t){t=t||1;return new C.Point((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};C.DomUtil={get:function(e){return typeof e==="string"?F.getElementById(e):e},getStyle:function(e,t){var r=e.style[t];if(!r&&e.currentStyle){r=e.currentStyle[t]}if((!r||r==="auto")&&F.defaultView){var i=F.defaultView.getComputedStyle(e,null);r=i?i[t]:null}return r==="auto"?null:r},getViewportOffset:function(e){var t=0,r=0,i=e,n=F.body,a=F.documentElement,o;do{t+=i.offsetTop||0;r+=i.offsetLeft||0;t+=parseInt(C.DomUtil.getStyle(i,"borderTopWidth"),10)||0;r+=parseInt(C.DomUtil.getStyle(i,"borderLeftWidth"),10)||0;o=C.DomUtil.getStyle(i,"position");if(i.offsetParent===n&&o==="absolute"){break}if(o==="fixed"){t+=n.scrollTop||a.scrollTop||0;r+=n.scrollLeft||a.scrollLeft||0;break}if(o==="relative"&&!i.offsetLeft){var s=C.DomUtil.getStyle(i,"width"),l=C.DomUtil.getStyle(i,"max-width"),u=i.getBoundingClientRect();if(s!=="none"||l!=="none"){r+=u.left+i.clientLeft}t+=u.top+(n.scrollTop||a.scrollTop||0);break}i=i.offsetParent}while(i);i=e;do{if(i===n){break}t-=i.scrollTop||0;r-=i.scrollLeft||0;i=i.parentNode}while(i);return new C.Point(r,t)},documentIsLtr:function(){if(!C.DomUtil._docIsLtrCached){C.DomUtil._docIsLtrCached=true;C.DomUtil._docIsLtr=C.DomUtil.getStyle(F.body,"direction")==="ltr"}return C.DomUtil._docIsLtr},create:function(e,t,r){var i=F.createElement(e);i.className=t;if(r){r.appendChild(i)}return i},hasClass:function(e,t){if(e.classList!==b){return e.classList.contains(t)}var r=C.DomUtil._getClass(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)},addClass:function(e,t){if(e.classList!==b){var r=C.Util.splitWords(t);for(var i=0,n=r.length;i<n;i++){e.classList.add(r[i])}}else if(!C.DomUtil.hasClass(e,t)){var a=C.DomUtil._getClass(e);C.DomUtil._setClass(e,(a?a+" ":"")+t)}},removeClass:function(e,t){if(e.classList!==b){e.classList.remove(t)}else{C.DomUtil._setClass(e,C.Util.trim((" "+C.DomUtil._getClass(e)+" ").replace(" "+t+" "," ")))}},_setClass:function(e,t){if(e.className.baseVal===b){e.className=t}else{e.className.baseVal=t}},_getClass:function(e){return e.className.baseVal===b?e.className:e.className.baseVal},setOpacity:function(e,t){if("opacity"in e.style){e.style.opacity=t}else if("filter"in e.style){var r=false,i="DXImageTransform.Microsoft.Alpha";try{r=e.filters.item(i)}catch(e){if(t===1){return}}t=Math.round(t*100);if(r){r.Enabled=t!==100;r.Opacity=t}else{e.style.filter+=" progid:"+i+"(opacity="+t+")"}}},testProp:function(e){var t=F.documentElement.style;for(var r=0;r<e.length;r++){if(e[r]in t){return e[r]}}return false},getTranslateString:function(e){var t=C.Browser.webkit3d,r="translate"+(t?"3d":"")+"(",i=(t?",0":"")+")";return r+e.x+"px,"+e.y+"px"+i},getScaleString:function(e,t){var r=C.DomUtil.getTranslateString(t.add(t.multiplyBy(-1*e))),i=" scale("+e+") ";return r+i},setPosition:function(e,t,r){e._leaflet_pos=t;if(!r&&C.Browser.any3d){e.style[C.DomUtil.TRANSFORM]=C.DomUtil.getTranslateString(t)}else{e.style.left=t.x+"px";e.style.top=t.y+"px"}},getPosition:function(e){return e._leaflet_pos}};C.DomUtil.TRANSFORM=C.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);C.DomUtil.TRANSITION=C.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);C.DomUtil.TRANSITION_END=C.DomUtil.TRANSITION==="webkitTransition"||C.DomUtil.TRANSITION==="OTransition"?C.DomUtil.TRANSITION+"End":"transitionend";(function(){if("onselectstart"in F){C.extend(C.DomUtil,{disableTextSelection:function(){C.DomEvent.on(w,"selectstart",C.DomEvent.preventDefault)},enableTextSelection:function(){C.DomEvent.off(w,"selectstart",C.DomEvent.preventDefault)}})}else{var t=C.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);C.extend(C.DomUtil,{disableTextSelection:function(){if(t){var e=F.documentElement.style;this._userSelect=e[t];e[t]="none"}},enableTextSelection:function(){if(t){F.documentElement.style[t]=this._userSelect;delete this._userSelect}}})}C.extend(C.DomUtil,{disableImageDrag:function(){C.DomEvent.on(w,"dragstart",C.DomEvent.preventDefault)},enableImageDrag:function(){C.DomEvent.off(w,"dragstart",C.DomEvent.preventDefault)}})})();C.LatLng=function(e,t,r){e=parseFloat(e);t=parseFloat(t);if(isNaN(e)||isNaN(t)){throw new Error("Invalid LatLng object: ("+e+", "+t+")")}this.lat=e;this.lng=t;if(r!==b){this.alt=parseFloat(r)}};C.extend(C.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9});C.LatLng.prototype={equals:function(e){if(!e){return false}e=C.latLng(e);var t=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return t<=C.LatLng.MAX_MARGIN},toString:function(e){return"LatLng("+C.Util.formatNum(this.lat,e)+", "+C.Util.formatNum(this.lng,e)+")"},distanceTo:function(e){e=C.latLng(e);var t=6378137,r=C.LatLng.DEG_TO_RAD,i=(e.lat-this.lat)*r,n=(e.lng-this.lng)*r,a=this.lat*r,o=e.lat*r,s=Math.sin(i/2),l=Math.sin(n/2);var u=s*s+l*l*Math.cos(a)*Math.cos(o);return t*2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(e,t){var r=this.lng;e=e||-180;t=t||180;r=(r+t)%(t-e)+(r<e||r===t?t:e);return new C.LatLng(this.lat,r)}};C.latLng=function(e,t){if(e instanceof C.LatLng){return e}if(C.Util.isArray(e)){if(typeof e[0]==="number"||typeof e[0]==="string"){return new C.LatLng(e[0],e[1],e[2])}else{return null}}if(e===b||e===null){return e}if(typeof e==="object"&&"lat"in e){return new C.LatLng(e.lat,"lng"in e?e.lng:e.lon)}if(t===b){return null}return new C.LatLng(e,t)};C.LatLngBounds=function(e,t){if(!e){return}var r=t?[e,t]:e;for(var i=0,n=r.length;i<n;i++){this.extend(r[i])}};C.LatLngBounds.prototype={extend:function(e){if(!e){return this}var t=C.latLng(e);if(t!==null){e=t}else{e=C.latLngBounds(e)}if(e instanceof C.LatLng){if(!this._southWest&&!this._northEast){this._southWest=new C.LatLng(e.lat,e.lng);this._northEast=new C.LatLng(e.lat,e.lng)}else{this._southWest.lat=Math.min(e.lat,this._southWest.lat);this._southWest.lng=Math.min(e.lng,this._southWest.lng);this._northEast.lat=Math.max(e.lat,this._northEast.lat);this._northEast.lng=Math.max(e.lng,this._northEast.lng)}}else if(e instanceof C.LatLngBounds){this.extend(e._southWest);this.extend(e._northEast)}return this},pad:function(e){var t=this._southWest,r=this._northEast,i=Math.abs(t.lat-r.lat)*e,n=Math.abs(t.lng-r.lng)*e;return new C.LatLngBounds(new C.LatLng(t.lat-i,t.lng-n),new C.LatLng(r.lat+i,r.lng+n))},getCenter:function(){return new C.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new C.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new C.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){if(typeof e[0]==="number"||e instanceof C.LatLng){e=C.latLng(e)}else{e=C.latLngBounds(e)}var t=this._southWest,r=this._northEast,i,n;if(e instanceof C.LatLngBounds){i=e.getSouthWest();n=e.getNorthEast()}else{i=n=e}return i.lat>=t.lat&&n.lat<=r.lat&&i.lng>=t.lng&&n.lng<=r.lng},intersects:function(e){e=C.latLngBounds(e);var t=this._southWest,r=this._northEast,i=e.getSouthWest(),n=e.getNorthEast(),a=n.lat>=t.lat&&i.lat<=r.lat,o=n.lng>=t.lng&&i.lng<=r.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e){if(!e){return false}e=C.latLngBounds(e);return this._southWest.equals(e.getSouthWest())&&this._northEast.equals(e.getNorthEast())},isValid:function(){return!!(this._southWest&&this._northEast)}};C.latLngBounds=function(e,t){if(!e||e instanceof C.LatLngBounds){return e}return new C.LatLngBounds(e,t)};C.Projection={};C.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(e){var t=C.LatLng.DEG_TO_RAD,r=this.MAX_LATITUDE,i=Math.max(Math.min(r,e.lat),-r),n=e.lng*t,a=i*t;a=Math.log(Math.tan(Math.PI/4+a/2));return new C.Point(n,a)},unproject:function(e){var t=C.LatLng.RAD_TO_DEG,r=e.x*t,i=(2*Math.atan(Math.exp(e.y))-Math.PI/2)*t;return new C.LatLng(i,r)}};C.Projection.LonLat={project:function(e){return new C.Point(e.lng,e.lat)},unproject:function(e){return new C.LatLng(e.y,e.x)}};C.CRS={latLngToPoint:function(e,t){var r=this.projection.project(e),i=this.scale(t);return this.transformation._transform(r,i)},pointToLatLng:function(e,t){var r=this.scale(t),i=this.transformation.untransform(e,r);return this.projection.unproject(i)},project:function(e){return this.projection.project(e)},scale:function(e){return 256*Math.pow(2,e)},getSize:function(e){var t=this.scale(e);return C.point(t,t)}};C.CRS.Simple=C.extend({},C.CRS,{projection:C.Projection.LonLat,transformation:new C.Transformation(1,0,-1,0),scale:function(e){return Math.pow(2,e)}});C.CRS.EPSG3857=C.extend({},C.CRS,{code:"EPSG:3857",projection:C.Projection.SphericalMercator,transformation:new C.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(e){var t=this.projection.project(e),r=6378137;return t.multiplyBy(r)}});C.CRS.EPSG900913=C.extend({},C.CRS.EPSG3857,{code:"EPSG:900913"});C.CRS.EPSG4326=C.extend({},C.CRS,{code:"EPSG:4326",projection:C.Projection.LonLat,transformation:new C.Transformation(1/360,.5,-1/360,.5)});C.Map=C.Class.extend({includes:C.Mixin.Events,options:{crs:C.CRS.EPSG3857,fadeAnimation:C.DomUtil.TRANSITION&&!C.Browser.android23,trackResize:true,markerZoomAnimation:C.DomUtil.TRANSITION&&C.Browser.any3d},initialize:function(e,t){t=C.setOptions(this,t);this._initContainer(e);this._initLayout();this._onResize=C.bind(this._onResize,this);this._initEvents();if(t.maxBounds){this.setMaxBounds(t.maxBounds)}if(t.center&&t.zoom!==b){this.setView(C.latLng(t.center),t.zoom,{reset:true})}this._handlers=[];this._layers={};this._zoomBoundLayers={};this._tileLayersNum=0;this.callInitHooks();this._addLayers(t.layers)},setView:function(e,t){t=t===b?this.getZoom():t;this._resetView(C.latLng(e),this._limitZoom(t));return this},setZoom:function(e,t){if(!this._loaded){this._zoom=this._limitZoom(e);return this}return this.setView(this.getCenter(),e,{zoom:t})},zoomIn:function(e,t){return this.setZoom(this._zoom+(e||1),t)},zoomOut:function(e,t){return this.setZoom(this._zoom-(e||1),t)},setZoomAround:function(e,t,r){var i=this.getZoomScale(t),n=this.getSize().divideBy(2),a=e instanceof C.Point?e:this.latLngToContainerPoint(e),o=a.subtract(n).multiplyBy(1-1/i),s=this.containerPointToLatLng(n.add(o));return this.setView(s,t,{zoom:r})},fitBounds:function(e,t){t=t||{};e=e.getBounds?e.getBounds():C.latLngBounds(e);var r=C.point(t.paddingTopLeft||t.padding||[0,0]),i=C.point(t.paddingBottomRight||t.padding||[0,0]),n=this.getBoundsZoom(e,false,r.add(i));n=t.maxZoom?Math.min(t.maxZoom,n):n;var a=i.subtract(r).divideBy(2),o=this.project(e.getSouthWest(),n),s=this.project(e.getNorthEast(),n),l=this.unproject(o.add(s).divideBy(2).add(a),n);return this.setView(l,n,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e){this.fire("movestart");this._rawPanBy(C.point(e));this.fire("move");return this.fire("moveend")},setMaxBounds:function(e){e=C.latLngBounds(e);this.options.maxBounds=e;if(!e){return this.off("moveend",this._panInsideMaxBounds,this)}if(this._loaded){this._panInsideMaxBounds()}return this.on("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(e,t){var r=this.getCenter(),i=this._limitCenter(r,this._zoom,e);if(r.equals(i)){return this}return this.panTo(i,t)},addLayer:function(e){var t=C.stamp(e);if(this._layers[t]){return this}this._layers[t]=e;if(e.options&&(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))){this._zoomBoundLayers[t]=e;this._updateZoomLevels()}if(this.options.zoomAnimation&&C.TileLayer&&e instanceof C.TileLayer){this._tileLayersNum++;this._tileLayersToLoad++;e.on("load",this._onTileLayerLoad,this)}if(this._loaded){this._layerAdd(e)}return this},removeLayer:function(e){var t=C.stamp(e);if(!this._layers[t]){return this}if(this._loaded){e.onRemove(this)}delete this._layers[t];if(this._loaded){this.fire("layerremove",{layer:e})}if(this._zoomBoundLayers[t]){delete this._zoomBoundLayers[t];this._updateZoomLevels()}if(this.options.zoomAnimation&&C.TileLayer&&e instanceof C.TileLayer){this._tileLayersNum--;this._tileLayersToLoad--;e.off("load",this._onTileLayerLoad,this)}return this},hasLayer:function(e){if(!e){return false}return C.stamp(e)in this._layers},eachLayer:function(e,t){for(var r in this._layers){e.call(t,this._layers[r])}return this},invalidateSize:function(e){if(!this._loaded){return this}e=C.extend({animate:false,pan:true},e===true?{animate:true}:e);var t=this.getSize();this._sizeChanged=true;this._initialCenter=null;var r=this.getSize(),i=t.divideBy(2).round(),n=r.divideBy(2).round(),a=i.subtract(n);if(!a.x&&!a.y){return this}if(e.animate&&e.pan){this.panBy(a)}else{if(e.pan){this._rawPanBy(a)}this.fire("move");if(e.debounceMoveend){clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(C.bind(this.fire,this,"moveend"),200)}else{this.fire("moveend")}}return this.fire("resize",{oldSize:t,newSize:r})},addHandler:function(e,t){if(!t){return this}var r=this[e]=new t(this);this._handlers.push(r);if(this.options[e]){r.enable()}return this},remove:function(){if(this._loaded){this.fire("unload")}this._initEvents("off");try{delete this._container._leaflet}catch(e){this._container._leaflet=b}this._clearPanes();if(this._clearControlPos){this._clearControlPos()}this._clearHandlers();return this},getCenter:function(){this._checkIfLoaded();if(this._initialCenter&&!this._moved()){return this._initialCenter}return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),r=this.unproject(e.getTopRight());return new C.LatLngBounds(t,r)},getMinZoom:function(){return this.options.minZoom===b?this._layersMinZoom===b?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===b?this._layersMaxZoom===b?Infinity:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,r){e=C.latLngBounds(e);var i=this.getMinZoom()-(t?1:0),n=this.getMaxZoom(),a=this.getSize(),o=e.getNorthWest(),s=e.getSouthEast(),l=true,u;r=C.point(r||[0,0]);do{i++;u=this.project(s,i).subtract(this.project(o,i)).add(r);l=!t?a.contains(u):u.x<a.x||u.y<a.y}while(l&&i<=n);if(l&&t){return null}return t?i:i-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new C.Point(this._container.clientWidth,this._container.clientHeight);this._sizeChanged=false}return this._size.clone()},getPixelBounds:function(){var e=this._getTopLeftPoint();return new C.Bounds(e,e.add(this.getSize()))},getPixelOrigin:function(){this._checkIfLoaded();return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e){var t=this.options.crs;return t.scale(e)/t.scale(this._zoom)},getScaleZoom:function(e){return this._zoom+Math.log(e)/Math.LN2},project:function(e,t){t=t===b?this._zoom:t;return this.options.crs.latLngToPoint(C.latLng(e),t)},unproject:function(e,t){t=t===b?this._zoom:t;return this.options.crs.pointToLatLng(C.point(e),t)},layerPointToLatLng:function(e){var t=C.point(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(C.latLng(e))._round();return t._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(e){return C.point(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return C.point(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(C.point(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(C.latLng(e)))},mouseEventToContainerPoint:function(e){return C.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=C.DomUtil.get(e);if(!t){throw new Error("Map container not found.")}else if(t._leaflet){throw new Error("Map container is already initialized.")}t._leaflet=true},_initLayout:function(){var e=this._container;C.DomUtil.addClass(e,"leaflet-container"+(C.Browser.touch?" leaflet-touch":"")+(C.Browser.retina?" leaflet-retina":"")+(C.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var t=C.DomUtil.getStyle(e,"position");if(t!=="absolute"&&t!=="relative"&&t!=="fixed"){e.style.position="relative"}this._initPanes();if(this._initControlPos){this._initControlPos()}},_initPanes:function(){var e=this._panes={};this._mapPane=e.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=e.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);e.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);e.shadowPane=this._createPane("leaflet-shadow-pane");e.overlayPane=this._createPane("leaflet-overlay-pane");e.markerPane=this._createPane("leaflet-marker-pane");e.popupPane=this._createPane("leaflet-popup-pane");var t=" leaflet-zoom-hide";if(!this.options.markerZoomAnimation){C.DomUtil.addClass(e.markerPane,t);C.DomUtil.addClass(e.shadowPane,t);C.DomUtil.addClass(e.popupPane,t)}},_createPane:function(e,t){return C.DomUtil.create("div",e,t||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(e){e=e?C.Util.isArray(e)?e:[e]:[];for(var t=0,r=e.length;t<r;t++){this.addLayer(e[t])}},_resetView:function(e,t,r,i){var n=this._zoom!==t;if(!i){this.fire("movestart");if(n){this.fire("zoomstart")}}this._zoom=t;this._initialCenter=e;this._initialTopLeftPoint=this._getNewTopLeftPoint(e);if(!r){C.DomUtil.setPosition(this._mapPane,new C.Point(0,0))}else{this._initialTopLeftPoint._add(this._getMapPanePos())}this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=true;this.fire("viewreset",{hard:!r});if(a){this.fire("load");this.eachLayer(this._layerAdd,this)}this.fire("move");if(n||i){this.fire("zoomend")}this.fire("moveend",{hard:!r})},_rawPanBy:function(e){C.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var e,t=Infinity,r=-Infinity,i=this._getZoomSpan();for(e in this._zoomBoundLayers){var n=this._zoomBoundLayers[e];if(!isNaN(n.options.minZoom)){t=Math.min(t,n.options.minZoom)}if(!isNaN(n.options.maxZoom)){r=Math.max(r,n.options.maxZoom)}}if(e===b){this._layersMaxZoom=this._layersMinZoom=b}else{this._layersMaxZoom=r;this._layersMinZoom=t}if(i!==this._getZoomSpan()){this.fire("zoomlevelschange")}},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.")}},_initEvents:function(e){if(!C.DomEvent){return}e=e||"on";C.DomEvent[e](this._container,"click",this._onMouseClick,this);var t=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"],r,i;for(r=0,i=t.length;r<i;r++){C.DomEvent[e](this._container,t[r],this._fireMouseEvent,this)}if(this.options.trackResize){C.DomEvent[e](w,"resize",this._onResize,this)}},_onResize:function(){C.Util.cancelAnimFrame(this._resizeRequest);this._resizeRequest=C.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:true})},this,false,this._container)},_onMouseClick:function(e){if(!this._loaded||!e._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||C.DomEvent._skipped(e)){return}this.fire("preclick");this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this._loaded||C.DomEvent._skipped(e)){return}var t=e.type;t=t==="mouseenter"?"mouseover":t==="mouseleave"?"mouseout":t;if(!this.hasEventListeners(t)){return}if(t==="contextmenu"){C.DomEvent.preventDefault(e)}var r=this.mouseEventToContainerPoint(e),i=this.containerPointToLayerPoint(r),n=this.layerPointToLatLng(i);this.fire(t,{latlng:n,layerPoint:i,containerPoint:r,originalEvent:e})},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad){this.fire("tilelayersload")}},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++){this._handlers[e].disable()}},whenReady:function(e,t){if(this._loaded){e.call(t||this,this)}else{this.on("load",e,t)}return this},_layerAdd:function(e){e.onAdd(this);this.fire("layeradd",{layer:e})},_getMapPanePos:function(){return C.DomUtil.getPosition(this._mapPane)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(e,t){var r=this.getSize()._divideBy(2);return this.project(e,t)._subtract(r)._round()},_latLngToNewLayerPoint:function(e,t,r){var i=this._getNewTopLeftPoint(r,t).add(this._getMapPanePos());return this.project(e,t)._subtract(i)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,r){if(!r){return e}var i=this.project(e,t),n=this.getSize().divideBy(2),a=new C.Bounds(i.subtract(n),i.add(n)),o=this._getBoundsOffset(a,r,t);return this.unproject(i.add(o),t)},_limitOffset:function(e,t){if(!t){return e}var r=this.getPixelBounds(),i=new C.Bounds(r.min.add(e),r.max.add(e));return e.add(this._getBoundsOffset(i,t))},_getBoundsOffset:function(e,t,r){var i=this.project(t.getNorthWest(),r).subtract(e.min),n=this.project(t.getSouthEast(),r).subtract(e.max),a=this._rebound(i.x,-n.x),o=this._rebound(i.y,-n.y);return new C.Point(a,o)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),r=this.getMaxZoom();return Math.max(t,Math.min(r,e))}});C.map=function(e,t){return new C.Map(e,t)};C.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(e){var t=C.LatLng.DEG_TO_RAD,r=this.MAX_LATITUDE,i=Math.max(Math.min(r,e.lat),-r),n=this.R_MAJOR,a=this.R_MINOR,o=e.lng*t*n,s=i*t,l=a/n,u=Math.sqrt(1-l*l),d=u*Math.sin(s);d=Math.pow((1-d)/(1+d),u*.5);var c=Math.tan(.5*(Math.PI*.5-s))/d;s=-n*Math.log(c);return new C.Point(o,s)},unproject:function(e){var t=C.LatLng.RAD_TO_DEG,r=this.R_MAJOR,i=this.R_MINOR,n=e.x*t/r,a=i/r,o=Math.sqrt(1-a*a),s=Math.exp(-e.y/r),l=Math.PI/2-2*Math.atan(s),u=15,d=1e-7,c=u,f=.1,h;while(Math.abs(f)>d&&--c>0){h=o*Math.sin(l);f=Math.PI/2-2*Math.atan(s*Math.pow((1-h)/(1+h),.5*o))-l;l+=f}return new C.LatLng(l*t,n)}};C.CRS.EPSG3395=C.extend({},C.CRS,{code:"EPSG:3395",projection:C.Projection.Mercator,transformation:function(){var e=C.Projection.Mercator,t=e.R_MAJOR,r=.5/(Math.PI*t);return new C.Transformation(r,.5,-r,.5)}()});C.TileLayer=C.Class.extend({includes:C.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:C.Browser.mobile,updateWhenIdle:C.Browser.mobile},initialize:function(e,t){t=C.setOptions(this,t);if(t.detectRetina&&C.Browser.retina&&t.maxZoom>0){t.tileSize=Math.floor(t.tileSize/2);t.zoomOffset++;if(t.minZoom>0){t.minZoom--}this.options.maxZoom--}if(t.bounds){t.bounds=C.latLngBounds(t.bounds)}this._url=e;var r=this.options.subdomains;if(typeof r==="string"){this.options.subdomains=r.split("")}},onAdd:function(e){this._map=e;this._animated=e._zoomAnimated;this._initContainer();e.on({viewreset:this._reset,moveend:this._update},this);if(this._animated){e.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){this._limitedUpdate=C.Util.limitExecByInterval(this._update,150,this);e.on("move",this._limitedUpdate,this)}this._reset();this._update()},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){this._container.parentNode.removeChild(this._container);e.off({viewreset:this._reset,moveend:this._update},this);if(this._animated){e.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)}if(!this.options.updateWhenIdle){e.off("move",this._limitedUpdate,this)}this._container=null;this._map=null},bringToFront:function(){var e=this._map._panes.tilePane;if(this._container){e.appendChild(this._container);this._setAutoZIndex(e,Math.max)}return this},bringToBack:function(){var e=this._map._panes.tilePane;if(this._container){e.insertBefore(this._container,e.firstChild);this._setAutoZIndex(e,Math.min)}return this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(e){this.options.opacity=e;if(this._map){this._updateOpacity()}return this},setZIndex:function(e){this.options.zIndex=e;this._updateZIndex();return this},setUrl:function(e,t){this._url=e;if(!t){this.redraw()}return this},redraw:function(){if(this._map){this._reset({hard:true});this._update()}return this},_updateZIndex:function(){if(this._container&&this.options.zIndex!==b){this._container.style.zIndex=this.options.zIndex}},_setAutoZIndex:function(e,t){var r=e.children,i=-t(Infinity,-Infinity),n,a,o;for(a=0,o=r.length;a<o;a++){if(r[a]!==this._container){n=parseInt(r[a].style.zIndex,10);if(!isNaN(n)){i=t(i,n)}}}this.options.zIndex=this._container.style.zIndex=(isFinite(i)?i:0)+t(1,-1)},_updateOpacity:function(){var e,t=this._tiles;if(C.Browser.ielt9){for(e in t){C.DomUtil.setOpacity(t[e],this.options.opacity)}}else{C.DomUtil.setOpacity(this._container,this.options.opacity)}},_initContainer:function(){var e=this._map._panes.tilePane;if(!this._container){this._container=C.DomUtil.create("div","leaflet-layer");this._updateZIndex();if(this._animated){var t="leaflet-tile-container";this._bgBuffer=C.DomUtil.create("div",t,this._container);this._tileContainer=C.DomUtil.create("div",t,this._container)}else{this._tileContainer=this._container}e.appendChild(this._container);if(this.options.opacity<1){this._updateOpacity()}}},_reset:function(e){for(var t in this._tiles){this.fire("tileunload",{tile:this._tiles[t]})}this._tiles={};this._tilesToLoad=0;if(this.options.reuseTiles){this._unusedTiles=[]}this._tileContainer.innerHTML="";if(this._animated&&e&&e.hard){this._clearBgBuffer()}this._initContainer()},_getTileSize:function(){var e=this._map,t=e.getZoom()+this.options.zoomOffset,r=this.options.maxNativeZoom,i=this.options.tileSize;if(r&&t>r){i=Math.round(e.getZoomScale(t)/e.getZoomScale(r)*i)}return i},_update:function(){if(!this._map){return}var e=this._map,t=e.getPixelBounds(),r=e.getZoom(),i=this._getTileSize();if(r>this.options.maxZoom||r<this.options.minZoom){return}var n=C.bounds(t.min.divideBy(i)._floor(),t.max.divideBy(i)._floor());this._addTilesFromCenterOut(n);if(this.options.unloadInvisibleTiles||this.options.reuseTiles){this._removeOtherTiles(n)}},_addTilesFromCenterOut:function(e){var t=[],r=e.getCenter();var i,n,a;for(i=e.min.y;i<=e.max.y;i++){for(n=e.min.x;n<=e.max.x;n++){a=new C.Point(n,i);if(this._tileShouldBeLoaded(a)){t.push(a)}}}var o=t.length;if(o===0){return}t.sort(function(e,t){return e.distanceTo(r)-t.distanceTo(r)});var s=F.createDocumentFragment();if(!this._tilesToLoad){this.fire("loading")}this._tilesToLoad+=o;for(n=0;n<o;n++){this._addTile(t[n],s)}this._tileContainer.appendChild(s)},_tileShouldBeLoaded:function(e){if(e.x+":"+e.y in this._tiles){return false}var t=this.options;if(!t.continuousWorld){var r=this._getWrapTileNum();if(t.noWrap&&(e.x<0||e.x>=r.x)||e.y<0||e.y>=r.y){return false}}if(t.bounds){var i=this._getTileSize(),n=e.multiplyBy(i),a=n.add([i,i]),o=this._map.unproject(n),s=this._map.unproject(a);if(!t.continuousWorld&&!t.noWrap){o=o.wrap();s=s.wrap()}if(!t.bounds.intersects([o,s])){return false}}return true},_removeOtherTiles:function(e){var t,r,i,n;for(n in this._tiles){t=n.split(":");r=parseInt(t[0],10);i=parseInt(t[1],10);if(r<e.min.x||r>e.max.x||i<e.min.y||i>e.max.y){this._removeTile(n)}}},_removeTile:function(e){var t=this._tiles[e];this.fire("tileunload",{tile:t,url:t.src});if(this.options.reuseTiles){C.DomUtil.removeClass(t,"leaflet-tile-loaded");this._unusedTiles.push(t)}else if(t.parentNode===this._tileContainer){this._tileContainer.removeChild(t)}if(!C.Browser.android){t.onload=null;t.src=C.Util.emptyImageUrl}delete this._tiles[e]},_addTile:function(e,t){var r=this._getTilePos(e);var i=this._getTile();C.DomUtil.setPosition(i,r,C.Browser.chrome);this._tiles[e.x+":"+e.y]=i;this._loadTile(i,e);if(i.parentNode!==this._tileContainer){t.appendChild(i)}},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom();if(e.zoomReverse){t=e.maxZoom-t}t+=e.zoomOffset;return e.maxNativeZoom?Math.min(t,e.maxNativeZoom):t},_getTilePos:function(e){var t=this._map.getPixelOrigin(),r=this._getTileSize();return e.multiplyBy(r).subtract(t)},getTileUrl:function(e){return C.Util.template(this._url,C.extend({s:this._getSubdomain(e),z:e.z,x:e.x,y:e.y},this.options))},_getWrapTileNum:function(){var e=this._map.options.crs,t=e.getSize(this._map.getZoom());return t.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(e){var t=this._getWrapTileNum();if(!this.options.continuousWorld&&!this.options.noWrap){e.x=(e.x%t.x+t.x)%t.x}if(this.options.tms){e.y=t.y-e.y-1}e.z=this._getZoomForUrl()},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var e=this._unusedTiles.pop();this._resetTile(e);return e}return this._createTile()},_resetTile:function(){},_createTile:function(){var e=C.DomUtil.create("img","leaflet-tile");e.style.width=e.style.height=this._getTileSize()+"px";e.galleryimg="no";e.onselectstart=e.onmousemove=C.Util.falseFn;if(C.Browser.ielt9&&this.options.opacity!==b){C.DomUtil.setOpacity(e,this.options.opacity)}if(C.Browser.mobileWebkit3d){e.style.WebkitBackfaceVisibility="hidden"}return e},_loadTile:function(e,t){e._layer=this;e.onload=this._tileOnLoad;e.onerror=this._tileOnError;this._adjustTilePoint(t);e.src=this.getTileUrl(t);this.fire("tileloadstart",{tile:e,url:e.src})},_tileLoaded:function(){this._tilesToLoad--;if(this._animated){C.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated")}if(!this._tilesToLoad){this.fire("load");if(this._animated){clearTimeout(this._clearBgBufferTimer);this._clearBgBufferTimer=setTimeout(C.bind(this._clearBgBuffer,this),500)}}},_tileOnLoad:function(){var e=this._layer;if(this.src!==C.Util.emptyImageUrl){C.DomUtil.addClass(this,"leaflet-tile-loaded");e.fire("tileload",{tile:this,url:this.src})}e._tileLoaded()},_tileOnError:function(){var e=this._layer;e.fire("tileerror",{tile:this,url:this.src});var t=e.options.errorTileUrl;if(t){this.src=t}e._tileLoaded()}});C.tileLayer=function(e,t){return new C.TileLayer(e,t)};C.TileLayer.WMS=C.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:false},initialize:function(e,t){this._url=e;var r=C.extend({},this.defaultWmsParams),i=t.tileSize||this.options.tileSize;if(t.detectRetina&&C.Browser.retina){r.width=r.height=i*2}else{r.width=r.height=i}for(var n in t){if(!this.options.hasOwnProperty(n)&&n!=="crs"){r[n]=t[n]}}this.wmsParams=r;C.setOptions(this,t)},onAdd:function(e){this._crs=this.options.crs||e.options.crs;this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code;C.TileLayer.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._map,r=this.options.tileSize,i=e.multiplyBy(r),n=i.add([r,r]),a=this._crs.project(t.unproject(i,e.z)),o=this._crs.project(t.unproject(n,e.z)),s=this._wmsVersion>=1.3&&this._crs===C.CRS.EPSG4326?[o.y,a.x,a.y,o.x].join(","):[a.x,o.y,o.x,a.y].join(","),l=C.Util.template(this._url,{s:this._getSubdomain(e)});return l+C.Util.getParamString(this.wmsParams,l,true)+"&BBOX="+s},setParams:function(e,t){C.extend(this.wmsParams,e);if(!t){this.redraw()}return this}});C.tileLayer.wms=function(e,t){return new C.TileLayer.WMS(e,t)};C.TileLayer.Canvas=C.TileLayer.extend({options:{async:false},initialize:function(e){C.setOptions(this,e)},redraw:function(){if(this._map){this._reset({hard:true});this._update()}for(var e in this._tiles){this._redrawTile(this._tiles[e])}return this},_redrawTile:function(e){this.drawTile(e,e._tilePoint,this._map._zoom)},_createTile:function(){var e=C.DomUtil.create("canvas","leaflet-tile");e.width=e.height=this.options.tileSize;e.onselectstart=e.onmousemove=C.Util.falseFn;return e},_loadTile:function(e,t){e._layer=this;e._tilePoint=t;this._redrawTile(e);if(!this.options.async){this.tileDrawn(e)}},drawTile:function(){},tileDrawn:function(e){this._tileOnLoad.call(e)}});C.tileLayer.canvas=function(e){return new C.TileLayer.Canvas(e)};C.ImageOverlay=C.Class.extend({includes:C.Mixin.Events,options:{opacity:1},initialize:function(e,t,r){this._url=e;this._bounds=C.latLngBounds(t);C.setOptions(this,r)},onAdd:function(e){this._map=e;if(!this._image){this._initImage()}e._panes.overlayPane.appendChild(this._image);e.on("viewreset",this._reset,this);if(e.options.zoomAnimation&&C.Browser.any3d){e.on("zoomanim",this._animateZoom,this)}this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._image);e.off("viewreset",this._reset,this);if(e.options.zoomAnimation){e.off("zoomanim",this._animateZoom,this)}},addTo:function(e){e.addLayer(this);return this},setOpacity:function(e){this.options.opacity=e;this._updateOpacity();return this},bringToFront:function(){if(this._image){this._map._panes.overlayPane.appendChild(this._image)}return this},bringToBack:function(){var e=this._map._panes.overlayPane;if(this._image){e.insertBefore(this._image,e.firstChild)}return this},setUrl:function(e){this._url=e;this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=C.DomUtil.create("img","leaflet-image-layer");if(this._map.options.zoomAnimation&&C.Browser.any3d){C.DomUtil.addClass(this._image,"leaflet-zoom-animated")}else{C.DomUtil.addClass(this._image,"leaflet-zoom-hide")}this._updateOpacity();C.extend(this._image,{galleryimg:"no",onselectstart:C.Util.falseFn,onmousemove:C.Util.falseFn,onload:C.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(e){var t=this._map,r=this._image,i=t.getZoomScale(e.zoom),n=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),o=t._latLngToNewLayerPoint(n,e.zoom,e.center),s=t._latLngToNewLayerPoint(a,e.zoom,e.center)._subtract(o),l=o._add(s._multiplyBy(1/2*(1-1/i)));r.style[C.DomUtil.TRANSFORM]=C.DomUtil.getTranslateString(l)+" scale("+i+") "},_reset:function(){var e=this._image,t=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),r=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(t);C.DomUtil.setPosition(e,t);e.style.width=r.x+"px";e.style.height=r.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){C.DomUtil.setOpacity(this._image,this.options.opacity)}});C.imageOverlay=function(e,t,r){return new C.ImageOverlay(e,t,r)};C.Icon=C.Class.extend({options:{className:""},initialize:function(e){C.setOptions(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var r=this._getIconUrl(e);if(!r){if(e==="icon"){throw new Error("iconUrl not set in Icon options (see the docs).")}return null}var i;if(!t||t.tagName!=="IMG"){i=this._createImg(r)}else{i=this._createImg(r,t)}this._setIconStyles(i,e);return i},_setIconStyles:function(e,t){var r=this.options,i=C.point(r[t+"Size"]),n;if(t==="shadow"){n=C.point(r.shadowAnchor||r.iconAnchor)}else{n=C.point(r.iconAnchor)}if(!n&&i){n=i.divideBy(2,true)}e.className="leaflet-marker-"+t+" "+r.className;if(n){e.style.marginLeft=-n.x+"px";e.style.marginTop=-n.y+"px"}if(i){e.style.width=i.x+"px";e.style.height=i.y+"px"}},_createImg:function(e,t){t=t||F.createElement("img");t.src=e;return t},_getIconUrl:function(e){if(C.Browser.retina&&this.options[e+"RetinaUrl"]){return this.options[e+"RetinaUrl"]}return this.options[e+"Url"]}});C.icon=function(e){return new C.Icon(e)};C.Icon.Default=C.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(e){var t=e+"Url";if(this.options[t]){return this.options[t]}if(C.Browser.retina&&e==="icon"){e+="-2x"}var r=C.Icon.Default.imagePath;if(!r){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.")}return r+"/marker-"+e+".png"}});C.Icon.Default.imagePath=function(){var e=F.getElementsByTagName("script"),t=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;var r,i,n,a,o;for(r=0,i=e.length;r<i;r++){n=e[r].src;a=n.match(t);if(a){o=n.split(t)[0];return(o?o+"/":"")+"images"}}}();C.Marker=C.Class.extend({includes:C.Mixin.Events,options:{icon:new C.Icon.Default,title:"",alt:"",clickable:true,draggable:false,keyboard:true,zIndexOffset:0,opacity:1,riseOnHover:false,riseOffset:250},initialize:function(e,t){C.setOptions(this,t);this._latlng=C.latLng(e)},onAdd:function(e){this._map=e;e.on("viewreset",this.update,this);this._initIcon();this.update();this.fire("add");if(e.options.zoomAnimation&&e.options.markerZoomAnimation){e.on("zoomanim",this._animateZoom,this)}},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){if(this.dragging){this.dragging.disable()}this._removeIcon();this._removeShadow();this.fire("remove");e.off({viewreset:this.update,zoomanim:this._animateZoom},this);this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(e){this._latlng=C.latLng(e);this.update();return this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(e){this.options.zIndexOffset=e;this.update();return this},setIcon:function(e){this.options.icon=e;if(this._map){this._initIcon();this.update()}if(this._popup){this.bindPopup(this._popup)}return this},update:function(){if(this._icon){this._setPos(this._map.latLngToLayerPoint(this._latlng).round())}return this},_initIcon:function(){var e=this.options,t=this._map,r=t.options.zoomAnimation&&t.options.markerZoomAnimation,i=r?"leaflet-zoom-animated":"leaflet-zoom-hide";var n=e.icon.createIcon(this._icon),a=false;if(n!==this._icon){if(this._icon){this._removeIcon()}a=true;if(e.title){n.title=e.title}if(e.alt){n.alt=e.alt}}C.DomUtil.addClass(n,i);if(e.keyboard){n.tabIndex="0"}this._icon=n;this._initInteraction();if(e.riseOnHover){C.DomEvent.on(n,"mouseover",this._bringToFront,this).on(n,"mouseout",this._resetZIndex,this)}var o=e.icon.createShadow(this._shadow),s=false;if(o!==this._shadow){this._removeShadow();s=true}if(o){C.DomUtil.addClass(o,i)}this._shadow=o;if(e.opacity<1){this._updateOpacity()}var l=this._map._panes;if(a){l.markerPane.appendChild(this._icon)}if(o&&s){l.shadowPane.appendChild(this._shadow)}},_removeIcon:function(){if(this.options.riseOnHover){C.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex)}this._map._panes.markerPane.removeChild(this._icon);this._icon=null},_removeShadow:function(){if(this._shadow){this._map._panes.shadowPane.removeChild(this._shadow)}this._shadow=null},_setPos:function(e){C.DomUtil.setPosition(this._icon,e);if(this._shadow){C.DomUtil.setPosition(this._shadow,e)}this._zIndex=e.y+this.options.zIndexOffset;this._resetZIndex()},_updateZIndex:function(e){this._icon.style.zIndex=this._zIndex+e},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(!this.options.clickable){return}var e=this._icon,t=["dblclick","mousedown","mouseover","mouseout","contextmenu"];C.DomUtil.addClass(e,"leaflet-clickable");C.DomEvent.on(e,"click",this._onMouseClick,this);C.DomEvent.on(e,"keypress",this._onKeyPress,this);for(var r=0;r<t.length;r++){C.DomEvent.on(e,t[r],this._fireMouseEvent,this)}if(C.Handler.MarkerDrag){this.dragging=new C.Handler.MarkerDrag(this);if(this.options.draggable){this.dragging.enable()}}},_onMouseClick:function(e){var t=this.dragging&&this.dragging.moved();if(this.hasEventListeners(e.type)||t){C.DomEvent.stopPropagation(e)}if(t){return}if((!this.dragging||!this.dragging._enabled)&&this._map.dragging&&this._map.dragging.moved()){return}this.fire(e.type,{originalEvent:e,latlng:this._latlng})},_onKeyPress:function(e){if(e.keyCode===13){this.fire("click",{originalEvent:e,latlng:this._latlng})}},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng});if(e.type==="contextmenu"&&this.hasEventListeners(e.type)){C.DomEvent.preventDefault(e)}if(e.type!=="mousedown"){C.DomEvent.stopPropagation(e)}else{C.DomEvent.preventDefault(e)}},setOpacity:function(e){this.options.opacity=e;if(this._map){this._updateOpacity()}return this},_updateOpacity:function(){C.DomUtil.setOpacity(this._icon,this.options.opacity);if(this._shadow){C.DomUtil.setOpacity(this._shadow,this.options.opacity)}},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}});C.marker=function(e,t){return new C.Marker(e,t)};C.DivIcon=C.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:false},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:F.createElement("div"),r=this.options;if(r.html!==false){t.innerHTML=r.html}else{t.innerHTML=""}if(r.bgPos){t.style.backgroundPosition=-r.bgPos.x+"px "+-r.bgPos.y+"px"}this._setIconStyles(t,"icon");return t},createShadow:function(){return null}});C.divIcon=function(e){return new C.DivIcon(e)};C.Map.mergeOptions({closePopupOnClick:true});C.Popup=C.Class.extend({includes:C.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:true,closeButton:true,offset:[0,7],autoPanPadding:[5,5],keepInView:false,className:"",zoomAnimation:true},initialize:function(e,t){C.setOptions(this,e);this._source=t;this._animated=C.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(e){this._map=e;if(!this._container){this._initLayout()}var t=e.options.fadeAnimation;if(t){C.DomUtil.setOpacity(this._container,0)}e._panes.popupPane.appendChild(this._container);e.on(this._getEvents(),this);this.update();if(t){C.DomUtil.setOpacity(this._container,1)}this.fire("open");e.fire("popupopen",{popup:this});if(this._source){this._source.fire("popupopen",{popup:this})}},addTo:function(e){e.addLayer(this);return this},openOn:function(e){e.openPopup(this);return this},onRemove:function(e){e._panes.popupPane.removeChild(this._container);C.Util.falseFn(this._container.offsetWidth);e.off(this._getEvents(),this);if(e.options.fadeAnimation){C.DomUtil.setOpacity(this._container,0)}this._map=null;this.fire("close");e.fire("popupclose",{popup:this});if(this._source){this._source.fire("popupclose",{popup:this})}},getLatLng:function(){return this._latlng},setLatLng:function(e){this._latlng=C.latLng(e);if(this._map){this._updatePosition();this._adjustPan()}return this},getContent:function(){return this._content},setContent:function(e){this._content=e;this.update();return this},update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_getEvents:function(){var e={viewreset:this._updatePosition};if(this._animated){e.zoomanim=this._zoomAnimation}if("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick){e.preclick=this._close}if(this.options.keepInView){e.moveend=this._adjustPan}return e},_close:function(){if(this._map){this._map.closePopup(this)}},_initLayout:function(){var e="leaflet-popup",t=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),r=this._container=C.DomUtil.create("div",t),i;if(this.options.closeButton){i=this._closeButton=C.DomUtil.create("a",e+"-close-button",r);i.href="#close";i.innerHTML="&#215;";C.DomEvent.disableClickPropagation(i);C.DomEvent.on(i,"click",this._onCloseButtonClick,this)}var n=this._wrapper=C.DomUtil.create("div",e+"-content-wrapper",r);C.DomEvent.disableClickPropagation(n);this._contentNode=C.DomUtil.create("div",e+"-content",n);C.DomEvent.disableScrollPropagation(this._contentNode);C.DomEvent.on(n,"contextmenu",C.DomEvent.stopPropagation);this._tipContainer=C.DomUtil.create("div",e+"-tip-container",r);this._tip=C.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._contentNode.innerHTML=this._content}else{while(this._contentNode.hasChildNodes()){this._contentNode.removeChild(this._contentNode.firstChild)}this._contentNode.appendChild(this._content)}this.fire("contentupdate")},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="";t.whiteSpace="nowrap";var r=e.offsetWidth;r=Math.min(r,this.options.maxWidth);r=Math.max(r,this.options.minWidth);t.width=r+1+"px";t.whiteSpace="";t.height="";var i=e.offsetHeight,n=this.options.maxHeight,a="leaflet-popup-scrolled";if(n&&i>n){t.height=n+"px";C.DomUtil.addClass(e,a)}else{C.DomUtil.removeClass(e,a)}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(!this._map){return}var e=this._map.latLngToLayerPoint(this._latlng),t=this._animated,r=C.point(this.options.offset);if(t){C.DomUtil.setPosition(this._container,e)}this._containerBottom=-r.y-(t?0:e.y);this._containerLeft=-Math.round(this._containerWidth/2)+r.x+(t?0:e.x);this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);C.DomUtil.setPosition(this._container,t)},_adjustPan:function(){if(!this.options.autoPan){return}var e=this._map,t=this._container.offsetHeight,r=this._containerWidth,i=new C.Point(this._containerLeft,-t-this._containerBottom);if(this._animated){i._add(C.DomUtil.getPosition(this._container))}var n=e.layerPointToContainerPoint(i),a=C.point(this.options.autoPanPadding),o=C.point(this.options.autoPanPaddingTopLeft||a),s=C.point(this.options.autoPanPaddingBottomRight||a),l=e.getSize(),u=0,d=0;if(n.x+r+s.x>l.x){u=n.x+r-l.x+s.x}if(n.x-u-o.x<0){u=n.x-o.x}if(n.y+t+s.y>l.y){d=n.y+t-l.y+s.y}if(n.y-d-o.y<0){d=n.y-o.y}if(u||d){e.fire("autopanstart").panBy([u,d])}},_onCloseButtonClick:function(e){this._close();C.DomEvent.stop(e)}});C.popup=function(e,t){return new C.Popup(e,t)};C.Map.include({openPopup:function(e,t,r){this.closePopup();if(!(e instanceof C.Popup)){var i=e;e=new C.Popup(r).setLatLng(t).setContent(i)}e._isOpen=true;this._popup=e;return this.addLayer(e)},closePopup:function(e){if(!e||e===this._popup){e=this._popup;this._popup=null}if(e){this.removeLayer(e);e._isOpen=false}return this}});C.Marker.include({openPopup:function(){if(this._popup&&this._map&&!this._map.hasLayer(this._popup)){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup)}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},togglePopup:function(){if(this._popup){if(this._popup._isOpen){this.closePopup()}else{this.openPopup()}}return this},bindPopup:function(e,t){var r=C.point(this.options.icon.options.popupAnchor||[0,0]);r=r.add(C.Popup.prototype.options.offset);if(t&&t.offset){r=r.add(t.offset)}t=C.extend({offset:r},t);if(!this._popupHandlersAdded){this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this);this._popupHandlersAdded=true}if(e instanceof C.Popup){C.setOptions(e,t);this._popup=e;e._source=this}else{this._popup=new C.Popup(t,this).setContent(e)}return this},setPopupContent:function(e){if(this._popup){this._popup.setContent(e)}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this);this._popupHandlersAdded=false}return this},getPopup:function(){return this._popup},_movePopup:function(e){this._popup.setLatLng(e.latlng)}});C.LayerGroup=C.Class.extend({initialize:function(e){this._layers={};var t,r;if(e){for(t=0,r=e.length;t<r;t++){this.addLayer(e[t])}}},addLayer:function(e){var t=this.getLayerId(e);this._layers[t]=e;if(this._map){this._map.addLayer(e)}return this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);if(this._map&&this._layers[t]){this._map.removeLayer(this._layers[t])}delete this._layers[t];return this},hasLayer:function(e){if(!e){return false}return e in this._layers||this.getLayerId(e)in this._layers},clearLayers:function(){this.eachLayer(this.removeLayer,this);return this},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),r,i;for(r in this._layers){i=this._layers[r];if(i[e]){i[e].apply(i,t)}}return this},onAdd:function(e){this._map=e;this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e);this._map=null},addTo:function(e){e.addLayer(this);return this},eachLayer:function(e,t){for(var r in this._layers){e.call(t,this._layers[r])}return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];for(var t in this._layers){e.push(this._layers[t])}return e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return C.stamp(e)}});C.layerGroup=function(e){return new C.LayerGroup(e)};C.FeatureGroup=C.LayerGroup.extend({includes:C.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(e){if(this.hasLayer(e)){return this}if("on"in e){e.on(C.FeatureGroup.EVENTS,this._propagateEvent,this)}C.LayerGroup.prototype.addLayer.call(this,e);if(this._popupContent&&e.bindPopup){e.bindPopup(this._popupContent,this._popupOptions)}return this.fire("layeradd",{layer:e})},removeLayer:function(e){if(!this.hasLayer(e)){return this}if(e in this._layers){e=this._layers[e]}if("off"in e){e.off(C.FeatureGroup.EVENTS,this._propagateEvent,this)}C.LayerGroup.prototype.removeLayer.call(this,e);if(this._popupContent){this.invoke("unbindPopup")}return this.fire("layerremove",{layer:e})},bindPopup:function(e,t){this._popupContent=e;this._popupOptions=t;return this.invoke("bindPopup",e,t)},openPopup:function(e){for(var t in this._layers){this._layers[t].openPopup(e);break}return this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new C.LatLngBounds;this.eachLayer(function(e){t.extend(e instanceof C.Marker?e.getLatLng():e.getBounds())});return t},_propagateEvent:function(e){e=C.extend({layer:e.target,target:this},e);this.fire(e.type,e)}});C.featureGroup=function(e){return new C.FeatureGroup(e)};C.Path=C.Class.extend({includes:[C.Mixin.Events],statics:{CLIP_PADDING:function(){var e=C.Browser.mobile?1280:2e3,t=(e/Math.max(w.outerWidth,w.outerHeight)-1)/2;return Math.max(0,Math.min(.5,t))}()},options:{stroke:true,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:false,fillColor:null,fillOpacity:.2,clickable:true},initialize:function(e){C.setOptions(this,e)},onAdd:function(e){this._map=e;if(!this._container){this._initElements();this._initEvents()}this.projectLatlngs();this._updatePath();if(this._container){this._map._pathRoot.appendChild(this._container)}this.fire("add");e.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(e){e.addLayer(this);return this},onRemove:function(e){e._pathRoot.removeChild(this._container);this.fire("remove");this._map=null;if(C.Browser.vml){this._container=null;this._stroke=null;this._fill=null}e.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(e){C.setOptions(this,e);if(this._container){this._updateStyle()}return this},redraw:function(){if(this._map){this.projectLatlngs();this._updatePath()}return this}});C.Map.include({_updatePathViewport:function(){var e=C.Path.CLIP_PADDING,t=this.getSize(),r=C.DomUtil.getPosition(this._mapPane),i=r.multiplyBy(-1)._subtract(t.multiplyBy(e)._round()),n=i.add(t.multiplyBy(1+e*2)._round());this._pathViewport=new C.Bounds(i,n)}});C.Path.SVG_NS="http://www.w3.org/2000/svg";C.Browser.svg=!!(F.createElementNS&&F.createElementNS(C.Path.SVG_NS,"svg").createSVGRect);C.Path=C.Path.extend({statics:{SVG:C.Browser.svg},bringToFront:function(){var e=this._map._pathRoot,t=this._container;if(t&&e.lastChild!==t){e.appendChild(t)}return this},bringToBack:function(){var e=this._map._pathRoot,t=this._container,r=e.firstChild;if(t&&r!==t){e.insertBefore(t,r)}return this},getPathString:function(){},_createElement:function(e){return F.createElementNS(C.Path.SVG_NS,e)},_initElements:function(){this._map._initPathRoot();this._initPath();this._initStyle()},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");if(this.options.className){C.DomUtil.addClass(this._path,this.options.className)}this._container.appendChild(this._path)},_initStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke-linejoin","round");this._path.setAttribute("stroke-linecap","round")}if(this.options.fill){this._path.setAttribute("fill-rule","evenodd")}if(this.options.pointerEvents){this._path.setAttribute("pointer-events",this.options.pointerEvents)}if(!this.options.clickable&&!this.options.pointerEvents){this._path.setAttribute("pointer-events","none")}this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._path.setAttribute("stroke",this.options.color);this._path.setAttribute("stroke-opacity",this.options.opacity);this._path.setAttribute("stroke-width",this.options.weight);if(this.options.dashArray){this._path.setAttribute("stroke-dasharray",this.options.dashArray)}else{this._path.removeAttribute("stroke-dasharray")}if(this.options.lineCap){this._path.setAttribute("stroke-linecap",this.options.lineCap)}if(this.options.lineJoin){this._path.setAttribute("stroke-linejoin",this.options.lineJoin)}}else{this._path.setAttribute("stroke","none")}if(this.options.fill){this._path.setAttribute("fill",this.options.fillColor||this.options.color);this._path.setAttribute("fill-opacity",this.options.fillOpacity)}else{this._path.setAttribute("fill","none")}},_updatePath:function(){var e=this.getPathString();if(!e){e="M0 0"}this._path.setAttribute("d",e)},_initEvents:function(){if(this.options.clickable){if(C.Browser.svg||!C.Browser.vml){C.DomUtil.addClass(this._path,"leaflet-clickable")}C.DomEvent.on(this._container,"click",this._onMouseClick,this);var e=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"];for(var t=0;t<e.length;t++){C.DomEvent.on(this._container,e[t],this._fireMouseEvent,this)}}},_onMouseClick:function(e){if(this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(!this._map||!this.hasEventListeners(e.type)){return}var t=this._map,r=t.mouseEventToContainerPoint(e),i=t.containerPointToLayerPoint(r),n=t.layerPointToLatLng(i);this.fire(e.type,{latlng:n,layerPoint:i,containerPoint:r,originalEvent:e});if(e.type==="contextmenu"){C.DomEvent.preventDefault(e)}if(e.type!=="mousemove"){C.DomEvent.stopPropagation(e)}}});C.Map.include({_initPathRoot:function(){if(!this._pathRoot){this._pathRoot=C.Path.prototype._createElement("svg");this._panes.overlayPane.appendChild(this._pathRoot);if(this.options.zoomAnimation&&C.Browser.any3d){C.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated");this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})}else{C.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide")}this.on("moveend",this._updateSvgViewport);this._updateSvgViewport()}},_animatePathZoom:function(e){var t=this.getZoomScale(e.zoom),r=this._getCenterOffset(e.center)._multiplyBy(-t)._add(this._pathViewport.min);this._pathRoot.style[C.DomUtil.TRANSFORM]=C.DomUtil.getTranslateString(r)+" scale("+t+") ";this._pathZooming=true},_endPathZoom:function(){this._pathZooming=false},_updateSvgViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var e=this._pathViewport,t=e.min,r=e.max,i=r.x-t.x,n=r.y-t.y,a=this._pathRoot,o=this._panes.overlayPane;if(C.Browser.mobileWebkit){o.removeChild(a)}C.DomUtil.setPosition(a,t);a.setAttribute("width",i);a.setAttribute("height",n);a.setAttribute("viewBox",[t.x,t.y,i,n].join(" "));if(C.Browser.mobileWebkit){o.appendChild(a)}}});C.Path.include({bindPopup:function(e,t){if(e instanceof C.Popup){this._popup=e}else{if(!this._popup||t){this._popup=new C.Popup(t,this)}this._popup.setContent(e)}if(!this._popupHandlersAdded){this.on("click",this._openPopup,this).on("remove",this.closePopup,this);this._popupHandlersAdded=true}return this},unbindPopup:function(){if(this._popup){this._popup=null;this.off("click",this._openPopup).off("remove",this.closePopup);this._popupHandlersAdded=false}return this},openPopup:function(e){if(this._popup){e=e||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)];this._openPopup({latlng:e})}return this},closePopup:function(){if(this._popup){this._popup._close()}return this},_openPopup:function(e){this._popup.setLatLng(e.latlng);this._map.openPopup(this._popup)}});C.Browser.vml=!C.Browser.svg&&function(){try{var e=F.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;t.style.behavior="url(#default#VML)";return t&&typeof t.adj==="object"}catch(e){return false}}();C.Path=C.Browser.svg||!C.Browser.vml?C.Path:C.Path.extend({statics:{VML:true,CLIP_PADDING:.02},_createElement:function(){try{F.namespaces.add("lvml","urn:schemas-microsoft-com:vml");return function(e){return F.createElement("<lvml:"+e+' class="lvml">')}}catch(e){return function(e){return F.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var e=this._container=this._createElement("shape");C.DomUtil.addClass(e,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:""));if(this.options.clickable){C.DomUtil.addClass(e,"leaflet-clickable")}e.coordsize="1 1";this._path=this._createElement("path");e.appendChild(this._path);this._map._pathRoot.appendChild(e)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var e=this._stroke,t=this._fill,r=this.options,i=this._container;i.stroked=r.stroke;i.filled=r.fill;if(r.stroke){if(!e){e=this._stroke=this._createElement("stroke");e.endcap="round";i.appendChild(e)}e.weight=r.weight+"px";e.color=r.color;e.opacity=r.opacity;if(r.dashArray){e.dashStyle=C.Util.isArray(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," ")}else{e.dashStyle=""}if(r.lineCap){e.endcap=r.lineCap.replace("butt","flat")}if(r.lineJoin){e.joinstyle=r.lineJoin}}else if(e){i.removeChild(e);this._stroke=null}if(r.fill){if(!t){t=this._fill=this._createElement("fill");i.appendChild(t)}t.color=r.fillColor||r.color;t.opacity=r.fillOpacity}else if(t){i.removeChild(t);this._fill=null}},_updatePath:function(){var e=this._container.style;e.display="none";this._path.v=this.getPathString()+" ";e.display=""}});C.Map.include(C.Browser.svg||!C.Browser.vml?{}:{_initPathRoot:function(){if(this._pathRoot){return}var e=this._pathRoot=F.createElement("div");e.className="leaflet-vml-container";this._panes.overlayPane.appendChild(e);this.on("moveend",this._updatePathViewport);this._updatePathViewport()}});C.Browser.canvas=function(){return!!F.createElement("canvas").getContext}();C.Path=C.Path.SVG&&!w.L_PREFER_CANVAS||!C.Browser.canvas?C.Path:C.Path.extend({statics:{CANVAS:true,SVG:false},redraw:function(){if(this._map){this.projectLatlngs();this._requestUpdate()}return this},setStyle:function(e){C.setOptions(this,e);if(this._map){this._updateStyle();this._requestUpdate()}return this},onRemove:function(e){e.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this);if(this.options.clickable){this._map.off("click",this._onClick,this);this._map.off("mousemove",this._onMouseMove,this)}this._requestUpdate();this.fire("remove");this._map=null},_requestUpdate:function(){if(this._map&&!C.Path._updateRequest){C.Path._updateRequest=C.Util.requestAnimFrame(this._fireMapMoveEnd,this._map)}},_fireMapMoveEnd:function(){C.Path._updateRequest=null;this.fire("moveend")},_initElements:function(){this._map._initPathRoot();this._ctx=this._map._canvasCtx},_updateStyle:function(){var e=this.options;if(e.stroke){this._ctx.lineWidth=e.weight;this._ctx.strokeStyle=e.color}if(e.fill){this._ctx.fillStyle=e.fillColor||e.color}if(e.lineCap){this._ctx.lineCap=e.lineCap}if(e.lineJoin){this._ctx.lineJoin=e.lineJoin}},_drawPath:function(){var e,t,r,i,n,a;this._ctx.beginPath();for(e=0,r=this._parts.length;e<r;e++){for(t=0,i=this._parts[e].length;t<i;t++){n=this._parts[e][t];a=(t===0?"move":"line")+"To";this._ctx[a](n.x,n.y)}if(this instanceof C.Polygon){this._ctx.closePath()}}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(this._checkIfEmpty()){return}var e=this._ctx,t=this.options;this._drawPath();e.save();this._updateStyle();if(t.fill){e.globalAlpha=t.fillOpacity;e.fill(t.fillRule||"evenodd")}if(t.stroke){e.globalAlpha=t.opacity;e.stroke()}e.restore()},_initEvents:function(){if(this.options.clickable){this._map.on("mousemove",this._onMouseMove,this);this._map.on("click dblclick contextmenu",this._fireMouseEvent,this)}},_fireMouseEvent:function(e){if(this._containsPoint(e.layerPoint)){this.fire(e.type,e)}},_onMouseMove:function(e){if(!this._map||this._map._animatingZoom){return}if(this._containsPoint(e.layerPoint)){this._ctx.canvas.style.cursor="pointer";this._mouseInside=true;this.fire("mouseover",e)}else if(this._mouseInside){this._ctx.canvas.style.cursor="";this._mouseInside=false;this.fire("mouseout",e)}}});C.Map.include(C.Path.SVG&&!w.L_PREFER_CANVAS||!C.Browser.canvas?{}:{_initPathRoot:function(){var e=this._pathRoot,t;if(!e){e=this._pathRoot=F.createElement("canvas");e.style.position="absolute";t=this._canvasCtx=e.getContext("2d");t.lineCap="round";t.lineJoin="round";this._panes.overlayPane.appendChild(e);if(this.options.zoomAnimation){this._pathRoot.className="leaflet-zoom-animated";this.on("zoomanim",this._animatePathZoom);this.on("zoomend",this._endPathZoom)}this.on("moveend",this._updateCanvasViewport);this._updateCanvasViewport()}},_updateCanvasViewport:function(){if(this._pathZooming){return}this._updatePathViewport();var e=this._pathViewport,t=e.min,r=e.max.subtract(t),i=this._pathRoot;C.DomUtil.setPosition(i,t);i.width=r.x;i.height=r.y;i.getContext("2d").translate(-t.x,-t.y)}});C.LineUtil={simplify:function(e,t){if(!t||!e.length){return e.slice()}var r=t*t;e=this._reducePoints(e,r);e=this._simplifyDP(e,r);return e},pointToSegmentDistance:function(e,t,r){return Math.sqrt(this._sqClosestPointOnSegment(e,t,r,true))},closestPointOnSegment:function(e,t,r){return this._sqClosestPointOnSegment(e,t,r)},_simplifyDP:function(e,t){var r=e.length,i=typeof Uint8Array!==b+""?Uint8Array:Array,n=new i(r);n[0]=n[r-1]=1;this._simplifyDPStep(e,n,t,0,r-1);var a,o=[];for(a=0;a<r;a++){if(n[a]){o.push(e[a])}}return o},_simplifyDPStep:function(e,t,r,i,n){var a=0,o,s,l;for(s=i+1;s<=n-1;s++){l=this._sqClosestPointOnSegment(e[s],e[i],e[n],true);if(l>a){o=s;a=l}}if(a>r){t[o]=1;this._simplifyDPStep(e,t,r,i,o);this._simplifyDPStep(e,t,r,o,n)}},_reducePoints:function(e,t){var r=[e[0]];for(var i=1,n=0,a=e.length;i<a;i++){if(this._sqDist(e[i],e[n])>t){r.push(e[i]);n=i}}if(n<a-1){r.push(e[a-1])}return r},clipSegment:function(e,t,r,i){var n=i?this._lastCode:this._getBitCode(e,r),a=this._getBitCode(t,r),o,s,l;this._lastCode=a;while(true){if(!(n|a)){return[e,t]}else if(n&a){return false}else{o=n||a;s=this._getEdgeIntersection(e,t,o,r);l=this._getBitCode(s,r);if(o===n){e=s;n=l}else{t=s;a=l}}}},_getEdgeIntersection:function(e,t,r,i){var n=t.x-e.x,a=t.y-e.y,o=i.min,s=i.max;if(r&8){return new C.Point(e.x+n*(s.y-e.y)/a,s.y)}else if(r&4){return new C.Point(e.x+n*(o.y-e.y)/a,o.y)}else if(r&2){return new C.Point(s.x,e.y+a*(s.x-e.x)/n)}else if(r&1){return new C.Point(o.x,e.y+a*(o.x-e.x)/n)}},_getBitCode:function(e,t){var r=0;if(e.x<t.min.x){r|=1}else if(e.x>t.max.x){r|=2}if(e.y<t.min.y){r|=4}else if(e.y>t.max.y){r|=8}return r},_sqDist:function(e,t){var r=t.x-e.x,i=t.y-e.y;return r*r+i*i},_sqClosestPointOnSegment:function(e,t,r,i){var n=t.x,a=t.y,o=r.x-n,s=r.y-a,l=o*o+s*s,u;if(l>0){u=((e.x-n)*o+(e.y-a)*s)/l;if(u>1){n=r.x;a=r.y}else if(u>0){n+=o*u;a+=s*u}}o=e.x-n;s=e.y-a;return i?o*o+s*s:new C.Point(n,a)}};C.Polyline=C.Path.extend({initialize:function(e,t){C.Path.prototype.initialize.call(this,t);this._latlngs=this._convertLatLngs(e)},options:{smoothFactor:1,noClip:false},projectLatlngs:function(){this._originalPoints=[];for(var e=0,t=this._latlngs.length;e<t;e++){this._originalPoints[e]=this._map.latLngToLayerPoint(this._latlngs[e])}},getPathString:function(){for(var e=0,t=this._parts.length,r="";e<t;e++){r+=this._getPathPartStr(this._parts[e])}return r},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){this._latlngs=this._convertLatLngs(e);return this.redraw()},addLatLng:function(e){this._latlngs.push(C.latLng(e));return this.redraw()},spliceLatLngs:function(){var e=[].splice.apply(this._latlngs,arguments);this._convertLatLngs(this._latlngs,true);this.redraw();return e},closestLayerPoint:function(e){var t=Infinity,r=this._parts,i,n,a=null;for(var o=0,s=r.length;o<s;o++){var l=r[o];for(var u=1,d=l.length;u<d;u++){i=l[u-1];n=l[u];var c=C.LineUtil._sqClosestPointOnSegment(e,i,n,true);if(c<t){t=c;a=C.LineUtil._sqClosestPointOnSegment(e,i,n)}}}if(a){a.distance=Math.sqrt(t)}return a},getBounds:function(){return new C.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(e,t){var r,i,n=t?e:[];for(r=0,i=e.length;r<i;r++){if(C.Util.isArray(e[r])&&typeof e[r][0]!=="number"){return}n[r]=C.latLng(e[r])}return n},_initEvents:function(){C.Path.prototype._initEvents.call(this)},_getPathPartStr:function(e){var t=C.Path.VML;for(var r=0,i=e.length,n="",a;r<i;r++){a=e[r];if(t){a._round()}n+=(r?"L":"M")+a.x+" "+a.y}return n},_clipPoints:function(){var e=this._originalPoints,t=e.length,r,i,n;if(this.options.noClip){this._parts=[e];return}this._parts=[];var a=this._parts,o=this._map._pathViewport,s=C.LineUtil;for(r=0,i=0;r<t-1;r++){n=s.clipSegment(e[r],e[r+1],o,r);if(!n){continue}a[i]=a[i]||[];a[i].push(n[0]);if(n[1]!==e[r+1]||r===t-2){a[i].push(n[1]);i++}}},_simplifyPoints:function(){var e=this._parts,t=C.LineUtil;for(var r=0,i=e.length;r<i;r++){e[r]=t.simplify(e[r],this.options.smoothFactor)}},_updatePath:function(){if(!this._map){return}this._clipPoints();this._simplifyPoints();C.Path.prototype._updatePath.call(this)}});C.polyline=function(e,t){return new C.Polyline(e,t)};C.PolyUtil={};C.PolyUtil.clipPolygon=function(e,t){var r,i=[1,4,2,8],n,a,o,s,l,u,d,c,f=C.LineUtil;for(n=0,u=e.length;n<u;n++){e[n]._code=f._getBitCode(e[n],t)}for(o=0;o<4;o++){d=i[o];r=[];for(n=0,u=e.length,a=u-1;n<u;a=n++){s=e[n];l=e[a];if(!(s._code&d)){if(l._code&d){c=f._getEdgeIntersection(l,s,d,t);c._code=f._getBitCode(c,t);r.push(c)}r.push(s)}else if(!(l._code&d)){c=f._getEdgeIntersection(l,s,d,t);c._code=f._getBitCode(c,t);r.push(c)}}e=r}return e};C.Polygon=C.Polyline.extend({options:{fill:true},initialize:function(e,t){C.Polyline.prototype.initialize.call(this,e,t);this._initWithHoles(e)},_initWithHoles:function(e){var t,r,i;if(e&&C.Util.isArray(e[0])&&typeof e[0][0]!=="number"){this._latlngs=this._convertLatLngs(e[0]);this._holes=e.slice(1);for(t=0,r=this._holes.length;t<r;t++){i=this._holes[t]=this._convertLatLngs(this._holes[t]);if(i[0].equals(i[i.length-1])){i.pop()}}}e=this._latlngs;if(e.length>=2&&e[0].equals(e[e.length-1])){e.pop()}},projectLatlngs:function(){C.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(!this._holes){return}var e,t,r,i;for(e=0,r=this._holes.length;e<r;e++){this._holePoints[e]=[];for(t=0,i=this._holes[e].length;t<i;t++){this._holePoints[e][t]=this._map.latLngToLayerPoint(this._holes[e][t])}}},setLatLngs:function(e){if(e&&C.Util.isArray(e[0])&&typeof e[0][0]!=="number"){this._initWithHoles(e);return this.redraw()}else{return C.Polyline.prototype.setLatLngs.call(this,e)}},_clipPoints:function(){var e=this._originalPoints,t=[];this._parts=[e].concat(this._holePoints);if(this.options.noClip){return}for(var r=0,i=this._parts.length;r<i;r++){var n=C.PolyUtil.clipPolygon(this._parts[r],this._map._pathViewport);if(n.length){t.push(n)}}this._parts=t},_getPathPartStr:function(e){var t=C.Polyline.prototype._getPathPartStr.call(this,e);return t+(C.Browser.svg?"z":"x")}});C.polygon=function(e,t){return new C.Polygon(e,t)};(function(){function e(e){return C.FeatureGroup.extend({initialize:function(e,t){this._layers={};this._options=t;this.setLatLngs(e)},setLatLngs:function(t){var r=0,i=t.length;this.eachLayer(function(e){if(r<i){e.setLatLngs(t[r++])}else{this.removeLayer(e)}},this);while(r<i){this.addLayer(new e(t[r++],this._options))}return this},getLatLngs:function(){var t=[];this.eachLayer(function(e){t.push(e.getLatLngs())});return t}})}C.MultiPolyline=e(C.Polyline);C.MultiPolygon=e(C.Polygon);C.multiPolyline=function(e,t){return new C.MultiPolyline(e,t)};C.multiPolygon=function(e,t){return new C.MultiPolygon(e,t)}})();C.Rectangle=C.Polygon.extend({initialize:function(e,t){C.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){e=C.latLngBounds(e);return[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});C.rectangle=function(e,t){return new C.Rectangle(e,t)};C.Circle=C.Path.extend({initialize:function(e,t,r){C.Path.prototype.initialize.call(this,r);this._latlng=C.latLng(e);this._mRadius=t},options:{fill:true},setLatLng:function(e){this._latlng=C.latLng(e);return this.redraw()},setRadius:function(e){this._mRadius=e;return this.redraw()},projectLatlngs:function(){var e=this._getLngRadius(),t=this._latlng,r=this._map.latLngToLayerPoint([t.lat,t.lng-e]);this._point=this._map.latLngToLayerPoint(t);this._radius=Math.max(this._point.x-r.x,1)},getBounds:function(){var e=this._getLngRadius(),t=this._mRadius/40075017*360,r=this._latlng;return new C.LatLngBounds([r.lat-t,r.lng-e],[r.lat+t,r.lng+e])},getLatLng:function(){return this._latlng},getPathString:function(){var e=this._point,t=this._radius;if(this._checkIfEmpty()){return""}if(C.Browser.svg){return"M"+e.x+","+(e.y-t)+"A"+t+","+t+",0,1,1,"+(e.x-.1)+","+(e.y-t)+" z"}else{e._round();t=Math.round(t);return"AL "+e.x+","+e.y+" "+t+","+t+" 0,"+65535*360}},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(C.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map){return false}var e=this._map._pathViewport,t=this._radius,r=this._point;return r.x-t>e.max.x||r.y-t>e.max.y||r.x+t<e.min.x||r.y+t<e.min.y}});C.circle=function(e,t,r){return new C.Circle(e,t,r)};C.CircleMarker=C.Circle.extend({options:{radius:10,weight:2},initialize:function(e,t){C.Circle.prototype.initialize.call(this,e,null,t);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){C.Circle.prototype._updateStyle.call(this);this.setRadius(this.options.radius)},setLatLng:function(e){C.Circle.prototype.setLatLng.call(this,e);if(this._popup&&this._popup._isOpen){this._popup.setLatLng(e)}return this},setRadius:function(e){this.options.radius=this._radius=e;return this.redraw()},getRadius:function(){return this._radius}});C.circleMarker=function(e,t){return new C.CircleMarker(e,t)};C.Polyline.include(!C.Path.CANVAS?{}:{_containsPoint:function(e,t){var r,i,n,a,o,s,l,u=this.options.weight/2;if(C.Browser.touch){u+=10}for(r=0,a=this._parts.length;r<a;r++){l=this._parts[r];for(i=0,o=l.length,n=o-1;i<o;n=i++){if(!t&&i===0){continue}s=C.LineUtil.pointToSegmentDistance(e,l[n],l[i]);if(s<=u){return true}}}return false}});C.Polygon.include(!C.Path.CANVAS?{}:{_containsPoint:function(e){var t=false,r,i,n,a,o,s,l,u;if(C.Polyline.prototype._containsPoint.call(this,e,true)){return true}for(a=0,l=this._parts.length;a<l;a++){r=this._parts[a];for(o=0,u=r.length,s=u-1;o<u;s=o++){i=r[o];n=r[s];if(i.y>e.y!==n.y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x){t=!t}}}return t}});C.Circle.include(!C.Path.CANVAS?{}:{_drawPath:function(){var e=this._point;this._ctx.beginPath();this._ctx.arc(e.x,e.y,this._radius,0,Math.PI*2,false)},_containsPoint:function(e){var t=this._point,r=this.options.stroke?this.options.weight/2:0;return e.distanceTo(t)<=this._radius+r}});C.CircleMarker.include(!C.Path.CANVAS?{}:{_updateStyle:function(){C.Path.prototype._updateStyle.call(this)}});C.GeoJSON=C.FeatureGroup.extend({initialize:function(e,t){C.setOptions(this,t);this._layers={};if(e){this.addData(e)}},addData:function(e){var t=C.Util.isArray(e)?e:e.features,r,i,n;if(t){for(r=0,i=t.length;r<i;r++){n=t[r];if(n.geometries||n.geometry||n.features||n.coordinates){this.addData(t[r])}}return this}var a=this.options;if(a.filter&&!a.filter(e)){return}var o=C.GeoJSON.geometryToLayer(e,a.pointToLayer,a.coordsToLatLng,a);o.feature=C.GeoJSON.asFeature(e);o.defaultOptions=o.options;this.resetStyle(o);if(a.onEachFeature){a.onEachFeature(e,o)}return this.addLayer(o)},resetStyle:function(e){var t=this.options.style;if(t){C.Util.extend(e.options,e.defaultOptions);this._setLayerStyle(e,t)}},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(e,t){if(typeof t==="function"){t=t(e.feature)}if(e.setStyle){e.setStyle(t)}}});C.extend(C.GeoJSON,{geometryToLayer:function(e,t,r,i){var n=e.type==="Feature"?e.geometry:e,a=n.coordinates,o=[],s,l,u,d;r=r||this.coordsToLatLng;switch(n.type){case"Point":s=r(a);return t?t(e,s):new C.Marker(s);case"MultiPoint":for(u=0,d=a.length;u<d;u++){s=r(a[u]);o.push(t?t(e,s):new C.Marker(s))}return new C.FeatureGroup(o);case"LineString":l=this.coordsToLatLngs(a,0,r);return new C.Polyline(l,i);case"Polygon":if(a.length===2&&!a[1].length){throw new Error("Invalid GeoJSON object.")}l=this.coordsToLatLngs(a,1,r);return new C.Polygon(l,i);case"MultiLineString":l=this.coordsToLatLngs(a,1,r);return new C.MultiPolyline(l,i);case"MultiPolygon":l=this.coordsToLatLngs(a,2,r);return new C.MultiPolygon(l,i);case"GeometryCollection":for(u=0,d=n.geometries.length;u<d;u++){o.push(this.geometryToLayer({geometry:n.geometries[u],type:"Feature",properties:e.properties},t,r,i))}return new C.FeatureGroup(o);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(e){return new C.LatLng(e[1],e[0],e[2])},coordsToLatLngs:function(e,t,r){var i,n,a,o=[];for(n=0,a=e.length;n<a;n++){i=t?this.coordsToLatLngs(e[n],t-1,r):(r||this.coordsToLatLng)(e[n]);o.push(i)}return o},latLngToCoords:function(e){var t=[e.lng,e.lat];if(e.alt!==b){t.push(e.alt)}return t},latLngsToCoords:function(e){var t=[];for(var r=0,i=e.length;r<i;r++){t.push(C.GeoJSON.latLngToCoords(e[r]))}return t},getFeature:function(e,t){return e.feature?C.extend({},e.feature,{geometry:t}):C.GeoJSON.asFeature(t)},asFeature:function(e){if(e.type==="Feature"){return e}return{type:"Feature",properties:{},geometry:e}}});var t={toGeoJSON:function(){return C.GeoJSON.getFeature(this,{type:"Point",coordinates:C.GeoJSON.latLngToCoords(this.getLatLng())})}};C.Marker.include(t);C.Circle.include(t);C.CircleMarker.include(t);C.Polyline.include({toGeoJSON:function(){return C.GeoJSON.getFeature(this,{type:"LineString",coordinates:C.GeoJSON.latLngsToCoords(this.getLatLngs())})}});C.Polygon.include({toGeoJSON:function(){var e=[C.GeoJSON.latLngsToCoords(this.getLatLngs())],t,r,i;e[0].push(e[0][0]);if(this._holes){for(t=0,r=this._holes.length;t<r;t++){i=C.GeoJSON.latLngsToCoords(this._holes[t]);i.push(i[0]);e.push(i)}}return C.GeoJSON.getFeature(this,{type:"Polygon",coordinates:e})}});(function(){function n(e){return function(){var t=[];this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)});return C.GeoJSON.getFeature(this,{type:e,coordinates:t})}}C.MultiPolyline.include({toGeoJSON:n("MultiLineString")});C.MultiPolygon.include({toGeoJSON:n("MultiPolygon")});C.LayerGroup.include({toGeoJSON:function(){var e=this.feature&&this.feature.geometry,t=[],r;if(e&&e.type==="MultiPoint"){return n("MultiPoint").call(this)}var i=e&&e.type==="GeometryCollection";this.eachLayer(function(e){if(e.toGeoJSON){r=e.toGeoJSON();t.push(i?r.geometry:C.GeoJSON.asFeature(r))}});if(i){return C.GeoJSON.getFeature(this,{geometries:t,type:"GeometryCollection"})}return{type:"FeatureCollection",features:t}}})})();C.geoJson=function(e,t){return new C.GeoJSON(e,t)};C.DomEvent={addListener:function(t,e,r,i){var n=C.stamp(r),a="_leaflet_"+e+n,o,s,l;if(t[a]){return this}o=function(e){return r.call(i||t,e||C.DomEvent._getEvent())};if(C.Browser.pointer&&e.indexOf("touch")===0){return this.addPointerListener(t,e,o,n)}if(C.Browser.touch&&e==="dblclick"&&this.addDoubleTapListener){this.addDoubleTapListener(t,o,n)}if("addEventListener"in t){if(e==="mousewheel"){t.addEventListener("DOMMouseScroll",o,false);t.addEventListener(e,o,false)}else if(e==="mouseenter"||e==="mouseleave"){s=o;l=e==="mouseenter"?"mouseover":"mouseout";o=function(e){if(!C.DomEvent._checkMouse(t,e)){return}return s(e)};t.addEventListener(l,o,false)}else if(e==="click"&&C.Browser.android){s=o;o=function(e){return C.DomEvent._filterClick(e,s)};t.addEventListener(e,o,false)}else{t.addEventListener(e,o,false)}}else if("attachEvent"in t){t.attachEvent("on"+e,o)}t[a]=o;return this},removeListener:function(e,t,r){var i=C.stamp(r),n="_leaflet_"+t+i,a=e[n];if(!a){return this}if(C.Browser.pointer&&t.indexOf("touch")===0){this.removePointerListener(e,t,i)}else if(C.Browser.touch&&t==="dblclick"&&this.removeDoubleTapListener){this.removeDoubleTapListener(e,i)}else if("removeEventListener"in e){if(t==="mousewheel"){e.removeEventListener("DOMMouseScroll",a,false);e.removeEventListener(t,a,false)}else if(t==="mouseenter"||t==="mouseleave"){e.removeEventListener(t==="mouseenter"?"mouseover":"mouseout",a,false)}else{e.removeEventListener(t,a,false)}}else if("detachEvent"in e){e.detachEvent("on"+t,a)}e[n]=null;return this},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}C.DomEvent._skipped(e);return this},disableScrollPropagation:function(e){var t=C.DomEvent.stopPropagation;return C.DomEvent.on(e,"mousewheel",t).on(e,"MozMousePixelScroll",t)},disableClickPropagation:function(e){var t=C.DomEvent.stopPropagation;for(var r=C.Draggable.START.length-1;r>=0;r--){C.DomEvent.on(e,C.Draggable.START[r],t)}return C.DomEvent.on(e,"click",C.DomEvent._fakeStop).on(e,"dblclick",t)},preventDefault:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return this},stop:function(e){return C.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,t){if(!t){return new C.Point(e.clientX,e.clientY)}var r=t.getBoundingClientRect();return new C.Point(e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop)},getWheelDelta:function(e){var t=0;if(e.wheelDelta){t=e.wheelDelta/120}if(e.detail){t=-e.detail/3}return t},_skipEvents:{},_fakeStop:function(e){C.DomEvent._skipEvents[e.type]=true},_skipped:function(e){var t=this._skipEvents[e.type];this._skipEvents[e.type]=false;return t},_checkMouse:function(e,t){var r=t.relatedTarget;if(!r){return true}try{while(r&&r!==e){r=r.parentNode}}catch(e){return false}return r!==e},_getEvent:function(){var e=w.event;if(!e){var t=arguments.callee.caller;while(t){e=t["arguments"][0];if(e&&w.Event===e.constructor){break}t=t.caller}}return e},_filterClick:function(e,t){var r=e.timeStamp||e.originalEvent.timeStamp,i=C.DomEvent._lastClick&&r-C.DomEvent._lastClick;if(i&&i>100&&i<500||e.target._simulatedClick&&!e._simulated){C.DomEvent.stop(e);return}C.DomEvent._lastClick=r;return t(e)}};C.DomEvent.on=C.DomEvent.addListener;C.DomEvent.off=C.DomEvent.removeListener;C.Draggable=C.Class.extend({includes:C.Mixin.Events,statics:{START:C.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(e,t){this._element=e;this._dragStartTarget=t||e},enable:function(){if(this._enabled){return}for(var e=C.Draggable.START.length-1;e>=0;e--){C.DomEvent.on(this._dragStartTarget,C.Draggable.START[e],this._onDown,this)}this._enabled=true},disable:function(){if(!this._enabled){return}for(var e=C.Draggable.START.length-1;e>=0;e--){C.DomEvent.off(this._dragStartTarget,C.Draggable.START[e],this._onDown,this)}this._enabled=false;this._moved=false},_onDown:function(e){this._moved=false;if(e.shiftKey||e.which!==1&&e.button!==1&&!e.touches){return}C.DomEvent.stopPropagation(e);if(C.Draggable._disabled){return}C.DomUtil.disableImageDrag();C.DomUtil.disableTextSelection();if(this._moving){return}var t=e.touches?e.touches[0]:e;this._startPoint=new C.Point(t.clientX,t.clientY);this._startPos=this._newPos=C.DomUtil.getPosition(this._element);C.DomEvent.on(F,C.Draggable.MOVE[e.type],this._onMove,this).on(F,C.Draggable.END[e.type],this._onUp,this)},_onMove:function(e){if(e.touches&&e.touches.length>1){this._moved=true;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,r=new C.Point(t.clientX,t.clientY),i=r.subtract(this._startPoint);if(!i.x&&!i.y){return}if(C.Browser.touch&&Math.abs(i.x)+Math.abs(i.y)<3){return}C.DomEvent.preventDefault(e);if(!this._moved){this.fire("dragstart");this._moved=true;this._startPos=C.DomUtil.getPosition(this._element).subtract(i);C.DomUtil.addClass(F.body,"leaflet-dragging");this._lastTarget=e.target||e.srcElement;C.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")}this._newPos=this._startPos.add(i);this._moving=true;C.Util.cancelAnimFrame(this._animRequest);this._animRequest=C.Util.requestAnimFrame(this._updatePosition,this,true,this._dragStartTarget)},_updatePosition:function(){this.fire("predrag");C.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(){C.DomUtil.removeClass(F.body,"leaflet-dragging");if(this._lastTarget){C.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target");this._lastTarget=null}for(var e in C.Draggable.MOVE){C.DomEvent.off(F,C.Draggable.MOVE[e],this._onMove).off(F,C.Draggable.END[e],this._onUp)}C.DomUtil.enableImageDrag();C.DomUtil.enableTextSelection();if(this._moved&&this._moving){C.Util.cancelAnimFrame(this._animRequest);this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})}this._moving=false}});C.Handler=C.Class.extend({initialize:function(e){this._map=e},enable:function(){if(this._enabled){return}this._enabled=true;this.addHooks()},disable:function(){if(!this._enabled){return}this._enabled=false;this.removeHooks()},enabled:function(){return!!this._enabled}});C.Map.mergeOptions({dragging:true,inertia:!C.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:Infinity,inertiaThreshold:C.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:false});C.Map.Drag=C.Handler.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new C.Draggable(e._mapPane,e._container);this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);if(e.options.worldCopyJump){this._draggable.on("predrag",this._onPreDrag,this);e.on("viewreset",this._onViewReset,this);e.whenReady(this._onViewReset,this)}}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var e=this._map;if(e._panAnim){e._panAnim.stop()}e.fire("movestart").fire("dragstart");if(e.options.inertia){this._positions=[];this._times=[]}},_onDrag:function(){if(this._map.options.inertia){var e=this._lastTime=+new Date,t=this._lastPos=this._draggable._newPos;this._positions.push(t);this._times.push(e);if(e-this._times[0]>200){this._positions.shift();this._times.shift()}}this._map.fire("move").fire("drag")},_onViewReset:function(){var e=this._map.getSize()._divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x;this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var e=this._worldWidth,t=Math.round(e/2),r=this._initialWorldOffset,i=this._draggable._newPos.x,n=(i-t+r)%e+t-r,a=(i+t+r)%e-t-r,o=Math.abs(n+r)<Math.abs(a+r)?n:a;this._draggable._newPos.x=o},_onDragEnd:function(e){var t=this._map,r=t.options,i=+new Date-this._lastTime,n=!r.inertia||i>r.inertiaThreshold||!this._positions[0];t.fire("dragend",e);if(n){t.fire("moveend")}else{var a=this._lastPos.subtract(this._positions[0]),o=(this._lastTime+i-this._times[0])/1e3,s=r.easeLinearity,l=a.multiplyBy(s/o),u=l.distanceTo([0,0]),d=Math.min(r.inertiaMaxSpeed,u),c=l.multiplyBy(d/u),f=d/(r.inertiaDeceleration*s),h=c.multiplyBy(-f/2).round();if(!h.x||!h.y){t.fire("moveend")}else{h=t._limitOffset(h,t.options.maxBounds);C.Util.requestAnimFrame(function(){t.panBy(h,{duration:f,easeLinearity:s,noMoveStart:true})})}}}});C.Map.addInitHook("addHandler","dragging",C.Map.Drag);C.Map.mergeOptions({doubleClickZoom:true});C.Map.DoubleClickZoom=C.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,r=t.getZoom()+(e.originalEvent.shiftKey?-1:1);if(t.options.doubleClickZoom==="center"){t.setZoom(r)}else{t.setZoomAround(e.containerPoint,r)}}});C.Map.addInitHook("addHandler","doubleClickZoom",C.Map.DoubleClickZoom);C.Map.mergeOptions({scrollWheelZoom:true});C.Map.ScrollWheelZoom=C.Handler.extend({addHooks:function(){C.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this);C.DomEvent.on(this._map._container,"MozMousePixelScroll",C.DomEvent.preventDefault);this._delta=0},removeHooks:function(){C.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll);C.DomEvent.off(this._map._container,"MozMousePixelScroll",C.DomEvent.preventDefault)},_onWheelScroll:function(e){var t=C.DomEvent.getWheelDelta(e);this._delta+=t;this._lastMousePos=this._map.mouseEventToContainerPoint(e);if(!this._startTime){this._startTime=+new Date}var r=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer);this._timer=setTimeout(C.bind(this._performZoom,this),r);C.DomEvent.preventDefault(e);C.DomEvent.stopPropagation(e)},_performZoom:function(){var e=this._map,t=this._delta,r=e.getZoom();t=t>0?Math.ceil(t):Math.floor(t);t=Math.max(Math.min(t,4),-4);t=e._limitZoom(r+t)-r;this._delta=0;this._startTime=null;if(!t){return}if(e.options.scrollWheelZoom==="center"){e.setZoom(r+t)}else{e.setZoomAround(this._lastMousePos,r+t)}}});C.Map.addInitHook("addHandler","scrollWheelZoom",C.Map.ScrollWheelZoom);C.extend(C.DomEvent,{_touchstart:C.Browser.msPointer?"MSPointerDown":C.Browser.pointer?"pointerdown":"touchstart",_touchend:C.Browser.msPointer?"MSPointerUp":C.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(e,a,t){var o,s=false,n=250,l,r="_leaflet_",i=this._touchstart,u=this._touchend,d=[];function c(e){var t;if(C.Browser.pointer){d.push(e.pointerId);t=d.length}else{t=e.touches.length}if(t>1){return}var r=Date.now(),i=r-(o||r);l=e.touches?e.touches[0]:e;s=i>0&&i<=n;o=r}function f(e){if(C.Browser.pointer){var t=d.indexOf(e.pointerId);if(t===-1){return}d.splice(t,1)}if(s){if(C.Browser.pointer){var r={},i;for(var n in l){i=l[n];if(typeof i==="function"){r[n]=i.bind(l)}else{r[n]=i}}l=r}l.type="dblclick";a(l);o=null}}e[r+i+t]=c;e[r+u+t]=f;var h=C.Browser.pointer?F.documentElement:e;e.addEventListener(i,c,false);h.addEventListener(u,f,false);if(C.Browser.pointer){h.addEventListener(C.DomEvent.POINTER_CANCEL,f,false)}return this},removeDoubleTapListener:function(e,t){var r="_leaflet_";e.removeEventListener(this._touchstart,e[r+this._touchstart+t],false);(C.Browser.pointer?F.documentElement:e).removeEventListener(this._touchend,e[r+this._touchend+t],false);if(C.Browser.pointer){F.documentElement.removeEventListener(C.DomEvent.POINTER_CANCEL,e[r+this._touchend+t],false)}return this}});C.extend(C.DomEvent,{POINTER_DOWN:C.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:C.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:C.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:C.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:false,addPointerListener:function(e,t,r,i){switch(t){case"touchstart":return this.addPointerListenerStart(e,t,r,i);case"touchend":return this.addPointerListenerEnd(e,t,r,i);case"touchmove":return this.addPointerListenerMove(e,t,r,i);default:throw"Unknown touch event type"}},addPointerListenerStart:function(e,t,i,r){var n="_leaflet_",a=this._pointers;var o=function(e){if(e.pointerType!=="mouse"&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){C.DomEvent.preventDefault(e)}var t=false;for(var r=0;r<a.length;r++){if(a[r].pointerId===e.pointerId){t=true;break}}if(!t){a.push(e)}e.touches=a.slice();e.changedTouches=[e];i(e)};e[n+"touchstart"+r]=o;e.addEventListener(this.POINTER_DOWN,o,false);if(!this._pointerDocumentListener){var s=function(e){for(var t=0;t<a.length;t++){if(a[t].pointerId===e.pointerId){a.splice(t,1);break}}};F.documentElement.addEventListener(this.POINTER_UP,s,false);F.documentElement.addEventListener(this.POINTER_CANCEL,s,false);this._pointerDocumentListener=true}return this},addPointerListenerMove:function(e,t,r,i){var n="_leaflet_",a=this._pointers;function o(e){if((e.pointerType===e.MSPOINTER_TYPE_MOUSE||e.pointerType==="mouse")&&e.buttons===0){return}for(var t=0;t<a.length;t++){if(a[t].pointerId===e.pointerId){a[t]=e;break}}e.touches=a.slice();e.changedTouches=[e];r(e)}e[n+"touchmove"+i]=o;e.addEventListener(this.POINTER_MOVE,o,false);return this},addPointerListenerEnd:function(e,t,r,i){var n="_leaflet_",a=this._pointers;var o=function(e){for(var t=0;t<a.length;t++){if(a[t].pointerId===e.pointerId){a.splice(t,1);break}}e.touches=a.slice();e.changedTouches=[e];r(e)};e[n+"touchend"+i]=o;e.addEventListener(this.POINTER_UP,o,false);e.addEventListener(this.POINTER_CANCEL,o,false);return this},removePointerListener:function(e,t,r){var i="_leaflet_",n=e[i+t+r];switch(t){case"touchstart":e.removeEventListener(this.POINTER_DOWN,n,false);break;case"touchmove":e.removeEventListener(this.POINTER_MOVE,n,false);break;case"touchend":e.removeEventListener(this.POINTER_UP,n,false);e.removeEventListener(this.POINTER_CANCEL,n,false);break}return this}});C.Map.mergeOptions({touchZoom:C.Browser.touch&&!C.Browser.android23,bounceAtZoomLimits:true});C.Map.TouchZoom=C.Handler.extend({addHooks:function(){C.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){C.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming){return}var r=t.mouseEventToLayerPoint(e.touches[0]),i=t.mouseEventToLayerPoint(e.touches[1]),n=t._getCenterLayerPoint();this._startCenter=r.add(i)._divideBy(2);this._startDist=r.distanceTo(i);this._moved=false;this._zooming=true;this._centerOffset=n.subtract(this._startCenter);if(t._panAnim){t._panAnim.stop()}C.DomEvent.on(F,"touchmove",this._onTouchMove,this).on(F,"touchend",this._onTouchEnd,this);C.DomEvent.preventDefault(e)},_onTouchMove:function(e){var t=this._map;if(!e.touches||e.touches.length!==2||!this._zooming){return}var r=t.mouseEventToLayerPoint(e.touches[0]),i=t.mouseEventToLayerPoint(e.touches[1]);this._scale=r.distanceTo(i)/this._startDist;this._delta=r._add(i)._divideBy(2)._subtract(this._startCenter);if(this._scale===1){return}if(!t.options.bounceAtZoomLimits){if(t.getZoom()===t.getMinZoom()&&this._scale<1||t.getZoom()===t.getMaxZoom()&&this._scale>1){return}}if(!this._moved){C.DomUtil.addClass(t._mapPane,"leaflet-touching");t.fire("movestart").fire("zoomstart");this._moved=true}C.Util.cancelAnimFrame(this._animRequest);this._animRequest=C.Util.requestAnimFrame(this._updateOnMove,this,true,this._map._container);C.DomEvent.preventDefault(e)},_updateOnMove:function(){var e=this._map,t=this._getScaleOrigin(),r=e.layerPointToLatLng(t),i=e.getScaleZoom(this._scale);e._animateZoom(r,i,this._startCenter,this._scale,this._delta,false,true)},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=false;return}var e=this._map;this._zooming=false;C.DomUtil.removeClass(e._mapPane,"leaflet-touching");C.Util.cancelAnimFrame(this._animRequest);C.DomEvent.off(F,"touchmove",this._onTouchMove).off(F,"touchend",this._onTouchEnd);var t=this._getScaleOrigin(),r=e.layerPointToLatLng(t),i=e.getZoom(),n=e.getScaleZoom(this._scale)-i,a=n>0?Math.ceil(n):Math.floor(n),o=e._limitZoom(i+a),s=e.getZoomScale(o)/this._scale;e._animateZoom(r,o,t,s)},_getScaleOrigin:function(){var e=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(e)}});C.Map.addInitHook("addHandler","touchZoom",C.Map.TouchZoom);C.Map.mergeOptions({tap:true,tapTolerance:15});C.Map.Tap=C.Handler.extend({addHooks:function(){C.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){C.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(!e.touches){return}C.DomEvent.preventDefault(e);this._fireClick=true;if(e.touches.length>1){this._fireClick=false;clearTimeout(this._holdTimeout);return}var t=e.touches[0],r=t.target;this._startPos=this._newPos=new C.Point(t.clientX,t.clientY);if(r.tagName&&r.tagName.toLowerCase()==="a"){C.DomUtil.addClass(r,"leaflet-active")}this._holdTimeout=setTimeout(C.bind(function(){if(this._isTapValid()){this._fireClick=false;this._onUp();this._simulateEvent("contextmenu",t)}},this),1e3);C.DomEvent.on(F,"touchmove",this._onMove,this).on(F,"touchend",this._onUp,this)},_onUp:function(e){clearTimeout(this._holdTimeout);C.DomEvent.off(F,"touchmove",this._onMove,this).off(F,"touchend",this._onUp,this);if(this._fireClick&&e&&e.changedTouches){var t=e.changedTouches[0],r=t.target;if(r&&r.tagName&&r.tagName.toLowerCase()==="a"){C.DomUtil.removeClass(r,"leaflet-active")}if(this._isTapValid()){this._simulateEvent("click",t)}}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var t=e.touches[0];this._newPos=new C.Point(t.clientX,t.clientY)},_simulateEvent:function(e,t){var r=F.createEvent("MouseEvents");r._simulated=true;t.target._simulatedClick=true;r.initMouseEvent(e,true,true,w,1,t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,0,null);t.target.dispatchEvent(r)}});if(C.Browser.touch&&!C.Browser.pointer){C.Map.addInitHook("addHandler","tap",C.Map.Tap)}C.Map.mergeOptions({boxZoom:true});C.Map.BoxZoom=C.Handler.extend({initialize:function(e){this._map=e;this._container=e._container;this._pane=e._panes.overlayPane;this._moved=false},addHooks:function(){C.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){C.DomEvent.off(this._container,"mousedown",this._onMouseDown);this._moved=false},moved:function(){return this._moved},_onMouseDown:function(e){this._moved=false;if(!e.shiftKey||e.which!==1&&e.button!==1){return false}C.DomUtil.disableTextSelection();C.DomUtil.disableImageDrag();this._startLayerPoint=this._map.mouseEventToLayerPoint(e);C.DomEvent.on(F,"mousemove",this._onMouseMove,this).on(F,"mouseup",this._onMouseUp,this).on(F,"keydown",this._onKeyDown,this)},_onMouseMove:function(e){if(!this._moved){this._box=C.DomUtil.create("div","leaflet-zoom-box",this._pane);C.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";this._map.fire("boxzoomstart")}var t=this._startLayerPoint,r=this._box,i=this._map.mouseEventToLayerPoint(e),n=i.subtract(t),a=new C.Point(Math.min(i.x,t.x),Math.min(i.y,t.y));C.DomUtil.setPosition(r,a);this._moved=true;r.style.width=Math.max(0,Math.abs(n.x)-4)+"px";r.style.height=Math.max(0,Math.abs(n.y)-4)+"px"},_finish:function(){if(this._moved){this._pane.removeChild(this._box);this._container.style.cursor=""}C.DomUtil.enableTextSelection();C.DomUtil.enableImageDrag();C.DomEvent.off(F,"mousemove",this._onMouseMove).off(F,"mouseup",this._onMouseUp).off(F,"keydown",this._onKeyDown)},_onMouseUp:function(e){this._finish();var t=this._map,r=t.mouseEventToLayerPoint(e);if(this._startLayerPoint.equals(r)){return}var i=new C.LatLngBounds(t.layerPointToLatLng(this._startLayerPoint),t.layerPointToLatLng(r));t.fitBounds(i);t.fire("boxzoomend",{boxZoomBounds:i})},_onKeyDown:function(e){if(e.keyCode===27){this._finish()}}});C.Map.addInitHook("addHandler","boxZoom",C.Map.BoxZoom);C.Map.mergeOptions({keyboard:true,keyboardPanOffset:80,keyboardZoomOffset:1});C.Map.Keyboard=C.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(e){this._map=e;this._setPanOffset(e.options.keyboardPanOffset);this._setZoomOffset(e.options.keyboardZoomOffset)},addHooks:function(){var e=this._map._container;if(e.tabIndex===-1){e.tabIndex="0"}C.DomEvent.on(e,"focus",this._onFocus,this).on(e,"blur",this._onBlur,this).on(e,"mousedown",this._onMouseDown,this);this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var e=this._map._container;C.DomEvent.off(e,"focus",this._onFocus,this).off(e,"blur",this._onBlur,this).off(e,"mousedown",this._onMouseDown,this);this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(this._focused){return}var e=F.body,t=F.documentElement,r=e.scrollTop||t.scrollTop,i=e.scrollLeft||t.scrollLeft;this._map._container.focus();w.scrollTo(i,r)},_onFocus:function(){this._focused=true;this._map.fire("focus")},_onBlur:function(){this._focused=false;this._map.fire("blur")},_setPanOffset:function(e){var t=this._panKeys={},r=this.keyCodes,i,n;for(i=0,n=r.left.length;i<n;i++){t[r.left[i]]=[-1*e,0]}for(i=0,n=r.right.length;i<n;i++){t[r.right[i]]=[e,0]}for(i=0,n=r.down.length;i<n;i++){t[r.down[i]]=[0,e]}for(i=0,n=r.up.length;i<n;i++){t[r.up[i]]=[0,-1*e]}},_setZoomOffset:function(e){var t=this._zoomKeys={},r=this.keyCodes,i,n;for(i=0,n=r.zoomIn.length;i<n;i++){t[r.zoomIn[i]]=e}for(i=0,n=r.zoomOut.length;i<n;i++){t[r.zoomOut[i]]=-e}},_addHooks:function(){C.DomEvent.on(F,"keydown",this._onKeyDown,this)},_removeHooks:function(){C.DomEvent.off(F,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){var t=e.keyCode,r=this._map;if(t in this._panKeys){if(r._panAnim&&r._panAnim._inProgress){return}r.panBy(this._panKeys[t]);if(r.options.maxBounds){r.panInsideBounds(r.options.maxBounds)}}else if(t in this._zoomKeys){r.setZoom(r.getZoom()+this._zoomKeys[t])}else{return}C.DomEvent.stop(e)}});C.Map.addInitHook("addHandler","keyboard",C.Map.Keyboard);C.Handler.MarkerDrag=C.Handler.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;if(!this._draggable){this._draggable=new C.Draggable(e,e)}this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this);this._draggable.enable();C.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this);this._draggable.disable();C.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var e=this._marker,t=e._shadow,r=C.DomUtil.getPosition(e._icon),i=e._map.layerPointToLatLng(r);if(t){C.DomUtil.setPosition(t,r)}e._latlng=i;e.fire("move",{latlng:i}).fire("drag")},_onDragEnd:function(e){this._marker.fire("moveend").fire("dragend",e)}});C.Control=C.Class.extend({options:{position:"topright"},initialize:function(e){C.setOptions(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;if(t){t.removeControl(this)}this.options.position=e;if(t){t.addControl(this)}return this},getContainer:function(){return this._container},addTo:function(e){this._map=e;var t=this._container=this.onAdd(e),r=this.getPosition(),i=e._controlCorners[r];C.DomUtil.addClass(t,"leaflet-control");if(r.indexOf("bottom")!==-1){i.insertBefore(t,i.firstChild)}else{i.appendChild(t)}return this},removeFrom:function(e){var t=this.getPosition(),r=e._controlCorners[t];r.removeChild(this._container);this._map=null;if(this.onRemove){this.onRemove(e)}return this},_refocusOnMap:function(){if(this._map){this._map.getContainer().focus()}}});C.control=function(e){return new C.Control(e)};C.Map.include({addControl:function(e){e.addTo(this);return this},removeControl:function(e){e.removeFrom(this);return this},_initControlPos:function(){var i=this._controlCorners={},n="leaflet-",a=this._controlContainer=C.DomUtil.create("div",n+"control-container",this._container);function e(e,t){var r=n+e+" "+n+t;i[e+t]=C.DomUtil.create("div",r,a)}e("top","left");e("top","right");e("bottom","left");e("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}});C.Control.Zoom=C.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",r=C.DomUtil.create("div",t+" leaflet-bar");this._map=e;this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,t+"-in",r,this._zoomIn,this);this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,t+"-out",r,this._zoomOut,this);this._updateDisabled();e.on("zoomend zoomlevelschange",this._updateDisabled,this);return r},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createButton:function(e,t,r,i,n,a){var o=C.DomUtil.create("a",r,i);o.innerHTML=e;o.href="#";o.title=t;var s=C.DomEvent.stopPropagation;C.DomEvent.on(o,"click",s).on(o,"mousedown",s).on(o,"dblclick",s).on(o,"click",C.DomEvent.preventDefault).on(o,"click",n,a).on(o,"click",this._refocusOnMap,a);return o},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";C.DomUtil.removeClass(this._zoomInButton,t);C.DomUtil.removeClass(this._zoomOutButton,t);if(e._zoom===e.getMinZoom()){C.DomUtil.addClass(this._zoomOutButton,t)}if(e._zoom===e.getMaxZoom()){C.DomUtil.addClass(this._zoomInButton,t)}}});C.Map.mergeOptions({zoomControl:true});C.Map.addInitHook(function(){if(this.options.zoomControl){this.zoomControl=new C.Control.Zoom;this.addControl(this.zoomControl)}});C.control.zoom=function(e){return new C.Control.Zoom(e)};C.Control.Attribution=C.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(e){C.setOptions(this,e);this._attributions={}},onAdd:function(e){this._container=C.DomUtil.create("div","leaflet-control-attribution");C.DomEvent.disableClickPropagation(this._container);for(var t in e._layers){if(e._layers[t].getAttribution){this.addAttribution(e._layers[t].getAttribution())}}e.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this);this._update();return this._container},onRemove:function(e){e.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(e){this.options.prefix=e;this._update();return this},addAttribution:function(e){if(!e){return}if(!this._attributions[e]){this._attributions[e]=0}this._attributions[e]++;this._update();return this},removeAttribution:function(e){if(!e){return}if(this._attributions[e]){this._attributions[e]--;this._update()}return this},_update:function(){if(!this._map){return}var e=[];for(var t in this._attributions){if(this._attributions[t]){e.push(t)}}var r=[];if(this.options.prefix){r.push(this.options.prefix)}if(e.length){r.push(e.join(", "))}this._container.innerHTML=r.join(" | ")},_onLayerAdd:function(e){if(e.layer.getAttribution){this.addAttribution(e.layer.getAttribution())}},_onLayerRemove:function(e){if(e.layer.getAttribution){this.removeAttribution(e.layer.getAttribution())}}});C.Map.mergeOptions({attributionControl:true});C.Map.addInitHook(function(){if(this.options.attributionControl){this.attributionControl=(new C.Control.Attribution).addTo(this)}});C.control.attribution=function(e){return new C.Control.Attribution(e)};C.Control.Scale=C.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:true,imperial:true,updateWhenIdle:false},onAdd:function(e){this._map=e;var t="leaflet-control-scale",r=C.DomUtil.create("div",t),i=this.options;this._addScales(i,t,r);e.on(i.updateWhenIdle?"moveend":"move",this._update,this);e.whenReady(this._update,this);return r},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,r){if(e.metric){this._mScale=C.DomUtil.create("div",t+"-line",r)}if(e.imperial){this._iScale=C.DomUtil.create("div",t+"-line",r)}},_update:function(){var e=this._map.getBounds(),t=e.getCenter().lat,r=6378137*Math.PI*Math.cos(t*Math.PI/180),i=r*(e.getNorthEast().lng-e.getSouthWest().lng)/180,n=this._map.getSize(),a=this.options,o=0;if(n.x>0){o=i*(a.maxWidth/n.x)}this._updateScales(a,o)},_updateScales:function(e,t){if(e.metric&&t){this._updateMetric(t)}if(e.imperial&&t){this._updateImperial(t)}},_updateMetric:function(e){var t=this._getRoundNum(e);this._mScale.style.width=this._getScaleWidth(t/e)+"px";this._mScale.innerHTML=t<1e3?t+" m":t/1e3+" km"},_updateImperial:function(e){var t=e*3.2808399,r=this._iScale,i,n,a;if(t>5280){i=t/5280;n=this._getRoundNum(i);r.style.width=this._getScaleWidth(n/i)+"px";r.innerHTML=n+" mi"}else{a=this._getRoundNum(t);r.style.width=this._getScaleWidth(a/t)+"px";r.innerHTML=a+" ft"}},_getScaleWidth:function(e){return Math.round(this.options.maxWidth*e)-10},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),r=e/t;r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:1;return t*r}});C.control.scale=function(e){return new C.Control.Scale(e)};C.Control.Layers=C.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true},initialize:function(e,t,r){C.setOptions(this,r);this._layers={};this._lastZIndex=0;this._handlingClick=false;for(var i in e){this._addLayer(e[i],i)}for(i in t){this._addLayer(t[i],i,true)}},onAdd:function(e){this._initLayout();this._update();e.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(e){e.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(e,t){this._addLayer(e,t);this._update();return this},addOverlay:function(e,t){this._addLayer(e,t,true);this._update();return this},removeLayer:function(e){var t=C.stamp(e);delete this._layers[t];this._update();return this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=C.DomUtil.create("div",e);t.setAttribute("aria-haspopup",true);if(!C.Browser.touch){C.DomEvent.disableClickPropagation(t).disableScrollPropagation(t)}else{C.DomEvent.on(t,"click",C.DomEvent.stopPropagation)}var r=this._form=C.DomUtil.create("form",e+"-list");if(this.options.collapsed){if(!C.Browser.android){C.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this)}var i=this._layersLink=C.DomUtil.create("a",e+"-toggle",t);i.href="#";i.title="Layers";if(C.Browser.touch){C.DomEvent.on(i,"click",C.DomEvent.stop).on(i,"click",this._expand,this)}else{C.DomEvent.on(i,"focus",this._expand,this)}C.DomEvent.on(r,"click",function(){setTimeout(C.bind(this._onInputClick,this),0)},this);this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=C.DomUtil.create("div",e+"-base",r);this._separator=C.DomUtil.create("div",e+"-separator",r);this._overlaysList=C.DomUtil.create("div",e+"-overlays",r);t.appendChild(r)},_addLayer:function(e,t,r){var i=C.stamp(e);this._layers[i]={layer:e,name:t,overlay:r};if(this.options.autoZIndex&&e.setZIndex){this._lastZIndex++;e.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return}this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var e=false,t=false,r,i;for(r in this._layers){i=this._layers[r];this._addItem(i);t=t||i.overlay;e=e||!i.overlay}this._separator.style.display=t&&e?"":"none"},_onLayerChange:function(e){var t=this._layers[C.stamp(e.layer)];if(!t){return}if(!this._handlingClick){this._update()}var r=t.overlay?e.type==="layeradd"?"overlayadd":"overlayremove":e.type==="layeradd"?"baselayerchange":null;if(r){this._map.fire(r,t)}},_createRadioElement:function(e,t){var r='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"';if(t){r+=' checked="checked"'}r+="/>";var i=F.createElement("div");i.innerHTML=r;return i.firstChild},_addItem:function(e){var t=F.createElement("label"),r,i=this._map.hasLayer(e.layer);if(e.overlay){r=F.createElement("input");r.type="checkbox";r.className="leaflet-control-layers-selector";r.defaultChecked=i}else{r=this._createRadioElement("leaflet-base-layers",i)}r.layerId=C.stamp(e.layer);C.DomEvent.on(r,"click",this._onInputClick,this);var n=F.createElement("span");n.innerHTML=" "+e.name;t.appendChild(r);t.appendChild(n);var a=e.overlay?this._overlaysList:this._baseLayersList;a.appendChild(t);return t},_onInputClick:function(){var e,t,r,i=this._form.getElementsByTagName("input"),n=i.length;this._handlingClick=true;for(e=0;e<n;e++){t=i[e];r=this._layers[t.layerId];if(t.checked&&!this._map.hasLayer(r.layer)){this._map.addLayer(r.layer)}else if(!t.checked&&this._map.hasLayer(r.layer)){this._map.removeLayer(r.layer)}}this._handlingClick=false;this._refocusOnMap()},_expand:function(){C.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});C.control.layers=function(e,t,r){return new C.Control.Layers(e,t,r)};C.PosAnimation=C.Class.extend({includes:C.Mixin.Events,run:function(e,t,r,i){this.stop();this._el=e;this._inProgress=true;this._newPos=t;this.fire("start");e.style[C.DomUtil.TRANSITION]="all "+(r||.25)+"s cubic-bezier(0,0,"+(i||.5)+",1)";C.DomEvent.on(e,C.DomUtil.TRANSITION_END,this._onTransitionEnd,this);C.DomUtil.setPosition(e,t);C.Util.falseFn(e.offsetWidth);this._stepTimer=setInterval(C.bind(this._onStep,this),50)},stop:function(){if(!this._inProgress){return}C.DomUtil.setPosition(this._el,this._getPos());this._onTransitionEnd();C.Util.falseFn(this._el.offsetWidth)},_onStep:function(){var e=this._getPos();if(!e){this._onTransitionEnd();return}this._el._leaflet_pos=e;this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,t,r,i=this._el,n=w.getComputedStyle(i);if(C.Browser.any3d){r=n[C.DomUtil.TRANSFORM].match(this._transformRe);if(!r){return}e=parseFloat(r[1]);t=parseFloat(r[2])}else{e=parseFloat(n.left);t=parseFloat(n.top)}return new C.Point(e,t,true)},_onTransitionEnd:function(){C.DomEvent.off(this._el,C.DomUtil.TRANSITION_END,this._onTransitionEnd,this);if(!this._inProgress){return}this._inProgress=false;this._el.style[C.DomUtil.TRANSITION]="";this._el._leaflet_pos=this._newPos;clearInterval(this._stepTimer);this.fire("step").fire("end")}});C.Map.include({setView:function(e,t,r){t=t===b?this._zoom:this._limitZoom(t);e=this._limitCenter(C.latLng(e),t,this.options.maxBounds);r=r||{};if(this._panAnim){this._panAnim.stop()}if(this._loaded&&!r.reset&&r!==true){if(r.animate!==b){r.zoom=C.extend({animate:r.animate},r.zoom);r.pan=C.extend({animate:r.animate},r.pan)}var i=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan);if(i){clearTimeout(this._sizeTimer);return this}}this._resetView(e,t);return this},panBy:function(e,t){e=C.point(e).round();t=t||{};if(!e.x&&!e.y){return this}if(!this._panAnim){this._panAnim=new C.PosAnimation;this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)}if(!t.noMoveStart){this.fire("movestart")}if(t.animate!==false){C.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var r=this._getMapPanePos().subtract(e);this._panAnim.run(this._mapPane,r,t.duration||.25,t.easeLinearity)}else{this._rawPanBy(e);this.fire("move").fire("moveend")}return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){C.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim");this.fire("moveend")},_tryAnimatedPan:function(e,t){var r=this._getCenterOffset(e)._floor();if((t&&t.animate)!==true&&!this.getSize().contains(r)){return false}this.panBy(r,t);return true}});C.PosAnimation=C.DomUtil.TRANSITION?C.PosAnimation:C.PosAnimation.extend({run:function(e,t,r,i){this.stop();this._el=e;this._inProgress=true;this._duration=r||.25;this._easeOutPower=1/Math.max(i||.5,.2);this._startPos=C.DomUtil.getPosition(e);this._offset=t.subtract(this._startPos);this._startTime=+new Date;this.fire("start");this._animate()},stop:function(){if(!this._inProgress){return}this._step();this._complete()},_animate:function(){this._animId=C.Util.requestAnimFrame(this._animate,this);this._step()},_step:function(){var e=+new Date-this._startTime,t=this._duration*1e3;if(e<t){this._runFrame(this._easeOut(e/t))}else{this._runFrame(1);this._complete()}},_runFrame:function(e){var t=this._startPos.add(this._offset.multiplyBy(e));C.DomUtil.setPosition(this._el,t);this.fire("step")},_complete:function(){C.Util.cancelAnimFrame(this._animId);this._inProgress=false;this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}});C.Map.mergeOptions({zoomAnimation:true,zoomAnimationThreshold:4});if(C.DomUtil.TRANSITION){C.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&C.DomUtil.TRANSITION&&C.Browser.any3d&&!C.Browser.android23&&!C.Browser.mobileOpera;if(this._zoomAnimated){C.DomEvent.on(this._mapPane,C.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}})}C.Map.include(!C.DomUtil.TRANSITION?{}:{_catchTransitionEnd:function(e){if(this._animatingZoom&&e.propertyName.indexOf("transform")>=0){this._onZoomTransitionEnd()}},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,r){if(this._animatingZoom){return true}r=r||{};if(!this._zoomAnimated||r.animate===false||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold){return false}var i=this.getZoomScale(t),n=this._getCenterOffset(e)._divideBy(1-1/i),a=this._getCenterLayerPoint()._add(n);if(r.animate!==true&&!this.getSize().contains(n)){return false}this.fire("movestart").fire("zoomstart");this._animateZoom(e,t,a,i,null,true);return true},_animateZoom:function(e,t,r,i,n,a,o){if(!o){this._animatingZoom=true}C.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim");this._animateToCenter=e;this._animateToZoom=t;if(C.Draggable){C.Draggable._disabled=true}C.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:e,zoom:t,origin:r,scale:i,delta:n,backwards:a});setTimeout(C.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){if(!this._animatingZoom){return}this._animatingZoom=false;C.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim");C.Util.requestAnimFrame(function(){this._resetView(this._animateToCenter,this._animateToZoom,true,true);if(C.Draggable){C.Draggable._disabled=false}},this)}});C.TileLayer.include({_animateZoom:function(e){if(!this._animating){this._animating=true;this._prepareBgBuffer()}var t=this._bgBuffer,r=C.DomUtil.TRANSFORM,i=e.delta?C.DomUtil.getTranslateString(e.delta):t.style[r],n=C.DomUtil.getScaleString(e.scale,e.origin);t.style[r]=e.backwards?n+" "+i:i+" "+n},_endZoomAnim:function(){var e=this._tileContainer,t=this._bgBuffer;e.style.visibility="";e.parentNode.appendChild(e);C.Util.falseFn(t.offsetWidth);var r=this._map.getZoom();if(r>this.options.maxZoom||r<this.options.minZoom){this._clearBgBuffer()}this._animating=false},_clearBgBuffer:function(){var e=this._map;if(e&&!e._animatingZoom&&!e.touchZoom._zooming){this._bgBuffer.innerHTML="";this._bgBuffer.style[C.DomUtil.TRANSFORM]=""}},_prepareBgBuffer:function(){var e=this._tileContainer,t=this._bgBuffer;var r=this._getLoadedTilesPercentage(t),i=this._getLoadedTilesPercentage(e);if(t&&r>.5&&i<.5){e.style.visibility="hidden";this._stopLoadingImages(e);return}t.style.visibility="hidden";t.style[C.DomUtil.TRANSFORM]="";this._tileContainer=t;t=this._bgBuffer=e;this._stopLoadingImages(t);clearTimeout(this._clearBgBufferTimer)},_getLoadedTilesPercentage:function(e){var t=e.getElementsByTagName("img"),r,i,n=0;for(r=0,i=t.length;r<i;r++){if(t[r].complete){n++}}return n/i},_stopLoadingImages:function(e){var t=Array.prototype.slice.call(e.getElementsByTagName("img")),r,i,n;for(r=0,i=t.length;r<i;r++){n=t[r];if(!n.complete){n.onload=C.Util.falseFn;n.onerror=C.Util.falseFn;n.src=C.Util.emptyImageUrl;n.parentNode.removeChild(n)}}}});C.Map.include({_defaultLocateOptions:{watch:false,setView:false,maxZoom:Infinity,timeout:1e4,maximumAge:0,enableHighAccuracy:false},locate:function(e){e=this._locateOptions=C.extend(this._defaultLocateOptions,e);if(!navigator.geolocation){this._handleGeolocationError({code:0,message:"Geolocation not supported."});return this}var t=C.bind(this._handleGeolocationResponse,this),r=C.bind(this._handleGeolocationError,this);if(e.watch){this._locationWatchId=navigator.geolocation.watchPosition(t,r,e)}else{navigator.geolocation.getCurrentPosition(t,r,e)}return this},stopLocate:function(){if(navigator.geolocation){navigator.geolocation.clearWatch(this._locationWatchId)}if(this._locateOptions){this._locateOptions.setView=false}return this},_handleGeolocationError:function(e){var t=e.code,r=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");if(this._locateOptions.setView&&!this._loaded){this.fitWorld()}this.fire("locationerror",{code:t,message:"Geolocation error: "+r+"."})},_handleGeolocationResponse:function(e){var t=e.coords.latitude,r=e.coords.longitude,i=new C.LatLng(t,r),n=180*e.coords.accuracy/40075017,a=n/Math.cos(C.LatLng.DEG_TO_RAD*t),o=C.latLngBounds([t-n,r-a],[t+n,r+a]),s=this._locateOptions;if(s.setView){var l=Math.min(this.getBoundsZoom(o),s.maxZoom);this.setView(i,l)}var u={latlng:i,bounds:o,timestamp:e.timestamp};for(var d in e.coords){if(typeof e.coords[d]==="number"){u[d]=e.coords[d]}}this.fire("locationfound",u)}})})(window,document)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NavigationViewModel=undefined;var i=r(261);var c=r(670);var x=r(675);var n=r(676);var P=s(n);var a=r(677);var M=s(a);var o=r(678);var T=s(o);var E=r(263);function s(e){return e&&e.__esModule?e:{default:e}}var l=t.NavigationViewModel=function(h,p,f,a,s,v,m,_,y,u,d,o){"use strict";var r=function e(t){this.terria=t.terria;this.eventHelper=new a;this.enableZoomControls=h(t.enableZoomControls)?t.enableZoomControls:true;this.enableCompass=h(t.enableCompass)?t.enableCompass:true;this.controls=t.controls;if(!h(this.controls)){this.controls=[new x.ZoomNavigationControl(this.terria,true),new c.ResetViewNavigationControl(this.terria),new x.ZoomNavigationControl(this.terria,false)]}this.svgCompassOuterRing=P.default;this.svgCompassGyro=M.default;this.svgCompassRotationMarker=T.default;this.showCompass=h(this.terria)&&this.enableCompass;this.heading=this.showCompass?this.terria.scene.camera.heading:0;this.isOrbiting=false;this.orbitCursorAngle=0;this.orbitCursorOpacity=0;this.orbitLastTimestamp=0;this.orbitFrame=undefined;this.orbitIsLook=false;this.orbitMouseMoveFunction=undefined;this.orbitMouseUpFunction=undefined;this.orbitTouchMoveFunction=undefined;this.orbitTouchEndFunction=undefined;this.isRotating=false;this.rotateInitialCursorAngle=undefined;this.rotateFrame=undefined;this.rotateIsLook=false;this.rotateMouseMoveFunction=undefined;this.rotateMouseUpFunction=undefined;this.rotateTouchMoveFunction=undefined;this.rotateTouchEndFunction=undefined;this._unsubcribeFromPostRender=undefined;o.track(this,["controls","showCompass","heading","isOrbiting","orbitCursorAngle","isRotating"]);var r=this;function i(){var e=navigator.userAgent.toLowerCase();var t=e.match(/ipad/i)=="ipad";var r=e.match(/iphone os/i)=="iphone os";var i=e.match(/midp/i)=="midp";var n=e.match(/rv:1.2.3.4/i)=="rv:1.2.3.4";var a=e.match(/ucweb/i)=="ucweb";var o=e.match(/android/i)=="android";var s=e.match(/windows ce/i)=="windows ce";var l=e.match(/windows mobile/i)=="windows mobile";if(!(t||r||i||n||a||o||s||l)){return"PC"}else{return"Phone"}}this.mode=i();function n(){if(h(r.terria)){if(r._unsubcribeFromPostRender){r._unsubcribeFromPostRender();r._unsubcribeFromPostRender=undefined}r.showCompass=true&&r.enableCompass;r._unsubcribeFromPostRender=r.terria.scene.postRender.addEventListener(function(){r.heading=r.terria.scene.camera.heading})}else{if(r._unsubcribeFromPostRender){r._unsubcribeFromPostRender();r._unsubcribeFromPostRender=undefined}r.showCompass=false}}this.eventHelper.add(this.terria.afterWidgetChanged,n,this);n()};r.prototype.destroy=function(){this.eventHelper.removeAll()};r.prototype.show=function(e){var t;if(this.enableZoomControls&&this.enableCompass){t='<div class="compass" title="拖动外圈：旋转视图。'+"拖内陀螺：转动视角。"+"双击：重置视图。"+'提示：您也可以通过按住CTRL键并拖动地图来转动视角。" data-bind="visible: showCompass, event: { touchstart: handleTouchStart, mousedown: handleMouseDown, dblclick: handleDoubleClick }">'+'<div class="compass-outer-ring-background"></div>'+" <div class=\"compass-rotation-marker\" data-bind=\"visible: isOrbiting, style: { transform: 'rotate(-' + orbitCursorAngle + 'rad)', '-webkit-transform': 'rotate(-' + orbitCursorAngle + 'rad)', opacity: orbitCursorOpacity }, cesiumSvgPath: { path: svgCompassRotationMarker, width: 145, height: 145 }\"></div>"+" <div class=\"compass-outer-ring\" title=\"单击并拖动以旋转相机\" data-bind=\"style: { transform: 'rotate(-' + heading + 'rad)', '-webkit-transform': 'rotate(-' + heading + 'rad)' }, cesiumSvgPath: { path: svgCompassOuterRing, width: 145, height: 145 }\"></div>"+' <div class="compass-gyro-background"></div>'+' <div class="compass-gyro" data-bind="cesiumSvgPath: { path: svgCompassGyro, width: 145, height: 145 }, css: { \'compass-gyro-active\': isOrbiting }"></div>'+"</div>"+'<div class="navigation-controls">'+"\x3c!-- ko foreach: controls --\x3e"+"<div data-bind=\"click: activate, attr: { title: $data.name }, css: $root.isLastControl($data) ? 'navigation-control-last' : 'navigation-control' \">"+"   \x3c!-- ko if: $data.hasText --\x3e"+"   <div data-bind=\"text: $data.text, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"   \x3c!-- /ko --\x3e"+"  \x3c!-- ko ifnot: $data.hasText --\x3e"+"  <div data-bind=\"cesiumSvgPath: { path: $data.svgIcon, width: $data.svgWidth, height: $data.svgHeight }, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"  \x3c!-- /ko --\x3e"+" </div>"+" \x3c!-- /ko --\x3e"+"</div>"}else if(!this.enableZoomControls&&this.enableCompass){t='<div class="compass" title="Drag outer ring: rotate view. '+"Drag inner gyroscope: free orbit."+"Double-click: reset view."+'TIP: You can also free orbit by holding the CTRL key and dragging the map." data-bind="visible: showCompass, event: { touchstart: handleTouchStart, mousedown: handleMouseDown, dblclick: handleDoubleClick }">'+'<div class="compass-outer-ring-background"></div>'+" <div class=\"compass-rotation-marker\" data-bind=\"visible: isOrbiting, style: { transform: 'rotate(-' + orbitCursorAngle + 'rad)', '-webkit-transform': 'rotate(-' + orbitCursorAngle + 'rad)', opacity: orbitCursorOpacity }, cesiumSvgPath: { path: svgCompassRotationMarker, width: 145, height: 145 }\"></div>"+" <div class=\"compass-outer-ring\" title=\"Click and drag to rotate the camera\" data-bind=\"style: { transform: 'rotate(-' + heading + 'rad)', '-webkit-transform': 'rotate(-' + heading + 'rad)' }, cesiumSvgPath: { path: svgCompassOuterRing, width: 145, height: 145 }\"></div>"+' <div class="compass-gyro-background"></div>'+' <div class="compass-gyro" data-bind="cesiumSvgPath: { path: svgCompassGyro, width: 145, height: 145 }, css: { \'compass-gyro-active\': isOrbiting }"></div>'+"</div>"+'<div class="navigation-controls"  style="display: none;" >'+"\x3c!-- ko foreach: controls --\x3e"+"<div data-bind=\"click: activate, attr: { title: $data.name }, css: $root.isLastControl($data) ? 'navigation-control-last' : 'navigation-control' \">"+"   \x3c!-- ko if: $data.hasText --\x3e"+"   <div data-bind=\"text: $data.text, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"   \x3c!-- /ko --\x3e"+"  \x3c!-- ko ifnot: $data.hasText --\x3e"+"  <div data-bind=\"cesiumSvgPath: { path: $data.svgIcon, width: $data.svgWidth, height: $data.svgHeight }, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"  \x3c!-- /ko --\x3e"+" </div>"+" \x3c!-- /ko --\x3e"+"</div>"}else if(this.enableZoomControls&&!this.enableCompass){t='<div class="compass"  style="display: none;" title="Drag outer ring: rotate view. '+"Drag inner gyroscope: free orbit."+"Double-click: reset view."+'TIP: You can also free orbit by holding the CTRL key and dragging the map." data-bind="visible: showCompass, event: { touchstart: handleTouchStart, mousedown: handleMouseDown, dblclick: handleDoubleClick }">'+'<div class="compass-outer-ring-background"></div>'+" <div class=\"compass-rotation-marker\" data-bind=\"visible: isOrbiting, style: { transform: 'rotate(-' + orbitCursorAngle + 'rad)', '-webkit-transform': 'rotate(-' + orbitCursorAngle + 'rad)', opacity: orbitCursorOpacity }, cesiumSvgPath: { path: svgCompassRotationMarker, width: 145, height: 145 }\"></div>"+" <div class=\"compass-outer-ring\" title=\"Click and drag to rotate the camera\" data-bind=\"style: { transform: 'rotate(-' + heading + 'rad)', '-webkit-transform': 'rotate(-' + heading + 'rad)' }, cesiumSvgPath: { path: svgCompassOuterRing, width: 145, height: 145 }\"></div>"+' <div class="compass-gyro-background"></div>'+' <div class="compass-gyro" data-bind="cesiumSvgPath: { path: svgCompassGyro, width: 145, height: 145 }, css: { \'compass-gyro-active\': isOrbiting }"></div>'+"</div>"+'<div class="navigation-controls"    >'+"\x3c!-- ko foreach: controls --\x3e"+"<div data-bind=\"click: activate, attr: { title: $data.name }, css: $root.isLastControl($data) ? 'navigation-control-last' : 'navigation-control' \">"+"   \x3c!-- ko if: $data.hasText --\x3e"+"   <div data-bind=\"text: $data.text, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"   \x3c!-- /ko --\x3e"+"  \x3c!-- ko ifnot: $data.hasText --\x3e"+"  <div data-bind=\"cesiumSvgPath: { path: $data.svgIcon, width: $data.svgWidth, height: $data.svgHeight }, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"  \x3c!-- /ko --\x3e"+" </div>"+" \x3c!-- /ko --\x3e"+"</div>"}else if(!this.enableZoomControls&&!this.enableCompass){t='<div class="compass"  style="display: none;" title="Drag outer ring: rotate view. '+"Drag inner gyroscope: free orbit."+"Double-click: reset view."+'TIP: You can also free orbit by holding the CTRL key and dragging the map." data-bind="visible: showCompass, event: { touchstart: handleTouchStart, mousedown: handleMouseDown, dblclick: handleDoubleClick }">'+'<div class="compass-outer-ring-background"></div>'+" <div class=\"compass-rotation-marker\" data-bind=\"visible: isOrbiting, style: { transform: 'rotate(-' + orbitCursorAngle + 'rad)', '-webkit-transform': 'rotate(-' + orbitCursorAngle + 'rad)', opacity: orbitCursorOpacity }, cesiumSvgPath: { path: svgCompassRotationMarker, width: 145, height: 145 }\"></div>"+" <div class=\"compass-outer-ring\" title=\"Click and drag to rotate the camera\" data-bind=\"style: { transform: 'rotate(-' + heading + 'rad)', '-webkit-transform': 'rotate(-' + heading + 'rad)' }, cesiumSvgPath: { path: svgCompassOuterRing, width: 145, height: 145 }\"></div>"+' <div class="compass-gyro-background"></div>'+' <div class="compass-gyro" data-bind="cesiumSvgPath: { path: svgCompassGyro, width: 145, height: 145 }, css: { \'compass-gyro-active\': isOrbiting }"></div>'+"</div>"+'<div class="navigation-controls"   style="display: none;" >'+"\x3c!-- ko foreach: controls --\x3e"+"<div data-bind=\"click: activate, attr: { title: $data.name }, css: $root.isLastControl($data) ? 'navigation-control-last' : 'navigation-control' \">"+"   \x3c!-- ko if: $data.hasText --\x3e"+"   <div data-bind=\"text: $data.text, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"   \x3c!-- /ko --\x3e"+"  \x3c!-- ko ifnot: $data.hasText --\x3e"+"  <div data-bind=\"cesiumSvgPath: { path: $data.svgIcon, width: $data.svgWidth, height: $data.svgHeight }, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>"+"  \x3c!-- /ko --\x3e"+" </div>"+" \x3c!-- /ko --\x3e"+"</div>"}(0,i.loadView)(t,e,this)};r.prototype.add=function(e){this.controls.push(e)};r.prototype.remove=function(e){this.controls.remove(e)};r.prototype.isLastControl=function(e){return e===this.controls[this.controls.length-1]};var g=new m;r.prototype.handleMouseDown=function(e,t){if(this.mode=="Phone")return;var r=this.terria.scene;if(r.mode===v.MORPHING){return true}var i=t.currentTarget;var n=t.currentTarget.getBoundingClientRect();var a=n.width/2;var o=new m((n.right-n.left)/2,(n.bottom-n.top)/2);var s=new m(t.clientX-n.left,t.clientY-n.top);var l=m.subtract(s,o,g);var u=m.magnitude(l);var d=u/a;var c=145;var f=50;if(d<f/c){b(this,i,l)}else if(d<1){C(this,i,l)}else{return true}};r.prototype.handleTouchStart=function(e,t){if(this.mode=="PC")return;var r=this.terria.scene;if(r.mode===v.MORPHING){return true}var i=t.currentTarget;var n=t.currentTarget.getBoundingClientRect();var a=n.width/2;var o=new m((n.right-n.left)/2,(n.bottom-n.top)/2);var s=new m(t.touches[0].clientX-n.left,t.touches[0].clientY-n.top);var l=m.subtract(s,o,g);var u=m.magnitude(l);var d=u/a;var c=145;var f=50;if(d<f/c){b(this,i,l)}else if(d<1){C(this,i,l)}else{return true}};var w=new y;var l=new y;var F=new _;r.prototype.handleDoubleClick=function(e,t){var r=e.terria.scene;var i=r.camera;var n=r.screenSpaceCameraController;if(r.mode==v.MORPHING||!n.enableInputs){return true}if(r.mode==v.COLUMBUS_VIEW&&!n.enableTranslate){return}if(r.mode==v.SCENE3D||r.mode==v.COLUMBUS_VIEW){if(!n.enableLook){return}if(r.mode==v.SCENE3D){if(!n.enableRotate){return}}}var a=E.Utils.getCameraFocus(e.terria,true,F);if(!h(a)){this.controls[1].resetView();return}var o=r.globe.ellipsoid.cartographicToCartesian(i.positionCartographic,new _);var s=r.globe.ellipsoid.geodeticSurfaceNormal(a);var l=new u(a,0);i.flyToBoundingSphere(l,{offset:new d(0,p.PI_OVER_TWO-_.angleBetween(s,i.directionWC),_.distance(o,a)),duration:1.5})};r.create=function(e){var t=new r(e);t.show(e.container);return t};function b(u,a,e){var d=u.terria.scene;var t=d.screenSpaceCameraController;if(d.mode==v.MORPHING||!t.enableInputs){return}switch(d.mode){case v.COLUMBUS_VIEW:if(t.enableLook){break}if(!t.enableTranslate||!t.enableTilt){return}break;case v.SCENE3D:if(t.enableLook){break}if(!t.enableTilt||!t.enableRotate){return}break;case v.SCENE2D:if(!t.enableTranslate){return}break}if(u.mode=="Phone"){document.removeEventListener("touchmove",u.orbitTouchMoveFunction,false);document.removeEventListener("touchend",u.orbitTouchEndFunction,false)}else if(u.mode=="PC"){document.removeEventListener("mousemove",u.orbitMouseMoveFunction,false);document.removeEventListener("mouseup",u.orbitMouseUpFunction,false)}if(h(u.orbitTickFunction)){u.terria.clock.onTick.removeEventListener(u.orbitTickFunction)}u.orbitTouchMoveFunction=undefined;u.orbitTouchEndFunction=undefined;u.orbitMouseMoveFunction=undefined;u.orbitMouseUpFunction=undefined;u.orbitTickFunction=undefined;u.isOrbiting=true;u.orbitLastTimestamp=f();var c=d.camera;if(h(u.terria.trackedEntity)){u.orbitFrame=undefined;u.orbitIsLook=false}else{var r=E.Utils.getCameraFocus(u.terria,true,F);if(!h(r)){u.orbitFrame=s.eastNorthUpToFixedFrame(c.positionWC,d.globe.ellipsoid,l);u.orbitIsLook=true}else{u.orbitFrame=s.eastNorthUpToFixedFrame(r,d.globe.ellipsoid,l);u.orbitIsLook=false}}u.orbitTickFunction=function(e){var t=f();var r=t-u.orbitLastTimestamp;var i=(u.orbitCursorOpacity-.5)*2.5/1e3;var n=r*i;var a=u.orbitCursorAngle+p.PI_OVER_TWO;var o=Math.cos(a)*n;var s=Math.sin(a)*n;var l;if(h(u.orbitFrame)){l=y.clone(c.transform,w);c.lookAtTransform(u.orbitFrame)}if(d.mode==v.SCENE2D){c.move(new _(o,s,0),Math.max(d.canvas.clientWidth,d.canvas.clientHeight)/100*c.positionCartographic.height*n)}else{if(u.orbitIsLook){c.look(_.UNIT_Z,-o);c.look(c.right,-s)}else{c.rotateLeft(o);c.rotateUp(s)}}if(h(u.orbitFrame)){c.lookAtTransform(l)}u.orbitLastTimestamp=t};function o(e,t){var r=Math.atan2(-e.y,e.x);u.orbitCursorAngle=p.zeroToTwoPi(r-p.PI_OVER_TWO);var i=m.magnitude(e);var n=t/2;var a=Math.min(i/n,1);var o=.5*a*a+.5;u.orbitCursorOpacity=o}u.orbitMouseMoveFunction=function(e){var t=a.getBoundingClientRect();var r=new m((t.right-t.left)/2,(t.bottom-t.top)/2);var i=new m(e.clientX-t.left,e.clientY-t.top);var n=m.subtract(i,r,g);o(n,t.width)};u.orbitMouseUpFunction=function(e){u.isOrbiting=false;document.removeEventListener("mousemove",u.orbitMouseMoveFunction,false);document.removeEventListener("mouseup",u.orbitMouseUpFunction,false);if(h(u.orbitTickFunction)){u.terria.clock.onTick.removeEventListener(u.orbitTickFunction)}u.orbitMouseMoveFunction=undefined;u.orbitMouseUpFunction=undefined;u.orbitTickFunction=undefined};u.orbitTouchMoveFunction=function(e){var t=a.getBoundingClientRect();var r=new m((t.right-t.left)/2,(t.bottom-t.top)/2);var i=new m(e.touches[0].clientX-t.left,e.touches[0].clientY-t.top);var n=m.subtract(i,r,g);o(n,t.width)};u.orbitTouchEndFunction=function(e){u.isOrbiting=false;document.removeEventListener("touchmove",u.orbitTouchMoveFunction,false);document.removeEventListener("touchend",u.orbitTouchEndFunction,false);if(h(u.orbitTickFunction)){u.terria.clock.onTick.removeEventListener(u.orbitTickFunction)}u.orbitTouchMoveFunction=undefined;u.orbitTouchEndFunction=undefined;u.orbitTickFunction=undefined};if(u.mode=="Phone"){document.addEventListener("touchmove",u.orbitTouchMoveFunction,false);document.addEventListener("touchend",u.orbitTouchEndFunction,false)}else if(u.mode=="PC"){document.addEventListener("mousemove",u.orbitMouseMoveFunction,false);document.addEventListener("mouseup",u.orbitMouseUpFunction,false)}u.terria.clock.onTick.addEventListener(u.orbitTickFunction);o(e,a.getBoundingClientRect().width)}function C(c,f,e){c.terria.options.enableCompassOuterRing=h(c.terria.options.enableCompassOuterRing)?c.terria.options.enableCompassOuterRing:true;if(c.terria.options.enableCompassOuterRing){var t=c.terria.scene;var r=t.camera;var i=t.screenSpaceCameraController;if(t.mode==v.MORPHING||t.mode==v.SCENE2D||!i.enableInputs){return}if(!i.enableLook&&(t.mode==v.COLUMBUS_VIEW||t.mode==v.SCENE3D&&!i.enableRotate)){return}if(c.mode=="Phone"){document.addEventListener("touchmove",c.rotateTouchMoveFunction,false);document.addEventListener("touchend",c.rotateTouchEndFunction,false)}else if(c.mode=="PC"){document.removeEventListener("mousemove",c.rotateMouseMoveFunction,false);document.removeEventListener("mouseup",c.rotateMouseUpFunction,false)}c.rotateMouseMoveFunction=undefined;c.rotateMouseUpFunction=undefined;c.rotateTouchMoveFunction=undefined;c.rotateTouchEndFunction=undefined;c.isRotating=true;c.rotateInitialCursorAngle=Math.atan2(-e.y,e.x);if(h(c.terria.trackedEntity)){c.rotateFrame=undefined;c.rotateIsLook=false}else{var n=E.Utils.getCameraFocus(c.terria,true,F);if(!h(n)||t.mode==v.COLUMBUS_VIEW&&!i.enableLook&&!i.enableTranslate){c.rotateFrame=s.eastNorthUpToFixedFrame(r.positionWC,t.globe.ellipsoid,l);c.rotateIsLook=true}else{c.rotateFrame=s.eastNorthUpToFixedFrame(n,t.globe.ellipsoid,l);c.rotateIsLook=false}}var a;if(h(c.rotateFrame)){a=y.clone(r.transform,w);r.lookAtTransform(c.rotateFrame)}c.rotateInitialCameraAngle=-r.heading;if(h(c.rotateFrame)){r.lookAtTransform(a)}c.rotateMouseMoveFunction=function(e){var t=f.getBoundingClientRect();var r=new m((t.right-t.left)/2,(t.bottom-t.top)/2);var i=new m(e.clientX-t.left,e.clientY-t.top);var n=m.subtract(i,r,g);var a=Math.atan2(-n.y,n.x);var o=a-c.rotateInitialCursorAngle;var s=p.zeroToTwoPi(c.rotateInitialCameraAngle-o);var l=c.terria.scene.camera;var u;if(h(c.rotateFrame)){u=y.clone(l.transform,w);l.lookAtTransform(c.rotateFrame)}var d=-l.heading;l.rotateRight(s-d);if(h(c.rotateFrame)){l.lookAtTransform(u)}};c.rotateMouseUpFunction=function(e){c.isRotating=false;document.removeEventListener("mousemove",c.rotateMouseMoveFunction,false);document.removeEventListener("mouseup",c.rotateMouseUpFunction,false);c.rotateMouseMoveFunction=undefined;c.rotateMouseUpFunction=undefined};c.rotateTouchMoveFunction=function(e){var t=f.getBoundingClientRect();var r=new m((t.right-t.left)/2,(t.bottom-t.top)/2);var i=new m(e.touches[0].clientX-t.left,e.touches[0].clientY-t.top);var n=m.subtract(i,r,g);var a=Math.atan2(-n.y,n.x);var o=a-c.rotateInitialCursorAngle;var s=p.zeroToTwoPi(c.rotateInitialCameraAngle-o);var l=c.terria.scene.camera;var u;if(h(c.rotateFrame)){u=y.clone(l.transform,w);l.lookAtTransform(c.rotateFrame)}var d=-l.heading;l.rotateRight(s-d);if(h(c.rotateFrame)){l.lookAtTransform(u)}};c.rotateTouchEndFunction=function(e){c.isRotating=false;document.removeEventListener("touchmove",c.rotateTouchMoveFunction,false);document.removeEventListener("touchend",c.rotateTouchEndFunction,false);c.rotateTouchMoveFunction=undefined;c.rotateTouchEndFunction=undefined};if(c.mode=="Phone"){document.addEventListener("touchmove",c.rotateTouchMoveFunction,false);document.addEventListener("touchend",c.rotateTouchEndFunction,false)}else if(c.mode=="PC"){document.addEventListener("mousemove",c.rotateMouseMoveFunction,false);document.addEventListener("mouseup",c.rotateMouseUpFunction,false)}}}return r}(Freedo.defined,Freedo.Math,Freedo.getTimestamp,Freedo.EventHelper,Freedo.Transforms,Freedo.SceneMode,Freedo.Cartesian2,Freedo.Cartesian3,Freedo.Matrix4,Freedo.BoundingSphere,Freedo.HeadingPitchRange,r(71))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ResetViewNavigationControl=undefined;var i=r(72);var l=a(i);var u=r(262);var n=r(674);var d=a(n);function a(e){return e&&e.__esModule?e:{default:e}}var o=t.ResetViewNavigationControl=function(n,a,o,s){"use strict";var e=function e(t){u.NavigationControl.apply(this,arguments);this.name="重置视图";this.svgIcon=d.default;this.svgHeight=15;this.svgWidth=15;this.cssClass="navigation-control-icon-reset"};e.prototype=(0,l.default)(u.NavigationControl.prototype);e.prototype.resetView=function(){var e=this.terria.scene;var t=e.screenSpaceCameraController;if(!t.enableInputs){return}this.isActive=true;var r=e.camera;if(n(this.terria.trackedEntity)){var i=this.terria.trackedEntity;this.terria.trackedEntity=undefined;this.terria.trackedEntity=i}else{if(this.terria.options.defaultResetView){if(this.terria.options.defaultResetView&&this.terria.options.defaultResetView instanceof s){r.flyTo({destination:e.globe.ellipsoid.cartographicToCartesian(this.terria.options.defaultResetView)})}else if(this.terria.options.defaultResetView&&this.terria.options.defaultResetView instanceof o){try{o.validate(this.terria.options.defaultResetView);r.flyTo({destination:this.terria.options.defaultResetView})}catch(e){console.log("Cesium-navigation/ResetViewNavigationControl:   options.defaultResetView Cesium rectangle is  invalid!")}}}else if(typeof r.flyHome==="function"){r.flyHome(1)}else{r.flyTo({destination:a.DEFAULT_VIEW_RECTANGLE,duration:1})}}this.isActive=false};e.prototype.activate=function(){this.resetView()};return e}(Freedo.defined,Freedo.Camera,Freedo.Rectangle,Freedo.Cartographic)},function(e,t,r){r(672);var i=r(13).Object;e.exports=function e(t,r){return i.create(t,r)}},function(e,t,r){var i=r(17);i(i.S,"Object",{create:r(113)})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=t.UserInterfaceControl=function(r,e,i,n){"use strict";var t=function e(t){if(!r(t)){throw new i("terria is required")}this._terria=t;this.name="Unnamed Control";this.text=undefined;this.svgIcon=undefined;this.svgHeight=undefined;this.svgWidth=undefined;this.cssClass=undefined;this.isActive=false;n.track(this,["name","svgIcon","svgHeight","svgWidth","cssClass","isActive"])};e(t.prototype,{terria:{get:function e(){return this._terria}},hasText:{get:function e(){return r(this.text)&&typeof this.text==="string"}}});t.prototype.activate=function(){throw new i("activate must be implemented in the derived class.")};return t}(Freedo.defined,Freedo.defineProperties,Freedo.DeveloperError,r(71))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default="M 7.5,0 C 3.375,0 0,3.375 0,7.5 0,11.625 3.375,15 7.5,15 c 3.46875,0 6.375,-2.4375 7.21875,-5.625 l -1.96875,0 C 12,11.53125 9.9375,13.125 7.5,13.125 4.40625,13.125 1.875,10.59375 1.875,7.5 1.875,4.40625 4.40625,1.875 7.5,1.875 c 1.59375,0 2.90625,0.65625 3.9375,1.6875 l -3,3 6.5625,0 L 15,0 12.75,2.25 C 11.4375,0.84375 9.5625,0 7.5,0 z"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ZoomNavigationControl=undefined;var i=r(72);var n=o(i);var a=r(262);var m=r(263);function o(e){return e&&e.__esModule?e:{default:e}}var s=t.ZoomNavigationControl=function(d,c,f,h,p){"use strict";var e=function e(t,r){a.NavigationControl.apply(this,arguments);this.name=r?"放大":"缩小";this.text=r?"+":"-";this.cssClass="navigation-control-icon-zoom-"+(r?"in":"out");this.relativeAmount=2;if(r){this.relativeAmount=1/this.relativeAmount}};e.prototype.relativeAmount=1;e.prototype=(0,n.default)(a.NavigationControl.prototype);e.prototype.activate=function(){this.zoom(this.relativeAmount)};var v=new h;e.prototype.zoom=function(e){this.isActive=true;if(d(this.terria)){var t=this.terria.scene;var r=t.screenSpaceCameraController;if(!r.enableInputs||!r.enableZoom){return}var i=t.camera;var n;switch(t.mode){case p.MORPHING:break;case p.SCENE2D:i.zoomIn(i.positionCartographic.height*(1-this.relativeAmount));break;default:var a;if(d(this.terria.trackedEntity)){a=new h}else{a=m.Utils.getCameraFocus(this.terria,false)}if(!d(a)){var o=new c(i.worldToCameraCoordinatesPoint(t.globe.ellipsoid.cartographicToCartesian(i.positionCartographic)),i.directionWC);a=f.grazingAltitudeLocation(o,t.globe.ellipsoid);n={heading:i.heading,pitch:i.pitch,roll:i.roll}}else{n={direction:i.direction,up:i.up}}var s=h.subtract(i.position,a,v);var l=h.multiplyByScalar(s,e,s);var u=h.add(a,l,a);if(d(this.terria.trackedEntity)||t.mode==p.COLUMBUS_VIEW){i.position=u}else{i.flyTo({destination:u,orientation:n,duration:.5,convert:false})}}}this.isActive=false};return e}(Freedo.defined,Freedo.Ray,Freedo.IntersectionTests,Freedo.Cartesian3,Freedo.SceneMode)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default="m 66.5625,0 0,15.15625 3.71875,0 0,-10.40625 5.5,10.40625 4.375,0 0,-15.15625 -3.71875,0 0,10.40625 L 70.9375,0 66.5625,0 z M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z m 0,1.75 c 13.842515,0 26.368948,5.558092 35.5,14.5625 l -11.03125,11 0.625,0.625 11.03125,-11 c 8.9199,9.108762 14.4375,21.579143 14.4375,35.34375 0,13.764606 -5.5176,26.22729 -14.4375,35.34375 l -11.03125,-11 -0.625,0.625 11.03125,11 c -9.130866,9.01087 -21.658601,14.59375 -35.5,14.59375 -13.801622,0 -26.321058,-5.53481 -35.4375,-14.5 l 11.125,-11.09375 c 6.277989,6.12179 14.857796,9.90625 24.3125,9.90625 19.241896,0 34.875,-15.629154 34.875,-34.875 0,-19.245847 -15.633104,-34.84375 -34.875,-34.84375 -9.454704,0 -18.034511,3.760884 -24.3125,9.875 L 37.0625,36.4375 C 46.179178,27.478444 58.696991,21.96875 72.5,21.96875 z m -0.875,0.84375 0,13.9375 1.75,0 0,-13.9375 -1.75,0 z M 36.46875,37.0625 47.5625,48.15625 C 41.429794,54.436565 37.65625,63.027539 37.65625,72.5 c 0,9.472461 3.773544,18.055746 9.90625,24.34375 L 36.46875,107.9375 c -8.96721,-9.1247 -14.5,-21.624886 -14.5,-35.4375 0,-13.812615 5.53279,-26.320526 14.5,-35.4375 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z M 22.84375,71.625 l 0,1.75 13.96875,0 0,-1.75 -13.96875,0 z m 85.5625,0 0,1.75 14,0 0,-1.75 -14,0 z M 71.75,108.25 l 0,13.9375 1.71875,0 0,-13.9375 -1.71875,0 z"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default="m 72.71875,54.375 c -0.476702,0 -0.908208,0.245402 -1.21875,0.5625 -0.310542,0.317098 -0.551189,0.701933 -0.78125,1.1875 -0.172018,0.363062 -0.319101,0.791709 -0.46875,1.25 -6.91615,1.075544 -12.313231,6.656514 -13,13.625 -0.327516,0.117495 -0.661877,0.244642 -0.9375,0.375 -0.485434,0.22959 -0.901634,0.471239 -1.21875,0.78125 -0.317116,0.310011 -0.5625,0.742111 -0.5625,1.21875 l 0.03125,0 c 0,0.476639 0.245384,0.877489 0.5625,1.1875 0.317116,0.310011 0.702066,0.58291 1.1875,0.8125 0.35554,0.168155 0.771616,0.32165 1.21875,0.46875 1.370803,6.10004 6.420817,10.834127 12.71875,11.8125 0.146999,0.447079 0.30025,0.863113 0.46875,1.21875 0.230061,0.485567 0.470708,0.870402 0.78125,1.1875 0.310542,0.317098 0.742048,0.5625 1.21875,0.5625 0.476702,0 0.876958,-0.245402 1.1875,-0.5625 0.310542,-0.317098 0.582439,-0.701933 0.8125,-1.1875 0.172018,-0.363062 0.319101,-0.791709 0.46875,-1.25 6.249045,-1.017063 11.256351,-5.7184 12.625,-11.78125 0.447134,-0.1471 0.86321,-0.300595 1.21875,-0.46875 0.485434,-0.22959 0.901633,-0.502489 1.21875,-0.8125 0.317117,-0.310011 0.5625,-0.710861 0.5625,-1.1875 l -0.03125,0 c 0,-0.476639 -0.245383,-0.908739 -0.5625,-1.21875 C 89.901633,71.846239 89.516684,71.60459 89.03125,71.375 88.755626,71.244642 88.456123,71.117495 88.125,71 87.439949,64.078341 82.072807,58.503735 75.21875,57.375 c -0.15044,-0.461669 -0.326927,-0.884711 -0.5,-1.25 -0.230061,-0.485567 -0.501958,-0.870402 -0.8125,-1.1875 -0.310542,-0.317098 -0.710798,-0.5625 -1.1875,-0.5625 z m -0.0625,1.40625 c 0.03595,-0.01283 0.05968,0 0.0625,0 0.0056,0 0.04321,-0.02233 0.1875,0.125 0.144288,0.147334 0.34336,0.447188 0.53125,0.84375 0.06385,0.134761 0.123901,0.309578 0.1875,0.46875 -0.320353,-0.01957 -0.643524,-0.0625 -0.96875,-0.0625 -0.289073,0 -0.558569,0.04702 -0.84375,0.0625 C 71.8761,57.059578 71.936151,56.884761 72,56.75 c 0.18789,-0.396562 0.355712,-0.696416 0.5,-0.84375 0.07214,-0.07367 0.120304,-0.112167 0.15625,-0.125 z m 0,2.40625 c 0.448007,0 0.906196,0.05436 1.34375,0.09375 0.177011,0.592256 0.347655,1.271044 0.5,2.03125 0.475097,2.370753 0.807525,5.463852 0.9375,8.9375 -0.906869,-0.02852 -1.834463,-0.0625 -2.78125,-0.0625 -0.92298,0 -1.802327,0.03537 -2.6875,0.0625 0.138529,-3.473648 0.493653,-6.566747 0.96875,-8.9375 0.154684,-0.771878 0.320019,-1.463985 0.5,-2.0625 0.405568,-0.03377 0.804291,-0.0625 1.21875,-0.0625 z m -2.71875,0.28125 c -0.129732,0.498888 -0.259782,0.987558 -0.375,1.5625 -0.498513,2.487595 -0.838088,5.693299 -0.96875,9.25 -3.21363,0.15162 -6.119596,0.480068 -8.40625,0.9375 -0.682394,0.136509 -1.275579,0.279657 -1.84375,0.4375 0.799068,-6.135482 5.504716,-11.036454 11.59375,-12.1875 z M 75.5,58.5 c 6.043169,1.18408 10.705093,6.052712 11.5,12.15625 -0.569435,-0.155806 -1.200273,-0.302525 -1.875,-0.4375 -2.262525,-0.452605 -5.108535,-0.783809 -8.28125,-0.9375 -0.130662,-3.556701 -0.470237,-6.762405 -0.96875,-9.25 C 75.761959,59.467174 75.626981,58.990925 75.5,58.5 z m -2.84375,12.09375 c 0.959338,0 1.895843,0.03282 2.8125,0.0625 C 75.48165,71.267751 75.5,71.871028 75.5,72.5 c 0,1.228616 -0.01449,2.438313 -0.0625,3.59375 -0.897358,0.0284 -1.811972,0.0625 -2.75,0.0625 -0.927373,0 -1.831062,-0.03473 -2.71875,-0.0625 -0.05109,-1.155437 -0.0625,-2.365134 -0.0625,-3.59375 0,-0.628972 0.01741,-1.232249 0.03125,-1.84375 0.895269,-0.02827 1.783025,-0.0625 2.71875,-0.0625 z M 68.5625,70.6875 c -0.01243,0.60601 -0.03125,1.189946 -0.03125,1.8125 0,1.22431 0.01541,2.407837 0.0625,3.5625 -3.125243,-0.150329 -5.92077,-0.471558 -8.09375,-0.90625 -0.784983,-0.157031 -1.511491,-0.316471 -2.125,-0.5 -0.107878,-0.704096 -0.1875,-1.422089 -0.1875,-2.15625 0,-0.115714 0.02849,-0.228688 0.03125,-0.34375 0.643106,-0.20284 1.389577,-0.390377 2.25,-0.5625 2.166953,-0.433487 4.97905,-0.75541 8.09375,-0.90625 z m 8.3125,0.03125 c 3.075121,0.15271 5.824455,0.446046 7.96875,0.875 0.857478,0.171534 1.630962,0.360416 2.28125,0.5625 0.0027,0.114659 0,0.228443 0,0.34375 0,0.735827 -0.07914,1.450633 -0.1875,2.15625 -0.598568,0.180148 -1.29077,0.34562 -2.0625,0.5 -2.158064,0.431708 -4.932088,0.754666 -8.03125,0.90625 0.04709,-1.154663 0.0625,-2.33819 0.0625,-3.5625 0,-0.611824 -0.01924,-1.185379 -0.03125,-1.78125 z M 57.15625,72.5625 c 0.0023,0.572772 0.06082,1.131112 0.125,1.6875 -0.125327,-0.05123 -0.266577,-0.10497 -0.375,-0.15625 -0.396499,-0.187528 -0.665288,-0.387337 -0.8125,-0.53125 -0.147212,-0.143913 -0.15625,-0.182756 -0.15625,-0.1875 0,-0.0047 -0.02221,-0.07484 0.125,-0.21875 0.147212,-0.143913 0.447251,-0.312472 0.84375,-0.5 0.07123,-0.03369 0.171867,-0.06006 0.25,-0.09375 z m 31.03125,0 c 0.08201,0.03503 0.175941,0.05872 0.25,0.09375 0.396499,0.187528 0.665288,0.356087 0.8125,0.5 0.14725,0.14391 0.15625,0.21405 0.15625,0.21875 0,0.0047 -0.009,0.04359 -0.15625,0.1875 -0.147212,0.143913 -0.416001,0.343722 -0.8125,0.53125 -0.09755,0.04613 -0.233314,0.07889 -0.34375,0.125 0.06214,-0.546289 0.09144,-1.094215 0.09375,-1.65625 z m -29.5,3.625 c 0.479308,0.123125 0.983064,0.234089 1.53125,0.34375 2.301781,0.460458 5.229421,0.787224 8.46875,0.9375 0.167006,2.84339 0.46081,5.433176 0.875,7.5 0.115218,0.574942 0.245268,1.063612 0.375,1.5625 -5.463677,-1.028179 -9.833074,-5.091831 -11.25,-10.34375 z m 27.96875,0 C 85.247546,81.408945 80.919274,85.442932 75.5,86.5 c 0.126981,-0.490925 0.261959,-0.967174 0.375,-1.53125 0.41419,-2.066824 0.707994,-4.65661 0.875,-7.5 3.204493,-0.15162 6.088346,-0.480068 8.375,-0.9375 0.548186,-0.109661 1.051942,-0.220625 1.53125,-0.34375 z M 70.0625,77.53125 c 0.865391,0.02589 1.723666,0.03125 2.625,0.03125 0.912062,0 1.782843,-0.0048 2.65625,-0.03125 -0.165173,2.736408 -0.453252,5.207651 -0.84375,7.15625 -0.152345,0.760206 -0.322989,1.438994 -0.5,2.03125 -0.437447,0.03919 -0.895856,0.0625 -1.34375,0.0625 -0.414943,0 -0.812719,-0.02881 -1.21875,-0.0625 -0.177011,-0.592256 -0.347655,-1.271044 -0.5,-2.03125 -0.390498,-1.948599 -0.700644,-4.419842 -0.875,-7.15625 z m 1.75,10.28125 c 0.284911,0.01545 0.554954,0.03125 0.84375,0.03125 0.325029,0 0.648588,-0.01171 0.96875,-0.03125 -0.05999,0.148763 -0.127309,0.31046 -0.1875,0.4375 -0.18789,0.396562 -0.386962,0.696416 -0.53125,0.84375 -0.144288,0.147334 -0.181857,0.125 -0.1875,0.125 -0.0056,0 -0.07446,0.02233 -0.21875,-0.125 C 72.355712,88.946416 72.18789,88.646562 72,88.25 71.939809,88.12296 71.872486,87.961263 71.8125,87.8125 z"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default="M 72.46875,22.03125 C 59.505873,22.050338 46.521615,27.004287 36.6875,36.875 L 47.84375,47.96875 C 61.521556,34.240041 83.442603,34.227389 97.125,47.90625 l 11.125,-11.125 C 98.401629,26.935424 85.431627,22.012162 72.46875,22.03125 z"},function(e,t,r){var i=r(680);if(typeof i==="string")i=[[e.i,i,""]];var n;var a;var o={hmr:true};o.transform=n;o.insertInto=undefined;var s=r(249)(i,o);if(i.locals)e.exports=i.locals;if(false){}},function(e,t,r){t=e.exports=r(248)(false);t.push([e.i,".full-window{position:absolute;top:0;left:0;right:0;bottom:0;margin:0;overflow:hidden;padding:0;-webkit-transition:left .25s ease-out;-moz-transition:left .25s ease-out;-ms-transition:left .25s ease-out;-o-transition:left .25s ease-out;transition:left .25s ease-out}.transparent-to-input{pointer-events:none}.opaque-to-input{pointer-events:auto}.clickable{cursor:pointer}a:hover{text-decoration:none}.modal-background{pointer-events:auto;position:fixed;left:0;right:0;top:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:1000}.modal{position:absolute;margin:auto;background-color:#2F353C;top:0;left:0;bottom:0;right:0;max-height:100%;max-width:100%;font-family:'Roboto',sans-serif;color:#FFFFFF}.modal-header{background-color:rgba(0,0,0,0.2);border-bottom:1px solid rgba(100,100,100,0.6);font-size:15px;line-height:40px;margin:0}.modal-header h1{font-size:15px;color:#FFFFFF;margin-left:15px}.modal-content{margin-left:15px;margin-right:15px;margin-bottom:15px;padding-top:15px;overflow:auto}.modal-close-button{position:absolute;right:15px;cursor:pointer;font-size:18px;color:#FFFFFF}#ui{z-index:2100}@media print{.full-window{position:initial}}.markdown img{max-width:100%}.markdown svg{max-height:100%}.markdown input,.markdown select,.markdown textarea,.markdown fieldset{font-family:inherit;font-size:1rem;box-sizing:border-box;margin-top:0;margin-bottom:0}.markdown label{vertical-align:middle}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6{font-family:inherit;font-weight:bold;line-height:1.25;margin-top:1em;margin-bottom:.5em}.markdown h1{font-size:2rem}.markdown h2{font-size:1.5rem}.markdown h3{font-size:1.25rem}.markdown h4{font-size:1rem}.markdown h5{font-size:.875rem}.markdown h6{font-size:.75rem}.markdown p{margin-top:0;margin-bottom:1rem}.markdown strong{font-weight:bold}.markdown em{font-style:italic}.markdown small{font-size:80%}.markdown mark{color:#000;background:#ff0}.markdown u{text-decoration:underline}.markdown s{text-decoration:line-through}.markdown dl,.markdown ol,.markdown ul{margin-top:0;margin-bottom:1rem}.markdown ol{list-style:decimal inside}.markdown ul{list-style:disc inside}.markdown pre,.markdown code,.markdown samp{font-family:monospace;font-size:inherit}.markdown pre{margin-top:0;margin-bottom:1rem;overflow-x:scroll}.markdown a{color:#68ADFE;text-decoration:none}.markdown pre,.markdown code{background-color:transparent;border-radius:3px}.markdown hr{border:0;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:rgba(0,0,0,0.125)}.markdown .left-align{text-align:left}.markdown .center{text-align:center}.markdown .right-align{text-align:right}.markdown .justify{text-align:justify}.markdown .truncate{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.markdown ol.upper-roman{list-style-type:upper-roman}.markdown ol.lower-alpha{list-style-type:lower-alpha}.markdown ul.circle{list-style-type:circle}.markdown ul.square{list-style-type:square}.markdown .list-reset{list-style:none;padding-left:0}.floating{pointer-events:auto;position:absolute;border-radius:6px;background-color:rgba(47,53,60,0.8)}.floating-horizontal{pointer-events:auto;position:absolute;border-radius:6px;background-color:rgba(47,53,60,0.8);padding-left:0px;padding-right:0}.floating-vertical{pointer-events:auto;position:absolute;border-radius:6px;background-color:rgba(47,53,60,0.8);padding-top:5px;padding-bottom:5px}@media print{.floating{display:none}}.distance-legend{pointer-events:auto;position:absolute;border-radius:6px;background-color:rgba(47,53,60,0.8);padding-left:0px;padding-right:0px;left:25px;bottom:20px;height:26px;width:125px;border:1px solid rgba(255,255,255,0.1);box-sizing:content-box}.distance-legend-label{display:inline-block;font-family:'Roboto',sans-serif;font-size:12px;font-weight:lighter;line-height:26px;color:#FFFFFF;width:125px;text-align:center}.distance-legend-scale-bar{border-left:1px solid #FFFFFF;border-right:1px solid #FFFFFF;border-bottom:1px solid #FFFFFF;position:absolute;height:10px;top:12px}@media print{.distance-legend{display:none}}@media screen and (max-width:700px),screen and (max-height:420px){.distance-legend{display:none}}.navigation-controls{position:absolute;width:30px;right:45px;top:126px;border:1px solid rgba(255,255,255,0.2);font-weight:300;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.navigation-control{cursor:pointer;border-bottom:1px solid #555555}.naviagation-control:active{color:#FFF}.navigation-control-last{cursor:pointer;border-bottom:1px solid #555555;border-bottom:0}.navigation-control-icon-zoom-in{position:relative;text-align:center;font-size:20px;color:#FFFFFF;padding-bottom:4px}.navigation-control-icon-zoom-out{position:relative;text-align:center;font-size:20px;color:#FFFFFF}.navigation-control-icon-reset{position:relative;left:10px;width:10px;height:10px;fill:rgba(255,255,255,0.8);padding-top:6px;padding-bottom:6px;box-sizing:content-box}.compass{pointer-events:auto;position:absolute;right:13px;top:20px;width:95px;height:95px;overflow:hidden}.compass-outer-ring{position:absolute;top:0;width:95px;height:95px;fill:rgba(255,255,255,0.5)}.compass-outer-ring-background{position:absolute;top:14px;left:14px;width:44px;height:44px;border-radius:44px;border:12px solid rgba(47,53,60,0.8);box-sizing:content-box}.compass-gyro{pointer-events:none;position:absolute;top:0;width:95px;height:95px;fill:#CCC}.compass-gyro-active{fill:#68ADFE}.compass-gyro-background{position:absolute;top:30px;left:30px;width:33px;height:33px;border-radius:33px;background-color:rgba(47,53,60,0.8);border:1px solid rgba(255,255,255,0.2);box-sizing:content-box}.compass-gyro-background:hover+.compass-gyro{fill:#68ADFE}.compass-rotation-marker{position:absolute;top:0;width:95px;height:95px;fill:#68ADFE}@media screen and (max-width:700px),screen and (max-height:420px){.navigation-controls{display:none}}@media print{.navigation-controls{display:none}.compass{display:none}}",""])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={};var n="uniform sampler2D colorTexture; //输入的场景渲染照片\nvarying vec2 v_textureCoordinates;\n\nfloat snow(vec2 uv,float scale)\n{\n    float time = czm_frameNumber / 60.0;\n    float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\n    uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\n    uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\n    p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\n    k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n    return k*w;\n}\n\nvoid main(void){\n    vec2 resolution = czm_viewport.zw;\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n    vec3 finalColor=vec3(0);\n    //float c=smoothstep(1.,0.3,clamp(uv.y*.3+.8,0.,.75));\n    float c = 0.0;\n    c+=snow(uv,30.);\n    c+=snow(uv,20.);\n    c+=snow(uv,15.);\n    c+=snow(uv,10.);\n    c+=snow(uv,8.);\n    c+=snow(uv,6.);\n    c+=snow(uv,5.);\n    finalColor=(vec3(c)); //屏幕上雪的颜色\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.2);  //将雪和三维场景融合\n\n}";var a="uniform sampler2D colorTexture;//输入的场景渲染照片\nvarying vec2 v_textureCoordinates;\n\nfloat hash(float x){\n    return fract(sin(x*133.3)*13.13);\n}\n\nvoid main(void){\n\n    float time = czm_frameNumber / 60.0;\n    vec2 resolution = czm_viewport.zw;\n\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n    vec3 c=vec3(.6,.7,.8);\n\n    float a=-.4;\n    float si=sin(a),co=cos(a);\n    uv*=mat2(co,-si,si,co);\n    uv*=length(uv+vec2(0,4.9))*.3+2.;\n\n    float v=1.-sin(hash(floor(uv.x*100.))*2.);\n    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n    c*=v*b; //屏幕上雨的颜色\n\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.15); //将雨和三维场景融合\n}";var o=void 0,s=void 0;var l={hueShift:undefined,saturationShift:undefined,brightnessShift:undefined,density:undefined,minimumBrightness:undefined};i.createSnow=function(e){var t=e.scene.postProcessStages;if(!o||o.isDestroyed())o=new Freedo.PostProcessStage({name:"fd_snow",fragmentShader:n});if(!t.contains(o))t.add(o);h(e)};var u=void 0;i.createRain=function(e){var t=e.scene.postProcessStages;if(!u||u.isDestroyed())u=new Freedo.PostProcessStage({name:"fd_rain",fragmentShader:a});if(!t.contains(u))t.add(u);h(e)};i.removeSnow=function(e){var t=e.scene.postProcessStages;t.remove(o)};i.removeRain=function(e){var t=e.scene.postProcessStages;t.remove(u)};function d(){viewer.scene.skyAtmosphere.hueShift=-.8;viewer.scene.skyAtmosphere.saturationShift=-.7;viewer.scene.skyAtmosphere.brightnessShift=-.33;viewer.scene.fog.density=.001;viewer.scene.fog.minimumBrightness=.8}function c(){viewer.scene.skyAtmosphere.hueShift=l.hueShift;viewer.scene.skyAtmosphere.saturationShift=l.saturationShift;viewer.scene.skyAtmosphere.brightnessShift=l.brightnessShift;viewer.scene.fog.density=l.density;viewer.scene.fog.minimumBrightness=l.minimumBrightness}function f(){l.hueShift=viewer.scene.skyAtmosphere.hueShift;l.saturationShift=viewer.scene.skyAtmosphere.saturationShift;l.brightnessShift=viewer.scene.skyAtmosphere.brightnessShift;l.density=viewer.scene.fog.density;l.minimumBrightness=viewer.scene.fog.minimumBrightness}function h(e){if(!s)s=window.setInterval(function(){e.scene.requestRender()},30)}t.FdSnowRain=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCustomClip=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(5);var l=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,n.default)(this,r);this._viewer=e;this._ple=new l.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._pModel=undefined;this._clippingPlanes=undefined}(0,o.default)(r,[{key:"setPModel",value:function e(t){this._pModel=t}},{key:"start",value:function e(){if(this._pModel===undefined){console.log("请先设置需要剖切的PModel");return}this._ple.run();this.addLsnr()}},{key:"addLsnr",value:function e(){var i=this;this._ple.on(function(e,t){if(e=="DataChanged"){i._ple.cancel();var r=t.polyline.ptsG;i.build(r)}})}},{key:"build",value:function e(t){var r=this.createClippingPlanes(t);this._pModel.clippingPlanes=r}},{key:"createClippingPlanes",value:function e(t){var r=[],i=t[0];var n=t[0],a=t[1],o=t[2];var s=(a[0]-n[0])*(o[1]-n[1])-(o[0]-n[0])*(a[1]-n[1]);if(s>0){s=1;console.log("逆时针")}else if(s<0){s=-1;console.log("顺时针")}else{s=1;console.log("平行")}for(var l=0;l<t.length;l++){var u=void 0,d=void 0;if(l!=t.length-1){u=t[l];d=t[l+1]}else{u=t[l];d=t[0]}u[2]=Freedo.clone(i[2],true);d[2]=Freedo.clone(i[2],true);var c=Freedo.FdMisc.FdGeometric.tc(u);var f=Freedo.FdMisc.FdGeometric.tc(d);var h=new Freedo.Cartesian3.subtract(f,c,new Freedo.Cartesian3);var p=Freedo.Cartesian3.multiplyByScalar(h,.5,new Freedo.Cartesian3);var v=Freedo.Cartesian3.add(c,p,new Freedo.Cartesian3);var m=Freedo.Cartesian3.cross(p,v,new Freedo.Cartesian3);Freedo.Cartesian3.multiplyByScalar(m,s,m);r.push(new Freedo.ClippingPlane(m,0))}this._clippingPlanes=new Freedo.ClippingPlaneCollection({planes:r,enabled:true,useGltfModelMatrix:false});return this._clippingPlanes}},{key:"getNearestDistance",value:function e(t,r,i){var n,a,o;n=Freedo.Cartesian3.distance(r,i);if(n<=1e-5){return 0}a=Freedo.Cartesian3.distance(t,i);if(a<=1e-5){return 0}o=Freedo.Cartesian3.distance(t,r);if(o<=1e-5){return n}if(n*n>=a*a+o*o){return a}if(a*a>=n*n+o*o){return n}var s=(n+a+o)/2;var l=Math.sqrt(s*(s-n)*(s-a)*(s-o));return 2*l/o}},{key:"clearClipPlanes",value:function e(){if(this._pModel===undefined){console.log("请先设置需要剖切的PModel");return}if(Freedo.defined(this._pModel.clippingPlanes)){this._pModel.clippingPlanes.enabled=false;this._pModel.clippingPlanes=undefined}this._clippingPlanes=undefined}},{key:"cancel",value:function e(){this._ple.cancel()}}]);return r}();t.FdCustomClip=d},function(t,r,i){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.FdModelTransform=undefined;var n=i(49);var s=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=t.model,i=t.uri,n=t.axisPosition,a=t.pickNode,o=a===undefined?false:a,s=t.pickPosition,l=s===undefined?false:s,u=t.showMatrixAxis,d=u===undefined?false:u,c=t.modelMatrix,f=c===undefined?Freedo.clone(Freedo.Matrix4.IDENTITY):c;this._viewer=e;this._model=r;this._uri=i;this._axisPosition=n;this._pickNode=o;this._pickPosition=l;this._modelMatrix=f;this.ready=false;this.readyPromise=this.readyModel();this.readyPromise.then(this._onReady);this._handler=new Freedo.ScreenSpaceEventHandler(e.canvas);this._removeCallback=this._handler.setInputAction(this.onLeftClick.bind(this),Freedo.ScreenSpaceEventType.LEFT_CLICK);this._node;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._showMatrixAxis=d;this._initedAxis=false;this._polylines=this._viewer.scene.primitives.add(new Freedo.PolylineCollection);this._labels=this._viewer.scene.primitives.add(new Freedo.LabelCollection({modelMatrix:Freedo.Matrix4.IDENTITY}));this._points=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection({modelMatrix:Freedo.Matrix4.IDENTITY}))}o.prototype.showAxis=function(){this._showMatrixAxis=true;this.updateNodeMatrixAxis()};o.prototype.hideAxis=function(){this._showMatrixAxis=false;this.updateNodeMatrixAxis()};o.prototype.getAxisPosition=function(){return Freedo.Cartesian3.clone(this._axisPosition,new Freedo.Cartesian3)};o.prototype.setAxisPosition=function(e){this._axisPosition=Freedo.Cartesian3.clone(e,new Freedo.Cartesian3)};o.prototype.readyModel=function(){var a=this;function t(t,r){var i=a._model,n=a._uri;if(i){if(!i.ready)i.readyPromise.then(function(e){o(t,e)},function(e){return r(e)});else{a.ready=true;t(e)}}else if(n){a._model=Freedo.Model.fromGltf({url:n,modelMatrix:a._modelMatrix});a._model.readyPromise.then(function(e){o(t,e)},function(e){return r(e)});a._viewer.scene.primitives.add(a._model)}}function o(e,t){a.ready=true;e(t);a._event.raiseEvent("ModelLoaded",t)}return new s.default(t)};o.prototype.setModel=function(e){if(this._model===e)return;this._model=e;this._event.raiseEvent("ModelChanged",e)};o.prototype.getNodes=function(){return this._model._runtime.nodes};o.prototype.setNode=function(e){if(this._node===e)return;this._node=e;if(e._model!=this._model)this.setModel(e._model);this._event.raiseEvent("NodeChanged",e)};o.prototype.setNodeByName=function(e){var t=this._model.getNode(e);this.setNode(t)};o.prototype.setNodeByIdx=function(e){var t=this._model.gltf.nodes[e];this.setNode(t)};o.prototype.setHeading=function(e){var t=new Freedo.HeadingPitchRoll(e,0,0);this.transformNode(t)};o.prototype.setPitch=function(e){var t=new Freedo.HeadingPitchRoll(0,e,0);this.transformNode(t)};o.prototype.setRoll=function(e){var t=new Freedo.HeadingPitchRoll(0,0,e);this.transformNode(t)};o.prototype.setHpr=function(e,t,r){var i=new Freedo.HeadingPitchRoll(e,t,r);this.transformNode(i)};o.prototype.setTranslation=function(e,t,r){this.transformNode(undefined,new Freedo.Cartesian3(e,t,r))};o.prototype.transformNode=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:new Freedo.HeadingPitchRoll;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Freedo.Cartesian3;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=this._node;if(!i)throw new Error("请指定要操作的节点！");var n=this._axisPosition?this._axisPosition:new Freedo.Cartesian3;var a=Freedo.Matrix3.fromHeadingPitchRoll(e,new Freedo.Matrix3);var o=this.computeFixedFrameToLocalFrame(i,n);var s=r?Freedo.clone(i.matrix):Freedo.clone(Freedo.Matrix4.IDENTITY);Freedo.Matrix4.multiplyByMatrix3(s,a,s);var l=Freedo.Matrix3.multiplyByVector(Freedo.Matrix3.inverse(a,new Freedo.Matrix3),o,new Freedo.Cartesian3);var u=Freedo.Cartesian3.subtract(l,o,new Freedo.Cartesian3);Freedo.Matrix4.multiplyByTranslation(s,u,s);Freedo.Matrix4.multiplyByTranslation(s,t,s);i.matrix=s;this.updateNodeMatrixAxis()};o.prototype.computeFixedFrameToLocalFrame=function(e,t){var r=this.getMat(e);Freedo.Matrix4.inverse(r,r);return Freedo.Matrix4.multiplyByPoint(r,t,new Freedo.Cartesian3)};o.prototype.getNodePos=function(e){var t=this.getMat(e);return Freedo.Matrix4.getTranslation(t,new Freedo.Cartesian3)};o.prototype.getMat=function(e){if(e instanceof Freedo.ModelNode)e=e._runtimeNode;function r(e,t){if(t===undefined)t=Freedo.clone(Freedo.Matrix4.IDENTITY);Freedo.Matrix4.multiply(e.publicNode.matrix,t,t);if(e.parents.length>0)return r(e.parents[0],t);Freedo.Matrix4.multiply(e.computedMatrix,t,t);return t}return r(e)};var l=new Freedo.Matrix4,u=new Freedo.Matrix4,d=new Freedo.Matrix4;o.prototype.updateNodeMatrixAxis=function(){if(!this._showMatrixAxis){if(this._initedAxis){this._polylines.removeAll();this._points.removeAll();this._labels.removeAll();this._initedAxis=false}this._viewer.scene.requestRender();return}var e=this.getMat(this._node);var t=this.computeFixedFrameToLocalFrame(this._node,this._axisPosition);Freedo.Matrix4.multiplyByTranslation(e,t,e);this._labels.modelMatrix=e.clone(l);this._polylines.modelMatrix=e.clone(u);this._points.modelMatrix=e.clone(d);if(!this._initedAxis)this.initMatrixAxis();this._viewer.scene.requestRender()};var c=new Freedo.Cartesian3,f=new Freedo.Cartesian3(10,0,0),h=new Freedo.Cartesian3(0,10,0),p=new Freedo.Cartesian3(0,0,10);o.prototype.initMatrixAxis=function(){this._points.add({pixelSize:10,position:c,color:Freedo.Color.GREEN});this._labels.add({position:f,text:"X"});this._labels.add({position:h,text:"Y"});this._labels.add({position:p,text:"Z"});this._polylines.add({positions:[c,f],width:5,material:Freedo.Material.fromType("PolylineArrow",{color:Freedo.Color.RED})});this._polylines.add({positions:[c,h],width:5,material:Freedo.Material.fromType("PolylineArrow",{color:Freedo.Color.YELLOW})});this._polylines.add({positions:[c,p],width:5,material:Freedo.Material.fromType("PolylineArrow",{color:Freedo.Color.BLUE})});this._initedAxis=true};o.prototype.onLeftClick=function(e){if(this._pickPosition)this._axisPosition=this._viewer.scene.pickPosition(e.position);if(!this._pickNode)return;var t=this._viewer.scene.pick(e.position);if(!t)return;var r=t.node;if(r instanceof Freedo.ModelNode){console.log(t);this.setNode(r);if(t.primitive instanceof Freedo.Model)this._model=t.primitive;this.updateNodeMatrixAxis()}};o.prototype.destroy=function(){this._removeCallback();if(!this._model.isDestroyed()){this._viewer.scene.primitives.remove(this._model)}};o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};r.FdModelTransform=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e){this._viewer3d=undefined;this._lastPrimitives=undefined;this._imageHeading=undefined;this._currentCameraHeading=undefined;this._cameraHeadingChanged=undefined;this._thumbImageUrl="";this._originImageUrl="";this._imageName="";this._validLat=90;this._radius=1e3;this._LonDist=3;this._LatDist=3;this._parentManager=undefined;this._sphere=new Freedo.BoundingSphere(Freedo.Cartesian3.ZERO,this._radius);this._arrowShow=true;this._arrowOutlinePrevFrame=undefined;this._arrowFillPrevFrame=undefined;this._arrowOutlineNextFrame=undefined;this._arrowFillNextFrame=undefined;this._arrowDimensions={length:this._radius*.1,width:this._radius*.06,rectLength:this._radius*.05,rectWidth:this._radius*.03,offset:this._radius*.01};this._arrowHeight=this._radius*-.05;this.init(e)}i.prototype.init=function(e){var t={globe:false,animation:false,baseLayerPicker:false,geocoder:false,homeButton:false,fullscreenButton:true,fullscreenElement:e,imageryProvider:false,infoBox:false,navigationHelpButton:false,scene3DOnly:true,sceneMode:Freedo.SceneMode.SCENE3D,sceneModePicker:false,selectionIndicator:false,timeline:false,shouldAnimate:false,skyBox:false,skyAtmosphere:false,sun:false,vrButton:false};this._viewer3d=new Freedo.Viewer(e,t);this._viewer3d.scene.screenSpaceCameraController.enableTilt=false;this._viewer3d.camera.percentageChanged=-.01;var d=this;this._viewer3d.camera.changed.addEventListener(function(e){var t=d._viewer3d.camera.position;if(Freedo.Cartesian3.magnitudeSquared(t)>=.999*d._radius*.999*d._radius){var r=d._viewer3d.camera.direction;var i=new Freedo.Cartesian3;i=Freedo.Cartesian3.multiplyByScalar(r,-1,i);var n=new Freedo.Ray(t,r);var a=new Freedo.Ray(t,i);var o=new Freedo.BoundingSphere(Freedo.Cartesian3.ZERO,.999*d._radius);var s=Freedo.IntersectionTests.raySphere(n,o);var l=Freedo.IntersectionTests.raySphere(a,o);if(Freedo.defined(s)&&!Freedo.defined(l)){Freedo.Ray.getPoint(n,s.start,t)}else if(Freedo.defined(l)&&!Freedo.defined(s)){Freedo.Ray.getPoint(a,l.start,t)}}var u=d.calculateCameraHeading();if(Math.abs(d._currentCameraHeading-u)>.5){d._currentCameraHeading=u;d.updateArrow();if(d._cameraHeadingChanged.numberOfListeners>0){d._cameraHeadingChanged.raiseEvent(d._currentCameraHeading)}}});this._cameraHeadingChanged=new Freedo.Event;var i=this._viewer3d.screenSpaceEventHandler.getInputAction(Freedo.ScreenSpaceEventType.LEFT_CLICK);var n={feature:undefined,originalColor:new Freedo.Cartesian4,highlightedColor:new Freedo.Cartesian4(0,255,255,255)};this._viewer3d.screenSpaceEventHandler.setInputAction(function e(t){if(Freedo.defined(n.feature)){var r=n.feature._batchTableAttributeIndices["color"];n.feature._batchTable.setBatchedAttribute(0,r,n.originalColor);d._arrowFillNextFrame.appearance.translucent=false;d._arrowFillPrevFrame.appearance.translucent=false;n.feature=undefined}var i=d._viewer3d.scene.pick(t.endPosition);if(!Freedo.defined(i)){return}if(i.primitive===d._arrowFillNextFrame){i.primitive=d._arrowOutlineNextFrame}else if(i.primitive===d._arrowFillPrevFrame){i.primitive=d._arrowOutlinePrevFrame}if(i.primitive!==d._arrowOutlineNextFrame&&i.primitive!==d._arrowOutlinePrevFrame){return}if(i.primitive!==n.feature){n.feature=i.primitive;var r=n.feature._batchTableAttributeIndices["color"];n.feature._batchTable.getBatchedAttribute(0,r,n.originalColor);n.feature._batchTable.setBatchedAttribute(0,r,n.highlightedColor);if(i.primitive===d._arrowOutlineNextFrame){d._arrowFillNextFrame.appearance.translucent=true}else if(i.primitive===d._arrowOutlinePrevFrame){d._arrowFillPrevFrame.appearance.translucent=true}d._viewer3d.scene.requestRender()}},Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._viewer3d.screenSpaceEventHandler.setInputAction(function e(t){if(!Freedo.defined(d._parentManager)){if(Freedo.defined(i)){i(t)}return}var r=d._viewer3d.scene.pick(t.position);if(!Freedo.defined(r)){if(Freedo.defined(i)){i(t)}return}if(r.primitive===d._arrowFillNextFrame){r.primitive=d._arrowOutlineNextFrame}else if(r.primitive===d._arrowFillPrevFrame){r.primitive=d._arrowOutlinePrevFrame}if(r.primitive===d._arrowOutlineNextFrame){d._parentManager.nextFrame()}else if(r.primitive===d._arrowOutlinePrevFrame){d._parentManager.prevFrame()}else{if(Freedo.defined(i)){i(t)}return}},Freedo.ScreenSpaceEventType.LEFT_CLICK)};i.prototype.createArrowGeometries=function(){if(!Freedo.defined(this._arrowFillPrevFrame)){var e=this._arrowDimensions;var t=[e.rectWidth*.5,e.offset+0,0,e.rectWidth*.5,e.offset+e.rectLength,0,e.width*.5,e.offset+e.rectLength,0,0,e.offset+e.length,0,-e.width*.5,e.offset+e.rectLength,0,-e.rectWidth*.5,e.offset+e.rectLength,0,-e.rectWidth*.5,e.offset+0,0];var r=[e.rectWidth*.5,-e.offset-0,0,e.rectWidth*.5,-e.offset-e.rectLength,0,e.width*.5,-e.offset-e.rectLength,0,0,-e.offset-e.length,0,-e.width*.5,-e.offset-e.rectLength,0,-e.rectWidth*.5,-e.offset-e.rectLength,0,-e.rectWidth*.5,-e.offset-0,0];var i=[6,0,1,6,1,5,2,3,4];var n=[1,0,6,5,1,6,4,3,2];var a=[0,1,1,2,2,3,3,4,4,5,5,6,6,0];var o=Math.max(e.length,e.width)*.5;var s=new Freedo.BoundingSphere(new Freedo.Cartesian3(0,o,0),o);var l=new Freedo.BoundingSphere(new Freedo.Cartesian3(0,-o,0),o);var u=new Freedo.Color(1,1,1,.5);var d=new Freedo.Color(.5,.5,.5,1);var c=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)})},indices:new Uint16Array(i),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:s});var f=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(r)})},indices:new Uint16Array(n),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:l});var h=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:c,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(u)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false,cull:false});var p=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:f,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(u)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false,cull:false});this._viewer3d.scene.primitives.add(h);this._viewer3d.scene.primitives.add(p);this._arrowFillNextFrame=h;this._arrowFillPrevFrame=p;var v=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)})},indices:new Uint16Array(a),primitiveType:Freedo.PrimitiveType.LINES,boundingSphere:s});var m=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(r)})},indices:new Uint16Array(a),primitiveType:Freedo.PrimitiveType.LINES,boundingSphere:l});var _=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:v,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(d)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false,cull:false});var y=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:m,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(d)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false,cull:false});this._viewer3d.scene.primitives.add(_);this._viewer3d.scene.primitives.add(y);this._arrowOutlineNextFrame=_;this._arrowOutlinePrevFrame=y}};var n=new Freedo.Cartesian3;var a=new Freedo.Matrix4;var o=new Freedo.Matrix3;i.prototype.updateArrow=function(){if(this._arrowShow===true){if(Freedo.defined(this._lastPrimitives)){this.createArrowGeometries();var e=Freedo.defaultValue(this._currentCameraHeading,0);e=parseInt((e+22.5)/45)*45;e=Freedo.Math.toRadians(90-e);n.x=this._radius*.3*Math.cos(e);n.y=this._radius*.3*Math.sin(e);n.z=this._arrowHeight;Freedo.Matrix3.fromRotationZ(Freedo.Math.toRadians(-this._imageHeading),o);Freedo.Matrix4.fromRotationTranslation(o,n,a);this._arrowFillNextFrame.modelMatrix=a;this._arrowOutlineNextFrame.modelMatrix=a;this._arrowFillPrevFrame.modelMatrix=a;this._arrowOutlinePrevFrame.modelMatrix=a;this._arrowFillNextFrame.show=true;this._arrowOutlineNextFrame.show=true;this._arrowFillPrevFrame.show=true;this._arrowOutlinePrevFrame.show=true}}else{this.destoryArrow()}};i.prototype.createPanoGeometry=function(e,t){var r=[];var i=[];var n=[];var a=0;var o=0;for(var s=-90-t;s<270-t+this._LonDist;s=s+this._LonDist){if(s>270-t)s=270-t;a=0;for(var l=-this._validLat;l<this._validLat+this._LatDist;l=l+this._LatDist){if(l>this._validLat)l=this._validLat;var u=(270-s-t)/360;var d=1-(this._validLat+l)/(2*this._validLat);n.push(u);n.push(d);var c=Freedo.Math.toRadians(s);var f=Freedo.Math.toRadians(l);var h=this._radius*Math.sin(f);var p=this._radius*Math.cos(f);var v=p*Math.cos(c);var m=p*Math.sin(c);r.push(v);r.push(m);r.push(h);v/=this._radius;m/=this._radius;h/=this._radius;i.push(-v);i.push(-m);i.push(-h);a++}o++}var _=[];for(var y=0;y<o-1;y++){for(var g=0;g<a-1;g++){_.push((y+0)*a+g+0);_.push((y+0)*a+g+1);_.push((y+1)*a+g+0);_.push((y+0)*a+g+1);_.push((y+1)*a+g+1);_.push((y+1)*a+g+0)}}var w=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(r)}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(i),normalize:true}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(n)})},indices:new Uint32Array(_),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:this._sphere});var F=new Freedo.Material({fabric:{type:"Image"}});F.uniforms.image=e;var b=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:w}),appearance:new Freedo.MaterialAppearance({material:F}),asynchronous:false,cull:false});return this._lastPrimitives.add(b)};i.prototype.createPoleGeometry=function(e){var t=[];var r=[];var i=0;var n=0;for(var a=-180;a<180+this._LonDist;a=a+this._LonDist){if(a>180)a=180;i=0;for(var o=-this._validLat;o>-90-this._LatDist;o=o-this._LatDist){if(o<-90)o=-90;var s=Freedo.Math.toRadians(a);var l=Freedo.Math.toRadians(o);var u=this._radius*Math.sin(l);var d=this._radius*Math.cos(l);var c=d*Math.cos(s);var f=d*Math.sin(s);t.push(c);t.push(f);t.push(u);c/=this._radius;f/=this._radius;u/=this._radius;r.push(-c);r.push(-f);r.push(-u);i++}n++}var h=[];for(var p=0;p<n-1;p++){for(var v=0;v<i-1;v++){h.push((p+0)*i+v+0);h.push((p+1)*i+v+1);h.push((p+0)*i+v+1);h.push((p+0)*i+v+0);h.push((p+1)*i+v+0);h.push((p+1)*i+v+1)}}var m=i*n;i=0;n=0;for(var a=-180;a<180+this._LonDist;a=a+this._LonDist){if(a>180)a=180;i=0;for(var o=this._validLat;o<90+this._LatDist;o=o+this._LatDist){if(o>90)o=90;var s=Freedo.Math.toRadians(a);var l=Freedo.Math.toRadians(o);var u=this._radius*Math.sin(l);var d=this._radius*Math.cos(l);var c=d*Math.cos(s);var f=d*Math.sin(s);t.push(c);t.push(f);t.push(u);c/=this._radius;f/=this._radius;u/=this._radius;r.push(c);r.push(f);r.push(u);i++}n++}for(var p=0;p<n-1;p++){for(var v=0;v<i-1;v++){h.push(m+(p+0)*i+v+0);h.push(m+(p+0)*i+v+1);h.push(m+(p+1)*i+v+0);h.push(m+(p+0)*i+v+1);h.push(m+(p+1)*i+v+1);h.push(m+(p+1)*i+v+0)}}var _=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(r),normalize:true})},indices:new Uint32Array(h),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:this._sphere});var y=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:_,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(new Freedo.Color(0,0,0,1))}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),asynchronous:false,cull:false});this._lastPrimitives.add(y)};var f=new Freedo.Cartesian3;var h=new Freedo.Cartesian3;i.prototype.loadPanorama=function(e,a,o){var s;var l;if(Freedo.isArray(e)){s=e[0];l=e[1]}else{s=e;l=e}var t=l.lastIndexOf("/");this._imageName=l.substr(t+1);var u=this;function d(e){var t=90-e;var r=Freedo.Math.toRadians(t);h.x=Math.cos(r);h.y=Math.sin(r);h.z=0;u._viewer3d.camera.direction=h;u._viewer3d.camera.up.x=0;u._viewer3d.camera.up.y=0;u._viewer3d.camera.up.z=1;Freedo.Cartesian3.cross(u._viewer3d.camera.direction,u._viewer3d.camera.up,u._viewer3d.camera.right);f.x=0;f.y=0;f.z=.01;u._viewer3d.camera.position=f;u._currentCameraHeading=e;u._thumbImageUrl=s;u._originImageUrl=l;if(u._cameraHeadingChanged.numberOfListeners>0){u._cameraHeadingChanged.raiseEvent(u._currentCameraHeading)}u.updateArrow();u._viewer3d.scene.requestRender()}function c(i){var n=new Image;n.crossOrigin="anonymous";n.onload=function(){var e=n.src.lastIndexOf("/");var t=n.src.substr(e+1);if(t===u._imageName){var r=undefined;try{r=new Freedo.Texture({context:u._viewer3d.scene.context,width:n.width,height:n.height,source:n,flipY:false});u.unloadPanorama();if(u._lastPrimitives===undefined){u._lastPrimitives=new Freedo.PrimitiveCollection;u._viewer3d.scene.primitives.add(u._lastPrimitives)}u.createPanoGeometry(r,a);if(u._validLat>0&&u._validLat<90){u.createPoleGeometry(a)}if(i){u._imageHeading=a;d(o);if(l!==s){setTimeout(function(){var e=l.lastIndexOf("/");var t=l.substr(e+1);if(t===u._imageName)c(false)},2e3)}}else{u.updateArrow();u._viewer3d.scene.requestRender()}}catch(e){if(Freedo.defined(r)){r.destroy()}}}};if(i)n.src=s;else n.src=l}if(this._thumbImageUrl!==s){c(true)}else{d(o)}};i.prototype.unloadPanorama=function(){if(Freedo.defined(this._lastPrimitives)){this._viewer3d.scene.primitives.remove(this._lastPrimitives);this._lastPrimitives=undefined}if(Freedo.defined(this._arrowFillNextFrame)){this._arrowFillNextFrame.show=false}if(Freedo.defined(this._arrowFillPrevFrame)){this._arrowFillPrevFrame.show=false}if(Freedo.defined(this._arrowOutlineNextFrame)){this._arrowOutlineNextFrame.show=false}if(Freedo.defined(this._arrowOutlinePrevFrame)){this._arrowOutlinePrevFrame.show=false}this._thumbImageUrl="";this._originImageUrl=""};i.prototype.destoryArrow=function(){if(Freedo.defined(this._arrowFillNextFrame)){this._viewer3d.scene.primitives.remove(this._arrowFillNextFrame);this._arrowFillNextFrame=undefined}if(Freedo.defined(this._arrowFillPrevFrame)){this._viewer3d.scene.primitives.remove(this._arrowFillPrevFrame);this._arrowFillPrevFrame=undefined}if(Freedo.defined(this._arrowOutlineNextFrame)){this._viewer3d.scene.primitives.remove(this._arrowOutlineNextFrame);this._arrowOutlineNextFrame=undefined}if(Freedo.defined(this._arrowOutlinePrevFrame)){this._viewer3d.scene.primitives.remove(this._arrowOutlinePrevFrame);this._arrowOutlinePrevFrame=undefined}};i.prototype.destroy=function(){if(Freedo.defined(this._lastPrimitives)){this._viewer3d.scene.primitives.remove(this._lastPrimitives);this._lastPrimitives=undefined}this.destoryArrow();if(Freedo.defined(this._viewer3d)){this._viewer3d.destroy();this._viewer3d=undefined}};var s=new Freedo.Cartesian3;i.prototype.calculateCameraHeading=function(){var e=Freedo.Cartesian3.multiplyByScalar(this._viewer3d.camera.direction,this._radius,s);e.z=0;var t=Math.atan2(e.y,e.x);var r=90-Freedo.Math.toDegrees(t);if(r<0)r+=360;else if(r>360)r-=360;return r};Freedo.defineProperties(i.prototype,{arrowShow:{get:function e(){return Freedo.defaultValue(this._arrowShow,true)},set:function e(t){this._arrowShow=t;this.updateArrow()}}});t.FdPanoramaViewer=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var p=1e-5;var v=2e-4;function m(e,t){this._globeViewer=e;this._panoViewer=t;this._panoViewer._parentManager=this;this._currentDataSource=undefined;this._currentRoute=undefined;this._currentFrame=-1;this._currentCameraHeading=0;this._showIndicator=true;this._dataSources=[];this._modelManager=new Freedo.FdModel.FdModelManager(e);if(Freedo.defined(this._panoViewer)){var r=this;this._panoViewer._cameraHeadingChanged.addEventListener(function(e){r._currentCameraHeading=e;var t=r.getCurrentFrame();if(Freedo.defined(t)){r.drawCameraOnGlobe(t.Longitude,t.Latitude,parseFloat(t.H),e)}})}}m.prototype.addDataSource=function(e){for(var t=0;t<this._dataSources.length;t++){if(this._dataSources[t].panorama===e){return false}}e.initial();var r=undefined;if(Freedo.defined(this._globeViewer)){this._modelManager.add("GeoJson",{jsonURL:e.getTrackGeoJsonUrl(),clampToGround:true,lineColor:[255,255,255,.7],lineWidth:3})}var i={panorama:e,tracklines:r};this._dataSources.push(i)};m.prototype.removeDataSource=function(e){if(this._currentDataSource===e){this._currentFrame=-1;this._currentRoute=undefined;this._currentDataSource=undefined}for(var t=0;t<this._dataSources.length;t++){if(this._dataSources[t].panorama===e){var r=this._dataSources[t].tracklines;if(Freedo.defined(this._globeViewer)&&Freedo.defined(r)){this._globeViewer.dataSources.remove(r)}this._dataSources.splice(t,1);break}}};m.prototype.zoomtoDataSource=function(e){if(!Freedo.defined(this._globeViewer)){return}for(var t=0;t<this._dataSources.length;t++){if(this._dataSources[t].panorama===e){if(Freedo.defined(this._dataSources[t].tracklines)){this._globeViewer.zoomTo(this._dataSources[t].tracklines)}break}}};m.prototype.locate=function(d,c){var e=this.locateOnCurrentRoute(d,c);if(Freedo.defined(e)){this._currentFrame=e.index;var t=this._currentDataSource.getImageUrl(e.point.ImageName);var r=Freedo.Math.toDegrees(e.point.Heading);if(Freedo.defined(this._panoViewer)){this._panoViewer.loadPanorama(t,r,r)}return}var i=[];var f=[];for(var n=0;n<this._dataSources.length;n++){var a=this._dataSources[n].panorama;var o=a.requestGrid(d,c);if(Freedo.defined(o)){i.push(o.then(function(e){f.push({panorama:a,grid:e})}))}}if(i.length===0){if(Freedo.defined(this._panoViewer)){this._panoViewer.unloadPanorama()}this._currentDataSource=undefined;this._currentRoute=undefined;this._currentFrame=-1;return}var h=this;Freedo.when.all(i).then(function(){var r=undefined;var i=undefined;var e=undefined;for(var t=0;t<f.length;t++){var n=f[t].panorama;var a=f[t].grid;var o=m.findNearestPoint(d,c,a.points,p,v);if(Freedo.defined(o)){if(!Freedo.defined(i)||e>o.distance){i=o.point;e=o.distance;r=n}}}if(Freedo.defined(i)){var s=r.getImageUrl(i.ImageName);var l=Freedo.Math.toDegrees(i.Heading);if(Freedo.defined(h._panoViewer)){h._panoViewer.loadPanorama(s,l,l)}h._currentDataSource=undefined;h._currentRoute=undefined;h._currentFrame=-1;var u=i.RouteID;Freedo.when(r.requestRoute(u)).then(function(e){h._currentDataSource=r;h._currentRoute=e.points;h._currentFrame=m.findPoint(i.ImageName,h._currentRoute);var t=h._currentRoute[h._currentFrame].H;if(Freedo.defined(h._currentFrame)){h.drawCameraOnGlobe(i.Longitude,i.Latitude,parseFloat(t),Freedo.defined(h._currentCameraHeading)?h._currentCameraHeading:parseFloat(h._currentFrame.Heading))}}).otherwise(function(e){})}else{if(Freedo.defined(h._panoViewer)){h._panoViewer.unloadPanorama()}h._currentDataSource=undefined;h._currentRoute=undefined;h._currentFrame=-1}})};m.prototype.nextFrame=function(){if(Freedo.defined(this._currentDataSource)&&Freedo.defined(this._currentRoute)&&this._currentFrame>=0){if(this._currentFrame+1<this._currentRoute.length){var e=this._currentRoute[++this._currentFrame];if(Freedo.defined(this._panoViewer)){var t=this._panoViewer._currentCameraHeading;var r=this._currentDataSource.getImageUrl(e.ImageName);var i=Freedo.Math.toDegrees(e.Heading);this._panoViewer.loadPanorama(r,i,t)}}}};m.prototype.prevFrame=function(){if(Freedo.defined(this._currentDataSource)&&Freedo.defined(this._currentRoute)&&this._currentFrame>=0){if(this._currentFrame>0){var e=this._currentRoute[--this._currentFrame];if(Freedo.defined(this._panoViewer)){var t=this._panoViewer._currentCameraHeading;var r=this._currentDataSource.getImageUrl(e.ImageName);var i=Freedo.Math.toDegrees(e.Heading);this._panoViewer.loadPanorama(r,i,t)}}}};m.prototype.getCurrentFrame=function(){if(Freedo.defined(this._currentRoute)&&this._currentFrame>=0){if(this._currentFrame>=0){var e=this._currentRoute[this._currentFrame];return e}}return undefined};m.prototype.setIndicatorShow=function(e){this._showIndicator=!!e};var l=new Freedo.Cartographic;m.prototype.drawCameraOnGlobe=function(e,t,r,i){e=parseFloat(e),t=parseFloat(t);if(Freedo.defined(this._globeViewer)){if(Freedo.defined(e)&&Freedo.defined(t)&&Freedo.defined(i)&&this._showIndicator){if(!this._indicatorPrimitive){this._indicatorPrimitive=this._globeViewer.scene.primitives.add(m.buildIndicator())}Freedo.Cartographic.fromDegrees(e,t,0,l);var n=this._globeViewer.scene.globe.getHeight(l);var a=Freedo.Cartesian3.fromDegrees(e,t,n);var o=Freedo.Transforms.eastNorthUpToFixedFrame(a);var s=Freedo.Matrix3.fromHeadingPitchRoll(new Freedo.HeadingPitchRoll(Freedo.Math.toRadians(i%360)));Freedo.Matrix4.multiplyByMatrix3(o,s,o);this._indicatorPrimitive.modelMatrix=o;this._globeViewer.scene.requestRender()}else{}}};m.buildIndicator=function(){var e=Freedo.FdModel.FdLoft.buildCirclePts(Freedo.Cartesian3.ZERO,2,Freedo.Cartesian3.UNIT_Z);e.push(e[0]);var t=Freedo.FdModel.FdLoft.buildCirclePts(Freedo.Cartesian3.ZERO,50,Freedo.Cartesian3.UNIT_Z).slice(12,23);function r(e,t){e.splice(0,0,Freedo.Cartesian3.ZERO);var r=[];for(var i=1;i<e.length;i++){if(i+1===e.length)continue;r.push(0,i,i+1===e.length?1:i+1)}var n=Freedo.FdModel.FdLoft.buildGeometry({positions:e.reduce(function(e,t){e.push(t.x,t.y,t.z);return e},[]),idx:r,primitiveType:Freedo.PrimitiveType.TRIANGLES});return new Freedo.GeometryInstance({geometry:n,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(t),depthFailColor:Freedo.ColorGeometryInstanceAttribute.fromColor(t)}})}return new Freedo.Primitive({geometryInstances:[r(e,Freedo.Color.RED.withAlpha(.4)),r(t,Freedo.Color.WHITE.withAlpha(.4))],appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({depthTest:{enabled:false,func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false})};m.findNearestPoint=function(e,t,r,i,n){var a=undefined;var o=undefined;var s=-1;var l=i*i;var u=n*n;for(var d=0;d<r.length;d++){var c=r[d];var f=Math.abs(e-c.Longitude);var h=Math.abs(t-c.Latitude);var p=f*f+h*h;if(p<=l){return{point:c,distance:Math.sqrt(p),index:d}}else if(p<=u){if(!Freedo.defined(a)||p<o){a=c;o=p;s=d}}}if(Freedo.defined(a)){return{point:a,distance:Math.sqrt(o),index:s}}else{return undefined}};m.findPoint=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];if(i.ImageName===e){return r}}return-1};m.prototype.locateOnCurrentRoute=function(e,t){if(Freedo.defined(this._currentDataSource)&&Freedo.defined(this._currentRoute)&&this._currentFrame>=0){if(e>=this._currentDataSource._bbox.left&&e<=this._currentDataSource._bbox.right&&t>=this._currentDataSource._bbox.bottom&&t<=this._currentDataSource._bbox.top){var r=m.findNearestPoint(e,t,this._currentRoute,p,v/2);if(Freedo.defined(r)){return r}}}return undefined};t.FdPanoramaManager=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPanoramaDataSource=undefined;var i=r(35);var o=n(i);function n(e){return e&&e.__esModule?e:{default:e}}function a(e){this._url=e;this._initialised=false;this._bbox=undefined;this._gridSize=undefined;this._grids=undefined}a.prototype.initial=function(){if(this._initialised==false){var a=this;var e=this._url+"/meta.json";Freedo.when(Freedo.Resource.fetchJson(e)).then(function(e){var t=e.bbox.split(",");var r=e.grid_size.split(",");a._bbox={left:parseFloat(t[0]),bottom:parseFloat(t[1]),right:parseFloat(t[2]),top:parseFloat(t[3])};a._gridSize={x:parseFloat(r[0]),y:parseFloat(r[1])};var i=e.grids;if(Freedo.defined(i)&&i.length>0){a._grids=new o.default;for(var n=0;n<i.length;n++){a._grids.set(i[n],n)}}a._initialised=true}).otherwise(function(e){a._initialised=false})}};a.prototype.isInitialised=function(){return this.isInitialised};a.prototype.getTrackGeoJsonUrl=function(){return this._url+"/TrackLines.geojson"};a.prototype.getImageUrl=function(e){var t=[];t.push(this._url+"/Images/Thumb/"+e);t.push(this._url+"/Images/Origin/"+e);return t};a.prototype.requestGrid=function(e,t){if(this._initialised===true){if(e>=this._bbox.left&&e<=this._bbox.right&&t>=this._bbox.bottom&&t<=this._bbox.top){var r=function e(t,r){return(Array(r).join("0")+t).slice(-r)};var i=parseInt((e-this._bbox.left)/this._gridSize.x);var n=parseInt((t-this._bbox.bottom)/this._gridSize.y);var a=r(n,6)+"_"+r(i,6);if(Freedo.defined(this._grids)&&this._grids.has(a)){var o=this._url+"/Grids/"+a+".json";return Freedo.Resource.fetchJson(o)}}}return undefined};a.prototype.requestRoute=function(e){if(this._initialised===true){var t=this._url+"/Routes/"+e+".json";return Freedo.Resource.fetchJson(t)}return undefined};t.FdPanoramaDataSource=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMultiViewSync=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t,r,i){(0,n.default)(this,e);this._title=i;this._viewer=r;this._gView=t;this._bInRun=false;this._bUnLink=false;this._lastVT=1;this._lastV=""};o.prototype.on=function(e,t){this._event[e]=this._event[e]||[];this._event[e].push(t)};o.prototype.run=function(){if(this._bInRun)return;else this._bInRun=true;this.addLsnr()};o.prototype.onPostRender=function(){var e=this.getV();if(e!=this._lastV){this._lastV=e;this._lastVT=(new Date).getTime()}if(!this._bUnLink){this.syncView()}};o.prototype.getV=function(){var e=this._viewer.camera.position;var t=this._viewer.camera.heading;var r=this._viewer.camera.pitch;var i=this._viewer.camera.roll;var n=""+Freedo.FdMisc.FdMath.round(e.x,4)+", "+Freedo.FdMisc.FdMath.round(e.y,4)+", "+Freedo.FdMisc.FdMath.round(e.z,4)+", "+Freedo.FdMisc.FdMath.round(Freedo.Math.toDegrees(t),4)+", "+Freedo.FdMisc.FdMath.round(Freedo.Math.toDegrees(r),4)+", "+Freedo.FdMisc.FdMath.round(Freedo.Math.toDegrees(i),4);return n};o.prototype.syncView=function(){if(this._bUnLink)return;var e=this.getV();if(this._gView.v!=e){if(this._gView.t>this._lastVT){if(this._gView.o!=this._title){var t=this._gView.v.split(",");this.setView(t[0],t[1],t[2],t[3],t[4],t[5]);this._lastV=this._gView.v;this._lastVT=this._gView.t-10}}else{this._gView.t=this._lastVT;this._gView.v=e;this._gView.o=this._title}}this._viewer.scene.requestRender()};o.prototype.setView=function(e,t,r,i,n,a){this._viewer.camera.setView({destination:new Freedo.Cartesian3(parseFloat(e),parseFloat(t),parseFloat(r)),orientation:{heading:Freedo.Math.toRadians(parseFloat(i)),pitch:Freedo.Math.toRadians(parseFloat(n)),roll:Freedo.Math.toRadians(parseFloat(a))}})};o.prototype.enableLink=function(e){this._bUnLink=e};o.prototype.addLsnr=function(){this._viewer.scene._postRender.addEventListener(this.onPostRender.bind(this),null)};o.prototype.dispose=function(){};o.prototype.reset=function(){};t.FdMultiViewSync=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMapboxProvider=undefined;var i=r(49);var n=f(i);var a=r(1);var o=f(a);var s=r(2);var l=f(s);var u=r(120);var d=r(689);var c=f(d);function f(e){return e&&e.__esModule?e:{default:e}}var h=function(){function t(e){var r=this;(0,o.default)(this,t);this._url=e.url;this._vectorUrl=e.vectorUrl;this._viewer=e.viewer;this._tileWidth=Freedo.defaultValue(e.tileWidth,512);this._tileHeight=Freedo.defaultValue(e.tileHeight,512);this._maximumLevel=Freedo.defaultValue(e.maximumLevel,21);this._minimumLevel=Freedo.defaultValue(e.minimumLevel,0);this._pickFeaturesUrl=Freedo.defaultValue(e.pickFeaturesUrl);this._urlSchemeZeroPadding=Freedo.defaultValue(e.urlSchemeZeroPadding);this._subdomains=Freedo.defaultValue(e.subdomains);this._credit=Freedo.defaultValue(e.credit);this._hasAlphaChannel=Freedo.defaultValue(e.hasAlphaChannel,true);this._vectorLayers=e.vectorLayers;this._enablePickFeatures=Freedo.defaultValue(e.enablePickFeatures,true);this._customTags=Freedo.defaultValue(e.customTags);this._proxy=Freedo.defaultValue(e.proxy);this._token=e.token;this._vectorToken=e.vectorToken;if(this._token&&this._url.indexOf("access_token")<0){this._url=this._url+("?access_token="+this._token)}if(this._vectorToken&&this._vectorUrl.indexOf("access_token")<0){this._vectorUrl=this._vectorUrl+("?access_token="+this._vectorToken)}this._tilingScheme=new Freedo.WebMercatorTilingScheme;this._rectangle=this._tilingScheme.rectangle;this._ready=true;this._readyPromise=new n.default(function(e,t){e(r)});this._errorEvent=new Freedo.Event;this._loadedLayers=[];this._cachedGeometrySize=Freedo.defaultValue(e.cachedGeometrySize,3e3);this._color=Freedo.defaultValue(e.color,Freedo.Color.fromAlpha(Freedo.Color.CHARTREUSE,.1));this._buildingPrimitive=this._viewer&&this._viewer.scene.primitives.add(new u.FdChangeablePrimitive({appearance:new Freedo.MaterialAppearance({material:Freedo.Material.fromType("Color",{color:this._color})}),geometryInstances:[]}));this._showVectorGeometry=Freedo.defaultValue(e.showVectorGeometry,false);this._worker=new c.default;this.sendTask({method:"setAttr",args:[{urlTemplate:this._vectorUrl,vectorLayers:this._vectorLayers,maximumLevel:this.maximumLevel,minimumLevel:this.minimumLevel}]});this.receiveTask("requestTileGeo",function(e){if(!e)return;r._buildingPrimitive.setAttribute("geometryInstances",e);r._viewer.scene.requestRender()})}(0,l.default)(t,[{key:"getTileCredits",value:function e(){return this._credit}},{key:"requestImage",value:function e(t,r,i){if(this._showVectorGeometry){this.sendTask({method:"requestTileGeo",args:[t,r,i]})}return Freedo.ImageryProvider.loadImage(this,this.url.replace("{x}",t).replace("{y}",r).replace("{z}",i))}},{key:"setVectorGeometryShow",value:function e(t,r){this._showVectorGeometry=!!t;this._viewer=r;this._buildingPrimitive=this._viewer.scene.primitives.add(new u.FdChangeablePrimitive({appearance:new Freedo.MaterialAppearance({material:Freedo.Material.fromType("Color",{color:this._color})}),geometryInstances:[]}))}},{key:"sendTask",value:function e(t){this._worker.postMessage(t)}},{key:"receiveTask",value:function e(r,i){this._worker.addEventListener("message",function(e){var t=e.data;if(t.method===r)i(t.result)})}},{key:"url",get:function e(){return this._url}},{key:"tileWidth",get:function e(){return this._tileWidth}},{key:"tileHeight",get:function e(){return this._tileHeight}},{key:"maximumLevel",get:function e(){return this._maximumLevel}},{key:"minimumLevel",get:function e(){return this._minimumLevel}},{key:"pickFeaturesUrl",get:function e(){return this._pickFeaturesUrl}},{key:"urlSchemeZeroPadding",get:function e(){return this._urlSchemeZeroPadding}},{key:"subdomains",get:function e(){return this._subdomains}},{key:"credit",get:function e(){return this._credit}},{key:"hasAlphaChannel",get:function e(){return this._hasAlphaChannel}},{key:"enablePickFeatures",get:function e(){return this._enablePickFeatures}},{key:"customTags",get:function e(){return this._customTags}},{key:"proxy",get:function e(){return this._proxy}},{key:"tilingScheme",get:function e(){return this._tilingScheme}},{key:"rectangle",get:function e(){return this._rectangle}},{key:"ready",get:function e(){return this._ready}},{key:"token",get:function e(){return this._token}},{key:"readyPromise",get:function e(){return this._readyPromise}},{key:"layers",get:function e(){}},{key:"tileDiscardPolicy",get:function e(){}},{key:"errorEvent",get:function e(){return this._errorEvent}},{key:"usingPrecachedTiles",get:function e(){return this._useTiles}}]);return t}();t.FdMapboxProvider=h},function(e,t,r){e.exports=function(){return r(690)('(function(t){var n={};function o(e){if(n[e]){return n[e].exports}var r=n[e]={i:e,l:false,exports:{}};t[e].call(r.exports,r,r.exports,o);r.l=true;return r.exports}o.m=t;o.c=n;o.d=function(e,r,t){if(!o.o(e,r)){Object.defineProperty(e,r,{enumerable:true,get:t})}};o.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};o.t=function(r,e){if(e&1)r=o(r);if(e&8)return r;if(e&4&&typeof r==="object"&&r&&r.__esModule)return r;var t=Object.create(null);o.r(t);Object.defineProperty(t,"default",{enumerable:true,value:r});if(e&2&&typeof r!="string")for(var n in r)o.d(t,n,function(e){return r[e]}.bind(null,n));return t};o.n=function(r){var e=r&&r.__esModule?function e(){return r["default"]}:function e(){return r};o.d(e,"a",e);return e};o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)};o.p="";return o(o.s=0)})([function(e,r,t){e.exports=function(){return new Worker(t.p+"FreedoX/Workers/ParseTileGeo.worker.js")}}]);',r.p+"4100f5b488aa6e1adf38.worker.js")}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(t,r){try{try{var i;try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;i=new e;i.append(t);i=i.getBlob()}catch(e){i=new Blob([t])}return new Worker(n.createObjectURL(i))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(e){if(!r){throw Error("Inline worker is not supported")}return new Worker(r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCameraManager=undefined;var i=r(1);var n=a(i);function a(e){return e&&e.__esModule?e:{default:e}}var o=function e(t){(0,n.default)(this,e);this._camera=t.camera;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._cameraInfo=undefined;this._initCameraInfo=Freedo.FdCamera.getCurrentCameraInfo(this._camera)};o.prototype.getCurrentCameraInfo=function(){return Freedo.FdCamera.getCurrentCameraInfo(this._camera)};o.prototype.saveCurrentCameraInfo=function(){this._cameraInfo=this.getCurrentCameraInfo();this._event.raiseEvent("DataChanged",this)};o.prototype.goToByCameraInfo=function(e){if(e){var t=e.trim().replace("[","").replace("]","").split(",").map(function(e){return parseFloat(e)});Freedo.FdCamera.goToByCameraInfo(this._camera,t)}else Freedo.FdCamera.goToByCameraInfo(this._camera,this._cameraInfo)};o.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};o.prototype.getData=function(){return Freedo.clone(this._cameraInfo,true)};o.prototype.getDataPropName=function(){return"camera"};o.prototype.setData=function(e){var t=this;if(!Freedo.defined(e))return;this._cameraInfo=e;console.info("5秒后自动恢复项目默认视角");setTimeout(function(){t.goToByCameraInfo()},5*1e3)};o.prototype.reset=function(){this._cameraInfo=undefined;Freedo.FdCamera.goToByCameraInfo(this._camera,this._initCameraInfo)};t.FdCameraManager=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdVideo=undefined;var i=r(84);var n=a(i);var u=r(82);function a(e){return e&&e.__esModule?e:{default:e}}function h(e,n,t,r){this._surfacePrimitive=undefined;this._outlinePrimitive=undefined;this._primitives=undefined;this._viewer=n;this._videoUrl=e;this._videoElement=h.createVideoElement(e);this._materialProperty=new Freedo.ImageMaterialProperty;this._materialProperty.image=this._videoElement;this._material=undefined;var d=this;this._viewer.scene.preUpdate.addEventListener(function(e,t){if(Freedo.defined(d._surfacePrimitive)){d._material=Freedo.MaterialProperty.getValue(t,d._materialProperty,d._material);d._surfacePrimitive.appearance.material=d._material;var r={u_bias:function e(){return d.depthBias}};d._material._uniforms=Freedo.combine(d._material._uniforms,r);d._viewer.scene.requestRender()}});this._options=Freedo.clone(t,true);this._bounds=Freedo.defaultValue(r,[]);if(this._bounds.length===0){this.createByParams()}else{this.createByBounds()}this._editStatus=0;function a(e,t){e.scene.screenSpaceCameraController.enableInputs=t;e.scene.screenSpaceCameraController.enableRotate=t;e.scene.screenSpaceCameraController.enableTranslate=t;e.scene.screenSpaceCameraController.enableZoom=t;e.scene.screenSpaceCameraController.enableTilt=t;e.scene.screenSpaceCameraController.enableLook=t}var d=this;this._dragable=false;this._selected=undefined;this._movingPointPrimitive=undefined;var i=new Freedo.ScreenSpaceEventHandler(n.scene.canvas);i.setInputAction(function(e){if(d._editStatus===1){var t=d.reproject(e.position.x,e.position.y);if(Freedo.defined(t)){d._destroyPointGraph();d.addPoint(e.position.x,e.position.y)}}else if(d._editStatus===2){var r=d.snap(e.position.x,e.position.y);if(Freedo.defined(r)){d._dragable=true;d._selected=r;var t=r.position;d._clearPointGraph();d._clearLineGraph();d._drawPoint(t,8,Freedo.Color.RED);a(n,false)}}else if(d._editStatus===3){var r=d.snap(e.position.x,e.position.y);if(Freedo.defined(r)){if(!Freedo.defined(d._selected)){d._selected=r;var t=r.position;d._clearPointGraph();d._clearLineGraph();d._drawPoint(t,8,Freedo.Color.RED)}else{var i=d._sameBound(d._selected.boundIndex,d._selected.pointIndex,r.boundIndex,r.pointIndex);if(Freedo.defined(i)){d._destroyPointGraph();d._destroyLineGraph();d.clip(i.boundIndex,i.pointIndex0,i.pointIndex1);d._selected=undefined}}}}else if(d._editStatus===4){var r=d.snap(e.position.x,e.position.y);if(Freedo.defined(r)){d._selected=r;var t=r.position;d._clearPointGraph();d._drawPoint(t,8,Freedo.Color.RED);a(n,false)}}},Freedo.ScreenSpaceEventType.LEFT_DOWN);var o=new Freedo.ScreenSpaceEventHandler(n.scene.canvas);o.setInputAction(function(e){if(d._editStatus===2){var t=d.pickGlobe(e.position);if(Freedo.defined(t)){d._destroyPointGraph();d._destroyLineGraph();if(Freedo.defined(d._selected)){d.movePoint(d._selected.boundIndex,d._selected.pointIndex,t);d._selected=undefined}}}a(n,true);d._dragable=false},Freedo.ScreenSpaceEventType.LEFT_UP);var s=new Freedo.ScreenSpaceEventHandler(n.scene.canvas);s.setInputAction(function(e){if(d._editStatus!==0){var t=e.endPosition;if(d._editStatus===1){var r=d.reproject(t.x,t.y);if(Freedo.defined(r)){d._clearPointGraph();d._drawPoint(r,8,Freedo.Color.RED)}}else if(d._editStatus===2){if(d._dragable&&Freedo.defined(d._selected)){var i=d._viewer.scene.pickTranslucentDepth;d._viewer.scene.pickTranslucentDepth=false;var r=d._viewer.scene.pickPosition(t);d._viewer.scene.pickTranslucentDepth=i;if(Freedo.defined(r)){d._clearPointGraph();d._clearLineGraph();d._drawPoint(r,8,Freedo.Color.RED);var n=[];var a=0,o=0;var s=d._bounds[d._selected.boundIndex];var l=d._selected.pointIndex;if(l===0){a=s.length-1;o=1}else if(l===s.length-1){a=s.length-2;o=0}else{a=l-1;o=l+1}n.push(s[a].position);n.push(r);n.push(s[o].position);d._drawLine(n,1,Freedo.Color.YELLOW)}}else if(d._dragable===false&&!Freedo.defined(d._selected)){var u=d.snap(t.x,t.y);var r=Freedo.defined(u)?u.position:undefined;d._redrawMovingPoint(r,8,Freedo.Color.RED)}}else if(d._editStatus===3){if(Freedo.defined(d._selected)){var i=d._viewer.scene.pickTranslucentDepth;d._viewer.scene.pickTranslucentDepth=false;var r=d._viewer.scene.pickPosition(t);d._viewer.scene.pickTranslucentDepth=i;if(Freedo.defined(r)){d._clearLineGraph();var n=[];n.push(d._selected.position);n.push(r);d._drawLine(n,1,Freedo.Color.YELLOW)}}var u=d.snap(t.x,t.y);var r=Freedo.defined(u)?u.position:undefined;d._redrawMovingPoint(r,8,Freedo.Color.RED)}else if(d._editStatus===4){if(!Freedo.defined(d._selected)){var u=d.snap(t.x,t.y);var r=Freedo.defined(u)?u.position:undefined;d._redrawMovingPoint(r,8,Freedo.Color.RED)}}}},Freedo.ScreenSpaceEventType.MOUSE_MOVE);var l=new u.FdKeyboard(n);l.on(function(e,t){if(e==="timer"){if(t.metaData[46]){if(d._editStatus===4&&Freedo.defined(d._selected)){d._destroyPointGraph();d.removePoint(d._selected.boundIndex,d._selected.pointIndex);d._selected=undefined}}}});l.enable()}Freedo.defineProperties(h.prototype,{depthBias:{get:function e(){return Freedo.defaultValue(this._options.depthBias,0)},set:function e(t){this._options.depthBias=t}}});var s=new Freedo.Ray;h.prototype.pickGlobe=function(e,t){var r=this._viewer.scene;var i=r.camera;var n=i.getPickRay(e,s);var a=r.pickTranslucentDepth;r.pickTranslucentDepth=false;var t=r.pickFromRay(n);r.pickTranslucentDepth=a;if(Freedo.defined(t)){var o=t.position;return Freedo.Cartesian3.clone(o,t)}return undefined};h.prototype._drawPoint=function(e,t,r){if(!Freedo.defined(this._points)){this._points=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);this._points.allowPicking=false}this._viewer.scene.requestRender();return this._points.add({show:true,position:e,pixelSize:t,color:r,outlineColor:Freedo.Color.BLUE,outlineWidth:1})};h.prototype._redrawMovingPoint=function(e,t,r){if(Freedo.defined(e)){if(Freedo.defined(this._movingPointPrimitive)){this._movingPointPrimitive.position=e;this._movingPointPrimitive.pixelSize=t;this._movingPointPrimitive.color=r}else{this._movingPointPrimitive=this._drawPoint(e,t,r)}this._viewer.scene.requestRender()}else{if(Freedo.defined(this._points)){if(Freedo.defined(this._movingPointPrimitive)){this._points.remove(this._movingPointPrimitive);this._viewer.scene.requestRender()}}this._movingPointPrimitive=undefined}};h.prototype._drawLine=function(e,t,r){if(!Freedo.defined(this._polylines)){this._polylines=this._viewer.scene.primitives.add(new Freedo.PrimitiveCollection)}var i=undefined;if(Freedo.defined(Freedo.ArcType)){i=Freedo.ArcType.RHUMB}var n=new Freedo.PolylineGeometry({positions:e,width:t,followSurface:false,arcType:i});var a=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:n,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)}}),appearance:new Freedo.PolylineColorAppearance({renderState:new Freedo.RenderState({depthTest:{enabled:false}})}),asynchronous:false,allowPicking:false});this._viewer.scene.requestRender();return this._polylines.add(a)};h.prototype._clearPointGraph=function(){if(Freedo.defined(this._points)){this._points.removeAll();this._movingPointPrimitive=undefined;this._viewer.scene.requestRender()}};h.prototype._destroyPointGraph=function(){if(Freedo.defined(this._points)){this._viewer.scene.primitives.remove(this._points);this._movingPointPrimitive=undefined;this._points=undefined;this._viewer.scene.requestRender()}};h.prototype._clearLineGraph=function(){if(Freedo.defined(this._polylines)){this._polylines.removeAll();this._viewer.scene.requestRender()}};h.prototype._destroyLineGraph=function(){if(Freedo.defined(this._polylines)){this._viewer.scene.primitives.remove(this._polylines);this._polylines=undefined;this._viewer.scene.requestRender()}};h.createVideoElement=function(e){var t=document.createElement("VIDEO");t.setAttribute("width","0px");t.setAttribute("height","0px");t.setAttribute("autoplay","true");t.setAttribute("loop","true");t.setAttribute("crossorigin","anonymous");t.setAttribute("controls","controls");t.setAttribute("src",e);document.body.appendChild(t);return t};h.prototype._create=function(e,t,r,i,n){this._primitives=new Freedo.PrimitiveCollection;this._viewer.scene.primitives.add(this._primitives);var a=new Freedo.Color(1,1,0,1);if(!Freedo.defined(this._material)){this._material=Freedo.Material.fromType("Color");this._material.uniforms.color=new Freedo.Color(0,0,0,1)}var o=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(e)}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(t)})},indices:new Uint16Array(r),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(e)});var s=new Freedo.MaterialAppearance({material:this._material,translucent:false,flat:true,faceForward:true});var l=Freedo.ShaderSource.replaceMain(s._vertexShaderSource,"czm_zbias_main");var u="uniform float u_bias; \n"+"void main() \n"+"{ \n"+"    czm_zbias_main(); \n"+"    gl_Position.z += u_bias * gl_Position.w; \n"+"}";s._vertexShaderSource=l+"\n"+u;var d=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:o}),appearance:s,modelMatrix:n,asynchronous:false,cull:true,allowPicking:false});var c=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(e)})},indices:new Uint16Array(i),primitiveType:Freedo.PrimitiveType.LINES,boundingSphere:Freedo.BoundingSphere.fromVertices(e)});var f=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:c,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(a),depthFailColor:Freedo.ColorGeometryInstanceAttribute.fromColor(a.withAlpha(.5))}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:false}),depthFailAppearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:true}),modelMatrix:n,asynchronous:false,allowPicking:false});this._surfacePrimitive=d;this._outlinePrimitive=f;this._primitives.add(this._surfacePrimitive);this._primitives.add(this._outlinePrimitive);this._viewer.scene.requestRender()};h.prototype.createByParams=function(){this.destroy();var e=this._options;var t=Freedo.defaultValue(e.fov,45);var r=Freedo.defaultValue(e.ratio,4/3);var i=Freedo.defaultValue(e.farClip,100);var n=Freedo.Math.toRadians(t);var a=2*i*Math.tan(n*.5);var o=a/r;var s=new Freedo.Cartesian3(-.5*a,i,.5*o);var l=new Freedo.Cartesian3(-.5*a,i,-.5*o);var u=new Freedo.Cartesian3(.5*a,i,.5*o);var d=new Freedo.Cartesian3(.5*a,i,-.5*o);var c=this._calWorldMatrix();var f=[];var h=[];var p=[];var v=[];f.push(s.x);f.push(s.y);f.push(s.z);h.push(0);h.push(1);f.push(l.x);f.push(l.y);f.push(l.z);h.push(0);h.push(0);f.push(d.x);f.push(d.y);f.push(d.z);h.push(1);h.push(0);f.push(u.x);f.push(u.y);f.push(u.z);h.push(1);h.push(1);p.push(0);p.push(1);p.push(2);p.push(2);p.push(3);p.push(0);v.push(0);v.push(1);v.push(1);v.push(2);v.push(2);v.push(3);v.push(3);v.push(0);this._bounds=[];var m=[];m.push({position:Freedo.Matrix4.multiplyByPoint(c,s,new Freedo.Cartesian3),st:new Freedo.Cartesian2(0,1)});m.push({position:Freedo.Matrix4.multiplyByPoint(c,l,new Freedo.Cartesian3),st:new Freedo.Cartesian2(0,0)});m.push({position:Freedo.Matrix4.multiplyByPoint(c,d,new Freedo.Cartesian3),st:new Freedo.Cartesian2(1,0)});m.push({position:Freedo.Matrix4.multiplyByPoint(c,u,new Freedo.Cartesian3),st:new Freedo.Cartesian2(1,1)});this._bounds.push(m);this._create(f,h,p,v,c)};var S=new Freedo.Cartesian3;var d=new Freedo.HeadingPitchRoll;var A=new Freedo.Quaternion;var k=new Freedo.Matrix3;var L=new Freedo.Cartographic;h.prototype._calWorldMatrix=function(){var e=this._options;var t=Freedo.defaultValue(e.heading,0);var r=Freedo.defaultValue(e.pitch,0);var i=Freedo.defaultValue(e.roll,-90);var n=Freedo.HeadingPitchRoll.fromDegrees(t,r,i,d);var a=Freedo.Quaternion.fromHeadingPitchRoll(n,A);var o=Freedo.Matrix3.fromQuaternion(a,k);var s=e.position;var l=Freedo.Cartesian3.fromRadians(s.longitude,s.latitude,s.height,undefined,S);var u=Freedo.Transforms.eastNorthUpToFixedFrame(l);return Freedo.Matrix4.multiplyByMatrix3(u,o,u)};h.prototype._triangles=function(){var e=this._options;var t=this._calWorldMatrix();var r=Freedo.defaultValue(e.farClip,100);var i=new Freedo.Cartesian3(0,r,0);i=Freedo.Matrix4.multiplyByPoint(t,i,i);var n=e.position;var a=Freedo.Cartesian3.fromRadians(n.longitude,n.latitude,n.height);var o=Freedo.Cartesian3.subtract(a,i,new Freedo.Cartesian3);o=Freedo.Cartesian3.normalize(o,o);var s=Freedo.Cartesian3.normalize(a,new Freedo.Cartesian3);if(Math.abs(Freedo.Cartesian3.dot(o,s))>.9999){var l=[];var u=0;for(var d=0;d<this._bounds.length;d++){var c=this._bounds[d];var f=[];for(var h=0;h<c.length;h++){var p=Freedo.Cartographic.fromCartesian(c[h].position,undefined,L);f.push(new Freedo.Cartesian2(Freedo.Math.toDegrees(p.longitude),Freedo.Math.toDegrees(p.latitude)))}var v=Freedo.PolygonPipeline.triangulate(f);for(var m=0;m<v.length;m++){l.push(v[m]+u)}u+=c.length}return l}else{var _=Freedo.Cartesian3.cross(s,o,new Freedo.Cartesian3);_=Freedo.Cartesian3.normalize(_,_);var y=Freedo.defaultValue(e.roll,-90);var g=Freedo.Quaternion.fromAxisAngle(_,Freedo.Math.toRadians(270-y),A);var w=Freedo.Matrix3.fromQuaternion(g,k);var F=new Freedo.Cartesian3(-i.x,-i.y,-i.z);var b=Freedo.Matrix4.fromTranslation(F);var C=Freedo.Matrix4.fromTranslation(i);var x=Freedo.Matrix4.multiplyByMatrix3(C,w,C);x=Freedo.Matrix4.multiply(x,b,x);var P=Freedo.Plane.fromPointNormal(i,o);var l=[];var u=0;for(var d=0;d<this._bounds.length;d++){var c=this._bounds[d];var f=[];for(var h=0;h<c.length;h++){var M=Freedo.Cartesian3.subtract(c[h].position,a,S);M=Freedo.Cartesian3.normalize(M,M);var T=new Freedo.Ray(a,M);var E=Freedo.IntersectionTests.rayPlane(T,P,S);E=Freedo.Matrix4.multiplyByPoint(x,E,E);var p=Freedo.Cartographic.fromCartesian(E,undefined,L);f.push(new Freedo.Cartesian2(Freedo.Math.toDegrees(p.longitude),Freedo.Math.toDegrees(p.latitude)))}var v=Freedo.PolygonPipeline.triangulate(f);for(var m=0;m<v.length;m++){l.push(v[m]+u)}u+=c.length}return l}};h.prototype.createByBounds=function(){var e=this._triangles();var t=Freedo.defined(this._surfacePrimitive)&&this._surfacePrimitive.show===false;this.destroy();var r=[];var i=[];var n=[];var a=0;for(var o=0;o<this._bounds.length;o++){var s=this._bounds[o];for(var l=0;l<s.length;l++){var u=s[l].position;r.push(u.x);r.push(u.y);r.push(u.z);var d=s[l].st;i.push(d.x);i.push(d.y);n.push(a+l);n.push(l!==s.length-1?a+l+1:a)}a+=s.length}this._create(r,i,e,n);if(this._editStatus!==0){this.showBoundaryPoints(true)}if(t){this.hide()}};h.prototype.destroy=function(){if(Freedo.defined(this._primitives)){this._material=undefined;this._surfacePrimitive=undefined;this._outlinePrimitive=undefined;this._boundary=undefined;this._viewer.scene.primitives.remove(this._primitives);this._primitives=undefined;this._viewer.scene.requestRender()}this._destroyPointGraph();this._destroyLineGraph()};h.prototype.dispose=function(){this.endEdit();this.destroy();if(Freedo.defined(this._videoElement)){document.body.removeChild(this._videoElement);this._videoElement=undefined}this._materialProperty=undefined;if(Freedo.defined(this._material)){this._material.destroy();this._material=undefined}};h.prototype.showBoundaryPoints=function(e){if(e){if(Freedo.defined(this._primitives)){if(!Freedo.defined(this._boundary)){this._boundary=new Freedo.PointPrimitiveCollection;this._primitives.add(this._boundary)}else{this._boundary.removeAll()}for(var t=0;t<this._bounds.length;t++){var r=this._bounds[t];for(var i=0;i<r.length;i++){var n=r[i].position;this._boundary.add({show:true,position:n,pixelSize:5,color:Freedo.Color.YELLOW,outlineWidth:0})}}}}else{if(Freedo.defined(this._primitives)&&Freedo.defined(this._boundary)){this._primitives.remove(this._boundary);this._boundary=undefined}}};h.prototype.show=function(){if(Freedo.defined(this._surfacePrimitive)){this._surfacePrimitive.show=true;this._viewer.scene.requestRender()}};h.prototype.hide=function(){if(Freedo.defined(this._surfacePrimitive)){this._surfacePrimitive.show=false;this._viewer.scene.requestRender()}};h.prototype.updateParams=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.position=Freedo.defaultValue(e.position,this._options.position);this._options.heading=Freedo.defaultValue(e.heading,this._options.heading);this._options.pitch=Freedo.defaultValue(e.pitch,this._options.pitch);this._options.roll=Freedo.defaultValue(e.roll,this._options.roll);this._options.fov=Freedo.defaultValue(e.fov,this._options.fov);this._options.ratio=Freedo.defaultValue(e.ratio,this._options.ratio);this._options.farClip=Freedo.defaultValue(e.farClip,this._options.farClip);this.createByParams()};var x=new Freedo.Cartesian2;var P=new Freedo.Cartesian2;var M=new Freedo.Cartesian2;var T=new Freedo.Cartesian2;var E=new Freedo.Cartesian2;h.prototype.reproject=function(e,t){x.x=e;x.y=t;for(var r=0;r<this._bounds.length;r++){var i=this._bounds[r];var n,a;for(var o=0;o<i.length;o++){if(o===0){n=this._viewer.scene.cartesianToCanvasCoordinates(i[0].position,P)}else{n=Freedo.Cartesian2.clone(a,P)}if(o!==i.length-1){a=this._viewer.scene.cartesianToCanvasCoordinates(i[o+1].position,M)}else{a=this._viewer.scene.cartesianToCanvasCoordinates(i[0].position,M)}var s=Freedo.Cartesian2.subtract(x,n,T);Freedo.Cartesian2.normalize(s,s);var l=Freedo.Cartesian2.subtract(x,a,E);Freedo.Cartesian2.normalize(l,l);if(Freedo.Cartesian2.dot(s,l)<-.999){var u=this._viewer.camera.getPickRay(x);var d=this._viewer.camera.directionWC;var c=i[o].position;var f;if(o!==i.length-1){f=i[o+1].position}else{f=i[0].position}var h=Freedo.Cartesian3.subtract(f,c,S);Freedo.Cartesian3.normalize(h,h);var p=Freedo.Cartesian3.cross(h,d,new Freedo.Cartesian3);p=Freedo.Cartesian3.normalize(p,p);var v=Freedo.Cartesian3.cross(h,p,new Freedo.Cartesian3);v=Freedo.Cartesian3.normalize(v,v);h=Freedo.Cartesian3.add(f,c,S);h=Freedo.Cartesian3.multiplyByScalar(h,.5,S);var m=Freedo.Plane.fromPointNormal(h,v);var _=Freedo.IntersectionTests.rayPlane(u,m,S);if(Freedo.defined(_)){return _}break}}}return undefined};h.prototype.snap=function(e,t){x.x=e;x.y=t;for(var r=0;r<this._bounds.length;r++){var i=this._bounds[r];for(var n=0;n<i.length;n++){var a=this._viewer.scene.cartesianToCanvasCoordinates(i[n].position,P);if(Freedo.Cartesian2.distanceSquared(a,x)<9){return{position:i[n].position,boundIndex:r,pointIndex:n}}}}return undefined};h.prototype.addPoint=function(e,t){x.x=e;x.y=t;var r=undefined;var i=undefined;for(var n=0;n<this._bounds.length;n++){var a=this._bounds[n];var o,s;for(var l=0;l<a.length;l++){if(l===0){o=this._viewer.scene.cartesianToCanvasCoordinates(a[0].position,P)}else{o=Freedo.Cartesian2.clone(s,P)}if(l!==a.length-1){s=this._viewer.scene.cartesianToCanvasCoordinates(a[l+1].position,M)}else{s=this._viewer.scene.cartesianToCanvasCoordinates(a[0].position,M)}var u=Freedo.Cartesian2.subtract(x,o,T);Freedo.Cartesian2.normalize(u,u);var d=Freedo.Cartesian2.subtract(x,s,E);Freedo.Cartesian2.normalize(d,d);if(Freedo.Cartesian2.dot(u,d)<-.999){var c=a[l].position;var f=a[l].st;var h;var p;if(l!==a.length-1){h=a[l+1].position;p=a[l+1].st}else{h=a[0].position;p=a[0].st}if(!Freedo.defined(r)){var v=this._viewer.camera.getPickRay(x);var m=this._viewer.camera.directionWC;var _=Freedo.Cartesian3.subtract(h,c,S);_=Freedo.Cartesian3.normalize(_,_);var y=Freedo.Cartesian3.cross(_,m,new Freedo.Cartesian3);y=Freedo.Cartesian3.normalize(y,y);var g=Freedo.Cartesian3.cross(_,y,new Freedo.Cartesian3);g=Freedo.Cartesian3.normalize(g,g);_=Freedo.Cartesian3.add(h,c,S);_=Freedo.Cartesian3.multiplyByScalar(_,.5,S);var w=Freedo.Plane.fromPointNormal(_,g);r=Freedo.IntersectionTests.rayPlane(v,w,new Freedo.Cartesian3);if(Freedo.defined(r)){var F=Freedo.Cartesian3.distance(c,r);var b=Freedo.Cartesian3.distance(h,r);var C=F/(F+b);i=new Freedo.Cartesian2;i.x=f.x+C*(p.x-f.x);i.y=f.y+C*(p.y-f.y)}}if(Freedo.defined(r)){a.splice(l+1,0,{position:r,st:i})}break}}}if(Freedo.defined(r)){this.createByBounds()}};h.prototype.removePoint=function(e,t){if(e<this._bounds.length){var r=this._bounds[e];if(t<r.length&&r.length>3){r.splice(t,1);this.createByBounds()}}};h.prototype.movePoint=function(e,t,r){if(e<this._bounds.length){var i=this._bounds[e];if(t<i.length){Freedo.Cartesian3.clone(r,i[t].position);this.createByBounds()}}};h.prototype.clip=function(e,t,r){if(e<this._bounds.length){var i=this._bounds[e];if(t<i.length&&r<i.length&&t!==r){var n=t<r?t:r;var a=t>r?t:r;if(n===0&&a===i.length-1){}else if(a-n<2){}else{var o=[];var s=[];for(var l=0;l<i.length;l++){if(l>=n&&l<=a){o.push(i[l])}if(l<=n||l>=a){s.push(i[l])}}this._bounds.splice(e,1,o,s);this.createByBounds()}}}};h.prototype._sameBound=function(e,t,r,i){if(e===r){return{boundIndex:e,pointIndex0:t,pointIndex1:i}}else{var n=this._bounds[e][t].position;var a=this._bounds[r][i].position;for(var o=0;o<this._bounds.length;o++){var s=this._bounds[o];var l=-1,u=-1;for(var d=0;d<s.length;d++){var c=s[d].position;if(l<0){if(Freedo.Cartesian3.equals(c,n)){l=d}}if(u<0){if(Freedo.Cartesian3.equals(c,a)){u=d}}if(l>=0&&u>=0){return{boundIndex:o,pointIndex0:l,pointIndex1:u}}}}return undefined}};h.prototype.startEdit=function(e){if(this._editStatus!==0){return false}else{this._editStatus=e;this.showBoundaryPoints(true);return true}};h.prototype.endEdit=function(){if(this._editStatus!==0){this._editStatus=0;this._dragable=false;this._selected=undefined;this._destroyPointGraph();this._destroyLineGraph();this.showBoundaryPoints(false);return true}else{return false}};h.prototype.saveJson=function(){var e={videoUrl:this._videoUrl,options:this._options,bounds:this._bounds};return(0,n.default)(e)};h.fromJson=function(e,t){function r(e){if(e.position){var t=e.position;if(t.longitude){e.position=Freedo.Cartographic.clone(t)}else if(t.x){e.position=Freedo.Cartesian3.clone(t)}}}function i(e){if(e.st){e.st=Freedo.Cartesian2.clone(e.st)}}var n=JSON.parse(e);var a=n.videoUrl;var o=n.options;r(o);var s=n.bounds;if(s&&s instanceof Array){for(var l=0;l<s.length;l++){var u=s[l];for(var d=0;d<u.length;d++){var c=u[d];r(c);i(c)}}}var f=new h(a,t,o,s);return f};t.FdVideo=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){this._outlinePrimitive=undefined;this._primitives=undefined;this._viewer=e;this._options=Freedo.clone(t,true);this.analysis(this._options)}i.prototype.analysis=function(e){this.remove();var t=this._viewer.scene;if(t._context.depthTexture===false){return}var r=e.position;var i=Freedo.defaultValue(e.heading,0);var n=Freedo.defaultValue(e.pitch,15);var a=Freedo.defaultValue(e.flyTo,true);var o=t._defaultView;var s=o.camera;var l={destination:Freedo.Cartesian3.clone(s.position,new Freedo.Cartesian3),direction:Freedo.Cartesian3.clone(s.direction,new Freedo.Cartesian3),up:Freedo.Cartesian3.clone(s.up,new Freedo.Cartesian3),fov:s.frustum.fov};var u={destination:Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height),orientation:{heading:Freedo.Math.toRadians(i),pitch:Freedo.Math.toRadians(n),roll:Freedo.Math.toRadians(0)},complete:e.completeFunc};s.frustum.fov=Freedo.Math.toRadians(120);s.setView(u);var d=t.updateAndReadPickFramebuffer();var c=d.pixels;var f=d.width;var h=d.height;var p=0;var v=0;var m=o.camera.frustum.clone();var _=new Freedo.Color;var y=new Freedo.Cartesian2;var g=new Freedo.Cartesian3;var w=new Freedo.Cartographic;var F=[];var b=[];var C=-1;for(var x=0;x<f;x++){for(var P=0;P<h;P++){var M=4*(f*(h-1-P)+x);_.red=Freedo.Color.byteToFloat(c[M]);_.green=Freedo.Color.byteToFloat(c[M+1]);_.blue=Freedo.Color.byteToFloat(c[M+2]);_.alpha=Freedo.Color.byteToFloat(c[M+3]);var T=t.context.getObjectByPickColor(_);if(Freedo.defined(T)&&(Freedo.defined(T.primitive)&&(T.primitive instanceof Freedo.Model||T.primitive instanceof Freedo.Primitive)||T instanceof Freedo.ModelInstance||T instanceof Freedo.FreedoPModelFeature)){y.x=p+x;y.y=h-1-(v+P);var E=o.frustumCommandsList.length;for(var S=0;S<E;++S){var A=o.pickDepths[S];var k=A.getDepth(t.context,y.x,y.y);if(k>0&&k<1){var L=o.frustumCommandsList[S];m.near=L.near*(S!==0?t.opaqueFrustumNearOffset:1);m.far=L.far;t.context.uniformState.updateFrustum(m);Freedo.SceneTransforms.drawingBufferToWgs84Coordinates(t,y,k,g);{var D=Freedo.Cartesian3.clone(g,new Freedo.Cartesian3);if(x===C+1){b.push(D)}else{if(b.length>=2){F.push(b)}b=[];b.push(D)}C=x}break}}break}}}s.setView({destination:l.destination,orientation:{direction:l.direction,up:l.up}});if(b.length>=2){F.push(b)}b=[];var I=[];for(var x=0;x<F.length;x++){if(F[x].length>=2){var R=new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:F[x],width:Freedo.defaultValue(this._options.lineWidth,2),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})});I.push(R)}}if(I.length>0){var O=new Freedo.Primitive({geometryInstances:I,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.defaultValue(this._options.lineColor,Freedo.Color.YELLOW)}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-.001,units:-.001}})}),asynchronous:false,allowPicking:false});this._primitives=new Freedo.PrimitiveCollection;this._viewer.scene.primitives.add(this._primitives);this._outlinePrimitive=O;this._primitives.add(O);this._viewer.scene.requestRender()}if(a){s.flyTo(u)}};i.prototype.remove=function(){if(Freedo.defined(this._primitives)){this._outlinePrimitive=undefined;this._viewer.scene.primitives.remove(this._primitives);this._primitives=undefined;this._viewer.scene._defaultView.camera.frustum.fov=Freedo.Math.toRadians(60);this._viewer.scene.requestRender()}};i.prototype.show=function(){if(Freedo.defined(this._surfacePrimitive)){this._outlinePrimitive.show=true;this._viewer.scene.requestRender()}};i.prototype.hide=function(){if(Freedo.defined(this._surfacePrimitive)){this._outlinePrimitive.show=false;this._viewer.scene.requestRender()}};i.prototype.update=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.position=Freedo.defaultValue(e.position,this._options.position);this._options.heading=Freedo.defaultValue(e.heading,this._options.heading);this._options.pitch=Freedo.defaultValue(e.pitch,this._options.pitch);this._options.lineColor=Freedo.defined(e.lineColor)?Freedo.clone(e.lineColor,true):this._options.lineColor;this._options.lineWidth=Freedo.defaultValue(e.lineWidth,this._options.lineWidth);this._options.completeFunc=e.completeFunc;if(Freedo.defined(this._primitives)){this._outlinePrimitive=undefined;this._viewer.scene.primitives.remove(this._primitives);this._primitives=undefined}this.analysis(this._options)};t.FdSkyline=i},function(e,t,r){"use strict";function i(e){this._show=Freedo.defaultValue(e.show,true);this._lineColor=Freedo.defaultValue(e.lineColor,Freedo.Color.RED);this._coordinates=Freedo.defaultValue(e.coordinate,[]);this._screenCoordinate=[];this._vertexArray=undefined;this._drawCommand=undefined;this._scene=Freedo.defaultValue(e.scene,{});this._ready=false;this._shaderProgram=undefined;this._lineType=1;this._renderState=undefined;this._pass=Freedo.Pass.OVERLAY;this._clientWidth=this._scene._canvas.clientWidth;this._clientHeight=this._scene._canvas.clientHeight;this._resolution=new Freedo.Cartesian2;this._modelMatrix=Freedo.Matrix4.IDENTITY;this._vertexShader=undefined;this._fragShader=undefined}i.prototype.update=function(e){var t=e.context;var r=e.commandList;if(!this._ready){this._initial(t)}else{if(this._show){r.push(this._drawCommand)}}};i.prototype._initial=function(e){var t=this;var r=t._scene;if(!Freedo.defined(r)){throw Freedo.DevelopError("scene is require")}if(!Freedo.defined(this._coordinates)&&this._coordinates.length===0){throw Freedo.DevelopError("coordinate is require")}n(this,e);o(this,e);s(this);l(this);u(this);this._ready=true};function n(e,t){var r=e;r._vertexShader=" \n                              attribute vec4 a_position;\n                              uniform vec2 u_resolution;\n                              uniform mat4 u_modelMatrix;\n                              void main()\n                                {\n                                    vec4 position = u_modelMatrix*a_position;\n                                    vec2 zeroToOne = position.xy / u_resolution;\n\t\t\t\t\t\t\t\t    vec2 zeroToTwo = zeroToOne * 2.0;\n\t\t\t\t\t\t\t\t    vec2 clipSpace = zeroToTwo - 1.0;\n                                    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n                                }";r._fragShader="\n                            precision mediump float;\n                            uniform vec4 u_linecolor;\n                            void main(){\n                                gl_FragColor = u_linecolor;\n                            }";r._shaderProgram=Freedo.ShaderProgram.fromCache({context:t,vertexShaderSource:r._vertexShader,fragmentShaderSource:r._fragShader})}var a=new Freedo.Cartesian2;function o(e,t){var r=e;var i=r._scene;var n=r._lineType;var a=r._coordinates.length;var o=r._coordinates;var s=r._screenCoordinate;for(var l=0;l<a;l++){s.push(o[l].x,o[l].y,0)}var u=new Float32Array(s);var d=Freedo.Buffer.createVertexBuffer({context:t,typedArray:u,usage:Freedo.BufferUsage.STATIC_DRAW});var c=[{vertexBuffer:d,componentsPerAttribute:3,componentDatatype:Freedo.ComponentDatatype.FLOAT,offsetInBytes:0}];r._vertexArray=new Freedo.VertexArray({context:t,attributes:c})}function s(e){var t=e;var r={depthTest:{enabled:false}};t._renderState=Freedo.RenderState.fromCache(r)}function l(e){var t=e;var r=new Freedo.Cartesian2(t._clientWidth,t._clientHeight);if(!r.equals(t._resolution)){r.clone(t._resolution)}}function u(e){var t=e;t._drawCommand=new Freedo.DrawCommand({vertexArray:t._vertexArray,primitiveType:t._lineType,renderState:t._renderState,shaderProgram:t._shaderProgram,pass:t._pass,uniformMap:{u_linecolor:function e(){return t._lineColor},u_resolution:function e(){return t._resolution},u_modelMatrix:function e(){console.log(t._modelMatrix);return t._modelMatrix}}})}i.prototype.show=function(){this._show=true};i.prototype.hide=function(){this._show=false};i.prototype.destroy=function(){this._show=false;this._coordinate.length=0;this._screenCoordinate.length=0;this._vertexArray.destroy();this._shaderProgram.destroy();this._drawCommand=undefined;this._scene=undefined;this._vertexShader=undefined;this._fragShader=undefined};e.exports={FdScreenLine:i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdBatchTree=undefined;var i=r(84);var n=h(i);var a=r(55);var d=h(a);var o=r(1);var s=h(o);var l=r(2);var u=h(l);var c=r(696);var f=h(c);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function t(e){(0,s.default)(this,t);this._viewer=e.viewer;this._startPoint=e.startPoint;this._positions=e.positions;this._treeJson=f.default;this._modelMatrix=Freedo.Matrix4.IDENTIFY;this._inverseMatrix=Freedo.Matrix4.IDENTIFY;this._treeBoundingRadius=10;this._isRelative=e.isRelative;this.initial()}(0,u.default)(t,[{key:"initial",value:function e(){var l=this;var u=this._treeJson.root.children[0];this._modelMatrix=new Freedo.Transforms.eastNorthUpToFixedFrame(this._startPoint);this._inverseMatrix=Freedo.Matrix4.inverse(this._modelMatrix,new Freedo.Matrix4);var t=this._treeBoundingRadius;var a=new Freedo.Cartesian3;var o=this._inverseMatrix;if(this._isRelative){this._positions.forEach(function(e){var t=Math.random()/2;t=t+1;var r=new Freedo.Cartesian3(e[0]/1e3,e[1]/1e3,e[2]/1e3);var i=new Freedo.HeadingPitchRoll(Math.random()*3.14*2,0,0);var n=Freedo.Quaternion.fromHeadingPitchRoll(i);var a=new Freedo.Cartesian3(t,t,t);var o=Freedo.Matrix4.fromTranslationQuaternionRotationScale(r,n,a);var s=_.clone(u,true);(0,d.default)(s,{transform:o});l._treeJson.root.children.push(s)})}else{this._positions.forEach(function(e){var t=Freedo.Cartesian3.fromDegrees(e[0],e[1],e[2]);var r=Freedo.Matrix4.multiplyByPoint(o,t,a);var i=Freedo.Matrix4.fromTranslation(r,new Freedo.Matrix4);var n=_.clone(u,true);(0,d.default)(n,{transform:i});l._treeJson.root.children.push(n)})}var r=this.computedRootBoundingVolume();console.log((0,n.default)(this._treeJson))}},{key:"computedRootBoundingVolume",value:function e(){var t=this._positions;var r=[],i=[],n=[];t.forEach(function(e){r.push(e[0]);i.push(e[1]);n.push(e[2])});var a=function e(t,r){return t-r};r.sort(a);i.sort(a);n.sort(a);var o=Freedo.Cartesian3.fromDegrees(r[0],i[0],n[0]);var s=Freedo.Cartesian3.fromDegrees(r[r.length-1],i[i.length-1],n[n.length-1]);var l=Freedo.Cartesian3.distance(o,s);return l}}]);return t}();t.FdBatchTree=p},function(e){e.exports={asset:{tilesetVersion:"1.2.3",version:"0.0"},properties:null,root:{boundingVolume:{box:[0,0,5,500,0,0,0,500,0,0,0,5]},geometricError:60,refine:"REPLACE",children:[{boundingVolume:{box:[0,0,5,2,0,0,0,2,0,0,0,5]},content:{url:"cross/Tile_+0_0_0/root.b3dm"},children:[{boundingVolume:{box:[0,0,5,2,0,0,0,2,0,0,0,5]},content:{url:"Tile_+0_0_0/root.b3dm"},children:[],geometricError:0,refine:"REPLACE",transform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}],geometricError:2,refine:"REPLACE",transform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}],transform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdWidgets=undefined;var i=r(1);var n=w(i);var a=r(698);var o=r(699);var s=r(700);var l=r(252);var u=r(701);var d=r(702);var c=r(703);var f=r(704);var h=r(705);var p=r(706);var v=r(707);var m=r(708);var _=r(709);var y=r(710);var g=r(711);function w(e){return e&&e.__esModule?e:{default:e}}var F=function e(){(0,n.default)(this,e)};if(typeof Ext!="undefined"){Ext.onReady(function(){Ext.tip.QuickTipManager.init()})}F.FdCamera=a.FdCamera;F.FdCompass=o.FdCompass;F.FdConsole=d.FdConsole;F.FdGltfModel=y.FdGltfModel;F.FdLayer=h.FdLayer;F.FdMain=m.FdMain;F.FdPath=p.FdPath;F.FdPmts=f.FdPmts;F.FdProject=c.FdProject;F.FdProp=l.FdProp;F.FdTree=u.FdTree;F.FdUserLogining=s.FdUserLogining;F.FdVector=g.FdVector;F.FdView=v.FdView;F.FdWater=_.FdDWater;t.FdWidgets=F},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCamera=undefined;var i=r(1);var a=s(i);var n=r(2);var o=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function n(e,t,r){var i=this;(0,a.default)(this,n);this._viewer=e;this._mouseInfo=[];this._cameraInfo=[];this._mouseInfoStr="";this._cameraInfoStr="";this._handler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._cameraListener=undefined;this._timer=0;this._mouseTime=0;this._cameraTime=0;this._movement=undefined;this._cameraListContainer=this._initContainer(t);this.setMouseInfo();this.setCameraInfo();this.addListeners();this._interval=setInterval(function(){i._timer+=500;var e=i._timer-i._mouseTime;if(e>=1e3&&e<=2e3){i.setMouseInfo(i._movement)}var t=i._timer-i._cameraTime;if(t>=1e3&&t<=2e3){i.setCameraInfo()}},500);this._showCI=r?r.showCI:true}(0,o.default)(n,[{key:"setMouseTime",value:function e(t){this._mouseTime=this._timer;this._movement=t}},{key:"setCameraTime",value:function e(){this._cameraTime=this._timer}},{key:"setMouseInfo",value:function e(t){if(t!==undefined){var r=this._viewer.camera.pickEllipsoid(t.endPosition,this._viewer.scene.globe.ellipsoid);if(r){var i=this._viewer.scene.globe.ellipsoid.cartesianToCartographic(r);var n=Freedo.Math.toDegrees(i.longitude);var a=Freedo.Math.toDegrees(i.latitude);this._mouseInfo[0]=this.formatDegree(n);this._mouseInfo[1]=this.formatDegree(a);var o=Math.ceil(this._viewer.camera.positionCartographic.height);if(o>1e3){var s=(o/1e3).toFixed(2);this._cameraInfo[1]=s+"KM"}else{var l=o.toFixed(2);this._cameraInfo[1]=l+"M"}}else{this._mouseInfo[0]=this.formatDegree(0);this._mouseInfo[1]=this.formatDegree(0);this._mouseInfo[2]=0+"M"}}else{this._mouseInfo[0]=this.formatDegree(0);this._mouseInfo[1]=this.formatDegree(0);this._mouseInfo[2]=0+"M"}this._mouseInfoStr="&nbsp经度："+this._mouseInfo[0]+"&nbsp&nbsp纬度："+this._mouseInfo[1]+"&nbsp&nbsp高程："+this._mouseInfo[2];if(this._showCI)this._cameraListContainer.innerHTML=this._mouseInfoStr+this._cameraInfoStr;else this._cameraListContainer.innerHTML=this._mouseInfoStr}},{key:"setCameraInfo",value:function e(){var t=Freedo.Math.toDegrees(this._viewer.scene.camera.heading);if(t===360){this._cameraInfo[0]=this.formatDegree(0)}else{this._cameraInfo[0]=this.formatDegree(t)}var r=Freedo.Cartographic.fromCartesian(this._viewer.scene.camera.position).height;if(r>1e3){var i=(r/1e3).toFixed(2);this._cameraInfo[1]=i+"KM"}else{var n=r.toFixed(2);this._cameraInfo[1]=n+"M"}this._cameraInfoStr="&nbsp&nbsp&nbsp偏航："+this._cameraInfo[0]+"&nbsp&nbsp相机高度："+this._cameraInfo[1];var a=Freedo.FdCamera.getCurrentCameraInfo(this._viewer.scene.camera);this._cameraInfo[2]=a[0].toFixed(6);this._cameraInfo[3]=a[1].toFixed(6);this._cameraInfo[4]=a[2].toFixed(2);this._cameraInfo[5]=a[3].toFixed(2);this._cameraInfo[6]=a[4].toFixed(2);this._cameraInfo[7]=a[5].toFixed(2);this._cameraInfoStr="&nbsp&nbsp&nbsp偏航："+this._cameraInfo[0]+"&nbsp&nbsp相机高度："+this._cameraInfo[1]+"&nbsp&nbsp&nbsp相机详细参数：["+this._cameraInfo[2]+",&nbsp"+this._cameraInfo[3]+",&nbsp"+this._cameraInfo[4]+",&nbsp"+this._cameraInfo[5]+",&nbsp"+this._cameraInfo[6]+",&nbsp"+this._cameraInfo[7]+"]";if(this._showCI)this._cameraListContainer.innerHTML=this._mouseInfoStr+this._cameraInfoStr;else this._cameraListContainer.innerHTML=this._mouseInfoStr}},{key:"addListeners",value:function e(){var t=this;this._handler.setInputAction(this.setMouseTime.bind(this),Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._cameraListener=this._viewer.camera.changed.addEventListener(function(){t.setCameraTime()})}},{key:"formatDegree",value:function e(t){t=Math.abs(t);var r=Math.floor(t);var i=Math.floor((t-r)*60);var n=Math.round((t-r)*3600%60);return r+"°"+i+"'"+n+'"'}},{key:"_initContainer",value:function e(t){var r=void 0;if(t instanceof HTMLElement){r=t}else if(typeof t==="string"){r=document.getElementById(t)}else if(t===undefined){r=document.createElement("div")}r.style.cssText=n.cameraInfoListCssText;if(!r)throw new Error("没有指定显示div");if(!this._viewer.container.contains(r)){this._viewer.container.append(r)}return r}},{key:"dispose",value:function e(){clearInterval(this._interval);this._interval=undefined;this._handler.removeInputAction(Freedo.ScreenSpaceEventType.MOUSE_MOVE);this._handler.destroy();this._cameraListener();this._cameraListener=undefined;this._cameraListContainer.innerHTML="";this._viewer=undefined;this._mouseInfo=[];this._cameraInfo=[];this._mouseInfoStr="";this._cameraInfoStr="";this._timer=0;this._mouseTime=0;this._cameraTime=0}}]);return n}();l.cameraInfoListCssText="position: absolute;\nbottom: -1px;\nwidth: 100%;\ncolor:white;\nbackground-color: rgba(100, 100, 100, 0.5);\nfont-family: '宋体';\nfont-size: 12px;\nz-index: 1;\nmargin: auto;";t.FdCamera=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCompass=undefined;var i=r(1);var o=s(i);var n=r(2);var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}var l="\n<svg id='compass' viewBox='-299 379 12 36' preserveAspectRatio='xMidYMid meet' focusable='false' style='display: block; width: 60%; height: 60%;'>\n    <g viewBox='-299 379 12 36'>\n        <style>\n            .st0 {\n                fill: #eb2a1c\n            }\n\n            .st1 {\n                fill-opacity: .15\n            }\n\n            .st2 {\n                fill: #fff\n            }\n\n            .st3 {\n                fill-opacity: 7.000000e-02\n            }\n\n            .st4 {\n                fill: #424242\n            }\n        </style>\n        <path class='st0' d='M-293 379l6 18h-12z'></path>\n        <path class='st1' d='M-293 379l6 18h-6z'></path>\n        <path class='st2' d='M-293 415l6-18h-12z'></path>\n        <path class='st3' d='M-293 415v-18h-6z'></path>\n        <circle id='Oval-3' class='st4' cx='-293' cy='397' r='2'>\n        </circle>\n    </g>\n</svg>\n";var u=function(){function r(n,e){(0,o.default)(this,r);this._viewer=n;this._compassContainer=e;e.innerHTML=l;var a=e.firstElementChild;this._compass=a;function t(e){var t=Freedo.Math.toDegrees(n.camera.heading);var r=-t;var i="rotate("+r+"deg)";a.style.webkitTransform=i;a.style.MozTransform=i;a.style.msTransform=i;a.style.OTransform=i;a.style.transform=i}t(n.camera.heading);this._removeListener=n.camera.changed.addEventListener(function(){t(n.camera.heading)});this._compass.onclick=function(){console.log("svg clicked!")}}(0,a.default)(r,[{key:"dispose",value:function e(){this._removeListener();this._removeListener=undefined;this._compassContainer.innerHTML="";this._viewer=undefined;this._compass=undefined}}]);return r}();t.FdCompass=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdUserLogining=undefined;var i=r(1);var l=o(i);var n=r(2);var a=o(n);function o(e){return e&&e.__esModule?e:{default:e}}var u='\n    <div class="FD-login-con">\n            <div class="FD-login-title">\n                <span>用户登录</span>\n            </div>\n            <div class="FD-input-area">\n                <input type="text" id="lg_tel" placeholder="请输入用户手机号">\n                <span id="lg_tel_error"></span>\n                <input type="password" id="lg_pw" placeholder="输入密码">\n                <span id="lg_pw_error"></span>\n            </div>\n            <button id="FD-user-logining-btn">登录</button>\n    </div>\n';var s=function(){function n(e,a){(0,l.default)(this,n);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._token=undefined;this._viewer=e;this._container=a;a.innerHTML=u;var o="//"+window.location.host;var s=this;function t(){var e=document.getElementById("lg_tel");var t=document.getElementById("lg_pw");var r=document.getElementById("lg_tel_error");var i=document.getElementById("lg_pw_error");r.innerHTML="";i.innerHTML="";if(!e.value){r.innerHTML="用户名不能为空";return false}if(!t.value){i.innerHTML="密码不能为空";return false}var n={loginNum:e.value,password:t.value};this._token=undefined;Freedo.FdServer.FdUserServer.userLogin(n,o,function(e){if(e.code==="PU03000"){i.innerHTML=e.msg;return false}if(e.code==="PU03010"){r.innerHTML=e.msg;return false}console.log("token: "+e.token);s._token=e.token;a.style.display="none";s._event.raiseEvent("TokenChanged",e.token)})}var r=document.getElementById("FD-user-logining-btn");r.onclick=t;function i(){}}(0,a.default)(n,[{key:"getToken",value:function e(){return this._token}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"dispose",value:function e(){this._container.innerHTML="";this._viewer=undefined;this._container=undefined;this._eventHelper.removeAll();this._eventHelper=undefined;this._event=undefined}}]);return n}();t.FdUserLogining=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTree=undefined;var i=r(3);var M=l(i);var n=r(1);var a=l(n);var o=r(2);var s=l(o);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function i(e,t,r){(0,a.default)(this,i);this._status={show:false};this._viewer=e;this._pmtsManager=t;this._modelManager=r;this._width=300;this._height=800;this._tree=undefined;this._win=undefined;this._pmtsid;this._layer;this._matrixSet;this._matrix;this._pmts;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._selectedModel;this._selectedPMTS;this._selectedEntity;this.regLsnr();Ext.define("FreedoX.model.tree.PMTS",{extend:"Ext.data.TreeModel",entityName:"PMTS",idProperty:"identifier",glyph:"xf0ac@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.modelClass",{extend:"Ext.data.TreeModel",entityName:"modelClass",idProperty:"id",glyph:"xf19c@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.vectorData",{extend:"Ext.data.TreeModel",entityName:"vectorData",idProperty:"id",glyph:"xf19c@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.partImagery",{extend:"Ext.data.TreeModel",entityName:"partImagery",idProperty:"id",glyph:"xf19c@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.layer",{extend:"Ext.data.TreeModel",entityName:"layer",idProperty:"identifier",glyph:"f0ca@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.matrixSet",{extend:"Ext.data.TreeModel",entityName:"matrixSet",idProperty:"identifier",glyph:"f009@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.matrix",{extend:"Ext.data.TreeModel",entityName:"matrix",idProperty:"identifier",glyph:"xf19c@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.model.tree.component",{extend:"Ext.data.TreeModel",entityName:"component",idProperty:"identifier",glyph:"xf19c@FontAwesome",fields:[{name:"name",convert:undefined}]});Ext.define("FreedoX.store.treeData",{extend:"Ext.data.TreeStore",xtype:"treeData",requires:["FreedoX.model.tree.layer","FreedoX.model.tree.matrixSet","FreedoX.model.tree.matrix","FreedoX.model.tree.component"],filterer:"bottomup",model:"FreedoX.model.tree.PMTS",root:{name:"RootNode",children:[]},lazyFill:false,autoLoad:false});Ext.define("FreedoX.view.tree.PMTSTree",{extend:"Ext.tree.Panel",header:false,border:false,xtype:"PMTSTree",rootVisible:false,scrollable:true,root:{text:"RootNode",name:"RootNode",mtype:"PMTS",expanded:true,children:[]},animate:true,frame:false,reserveScrollbar:true,columns:[{xtype:"treecolumn",text:"Name",dataIndex:"name",flex:1,sortable:false,renderer:function e(t,r,i){r.glyph=i.glyph;return t}},{xtype:"actioncolumn",glyph:"xf05a@FontAwesome",width:25,getTip:function e(t,r,i,n,a,o,s){var l=s.up("");return l.getActionTip.apply(l,arguments)},handler:function e(t){var r=t.up("");r.onDrillAction.apply(r,arguments)}}],listeners:{beforeitemexpand:function e(t,r){this.onBeforeItemExpand(t,r)},itemclick:function e(t,r,i,n,a,o){var s=t.up("");s.onSelectionChange.apply(s,arguments)},checkchange:function e(t,r){if(t.data.parentId=="vectorData"){if(r){t.data.modelData.show()}else{t.data.modelData.hide()}return}var i=t.isLeaf();if(!i){t.cascade(function(e){e.set("checked",r)})}else{if(r)t.set("checked",true);else t.set("checked",false)}var n=this._clsParent;if(t.data.mtype=="matrixSet"){var a=n._pmtsManager.getPModelArrayByMatrixSet(t.data.xData);a.forEach(function(e){e.show=r})}else if(t.data.mtype=="matrix"){var o=n._pmtsManager.getPModelByMatrix(t.data.xData);o.show=r}else if(t.data.mtype=="component"){n._pmtsManager.showComponent(t.data.xDataPMTSID,t.data.xData.uid,r)}n._viewer.scene.requestRender()}},selModel:{allowDeselect:false,listeners:{selectionchange:function e(t,r){var i=t.view.up("")}}},bbar:[{xtype:"textfield",itemId:"keyword",width:120,enableKeyEvents:true,listeners:{keydown:function e(t,r){var i=t.up("treepanel");if(r.keyCode===Ext.EventObject.ENTER){if(!i.down("#search-button").isDisabled()){i.searchClick()}}}}},{itemId:"search-button",text:"搜索",handler:function e(t){var r=t.up("treepanel");r.searchClick()}},{itemId:"clear-button",text:"清空",handler:function e(t){var r=t.up("treepanel");var i=r.down("#keyword");i.setValue("");r.searchClick()}}],searchClick:function e(){var t=this.down("#keyword");var r=t&&t.getValue();var i=this.getStore();var n=i.getFilters();n.removeAll();function a(e){var t=false;t=e.data.name.indexOf(r)!=-1;return t}n.add(a)},onSelectionChange:function e(t,r){var i=this.down("#search-button"),n;var u=this._clsParent;if(r){n=r;if(n instanceof FreedoX.model.tree.PMTS){var a=n.data.identifier;u._selectedPMTS=u._pmtsManager.getPmts(a)}else if(n instanceof FreedoX.model.tree.layer){this._selectedLayer=this._clsParent._pmtsManager.getLayer(n.data.xData.identifier)}else if(n instanceof FreedoX.model.tree.matrixSet){var u=this._clsParent;this._matrixSet=n.data.xData;var o=this._clsParent._pmtsManager.getPModelArrayByMatrixSet(this._matrixSet);u._event.raiseEvent("MatrixSetSelected",o);u._selectedModel=o}else if(n instanceof FreedoX.model.tree.matrix){this._pmtsid=n.parentNode.parentNode.data.xDataPMTSID;this._layer=n.parentNode.parentNode.data.xData;this._matrixSet=n.parentNode.data.xData;this._matrix=n.data.xData;var s=this._matrix.uid;var l=this._matrix.token;var u=this._clsParent;var d=u._pmtsManager.getPModelByMatrix(this._matrix);Freedo.FdServer.FdPMTSParser.getUidBoundingSphere(this._layer,this._matrixSet,this._matrix,s,l,d.modelMatrix,function(e,t){if(Freedo.defined(e)){var r=e.center;var i=e.radius*.75;console.log("==========================metadata======================");var n=Freedo.FdMisc.FdGeometric.tg(e.center);console.log(n.join(","));console.log("半径"+e.radius);console.log("==========================transform=====================");var a=new Freedo.Cartesian3;Freedo.Matrix4.getTranslation(d._root.computedTransform,a);var o=Freedo.FdMisc.FdGeometric.tg(a);console.log(o.join(","));if(Math.abs(n[0]-o[0])>1e-4||Math.abs(n[1]-o[1])>1e-4){console.log("差值过大（经度或纬度，超过0.0001弧度，以本坐标生效为准）");r=a}console.log("=======================boundingSphere===================");var s=Freedo.FdMisc.FdGeometric.tg(d.boundingSphere.center);console.log(s.join(","));if(Math.abs(s[0]-o[0])>5e-5||Math.abs(s[1]-o[1])>5e-5){console.log("差值过大（经度或纬度，超过0.00005弧度，以本坐标生效为准）");r=d.boundingSphere.center}var l=new Freedo.BoundingSphere(r,i);u._viewer.camera.flyToBoundingSphere(l);console.log("=============================end========================")}else{console.log(t)}});u._event.raiseEvent("ModelSelected",d);u._selectedModel=[d]}else if(n instanceof FreedoX.model.tree.component){var s=n.data.xData.uid;var l=n.data.xData.token;var u=this._clsParent;var d=u._pmtsManager.getPModelByMatrix(u._matrix);Freedo.FdServer.FdPMTSParser.getUidBoundingSphere(u._layer,u._matrixSet,u._matrix,s,l,d.modelMatrix,function(e,t){if(Freedo.defined(e)){var r=Freedo.clone(e,true);r.radius*=1;u._viewer.camera.flyToBoundingSphere(r);var i=Freedo.FdMisc.FdGeometric.tg(r.center);console.log(i);var n=u._pmtsManager.getPmts(u._pmtsid);setTimeout(function(){n.styler.setColor(s,255,0,0,1);u._viewer.scene.requestRender()},3500)}else{console.log(t)}})}else if(n instanceof FreedoX.model.tree.modelClass){if(Freedo.defined(n.data.modelData)){var c=void 0,f=n.data.modelData.option;u._selectedEntity=u._modelManager.getById(n.data.modelData.id);if(Freedo.defined(f.position)||Freedo.defined(f.center)){var h=Freedo.defaultValue(f.position,f.center);c=Freedo.FdMisc.FdGeometric.tc(h)}else if(Freedo.defined(f.pts)||Freedo.defined(f.positions)){var p=Freedo.defaultValue(f.pts,f.positions);if(n.data.parentId=="Water")p=Freedo.Cartesian3.fromDegreesArray(p);var v=[];if(Freedo.defined(p[0].x)){v=p}else{var m=true;var _=false;var y=undefined;try{for(var g=(0,M.default)(p),w;!(m=(w=g.next()).done);m=true){var F=w.value;v.push(Freedo.FdMisc.FdGeometric.tc(F))}}catch(e){_=true;y=e}finally{try{if(!m&&g.return){g.return()}}finally{if(_){throw y}}}}c=Freedo.FdMisc.FdGeometric.getCenterOfPts(v)}else console.log("option: "+f);Freedo.FdCamera.flyToByPosition(u._viewer.scene.camera,Freedo.FdMisc.FdGeometric.tg(c))}}else{}}else{}},onBeforeItemExpand:function e(r,t){function i(e,t,r){e.removeAll();var i=[];for(var n=0;n<t.length;n++){var a=t[n];a.token=r;var o=Ext.create("FreedoX.model.tree.component",{mtype:"component",name:a.Name||a.name||"无名",xData:a,xDataPMTSID:e.data.xDataPMTSID,identifier:a.Uid,children:[{name:"正在加载..."}],checked:e.data.checked});if(n>2e3)break;i.push(o)}e.appendChild(i)}if(r.data.mtype=="matrix"){var n=r;var a=this._clsParent;a._pmtsid=n.parentNode.parentNode.data.xDataPMTSID;a._layer=n.parentNode.parentNode.data.xData;a._matrixSet=n.parentNode.data.xData;a._matrix=n.data.xData;var o=a._matrix.uid;var s=a._matrix.token;var l=a._pmtsManager.getPModelByMatrix(a._matrix);Freedo.FdServer.FdPMTSParser.getCidJson(a._layer,a._matrixSet,a._matrix,"matrix",o,s,function(e,t){if(Freedo.defined(e)){i(r,e,s)}else{console.log(t)}})}if(r.data.mtype=="component"){var u=r.data.xData;var n=r;var o=u.uid;var s=u.token;var a=this._clsParent;var l=this._clsParent._pmtsManager.getPModelByMatrix(a._matrix);Freedo.FdServer.FdPMTSParser.getCidJson(a._layer,a._matrixSet,a._matrix,"component",o,s,function(e,t){if(Freedo.defined(e)){i(r,e,s)}else{console.log(t)}})}},getActionTip:function e(t,r,i,n,a,o,s){var l;switch(Ext.ClassManager.getName(i)){case"FreedoX.model.tree.PMTS":l="PMTS服务";break;case"FreedoX.model.tree.layer":l="图层";break;case"FreedoX.model.tree.matrixSet":l="数据集";break;case"FreedoX.model.tree.matrix":l="PModel";break;case"FreedoX.model.tree.component":l="构件"}return"点击查看"+l+"的详细信息"},onDrillAction:function e(t,r,i,n,a,o){var s;switch(Ext.ClassManager.getName(o)){case"FreedoX.model.tree.PMTS":s="PMTS";break;case"FreedoX.model.tree.layer":s="layer";break;case"FreedoX.model.tree.matrixSet":s="matrixSet";break;case"FreedoX.model.tree.matrix":s="matrix";break;case"FreedoX.model.tree.component":s="component"}var l=o.data.xData;var u="";for(var d in l){if(typeof l[d]=="string"){u+=""+Freedo.FdMisc.upperFirst(d)+"："+l[d]+"<br>"}}Ext.Msg.alert("元数据",u)}})}(0,s.default)(i,[{key:"createTree",value:function e(){this._tree=Ext.create("FreedoX.view.tree.PMTSTree",{store:Ext.create("FreedoX.store.treeData"),width:400});this._tree._clsParent=this}},{key:"getSelectedLayer",value:function e(){return this._selectedLayer}},{key:"addDefaultModelTree",value:function e(){var t=this._tree.getStore().getRoot();var r=Ext.create("FreedoX.model.tree.modelClass",{name:"参数化模型",id:"modelClass",identifier:"modelClass",children:[]});var n=t.appendChild(r);var i=["点","直线","折线","圆","多边形","圆面","圆柱体","管道","一级道路","二级道路","三级道路","围栏","三维标牌","立体标牌","标签","动态线","粒子特效","水域"];var a={"点":"Point","直线":"Line","折线":"Polyline","圆":"Circle","多边形":"Polygon","圆面":"Circlee","圆柱体":"Tube","管道":"Loft","一级道路":"Road1","二级道路":"Road2","三级道路":"Road3","围栏":"Fence","三维标牌":"Billboard","立体标牌":"Billboard3","标签":"Label","动态线":"DynamicLine","粒子特效":"ParticleSystem","水域":"Water"},o={};for(var s in a){o[a[s]]=s}var l=true;var u=false;var d=undefined;try{for(var c=(0,M.default)(i),f;!(l=(f=c.next()).done);l=true){var h=f.value;var p=Ext.create("FreedoX.model.tree.modelClass",{name:h,id:a[h],children:[]});n.appendChild(p)}}catch(e){u=true;d=e}finally{try{if(!l&&c.return){c.return()}}finally{if(u){throw d}}}var v=Ext.create("FreedoX.model.tree.vectorData",{name:"矢量数据",id:"vectorData",identifier:"vectorData",children:[]});var m=t.appendChild(v);function _(e){var t=e.option.option;var r=e.type;if(r=="Circle"&&t.fill)r="Circlee";if(r=="Billboard"&&t.thickness)r="Billboard3";if(r=="Road"){if(t.level=="一级")r="Road1";if(t.level=="二级")r="Road2";if(t.level=="三级")r="Road3"}if(r=="Tube"&&t.thick>0)r="Loft";if(r=="GeoJson"||r=="ShapeFile"){m.appendChild(Ext.create("FreedoX.model.tree.vectorData",{name:r+"_"+(m.childNodes.length+1),id:r+"_"+(m.childNodes.length+1),leaf:true,identifier:"vectorData"+r,checked:true,modelData:e}))}else{var i=n.findChild("id",r);if(!i)return;i.appendChild(Ext.create("FreedoX.model.tree.modelClass",{name:r+"_"+(i.childNodes.length+1),id:r+"_"+(i.childNodes.length+1),leaf:true,identifier:"modelClass"+r,modelData:e.option}))}}this._modelManager&&this._modelManager.on(function(e,t){if(e!=="DataChanged")return;_(t)});var y=this._modelManager.getData();for(var g in y){var w=true;var F=false;var b=undefined;try{for(var C=(0,M.default)(y[g]),x;!(w=(x=C.next()).done);w=true){var P=x.value;_(P)}}catch(e){F=true;b=e}finally{try{if(!w&&C.return){C.return()}}finally{if(F){throw b}}}}}},{key:"addPartImageryTree",value:function e(){var t=this._tree.getStore().getRoot();var r=Ext.create("FreedoX.model.tree.partImagery",{name:"局部影像",id:"partImagery",identifier:"partImagery",children:[]});var i=t.appendChild(r);var n=["水系","其他","U市政公用设施用地","R5配套教育用地","R2二类居住用地","R1一类居住用地","G2防护用地","G1公共用地","F3其他类多功能用地","F2公建混合住宅用地","F1住宅混合公建用地","C6教育科研用地","C5医疗卫生用地","C3文化娱乐用地","C2商业金融用地"];var a={"范围":{id:"FW",url:"http://39.106.48.91:6080/arcgis/rest/services/FW/MapServer/tile/{z}/{y}/{x}"},"水系":{id:"SX",url:"http://39.106.48.91:6080/arcgis/rest/services/SX/MapServer/tile/{z}/{y}/{x}"},"其他":{id:"QT",url:"http://39.106.48.91:6080/arcgis/rest/services/QT/MapServer/tile/{z}/{y}/{x}"},"U市政公用设施用地":{id:"US",url:"http://39.106.48.91:6080/arcgis/rest/services/US/MapServer/tile/{z}/{y}/{x}"},"R5配套教育用地":{id:"R5",url:"http://39.106.48.91:6080/arcgis/rest/services/R5/MapServer/tile/{z}/{y}/{x}"},"R2二类居住用地":{id:"R2",url:"http://39.106.48.91:6080/arcgis/rest/services/R2/MapServer/tile/{z}/{y}/{x}"},"R1一类居住用地":{id:"R1",url:"http://39.106.48.91:6080/arcgis/rest/services/R1/MapServer/tile/{z}/{y}/{x}"},"G2防护用地":{id:"G2",url:"http://39.106.48.91:6080/arcgis/rest/services/G2/MapServer/tile/{z}/{y}/{x}"},"G1公共用地":{id:"G1",url:"http://39.106.48.91:6080/arcgis/rest/services/G1/MapServer/tile/{z}/{y}/{x}"},"F3其他类多功能用地":{id:"F3",url:"http://39.106.48.91:6080/arcgis/rest/services/F3/MapServer/tile/{z}/{y}/{x}"},"F2公建混合住宅用地":{id:"F2",url:"http://39.106.48.91:6080/arcgis/rest/services/F2/MapServer/tile/{z}/{y}/{x}"},"F1住宅混合公建用地":{id:"F1",url:"http://39.106.48.91:6080/arcgis/rest/services/F1/MapServer/tile/{z}/{y}/{x}"},"C6教育科研用地":{id:"C6",url:"http://39.106.48.91:6080/arcgis/rest/services/C6/MapServer/tile/{z}/{y}/{x}"},"C5医疗卫生用地":{id:"C5",url:"http://39.106.48.91:6080/arcgis/rest/services/C5/MapServer/tile/{z}/{y}/{x}"},"C3文化娱乐用地":{id:"C3",url:"http://39.106.48.91:6080/arcgis/rest/services/C3/MapServer/tile/{z}/{y}/{x}"},"C2商业金融用地":{id:"C2",url:"http://39.106.48.91:6080/arcgis/rest/services/C2/MapServer/tile/{z}/{y}/{x}"}},o={};for(var s in a){o[a[s]]=s}var l=true;var u=false;var d=undefined;try{for(var c=(0,M.default)(n),f;!(l=(f=c.next()).done);l=true){var h=f.value;var p=Ext.create("FreedoX.model.tree.partImagery",{name:h,id:a[h].id,children:[],checked:true,url:a[h].url});i.appendChild(p);var v=getRec([12961919.48049962,4879884.29246019,12966372.26013135,4886118.915092985]);p.data.partImagery=new Freedo.ImageryLayer(new Freedo.UrlTemplateImageryProvider({url:p.data.url,rectangle:v}));if(h!="范围")p.data.partImagery.alpha=.5;this._viewer.imageryLayers.add(p.data.partImagery);this._viewer.camera.flyTo({destination:v})}}catch(e){u=true;d=e}finally{try{if(!l&&c.return){c.return()}}finally{if(u){throw d}}}}},{key:"getContainer",value:function e(){this.createTree();this.addDefaultModelTree();return this._tree}},{key:"show",value:function e(){if(!this._win){this.getContainer();this._win=Ext.create("Ext.window.Window",{title:"PMTS管理器",height:this._height,width:this._width,x:10,y:130,layout:"fit",items:this._tree});this._win.on({close:{fn:"onClose",scope:this}});this._win.show();var t=this._pmtsManager.getAllPmts();var r=this;t.forEach(function(e){r.addPMTS2Tree(e)})}this._status.show=true}},{key:"removeFromTree",value:function e(t){var r=this._tree.getStore().getRoot();var i=true;var n=false;var a=undefined;try{for(var o=(0,M.default)(r.childNodes),s;!(i=(s=o.next()).done);i=true){var l=s.value;if(l.data.name==="pmts"){var u=true;var d=false;var c=undefined;try{for(var f=(0,M.default)(l.childNodes),h;!(u=(h=f.next()).done);u=true){var p=h.value;if(p.data.xDataPMTSID==t){l.removeChild(p)}}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}if(l.childNodes.length===0)r.removeChild(l)}}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}}},{key:"removeEntityFromTree",value:function e(t){var r=this._tree.getStore().getRoot();var i=true;var n=false;var a=undefined;try{for(var o=(0,M.default)(r.childNodes),s;!(i=(s=o.next()).done);i=true){var l=s.value;if(l.data.name==="参数化模型"){var u=true;var d=false;var c=undefined;try{for(var f=(0,M.default)(l.childNodes),h;!(u=(h=f.next()).done);u=true){var p=h.value;var v=true;var m=false;var _=undefined;try{for(var y=(0,M.default)(p.childNodes),g;!(v=(g=y.next()).done);v=true){var w=g.value;if(w.data.modelData.id==t){p.removeChild(w);return}}}catch(e){m=true;_=e}finally{try{if(!v&&y.return){y.return()}}finally{if(m){throw _}}}}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}}}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}}},{key:"getSelectedModel",value:function e(){return this._selectedModel}},{key:"getSelectedPMTS",value:function e(){return this._selectedPMTS}},{key:"getSelectedEntity",value:function e(){return this._selectedEntity}},{key:"addPMTS2Tree",value:function e(t){var r=t.jsonPMTSCapabilities.contents;var i=Ext.create("FreedoX.model.tree.PMTS",{mtype:"PMTS",identifier:t.id,name:"pmts",xData:t.jsonPMTSCapabilities,children:[]});if(!Freedo.defined(this._tree)){console.info("FdTree，没有定义");return}var n=this._tree.getStore().getRoot().appendChild(i);for(var a=0;a<r.layers.length;a++){var o=r.layers[a];o.token=t.token;var s=Ext.create("FreedoX.model.tree.layer",{mtype:"layer",name:o.title,xData:o,xDataPMTS:t.jsonPMTSCapabilities,xDataPMTSID:t.id,identifier:o.identifier,children:[]});var l=n.appendChild(s);var u=Freedo.FdServer.FdPMTSParser.getMatrixSets(t.jsonPMTSCapabilities,o);for(var d=0;d<u.length;d++){var c=u[d];c.token=t.token;var f=Ext.create("FreedoX.model.tree.matrixSet",{mtype:"matrixSet",name:c.title,xData:c,xDataPMTSID:t.id,identifier:c.identifier,children:[],checked:true});var h=l.appendChild(f);h.expand();var p=c.matrix;for(var v=0;v<p.length;v++){var m=p[v];m.token=t.token;var _=Ext.create("FreedoX.model.tree.matrix",{mtype:"matrix",name:m.title,xData:m,xDataPMTSID:t.id,identifier:m.identifier,children:[],checked:true});var y=h.appendChild(_);var g=Ext.create("FreedoX.model.tree.component",{mtype:"component",name:"正在获取...",xData:"",identifier:"",children:[]});y.appendChild(g)}}}}},{key:"regLsnr",value:function e(){var n=this;this._pmtsManager.on(function(e,t){if(e==="PmtsLoaded"){var r=n._pmtsManager.getPmts(t);r.id=t;n.addPMTS2Tree(r)}if(e==="DataRemoved"){var i=t;n.removeFromTree(i)}})}},{key:"onClose",value:function e(){this._win=undefined;this._status.show=false}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}}]);return i}();t.FdTree=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdConsole=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function t(e){(0,n.default)(this,t);this._status={show:false};this._viewer;this._pmts=e;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._width=260;this._height=260}(0,o.default)(t,[{key:"addText",value:function e(t){var r=this._textarea.getValue();var r=r==""?"":r+"\n";this._textarea.setValue(r+t)}},{key:"setText",value:function e(t){this._textarea.setValue(t)}},{key:"createTextarea",value:function e(){this._textarea=new Ext.form.TextArea({grow:true,readOnly:false})}},{key:"getContainer",value:function e(){this.createTextarea();return this._textarea}},{key:"show",value:function e(){var t=Ext.getBody().dom.clientWidth;var r=Ext.getBody().dom.clientHeight;this.createTextarea();if(this._win)this._win.show();else{this._win=Ext.create("Ext.window.Window",{title:"控制台",height:this._height,width:this._width,x:t-10-this._width,y:130,layout:"fit",items:this._textarea});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"regLsnr",value:function e(){}},{key:"onClose",value:function e(){this._status.show=false}}]);return t}();t.FdConsole=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdProject=undefined;var i=r(84);var o=h(i);var n=r(232);var l=h(n);var a=r(3);var u=h(a);var s=r(1);var d=h(s);var c=r(2);var f=h(c);function h(e){return e&&e.__esModule?e:{default:e}}var p=function(){function i(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;(0,d.default)(this,i);this._status={show:false};this._viewer=e;this._pmtsManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._grid=undefined;this._width=425;this._height=600;this._projects=[];this._project={};this._forSave=false;this._lsPropName="projects";this._funcs=[];this._selData=undefined;this._shareWin=undefined;r&&this.init();window.setTimeout(this.loadDefaultProject.bind(this))}(0,f.default)(i,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onReName",value:function e(){this._selData=this._grid.selection;if(!this._selData)return;var t=this._selData.data.id;if(!Freedo.defined(t)){return}Ext.MessageBox.prompt("项目重命名","请输入新名称：",this.reNameProject,this)}},{key:"onDelete",value:function e(){Ext.MessageBox.confirm("请确认","确定删除吗？",this.runDelete,this)}},{key:"runDelete",value:function e(t){if(t=="yes"){var r=this._grid.selection;if(!r)return;var i=r.data.id;if(!Freedo.defined(i)){return}if(i==this._project.id){this.unloadProject()}for(var n=0;n<this._projects.length;n++){if(this._projects[n].id==i){this._projects.splice(n,1);this.saveProjects();break}}}}},{key:"onNew",value:function e(){Ext.MessageBox.prompt("项目名称","请输入项目名称：",this.newProject,this)}},{key:"onOpen",value:function e(){this.openProject()}},{key:"onClose",value:function e(){if(Freedo.defined(this._win))this._win.hide();this._status.show=false}},{key:"unloadProject",value:function e(){if(!Freedo.defined(this._project))return;if(Freedo.defined(this._project.id)||this._forSave===false){this._pmtsManager.removeAll();var t=true;var r=false;var i=undefined;try{for(var n=(0,u.default)(this._funcs),a;!(t=(a=n.next()).done);t=true){var o=a.value;var s=o.getDataPropName();o.reset()}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._project={}}}},{key:"add2Projects",value:function e(t){var r=false;var i=true;var n=false;var a=undefined;try{for(var o=(0,u.default)(this._projects),s;!(i=(s=o.next()).done);i=true){var l=s.value;if(l.id==t.id){r=true;break}}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}if(!r){this._projects.push(t)}}},{key:"reNameProject",value:function e(t,r){if(t=="ok"&&r!=""){if(!this._selData)return;this._selData.data.name=r;this._event.raiseEvent("ProjectReNamed",this._project);this.saveProjects()}this._selData=undefined}},{key:"newProject",value:function e(t,r){if(t=="ok"&&r!=""){this.unloadProject();if(Freedo.defined(this._project.id)||this._forSave===false){this._project={}}this._project.id=Freedo.createGuid();this._project.name=r;this._project.date=Freedo.FdMisc.now();this._event.raiseEvent("ProjectOpened",this._project);this.add2Projects(this._project);this.saveProjects();this.onClose();this._forSave=false}}},{key:"getProject",value:function e(t){if(!Freedo.defined(t)){return this._project}var r=true;var i=false;var n=undefined;try{for(var a=(0,u.default)(this._projects),o;!(r=(o=a.next()).done);r=true){var s=o.value;if(s.id==t){return s}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"loadProject",value:function e(t){if(typeof t=="string"){Freedo.Resource.fetchJson({url:t}).then(this.loadProject.bind(this));return}var r=true;var i=false;var n=undefined;try{for(var a=(0,u.default)(this._funcs),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=s.getDataPropName();s.setData(t[l])}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"openProject",value:function e(){var t=this._grid.selection;if(!t)return;this.unloadProject();var r=t.data.id;if(r==this._project.id){var i=Ext.MessageBox["ERROR"];Ext.MessageBox.show({title:"错误",msg:"项目已经打开，不能重复打开",buttons:Ext.MessageBox.OK,scope:this,icon:i});return}if(Freedo.defined(r)){this._project=this.getProject(r);this.loadProject(this._project);this._event.raiseEvent("ProjectOpened",this._project);this.onClose()}}},{key:"reloadProjectList",value:function e(){if(!Freedo.defined(this._grid))return;this._grid.store.removeAll();if(!Freedo.defined(this._projects))return;var t=(0,l.default)(this._projects).reverse();var r=true;var i=false;var n=undefined;try{for(var a=(0,u.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._grid.store.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"saveProject",value:function e(){this._forSave=true;if(!Freedo.defined(this._project.id)){this.onNew()}else{this.saveProjects();Ext.Msg.alert("提示","保存成功")}}},{key:"saveProjects",value:function e(){localStorage[this._lsPropName]=(0,o.default)(this._projects);this.reloadProjectList()}},{key:"readProjects",value:function e(){var t=void 0;if(typeof localStorage[this._lsPropName]!=="undefined"){try{t=JSON.parse(localStorage[this._lsPropName])}catch(e){console.log(e)}}if(t){this._projects=t}else{this._projects=[]}var r=window.location.href;var i=r.indexOf("?params=");if(i>0){var n=r.slice(i+8);n=unescape(n);this._projects.push(JSON.parse(n))}this.reloadProjectList()}},{key:"shareProject",value:function e(){if(this._shareWin==undefined){this._shareWin=Ext.create("Ext.window.Window",{height:200,width:400,title:"项目分享地址",layout:"fit",resizable:false,modal:true,closeAction:"hide",items:[{xtype:"textareafield",itemId:"shareUrl",labelAlign:"top",flex:2,margin:"0",readOnly:true}]});this._shareWin.on({close:{fn:"onClose",scope:this}})}var t=(0,o.default)(this._project);var r="//forweb.gbim360.com/2.3.0/freedox/Examples/FdWidgets.FdMain.html?params="+t;if(r.length>8e3){this._shareWin.items.items[0].setValue("链接信息过长: "+r.length+"，请勿超过8000字符: "+r);this._shareWin.show();return}var i=this;Freedo.FdServer.FdShareServer.getSelfShortURL({url:r},function(e){if(e.Code==0){i._shareWin.items.items[0].setValue(e.ShortUrl);i._shareWin.show()}})}},{key:"getShareShortUrl",value:function e(){}},{key:"init",value:function e(){var a=this;Ext.define("FreedoX.model.Project",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"date",type:"string"}]});Ext.define("FreedoX.store.Projects",{extend:"Ext.data.Store",alias:"store.projects",model:"FreedoX.model.Project",autoLoad:false,pageSize:null});var t=Ext.define("FreedoX.grid.ProjectGrid",{extend:"Ext.grid.Panel",xtype:"project-grid",border:false,requires:["Ext.grid.column.Action"],width:"100%",height:"100%",store:Ext.create("store.projects"),multiSelect:false,viewConfig:{enableTextSelection:false},columns:[{text:"项目名称",flex:3,sortable:false,dataIndex:"name"},{text:"创建日期",flex:2,sortable:true,dataIndex:"date"},{text:"是否默认",flex:1,xtype:"checkcolumn",dataIndex:"defaultProject",checkedTooltip:"设置该项目为默认项目",listeners:{checkchange:function e(t,r,i,n){if(i)a.onSetDefaultProj(n.data.id);else{delete n.data.defaultProject;a.saveProjects()}}}}],listeners:{itemdblclick:this.openProject.bind(this)}});this.readProjects()}},{key:"show",value:function e(){if(this._win)this._win.show();else{this._grid=Ext.create("FreedoX.grid.ProjectGrid");this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"项目管理",layout:"fit",resizable:true,modal:true,closeAction:"hide",items:[{xtype:"form",reference:"windowForm",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:0,items:this._grid,buttons:[],dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",defaultAlign:"r-b",items:[{xtype:"filefield",buttonOnly:true,width:60,buttonText:"导入项目",listeners:{change:this.importProj.bind(this)}},{text:"导出项目",handler:this.exportProj.bind(this)},{text:"重命名",handler:this.onReName.bind(this)},{text:"删除",handler:this.onDelete.bind(this)},{text:"新建",handler:this.onNew.bind(this)},{text:"打开",handler:this.onOpen.bind(this)},{text:"取消",handler:this.onClose.bind(this)}]}]}]});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true;this.readProjects()}},{key:"importProj",value:function e(t){var r=this;var i=t.fileInputEl.dom.files[0];var n=new FileReader;n.readAsText(i);n.onload=function(){var e=JSON.parse(n.result);r._project={id:e.id,name:e.name,date:Freedo.FdMisc.now()};r.loadProject(e);r._event.raiseEvent("ProjectOpened",r._project);r.add2Projects(r._project);r.saveProjects();r.onClose()}}},{key:"exportProj",value:function e(){var t=function e(t,r){var i=document.createElement("a");i.download=r;i.style.display="none";var n=new Blob([t]);i.href=URL.createObjectURL(n);i.click()};var r=this._grid.selection;if(!r){Ext.MessageBox.alert("提示！","请选择一个项目");return}var i=r.data.id;if(Freedo.defined(i)){var n=this.getProject(i);var a="-"+(new Date).toLocaleDateString().replaceAll("/","");t((0,o.default)(n),n.name+a+".json")}}},{key:"onSetDefaultProj",value:function e(t){if(!t){var r=this._grid.selection;if(!r){Ext.MessageBox.alert("提示！","请先选择一个项目");return}t=r.data.id}for(var i=0;i<this._projects.length;i++){if(this._projects[i].id===t)this._projects[i].defaultProject=true;else delete this._projects[i].defaultProject}this.saveProjects()}},{key:"loadDefaultProject",value:function e(){var t=this._projects.find(function(e){return e.defaultProject===true});if(!t)return;this.unloadProject();this._project=t;this.loadProject(this._project);this._event.raiseEvent("ProjectOpened",this._project)}},{key:"regLsnr",value:function e(){}},{key:"regFunc",value:function e(i){if(Freedo.defined(i)){this._funcs.push(i);var t=i.getDataPropName();if(this._project[t])i.setData(this._project[t])}else return;var n=this;i.on(function(e,t){if(e=="DataChanged"){var r=i.getDataPropName();n._project[r]=i.getData()}if(e=="EntDeleted"){var r=i.getDataPropName();n._project[r]=i.getData()}})}}]);return i}();t.FdProject=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPmts=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function r(e,t){(0,n.default)(this,r);this._status={show:false};this._viewer=e;this._pmtsManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._width=600;this._height=500;this.init()}(0,o.default)(r,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onAdd",value:function e(){var t=this._win.down("#pmtsAddress").value;var r=this._win.down("#position").value;var i=this._win.down("#transform").value;var n=4096;var a=32;n=parseInt(this._win.down("#maximumAbsoluteMemoryUsage").value);if(!Freedo.FdMisc.FdMath.isNumber(n)){n=4096}if(this._win.down("#maximumMemoryUsage").value!=""){a=parseInt(this._win.down("#maximumMemoryUsage").value)}if(i!=""&&!i.Has(",")){i="0, 0, "+i}i=i!=""?i.split(","):[0,0,0];r=r!=""?r.split(","):undefined;if(r&&!Freedo.defined(r[2])){r[2]=0}var o=Freedo.Matrix4.IDENTITY;if(r){var s=Freedo.Cartesian3.fromDegrees(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2]));o=Freedo.Transforms.eastNorthUpToFixedFrame(s)}if(t.length>0){if(t.indexOf("http")<0)t="https://cfgateway.gbim360.cn/freeserver-pmts/services/share/"+t;var l=undefined;if(t.Has("token")){l=t.substr(t.indexOf("?token=")+7);t=t.substr(0,t.indexOf("?token="))}this._pmtsManager.add({url:t,rateOfRadius:3,maximumScreenSpaceError:32,maximumAbsoluteMemoryUsage:n,maximumMemoryUsage:a,position:r,modelMatrix:Freedo.Matrix4.toArray(o),transform:i,autoFlyto:true,token:l,rawOption:{}},l)}this._win.close()}},{key:"init",value:function e(){}},{key:"show",value:function e(){if(this._win)this._win.show();else{this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"添加PMTS数据",layout:"fit",resizable:false,modal:true,closeAction:"hide",items:[{xtype:"form",reference:"windowForm",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:10,items:[{xtype:"textareafield",itemId:"pmtsAddress",fieldLabel:"请输入数据地址",labelAlign:"top",flex:5,margin:"0"},{xtype:"textfield",itemId:"position",fieldLabel:"数据坐标，[经度,纬度,高度]，单位：度",labelAlign:"top",flex:2,margin:"0"},{xtype:"textfield",itemId:"maximumAbsoluteMemoryUsage",fieldLabel:"数据最大占用内存量，单位：M",labelAlign:"top",value:"4096",flex:2,margin:"0"},{xtype:"textfield",itemId:"maximumMemoryUsage",fieldLabel:"内存自动清理阈值(留空则为上一个值的四分之一)，单位：MB",labelAlign:"top",value:"",flex:2,margin:"0"},{xtype:"textfield",itemId:"transform",fieldLabel:"数据偏移量[经度,纬度,高度]，单位：度",labelAlign:"top",flex:2,hidden:false,margin:"0"},{xtype:"textareafield",itemId:"pmtsAddressInfo",fieldLabel:"数据地址说明（本地地址要用127.0.0.1，不能用localhost）",labelAlign:"top",flex:5,fieldStyle:{background:"#CCCCCC"},value:"1：http://127.0.0.1/....PMTSCapabilities.json....?accesskey=....\n"+"2：http://127.0.0.1/....PMTSCapabilities.json....?token=....\n"+"3：http://127.0.0.1/sampleData/dizhi0903/tileset.json\n"+"4：http://127.0.0.1/sampleData/dizhi0903/\n"+"5：http://127.0.0.1/sampleData/dizhi0903",margin:"0"}],buttons:[{text:"默认数据位置",handler:this.setDefaultPos.bind(this)},{text:"添加",handler:this.onAdd.bind(this)}]}]});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"regLsnr",value:function e(){}},{key:"onClose",value:function e(){this._status.show=false}},{key:"setDefaultPos",value:function e(){this._win.down("#position").setValue("111,33")}}]);return r}();t.FdPmts=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLayer=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function i(e,t,r){(0,n.default)(this,i);this._status={show:false};this._viewer=e;this._imageryManager=t;this._terrainMgr=r;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._width=400;this._height=300;this.init()}(0,o.default)(i,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onAdd",value:function e(){var t=this._win.down("#pmtsAddress").value;var r=this;if(t.length>0){if(t.indexOf("http")<0){if(t.indexOf("wets")>-1)t="https://cfgateway.gbim360.cn/freeserver-wets/services/share/"+t;if(t.indexOf("wmts")>-1)t="https://cfgateway.gbim360.cn/freeserver-wmts/services/share/"+t}var i=undefined;if(t.indexOf("wets")>-1)r._terrainMgr.setTerrain([{capabilitiesUrl:t}],"wets");if(t.indexOf("wmts")>-1)r._imageryManager.addByPMTS({url:t,autoFly:true})}this._win.close()}},{key:"init",value:function e(){}},{key:"show",value:function e(){if(this._win)this._win.show();else{this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"添加影像、地形数据",layout:"fit",resizable:false,modal:true,closeAction:"hide",items:[{xtype:"form",reference:"windowForm",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:10,items:[{xtype:"textareafield",itemId:"pmtsAddress",fieldLabel:"请输入影像、地形服务的URL地址",labelAlign:"top",flex:2,margin:"0",value:"https://cfgateway.gbim360.cn/freeserver-wmts/services/share/e87a8be8-5d63-43e9-870d-15f1c1152842/wmts/1.1.0/WMTSCapabilities.xml?accesskey=933fec12-628e-43fa-b72f-d75ee1e568dc"}],buttons:[{text:"添加",handler:this.onAdd.bind(this)}]}]});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"regLsnr",value:function e(){}},{key:"onClose",value:function e(){this._status.show=false}}]);return i}();t.FdLayer=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPath=undefined;var i=r(241);var n=c(i);var a=r(3);var l=c(a);var o=r(1);var s=c(o);var u=r(2);var d=c(u);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){function r(e,t){(0,s.default)(this,r);this._status={show:false};this._viewer=e;this._pathManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._grid=undefined;this._gridPoint=undefined;this._width=180;this._height=740;this.init();this._pathManager.setLoop(false);this._pathManager.setKBStatus(true);this._pathManager.setOffsetH(1);this._pathManager.setPathViewMode(true);this._pathManager.setPathShow(true)}(0,d.default)(r,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onAddPath",value:function e(){Ext.MessageBox.prompt("路径名称","请输入路径名称：",this.AddPath,this)}},{key:"onDelPath",value:function e(){var t=this._grid.selection;if(!t){Ext.Msg.alert("提示","请先选择一条路径");return}var r=t.data.id;if(!Freedo.defined(r)){return}this._pathManager.removeGroup(r)}},{key:"onAddPoint",value:function e(){var t=this._pathManager.getCurrentGroupID();if(!Freedo.defined(t)){var r=Ext.MessageBox["INFO"];Ext.MessageBox.show({title:"提示",msg:"请先选择一条路径",buttons:Ext.MessageBox.OK,scope:this,icon:r})}else{this._pathManager.preAppendPathPoint()}}},{key:"onDelPoint",value:function e(){var t=this._gridPoint.selection;var r=t.data.name;var i=this._pathManager.getCurrentGroupID();var n=this._pathManager.getGroupOptions(i).list;var a=undefined;for(var o=0;o<n.length;o++){if(n[o].name==r){a=o}}if(!Freedo.defined(i)){var s=Ext.MessageBox["INFO"];Ext.MessageBox.show({title:"提示",msg:"没有可删除的路径",buttons:Ext.MessageBox.OK,scope:this,icon:s})}else{this._pathManager.removePathPoint(i,a)}}},{key:"AddPath",value:function e(t,r){if(t=="ok"&&r!=""){this._pathManager.createGroup(r)}}},{key:"reloadPaths",value:function e(){this._grid.store.removeAll();var t=this._pathManager.pathsOptions;if(!t)return;for(var r in t){this._grid.store.add(t[r])}var i=this._grid.selection;if(i){var n=i.data.id;var a=this._pathManager.getGroupOptions(ev);this.reloadPoints(a.list)}else{this.reloadPoints([])}}},{key:"reloadPoints",value:function e(t){if(!t)return;this._gridPoint.store.removeAll();var r=true;var i=false;var n=undefined;try{for(var a=(0,l.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._gridPoint.store.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"openPath",value:function e(){var t=this._grid.selection;var r=t.data.id}},{key:"play",value:function e(){this._pathManager.play()}},{key:"pause",value:function e(){this._pathManager.pause()}},{key:"stop",value:function e(){this._pathManager.stop()}},{key:"showPath",value:function e(){this._pathManager.setPathShow(true);this._pathManager.setPathNameShow(true)}},{key:"hidePath",value:function e(){this._pathManager.setPathShow(false);this._pathManager.setPathNameShow(false)}},{key:"init",value:function e(){var a=this;Ext.define("FreedoX.model.Path",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"id",type:"string"}]});Ext.define("FreedoX.model.PathPoint",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"postion",type:"string"}]});Ext.define("FreedoX.store.Paths",{extend:"Ext.data.Store",alias:"store.paths",model:"FreedoX.model.Path",autoLoad:false,pageSize:null});Ext.define("FreedoX.store.PathPoints",{extend:"Ext.data.Store",alias:"store.pathpoints",model:"FreedoX.model.PathPoint",autoLoad:false,pageSize:null});Ext.define("FreedoX.grid.PathGrid",{extend:"Ext.grid.Panel",xtype:"Path-grid",border:false,requires:["Ext.grid.column.Action"],width:"100%",height:"100%",flex:2,store:Ext.create("store.paths"),multiSelect:false,viewConfig:{enableTextSelection:false},selModel:{allowDeselect:false,listeners:{selectionchange:function e(t,r){if(r.length==0)return;var i=t.view.up("");i.onSelectionChange.apply(i,arguments)}}},columns:[{text:"路径名称",flex:.6,sortable:false,dataIndex:"name"}],onSelectionChange:function e(t,r){var i=r[0];var n=this._clsParent;var a=i.data.id;this._clsParent._pathManager.stop();this._clsParent._pathManager.setCurrentGroupID(a)}});Ext.define("FreedoX.grid.PathPointGrid",{extend:"Ext.grid.Panel",xtype:"PathPoint-grid",border:false,requires:["Ext.grid.column.Action"],width:"100%",height:"100%",flex:4,store:Ext.create("store.pathpoints"),multiSelect:false,viewConfig:{enableTextSelection:false},columns:[{text:"点名称",flex:1,sortable:false,dataIndex:"name",tooltipType:"title",tooltip:"点击查看点，双击从该点开始播放动画！"}],listeners:{itemclick:function e(t,r){var i=r.data.position;a._viewer.camera.flyToBoundingSphere(new Freedo.BoundingSphere(Freedo.Cartesian3.fromDegrees(i[0],i[1],i[2]),50),{offset:new Freedo.HeadingPitchRange(a._viewer.camera.heading,a._viewer.camera.pitch,50),duration:2})},itemdblclick:function e(t,r,i,n){a._pathManager.changeStartPoint(n)}}})}},{key:"show",value:function e(){var r=this;if(this._win)this._win.show();else{var t;this._maniPanel=Ext.create("Ext.Panel",{flex:3.3,width:"100%",bodyPadding:"10px 5px",border:false,layout:{type:"table",columns:1},items:[{border:false,width:"100%",items:[{xtype:"button",text:"播放",scale:"small",style:{marginLeft:"10px"},handler:this.play.bind(this)},{xtype:"button",text:"暂停",scale:"small",style:{marginLeft:"10px"},handler:this.pause.bind(this)},{xtype:"button",text:"停止",scale:"small",style:{marginLeft:"10px"},handler:this.stop.bind(this)}]},{border:false,width:"100%",items:[{xtype:"numberfield",labelWidth:30,fieldLabel:"速度",id:"speedField",value:10,allowBlank:true,minValue:1,maxValue:100,width:135,style:{marginTop:"6px",marginLeft:"10px"},listeners:{change:function e(t){r._pathManager.setSpeed(t.value)}}}]},{border:false,width:"100%",items:[(t={xtype:"numberfield",labelWidth:60,width:"50%",fieldLabel:"视点高度",id:"heightField",value:5,allowBlank:true,minValue:1,maxValue:100},(0,n.default)(t,"width",135),(0,n.default)(t,"style",{marginTop:"6px",marginLeft:"10px"}),(0,n.default)(t,"listeners",{change:function e(t){r._pathManager.setHeight(t.value)}}),t)]},{border:false,width:"100%",items:[{xtype:"numberfield",labelWidth:60,width:135,fieldLabel:"平滑度",id:"smoothRateField",value:.1,allowBlank:false,minValue:.001,step:.01,maxValue:30,style:{marginTop:"6px",marginLeft:"10px"},listeners:{change:function e(t){r._pathManager.setSmoothRate(t.value)}}}]},{border:false,width:"100%",items:[{xtype:"numberfield",labelWidth:60,width:135,fieldLabel:"平滑半径",id:"smoothRadiusField",value:0,allowBlank:false,minValue:0,maxValue:3e3,style:{marginTop:"6px",marginLeft:"10px"},listeners:{change:function e(t){r._pathManager.setSmoothRadius(t.value)}}}]},{border:false,width:"100%",items:[{xtype:"button",text:"显示",scale:"small",style:{marginLeft:"25px"},handler:this.showPath.bind(this)},{xtype:"button",text:"隐藏",scale:"small",style:{marginLeft:"25px"},handler:this.hidePath.bind(this)}]}]});this._opPanel=Ext.create("Ext.Panel",{flex:2.9,title:"路径点编辑",width:"100%",bodyPadding:"10px 10px",border:false,layout:{type:"table",columns:2,tdAttrs:{style:"padding: 4px 6px;"}},items:[{xtype:"button",text:"新建路径",scale:"small",handler:this.onAddPath.bind(this)},{xtype:"button",text:"删除路径",scale:"small",handler:this.onDelPath.bind(this)},{xtype:"button",text:"加路径点",scale:"small",handler:this.onAddPoint.bind(this)},{xtype:"button",text:"删路径点",scale:"small",handler:this.onDelPoint.bind(this)},{xtype:"button",text:"开始编辑",scale:"small",handler:this.onStartEditPathPoint.bind(this)},{xtype:"button",text:"结束编辑",scale:"small",handler:this.onEndEditPathPoint.bind(this)},{xtype:"button",text:"上一个点",scale:"small",handler:this.onEditPrePathPoint.bind(this)},{xtype:"button",text:"下一个点",scale:"small",handler:this.onEditNextPathPoint.bind(this)}]});this._grid=Ext.create("FreedoX.grid.PathGrid");this._grid._clsParent=this;this._gridPoint=Ext.create("FreedoX.grid.PathPointGrid");this._gridPoint._clsParent=this;this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"路径管理",layout:"fit",resizable:false,modal:false,x:240,y:150,closeAction:"hide",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:0,items:[this._maniPanel,this._grid,this._gridPoint,this._opPanel]}]});this.regLsnr();this.reloadPaths();this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"regLsnr",value:function e(){this._pathManager.on(function(e,t){if(e=="GroupChanged"){var r=this._pathManager.getGroupOptions(t);this.reloadPoints(r.list);this._pathManager.setPathShow(true);this._pathManager.setPathNameShow(true);this.speed=Freedo.defaultValue(r.speed,10);this.height=Freedo.defaultValue(r.height,5);this.smoothRate=Freedo.defaultValue(r.smoothRate,.1);this.smoothRadius=Freedo.defaultValue(r.smoothRadius,0)}if(e=="GroupsChanged"){this.reloadPaths()}if(e=="KeyPress"){console.log(t)}},this)}},{key:"onClose",value:function e(){this._status.show=false}},{key:"onStartEditPathPoint",value:function e(){this._pathManager.startEdit();this._pathManager.setPathShow(false);this._pathManager.setPathNameShow(false)}},{key:"onEndEditPathPoint",value:function e(){this._pathManager.endEdit();this._pathManager.setPathShow(true);this._pathManager.setPathNameShow(true)}},{key:"onEditNextPathPoint",value:function e(){this._pathManager.editNext()}},{key:"onEditPrePathPoint",value:function e(){this._pathManager.editPre()}},{key:"speed",set:function e(t){var r=this._maniPanel.down("#speedField");r.setValue(t)}},{key:"height",set:function e(t){var r=this._maniPanel.down("#heightField");r.setValue(t)}},{key:"smoothRate",set:function e(t){var r=this._maniPanel.down("#smoothRateField");r.setValue(t)}},{key:"smoothRadius",set:function e(t){var r=this._maniPanel.down("#smoothRadiusField");r.setValue(t)}}]);return r}();t.FdPath=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdView=undefined;var i=r(3);var l=u(i);var n=r(1);var a=u(n);var o=r(2);var s=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,a.default)(this,r);this._status={show:false};this._viewer=e;this._viewPointsManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._grid=undefined;this._gridPoint=undefined;this._width=210;this._height=600;this.init()}(0,s.default)(r,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onAddGroup",value:function e(){Ext.MessageBox.prompt("视点组名称","请输入视点组名称：",this.AddGroup,this)}},{key:"onDelGroup",value:function e(){var t=this._grid.selection;var r=t.data.id;if(!Freedo.defined(r)){return}this._viewPointsManager.removeGroup(r)}},{key:"onAddViewpoint",value:function e(){var t=this._viewPointsManager.getCurrentGroupID();if(!Freedo.defined(t)){var r=Ext.MessageBox["INFO"];Ext.MessageBox.show({title:"提示",msg:"请先创建一个视点组",buttons:Ext.MessageBox.OK,scope:this,icon:r})}else{var i=Freedo.FdCamera.getCurrentCameraInfo(this._viewer.scene.camera);var n=this;Freedo.FdCamera.capture(this._viewer.scene,function(e){n._viewPointsManager.appendViewpoint(t,{name:"视点_"+(new Date).getTime(),icon:e,cameraInfo:i})},68,68)}}},{key:"onDelViewpoint",value:function e(){var t=this._gridPoint.selection;var r=t.data.name;var i=this._viewPointsManager.getCurrentGroupID();var n=this._viewPointsManager.getGroupOptions(i).list;var a=undefined;for(var o=0;o<n.length;o++){if(n[o].name==r){a=o}}if(!Freedo.defined(i)){var s=Ext.MessageBox["INFO"];Ext.MessageBox.show({title:"提示",msg:"没有可删除的视点组",buttons:Ext.MessageBox.OK,scope:this,icon:s})}else{this._viewPointsManager.removeViewpoint(i,a)}}},{key:"AddGroup",value:function e(t,r){if(t=="ok"&&r!=""){this._viewPointsManager.createGroup(r)}}},{key:"reloadGroups",value:function e(){this._grid.store.removeAll();var t=this._viewPointsManager.viewPointsOptions;if(!t)return;for(var r in t){this._grid.store.add(t[r])}}},{key:"reloadPoints",value:function e(t){if(!t)return;this._gridPoint.store.removeAll();var r=true;var i=false;var n=undefined;try{for(var a=(0,l.default)(t),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._gridPoint.store.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}}},{key:"openViewGroup",value:function e(){var t=this._grid.selection;var r=t.data.id}},{key:"play",value:function e(){var t=this._grid.selection;var r=t.data.id;this._viewPointsManager.startOrResumeGroup(r)}},{key:"pause",value:function e(){this._viewPointsManager.pauseGroup()}},{key:"stop",value:function e(){this._viewPointsManager.stopGroup()}},{key:"init",value:function e(){var a=this;Ext.define("FreedoX.model.ViewGroup",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"id",type:"string"}]});Ext.define("FreedoX.model.ViewPoint",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"postion",type:"string"}]});Ext.define("FreedoX.store.ViewGroups",{extend:"Ext.data.Store",alias:"store.viewgroups",model:"FreedoX.model.ViewGroup",autoLoad:false,pageSize:null});Ext.define("FreedoX.store.ViewPoints",{extend:"Ext.data.Store",alias:"store.viewpoints",model:"FreedoX.model.ViewPoint",autoLoad:false,pageSize:null});Ext.define("FreedoX.grid.ViewGroupGrid",{extend:"Ext.grid.Panel",xtype:"ViewGroup-grid",border:false,requires:["Ext.grid.column.Action"],width:"100%",height:"100%",flex:2,store:Ext.create("store.viewgroups"),multiSelect:false,viewConfig:{enableTextSelection:false},selModel:{allowDeselect:false,listeners:{selectionchange:function e(t,r){if(r.length==0)return;var i=t.view.up("");i.onSelectionChange.apply(i,arguments)}}},columns:[{text:"视点组名称",flex:1,sortable:false,dataIndex:"name"}],onSelectionChange:function e(t,r){var i=r[0];var n=this._clsParent;var a=i.data.id;this._clsParent._viewPointsManager.setCurrentGroupID(a)}});Ext.define("FreedoX.grid.ViewPointGrid",{extend:"Ext.grid.Panel",xtype:"ViewPoint-grid",border:false,requires:["Ext.grid.column.Action"],width:"100%",height:"100%",flex:4,store:Ext.create("store.viewpoints"),multiSelect:false,viewConfig:{enableTextSelection:false},columns:[{text:"视点名称",flex:1,sortable:false,dataIndex:"name"}],listeners:{itemclick:function e(t,r,i,n){a._viewPointsManager.flyTo(a._viewPointsManager.getCurrentGroupID(),n)}}})}},{key:"show",value:function e(){if(this._win)this._win.show();else{this._maniPanel=Ext.create("Ext.Panel",{flex:1.5,title:"参数设置",width:"100%",bodyPadding:6,border:false,layout:{type:"table",columns:3,tdAttrs:{style:"padding: 4px 6px;"}},items:[{xtype:"button",text:"播放",scale:"small",handler:this.play.bind(this)},{xtype:"button",text:"暂停",scale:"small",handler:this.pause.bind(this)},{xtype:"button",text:"停止",scale:"small",handler:this.stop.bind(this)}]});this._opPanel=Ext.create("Ext.Panel",{flex:2,title:"鼠标点选",width:"100%",bodyPadding:6,border:false,layout:{type:"table",columns:2,tdAttrs:{style:"padding: 4px 6px;"}},items:[{xtype:"button",text:"新建视点组",scale:"small",handler:this.onAddGroup.bind(this)},{xtype:"button",text:"删除视点组",scale:"small",handler:this.onDelGroup.bind(this)},{xtype:"button",text:"添加当前视点",scale:"small",handler:this.onAddViewpoint.bind(this)},{xtype:"button",text:"删除视点",scale:"small",handler:this.onDelViewpoint.bind(this)}]});this._grid=Ext.create("FreedoX.grid.ViewGroupGrid");this._grid._clsParent=this;this._gridPoint=Ext.create("FreedoX.grid.ViewPointGrid");this._gridPoint._clsParent=this;this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"视点管理",layout:"fit",resizable:false,modal:false,x:240,closeAction:"hide",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:0,items:[this._maniPanel,this._grid,this._gridPoint,this._opPanel]}]});this.regLsnr();this.reloadPoints();this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true;this.reloadGroups()}},{key:"regLsnr",value:function e(){this._viewPointsManager.on(function(e,t){if(e=="GroupChanged"){var r=this._viewPointsManager.getGroupOptions(t);this.reloadPoints(r.list)}if(e=="GroupsChanged"){this.reloadGroups()}if(e=="DataChanged"){console.log(t)}if(e=="KeyPress"){console.log(t)}},this)}},{key:"onClose",value:function e(){this._status.show=false}}]);return r}();t.FdView=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdMain=undefined;var i=r(3);var l=u(i);var n=r(1);var a=u(n);var o=r(2);var s=u(o);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e,t){(0,a.default)(this,r);this._status={show:false};this._viewer=e;this._pmtsManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._vp={};this._ribbon={};this._tabs=[];this._win=undefined;this._ribbon=Ext.widget("ribbonbar",{activeTab:0})}(0,s.default)(r,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"addTab",value:function e(t){this._tabs.push(t)}},{key:"addProp",value:function e(t){this._vp.down("#prop").add(t)}},{key:"addTree",value:function e(t){this._vp.down("#tree").add(t)}},{key:"addConsole",value:function e(t){this._vp.down("#console").add(t)}},{key:"setMainTabTitle",value:function e(t){this._vp.down("#mainTab").setTitle(t)}},{key:"show",value:function e(){var t=this;var r=true;var i=false;var n=undefined;try{for(var a=(0,l.default)(this._tabs),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._ribbon.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._vp=Ext.create("Ext.container.Viewport",{layout:"border",items:[{region:"north",border:false,margin:"0 0 2 0",items:this._ribbon},{region:"west",collapsible:true,title:"目录树",itemId:"tree",layout:"fit",split:true,width:220},{region:"south",title:"状态信息栏",itemId:"console",layout:"fit",collapsible:true,collapsed:true,split:true,height:100,minHeight:100},{region:"east",title:"属性栏",itemId:"prop",layout:"fit",collapsible:true,collapsed:true,split:true,width:240},{region:"center",xtype:"tabpanel",activeTab:0,items:{title:"首页",padding:"2",itemId:"mainTab",html:"<div id='freedoContainer' style='position: absolute;top: 0;bottom: 0;left: 0;right: 0;'><div id='cameraContainer'></div></div>"}}]});setTimeout(function(){t._ribbon.setActiveTab(0)},1e3)}},{key:"regLsnr",value:function e(){}},{key:"onClose",value:function e(){this._status.show=false}}]);return r}();t.FdMain=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDWater=undefined;var i=r(1);var n=o(i);var a=r(264);function o(e){return e&&e.__esModule?e:{default:e}}var s=t.FdDWater=function e(t,r,i){(0,n.default)(this,e);this.createWin=function(){var l=this._water;var u=void 0;Ext.create("Ext.window.Window",{title:"淹没分析",width:360,height:230,x:250,y:160,layout:"fit",items:[{xtype:"form",reference:"windowForm",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:10,items:[{xtype:"sliderfield",fieldLabel:"透明度",axisLock:true,value:100,increment:1,minValue:0,maxValue:100,listeners:{change:function e(t,r,i){l.setOpacity(i.value/100)}}},{xtype:"sliderfield",fieldLabel:"高度",axisLock:false,increment:.1,value:50,id:"height",minValue:0,maxValue:5e3,animate:false,listeners:{change:function e(t,r,i){l.setHeight(parseFloat(i.value))}}},{xtype:"sliderfield",fieldLabel:"起始高度",axisLock:true,value:0,id:"startHeight",increment:1,minValue:0,maxValue:5e3},{xtype:"sliderfield",fieldLabel:"截止高度",axisLock:false,increment:1,id:"endHeight",value:5e3,minValue:0,maxValue:5e3},{xtype:"numberfield",id:"animtionGap",fieldLabel:"动画速度",value:20},{xtype:"panel",border:false,bodyPadding:6,layout:{type:"table",columns:2,tableAttrs:{style:{width:"100%"}},tdAttrs:{style:"padding: 4px 6px;",align:"center"}},items:[{xtype:"button",text:"开始动画",width:"100%",listeners:{click:function e(t,r,i){clearInterval(u);var n=Ext.getCmp("startHeight").getValue();var a=Ext.getCmp("endHeight").getValue();var o=Ext.getCmp("animtionGap").getValue();var s=n;Ext.getCmp("height").setValue(s);u=setInterval(function(){if(s>=a){clearInterval(u);return}Ext.getCmp("height").setValue(s);l.setHeight(s);s+=o},33)}}},{xtype:"button",text:"停止动画",width:"100%",flex:1,listeners:{click:function e(){clearInterval(u)}}}]}]}],listeners:{close:function e(t){l.clear()}}}).show()};this._water=new a.FdWater(t,r,i);this.createWin()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGltfModel=undefined;var i=r(55);var n=u(i);var a=r(1);var o=u(a);var s=r(2);var l=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function r(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};(0,o.default)(this,r);this._viewer=e;t=(0,n.default)({},r.defaultOption,t);this.initUI(t);this._models=[]}(0,l.default)(r,[{key:"initUI",value:function e(t){var r=this;this._mian=Ext.create({xtype:"window",title:"添加gltf模型数据",width:t.width,bodyStyle:{padding:"10px"},hidden:true,closeAction:"hide",fbar:[{xtype:"checkbox",labelPad:null,labelWidth:55,itemId:"flyField",value:true,fieldLabel:"飞向模型"},{type:"button",text:"使用默认位置",handler:function e(){r._locationField.setValue(t.location)}},{type:"button",text:"添加",handler:this.onAddGltf.bind(this)}]});this._urlField=this._mian.add({xtype:"textarea",fieldLabel:"url",width:"100%",labelAlign:"top",allowBlank:false});this._locationField=this._mian.add({xtype:"textfield",fieldLabel:"数据坐标",labelAlign:"top",width:"100%",allowBlank:false});this._flyField=this._mian.dockedItems.get(0).getComponent("flyField")}},{key:"show",value:function e(){this._mian.show()}},{key:"hide",value:function e(){this._mian.close()}},{key:"onAddGltf",value:function e(){var t=this;var r=this._urlField.getValue();var i=this._locationField.getValue().trim().split(","),n=i[2]!=undefined&&i[2]!=""?parseFloat(i[2]):0;var a=Freedo.Cartesian3.fromDegrees(parseFloat(i[0]),parseFloat(i[1]),n),o=Freedo.Transforms.eastNorthUpToFixedFrame(a);var s=Freedo.Model.fromGltf({url:r,modelMatrix:o});this._viewer.scene.primitives.add(s);this._models.push(s);s.readyPromise.then(function(e){t._mian.close();t._flyField.getValue()&&t._viewer.camera.flyTo({destination:a,duration:1})})}}]);return r}();d.defaultOption={width:400,height:200,location:"111,33,10"};t.FdGltfModel=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdVector=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function r(e,t){(0,n.default)(this,r);this._status={show:false};this._viewer=e;this._modelManager=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._win=undefined;this._width=400;this._height=300;this._vector=undefined;this.init()}(0,o.default)(r,[{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"onAdd",value:function e(){var t=this._win.down("#vectorAddress").value;var r=this._win.down("#shpEncoding").getValue().encoding;if(r.length==0)r=undefined;var i=this;if(t.length>0){if(t.indexOf(".shp")>-1){i._vector=i._modelManager.add("ShapeFile",{shpUrl:t,lineColor:Freedo.Color.WHITE,lineWidth:2,encoding:r,autoFly:true})}if(t.indexOf(".geojson")>-1||t.indexOf(".json")>-1){i._vector=i._modelManager.add("GeoJson",{jsonURL:t,label:true,offset:10,labelOption:{textAtt:["名称"]}})}}this._win.close()}},{key:"init",value:function e(){}},{key:"show",value:function e(){if(this._win)this._win.show();else{this._win=Ext.create("Ext.window.Window",{height:this._height,width:this._width,title:"添加矢量数据(shp、geojson)",layout:"fit",resizable:false,modal:true,closeAction:"hide",items:[{xtype:"form",reference:"windowForm",layout:{type:"vbox",align:"stretch"},border:false,bodyPadding:10,items:[{xtype:"textareafield",itemId:"vectorAddress",fieldLabel:"请输入矢量数据地址",labelAlign:"top",flex:2,value:"http://127.0.0.1/data/geojson/%E5%9C%B0%E5%B8%82%E5%90%8D.geojson",margin:"0"},{xtype:"radiogroup",itemId:"shpEncoding",fieldLabel:"shp文件编码",defaults:{flex:1},layout:"hbox",width:"100%",allowBlank:false,items:[{boxLabel:"GB2312",name:"encoding",inputValue:"gb2312",checked:true},{boxLabel:"GBK",name:"encoding",inputValue:"gbk"},{boxLabel:"UTF-8",name:"encoding",inputValue:"utf-8"}]}],buttons:[{text:"添加",handler:this.onAdd.bind(this)}]}]});this._win.on({close:{fn:"onClose",scope:this}});this._win.show()}this._status.show=true}},{key:"regLsnr",value:function e(){}},{key:"onClose",value:function e(){this._status.show=false}}]);return r}();t.FdVector=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdServer=undefined;var i=r(1);var n=v(i);var a=r(713);var o=r(716);var s=r(720);var l=r(721);var u=r(722);var d=r(723);var c=r(724);var f=r(725);var h=r(726);var p=r(727);function v(e){return e&&e.__esModule?e:{default:e}}var m=function e(){(0,n.default)(this,e)};m.FdPMTSServer=a.FdPMTSServer;m.FdUserServer=o.FdUserServer;m.FdSceneServer=s.FdSceneServer;m.FdShareServer=l.FdShareServer;m.FdImagerylayersServer=u.FdImagerylayersServer;m.FdTerrainServer=d.FdTerrainServer;m.FdPMTSParser=c.FdPMTSParser;m.FdModelServer=f.FdModelServer;m.FdGLTFServer=h.FdGLTFServer;m.FdLabelServer=p.FdLabelServer;t.FdServer=m},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FdPMTSServer=undefined;var _regenerator=__webpack_require__(36);var _regenerator2=_interopRequireDefault(_regenerator);var _asyncToGenerator2=__webpack_require__(37);var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);var _classCallCheck2=__webpack_require__(1);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _FdCommon=__webpack_require__(44);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var FdPMTSServer=function e(){(0,_classCallCheck3.default)(this,e)};FdPMTSServer.updateTilesetContent=function(){var o=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,i,n,t,a,o){var s,l,u;return _regenerator2.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s="http://forweb.gbim.vip/cloudlink11/freeserver-pmts/services/"+i+"/pmts/"+n+"/update/tileset?token="+a;l=[];u=void 0;t.prev=3;t.next=6;return _FdCommon.FdCommon.ajaxJson({url:s,data:r,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);u=t.t0;case 12:o(l,u);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n,a){return o.apply(this,arguments)}}();FdPMTSServer.getResourceCount=function(){var n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,i,n,a){var o,s,l;return _regenerator2.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-admin/admin/layer/count?token="+n;s=[];l=void 0;if(!r){r={};r.servicetype="PMTS"}t.prev=4;t.next=7;return _FdCommon.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 7:s=t.sent;t.next=14;break;case 10:t.prev=10;t.t0=t["catch"](4);l=t.t0;console.log("获取列表失败");case 14:a(s,l);case 15:case"end":return t.stop()}}},e,this,[[4,10]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();FdPMTSServer.getResourceList=function(){var n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r,i,n,a){var o,s,l;return _regenerator2.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-admin/admin/layer/get?token="+n;s=[];l=void 0;if(!r){r={};r.servicetype="PMTS"}t.prev=4;t.next=7;return _FdCommon.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 7:s=t.sent;t.next=14;break;case 10:t.prev=10;t.t0=t["catch"](4);l=t.t0;console.log("获取列表失败");case 14:a(s,l);case 15:case"end":return t.stop()}}},e,this,[[4,10]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();FdPMTSServer.getResource=function(){var _ref4=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee4(capaurl,token,callback,option){var pmtsUrl,response,_response;return _regenerator2.default.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:pmtsUrl=capaurl;response=undefined;if(token){pmtsUrl=capaurl+"?token="+token}_context4.prev=3;if(pmtsUrl.Has("PMTSCapabilities.json")){_context4.next=8;break}_response=eval('({"serviceidentification":{"title":"Web P.Model Tile Service - Freedo Holo3D Server","type":"FREEDO PMTS","version":"1.1.0"},"contents":{"layers":[{"identifier":"TempLayer0","title":"TempLayerTitle0","infoformat":["application/json","application/octet-stream","application/null"],"matrixsetlink":["0000000000000000"]}],"matrixsets":[{"identifier":"0000000000000000","title":"TempMatrixTitle0","format":"application/b3dm","compressed":true,"uid":"0000000000000000","propstoragetype":1,"matrix":[{"identifier":"BigFile","title":"BigFile","uid":"BigFile","metadata":{"position":"33.333,111.111,222.222","localrotate":"0,0,0","localscale":"1,1,1","localbounds":{"min":"-557.73217773437500000000,-14.40897464752197300000,-487.44833374023437000000","max":"15516.74707031250000000000,132.97616577148437000000,7427.16943359375000000000"}}}],"resourceurl":[{"format":"application/json","type":"uid","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/uid/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{uid}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"cid","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/cid/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{cid}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/octet-stream","type":"file","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/file/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{filepath}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"prop","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/prop/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{comid}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"tag","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/tag/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{tag}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"kv","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/kv/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{key}/{value}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"id","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/id/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{id}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"nodecount","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/nodecount/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{cid}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"},{"format":"application/json","type":"nodepage","template":"https://cfgateway.gbim360.cn/freeserver-pmts/services/share/0923c98b-443c-44c0-b5e5-9acc5c748ca0/pmts/1.1.0/nodepage/0923c98b-443c-44c0-b5e5-9acc5c748ca0/{matrixset}/{matrix}/{cid}/{offset}/{pagecount}?accesskey=456737d6-60a4-431d-b0b0-b80d5afd6bb2"}]}]}})');parseMatrixs(_response,pmtsUrl,option,callback);return _context4.abrupt("return");case 8:_context4.next=10;return _FdCommon.FdCommon.ajaxJson({url:pmtsUrl,type:"GET"});case 10:response=_context4.sent;_context4.next=16;break;case 13:_context4.prev=13;_context4.t0=_context4["catch"](3);console.error("错误");case 16:callback(response);case 17:case"end":return _context4.stop()}}},_callee4,this,[[3,13]])}));return function(e,t,r,i){return _ref4.apply(this,arguments)}}();function parseMatrixs(i,e,n,a){var o=e.split("\n");var s=[];var l=[];var u=o.length;var t=function e(t){var r=o[t].trim();if(r!=""){if(!r.Has(".json")){if(r.right(1)!="/")r=r+"/";r+="tileset.json"}Freedo.Resource.fetchJson({url:r}).then(function(e){s.push(e);l.push(r);u-=1;if(u<1){s.forEach(function(e,t){return appendMatrix(i,e,{pmtsUrl:l[t],position:n.position})});i.contents.matrixsets[0].matrix.shift();a(i)}},function(e){return u-=1})}else u-=1};for(var r=0;r<o.length;r++){t(r)}}function appendMatrix(e,t,r){var i=Freedo.clone(t,true);var n=r.pmtsUrl.split("/").slice(-2,-1)[0];n=decodeURIComponent(n);var a=e.contents.layers[0];a.identifier="Layer_"+n;a.title="Layer_"+n;a.matrixsetlink=["MatrixSet_"+n];var o=e.contents.matrixsets[0];o.title="MatrixSet_"+n;o.identifier="MatrixSet_"+n;o.uid="MatrixSet_"+n;var s=e.contents.matrixsets[0].matrix[0];s=Freedo.clone(s);e.contents.matrixsets[0].matrix.push(s);s.url=r.pmtsUrl;s.title="Matrix_"+n;s.identifier="Matrix_"+n;s.uid="Matrix_"+n;var l=i.root.boundingVolume.box;if(!l){l=i.root.boundingVolume.sphere;s.metadata.localbounds.max=l.join(",");s.metadata.localbounds.min=l.join(",")}else{var u=[l[3]+l[0],l[7]+l[1],l[11]+l[2]];var d=[l[0]-l[3],l[1]-l[7],l[2]-l[11]];s.metadata.localbounds.max=u.join(",");s.metadata.localbounds.min=d.join(",")}if(Freedo.defined(i.root.transform)){var c=Freedo.Matrix4.fromArray(i.root.transform);var f=new Freedo.Cartesian3;var h=[0,0,0];Freedo.Matrix4.getTranslation(c,f);if(!f.equals(Freedo.Cartesian3.ZERO)){h=Freedo.FdMisc.FdGeometric.tg(f)}else{if(Freedo.defined(r)&&Freedo.defined(r.position)){h=r.position}}s.metadata.position=[h[1],h[0],h[2]].join(",")}}exports.FdPMTSServer=FdPMTSServer},function(e,t,r){var i=function(){return this}()||Function("return this")();var n=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0;var a=n&&i.regeneratorRuntime;i.regeneratorRuntime=undefined;e.exports=r(715);if(n){i.regeneratorRuntime=a}else{try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=undefined}}},function(D,e){!function(e){"use strict";var t=Object.prototype;var u=t.hasOwnProperty;var l;var r=typeof Symbol==="function"?Symbol:{};var n=r.iterator||"@@iterator";var i=r.asyncIterator||"@@asyncIterator";var a=r.toStringTag||"@@toStringTag";var o=typeof D==="object";var s=e.regeneratorRuntime;if(s){if(o){D.exports=s}return}s=e.regeneratorRuntime=o?D.exports:{};function d(e,t,r,i){var n=t&&t.prototype instanceof _?t:_;var a=Object.create(n.prototype);var o=new A(i||[]);a._invoke=M(e,r,o);return a}s.wrap=d;function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}var f="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var m={};function _(){}function y(){}function g(){}var w={};w[n]=function(){return this};var F=Object.getPrototypeOf;var b=F&&F(F(k([])));if(b&&b!==t&&u.call(b,n)){w=b}var C=g.prototype=_.prototype=Object.create(w);y.prototype=C.constructor=g;g.constructor=y;g[a]=y.displayName="GeneratorFunction";function x(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}s.isGeneratorFunction=function(e){var t=typeof e==="function"&&e.constructor;return t?t===y||(t.displayName||t.name)==="GeneratorFunction":false};s.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,g)}else{e.__proto__=g;if(!(a in e)){e[a]="GeneratorFunction"}}e.prototype=Object.create(C);return e};s.awrap=function(e){return{__await:e}};function P(s){function l(e,t,r,i){var n=c(s[e],s,t);if(n.type==="throw"){i(n.arg)}else{var a=n.arg;var o=a.value;if(o&&typeof o==="object"&&u.call(o,"__await")){return Promise.resolve(o.__await).then(function(e){l("next",e,r,i)},function(e){l("throw",e,r,i)})}return Promise.resolve(o).then(function(e){a.value=e;r(a)},i)}}var t;function e(r,i){function e(){return new Promise(function(e,t){l(r,i,e,t)})}return t=t?t.then(e,e):e()}this._invoke=e}x(P.prototype);P.prototype[i]=function(){return this};s.AsyncIterator=P;s.async=function(e,t,r,i){var n=new P(d(e,t,r,i));return s.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})};function M(o,s,l){var u=f;return function e(t,r){if(u===p){throw new Error("Generator is already running")}if(u===v){if(t==="throw"){throw r}return L()}l.method=t;l.arg=r;while(true){var i=l.delegate;if(i){var n=T(i,l);if(n){if(n===m)continue;return n}}if(l.method==="next"){l.sent=l._sent=l.arg}else if(l.method==="throw"){if(u===f){u=v;throw l.arg}l.dispatchException(l.arg)}else if(l.method==="return"){l.abrupt("return",l.arg)}u=p;var a=c(o,s,l);if(a.type==="normal"){u=l.done?v:h;if(a.arg===m){continue}return{value:a.arg,done:l.done}}else if(a.type==="throw"){u=v;l.method="throw";l.arg=a.arg}}}}function T(e,t){var r=e.iterator[t.method];if(r===l){t.delegate=null;if(t.method==="throw"){if(e.iterator.return){t.method="return";t.arg=l;T(e,t);if(t.method==="throw"){return m}}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=c(r,e.iterator,t.arg);if(i.type==="throw"){t.method="throw";t.arg=i.arg;t.delegate=null;return m}var n=i.arg;if(!n){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return m}if(n.done){t[e.resultName]=n.value;t.next=e.nextLoc;if(t.method!=="return"){t.method="next";t.arg=l}}else{return n}t.delegate=null;return m}x(C);C[a]="Generator";C[n]=function(){return this};C.toString=function(){return"[object Generator]"};function E(e){var t={tryLoc:e[0]};if(1 in e){t.catchLoc=e[1]}if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(E,this);this.reset(true)}s.keys=function(r){var i=[];for(var e in r){i.push(e)}i.reverse();return function e(){while(i.length){var t=i.pop();if(t in r){e.value=t;e.done=false;return e}}e.done=true;return e}};function k(t){if(t){var e=t[n];if(e){return e.call(t)}if(typeof t.next==="function"){return t}if(!isNaN(t.length)){var r=-1,i=function e(){while(++r<t.length){if(u.call(t,r)){e.value=t[r];e.done=false;return e}}e.value=l;e.done=true;return e};return i.next=i}}return{next:L}}s.values=k;function L(){return{value:l,done:true}}A.prototype={constructor:A,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=l;this.done=false;this.delegate=null;this.method="next";this.arg=l;this.tryEntries.forEach(S);if(!e){for(var t in this){if(t.charAt(0)==="t"&&u.call(this,t)&&!isNaN(+t.slice(1))){this[t]=l}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var t=e.completion;if(t.type==="throw"){throw t.arg}return this.rval},dispatchException:function(r){if(this.done){throw r}var i=this;function e(e,t){a.type="throw";a.arg=r;i.next=e;if(t){i.method="next";i.arg=l}return!!t}for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];var a=n.completion;if(n.tryLoc==="root"){return e("end")}if(n.tryLoc<=this.prev){var o=u.call(n,"catchLoc");var s=u.call(n,"finallyLoc");if(o&&s){if(this.prev<n.catchLoc){return e(n.catchLoc,true)}else if(this.prev<n.finallyLoc){return e(n.finallyLoc)}}else if(o){if(this.prev<n.catchLoc){return e(n.catchLoc,true)}}else if(s){if(this.prev<n.finallyLoc){return e(n.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&u.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}if(n&&(e==="break"||e==="continue")&&n.tryLoc<=t&&t<=n.finallyLoc){n=null}var a=n?n.completion:{};a.type=e;a.arg=t;if(n){this.method="next";this.next=n.finallyLoc;return m}return this.complete(a)},complete:function(e,t){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&t){this.next=t}return m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e){this.complete(r.completion,r.afterLoc);S(r);return m}}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if(i.type==="throw"){var n=i.arg;S(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){this.delegate={iterator:k(e),resultName:t,nextLoc:r};if(this.method==="next"){this.arg=l}return m}}}(function(){return this}()||Function("return this")())},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdUserServer=undefined;var i=r(36);var l=f(i);var n=r(37);var a=f(n);var o=r(1);var s=f(o);var u=r(44);var d=r(717);var c=f(d);function f(e){return e&&e.__esModule?e:{default:e}}var h=function e(){(0,s.default)(this,e)};h.getVerificationCode=function(){var r=(0,a.default)(l.default.mark(function e(r,i){var n,a,o;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n={sendMode:"1",sendNum:r.toString(),signName:"飞渡科技",useCategory:"regist"};t.prev=1;a=i+"/cloudlink/cloudlink-core-framework/verfy/getVerifyCode";t.next=5;return u.FdCommon.ajaxJson({url:a,data:n,type:"POST"});case 5:o=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](1);console.error(t.t0);case 11:case"end":return t.stop()}}},e,this,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}();h.registerUser=function(){var i=(0,a.default)(l.default.mark(function e(r,i,n){var a,o,s;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=[];t.prev=1;o=Freedo.clone(r);if(Freedo.defined(o.password)){o.password=(0,c.default)(o.password)}s=i+"/cloudlink/freeserver-admin/auth/regist";t.next=7;return u.FdCommon.ajaxJson({url:s,data:o,type:"POST"});case 7:a=t.sent;t.next=13;break;case 10:t.prev=10;t.t0=t["catch"](1);console.error(t.t0);case 13:n(a);case 14:case"end":return t.stop()}}},e,this,[[1,10]])}));return function(e,t,r){return i.apply(this,arguments)}}();h.changePassword=function(){var i=(0,a.default)(l.default.mark(function e(r,i,n){var a,o,s;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=[];t.prev=1;o=Freedo.clone(r);if(Freedo.defined(o.password)){o.password=(0,c.default)(o.password)}s=i+"/cloudlink/cloudlink-core-framework/login/resetPassword";t.next=7;return u.FdCommon.ajaxJson({url:s,data:o,type:"POST"});case 7:a=t.sent;t.next=13;break;case 10:t.prev=10;t.t0=t["catch"](1);console.error(t.t0);case 13:n(a);case 14:case"end":return t.stop()}}},e,this,[[1,10]])}));return function(e,t,r){return i.apply(this,arguments)}}();h.userLogin=function(){var i=(0,a.default)(l.default.mark(function e(r,i,n){var a,o,s;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=[];t.prev=1;o=Freedo.clone(r);o.appId="0154981b-11c5-49ad-839d-a3420af507d8";if(Freedo.defined(o.password)){o.password=(0,c.default)(o.password)}s=i+"/cloudlink/cloudlink-core-framework/login/login";t.next=8;return u.FdCommon.ajaxJson({url:s,data:o,type:"POST"});case 8:a=t.sent;t.next=14;break;case 11:t.prev=11;t.t0=t["catch"](1);console.error(t.t0);case 14:n(a);case 15:case"end":return t.stop()}}},e,this,[[1,11]])}));return function(e,t,r){return i.apply(this,arguments)}}();t.FdUserServer=h},function(e,t,r){(function(){var _=r(718),y=r(265).utf8,g=r(719),w=r(265).bin,F=function(e,t){if(e.constructor==String)if(t&&t.encoding==="binary")e=w.stringToBytes(e);else e=y.stringToBytes(e);else if(g(e))e=Array.prototype.slice.call(e,0);else if(!Array.isArray(e))e=e.toString();var r=_.bytesToWords(e),i=e.length*8,n=1732584193,a=-271733879,o=-1732584194,s=271733878;for(var l=0;l<r.length;l++){r[l]=(r[l]<<8|r[l]>>>24)&16711935|(r[l]<<24|r[l]>>>8)&4278255360}r[i>>>5]|=128<<i%32;r[(i+64>>>9<<4)+14]=i;var u=F._ff,d=F._gg,c=F._hh,f=F._ii;for(var l=0;l<r.length;l+=16){var h=n,p=a,v=o,m=s;n=u(n,a,o,s,r[l+0],7,-680876936);s=u(s,n,a,o,r[l+1],12,-389564586);o=u(o,s,n,a,r[l+2],17,606105819);a=u(a,o,s,n,r[l+3],22,-1044525330);n=u(n,a,o,s,r[l+4],7,-176418897);s=u(s,n,a,o,r[l+5],12,1200080426);o=u(o,s,n,a,r[l+6],17,-1473231341);a=u(a,o,s,n,r[l+7],22,-45705983);n=u(n,a,o,s,r[l+8],7,1770035416);s=u(s,n,a,o,r[l+9],12,-1958414417);o=u(o,s,n,a,r[l+10],17,-42063);a=u(a,o,s,n,r[l+11],22,-1990404162);n=u(n,a,o,s,r[l+12],7,1804603682);s=u(s,n,a,o,r[l+13],12,-40341101);o=u(o,s,n,a,r[l+14],17,-1502002290);a=u(a,o,s,n,r[l+15],22,1236535329);n=d(n,a,o,s,r[l+1],5,-165796510);s=d(s,n,a,o,r[l+6],9,-1069501632);o=d(o,s,n,a,r[l+11],14,643717713);a=d(a,o,s,n,r[l+0],20,-373897302);n=d(n,a,o,s,r[l+5],5,-701558691);s=d(s,n,a,o,r[l+10],9,38016083);o=d(o,s,n,a,r[l+15],14,-660478335);a=d(a,o,s,n,r[l+4],20,-405537848);n=d(n,a,o,s,r[l+9],5,568446438);s=d(s,n,a,o,r[l+14],9,-1019803690);o=d(o,s,n,a,r[l+3],14,-187363961);a=d(a,o,s,n,r[l+8],20,1163531501);n=d(n,a,o,s,r[l+13],5,-1444681467);s=d(s,n,a,o,r[l+2],9,-51403784);o=d(o,s,n,a,r[l+7],14,1735328473);a=d(a,o,s,n,r[l+12],20,-1926607734);n=c(n,a,o,s,r[l+5],4,-378558);s=c(s,n,a,o,r[l+8],11,-2022574463);o=c(o,s,n,a,r[l+11],16,1839030562);a=c(a,o,s,n,r[l+14],23,-35309556);n=c(n,a,o,s,r[l+1],4,-1530992060);s=c(s,n,a,o,r[l+4],11,1272893353);o=c(o,s,n,a,r[l+7],16,-155497632);a=c(a,o,s,n,r[l+10],23,-1094730640);n=c(n,a,o,s,r[l+13],4,681279174);s=c(s,n,a,o,r[l+0],11,-358537222);o=c(o,s,n,a,r[l+3],16,-722521979);a=c(a,o,s,n,r[l+6],23,76029189);n=c(n,a,o,s,r[l+9],4,-640364487);s=c(s,n,a,o,r[l+12],11,-421815835);o=c(o,s,n,a,r[l+15],16,530742520);a=c(a,o,s,n,r[l+2],23,-995338651);n=f(n,a,o,s,r[l+0],6,-198630844);s=f(s,n,a,o,r[l+7],10,1126891415);o=f(o,s,n,a,r[l+14],15,-1416354905);a=f(a,o,s,n,r[l+5],21,-57434055);n=f(n,a,o,s,r[l+12],6,1700485571);s=f(s,n,a,o,r[l+3],10,-1894986606);o=f(o,s,n,a,r[l+10],15,-1051523);a=f(a,o,s,n,r[l+1],21,-2054922799);n=f(n,a,o,s,r[l+8],6,1873313359);s=f(s,n,a,o,r[l+15],10,-30611744);o=f(o,s,n,a,r[l+6],15,-1560198380);a=f(a,o,s,n,r[l+13],21,1309151649);n=f(n,a,o,s,r[l+4],6,-145523070);s=f(s,n,a,o,r[l+11],10,-1120210379);o=f(o,s,n,a,r[l+2],15,718787259);a=f(a,o,s,n,r[l+9],21,-343485551);n=n+h>>>0;a=a+p>>>0;o=o+v>>>0;s=s+m>>>0}return _.endian([n,a,o,s])};F._ff=function(e,t,r,i,n,a,o){var s=e+(t&r|~t&i)+(n>>>0)+o;return(s<<a|s>>>32-a)+t};F._gg=function(e,t,r,i,n,a,o){var s=e+(t&i|r&~i)+(n>>>0)+o;return(s<<a|s>>>32-a)+t};F._hh=function(e,t,r,i,n,a,o){var s=e+(t^r^i)+(n>>>0)+o;return(s<<a|s>>>32-a)+t};F._ii=function(e,t,r,i,n,a,o){var s=e+(r^(t|~i))+(n>>>0)+o;return(s<<a|s>>>32-a)+t};F._blocksize=16;F._digestsize=16;e.exports=function(e,t){if(e===undefined||e===null)throw new Error("Illegal argument "+e);var r=_.wordsToBytes(F(e,t));return t&&t.asBytes?r:t&&t.asString?w.bytesToString(r):_.bytesToHex(r)}})()},function(e,t){(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number){return r.rotl(e,8)&16711935|r.rotl(e,24)&4278255360}for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],r=0,i=0;r<e.length;r++,i+=8)t[i>>>5]|=e[r]<<24-i%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<e.length*32;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++){t.push((e[r]>>>4).toString(16));t.push((e[r]&15).toString(16))}return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3){var i=e[r]<<16|e[r+1]<<8|e[r+2];for(var n=0;n<4;n++)if(r*8+n*6<=e.length*8)t.push(a.charAt(i>>>6*(3-n)&63));else t.push("=")}return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,i=0;r<e.length;i=++r%4){if(i==0)continue;t.push((a.indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|a.indexOf(e.charAt(r))>>>6-i*2)}return t}};e.exports=r})()},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return e!=null&&(r(e)||i(e)||!!e._isBuffer)};function r(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function i(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&r(e.slice(0,0))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdSceneServer=undefined;var i=r(36);var u=l(i);var n=r(37);var a=l(n);var o=r(1);var s=l(o);var d=r(44);function l(e){return e&&e.__esModule?e:{default:e}}var c=function e(){(0,s.default)(this,e)};c.getUserSceneCount=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink//freeserver-ocelot/services/scene/count?token="+n;s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=12;break;case 8:t.prev=8;t.t0=t["catch"](2);s=t.t0;console.error("获取用户场景失败",t.t0);case 12:a(s);case 13:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.getUserScenes=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/getall?token="+n;s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=12;break;case 8:t.prev=8;t.t0=t["catch"](2);s=t.t0;console.error("获取用户场景失败",t.t0);case 12:a(s);case 13:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.getUserShareScenes=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,t){var a=t.size,o=t.number;var s,l;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=Freedo.defaultValue(a,10);o=Freedo.defaultValue(o,1);s=r+"/cloudlink/cloudlink-core-framework/app/dataresource/share/queryMyShareList?token="+i+"&status=1&dataType=scene&_time="+(new Date).getTime()+"&pageSize="+a+"&pageNum="+o;l=[];t.prev=4;t.next=7;return d.FdCommon.ajaxJson({url:s,type:"GET"});case 7:l=t.sent;t.next=14;break;case 10:t.prev=10;t.t0=t["catch"](4);l=t.t0;console.log("获取用户分享场景失败",t.t0);case 14:n(l);case 15:case"end":return t.stop()}}},e,this,[[4,10]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.multiLayerShare=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/layershare?token="+n;s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=12;break;case 8:t.prev=8;t.t0=t["catch"](2);s=t.t0;console.error("操作失败",t.t0);case 12:a(s);case 13:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.getUserSharedScenes=function(){var i=(0,a.default)(u.default.mark(function e(r,i,n){var a,o;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=r+"/cloudlink/cloudlink-core-framework/app/dataresource/share/queryBeSharedList?token="+i+"&status=1&dataType=scene";o=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:a,type:"GET"});case 5:o=t.sent;t.next=12;break;case 8:t.prev=8;t.t0=t["catch"](2);o=t.t0;console.log("获取用户被分享列表失败",t.t0);case 12:n(o);case 13:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r){return i.apply(this,arguments)}}();c.getUserSharedSceneInfo=function(){var r=(0,a.default)(u.default.mark(function e(r,i){var n;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=[];t.prev=1;t.next=4;return d.FdCommon.ajaxJson({url:r,type:"GET"});case 4:n=t.sent;t.next=11;break;case 7:t.prev=7;t.t0=t["catch"](1);n=t.t0;console.log("获取分享场景信息失败",t.t0);case 11:i(n);case 12:case"end":return t.stop()}}},e,this,[[1,7]])}));return function(e,t){return r.apply(this,arguments)}}();c.getUserSceneInfo=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/getone/"+r+"?token="+n+"&_time="+(new Date).getTime();s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:o,type:"GET"});case 5:s=t.sent;t.next=12;break;case 8:t.prev=8;t.t0=t["catch"](2);s=t.t0;console.log("获取项目信息失败",t.t0);case 12:a(s);case 13:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.saveUserScene=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/upsert?token="+n;s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 5:s=t.sent;t.next=10;break;case 8:t.prev=8;t.t0=t["catch"](2);case 10:a(s);case 11:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.deleteUserScene=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/remove/"+r+"?token="+n;s=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:o,type:"GET"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log("删除场景失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();c.deleteShareScene=function(){var n=(0,a.default)(u.default.mark(function e(r,i,n,a){var o,s,l;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/cloudlink-core-framework/app/dataresource/share/delete?token="+n;s={markId:r};l=[];t.prev=3;t.next=6;return d.FdCommon.ajaxJson({url:o,data:s,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);console.log("删除分享场景失败",t.t0);case 12:a(l);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();t.FdSceneServer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdShareServer=undefined;var i=r(36);var d=l(i);var n=r(37);var a=l(n);var o=r(1);var s=l(o);var c=r(44);function l(e){return e&&e.__esModule?e:{default:e}}var u=function e(){(0,s.default)(this,e)};u.getShareObjectID=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/cloudlink-core-framework/app/dataresource/queryList?token="+n+"&appId=0154981b-11c5-49ad-839d-a3420af507d8&dataId="+r.id+"&dataName="+r.name;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,type:"GET"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log(t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.addShareObjectID=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s,l,u;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/cloudlink-core-framework/app/dataresource/add?token="+n;s=(new Date).getTime();l=[];u={appId:"0154981b-11c5-49ad-839d-a3420af507d8",resourceCode:"freedo_data_lid_"+s,resourceName:"freedo_data_lname_"+s,parentId:"610be183-1dda-43ed-8737-49fa2a55cc80",dataId:r.id,dataName:r.name};t.prev=4;t.next=7;return c.FdCommon.ajaxJson({url:o,data:u,type:"POST"});case 7:l=t.sent;t.next=13;break;case 10:t.prev=10;t.t0=t["catch"](4);console.log(t.t0);case 13:a(l);case 14:case"end":return t.stop()}}},e,this,[[4,10]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.getUserList=function(){var i=(0,a.default)(d.default.mark(function e(r,i,n){var a,o;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=r+"/cloudlink/cloudlink-core-framework/user/getListByApp?token="+i+"&appId=0154981b-11c5-49ad-839d-a3420af507d8&pageNum=-1";o=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:a,type:"GET"});case 5:o=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log(t.t0);case 11:n(o);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r){return i.apply(this,arguments)}}();u.addShareScene=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s,l;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/cloudlink-core-framework/app/dataresource/share/add?token="+n;s=[];l={shareType:r.shareType,dataresourceId:r.objectId,accessKeyList:r.accessKeyList,status:1,dataType:r.dataType,effectiveTime:r.effectiveTime,expireTime:r.expireTime,remark:r.remark,optUpdate:1};t.prev=3;t.next=6;return c.FdCommon.ajaxJson({url:o,data:l,type:"POST"});case 6:s=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);console.log(t.t0);case 12:a(s);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.share=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:u.getShareObjectID({id:r.lid,name:r.name},i,n,function(e){var t=undefined;if(e.rows.length){t=e.rows[0].objectId;u.addShareScene({shareType:r.shareType,objectId:t,accessKeyList:r.accessKeyList,effectiveTime:r.effectiveTime,expireTime:r.expireTime,dataType:r.dataType,remark:r.remark},i,n,function(e){a(e)})}else{Freedo.FdServer.FdShareServer.addShareObjectID({id:r.lid,name:r.name},i,n,function(e){t=e.rows[0].objectId;u.addShareScene({shareType:r.shareType,objectId:t,accessKeyList:r.accessKeyList,effectiveTime:r.effectiveTime,expireTime:r.expireTime,dataType:r.dataType,remark:r.remark},i,n,function(e){a(e)})})}});case 1:case"end":return t.stop()}}},e,this)}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.getSelfShortURL=function(){var r=(0,a.default)(d.default.mark(function e(r,i){var n,a;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=[];t.prev=1;a="https://s.ifreedo.cn/services/shorturl";t.next=5;return c.FdCommon.ajaxJson({data:r,url:a,type:"POST"});case 5:n=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](1);console.error(t.t0);case 11:i(n);case 12:case"end":return t.stop()}}},e,this,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}();u.getShortURL=function(){var r=(0,a.default)(d.default.mark(function e(r,i){var n,a;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=[];t.prev=1;a="/cloudlink/freeserver-pmts/services/share/url/simp";t.next=5;return c.FdCommon.ajaxJson({data:r,url:a,type:"POST"});case 5:n=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](1);console.error(t.t0);case 11:i(n);case 12:case"end":return t.stop()}}},e,this,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}();u.getSceneAccesskeyURL=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-ocelot/services/scene/getcapaurl?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log(t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.getLayerAccesskeyURL=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-admin/admin/layer/getcapaurl?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log(t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.createOneImportLayer=function(){var n=(0,a.default)(d.default.mark(function e(r,i,n,a){var o,s;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-admin/admin/layer/importlayer?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,data:r,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log(t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();u.getLayerAccesskeyResource=function(){var i=(0,a.default)(d.default.mark(function e(r,i,n){var a;return d.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.prev=0;t.next=3;return c.FdCommon.ajaxJson({url:r,type:"GET",dataType:i});case 3:a=t.sent;n(a);t.next=10;break;case 7:t.prev=7;t.t0=t["catch"](0);n(undefined,t.t0);case 10:case"end":return t.stop()}}},e,this,[[0,7]])}));return function(e,t,r){return i.apply(this,arguments)}}();t.FdShareServer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdImagerylayersServer=undefined;var i=r(36);var u=l(i);var n=r(37);var a=l(n);var o=r(1);var s=l(o);var d=r(44);function l(e){return e&&e.__esModule?e:{default:e}}var c=function e(){(0,s.default)(this,e)};function f(e,t){var r={};var i=e;var n=i.documentElement;var a=Freedo.defined(n.attributes["xmlns:ows"])?n.attributes["xmlns:ows"].value:"*";var o=n.getElementsByTagName("Contents");var s=o[0].getElementsByTagName("ResourceURL");var l=o[0].getElementsByTagName("Format")[0].innerHTML;var u=o[0].getElementsByTagNameNS(a,"Title")[0].innerHTML;r.name=u;r.format=l;var d=o[0].getElementsByTagNameNS(a,"SupportedCRS")[0].innerHTML;var c=void 0;if(d.includes("4326")){c="Geographic"}else if(d.includes("3857")){c="WebMercator"}r.tilingScheme=c;var f=s.length;var h=[];var p=void 0;for(var v=0;v<f;v++){var m=s[0].getAttribute("template");h.push(m)}for(var _=0;_<f;_++){if(h[_].includes("{TileMatrix}/{TileCol}/{TileRow}")){var y=h[_];var g=y.replace("{TileMatrix}","{z}");var w=g.replace("{TileCol}","{x}");var F=w.replace("{TileRow}","{y}");p=F;break}}r.imgUrl=p+"?token="+t;return r}c.getImagerylayers=function(){var i=(0,a.default)(u.default.mark(function e(r,i,n){var a,o;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=r+("/cloudlink/freeserver-admin/admin/layer/get?token="+i);o=[];t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:a,data:{servicetype:"WMTS"},type:"POST",dataType:"json"});case 5:o=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log("获取列表失败");case 11:n(o);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r){return i.apply(this,arguments)}}();c.getImagerylayer=function(){var i=(0,a.default)(u.default.mark(function e(r,i,n){var a,o,s,l;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a={};o=r+"?token="+i;t.prev=2;t.next=5;return d.FdCommon.ajaxJson({url:o,type:"GET",dataType:"XML"});case 5:s=t.sent;l=f(s,i);a={name:l.name,type:"UrlTemplate",iconUrl:"//res.gbim360.com/lib/freedo/rel/1.5.7/Freedo/Widgets/Images/ImageryProviders/blackMarble.png",layerOption:{show:true,alpha:1},providerOptions:{url:l.imgUrl,maximumLevel:20,tilingScheme:l.tilingScheme}};t.next=13;break;case 10:t.prev=10;t.t0=t["catch"](2);console.log("获取错误");case 13:n(a);case 14:case"end":return t.stop()}}},e,this,[[2,10]])}));return function(e,t,r){return i.apply(this,arguments)}}();t.FdImagerylayersServer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTerrainServer=undefined;var i=r(36);var l=d(i);var n=r(37);var a=d(n);var o=r(1);var s=d(o);var u=r(44);function d(e){return e&&e.__esModule?e:{default:e}}var c=function e(){(0,s.default)(this,e)};function f(e){var t=e;var r=t.documentElement;var i=r.getElementsByTagName("Contents");var n=i[0].getElementsByTagName("ResourceURL");var a=n.length;var o=n[0].getAttribute("template");var s=o.replace("{TileMatrix}/{TileCol}/{TileRow}.bil","");return s}c.getTerrains=function(){var i=(0,a.default)(l.default.mark(function e(r,i,n){var a,o;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=r+("/cloudlink/freeserver-admin/admin/layer/get?token="+i);o=[];t.prev=2;t.next=5;return u.FdCommon.ajaxJson({url:a,data:{servicetype:"WETS"},type:"POST",dataType:"json"});case 5:o=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.log("无法正常获取列表");case 11:n(o);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r){return i.apply(this,arguments)}}();c.getTerrain=function(){var i=(0,a.default)(l.default.mark(function e(r,i,n){var a,o,s;return l.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=[];o=r+"?token="+i;t.prev=2;t.next=5;return u.FdCommon.ajaxJson({url:o,type:"GET",dataType:"XML"});case 5:s=t.sent;a=f(s);t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](2);console.log("添加错误");case 12:n(a);case 13:case"end":return t.stop()}}},e,this,[[2,9]])}));return function(e,t,r){return i.apply(this,arguments)}}();t.FdTerrainServer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPMTSParser=undefined;var i=r(49);var a=p(i);var n=r(3);var N=p(n);var o=r(36);var s=p(o);var l=r(37);var u=p(l);var d=r(1);var c=p(d);var f=function(){var i=(0,u.default)(s.default.mark(function e(r,i){var n;return s.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.prev=0;t.next=3;return h.FdCommon.ajaxJson({url:r,type:"GET"});case 3:n=t.sent;i(n);t.next=10;break;case 7:t.prev=7;t.t0=t["catch"](0);i(undefined,t.t0);case 10:case"end":return t.stop()}}},e,this,[[0,7]])}));return function e(t,r){return i.apply(this,arguments)}}();var h=r(44);function p(e){return e&&e.__esModule?e:{default:e}}var v=function e(){(0,c.default)(this,e);throw new Error("FdPMTSParser should not be instantiated!")};var m=function e(t,r,i){if(t.resourceurl){return t.resourceurl.find(function(e){return e.type===i}).template}if(r.resourceurl){return r.resourceurl.find(function(e){return e.type===i}).template}};function _(e,t,r,i,n,a){var o=t.identifier;var s=r.identifier;var l=m(e,t,"multikv");l=l.replace(/{matrixset}/g,o);l=l.replace(/{matrix}/g,s);l=l.replace(/{key}/g,i);l=l.replace(/{values}/g,n);if(typeof a!=="undefined"){l=l+("?token="+a)}return l}function y(e,t,r,i,n){var a=t.identifier;var o=r.identifier;var s=m(e,t,"uid");s=s.replace(/{matrixset}/g,a);s=s.replace(/{matrix}/g,o);s=s.replace(/{uid}/g,i);if(typeof n!=="undefined"){s=s+("?token="+n)}return s}function g(e,t,r,i,n,a){var o=t.identifier;var s=r.identifier;var l=m(e,t,"cid");if(!t.propstoragetype||t.propstoragetype===1){l=l.replace(/{matrixset}/g,o);l=l.replace(/{matrix}/g,s);l=l.replace(/{cid}/g,n)}if(t.propstoragetype===2){l=l.replace(/{tileno}/g,i);l=l.replace(/{pguid}/g,n)}if(typeof a!=="undefined"){l=l+("?token="+a)}return l}function w(e,t,r,i,n){var a=t.identifier;var o=r.identifier;var s=m(e,t,"prop");if(!t.propstoragetype||t.propstoragetype===1){s=s.replace(/{matrixset}/g,a);s=s.replace(/{matrix}/g,o);s=s.replace(/{comid}/g,i)}if(t.propstoragetype===2){s=s.replace(/{guid}/g,i)}if(typeof n!=="undefined"){s=s+("?token="+n)}return s}function F(e,t,r,i,n){var a=t.identifier;var o=r.identifier;var s=m(e,t,"tag");s=s.replace(/{matrixset}/g,a);s=s.replace(/{matrix}/g,o);s=s.replace(/{tag}/g,i);if(typeof n!=="undefined"){s=s+("?token="+n)}return s}function b(e,t,r,i,n,a){var o=t.identifier;var s=r.identifier;var l=m(e,t,"cid");l=l.replace(/cid/g,"kv");l=l.replace(/{matrixset}/g,o);l=l.replace(/{matrix}/g,s);l=l.replace(/{kv}/g,i+"/"+n);if(typeof a!=="undefined"){l=l+("?token="+a)}return l}v.getLayerFromID=function(e,t){return e.contents.layers.find(function(e){return e.identifier===t})};v.getMatrixSetFromID=function(e,t){return e.contents.matrixsets.find(function(e){return e.identifier===t})};v.getMatrixFromID=function(e,t){return matrixsets.find(function(e){return e.identifier===t})};v.getMatrixSets=function(r,e){var i=[];e.matrixsetlink.forEach(function(e){var t=v.getMatrixSetFromID(r,e);if(typeof t==="undefined"){throw new Error("")}i.push(t)});return i};v.getPModelURL=function(e,t,r,i){if(Freedo.defined(r.url))return r.url;var n=t.identifier;var a=r.identifier;var o=m(e,t,"file");o=o.replace(/{matrixset}/g,n);o=o.replace(/{matrix}/g,a);o=o.replace(/{filepath}/g,a);if(typeof i!=="undefined"){o=o+("?token="+i)}return o};function C(t,n){var a=[];t.contents.layers.forEach(function(i){var e=Freedo.FdServer.FdPMTSParser.getMatrixSets(t,i);e.forEach(function(r){r.matrix.forEach(function(e){var t=Freedo.FdServer.FdPMTSParser.getPModelURL(i,r,e,n);a.push({pModelURL:t,matrix:e,matrixSet:r,layer:i})})})});return a}v.getPModelURLArray=function(){var r=(0,u.default)(s.default.mark(function e(r,i){var n,a;return s.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=r.split("?")[1];a=Freedo.queryToObject(n);if(a.accesskey){Freedo.FdServer.FdShareServer.getLayerAccesskeyResource(r,"json",function(e,t){var r=[];if(t){console.error("FdServer.FdShareServer.getLayerAccesskeyResource got error: "+t);i(r);return}r=C(e);i(r)})}else if(a.token){Freedo.FdServer.FdPMTSServer.getResource(r.split("?")[0],a.token,function(e,t){var r=[];if(t){console.error("FdPMTSServer.getJson got error: "+t);i(r);return}r=C(e,a.token);i(r)})}else{i([])}case 3:case"end":return t.stop()}}},e,this)}));return function(e,t){return r.apply(this,arguments)}}();v.getUidJson=function(e,t,r,i,n,a){i=encodeURIComponent(i);if(r.url){v.getUidJsonByXml(r.url,decodeURIComponent(i),a)}else{var o=y(e,t,r,i,n);f(o,function(e,t){a(e,t)})}};v.getUidJsonByXml=function(e,i,n){e=x(e);v.fetchXML(e.fbsUrl).then(function(r){v.fetchXML(e.ifcUrl).then(function(e){var t=v.parseNodePropInfo(r,e,i);n(t)})})};v.getUidsByKVs=function(e,t,r,i,n,a,o){if(r.url){v.getUidsByKVsFromXml(r.url,i,n,o)}else{var s=_(e,t,r,i,n,a);f(s,function(e,t){o(e,t)})}};v.getUidsByKVsFromXml=function(e,u,t,r){e=x(e);var i=e.fbsUrl;var n=e.ifcUrl;v.fetchXML(i).then(function(t){v.fetchXML(n).then(function(e){a(t,e)})});function a(a,o){var s={values:[],uids:[]};var l=void 0;t.map(function(e){l=o.querySelector("IfcPropertySingleValue[NominalValue='"+e+"']");s.values.push(e);if(l!=null&&l.attributes["Name"]&&l.attributes["Name"].value==u){var t=l.parentNode;var r=t.getAttributeNode("id").value;l=o.querySelector("IfcPropertySet[*|href='#"+r+"']");var i=l.parentNode.getAttributeNode("id").value;l=a.querySelectorAll("Node[name='"+i+"']");l=l[l.length-1];var n=l.getAttribute("uid");s.uids.push(n)}else{s.uids.push("")}});r(s)}};v.getCidJson=function(e,t,r,i,n,a,o){if(r.url&&r.url!=""){v.getCidJsonByXml(r.url,n,i,o)}else{var s=g(e,t,r,i,n,a);f(s,function(e,t){o(e,t)})}};function x(e){e=e.replace("tileset.json","");if(e.slice(-1)!="/")e=e+"/";var t=e.split("/");t.pop();var r=t.pop();var i=e+r+".xml";var n=e+r+"_ifc.xml";return{fbsUrl:decodeURI(i),ifcUrl:decodeURI(n)}}v.getCidJsonByXml=function(e,c,f,h){e=x(e);var t=e.fbsUrl;var r=e.ifcUrl;v.fetchXML(t).then(function(t){v.fetchXML(r).then(function(e){i(t,e)})});function i(e,t){var r=[];var i=void 0;i=e.querySelector('Node[uid="'+c+'"]');if(f=="matrix")i=e.getRootNode().children[0].children[0];if(i==null)return h(r);var n=i.children;var a=true;var o=false;var s=undefined;try{for(var l=(0,N.default)(n),u;!(a=(u=l.next()).done);a=true){var d=u.value;r.push(v.getNodeInfo(t,d))}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}h(r)}};v.parseNodePropInfo=function(e,t,r,i){var n={};if(!e)return n;var a=void 0,o=void 0;if(i)a=e.getRootNode().children[0].children[0];else a=e.querySelector('Node[uid="'+r+'"]');if(!a)return;n.uid=a.getAttribute("uid");n.id=a.getAttribute("name");n.BoundsMin=a.getAttribute("BoundsMin");n.BoundsMax=a.getAttribute("BoundsMax");if(!t)return n;var s=e.querySelectorAll('[name="'+n.id+'"]');o=Array.prototype.indexOf.call(s,a);var l=t.querySelectorAll('[id="'+n.id+'"]');var u=l.length>1?l[o]:l[0];if(!u&&r.lastIndexOf("[")!==-1){var d=r.lastIndexOf("[");var c=r.lastIndexOf("]");var f=r.substring(d+1,c);l=t.querySelectorAll('[Tag="'+f+'"]');u=l.length>1?l[o]:l[0]}if(!u)return n;var h=true;var p=false;var v=undefined;try{for(var m=(0,N.default)(u.attributes),_;!(h=(_=m.next()).done);h=true){var y=_.value;n[y.name]=y.value}}catch(e){p=true;v=e}finally{try{if(!h&&m.return){m.return()}}finally{if(p){throw v}}}var g=u.children;if(g.length>0&&g[0].tagName!="IfcPropertySet")return n;n.propset=[];var w=true;var F=false;var b=undefined;try{for(var C=(0,N.default)(g),x;!(w=(x=C.next()).done);w=true){var P=x.value;var M=P.getAttribute("xlink:href");var T=t.querySelector('[id="'+M.replace("#","")+'"]');if(!T)continue;var E={Name:T.getAttribute("Name"),id:M.replace("#",""),sValue:[]};n.propset.push(E);var S=true;var A=false;var k=undefined;try{for(var L=(0,N.default)(T.children),D;!(S=(D=L.next()).done);S=true){var I=D.value;var R=I.getAttribute("Name");var O=I.getAttribute("NominalValue");E.sValue.push({Name:R,NominalValue:O})}}catch(e){A=true;k=e}finally{try{if(!S&&L.return){L.return()}}finally{if(A){throw k}}}}}catch(e){F=true;b=e}finally{try{if(!w&&C.return){C.return()}}finally{if(F){throw b}}}return n};v.getNodeInfo=function(e,t){var r={};r.uid=t.getAttribute("uid");r.name=t.getAttribute("name");r.BoundsMin=t.getAttribute("BoundsMin");r.BoundsMax=t.getAttribute("BoundsMax");if(!e)return r;var i=e.querySelector('[id="'+r.name+'"]');if(i==null)return r;if(i.tagName=="IfcSite"){r["经度"]=i.getAttribute("RefLongitude");r["纬度"]=i.getAttribute("RefLatitude")}var n=true;var a=false;var o=undefined;try{for(var s=(0,N.default)(i.attributes),l;!(n=(l=s.next()).done);n=true){var u=l.value;r[u.name]=u.value}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}var d=i.children;if(d[0]==undefined||d[0].tagName!="IfcPropertySet"){}else{var c=[];var f=true;var h=false;var p=undefined;try{for(var v=(0,N.default)(d),m;!(f=(m=v.next()).done);f=true){var _=m.value;var y=_.getAttribute("xlink:href");var g=e.querySelector('[id="'+y.replace("#","")+'"]');if(g==null)continue;var w=true;var F=false;var b=undefined;try{for(var C=(0,N.default)(g.children),x;!(w=(x=C.next()).done);w=true){var P=x.value;var M=P.getAttribute("Name");var T=P.getAttribute("NominalValue");r[M]=T}}catch(e){F=true;b=e}finally{try{if(!w&&C.return){C.return()}}finally{if(F){throw b}}}}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}}return r};v.getPropJson=function(e,t,r,i,n,a){if(r.url&&r.url!=""){var o=x(r.url);v.fetchXML(o.fbsUrl).then(function(r){v.fetchXML(o.ifcUrl).then(function(e){var t=v.parseNodePropInfo(r,e,i);if(typeof a=="function")a(t)})})}else{i=encodeURIComponent(i);var s=w(e,t,r,i,n);f(s,function(e,t){a(e,t)})}};v.fetchXML=function(i,n){return new a.default(function(t,e){if(!v._cachedXML)v._cachedXML={};var r=v._cachedXML[i];if(r){if(r===-1)r=undefined;if(typeof n=="function")n(r);t(r)}else{Freedo.Resource.fetchXML({url:i}).then(function(e){v._cachedXML[i]=e;t(v.fetchXML(i,n))},function(e){if(typeof n=="function")n(undefined);v._cachedXML[i]=-1;t(undefined)})}})};v.getTagJson=function(e,t,r,i,n,a){var o=F(e,t,r,i,n);f(o,function(e,t){a(e,t)})};v.getKeyValueJson=function(e,i,n,t,r,a,o,s){var l=this;var u=b(e,i,n,t,r,a);f(u,function(t,r){if(Freedo.defined(t)&&Freedo.defined(s)&&Freedo.defined(s.pModel)){l.getUidBoundingSphere(e,i,n,t.uid,a,s.pModel.modelMatrix,function(e){t.bs=e;o(t,r)})}else{o(t,r)}})};function P(e){var t=e.split(",");var r=[];r=t.map(function(e){return+e});return r}function M(e,t,r,i){var n=new Freedo.Cartesian3(e[0],e[1],e[2]);var a=new Freedo.Cartesian3(t[0],t[1],t[2]);var o=new Freedo.Cartesian3.fromDegrees(r[0],r[1],r[2]);var s=a.y;a.y=-a.z;a.z=s;s=n.y;n.y=-n.z;n.z=s;if(o.x>6378100&&o.y<.1&&o.z<.1){}else{var l=Freedo.Transforms.eastNorthUpToFixedFrame(o);Freedo.Matrix4.multiplyByPoint(l,a,a);Freedo.Matrix4.multiplyByPoint(l,n,n)}if(i){if(Math.abs(i[14])>1e6&&Math.abs(a.z)>1e6){}else{Freedo.Matrix4.multiplyByPoint(i,a,a);Freedo.Matrix4.multiplyByPoint(i,n,n)}}var u=Freedo.BoundingSphere.fromCornerPoints(a,n);return u}v.getMatrixBoundingSphere=function(e,t){if(!e.metadata.localbounds.min)return undefined;var r=P(e.metadata.localbounds.min);var i=P(e.metadata.localbounds.max);var n=P(e.metadata.position);var a=n[0];n[0]=n[1];n[1]=a;var o=M(r,i,n,t);if(o.center.x==0&&o.center.y==0&&o.center.z==0){o.center=new Freedo.Cartesian3(.001,.001,.001)}return o};v.getLayerBoundingSphere=function(e,t,r){var i=Freedo.FdServer.FdPMTSParser.getMatrixSets(e,t);i.forEach(function(e){return getMatrixBoundingSphere(matrix,r)})};v.getUidBoundingSphere=function(e,t,s,r,i,l,u){if(s.uid===r){var n=void 0;if(Freedo.defined(s.url)){n=v.getMatrixBoundingSphere(s,l)}else n=v.getMatrixBoundingSphere(s,l);u(n)}else{v.getUidJson(e,t,s,r,i,function(e,t){if(typeof t!=="undefined"){u(undefined,t);return}if(e&&e.BoundsMin&&e.BoundsMax){var r=P(e.BoundsMin);var i=P(e.BoundsMax);var n=P(s.metadata.position);var a=n[0];n[0]=n[1];n[1]=a;var o=M(r,i,n,l);u(o)}else{u(undefined,"getUidBoundingSphere got error!")}})}};t.FdPMTSParser=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelServer=undefined;var i=r(49);var a=f(i);var n=r(36);var u=f(n);var o=r(37);var s=f(o);var l=r(1);var d=f(l);var c=r(44);function f(e){return e&&e.__esModule?e:{default:e}}var h=function e(){(0,d.default)(this,e);throw new Error("FdModelServer should not be instantiated!")};h.getResourceFinishCount=function(){var n=(0,s.default)(u.default.mark(function e(t,r,i,n){var a,o;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:a=r+"/cloudlink/freeserver-one/services/one/resource/finish/count?token="+i;o=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:a,type:"POST"});case 5:o=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:n(o);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getFinishResource=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/finish/get?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.deleteModel=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/delete/"+r+"?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getResourceErrorCount=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/error/count?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getResourceErrorList=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/error/get?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getResourceExecutingCount=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/execute/count?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getResourceExecutingList=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/execute/get?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getOneResourceInfo=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/getone/"+r.mid+"?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({url:o,type:"GET"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getOneResourceCount=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/count?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.getOneResourceList=function(){var n=(0,s.default)(u.default.mark(function e(r,i,n,a){var o,s;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:o=i+"/cloudlink/freeserver-one/services/one/resource/get?token="+n;s=[];t.prev=2;t.next=5;return c.FdCommon.ajaxJson({data:r,url:o,type:"POST"});case 5:s=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:a(s);case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i){return n.apply(this,arguments)}}();h.oneStepFreedo=function(){var a=(0,s.default)(u.default.mark(function e(r,i,n,a,o){var s,l;return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s=i+"/cloudlink/zuul/freeserver-one/services/one/import?token="+n;l=[];t.prev=2;t.next=5;return p({url:s,data:r,uploadCB:a});case 5:l=t.sent;t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](2);console.error("获取失败",t.t0);case 11:o(JSON.parse(l));case 12:case"end":return t.stop()}}},e,this,[[2,8]])}));return function(e,t,r,i,n){return a.apply(this,arguments)}}();var p=function(){var r=(0,s.default)(u.default.mark(function e(n){return u.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:return t.abrupt("return",new a.default(function(e,t){var r=new XMLHttpRequest;r.withCredentials=true;function i(e){n.uploadCB(e,r)}r.upload.addEventListener("progress",i,false);r.addEventListener("readystatechange",function(){if(this.readyState===4){if(r.status>=200&&r.status<300){e(r.responseText)}else{t(r.responseText)}}});r.open("POST",n.url);r.send(n.data)}));case 1:case"end":return t.stop()}}},e,this)}));return function e(t){return r.apply(this,arguments)}}();t.FdModelServer=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGLTFServer=undefined;var i=r(36);var o=d(i);var n=r(37);var a=d(n);var s=r(1);var l=d(s);var u=r(44);function d(e){return e&&e.__esModule?e:{default:e}}var c=function e(){(0,l.default)(this,e);throw new Error("FdGLTFServer should not be instantiated!")};function f(e,t,r,i){for(var n in e){var a=e[n];if(a.name==="tileset.json"){var o=r.replace("{matrix}",t).replace("{filepath}",a.path);i.push(o)}if(a.cnodes){f(a.cnodes,t,r,i)}}}function h(e){var r=[];e.contents.matrixsets.map(function(e){var t=e.resourceurl.find(function(e){return e.type==="file"}).template;f(e.matrix.cnodes,e.matrix.id,t,r)});return r}c.getGltfUrlArray=function(){var r=(0,a.default)(o.default.mark(function e(r,i){var n,a;return o.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=[];t.prev=1;t.next=4;return u.FdCommon.ajaxJson({url:r,type:"GET"});case 4:a=t.sent;n=h(a);t.next=11;break;case 8:t.prev=8;t.t0=t["catch"](1);console.error("get GLTF json error");case 11:i(n);case 12:case"end":return t.stop()}}},e,this,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}();t.FdGLTFServer=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLabelServer=undefined;var i=r(36);var c=l(i);var n=r(37);var s=l(n);var a=r(1);var o=l(a);var f=r(44);function l(e){return e&&e.__esModule?e:{default:e}}var u=function e(){(0,o.default)(this,e)};u.addLabelToLayer=function(){var a=(0,s.default)(c.default.mark(function e(r,i,n,a,o){var s,l,u;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/insert?token="+a;l=[];u=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:s,data:r,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);u=t.t0;case 12:o(l,u);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n){return a.apply(this,arguments)}}();u.updateLabel=function(){var a=(0,s.default)(c.default.mark(function e(r,i,n,a,o){var s,l,u;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/updatelabel?token="+a;l=[];u=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:s,data:r,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);u=t.t0;case 12:o(l,u);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n){return a.apply(this,arguments)}}();u.insertComment=function(){var o=(0,s.default)(c.default.mark(function e(r,i,n,a,o,s){var l,u,d;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:l=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/insertcomment?token="+a+"&accesskey="+o;u=[];d=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:l,data:r,type:"POST"});case 6:u=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);d=t.t0;case 12:s(u,d);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n,a){return o.apply(this,arguments)}}();u.getLabelsFromLayer=function(){var o=(0,s.default)(c.default.mark(function e(r,i,n,a,o,s){var l,u,d;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:if(Freedo.defined(o)){l=n+"/cloudlink/freeserver-pmts/services/share/"+i+"/label/get/layer?accesskey="+o}else if(Freedo.defined(a)){l=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/get/layer?token="+a}u=[];d=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:l,data:r,type:"POST"});case 6:u=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);d=t.t0;case 12:s(u,d);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n,a){return o.apply(this,arguments)}}();u.getLabelsByLabelID=function(){var o=(0,s.default)(c.default.mark(function e(r,i,n,a,o,s){var l,u,d;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:if(Freedo.defined(o)){l=n+"/cloudlink/freeserver-pmts/services/share/"+i+"/label/get/label?accesskey="+o}else if(Freedo.defined(a)){l=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/get/label?token="+a}u=[];d=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:l,data:r,type:"POST"});case 6:u=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);d=t.t0;case 12:s(u,d);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n,a){return o.apply(this,arguments)}}();u.getLabelsByComponent=function(){var o=(0,s.default)(c.default.mark(function e(r,i,n,a,o,s){var l,u,d;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:if(Freedo.defined(o)){l=n+"/cloudlink/freeserver-pmts/services/share/"+i+"/label/get/comp?accesskey="+o}else if(Freedo.defined(a)){l=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/get/comp?token="+a}u=[];d=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:l,data:r,type:"POST"});case 6:u=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);d=t.t0;case 12:s(u,d);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n,a){return o.apply(this,arguments)}}();u.removeAllLabelInLayer=function(){var a=(0,s.default)(c.default.mark(function e(r,i,n,a,o){var s,l,u;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/remove/layer?token="+a;l=[];u=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:s,data:r,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);u=t.t0;case 12:o(l,u);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n){return a.apply(this,arguments)}}();u.removeLabelByLabelID=function(){var a=(0,s.default)(c.default.mark(function e(r,i,n,a,o){var s,l,u;return c.default.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:s=n+"/cloudlink/freeserver-pmts/services/"+i+"/label/remove/label?token="+a;l=[];u=void 0;t.prev=3;t.next=6;return f.FdCommon.ajaxJson({url:s,data:r,type:"POST"});case 6:l=t.sent;t.next=12;break;case 9:t.prev=9;t.t0=t["catch"](3);u=t.t0;case 12:o(l,u);case 13:case"end":return t.stop()}}},e,this,[[3,9]])}));return function(e,t,r,i,n){return a.apply(this,arguments)}}();t.FdLabelServer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModel=undefined;var i=r(1);var n=u(i);var a=r(729);var o=r(48);var s=r(120);var l=r(270);function u(e){return e&&e.__esModule?e:{default:e}}var d=function e(){(0,n.default)(this,e)};d.FdModelManager=a.FdModelManager;d.FdLoft=o.FdLoft;d.FdChangeablePrimitive=s.FdChangeablePrimitive;d.FdDynamicHemisphere=l.FdDynamicHemisphere;t.FdModel=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdModelManager=undefined;var i=r(3);var v=L(i);var n=r(1);var a=L(n);var o=r(730);var s=r(48);var l=r(731);var u=r(732);var d=r(733);var c=r(734);var f=r(735);var h=r(736);var p=r(737);var m=r(738);var _=r(739);var y=r(266);var g=r(740);var w=r(741);var F=r(742);var b=r(264);var C=r(267);var x=r(743);var P=r(744);var M=r(745);var T=r(269);var E=r(746);var S=r(268);var A=r(270);var k=r(747);function L(e){return e&&e.__esModule?e:{default:e}}var D=function e(t){var r=this;(0,a.default)(this,e);this._viewer=t;this._scene=this._viewer.scene;this._entities=[];this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._labelParentCollection={labels:new Freedo.LabelCollection,billboards:new Freedo.BillboardCollection,points:new Freedo.PointPrimitiveCollection};for(var i in this._labelParentCollection){t.scene.primitives.add(this._labelParentCollection[i])}this._roadMaterial_1=undefined;this._roadMaterial_2=undefined;this._roadMaterial_3=undefined;this._bStillness=false;this._clickMode=Freedo.ScreenSpaceEventType.LEFT_CLICK;this._fed=true;this._index=0;setInterval(function(){if(r._fed){r._index=0;r.updateHeightBatch()}},5e3);this._hlEnt=undefined};D.prototype.addLsnr=function(){if(this._lsner)this._lsner();var e=this};D.prototype.add=function(e,t,r){var i=this;if(!Freedo.defined(e)){console.error("FdModelManager.add：type参数无效")}if(!Freedo.defined(t.id))r=Freedo.defaultValue(r,Freedo.createGuid());else r=t.id;var n=undefined;if(e==="Billboard"){n=new o.FdBillboard(this._viewer,r,t)}else if(e==="Loft"){n=new s.FdLoft(this._viewer,r,t)}else if(e==="TextBox2D"){n=new l.FdTextBox2D(this._viewer,r,t)}else if(e==="Geology"){n=new u.FdGeology(this._viewer,r,t)}else if(e==="Point"){n=new d.FdPoint(this._viewer,r,t)}else if(e==="Line"){n=new c.FdLine(this._viewer,r,t)}else if(e==="Polyline"){n=new f.FdPolyline(this._viewer,r,t)}else if(e==="Polygon"){n=new h.FdPolygon(this._viewer,r,t)}else if(e==="Circle"){n=new p.FdCircle(this._viewer,r,t)}else if(e==="Fence"){n=new m.FdFence(this._viewer,r,t)}else if(e==="Road"){n=new _.FdRoad(this._viewer,r,t)}else if(e==="DynamicLine"){n=new y.FdDynamicLine(this._viewer,r,t)}else if(e==="DynamicTextureLine"){n=new g.FdDynamicTextureLine(this._viewer,r,t)}else if(e==="DynamicTextureLine2"){n=new w.FdDynamicTextureLine2(this._viewer,r,t)}else if(e==="ParticleSystem"){n=new F.FdParticleSystem(this._viewer,r,t)}else if(e==="Water"){n=new b.FdWater(this._viewer,r,t)}else if(e==="Label"){var a=this._labelParentCollection;n=new C.FdLabel(this._viewer,r,t,a)}else if(e==="Plane"){n=new x.FdPlane(this._viewer,r,t)}else if(e==="Tube"){n=new M.FdTube(this._viewer,r,t)}else if(e==="GeoJson"){n=new P.FdGeoJson(this._viewer,r,t)}else if(e==="AnchorLabel"){n=new T.FdAnchorLabel(this._viewer,r,t)}else if(e==="ShapeFile"){n=new E.FdShapeFile(this._viewer,r,t)}else if(e==="DivLabel"){n=new S.FdDivLabel(this._viewer,r,t)}else if(e==="DynamicHemisphere"){n=new A.FdDynamicHemisphere(this._viewer,r,t)}else if(e==="GLTF"){n=new k.FdGltf(this._viewer,r,t)}if(n){n.type=e;n.id=r;this._entities.push(n);n.on(function(e,t){if(!i._bStillness)i._event.raiseEvent(e,t)});return n}};D.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};D.prototype.setClickMode=function(e){this.setClickEventOff();this._clickMode=e};D.prototype.setClickEventOn=function(){var n=this;if(!Freedo.defined(this._screenSpaceEventHandler)){this._screenSpaceEventHandler=new Freedo.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._screenSpaceEventHandler.setInputAction(function(e){var t=n._viewer.scene.pick(e.position);var r=Freedo.defined(t)?t:undefined;if(Freedo.defined(r)){var i=n.getById(r.id);if(i===undefined||i.type===undefined){return}if(i.type==="Label"){n._labelParentCollection.labels.validWhenPicking=true;n._labelParentCollection.points.validWhenPicking=true;n._labelParentCollection.billboards.validWhenPicking=true}n._event.raiseEvent("EntSelected",i);n._event.raiseEvent("SubEntSelected",r)}},this._clickMode)}};D.prototype.setClickEventOff=function(){if(Freedo.defined(this._screenSpaceEventHandler)){this._screenSpaceEventHandler.destroy();this._screenSpaceEventHandler=undefined}this._labelParentCollection.labels.validWhenPicking=false;this._labelParentCollection.points.validWhenPicking=false;this._labelParentCollection.billboards.validWhenPicking=false};D.prototype.check=function(e){var t=this;if(this._index>=this._entities.length){this._fed=true;return}this._fed=false;var r=this._entities[this._index];if(e){if(!r.updateHeight){console.log(r)}else r.updateHeight();this._index++;this.check();return}if(r._data&&r._data.RTHeight){setTimeout(function(){t.check(true)},30)}else{this._index++;this.check()}};D.prototype.updateHeightBatch=function(){this.check()};D.prototype.clearEntities=function(){var e=this._entities;this._entities=[];var t=true;var r=false;var i=undefined;try{for(var n=(0,v.default)(e),a;!(t=(a=n.next()).done);t=true){var o=a.value;o.remove()}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}this._viewer.scene.requestRender()};D.prototype.remove=function(e){var t=e.id;var r=this._entities.indexOf(e);this._entities.splice(r,1);e&&e.remove();this._viewer.scene.requestRender();this._event.raiseEvent("EntDeleted",t)};D.prototype.getById=function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,v.default)(this._entities),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(o.id===e){return o}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};D.prototype.removeById=function(e){var t=true;var r=false;var i=undefined;try{for(var n=(0,v.default)(this._entities),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(o.id===e){this.remove(o);break}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}};D.prototype.checkAtt=function(e,t){for(var r in e){var i=e[r];var n=true;var a=false;var o=undefined;try{for(var s=(0,v.default)(t),l;!(n=(l=s.next()).done);n=true){var u=l.value;if(u.name==r&&u.value==i){return true}}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}return false};D.prototype.highlightGIs=function(e){if(this._hlEnt!=undefined)return;console.log(e);var t=new Freedo.Primitive({geometryInstances:e,asynchronous:false,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.Color.ORANGE}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:false,factor:-1,units:0},depthTest:{enabled:false,func:Freedo.WebGLConstants.LEQUAL}})})});this._hlEnt=this._viewer.scene.primitives.add(t);this._viewer.scene.requestRender();var i=this;function r(){var e=7;var t=true;var r=setInterval(function(){t=!t;e--;if(e>0){i._hlEnt.show=t}else{clearInterval(r);i._viewer.scene.primitives.remove(i._hlEnt);i._hlEnt=undefined}i._viewer.scene.requestRender()},500)}this._hlEnt.readyPromise.then(function(){i._viewer.camera.flyToBoundingSphere(i._hlEnt._boundingSpheres[0],{duration:3,complete:r})})};D.prototype.highlightByAtt=function(e){var t=[];var r=true;var i=false;var n=undefined;try{for(var a=(0,v.default)(this._entities),o;!(r=(o=a.next()).done);r=true){var s=o.value;if(s.type=="ShapeFile"){var l=s._polylines;if(!l)continue;var u=true;var d=false;var c=undefined;try{for(var f=(0,v.default)(l.geometryInstances),h;!(u=(h=f.next()).done);u=true){var p=h.value;if(this.checkAtt(p.att,e)){p.geometry._width=6;t.push(p)}}}catch(e){d=true;c=e}finally{try{if(!u&&f.return){f.return()}}finally{if(d){throw c}}}}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}if(t.length>0)this.highlightGIs(t)};D.prototype.getData=function(){var e={};var t=true;var r=false;var i=undefined;try{for(var n=(0,v.default)(this._entities),a;!(t=(a=n.next()).done);t=true){var o=a.value;if(!Freedo.defined(e[o.type])){e[o.type]=[]}var s=o.getData();if(s){e[o.type].push(s)}}}catch(e){r=true;i=e}finally{try{if(!t&&n.return){n.return()}}finally{if(r){throw i}}}return e};D.prototype.getDataPropName=function(){return"mm"};D.prototype.setData=function(e){if(!Freedo.defined(e))return;this._bStillness=true;var t=[];for(var r in e){var i=e[r];var n=true;var a=false;var o=undefined;try{for(var s=(0,v.default)(i),l;!(n=(l=s.next()).done);n=true){var u=l.value;var d=this.add(u.type,Freedo.clone(u.option),u.id);t.push(d);if(d.type==="ShapeFile"||d.type==="GeoJson")continue;this._event.raiseEvent("DataChanged",d)}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}}this._bStillness=false;return t};D.prototype.removeAll=function(){this.clearEntities()};D.prototype.reset=function(){this.clearEntities();if(this._lsner)this._lsner();this._lsner=undefined;if(Freedo.defined(this._ple))this._ple.cancel()};D.prototype.dispose=function(){this.reset();this.clearEntities()};t.FdModelManager=D},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdBillboard=undefined;var n=r(3);var S=d(n);var a=r(1);var o=d(a);var s=r(2);var l=d(s);var J=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function i(e,t,r){(0,o.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._board=undefined;this._arrow=undefined;this._canvas=r.canvas;this._useCache=r.useCache;this._ple=new u.FdPolylineEditor(this._viewer);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this.create()}(0,l.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdBillboard.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.translucent)){this._data.translucent=false}if(!Freedo.defined(this._data.rotate)){this._data.rotate=0}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};c.prototype.createAreaGeometryInstance=function(e,t){t=t||{};var r;var i=new Freedo.Cartesian3;var n=Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3);var a=Freedo.Cartesian3.subtract(e[2],e[1],new Freedo.Cartesian3);r=Freedo.Cartesian3.cross(n,a,new Freedo.Cartesian3);r=Freedo.Cartesian3.normalize(r,new Freedo.Cartesian3);var o=Freedo.Cartesian3.angleBetween(r,Freedo.Cartesian3.UNIT_Z);var s=Freedo.Cartesian3.cross(r,Freedo.Cartesian3.UNIT_Z,new Freedo.Cartesian3);var l=Freedo.Quaternion.fromAxisAngle(s,o,new Freedo.Quaternion);var u=Freedo.Matrix4.fromTranslationQuaternionRotationScale(new Freedo.Cartesian3,l,new Freedo.Cartesian3(1,1,1));var d=Freedo.Matrix4.multiplyByPointAsVector(u,r,new Freedo.Cartesian3);var c=[];var f=true;var h=false;var p=undefined;try{for(var v=(0,S.default)(e),m;!(f=(m=v.next()).done);f=true){var _=m.value;var y=Freedo.Matrix4.multiplyByPointAsVector(u,_,new Freedo.Cartesian3);c.push(y)}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}var g;if(false){}else{var w=[];var F=[];for(var b=0;b<e.length;b++){w.push(e[b].x*1,e[b].y*1,e[b].z*1);F.push(r.x,r.y,r.z)}var C=Freedo.PolygonPipeline.triangulate(c);var x=undefined;if(Freedo.defined(t.sts)){x=new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(t.sts)})}var P=new Float64Array(w);var M=new Float32Array(F);g=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:true,values:M}),st:x},indices:new Uint16Array(C),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(P)})}var T;if(t.color)T=Freedo.Color.fromBytes(t.color[0],t.color[1],t.color[2],t.color[3]*255);else T=new Freedo.Color(1,1,1,1);var E=new Freedo.GeometryInstance({geometry:g,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(T)},id:this._id});return E};c.prototype.createAreaPrimitive=function(e,t){t=t||{};var r=undefined;if(Freedo.defined(t.createTexture)){r=this.getAppearance()}else{r=new Freedo.PerInstanceColorAppearance({flat:false,translucent:t.translucent,faceForward:true})}return new Freedo.Primitive({geometryInstances:e,appearance:r,asynchronous:false})};c.prototype.callbackM=function(e,t){if(this._canvas)t=this._canvas;var r=Math.random();if(r>.9){this._viewer.scene.requestRender()}return t};c.prototype.refresh=function(){this._viewer.scene.requestRender()};c.prototype.getAppearance=function(){var e="texture2D(image, fract(repeat * materialInput.st)).a";if(this._data.thickness===undefined||this._data.thickness<=0){if(this._data.translucent)e="texture2D(image, fract(repeat * materialInput.st)).a * 0.5"}if(!Freedo.defined(this._canvas)&&!Freedo.defined(this._data.image))console.error("canvas和image没有准备好");this._textureObj=new Freedo.Material({fabric:{type:"Image",uniforms:{image:this._data.image?this._data.image:this._canvas,repeat:new Freedo.Cartesian2(1,1)},components:{alpha:e}}});this._textureObj.update(this._viewer.scene.context);var t=new Freedo.MaterialAppearance({materialSupport:Freedo.MaterialAppearance.MaterialSupport.TEXTURED,material:this._textureObj});return t};c.prototype.updateAppearance=function(){if(this._board){if(this._board instanceof Array){for(var e=0;e<this._board.length-1;e++){this._board[e].appearance=this.getAppearance()}}else{this._board.appearance=this.getAppearance()}}};c.prototype.updateCanvas=function(){var e=this._data.divID;if(typeof html2canvas=="undefined"){console.info("需要引入html2canvas库文件。");return}var t=this;if(this._useCache&&Freedo.defined(this._canvas)){console.log("使用缓存Canvas");t.updateAppearance();return}html2canvas(document.getElementById(e),{display:"inline",backgroundColor:null}).then(function(e){if(Freedo.defined(t._canvas))document.body.removeChild(t._canvas);t._canvas=e;t._canvas.id=t._id;document.body.appendChild(e);t._event.raiseEvent("CanvasBuilt",{id:t._id,canvas:e});t.updateAppearance()})};c.prototype.build=function(){var e=this._data;var t=e.position,r=e.width,i=e.height,n=e.thickness,a=e.outline,o=a===undefined?true:a,s=e.showArrow,l=s===undefined?true:s;if(!Freedo.defined(this._data.image)){this.updateCanvas()}if(!Freedo.defined(r)||!Freedo.defined(i)){console.error("FdBillboard.prototype.build：width或height参数无效");return}var u=this;function d(){var t=Freedo.when.defer();var e=function e(){if(Freedo.defined(u._canvas)){t.resolve()}else{setTimeout(e,50)}};if(Freedo.defined(u._data.image)){t.resolve()}else e();return t.promise}d().then(function(){if(n===undefined||n<=0){u.build2DBillboard(e)}else{u.build3DBillboard(e)}});if(l)this.showArrow();else this.hideArrow();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.build2DBillboard=function(e){var e=this._data;var t=e.position,r=e.width,i=e.height,n=e.thickness,a=e.outline,o=a===undefined?true:a,s=e.showArrow,l=s===undefined?true:s;var u=t[2];var d=Freedo.Math.toRadians(e.rotate);var c=J.FdMisc.FdGeometric.tc(t);var f=Freedo.Cartographic.fromCartesian(c);var h=J.FdMisc.FdGeometric.getLongAndLatRatio(f);var p=[];var v=[t[0]+Freedo.Math.toDegrees(r*h[0]/2)*Math.cos(d),t[1]+Freedo.Math.toDegrees(r*h[1]/2)*Math.sin(d),i+u+r/10];var m=[v[0],v[1],u+r/10];var _=[t[0]-Freedo.Math.toDegrees(r*h[0]/2)*Math.cos(d),t[1]-Freedo.Math.toDegrees(r*h[1]/2)*Math.sin(d),i+u+r/10];var y=[_[0],_[1],u+r/10];p=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(_,v,m,y));var g=this.createAreaGeometryInstance(p,{sts:[0,1,1,1,1,0,0,0]});this._board=this._viewer.scene.primitives.add(this.createAreaPrimitive(g,{translucent:e.translucent,createTexture:true}));var w=[];w=Freedo.Cartesian3.fromDegreesArrayHeights([t[0],t[1],u,t[0]+Freedo.Math.toDegrees(r*h[0]/10)*Math.cos(d),t[1]+Freedo.Math.toDegrees(r*h[1]/10)*Math.sin(d),r/10+u,t[0]-Freedo.Math.toDegrees(r*h[0]/10)*Math.cos(d),t[1]-Freedo.Math.toDegrees(r*h[1]/10)*Math.sin(d),r/10+u,t[0],t[1],u]);var F=this.createAreaGeometryInstance(w,{color:e.arrowColor});this._arrow=this._viewer.scene.primitives.add(this.createAreaPrimitive(F,{translucent:e.translucent}))};c.prototype.build3DBillboard=function(e){var e=this._data;var t=e.position,r=e.width,i=e.height,n=e.thickness,a=e.outline,o=a===undefined?true:a;var s=t[2];var l=Freedo.Math.toRadians(e.rotate);var u=J.FdMisc.FdGeometric.tc(t);var d=Freedo.Cartographic.fromCartesian(u);var c=J.FdMisc.FdGeometric.getLongAndLatRatio(d);var f=[t[0]-Freedo.Math.toDegrees(r*c[0]/2)*Math.cos(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]-Freedo.Math.toDegrees(r*c[1]/2)*Math.sin(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),i+s+r/10];var h=[f[0],f[1],s+r/10];var p=[t[0]+Freedo.Math.toDegrees(r*c[0]/2)*Math.cos(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]+Freedo.Math.toDegrees(r*c[1]/2)*Math.sin(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),i+s+r/10];var v=[p[0],p[1],s+r/10];var m=[t[0]+Freedo.Math.toDegrees(r*c[0]/2)*Math.cos(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]+Freedo.Math.toDegrees(r*c[1]/2)*Math.sin(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),i+s+r/10];var _=[m[0],m[1],s+r/10];var y=[t[0]-Freedo.Math.toDegrees(r*c[0]/2)*Math.cos(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]-Freedo.Math.toDegrees(r*c[1]/2)*Math.sin(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),i+s+r/10];var g=[y[0],y[1],s+r/10];var w=[],F=[],b=[],C=[],x=[],P=[];w=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(y,m,_,g));F=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(p,f,h,v));b=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(f,y,g,h));C=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(m,p,v,_));x=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(f,p,m,y));P=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(g,_,v,h));var M=[];var T=[];var E=this.createAreaGeometryInstance(w,{sts:[0,1,1,1,1,0,0,0]});var S=this.createAreaGeometryInstance(F,{sts:[0,1,1,1,1,0,0,0]});var A=this.createAreaGeometryInstance(b);var k=this.createAreaGeometryInstance(C);var L=this.createAreaGeometryInstance(x);var D=this.createAreaGeometryInstance(P);M.push(E);M.push(S);T.push(A);T.push(k);T.push(L);T.push(D);var I=this._viewer.scene.primitives.add(this.createAreaPrimitive(M,{translucent:e.translucent,createTexture:true}));var R=this._viewer.scene.primitives.add(this.createAreaPrimitive(T,{translucent:e.translucent}));I.show=true;R.show=true;this._board=[I,R];var O=[t[0]-Freedo.Math.toDegrees(r*c[0]/10)*Math.cos(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]-Freedo.Math.toDegrees(r*c[1]/10)*Math.sin(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),s+r/10];var N=[t[0]+Freedo.Math.toDegrees(r*c[0]/10)*Math.cos(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]+Freedo.Math.toDegrees(r*c[1]/10)*Math.sin(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),s+r/10];var B=[t[0]+Freedo.Math.toDegrees(r*c[0]/10)*Math.cos(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]+Freedo.Math.toDegrees(r*c[1]/10)*Math.sin(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),s+r/10];var H=[t[0]-Freedo.Math.toDegrees(r*c[0]/10)*Math.cos(l)+Freedo.Math.toDegrees(n*c[0]/2)*Math.sin(l),t[1]-Freedo.Math.toDegrees(r*c[1]/10)*Math.sin(l)-Freedo.Math.toDegrees(n*c[0]/2)*Math.cos(l),s+r/10];var V=[t[0],t[1],s];var G=[],z=[],U=[],j=[];G=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(H,B,V));j=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(B,N,V));U=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(O,H,V));z=Freedo.Cartesian3.fromDegreesArrayHeights([].concat(N,O,V));var q=[];var W=this.createAreaGeometryInstance(G,{color:e.arrowColor});var X=this.createAreaGeometryInstance(j,{color:e.arrowColor});var Z=this.createAreaGeometryInstance(U,{color:e.arrowColor});var Y=this.createAreaGeometryInstance(z,{color:e.arrowColor});q.push(W);q.push(X);q.push(Z);q.push(Y);this._arrow=this._viewer.scene.primitives.add(this.createAreaPrimitive(q,{translucent:e.translucent}))};c.prototype.addLsnr=function(){if(this._lsner)this._lsner();var n=this;this._lsner=this._ple.on(function(e,t){if(e=="cancel"){this.cancel()}if(e=="PointAdded"){n._data.position=Freedo.clone(t.position,true);n._ple.cancel();n._lsner();n.build()}if(e=="Transformed"){var r=t.positionG;var i=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height);n._data.position=Freedo.FdMisc.FdGeometric.tg(i);n.clear();n.build()}})};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.startEdit=function(){console.info("开始编辑");this.addLsnr();var e=J.FdMisc.FdGeometric.tc(this._data.position);this._ple.startEdit([e])};c.prototype.endEdit=function(){this._ple.endEdit()};c.prototype.clear=function(){if(this._board!==undefined){if(this._board instanceof Array){for(var e=0;e<this._board.length;e++){this._viewer.scene.primitives.remove(this._board[e])}}else{this._viewer.scene.primitives.remove(this._board)}}if(this._arrow!==undefined){if(this._arrow instanceof Array){for(var t=0;t<this._arrow.length;t++){this._viewer.scene.primitives.remove(this._arrow[t])}}else{this._viewer.scene.primitives.remove(this._arrow)}}if(this._canvas&&!this._useCache){document.body.removeChild(this._canvas);this._canvas=undefined}this._board=undefined;this._arrow=undefined;this._viewer.scene.requestRender()};c.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};c.prototype.show=function(){if(this._board){if(this._board.length!==undefined){for(var e=0;e<this._board.length;e++){this._board[e].show=true}}else{this._board.show=true}}if(this._arrow){if(this._arrow.length!==undefined){for(var t=0;t<this._arrow.length;t++){this._arrow[t].show=true}}else{this._arrow.show=true}}};c.prototype.hide=function(){if(this._board){if(this._board.length!==undefined){for(var e=0;e<this._board.length;e++){this._board[e].show=false}}else{this._board.show=false}}if(this._arrow){if(this._arrow.length!==undefined){for(var t=0;t<this._arrow.length;t++){this._arrow[t].show=false}}else{this._arrow.show=false}}};c.prototype.showArrow=function(){if(this._arrow){if(this._arrow.length!==undefined){for(var e=0;e<this._arrow.length;e++){this._arrow[e].show=true}}else{this._arrow.show=true}this._data.showArrow=true}};c.prototype.hideArrow=function(){if(this._arrow){if(this._arrow.length!==undefined){for(var e=0;e<this._arrow.length;e++){this._arrow[i].show=false}}else{this._arrow.show=false}this._data.showArrow=false}};c.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Billboard",option:e}};c.prototype.setModelMatrix=function(e){if(this._board){if(this._board.length!==undefined){for(var t=0;t<this._board.length;t++){this._board[t].modelMatrix=e}}else{this._board.modelMatrix=e}}if(this._arrow){if(this._arrow.length!==undefined){for(var r=0;r<this._arrow.length;r++){this._arrow[r].modelMatrix=e}}else{this._arrow.modelMatrix=e}}this._viewer.scene.requestRender()};c.prototype.setRotate=function(e,t){this._data.rotate=e;t=Freedo.defaultValue(t,true);if(t){this.clear();this.build()}};c.prototype.getRotate=function(){return this._data.rotate};c.prototype.setPosition=function(e,t,r,i){this._data.position=[e,t,r];i=Freedo.defaultValue(i,true);if(i){this.clear();this.build()}};c.prototype.getPosition=function(){return this._data.position};c.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};c.prototype.dispose=function(){this.reset();this.remove()};t.FdBillboard=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTextBox2D=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var l=r(5);var s=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._basePtCo=e.scene.primitives.add(new Freedo.PointPrimitiveCollection);this._basePt=undefined;this._canvas=undefined;this._ple=new s.FdPolylineEditor(e);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();d.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdTextBox2D.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.paddingLeft)){this._data.paddingLeft=50}if(!Freedo.defined(this._data.moveTop)){this._data.moveTop=50}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};d.prototype.refresh=function(){this._viewer.scene.requestRender()};d.prototype.update=function(){if(!Freedo.defined(this._basePt))return;var e=this._basePt.computeScreenSpacePosition(this._viewer.scene,new Freedo.Cartesian2);if(!Freedo.defined(e))return false;var t=this._data,r=t.lineWidth,i=r===undefined?1:r,n=t.lineColor,a=n===undefined?"white":n,o=t.textColor,s=o===undefined?"white":o,l=t.fontSize,u=l===undefined?16:l;var d=this._viewer.container.getClientRects()[0].x;var c=this._viewer.container.getClientRects()[0].y;this._canvas.style.left=d+(e.x+0)+"px";this._canvas.style.top=c+(e.y-this._data.moveTop)+"px";var f=this._canvas.getContext("2d");f.clearRect(0,0,this._canvas.width,this._canvas.height);f.lineWidth=i;f.strokeStyle=a;f.shadowColor="rgba(0, 0, 0, 0.8)";f.shadowOffsetX=1;f.shadowOffsetY=1;f.shadowBlur=10;var h=this._data.paddingLeft;var p=1;var v=10;var m=this._data.width-h;var _=this._data.height-p;f.beginPath();f.moveTo(h,p+v*2);f.lineTo(2,this._data.moveTop-p);f.moveTo(h+v,p);f.lineTo(h+m-v,p);f.arcTo(h+m,p,h+m,p+v,v);f.lineTo(h+m,p+_-v);f.arcTo(h+m,p+_,h+m-v,p+_,v);f.lineTo(h+v,p+_);f.arcTo(h,p+_,h,p+_-v,v);f.lineTo(h,p+v);f.arcTo(h,p,h+v,p,v);f.closePath();f.stroke();f.font=u+"px 雅黑";f.lineWidth=i;f.fillStyle=s;f.textAlign="left";var y=this._data.text.split("|");for(var g=0;g<y.length;g++){f.fillText(y[g],h+10,p+(u+4)*(g+1))}};d.prototype.build=function(){var e=this._data;var t=e.position;var r=e.width;var i=e.height;if(!Freedo.defined(r)||!Freedo.defined(i)){console.error("FdTextBox2D.prototype.build：width或height参数无效");return}if(!t)return;var n=l.FdMisc.FdGeometric.tc(t);var a=Freedo.Cartographic.fromCartesian(n);var o=l.FdMisc.FdGeometric.getLongAndLatRatio(a);this._data.positionC=Freedo.clone(n,true);var s=2e7;this._basePt=this._basePtCo.add({position:n,pixelSize:10,show:true,color:Freedo.Color.YELLOW,disableDepthTestDistance:Number.POSITIVE_INFINITY});if(this._canvas){document.body.removeChild(this._canvas);this._canvas=undefined}this._canvas=document.createElement("canvas");this._canvas.id=this._id;this._canvas.style.position="absolute";this._canvas.style.display="block";this._canvas.style.zIndex="999";this._canvas.width=e.width+10;this._canvas.height=e.height+10;this._canvas.style.pointerEvents="none";this._canvas.addEventListener("click",function(e){console.log("click")},false);this._canvas.ondrag=function(e){console.log("ondrag")};document.body.appendChild(this._canvas);if(e.show===false){this.hide()}this.update();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};d.prototype.addLsnr=function(){if(this._lsner)this._lsner();var n=this;this._lsner=this._ple.on(function(e,t){if(e=="cancel"){this.cancel()}if(e=="PointAdded"){n._data.position=Freedo.clone(t.position,true);n._ple.cancel();n._lsner();n.build()}if(e=="Transformed"){var r=t.positionG;var i=Freedo.Cartesian3.fromRadians(r.longitude,r.latitude,r.height);n._data.position=Freedo.FdMisc.FdGeometric.tg(i);n.clear();n.build()}})};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.startEdit=function(){console.info("开始编辑");this.addLsnr();this._ple.startEdit([this._data.positionC])};d.prototype.endEdit=function(){this._ple.endEdit()};d.prototype.clear=function(){this._basePtCo.remove(this._basePt);if(this._canvas){document.body.removeChild(this._canvas);this._canvas=undefined}this._viewer.scene.requestRender()};d.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};d.prototype.show=function(){if(this._basePt){this._basePt.show=true}if(this._canvas){this._canvas.style.display="block"}if(this._data){this._data.show=true}this._viewer.scene.requestRender()};d.prototype.hide=function(){if(this._basePt){this._basePt.show=false}if(this._canvas){this._canvas.style.display="none"}if(this._data){this._data.show=false}this._viewer.scene.requestRender()};d.prototype.setText=function(e){this.clear();this._data.text=e;this.build()};d.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"TextBox2D",option:e}};d.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};d.prototype.dispose=function(){this.reset();this.remove()};t.FdTextBox2D=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGeology=undefined;var i=r(1);var n=s(i);var a=r(2);var o=s(a);var v=r(5);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._data=r;this._id=t;this._isDisconnect=false;this._triEntities=[];this._triangles=[];this._edgePoints=[];this._points=this._viewer.scene.primitives.add(new Freedo.PointPrimitiveCollection);this._lines=[];this._bb=undefined;this.create();if(Freedo.defined(this._data.clipTexture)){this._textureObj=new Freedo.Material({fabric:{type:"Image",uniforms:{image:r.clipTexture,repeat:new Freedo.Cartesian2(1,1),color:new Freedo.Color(1,1,1,1)},components:{alpha:"color.a"}}});this._textureObj.update(e.scene.context)}this._aClipPolygon=[];this._data.showClipPolygon=Freedo.defaultValue(this._data.showClipPolygon,true)}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();l.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdGeology.prototype.create：参数无效");return}if(!Freedo.defined(this._data.ptsData)){console.error("FdGeology.prototype.create：顶点信息ptsData没有定义");return}if(!Freedo.defined(this._data.indexData)){console.error("FdGeology.prototype.create：索引信息indexData没有定义");return}if(!Freedo.defined(this._data.ptsIndex)){console.error("FdGeology.prototype.create：顶点索引ptsIndex没有定义");return}if(!Freedo.defined(this._data.offset)){this._data.offset=[0,0]}if(this._data.isRawData){this.dataPreProcess()}this.build()};l.prototype.refresh=function(){this._viewer.scene.requestRender()};l.prototype.dataPreProcess=function(){};l.prototype.getPoint=function(e,t){var r=t[e*3]+this._data.offset[0];var i=t[e*3+1]+this._data.offset[1];var n=t[e*3+2];var a=new Freedo.Cartesian3(r,i,n);return a};l.prototype.build=function(){var e=this._data;var t=e.position;var r=void 0;if(t){r=Freedo.Transforms.eastNorthUpToFixedFrame(t);Freedo.Matrix4.multiply(e.modelMatrix,r,r)}if(e.ptsIndex instanceof Array){for(var i=0;i<e.ptsIndex.length;i++){var n=e.indexData[e.ptsIndex[i]];var a=e.ptsData[e.ptsIndex[i]];this.loadTriangles(n,a,r,e.isAbsolutePosition)}}else{var n=e.indexData[e.ptsIndex];var a=e.ptsData[e.ptsIndex];this.loadTriangles(n,a,r,e.isAbsolutePosition)}this._viewer.scene.requestRender()};l.prototype.loadTriangles=function(e,t,r,i){var n=this._data;for(var a=0;a<e.length;a=a+4){var o=this.getPoint(Math.abs(e[a])-1,t);var s=this.getPoint(Math.abs(e[a+1])-1,t);var l=this.getPoint(Math.abs(e[a+2])-1,t);var u,d,c;if(i){u=o;d=s;c=l}else{u=Freedo.Matrix4.multiplyByPoint(r,o,new Freedo.Cartesian3);d=Freedo.Matrix4.multiplyByPoint(r,s,new Freedo.Cartesian3);c=Freedo.Matrix4.multiplyByPoint(r,l,new Freedo.Cartesian3)}if(n.buildEnt){var f=Freedo.FdMisc.FdGeometric.createAreaPrimitive([u,d,c],{});var h=this._viewer.scene.primitives.add(f);this._triEntities.push(h)}this._triangles.push([u,d,c])}};l.prototype.findNextLineOfPt=function(e,t){var r=undefined;var i=999999;var n=undefined;for(var a=0;a<t.length;a=a+1){var o=t[a];if(o.used==false){var s=Freedo.Cartesian3.distance(o.pt1,e);var l=Freedo.Cartesian3.distance(o.pt2,e);var u=s<l?s:l;if(u<i){n=a;i=u;if(s<l){r=[];r.push(o.pt1);r.push(o.pt2)}else{r=[];r.push(o.pt2);r.push(o.pt1)}}}}if(i>1){console.log("长度大于1了。");return undefined}if(n!=undefined){t[n].used=true}return r};l.prototype.buildRings=function(e){var t=[];var r=[];this._isDisconnect=false;for(var i=0;i<e.length;i=i+1){if(r.length==0&&e[i].used==false){r.push(e[i].pt1);r.push(e[i].pt2);e[i].used=true;console.log("ring分配了一个起点");continue}if(r.length==0)continue;var n=this.findNextLineOfPt(r[r.length-1],e);if(n){r.push(n[0]);r.push(n[1])}else{if(r.length>2)t.push(r);r=[];i=0;continue}}if(r.length>2){console.log("添加一个ring，长度："+r.length);t.push(r)}return t};l.prototype.getClipEdge=function(e,t,r){var i=this._data;var n=[];var a=[];for(var o=0;o<this._triangles.length;o++){var s=this._triangles[o];var l=Freedo.IntersectionTests.trianglePlaneIntersection(s[0],s[1],s[2],e);if(l!=undefined){var u=l.positions[3];var d=l.positions[4];if(Freedo.Cartesian3.distance(u,d)>0){n.push(u);n.push(d)}else{console.log("=0")}a.push({pt1:u,pt2:d,used:false})}}var c=this.buildRings(a);var i={show:true,textureObj:this._textureObj,holes:t};for(var o=0;o<c.length;o++){var f=c[o];if(this._isDisconnect&&c.length==1){f=v.FdMisc.FdGeometric.clearPts(f);console.log("点清洗")}f=v.FdMisc.FdGeometric.clearPts(f);if(this._data.showClipPolygon){var h=Freedo.FdMisc.FdGeometric.createAreaPrimitive(f,i);var p=this._viewer.scene.primitives.add(h);this._aClipPolygon.push(p)}}if(this._data.showClipGeoAtt)this.showGeoAttribute(c,r);return c};l.prototype.showGeoAttribute=function(e,t){var r,i,n,a;if(t&&t.startPt&&t.endPt){r=Freedo.Cartesian3.subtract(t.startPt,t.endPt,new Freedo.Cartesian3);i=Freedo.Cartesian3.cross(r,t.endPt,new Freedo.Cartesian3);n=Freedo.Cartesian3.normalize(i,new Freedo.Cartesian3);var o=30+Math.random()*20;if(o<40)o=40;a=Freedo.Cartesian3.multiplyByScalar(n,o,new Freedo.Cartesian3)}else return;for(var s=0;s<e.length;s++){var l=e[s];var u=v.FdMisc.FdGeometric.getCenterOfPts(l);var d=Freedo.Cartesian3.add(u,a,new Freedo.Cartesian3);var c=Freedo.FdMisc.FdGeometric.createPolylinePrimitive([u,d],{color:Freedo.Color.fromRandom({minimumRed:.5,maxmumRed:1,green:1,minimumBlue:.1,maximumBlue:.5,alpha:.4})});var f=this._viewer.scene.primitives.add(c);this._lines.push(f);this._points.add({position:u,pixelSize:5,show:true,disableDepthTestDistance:Number.POSITIVE_INFINITY,color:new Freedo.Color(1,1,0,1)});this._points.add({position:d,pixelSize:5,show:true,disableDepthTestDistance:Number.POSITIVE_INFINITY,color:new Freedo.Color(1,1,0,1)});if(Freedo.defined(this._data.mm)){this._bb=this._data.mm.add("Billboard",{id:this._divid,position:Freedo.FdMisc.FdGeometric.tg(d),height:2,width:9.33,thickness:.8,rotate:20,image:this._data.image,outline:true,translucent:false},this._divid)}break}};l.prototype.showClipPlane=function(){this._aClipPolygon.forEach(function(e){e.show=true})};l.prototype.addLsnr=function(){if(this._lsner)this._lsner();var e=this};l.prototype.on=function(e,t){};l.prototype.setClipPlaneAlpha=function(e){if(this._aClipPolygon.length==0)return;for(var t=0;t<this._aClipPolygon.length;t++){var r=this._aClipPolygon[t];var i=r.appearance.material.uniforms.color;i.alpha=e}};l.prototype.setClipPlaneShow=function(e){if(this._aClipPolygon.length==0)return;for(var t=0;t<this._aClipPolygon.length;t++){var r=this._aClipPolygon[t];r.show=e}};l.prototype.clear=function(){var r=this;this._aClipPolygon.forEach(function(e,t){r._viewer.scene.primitives.remove(e)});this._aClipPolygon=[];this._points.removeAll();this._lines.forEach(function(e,t){r._viewer.scene.primitives.remove(e)});if(Freedo.defined(this._data.mm)&&this._bb!=undefined){this._data.mm.remove(this._bb);this._bb=undefined}this._viewer.scene.requestRender()};l.prototype.remove=function(){this.clear();this._triangles=[];this._data=undefined;this._viewer.scene.requestRender()};l.prototype.show=function(){for(var e=0;e<this._triEntities.length;e++){this._triEntities[e].show=true}};l.prototype.hide=function(){for(var e=0;e<this._triEntities.length;e++){this._triEntities[e].show=false}};l.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Geology",option:e}};l.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined};l.prototype.dispose=function(){this.reset();this.remove()};t.FdGeology=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPoint=undefined;var i=r(18);var n=c(i);var a=r(1);var o=c(a);var s=r(2);var l=c(s);var u=r(5);var d=r(10);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){function i(e,t,r){(0,o.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new d.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._points=e.scene.primitives.add(new Freedo.PointPrimitiveCollection);this._point=undefined;this.create()}(0,l.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();f.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdPoint.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};f.prototype.refresh=function(){this._viewer.scene.requestRender()};f.prototype.build=function(){var e=Freedo.clone(this._data);e.position=Freedo.FdMisc.FdGeometric.tc(e.position);if(e.pointColor)e.color=Freedo.Color.fromBytes(e.pointColor[0],e.pointColor[1],e.pointColor[2],e.pointColor[3]*255);else e.color=Freedo.Color.YELLOW;e.outlineColor=Freedo.defaultValue(e.outlineColor,Freedo.Color.YELLOW);e.pixelSize=Freedo.defaultValue(e.pixelSize,5);this._point=this._points.add((0,n.default)({id:this._id},e,{disableDepthTestDistance:Number.POSITIVE_INFINITY}));this._event.raiseEvent("DataChanged",this)};f.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){r._data.position=t.position;r._ple.cancel();r._ple.removeAll();r.build()}})};f.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};f.prototype.clear=function(){this._points.removeAll();this._viewer.scene.primitives.remove(this._points);this._viewer.scene.requestRender()};f.prototype.remove=function(){this.clear();this._data=undefined;this._point=undefined;this._viewer.scene.requestRender()};f.prototype.show=function(){this._point.show=true;this._viewer.scene.requestRender()};f.prototype.hide=function(){this._point.show=false;this._viewer.scene.requestRender()};f.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Point",option:e}};f.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};f.prototype.dispose=function(){this.reset();this.remove()};t.FdPoint=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLine=undefined;var i=r(3);var d=c(i);var n=r(1);var a=c(n);var o=r(2);var s=c(o);var l=r(5);var u=r(10);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){function i(e,t,r){(0,a.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._line=undefined;this.create()}(0,s.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();f.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdLine.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.pts){this._data.pts=[];this._ple.run();this.addLsnr()}else{this.build()}};f.prototype.refresh=function(){this._viewer.scene.requestRender()};f.prototype.build=function(){var e=this._data;var t=e.pts;this._line=this._viewer.scene.primitives.add(this.createLinePrimitive(t,e));this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};f.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;var i=0;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){r._data.pts.push(t.position);i+=1;if(i>=2){r._ple.cancel();r.build()}}if(e=="Finished"){if(i==1){r._ple.cancel()}}})};f.prototype.createLinePrimitive=function(e,t){var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,d.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;r.push(Freedo.FdMisc.FdGeometric.tc(l))}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}if(t.lineColor)this._lineColor=Freedo.Color.fromBytes(t.lineColor[0],t.lineColor[1],t.lineColor[2],t.lineColor[3]*255);else this._lineColor=Freedo.Color.YELLOW;var u=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:r,width:Freedo.defaultValue(t.lineWidth,3),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:this._lineColor}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,false),func:Freedo.WebGLConstants.LEQUAL}})})});if(t.depthTest)u.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:this._lineColor}}})});return u};f.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};f.prototype.clear=function(){this._viewer.scene.primitives.remove(this._line);this._line=undefined;this._viewer.scene.requestRender()};f.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};f.prototype.show=function(){this._line.show=true;this._viewer.scene.requestRender()};f.prototype.hide=function(){this._line.show=false;this._viewer.scene.requestRender()};f.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"Line",option:this._data}};f.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};f.prototype.dispose=function(){this.reset();this.remove()};t.FdLine=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPolyline=undefined;var i=r(1);var n=d(i);var a=r(2);var o=d(a);var s=r(5);var l=r(10);var u=r(48);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new l.FdPolylineEditor(e);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._polyline=undefined;this._positions=[];this._lines=[];this._ratio=undefined;this._automatic=undefined;this._flow=undefined;this._offset=new Freedo.Cartesian2(.5,0);this._lineColor=undefined;this._bContinuity=true;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdPolyline.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}this._data.depthTest=Freedo.defaultValue(this._data.depthTest,false);this._bContinuity=Freedo.defaultValue(this._data.continuity,true);if(!this._data.pts&&!this._data.lines){this._data.pts=[];var e=Freedo.defaultValue(this._data.autoClose,false);this._ple.setAutoLoop(e);this._ple.setAutoDelLines(true);this._ple.run();this.addLsnr()}else{this.build()}};c.prototype.refresh=function(){this._viewer.scene.requestRender()};c.prototype.build=function(){var e=this._data;if(Freedo.defined(e.pts)){var t=e.pts;this._offset=new Freedo.Cartesian2(0,0);if(!this._bContinuity)this._offset=new Freedo.Cartesian2(.5,0);for(var r=0;r<t.length;r++){var i=Freedo.FdMisc.FdGeometric.tc(t[r]);this._positions.push(i)}if(e.imageURL){var n=this.fineness(Freedo.defaultValue(e.fineness,1),this._positions);this._polyline=this._viewer.scene.primitives.add(this.createImageLinePrimitive(n,e));this.startFlow(e.speed)}else{this._polyline=this._viewer.scene.primitives.add(this.createLinePrimitiveByPoints(this._positions,e))}}else if(Freedo.defined(e.lines)){var a=e.lines;this._polyline=this._viewer.scene.primitives.add(this.createLinePrimitiveByLines(a,e))}this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){r._data.pts=t.polyline.ptsG;r._ple.cancel()}if(e=="Cancel"){r.build()}})};c.prototype.getPle=function(){return this._ple};c.prototype.fineness=function(e,t){var r=void 0;for(var i=1;i<t.length;i++){var n=Freedo.Cartesian3.distance(t[i-1],t[i]);if(!r)r=n;if(n<r)r=n}var a=[];for(var o=1;o<t.length;o++){a.push(t[o-1]);var s=Freedo.Cartesian3.distance(t[o-1],t[o]);var l=r/s;for(var u=1;u*l<e;u++){var d=Freedo.Cartesian3.lerp(t[o-1],t[o],u*l,new Freedo.Cartesian3);a.push(d)}}a.push(t[t.length-1]);return a};c.prototype.createImageLinePrimitive=function(e,t){var r=this;var i=Freedo.defaultValue(t.lineWidth,5);var n=Freedo.defaultValue(t.imageNum,5);var a=new Image;a.src=t.imageURL;a.onload=function(){r._ratio=a.width/a.height};return new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:i,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id}),appearance:new Freedo.PolylineMaterialAppearance({translucent:true,material:new Freedo.Material({translucent:true,fabric:{type:"Image",uniforms:{image:t.imageURL,repeat:new Freedo.Cartesian2(n,1),offset:this._offset},components:{alpha:"texture2D(image, fract(repeat * materialInput.st - offset)).a",diffuse:"texture2D(image, fract(repeat * materialInput.st - offset)).rgb"}}}),renderState:new Freedo.RenderState({depthTest:{enabled:false}})})})};c.prototype.createLinePrimitiveByPoints=function(e,t){var r=e;if(t.smooth)r=this.smoothPolyline(e,t.smooth);if(t.lineColor)this._lineColor=Freedo.Color.fromBytes(t.lineColor[0],t.lineColor[1],t.lineColor[2],t.lineColor[3]*255);else this._lineColor=Freedo.Color.YELLOW;var i="Color";if(t.polylineDash)i="PolylineDash";else if(t.polylineArrow)i="PolylineArrow";var n=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:r,width:Freedo.defaultValue(t.lineWidth,3),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:i,uniforms:{color:this._lineColor}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,false),func:Freedo.WebGLConstants.LEQUAL}})})});if(t.depthTest)n.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:i,uniforms:{color:this._lineColor}}})});return n};c.prototype.createLinePrimitiveByLines=function(e,t){var r=[];for(var i=0;i<e.length;i++){var n=e[i],a=[];for(var o=0;o<n.length;o++){var s=Freedo.FdMisc.FdGeometric.tc(n[o]);a.push(s)}if(t.smooth)a=this.smoothPolyline(a,t.smooth);var l=new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:a,width:Freedo.defaultValue(t.lineWidth,3),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id});this._lines.push(a);r.push(l)}if(t.lineColor)this._lineColor=Freedo.Color.fromBytes(t.lineColor[0],t.lineColor[1],t.lineColor[2],t.lineColor[3]*255);else this._lineColor=Freedo.Color.ORANGE;var u=new Freedo.Primitive({geometryInstances:r,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:this._lineColor}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})}),depthFailAppearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:this._lineColor}}})})});return u};c.prototype.smoothPolyline=function(e,t){if(e instanceof Array&&e.length==0)return[];if(typeof t!=="number"&&typeof t!=="boolean")throw new Error("smooth参数值的类型只能为boolean或number");if(t===true)t=undefined;var r=u.FdLoft.smoothByPolyline(e,[e[0]],100,t);return r.line};c.prototype.setDepthTest=function(e){this._data.depthTest=e;this._polyline.appearance.renderState.depthTest.enabled=e;if(e){this._polyline.depthFailAppearance=undefined}else{this._polyline.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:this._lineColor}}})})}this._viewer.scene.requestRender()};c.prototype.startAutomatic=function(){var r=this;var i=this._data;var n=Freedo.FdMisc.FdGeometric.calculateLength(this._positions);var a=Freedo.BoundingSphere.fromPoints(this._positions);this._automatic=setInterval(function(){if(r._ratio===undefined)return;var e=r._viewer.scene.camera.getPixelSize(a,r._viewer.scene.drawingBufferWidth,r._viewer.scene.drawingBufferHeight);if(e<.001)return;var t=Math.round(n/(i.lineWidth*r._ratio*e));if(t>50)return;if(t<5)return;r.setOption({imageNum:t});r._viewer.scene.requestRender()},1e3)};c.prototype.stopAutomatic=function(){if(this._automatic!==undefined){clearInterval(this._automatic);this._automatic=undefined}};c.prototype.startFlow=function(e){e=Freedo.defaultValue(e,3);var t=this;this._flow=setInterval(function(){t._offset.x+=e/1e3;if(!t._bContinuity){if(t._offset.x>1)t._offset.x=.5}t._viewer.scene.requestRender()},33)};c.prototype.stopFlow=function(){if(this._flow!==undefined){clearInterval(this._flow);this._flow=undefined}};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.clear=function(){this.stopAutomatic();this.stopFlow();this._viewer.scene.primitives.remove(this._polyline);this._positions=[];this._lines=[];this._polyline=undefined;this._ratio=undefined;this._offset=new Freedo.Cartesian2(-1,0);this._lineColor=undefined;this._viewer.scene.requestRender()};c.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};c.prototype.show=function(){this._polyline.show=true;this._viewer.scene.requestRender()};c.prototype.hide=function(){this._polyline.show=false;this._viewer.scene.requestRender()};c.prototype.setOption=function(e){this._polyline.appearance.material.uniforms.repeat=new Freedo.Cartesian2(e.imageNum,1);this._viewer.scene.requestRender()};c.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"Polyline",option:this._data}};c.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};c.prototype.dispose=function(){this.reset();this.remove()};t.FdPolyline=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPolygon=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(5);var l=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new l.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._polygon=undefined;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();d.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdPolygon.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.pts){this._data.pts=[];this._ple.run();this.addLsnr()}else{this.build()}};d.prototype.refresh=function(){this._viewer.scene.requestRender()};d.prototype.build=function(){var e=this._data;var t=e.pts;var r=[];for(var i=0;i<t.length;i++){var n=Freedo.FdMisc.FdGeometric.tc(t[i]);r.push(n)}this._polygon=this._viewer.scene.primitives.add(this.createAreaPrimitive(r,e));this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};d.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){r._data.pts=t.polyline.ptsG;r._ple.cancel()}if(e=="Cancel"){r.build()}})};d.prototype.createAreaPrimitive=function(e,t){var r=void 0;if(t.fillColor)r=Freedo.Color.fromBytes(t.fillColor[0],t.fillColor[1],t.fillColor[2],t.fillColor[3]*255);else r=Freedo.Color.YELLOW;var i=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(e),perPositionHeight:true}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)},id:this._id}),appearance:new Freedo.PerInstanceColorAppearance({translucent:r.alpha<1,flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,false),func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false,show:true});return i};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.clear=function(){this._viewer.scene.primitives.remove(this._polygon);this._polygon=undefined;this._viewer.scene.requestRender()};d.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};d.prototype.show=function(){this._polygon.show=true;this._viewer.scene.requestRender()};d.prototype.hide=function(){this._polygon.show=false;this._viewer.scene.requestRender()};d.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"Polygon",option:this._data}};d.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};d.prototype.setFillColor=function(e){this._data.fillColor=e;this.clear();this.build()};d.prototype.dispose=function(){this.reset();this.remove()};t.FdPolygon=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdCircle=undefined;var i=r(1);var n=u(i);var a=r(2);var o=u(a);var s=r(5);var l=r(10);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new l.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._circle=undefined;this._circleLine=undefined;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();d.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdCircle.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.center){this._ple.run();this.addLsnr()}else{this.build()}};d.prototype.refresh=function(){this._viewer.scene.requestRender()};d.prototype.build=function(){var e=this._data;var t=e.center;var r=e.radius;var i=Freedo.Cartographic.fromDegrees(t[0],t[1],t[0]);var n=Freedo.FdMisc.FdGeometric.getLongAndLatRatio(i);var a=[];for(var o=0;o<360;o++){var s=o*Math.PI/180;var l=new Freedo.Cartographic;l.longitude=r*Math.cos(s)*n[0]+Freedo.Math.toRadians(t[0]);l.latitude=r*Math.sin(s)*n[1]+Freedo.Math.toRadians(t[1]);l.height=t[2];a.push(Freedo.Cartographic.toCartesian(l))}e.fill=Freedo.defaultValue(e.fill,true);if(e.fill)this._circle=this._viewer.scene.primitives.add(this.createAreaPrimitive(a,e));e.outline=Freedo.defaultValue(e.outline,false);if(e.outline)this._circleLine=this._viewer.scene.primitives.add(this.createLinePrimitive(a,e));this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};d.prototype.createAreaPrimitive=function(e,t){var r=void 0;if(t.fillColor)r=Freedo.Color.fromBytes(t.fillColor[0],t.fillColor[1],t.fillColor[2],t.fillColor[3]*255);else r=Freedo.Color.YELLOW;var i=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(e),perPositionHeight:true}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)},id:this._id}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,false),func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false,show:true});return i};d.prototype.createLinePrimitive=function(e,t){var r=e,i=void 0;r.push(e[0]);if(t.outlineColor)i=Freedo.Color.fromBytes(t.outlineColor[0],t.outlineColor[1],t.outlineColor[2],t.outlineColor[3]*255);else i=Freedo.Color.YELLOW;var n="Color";if(t.polylineDash)n="PolylineDash";var a=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:r,width:Freedo.defaultValue(t.lineWidth,3),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id}),appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:n,uniforms:{color:i}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,false),func:Freedo.WebGLConstants.LEQUAL}})})});if(t.depthTest)a.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:n,uniforms:{color:i}}})});return a};d.prototype.addLsnr=function(){if(this._lsner)this._lsner();var n=this;var e=0;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){if(!n._data.center){n._data.center=t.position}else{var r=Freedo.Cartesian3.fromDegrees(n._data.center[0],n._data.center[1],n._data.center[2]);var i=Freedo.Cartesian3.fromDegrees(t.position[0],t.position[1],t.position[2]);n._data.radius=Freedo.Cartesian3.distance(r,i);n.build();n._ple.forceEnd();n._ple.cancel()}}})};d.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};d.prototype.clear=function(){this._viewer.scene.primitives.remove(this._circle);this._viewer.scene.primitives.remove(this._circleLine);this._viewer.scene.requestRender()};d.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};d.prototype.show=function(){if(this._circle!=undefined)this._circle.show=true;if(this._circleLine!=undefined)this._circleLine.show=true;this._viewer.scene.requestRender()};d.prototype.hide=function(){if(this._circle!=undefined)this._circle.show=false;if(this._circleLine!=undefined)this._circleLine.show=false;this._viewer.scene.requestRender()};d.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Circle",option:e}};d.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};d.prototype.dispose=function(){this.reset();this.remove()};t.FdCircle=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdFence=undefined;var i=r(18);var C=c(i);var n=r(1);var a=c(n);var o=r(2);var s=c(o);var l=r(56);var u=r(5);var d=r(10);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){function i(e,t,r){(0,a.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new d.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._cylinders=[];this._fences=[];this.create()}(0,s.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();f.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdFence.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.scale)){this._data.scale=1}if(!Freedo.defined(this._data.gltfOption)){this._data.gltfOption={}}if(!this._data.pts){this._ple.run();this.addLsnr()}else{this.build()}};f.prototype.build=function(){var e=Freedo.clone(this._data);e.length*=e.scale;var t=e.pts.length;var r=Freedo.Matrix4.fromScale(new Freedo.Cartesian3(this._data.scale,this._data.scale,this._data.scale));var i=[];var n=(0,C.default)({id:this._id,url:e.cylinderUrl,show:true,allowPicking:true,forwardAxis:0},e.gltfOption);var a=[];var o=(0,C.default)({id:this._id,url:e.fenceUrl,show:true,allowPicking:true,forwardAxis:0},e.gltfOption);for(var s=0;s<t;s++){if(s!=t-1){var l=e.pts[s];var u=e.pts[s+1];var d=Freedo.FdMisc.FdGeometric.tc(l);var c=Freedo.FdMisc.FdGeometric.tc(u);var f=Freedo.FdMisc.FdMath.calcModelAlignVectorM4(d,c);Freedo.Matrix4.multiply(f,r,f);i.push({modelMatrix:f});var h=Freedo.Cartesian3.distance(d,c);var p=Math.ceil(h/e.length);var v=h/p;var m=Freedo.Matrix4.fromScale(new Freedo.Cartesian3(this._data.scale*v/e.length,this._data.scale,this._data.scale));var _=Freedo.Cartesian3.subtract(c,d,new Freedo.Cartesian3);_=Freedo.Cartesian3.normalize(_,_);var y=Freedo.Cartesian3.multiplyByScalar(_,v,new Freedo.Cartesian3);for(var g=0;g<p;g++){var w=Freedo.FdMisc.FdMath.calcModelAlignVectorM4(d,c);Freedo.Matrix4.multiply(w,m,w);a.push({modelMatrix:w});Freedo.Cartesian3.add(d,y,d)}}else{var u=e.pts[s];var f=Freedo.Transforms.eastNorthUpToFixedFrame(Freedo.Cartesian3.fromDegrees(u[0],u[1],u[2]));Freedo.Matrix4.multiply(f,r,f);i.push({modelMatrix:f})}}var F=this._viewer.scene.primitives.add(new Freedo.ModelInstanceCollection((0,C.default)({},n,{instances:i})));this._cylinders.push(F);var b=this._viewer.scene.primitives.add(new Freedo.ModelInstanceCollection((0,C.default)({},o,{instances:a})));this._fences.push(b);this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};f.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};f.prototype.addLsnr=function(){if(this._lsner){this._lsner();this._lsner=undefined}var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PLAdd"){r._data.pts=Freedo.clone(t.polyline.ptsG);r._ple.cancel();r.build()}})};f.prototype.clear=function(){for(var e=0;e<this._fences.length;e++){this._viewer.scene.primitives.remove(this._fences[e])}for(var t=0;t<this._cylinders.length;t++){this._viewer.scene.primitives.remove(this._cylinders[t])}this._fences=[];this._cylinders=[];this._viewer.scene.requestRender()};f.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};f.prototype.show=function(){for(var e=0;e<this._fences.length;e++){this._fences[e].show=true}for(var t=0;t<this._cylinders.length;t++){this._cylinders[t].show=true}this._viewer.scene.requestRender()};f.prototype.hide=function(){for(var e=0;e<this._fences.length;e++){this._fences[e].show=false}for(var t=0;t<this._cylinders.length;t++){this._cylinders[t].show=false}this._viewer.scene.requestRender()};f.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"Fence",option:e}};f.prototype.setPositions=function(e){this._data.pts=e;this.clear();this.build()};f.prototype.dispose=function(){this.remove()};t.FdFence=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdRoad=undefined;var i=r(18);var R=u(i);var n=r(3);var O=u(n);var a=r(1);var o=u(a);var s=r(2);var l=u(s);var N=r(48);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function a(e){var r=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,o.default)(this,a);this._viewer=e;this._id=t;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var n=i.positions;if(!Freedo.defined(n)&&!Freedo.defined(i.lines)){this._ple=new Freedo.FdMicroApp.FdPolylineEditor(e);this._ple.setAutoClose(false);this._ple.setAutoDelLines(true);this._ple.start();this._ple.on(function(e,t){if(e!=="DataChanged")return;i.positions=t.polyline.pts;r._ple.cancel();r.buildRoad(i)})}else this.buildRoad(i)}(0,l.default)(a,[{key:"buildRoad",value:function e(t){this._data=Freedo.clone(t);var r=t.sidewalk,a=r===undefined?1.5:r,i=t.height,o=i===undefined?1:i,n=t.width,s=n===undefined?6:n,l=t.positions,u=t.lines,d=t.level,c=d===undefined?"一级":d,f=t.rate,h=f===undefined?36:f,p=t.smooth,v=p===undefined?1.5:p,m=t.imageScale,_=t.image,y=_===undefined?this.switchRoadMaterial(c):_;var g=[];if(Freedo.defined(l)){g.push(T.call(this,l))}else if(Freedo.defined(u)){var w=true;var F=false;var b=undefined;try{for(var C=(0,O.default)(u),x;!(w=(x=C.next()).done);w=true){var P=x.value;var M=T.call(this,P);g.push(M)}}catch(e){F=true;b=e}finally{try{if(!w&&C.return){C.return()}}finally{if(F){throw b}}}}this._primitive=new Freedo.Primitive({geometryInstances:g,appearance:new Freedo.MaterialAppearance({faceForward:true,material:new Freedo.Material({fabric:{type:"Image",uniforms:{image:y}}})}),asynchronous:false,compressVertices:false});function T(e){var t=this.buildRoadShape(a,o,s,Freedo.Cartesian3.subtract(e[1],e[0],new Freedo.Cartesian3),e[0]);if(!Freedo.defined(t))throw new Error("option.shape属性不能为空！");var r=N.FdLoft.smoothByPolyline(e,t,h,v);var i=N.FdLoft.triangulate(r.shapes,r.line);var n=N.FdLoft.buildGeometry((0,R.default)({},i,{compressSt:false}));return new Freedo.GeometryInstance({geometry:n})}if(typeof m==="number"&&m>=0&&m<=1){var E=function e(t){var r=t.geometry.attributes.st.values;for(var i=0;i<r.length;i+=8){r[i+3]=m/2;r[i+5]=1-m/2}};if(this._primitive.geometryInstances instanceof Array){var S=true;var A=false;var k=undefined;try{for(var L=(0,O.default)(this._primitive.geometryInstances),D;!(S=(D=L.next()).done);S=true){var I=D.value;E(I)}}catch(e){A=true;k=e}finally{try{if(!S&&L.return){L.return()}}finally{if(A){throw k}}}}else E(this._primitive.geometryInstances)}this._viewer.scene.primitives.add(this._primitive);this._event.raiseEvent("DataChanged",this)}},{key:"switchRoadMaterial",value:function e(t){var r=void 0;if(t==="一级"){r=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road1.jpg"}else if(t==="二级"){r=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road2.jpg"}else if(t==="三级"){r=Freedo.FdApp.getFreedoXPath()+"Assets/Textures/road/road3.jpg"}else throw new Error("请指定道路等级或纹理！(level|image)");return r}},{key:"buildRoadShape",value:function e(t,r,i,n,a){var o=Freedo.Cartesian3.cross(n,a,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(o,o);var s=Freedo.Cartesian3.normalize(a,new Freedo.Cartesian3);var l=i/2;var u=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));var d=Freedo.Cartesian3.add(a,Freedo.Cartesian3.multiplyByScalar(o,l,new Freedo.Cartesian3),new Freedo.Cartesian3);var c=Freedo.Cartesian3.add(d,Freedo.Cartesian3.multiplyByScalar(o,u,new Freedo.Cartesian3),new Freedo.Cartesian3);var f=Freedo.Cartesian3.add(d,Freedo.Cartesian3.multiplyByScalar(s,r,new Freedo.Cartesian3),new Freedo.Cartesian3);var h=Freedo.Cartesian3.subtract(a,Freedo.Cartesian3.multiplyByScalar(o,l,new Freedo.Cartesian3),new Freedo.Cartesian3);var p=Freedo.Cartesian3.add(h,Freedo.Cartesian3.multiplyByScalar(s,r,new Freedo.Cartesian3),new Freedo.Cartesian3);var v=Freedo.Cartesian3.subtract(h,Freedo.Cartesian3.multiplyByScalar(o,u,new Freedo.Cartesian3),new Freedo.Cartesian3);return[c,f,p,v]}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"remove",value:function e(){this._viewer.scene.primitives.remove(this._primitive)}},{key:"getData",value:function e(){return{id:this._id,type:"Road",option:Freedo.clone(this._data)}}},{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return a}();t.FdRoad=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicTextureLine=undefined;var i=r(1);var s=d(i);var n=r(2);var a=d(n);var o=r(56);var l=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function o(e,t,r){(0,s.default)(this,o);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._scratchTWP=undefined;this._dynamicTextureLinePrimitives=[];this._dynamicTextureLineRoutes=[];this._disposeListener=undefined;this._lineTexture=undefined;this._flowTexture=undefined;var i=this;var n=new Image;n.crossOrigin="anonymous";n.onload=function(){try{i._lineTexture=new Freedo.Texture({context:e.scene.context,width:n.width,height:n.height,source:n,flipY:false});if(Freedo.defined(i._lineTexture)&&Freedo.defined(i._flowTexture))i.create()}catch(e){if(Freedo.defined(i._lineTexture)){i._lineTexture.destroy();i._lineTexture=undefined}}};var a=new Image;a.crossOrigin="anonymous";a.onload=function(){try{i._flowTexture=new Freedo.Texture({context:e.scene.context,width:a.width,height:a.height,source:a,flipY:false});if(Freedo.defined(i._lineTexture)&&Freedo.defined(i._flowTexture))i.create()}catch(e){if(Freedo.defined(i._flowTexture)){i._flowTexture.destroy();i._flowTexture=undefined}}};n.src=r.lineTextureUrl;a.src=r.flowTextureUrl}(0,a.default)(o,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return o}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdDynamicTextureLine.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.lineWidth)){this._data.lineWidth=4}if(!Freedo.defined(this._data.flowWidth)){this._data.flowWidth=this._data.lineWidth}if(!this._data.routes){this._data.routes=[{}];this._data.routes[0].positions=[];this._data.positions=[];this._ple.run();this.addLsnr()}else{this.build()}};c.calculateDistance=function(e){var t=e.positions;var r=0;for(var i=0;i<t.length-1;i++){r+=Freedo.Cartesian3.distance(t[i],t[i+1])}e.distance=r};c.prototype.build=function(){var e=this._id;var t=this._data;var r=t.routes;this._dynamicTextureLineRoutes.push(r);var i=Math.max(t.lineWidth,t.flowWidth);var n=Freedo.defaultValue(t.depthTest,true);var a=this.createDynamicTextureLinesPrimitive(r,i,n);this._viewer.scene.primitives.add(a);this._dynamicTextureLinePrimitives.push(a);var o=[];r.forEach(function(e){e.forward=Freedo.defaultValue(e.forward,true);if(e.forward==true){e.time=e.startTime;e.delta=.01}else{e.time=e.startTime+e.duration;e.delta=-.01}e.round=Freedo.defaultValue(e.round,false);c.calculateDistance(e);o.push(e.distance)});o.sort();var s=o.length;var l=(s>0?o[parseInt((s+1)/2)-1]:0)/10;r.forEach(function(e){e.unit=l/e.distance});this.addLsnrOfMotion();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.addLsnr=function(){var i=this;if(this._lsner)this._lsner();this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){var r=Freedo.FdMisc.FdGeometric.tc(t.position);i._data.routes[0].positions.push(r);i._data.positions.push(t.position)}if(e=="DataChanged"){i._ple.cancel()}if(e=="Cancel"){i.build()}})};c.prototype.addLsnrOfMotion=function(){var r=this;if(this._disposeListener!=undefined){return}this._disposeListener=this._viewer.scene.preUpdate.addEventListener(function(){for(var e=0;e<r._dynamicTextureLinePrimitives.length;e++){var t=r._dynamicTextureLinePrimitives[e];if(!Freedo.defined(t)){continue}r.setDynamicTextureLinesStatus(t,r._dynamicTextureLineRoutes[e])}})};c.prototype.createDynamicTextureLinesApperance=function(e){var t=new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.Color.WHITE}},translucent:true});var r=new Freedo.PolylineMaterialAppearance({material:t,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:e,func:Freedo.WebGLConstants.LEQUAL}})});var i=Freedo.ShaderSource.replaceMain(r._vertexShaderSource,"czm_twp_main");var n="varying vec4 v_twp; \n"+"void main() \n"+"{ \n"+"    czm_twp_main(); \n"+"    v_twp = czm_batchTable_twp(batchId); \n"+"}";r._vertexShaderSource=i+"\n"+n;var a=Freedo.ShaderSource.replaceMain(r._fragmentShaderSource,"czm_twp2_main");var o="varying vec4 v_twp; \n"+"uniform sampler2D u_lineTexture; \n"+"uniform sampler2D u_flowTexture; \n"+"uniform vec2 u_width; \n"+"void main() \n"+"{ \n"+"   czm_twp2_main(); \n"+"   float t = v_twp.x; \n"+"   float w = v_twp.y; \n"+"   float p = v_twp.z; \n"+"   float d = v_twp.w; \n"+"   float range = p; \n"+"   float isFlow = 0.0; \n"+"   vec2 uv0 = vec2(v_st.s, v_st.t); \n"+"   vec2 uv1 = vec2(-1.0, v_st.t); \n"+"   if(d > 0.0) { \n"+"       if(v_st.s > (t - range) && v_st.s < t) { \n"+"           isFlow = 1.0; \n"+"           uv1.x = 1.0 - abs(v_st.s - (t - range)) / range; \n"+"       } \n"+"   } else { \n"+"       if(v_st.s > t && v_st.s < (t + range)){ \n"+"           isFlow = 1.0; \n"+"           uv1.x = 1.0 - abs(v_st.s - (t + range)) / range; \n"+"       } \n"+"   } \n"+"   if(u_width.x < u_width.y) { \n"+"       uv0.y = (uv0.y - 0.5) * u_width.y / u_width.x + 0.5; \n"+"   } else { \n"+"       uv1.y = (uv1.y - 0.5) * u_width.x / u_width.y + 0.5; \n"+"   } \n"+"   vec4 lineColour = (uv0.y >= 0.0 && uv0.y <= 1.0) ? texture2D(u_lineTexture, uv0) : vec4(0.0, 0.0, 0.0, 0.0); \n"+"   if(isFlow > 0.5) { \n"+"       vec4 flowColour = (uv1.y >= 0.0 && uv1.y <= 1.0) ? texture2D(u_flowTexture, uv1) : vec4(0.0, 0.0, 0.0, 0.0); \n"+"       gl_FragColor.a = max(lineColour.a, flowColour.a); \n"+"       gl_FragColor.rgb = lineColour.rgb * (1.0 - flowColour.a) + flowColour.rgb * flowColour.a; \n"+"       //gl_FragColor = flowColour; \n"+"   } else { \n"+"       gl_FragColor = lineColour; \n"+"   } \n"+"}";r._fragmentShaderSource=a+"\n"+o;var s=this;var l=new Freedo.Cartesian2(s._data.lineWidth,s._data.flowWidth);var u={u_lineTexture:function e(){return s._lineTexture},u_flowTexture:function e(){return s._flowTexture},u_width:function e(){return l}};t._uniforms=Freedo.combine(t._uniforms,u);return r};c.prototype.createDynamicTextureLinesGeometryInstance=function(e,t){var r=new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:t,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),attributes:{twp:new Freedo.GeometryInstanceAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:false,value:[0,0,.03,1]})}});return r};c.prototype.createDynamicTextureLinesPrimitive=function(e,i,t){var n=[];var a=this;e.forEach(function(e){var t=e.positions;var r=a.createDynamicTextureLinesGeometryInstance(t,i);n.push(r)});var r=new Freedo.Primitive({geometryInstances:n,appearance:this.createDynamicTextureLinesApperance(t)});return r};c.prototype.getScratchTWP=function(){if(typeof this._scratchTWP==="undefined"){this._scratchTWP=new Freedo.Cartesian4(0,0,0,0)}return this._scratchTWP};c.prototype.setDynamicTextureLinesStatus=function(e,t){var r=this.getScratchTWP();if(typeof e._batchTable!=="undefined"){var i="twp";var n=e._batchTableAttributeIndices[i];var a=e._batchTable._numberOfInstances;for(var o=0;o<a;++o){var s=o;var l=t[s];var u=l.startTime;var d=l.duration;var c=l.time;c+=l.delta;if(c>u+d){if(l.round){c=u+d;l.delta*=-1}else{c=u}}else if(c<u){if(l.round){c=u;l.delta*=-1}else{c=u+d}}l.time=c;var f=c-u;var h=Math.min(f/d,1);var p=this._viewer.scene.camera._positionCartographic.height*.05/l.distance;p=Math.min(.2,p);Freedo.Cartesian4.fromElements(h,0,p,l.delta,r);e._batchTable.setBatchedAttribute(s,n,r)}this._viewer.scene.requestRender()}};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.clear=function(e){for(var t=0;t<this._dynamicTextureLinePrimitives.length;t++){var r=this._dynamicTextureLinePrimitives[t];this._viewer.scene.primitives.remove(r)}this._dynamicTextureLinePrimitives=[];this._dynamicTextureLineRoutes=[];if(this._dynamicTextureLinePrimitives.length==0){this._disposeListener();this._disposeListener=undefined}this._viewer.scene.requestRender()};c.prototype.getData=function(){if(!this._data)return this._data;var e=Freedo.clone(this._data,true);return{id:this._id,type:"DynamicTextureLine",option:e}};c.prototype.remove=function(){this.clear();this._data=undefined;if(Freedo.defined(this._lineTexture)){this._lineTexture.destroy();this._lineTexture=undefined}if(Freedo.defined(this._flowTexture)){this._flowTexture.destroy();this._flowTexture=undefined}};c.prototype.show=function(){for(var e=0;e<this._dynamicTextureLinePrimitives.length;e++){var t=this._dynamicTextureLinePrimitives[e];t.show=true}this._viewer.scene.requestRender()};c.prototype.hide=function(){for(var e=0;e<this._dynamicTextureLinePrimitives.length;e++){var t=this._dynamicTextureLinePrimitives[e];t.show=false}this._viewer.scene.requestRender()};c.prototype.reDraw=function(e){this.clear();this.build()};c.prototype.dispose=function(){this.remove()};t.FdDynamicTextureLine=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicTextureLine2=undefined;var i=r(1);var o=d(i);var n=r(2);var s=d(n);var a=r(56);var l=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function a(e,t,r){(0,o.default)(this,a);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._ple.setAutoLoop(false);this._ple.setAutoDelLines(true);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._scratchTWP=undefined;this._dynamicTextureLinePrimitives=[];this._dynamicTextureLineRoutes=[];this._disposeListener=undefined;this._lineTexture=undefined;var i=this;var n=new Image;n.crossOrigin="anonymous";n.onload=function(){try{i._lineTexture=new Freedo.Texture({context:e.scene.context,width:n.width,height:n.height,source:n,flipY:false});if(Freedo.defined(i._lineTexture))i.create()}catch(e){if(Freedo.defined(i._lineTexture)){i._lineTexture.destroy();i._lineTexture=undefined}}};n.src=r.lineTextureUrl}(0,s.default)(a,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return a}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdDynamicTextureLine2.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.lineWidth)){this._data.lineWidth=4}if(!this._data.routes){this._data.routes=[{}];this._data.routes[0].positions=[];this._data.positions=[];this._ple.run();this.addLsnr()}else{this.build()}};c.calculateDistance=function(e){var t=e.positions;var r=0;for(var i=0;i<t.length-1;i++){r+=Freedo.Cartesian3.distance(t[i],t[i+1])}e.distance=r};c.prototype.build=function(){var e=this._id;var t=this._data;var r=t.routes;this._dynamicTextureLineRoutes.push(r);var i=Freedo.defaultValue(t.lineWidth,4);var n=Freedo.defaultValue(t.depthTest,true);var a=this.createDynamicTextureLinesPrimitive(r,i,n);this._viewer.scene.primitives.add(a);this._dynamicTextureLinePrimitives.push(a);var o=[];r.forEach(function(e){e.forward=Freedo.defaultValue(e.forward,true);if(e.forward==true){e.time=e.startTime;e.delta=.01}else{e.time=e.startTime+e.duration;e.delta=-.01}e.round=Freedo.defaultValue(e.round,false);c.calculateDistance(e);o.push(e.distance)});o.sort();var s=o.length;var l=(s>0?o[parseInt((s+1)/2)-1]:0)/5;r.forEach(function(e){e.unit=e.distance/l});this.addLsnrOfMotion();this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.addLsnr=function(){var i=this;if(this._lsner)this._lsner();this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){var r=Freedo.FdMisc.FdGeometric.tc(t.position);i._data.routes[0].positions.push(r);i._data.positions.push(t.position)}if(e=="DataChanged"){i._ple.cancel()}if(e=="Cancel"){i.build()}})};c.prototype.addLsnrOfMotion=function(){var r=this;if(this._disposeListener!=undefined){return}this._disposeListener=this._viewer.scene.preUpdate.addEventListener(function(){for(var e=0;e<r._dynamicTextureLinePrimitives.length;e++){var t=r._dynamicTextureLinePrimitives[e];if(!Freedo.defined(t)){continue}r.setDynamicTextureLinesStatus(t,r._dynamicTextureLineRoutes[e])}})};c.prototype.createDynamicTextureLinesApperance=function(e){var t=new Freedo.Material({fabric:{type:"Color",uniforms:{color:Freedo.Color.WHITE}},translucent:true});var r=new Freedo.PolylineMaterialAppearance({material:t,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:e,func:Freedo.WebGLConstants.LEQUAL}})});var i=Freedo.ShaderSource.replaceMain(r._vertexShaderSource,"czm_twp_main");var n="varying vec4 v_twp; \n"+"void main() \n"+"{ \n"+"    czm_twp_main(); \n"+"    v_twp = czm_batchTable_twp(batchId); \n"+"}";r._vertexShaderSource=i+"\n"+n;var a=Freedo.ShaderSource.replaceMain(r._fragmentShaderSource,"czm_twp2_main");var o="varying vec4 v_twp; \n"+"uniform sampler2D u_lineTexture; \n"+"void main() \n"+"{ \n"+"   czm_twp2_main(); \n"+"   float t = v_twp.x; \n"+"   float w = v_twp.y; \n"+"   float p = v_twp.z; \n"+"   float d = v_twp.w; \n"+"   vec2 uv0 = vec2(v_st.s * p, v_st.t); \n"+"   if(d > 0.0) { \n"+"       uv0.x += t; \n"+"   } else { \n"+"       uv0.x -= t; \n"+"   } \n"+"   gl_FragColor = texture2D(u_lineTexture, fract(uv0));\n"+"}";r._fragmentShaderSource=a+"\n"+o;var s=this;var l={u_lineTexture:function e(){return s._lineTexture}};t._uniforms=Freedo.combine(t._uniforms,l);return r};c.prototype.createDynamicTextureLinesGeometryInstance=function(e,t){var r=new Freedo.GeometryInstance({geometry:new Freedo.PolylineGeometry({positions:e,width:t,vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),attributes:{twp:new Freedo.GeometryInstanceAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:false,value:[0,0,4,1]})}});return r};c.prototype.createDynamicTextureLinesPrimitive=function(e,i,t){var n=[];var a=this;e.forEach(function(e){var t=e.positions;var r=a.createDynamicTextureLinesGeometryInstance(t,i);n.push(r)});var r=new Freedo.Primitive({geometryInstances:n,appearance:this.createDynamicTextureLinesApperance(t)});return r};c.prototype.getScratchTWP=function(){if(typeof this._scratchTWP==="undefined"){this._scratchTWP=new Freedo.Cartesian4(0,0,0,0)}return this._scratchTWP};c.prototype.setDynamicTextureLinesStatus=function(e,t){var r=this.getScratchTWP();if(typeof e._batchTable!=="undefined"){var i="twp";var n=e._batchTableAttributeIndices[i];var a=e._batchTable._numberOfInstances;for(var o=0;o<a;++o){var s=o;var l=t[s];var u=l.startTime;var d=l.duration;var c=l.time;c+=l.delta;if(c>u+d){if(l.round){c=u+d;l.delta*=-1}else{c=u}}else if(c<u){if(l.round){c=u;l.delta*=-1}else{c=u+d}}l.time=c;var f=c-u;var h=Math.min(f/d,1);var p=l.unit;p=Math.max(4,p);Freedo.Cartesian4.fromElements(h,0,p,l.delta,r);e._batchTable.setBatchedAttribute(s,n,r)}this._viewer.scene.requestRender()}};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.clear=function(e){for(var t=0;t<this._dynamicTextureLinePrimitives.length;t++){var r=this._dynamicTextureLinePrimitives[t];this._viewer.scene.primitives.remove(r)}this._dynamicTextureLinePrimitives=[];this._dynamicTextureLineRoutes=[];if(this._dynamicTextureLinePrimitives.length==0){this._disposeListener();this._disposeListener=undefined}this._viewer.scene.requestRender()};c.prototype.getData=function(){if(!this._data)return this._data;var e=Freedo.clone(this._data,true);return{id:this._id,type:"DynamicTextureLine2",option:e}};c.prototype.remove=function(){this.clear();this._data=undefined;if(Freedo.defined(this._lineTexture)){this._lineTexture.destroy();this._lineTexture=undefined}};c.prototype.show=function(){for(var e=0;e<this._dynamicTextureLinePrimitives.length;e++){var t=this._dynamicTextureLinePrimitives[e];t.show=true}this._viewer.scene.requestRender()};c.prototype.hide=function(){for(var e=0;e<this._dynamicTextureLinePrimitives.length;e++){var t=this._dynamicTextureLinePrimitives[e];t.show=false}this._viewer.scene.requestRender()};c.prototype.reDraw=function(e){this.clear();this.build()};c.prototype.dispose=function(){this.remove()};t.FdDynamicTextureLine2=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdParticleSystem=undefined;var i=r(1);var n=d(i);var a=r(2);var o=d(a);var s=r(56);var l=r(5);var u=r(10);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function i(e,t,r){(0,n.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._ple=new u.FdPolylineEditor(e);this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._particleSystem=undefined;this.create()}(0,o.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();c.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdParticleSystem.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!Freedo.defined(this._data.image)){console.error("FdParticleSystem.prototype.create：image参数无效");return}if(this._data.modelMatrix){this.build();return}if(!this._data.position){this._ple.run();this.addLsnr()}else{this.build()}};c.prototype.refresh=function(){this._viewer.scene.requestRender()};c.prototype.addLsnr=function(){if(this._lsner)this._lsner();var r=this;this._lsner=this._ple.on(function(e,t){if(e=="PointAdded"){r._data.position=Freedo.clone(t.position,true);r._ple.cancel();r.build()}})};c.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};c.prototype.build=function(){var e=Freedo.clone(this._data,true);if(e.modelMatrix===undefined){var t=e.position;var r=Freedo.Cartesian3.fromDegrees(t[0],t[1],t[2]);var i=Freedo.Transforms.eastNorthUpToFixedFrame(r,undefined,new Freedo.Matrix4);delete e.position;e.modelMatrix=i}if(e.emitter!==undefined){if(e.emitter[0]==="Box")e.emitter=new Freedo.BoxEmitter(e.emitter[1]);else if(e.emitter[0]==="Circle")e.emitter=new Freedo.CircleEmitter(e.emitter[1]);else if(e.emitter[0]==="Cone")e.emitter=new Freedo.ConeEmitter(e.emitter[1]);else if(e.emitter[0]==="Sphere")e.emitter=new Freedo.SphereEmitter(e.emitter[1])}this._particleSystem=this._viewer.scene.primitives.add(new Freedo.ParticleSystem(e));this._event.raiseEvent("DataChanged",this);this._viewer.scene.requestRender()};c.prototype.clear=function(){if(this._particleSystem===undefined)return;this._viewer.scene.primitives.remove(this._particleSystem);this._particleSystem=undefined;this._viewer.scene.requestRender()};c.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};c.prototype.show=function(){if(this._particleSystem===undefined)return;this._particleSystem.show=true;this._viewer.scene.requestRender()};c.prototype.hide=function(){if(this._particleSystem===undefined)return;this._particleSystem.show=false;this._viewer.scene.requestRender()};c.prototype.getData=function(){if(!this._data)return undefined;var e=Freedo.clone(this._data,true);return{id:this._id,type:"ParticleSystem",option:e}};c.prototype.reset=function(){if(this._lsner)this._lsner();this._lsner=undefined;this._ple.cancel()};c.prototype.dispose=function(){this.remove()};t.FdParticleSystem=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdPlane=undefined;var i=r(18);var l=s(i);var n=r(1);var u=s(n);var a=r(2);var o=s(a);var d=r(48);function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function s(e){var r=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,u.default)(this,s);this._viewer=e;this._id=t;this._data=i;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var n=Freedo.defaultValue(i.offsetHeight,0);var a=i.positions;if(!Freedo.defined(a)){var o=this._ple=new Freedo.FdMicroApp.FdPolylineEditor(e);o.setAutoClose(false);o.setHeightOffset(n);o.setAutoDelLines(true);o.start();o.on(function(e,t){if(e!=="DataChanged")return;typeof drawPrimitive=="function"&&drawPrimitive(t.polyline.pts);i.positions=t.polyline.pts;o.cancel();r.buildPlane(i)})}else this.buildPlane(i)}(0,o.default)(s,[{key:"buildPlane",value:function e(t){var r=t.width,i=r===undefined?5:r,n=t.positions;var a=d.FdLoft.buildCirclePts(n[0],i/2,Freedo.Cartesian3.subtract(n[1],n[0],new Freedo.Cartesian3),2);a.reverse();var o=d.FdLoft.smoothByPolyline(n,a,36);this._primitive=d.FdLoft.buildPrimitive(this._viewer,(0,l.default)({},t,o));this._viewer.scene.primitives.add(this._primitive)}},{key:"remove",value:function e(){this._viewer.scene.primitives.remove(this._primitive)}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"getData",value:function e(){return{type:"Plane",id:this._id,option:this._data}}}]);return s}();t.FdPlane=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGeoJson=undefined;var i=r(18);var E=u(i);var n=r(3);var q=u(n);var a=r(1);var o=u(a);var s=r(2);var l=u(s);var S=r(267);var A=r(268);var k=r(269);var _=r(266);var b=r(83);function u(e){return e&&e.__esModule?e:{default:e}}var C=function(){function n(e,t,r){(0,o.default)(this,n);this._viewer=e;this._id=t;this._data=r;this._clampToGround=Freedo.defaultValue(r.clampToGround,false);this._createByAtt=r.createByAtt;this._labelParentCollection={labels:new Freedo.LabelCollection,billboards:new Freedo.BillboardCollection,points:new Freedo.PointPrimitiveCollection};for(var i in this._labelParentCollection){e.scene.primitives.add(this._labelParentCollection[i])}this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._ds={};this._drawMode="Primitive";this._type="";this._points=[];this._pointInfos=[];this._polylines=[];this._polylineInfos=[];this._polygons=[];this._polygonInfos=[];this._polygonLines=[];this._labels=[];this._autoFlyPos=undefined;this.create()}(0,l.default)(n,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}},{key:"center",get:function e(){return this._autoFlyPos?this._autoFlyPos.clone():undefined}}]);return n}();C.toColor=function(e){if(e instanceof Array){return Freedo.Color.fromBytes(e[0],e[1],e[2],e[3]*255)}else{return e}};C.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdGeoJson.prototype.create：参数无效");return}if(Freedo.defined(this._data.drawMode)){this._drawMode=this._data.drawMode}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}this.build()};C.prototype.refresh=function(){this._viewer.scene.requestRender()};C.prototype.build=function(){var i=this;var n=this._data;this._ds=new Freedo.GeoJsonDataSource(n.name);var a=this;this._ds.load(n.jsonURL).then(function(e){var t=e.entities.values;if(t.length>0){if(t[0].position!==undefined){a._type="point";a.drawPoint(t,n);i._autoFlyPos=t[0].position._value.clone()}else if(t[0].polyline!==undefined){a._type="polyline";if(n.flow===true){a.drawDynamicPolyline(t,n)}else if(a._drawMode=="Entity"){a.drawPolylineByEntity(t,n)}else if(a._drawMode=="Primitive"){a.drawPolylineByPrimitive(t,n)}i._autoFlyPos=t[0].polyline.positions._value[0].clone()}else if(t[0].polygon!==undefined){a._type="polygon";if(a._drawMode=="Entity"){a.drawPolygonByEntity(t,n)}else if(a._drawMode=="Primitive"){a.drawPolygonByPrimitive(t,n)}i._autoFlyPos=t[0].polygon.hierarchy._value.positions[0].clone()}else{console.log("数据类型不明, 绘制失败");return}}if(i._data.autoFly){var r=new Freedo.BoundingSphere(i._autoFlyPos,500);i._viewer.camera.flyToBoundingSphere(r)}a._event.raiseEvent("DataChanged",a);a._viewer.scene.requestRender()}).otherwise(function(e){return console.error(e)})};C.prototype.drawPoint=function(e,t){var r=true;var i=false;var n=undefined;try{for(var a=(0,q.default)(e),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=C.toColor(Freedo.defaultValue(t.outlineColor,Freedo.Color.ORANGE));var u=Freedo.defaultValue(t.outlineWidth,2);if(t.outline==false){l=undefined;u=undefined}var d=Freedo.defaultValue(t.offset,1);var c=b.FdMath.addDelta2Height([s.position._value],d)[0];var f=this._viewer.entities.add({position:c,point:(0,E.default)({color:C.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.ORANGE.withAlpha(.5))),pixelSize:Freedo.defaultValue(t.width,5),outlineColor:l,outlineWidth:u,show:true},t)});this._points.push(f);this._pointInfos.push(c);if(t.label){var h=s.name;if(t.labelOption){var p=[];var v=s.properties.propertyNames;var m=true;var _=false;var y=undefined;try{for(var g=(0,q.default)(v),w;!(m=(w=g.next()).done);m=true){var F=w.value;if(t.labelOption){if(t.labelOption.textAtt.indexOf(F)>-1)p.push(s.properties[F])}else{p.push(s.properties[F])}}}catch(e){_=true;y=e}finally{try{if(!m&&g.return){g.return()}}finally{if(_){throw y}}}h=p.join("")}this.createLabel(c,h,t.labelOption)}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._viewer.scene.requestRender()};C.prototype.drawPolylineByEntity=function(e,t){var r=true;var i=false;var n=undefined;try{for(var a=(0,q.default)(e),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=this._viewer.entities.add({polyline:{positions:s.polyline.positions,clampToGround:this._clampToGround,width:Freedo.defaultValue(t.width,5),show:true,zIndex:Freedo.defaultValue(t.zIndex,0),material:C.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.LIGHTGREY))}});this._polylines.push(l);if(t.label){var u;if(Freedo.defined(t.labelOption)&&t.labelOption.labelAtMiddle){var d=Math.round(s.polyline.positions._value.length/2);u=s.polyline.positions._value[d]}else{u=Freedo.FdMisc.FdGeometric.getCenterOfPts(s.polyline.positions._value)}this.createLabel(u,s.name,t.labelOption)}}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._viewer.scene.requestRender()};C.prototype.drawPolygonByEntity=function(e,t){var r=true;var i=false;var n=undefined;try{for(var a=(0,q.default)(e),o;!(r=(o=a.next()).done);r=true){var s=o.value;var l=s.properties.height;if(l!=undefined){if(l._value==null||l._value==0||l._value==undefined)l._value=6+Math.round(Math.random()*24);else l._value=l._value*2}else{l={};l._value=0}var u=this._viewer.entities.add({polygon:{hierarchy:s.polygon.hierarchy,material:C.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.fromRandom({alpha:.5}))),clampToGround:this._clampToGround,height:this._clampToGround?undefined:s.polygon.height,extrudedHeight:this._clampToGround?undefined:l._value,outline:Freedo.defaultValue(t.outline,true),outlineColor:C.toColor(Freedo.defaultValue(t.outlineColor,Freedo.Color.LIGHTSKYBLUE)),outlineWidth:Freedo.defaultValue(t.outlineWidth,2)}});this._polygons.push(u)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._viewer.scene.requestRender()};C.prototype.createLabel=function(e,t,r){var i=this._viewer.entities.add({position:e,label:(0,E.default)({style:Freedo.LabelStyle.FILL,text:t,scale:.5,fillColor:Freedo.Color.WHITE,outlineColor:Freedo.Color.WHITE,showBackground:true,backgroundColor:Freedo.Color.fromBytes(147,147,147,.5*255),font:"bold 32px MicroSoft YaHei",horizontalOrigin:Freedo.HorizontalOrigin.CENTER,verticalOrigin:Freedo.VerticalOrigin.BOTTOM,pixelOffset:new Freedo.Cartesian2(0,-10),distanceDisplayCondition:new Freedo.DistanceDisplayCondition(0,2e7)},r)});this._labels.push(i)};C.prototype.drawPolylineByPrimitive=function(e,t){this.createLinePrimitiveByPolylines(e,t);var r=true;var i=false;var n=undefined;try{for(var a=(0,q.default)(this._polygonLines),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._viewer.scene.primitives.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}this._viewer.scene.requestRender()};C.prototype.drawPolygonByPrimitive=function(e,t){this.createLinePrimitiveByPolylines(e,t);this.createAreaPrimitiveByPolygons(e,t);var r=true;var i=false;var n=undefined;try{for(var a=(0,q.default)(this._polygons),o;!(r=(o=a.next()).done);r=true){var s=o.value;this._viewer.scene.primitives.add(s)}}catch(e){i=true;n=e}finally{try{if(!r&&a.return){a.return()}}finally{if(i){throw n}}}var l=true;var u=false;var d=undefined;try{for(var c=(0,q.default)(this._polygonLines),f;!(l=(f=c.next()).done);l=true){var h=f.value;this._viewer.scene.primitives.add(h)}}catch(e){u=true;d=e}finally{try{if(!l&&c.return){c.return()}}finally{if(u){throw d}}}this._viewer.scene.requestRender()};C.prototype.createLinePrimitiveByPolylines=function(e,t){var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,q.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=this._clampToGround?Freedo.GroundPolylineGeometry:Freedo.PolylineGeometry;var d=void 0;if(l.polygon){d=l.polygon.hierarchy._value.positions}else if(l.polyline){d=l.polyline.positions._value}if(!d){continue}var c=new Freedo.GeometryInstance({geometry:new u({positions:d,width:Freedo.defaultValue(t.lineWidth,1),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT}),id:this._id});c.atts=l.properties;r.push(c);this._polylineInfos.push(d)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}var f=void 0;if(t.lineColor)f=C.toColor(t.lineColor);else f=Freedo.Color.ORANGE;var h=this._clampToGround?Freedo.GroundPolylinePrimitive:Freedo.Primitive;if(this._createByAtt!=undefined){var p={};for(var v=0;v<r.length;v++){if(r[v].atts){var m=r[v].atts[this._createByAtt];if(p[m]==undefined){p[m]=[]}p[m].push(r[v])}}for(var _ in p){if(p.hasOwnProperty(_)){var y=new h({geometryInstances:p[_],appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:f}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})})});if(!t.depthTest){y.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:f}}})})}y.atts=p[_][0].atts;this._polygonLines.push(y)}}}else{var g=new h({geometryInstances:r,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:f}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})})});if(!t.depthTest){g.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:f}}})})}this._polygonLines.push(g)}};C.prototype.drawDynamicPolyline=function(e,t){var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,q.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=l.polyline.positions._value;var d={positions:u,startTime:0,duration:6,forward:true,round:false};d.atts=l.properties;r.push(d);this._polylineInfos.push(u)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}var c=void 0;if(t.lineColor)c=C.toColor(t.lineColor);else c=Freedo.Color.WHITE.withAlpha(0);if(this._createByAtt!=undefined){var f={};for(var h=0;h<r.length;h++){if(r[h].atts){var p=r[h].atts[this._createByAtt];if(f[p]==undefined){f[p]=[]}f[p].push(r[h])}}for(var v in f){if(f.hasOwnProperty(v)){var m=new _.FdDynamicLine(this._viewer,this._id,{routes:f[v],width:Freedo.defaultValue(t.lineWidth,1),color:c,depthTest:t.depthTest});m.atts=f[v][0].atts;this._polygonLines.push(m)}}}else{var m=new _.FdDynamicLine(this._viewer,this._id,{routes:r,width:Freedo.defaultValue(t.lineWidth,1),color:c,depthTest:t.depthTest});this._polygonLines.push(m)}this._viewer.scene.requestRender()};C.prototype.showByAtt=function(e,t,r){var i=this._polygons;for(var n=0;n<i.length;n++){var a=i[n].atts[e];if(a._value===t){i[n].show=r}}var o=this._polygonLines;for(var s=0;s<o.length;s++){var l=o[s].atts[e];if(l._value===t){var u=o[s];if(u.show instanceof Function){!!r?u.show():u.hide()}else{u.show=r}}}var d=this._labels;var c=true;var f=false;var h=undefined;try{for(var p=(0,q.default)(d),v;!(c=(v=p.next()).done);c=true){var m=v.value;var _=m.atts[e];if(_._value===t){if(m.show instanceof Function||m.hide instanceof Function){r?m.show():m.hide()}else{m.show=r}}}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}this._viewer.scene.requestRender()};C.prototype.createAreaPrimitiveByPolygons=function(e,t){var r=[];var i=true;var n=false;var a=undefined;try{for(var o=(0,q.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=this.createAreaGeometryInstance(l.polygon.hierarchy._value.positions,t);u.atts=l.properties;r.push(u);this._polygonInfos.push(l.polygon.hierarchy._value.positions);if(t.label==true){var d=Freedo.FdMisc.FdGeometric.getCenterOfPts(l.polygon.hierarchy._value.positions);var c=Freedo.FdMisc.FdGeometric.tg(d);c[2]+=1;var f=l.properties.propertyNames;var h=[];var p=true;var v=false;var m=undefined;try{for(var _=(0,q.default)(f),y;!(p=(y=_.next()).done);p=true){var g=y.value;if(t.labelOption){if(t.labelOption.textAtt.indexOf(g)>-1){h.push(l.properties[g])}}else{h.push(l.properties[g])}}}catch(e){v=true;m=e}finally{try{if(!p&&_.return){_.return()}}finally{if(v){throw m}}}var w=void 0;if(t.labelOption&&t.labelOption.type&&t.labelOption.type==="DivLabel"){w=new A.FdDivLabel(this._viewer,this._id,(0,E.default)({position:c,text:h.join("")},t.labelOption))}else if(t.labelOption&&t.labelOption.type&&t.labelOption.type==="AnchorLabel"){w=new k.FdAnchorLabel(this._viewer,this._id,(0,E.default)({position:c,text:h.join("")},t.labelOption))}else{var F=this._labelParentCollection;w=new S.FdLabel(this._viewer,this._id,{position:c,text:h.join("")},F)}w.atts=l.properties;this._labels.push(w)}}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}if(this._createByAtt!=undefined){var b={};for(var C=0;C<r.length;C++){if(r[C].atts){var x=r[C].atts[this._createByAtt];if(b[x]==undefined){b[x]=[]}b[x].push(r[C])}}for(var P in b){if(b.hasOwnProperty(P)){var M=this._clampToGround?new Freedo.GroundPrimitive({geometryInstances:b[P],appearance:new Freedo.PerInstanceColorAppearance({flat:true}),asynchronous:false,show:true}):new Freedo.Primitive({geometryInstances:b[P],appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false,show:true});M.atts=b[P][0].atts;this._polygons.push(M)}}}else{var T=this._clampToGround?new Freedo.GroundPrimitive({geometryInstances:r,appearance:new Freedo.PerInstanceColorAppearance({flat:true}),asynchronous:false,show:true}):new Freedo.Primitive({geometryInstances:r,appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false,show:true});this._polygons.push(T)}};C.prototype.createAreaGeometryInstance=function(e,t){var r=void 0;if(t.fillColor)r=C.toColor(t.fillColor);else r=Freedo.Color.fromRandom({alpha:.5});var i=new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(e)}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)},id:this._id});return i};C.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};C.prototype.clear=function(){if(this._drawMode=="Primitive"){var e=true;var t=false;var r=undefined;try{for(var i=(0,q.default)(this._polylines),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.scene.primitives.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,q.default)(this._polygons),d;!(o=(d=u.next()).done);o=true){var c=d.value;this._viewer.scene.primitives.remove(c)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var f=true;var h=false;var p=undefined;try{for(var v=(0,q.default)(this._polygonLines),m;!(f=(m=v.next()).done);f=true){var _=m.value;if(this._viewer.scene.primitives.contains(_)){this._viewer.scene.primitives.remove(_)}else if(_.remove instanceof Function){_.remove()}}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}var y=true;var g=false;var w=undefined;try{for(var F=(0,q.default)(this._labels),b;!(y=(b=F.next()).done);y=true){var C=b.value;C.remove()}}catch(e){g=true;w=e}finally{try{if(!y&&F.return){F.return()}}finally{if(g){throw w}}}}else if(this._drawMode=="Entity"){var x=true;var P=false;var M=undefined;try{for(var T=(0,q.default)(this._points),E;!(x=(E=T.next()).done);x=true){var S=E.value;this._viewer.entities.remove(S)}}catch(e){P=true;M=e}finally{try{if(!x&&T.return){T.return()}}finally{if(P){throw M}}}var A=true;var k=false;var L=undefined;try{for(var D=(0,q.default)(this._polylines),I;!(A=(I=D.next()).done);A=true){var a=I.value;this._viewer.entities.remove(a)}}catch(e){k=true;L=e}finally{try{if(!A&&D.return){D.return()}}finally{if(k){throw L}}}var R=true;var O=false;var N=undefined;try{for(var B=(0,q.default)(this._polygons),H;!(R=(H=B.next()).done);R=true){var c=H.value;this._viewer.entities.remove(c)}}catch(e){O=true;N=e}finally{try{if(!R&&B.return){B.return()}}finally{if(O){throw N}}}var V=true;var G=false;var z=undefined;try{for(var U=(0,q.default)(this._labels),j;!(V=(j=U.next()).done);V=true){var C=j.value;this._viewer.entities.remove(C)}}catch(e){G=true;z=e}finally{try{if(!V&&U.return){U.return()}}finally{if(G){throw z}}}}this._points=[];this._polylines=[];this._polygons=[];this._polygonLines=[];this._labels=[];this._viewer.scene.requestRender()};C.prototype.remove=function(){this.clear();this._drawMode=="Primitive";this._data=undefined;this._viewer.scene.requestRender()};C.prototype.show=function(){this._polylines.show=true;this._polygons.show=true;var e=true;var t=false;var r=undefined;try{for(var i=(0,q.default)(this._polygonLines),n;!(e=(n=i.next()).done);e=true){var a=n.value;if(a.show instanceof Function){a.show()}else{a.show=true}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,q.default)(this._labels),d;!(o=(d=u.next()).done);o=true){var c=d.value;c.show=true}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var f=true;var h=false;var p=undefined;try{for(var v=(0,q.default)(this._polygons),m;!(f=(m=v.next()).done);f=true){var _=m.value;_.show=true}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}this._viewer.scene.requestRender()};C.prototype.hide=function(){this._polylines.show=false;this._polygons.show=false;var e=true;var t=false;var r=undefined;try{for(var i=(0,q.default)(this._polygonLines),n;!(e=(n=i.next()).done);e=true){var a=n.value;if(a.show instanceof Function){a.hide()}else{a.show=false}}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}var o=true;var s=false;var l=undefined;try{for(var u=(0,q.default)(this._labels),d;!(o=(d=u.next()).done);o=true){var c=d.value;c.show=false}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var f=true;var h=false;var p=undefined;try{for(var v=(0,q.default)(this._polygons),m;!(f=(m=v.next()).done);f=true){var _=m.value;_.show=false}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}this._viewer.scene.requestRender()};C.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"GeoJson",option:this._data}};C.prototype.dispose=function(){this.remove()};t.FdGeoJson=C},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdTube=undefined;var i=r(96);var _=o(i);var n=r(1);var s=o(n);var a=r(2);var l=o(a);var y=r(48);function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function o(e){var r=this;var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Freedo.createGuid();var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};(0,s.default)(this,o);this._viewer=e;this._id=t;this._data=i;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;var n=Freedo.defaultValue(i.offsetHeight,10);var a=i.positions;if(!Freedo.defined(a)){this._ple=new Freedo.FdMicroApp.FdPolylineEditor(e);this._ple.setHeightOffset(n);this._ple.setAutoDelLines(true);this._ple.setAutoClose(false);this._ple.start();this._ple.on(function(e,t){if(e!=="DataChanged")return;i.positions=t.polyline.pts;r._ple.cancel();r.buildTube(i)})}else this.buildTube(i)}(0,l.default)(o,[{key:"buildTube",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this._data=Freedo.clone(t);var r=this._viewer;var i=t.shapeType,n=t.stroke,a=n===undefined?5:n,o=t.positions,s=t.close,l=s===undefined?false:s,u=t.shapeRate,d=u===undefined?36:u,c=t.closeColor,f=c===undefined?Freedo.Color.YELLOW:c,h=t.thick,p=h===undefined?0:h;var v=Freedo.defaultValue(this.buildShape(i,o[0],a,Freedo.Cartesian3.subtract(o[1],o[0],new Freedo.Cartesian3),d),t.shape);t.shape=v;if(!Freedo.defined(v))throw new Error("option.shape属性不能为空！");t.smooth=Freedo.defaultValue(t.smooth,1.5);this._loft=new y.FdLoft(r,this._id,t);this._primitive=this._loft._primitive;if(p>0){var m=y.FdLoft.calcInner(v,o[0],p);var _=Freedo.clone(t);_.shape=m;this._loftinner=new y.FdLoft(r,this._id,_);if(t.close===undefined||t.close===true)this.closeTube(f,v.length)}else if(l)this.close(f,t.shape.length);this._event.raiseEvent("DataChanged",this)}},{key:"close",value:function e(t,r){var i=this._loft._primitive.geometryInstances.geometry.attributes.position.values;var n=i.slice(0,3*r);var a=i.slice(i.length-3*r);var o=Float64Array.of.apply(Float64Array,(0,_.default)(n).concat((0,_.default)(a)));var s=[];for(var l=0;l<2*r;l++){if(l%r<2)continue;if(l<r)s.push(0,l-1,l);else s.push(r+1,l-1,l)}var u=new Uint32Array(s);function d(e,t,r){var i=Freedo.Cartesian3.subtract(t,e,new Freedo.Cartesian3);var n=Freedo.Cartesian3.subtract(r,t,new Freedo.Cartesian3);var a=Freedo.Cartesian3.cross(i,n,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(a,a);return a}var c=d(new Freedo.Cartesian3(o[0],o[1],o[2]),new Freedo.Cartesian3(o[3],o[4],o[5]),new Freedo.Cartesian3(o[6],o[7],o[8]));var f=d(new Freedo.Cartesian3(o[r*3],o[r*3+1],o[r*3+2]),new Freedo.Cartesian3(o[r*3+3],o[r*3+4],o[r*3+5]),new Freedo.Cartesian3(o[r*3+6],o[r*3+7],o[r*3+8]));var h=new Float32Array(o.length);for(var p=0;p<h.length;p+=3){var v=p<h.length/2?c:f;h[p]=v.x;h[p+1]=v.y;h[p+2]=v.z}var m=this.buildPrimitive(t,o,u,h);this._viewer.scene.primitives.add(m);this.closePrimitive=m}},{key:"closeTube",value:function e(t,r){var i=this._loftinner._primitive.geometryInstances.geometry.attributes.position.values,n=this._loft._primitive.geometryInstances.geometry.attributes.position.values;var a=i.slice(0,r*3);var o=n.slice(0,r*3);var s=i.slice(i.length-r*3);var l=n.slice(n.length-r*3);var u=new Uint32Array(this.closeSectionIdx(r));var d=Float64Array.of.apply(Float64Array,(0,_.default)(a).concat((0,_.default)(o),(0,_.default)(s),(0,_.default)(l)));var c=[];function f(e,t,r){var i=Freedo.Cartesian3.subtract(t,e,new Freedo.Cartesian3);var n=Freedo.Cartesian3.subtract(r,t,new Freedo.Cartesian3);var a=Freedo.Cartesian3.cross(i,n,new Freedo.Cartesian3);Freedo.Cartesian3.normalize(a,a);return a}var h=f(new Freedo.Cartesian3(d[0],d[1],d[2]),new Freedo.Cartesian3(d[3*r],d[3*r+1],d[3*r+2]),new Freedo.Cartesian3(d[3],d[4],d[5]));var p=f(new Freedo.Cartesian3(d[3*2*r],d[3*2*r+1],d[3*2*r+5]),new Freedo.Cartesian3(d[3*2*r+3],d[3*2*r+4],d[3*2*r+2]),new Freedo.Cartesian3(d[3*3*r],d[3*3*r+1],d[3*3*r+2]));for(var v=0;v<4*r;v++){if(v<2*r)c.push(h.x,h.y,h.z);else c.push(p.x,p.y,p.z)}var m=this.buildPrimitive(t,d,u,new Float32Array(c));this._viewer.scene.primitives.add(m);this.closePrimitive=m}},{key:"buildPrimitive",value:function e(t,r,i,n,a){var o=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:r}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:true,values:n})},indices:i,primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:Freedo.BoundingSphere.fromVertices(r)});var s=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:o,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(t)}}),appearance:new Freedo.PerInstanceColorAppearance({translucent:false,faceForward:true}),asynchronous:false});return s}},{key:"closeSectionIdx",value:function e(t){var r=[];for(var i=1;i<t;i++){r.push(i-1,i-1+t,i+t,i-1,i+t,i);r.push(i-1+2*t,i-1+3*t,i+3*t,i-1+2*t,i+3*t,i+2*t)}return r}},{key:"buildShape",value:function e(t,r,i,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:36;if(typeof t!=="string")return;var o=void 0;if(t.toLowerCase()==="circle"){o=y.FdLoft.buildCirclePts(r,i,n,a)}else if(t.toLowerCase()==="semicircle"){o=y.FdLoft.buildCirclePts(r,i,n,a);o=o.slice(o.length/2-1);return o}else if(t.toLowerCase()==="triangle"){o=y.FdLoft.buildCirclePts(r,i,n,3)}else if(t.toLowerCase()==="pentagram"){o=y.FdLoft.buildPentagramPts(r,i,n)}else if(t.toLowerCase()==="square"){o=y.FdLoft.buildCirclePts(r,i,n,4)}else if(t.toLowerCase()==="panel"){o=y.FdLoft.buildCirclePts(r,i,n,2);o.reverse();return o}else if(t.toLowerCase()==="road"){o=y.FdLoft.buildCirclePts(r,i,n,12);return[o[5],o[6],o[10],o[11]]}if(Freedo.defined(o)){o.push(o[0]);return o}return}},{key:"on",value:function e(t,r){return this._eventHelper.add(this._event,t,r)}},{key:"getData",value:function e(){return{id:this._id,type:"Tube",option:Freedo.clone(this._data)}}},{key:"remove",value:function e(){this._loft&&this._loft.remove();this._loftinner&&this._loftinner.remove();this.closePrimitive&&this._viewer.scene.primitives.remove(this.closePrimitive)}},{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return o}();t.FdTube=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdShapeFile=undefined;var i=r(18);var o=c(i);var n=r(3);var V=c(n);var a=r(1);var s=c(a);var l=r(2);var u=c(l);var d=r(83);function c(e){return e&&e.__esModule?e:{default:e}}var x=function(){function i(e,t,r){(0,s.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this._autoFly=Freedo.defaultValue(r.autoFly,false);this._shapeFileInfos=[];this._readPrj=undefined;this._shapeType=undefined;this._points=[];this._polylines=undefined;this._polygons=undefined;this._polygonLines=[];this._flyToPos=undefined;this._labels=[];this._labelLines=[];this._mm=new Freedo.FdModel.FdModelManager(this._viewer);if(typeof proj4=="undefined"){console.error("proj4库未引入，无法解析shp文件");return}if(typeof shapefile=="undefined"){console.error("shapefile库未引入，无法解析shp文件");return}this._heightField="BHEIGHT";this.create()}(0,u.default)(i,[{key:"center",get:function e(){return this._flyToPos?this._flyToPos:this._flyToPos.clone()}},{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();x.toColor=function(e){if(e instanceof Array){return Freedo.Color.fromBytes(e[0],e[1],e[2],e[3]*255)}else{return e}};x.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdShapeFile.prototype.create：参数无效");return}if(Freedo.defined(this._data.shpUrl)){this._data.prjUrl=this._data.shpUrl.replace(".shp",".prj")}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}this.build()};x.prototype.refresh=function(){this._viewer.scene.requestRender()};x.prototype.build=function(){var t=this;var I=this._data;var R=this;var O=[],N=[],B=[],H=[];Freedo.Resource.fetchText({url:I.prjUrl}).then(function(e){R._readPrj=e.replace(/Gauss_Kruger/gi,"Transverse_Mercator");proj4.defs("xx",R._readPrj);shapefile.open(I.shpUrl,undefined,{encoding:Freedo.defaultValue(t._data.encoding,"gb2312")}).then(function(D){return D.read().then(function e(t){if(t.done){if(R._shapeType=="Point"){R.drawPoint(O,I,H)}else if(R._shapeType=="LineString"){R.drawPolyline(N,I,H)}else if(R._shapeType=="Polygon"){console.log(B);console.log(H);if(H.length>0&&H[0][R._heightField]!=undefined){R.createBuildings(B,I,H)}else R.drawPolygon(B,I,H)}R._event.raiseEvent("DataChanged",R);R._viewer.scene.requestRender();return}if(R._shapeType==undefined)R._shapeType=t.value.geometry.type;if(R._shapeType=="Point"){var r=proj4("xx","WGS84",t.value.geometry.coordinates);if(Freedo.defined(I.offset)){if(Freedo.defined(r[2]))r[2]+=I.offset;else r[2]=I.offset}O.push(r)}else if(R._shapeType=="LineString"){var i=[];var n=true;var a=false;var o=undefined;try{for(var s=(0,V.default)(t.value.geometry.coordinates),l;!(n=(l=s.next()).done);n=true){var u=l.value;var d=proj4("xx","WGS84",u);i.push(d)}}catch(e){a=true;o=e}finally{try{if(!n&&s.return){s.return()}}finally{if(a){throw o}}}N.push(i)}else if(R._shapeType=="Polygon"){var c={lines:[],withHole:false};if(t.value.geometry.coordinates.length>=2){c.withHole=true}var f=true;var h=false;var p=undefined;try{for(var v=(0,V.default)(t.value.geometry.coordinates),m;!(f=(m=v.next()).done);f=true){var u=m.value;var _=[];var y=true;var g=false;var w=undefined;try{for(var F=(0,V.default)(u),b;!(y=(b=F.next()).done);y=true){var C=b.value;if(C.length>2){var x=[];var P=true;var M=false;var T=undefined;try{for(var E=(0,V.default)(C),S;!(P=(S=E.next()).done);P=true){var A=S.value;var k=proj4("xx","WGS84",A);x.push(k)}}catch(e){M=true;T=e}finally{try{if(!P&&E.return){E.return()}}finally{if(M){throw T}}}c.lines.push(x)}else{var L=proj4("xx","WGS84",C);_.push(L)}}}catch(e){g=true;w=e}finally{try{if(!y&&F.return){F.return()}}finally{if(g){throw w}}}if(_.length>0)c.lines.push(_)}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}B.push(c);console.log("Polygon：lines长度大于1的时候，第一个为边界线，后面的为岛");console.log(c)}H.push(t.value.properties);return D.read().then(e)})}).catch(function(e){return console.error(e.stack)})})};x.prototype.createLabel=function(e,t,r,i){function n(e,t){if(e==null||e==undefined)return null;if(!/^[0-9]*[1-9][0-9]*$/.test(t))return null;var r=new Array;var i=e.length;for(var n=0;n<i/t;n++){if((n+1)*t>i){r.push(e.substring(n*t,i))}else{r.push(e.substring(n*t,(n+1)*t))}}return r}var i=Freedo.defaultValue(this._data.offset,0);var a;if(r.type=="DivLabel"){a=this._mm.add("DivLabel",(0,o.default)({position:e,text:n(t,5).join("|"),offset:i,RTHeight:this._data.RTHeight},r))}else{a=this._mm.add("AnchorLabel",(0,o.default)({position:Freedo.FdMisc.FdGeometric.tg(e),width:124,height:64,text:n(t,5).join("|"),textColor:"rgba(255,255,255,1)",lineWidth:2,fontSize:12,offset:i,RTHeight:this._data.RTHeight},r))}this._labels.push(a)};x.prototype.updateHeight=function(){return;var e=true;var t=false;var r=undefined;try{for(var i=(0,V.default)(this._points),n;!(e=(n=i.next()).done);e=true){var a=n.value;var o=a.position._value;if(isNaN(o.x))continue;console.log(o);var s=Freedo.FdMisc.FdGeometric.tg(o);var l=new Freedo.Cartographic.fromDegrees(s[0],s[1],s[2]+5e3);var u;var d=this._viewer.scene;if(d.sampleHeightSupported){u=d.sampleHeight(l,this._points)}o=Freedo.FdMisc.FdGeometric.tc([s[0],s[1],u+.5]);a.position=o}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}};x.prototype.drawPoint=function(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];var a=x.toColor(Freedo.defaultValue(t.outlineColor,Freedo.Color.ORANGE));var o=Freedo.defaultValue(t.outlineWidth,2);if(t.outline==false){a=undefined;o=undefined}var s=Freedo.FdMisc.FdGeometric.tc(n);var l=this._viewer.entities.add({position:s,point:{color:x.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.ORANGE.withAlpha(.5))),pixelSize:Freedo.defaultValue(t.width,5),outlineColor:a,outlineWidth:o,show:false,heightReference:Freedo.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:2e4}});this._points.push(l);if(t.label){var u="无";if(t.labelOption){var d=[];var c=r[i];for(var f in c){if(t.labelOption){if(t.labelOption.textAtt.indexOf(f)>-1)d.push(c[f])}else{d.push(c[f])}}u=d.join("")}this.createLabel(s,u,t.labelOption)}}if(e.length>0&&this._autoFly){this._flyToPos=Freedo.Cartesian3.fromDegrees(e[0][0],e[0][1],e[0][2]);this._viewer.camera.flyTo({destination:this._flyToPos})}this._viewer.scene.requestRender()};x.prototype.drawPolyline=function(e,t,r){if(t.flow===true){this._polylines=this.createDynamicPolylines(e,t,r)}else{this._polylines=this._viewer.scene.primitives.add(this.createLinePrimitiveByPolylines(e,t,r))}this._viewer.scene.requestRender()};x.prototype.drawPolygon=function(e,t,r){var i=true;var n=false;var a=undefined;try{for(var o=(0,V.default)(e),s;!(i=(s=o.next()).done);i=true){var l=s.value;var u=this._viewer.scene.primitives.add(this.createLinePrimitiveByPolylines(l.lines,t,r));this._polygonLines.push(u)}}catch(e){n=true;a=e}finally{try{if(!i&&o.return){o.return()}}finally{if(n){throw a}}}this._polygons=this._viewer.scene.primitives.add(this.createAreaPrimitiveByPolygons(e,t,r));this._viewer.scene.requestRender()};x.prototype.createLinePrimitiveByPolylines=function(e,t,r){var i=[];var n=true;if(Freedo.defined(t.clampToGround)){n=t.clampToGround}else if(Freedo.defined(t.classification)){n=t.classification}for(var a=0;a<e.length;a++){var o=e[a],s=[];for(var l=0;l<o.length;l++){var u=Freedo.FdMisc.FdGeometric.tc(o[l]);s.push(u)}var d;if(n){d=new Freedo.GroundPolylineGeometry({positions:s,width:Freedo.defaultValue(t.lineWidth,1),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}else{d=new Freedo.PolylineGeometry({positions:s,width:Freedo.defaultValue(t.lineWidth,1),vertexFormat:Freedo.PolylineMaterialAppearance.VERTEX_FORMAT})}var c=new Freedo.GeometryInstance({geometry:d,id:this._id});c.att=r[a];i.push(c)}if(e.length>0&&e[0].length>0&&this._autoFly){this._flyToPos=Freedo.Cartesian3.fromDegrees(e[0][0][0],e[0][0][1],2e4);this._viewer.camera.flyTo({destination:this._flyToPos})}var f=void 0;if(n){f=new Freedo.GroundPolylinePrimitive({geometryInstances:i,releaseGeometryInstances:false,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:x.toColor(Freedo.defaultValue(t.lineColor,Freedo.Color.ORANGE))}}})})})}else{f=new Freedo.Primitive({geometryInstances:i,releaseGeometryInstances:false,appearance:new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:x.toColor(Freedo.defaultValue(t.lineColor,Freedo.Color.ORANGE))}}}),renderState:new Freedo.RenderState({polygonOffset:{enabled:false,factor:-1,units:0},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})})});if(!t.depthTest){f.depthFailAppearance=new Freedo.PolylineMaterialAppearance({material:new Freedo.Material({fabric:{type:"Color",uniforms:{color:x.toColor(Freedo.defaultValue(t.lineColor,Freedo.Color.ORANGE))}}})})}}return f};x.prototype.createAreaPrimitiveByPolygons=function(e,t,r){var i=[];var n=true;if(Freedo.defined(t.clampToGround)){n=t.clampToGround}else if(Freedo.defined(t.classification)){n=t.classification}for(var a=0;a<e.length;a++){var o=e[a];if(true){var s=[],l=[];for(var u=0;u<o.lines.length;u++){var d=[];var c=true;var f=false;var h=undefined;try{for(var p=(0,V.default)(o.lines[u]),v;!(c=(v=p.next()).done);c=true){var m=v.value;var _=Freedo.FdMisc.FdGeometric.tc(m);if(u==0)s.push(_);else d.push(_)}}catch(e){f=true;h=e}finally{try{if(!c&&p.return){p.return()}}finally{if(f){throw h}}}if(d.length>0)l.push(d)}var y=[];for(var u=0;u<l.length;u++){var g=new Freedo.PolygonHierarchy(l[u]);y.push(g)}var w=new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(s,y),vertexFormat:Freedo.EllipsoidSurfaceAppearance.VERTEX_FORMAT});var F=x.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.fromRandom({alpha:.9})));var b=new Freedo.GeometryInstance({geometry:w,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(F)},id:this._id,att:r[u]});i.push(b)}}if(e.length>0&&e[0].length>0&&this._autoFly){this._flyToPos=Freedo.Cartesian3.fromDegrees(e[0][0][0][0],e[0][0][0][1],2e4);this._viewer.camera.flyTo({destination:this._flyToPos})}var C=void 0;if(n){C=new Freedo.GroundPrimitive({geometryInstances:i,appearance:new Freedo.PerInstanceColorAppearance({flat:true}),classificationType:Freedo.ClassificationType.BOTH,asynchronous:false,show:true})}else{C=new Freedo.Primitive({geometryInstances:i,appearance:new Freedo.PerInstanceColorAppearance({flat:true,renderState:new Freedo.RenderState({polygonOffset:{enabled:true,factor:-1,units:-1},depthTest:{enabled:Freedo.defaultValue(t.depthTest,true),func:Freedo.WebGLConstants.LEQUAL}})}),asynchronous:false,show:true})}return C};x.prototype.createAreaGeometryInstance=function(e,t){var r=x.toColor(Freedo.defaultValue(t.fillColor,Freedo.Color.fromRandom({alpha:.5})));var i=new Freedo.GeometryInstance({geometry:new Freedo.PolygonGeometry({polygonHierarchy:new Freedo.PolygonHierarchy(e)}),attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(r)},id:this._id});return i};x.prototype.createBuilding=function(e,t,r,i){var n=this._viewer;if(!i){i=new Freedo.Color(0/255,162/255,255/255,.8)}var a=[];var o=void 0;var s=100;if(r[this._heightField])s=r[this._heightField];for(var l=t;l<s+t;l=l+4){o=n.entities.add({polygon:{hierarchy:new Freedo.PolygonHierarchy(Freedo.Cartesian3.fromDegreesArray(e)),height:l,extrudedHeight:l+4,material:i}});a.push(o);var u=2;var d=[];var c=.5;for(var f=0;f<e.length;f=f+2){d.push(e[f]);d.push(e[f+1]);d.push(l)}o=n.entities.add({polyline:{positions:Freedo.Cartesian3.fromDegreesArrayHeights(d),material:new Freedo.Color(1,1,1,c),width:u}});a.push(o);if(l+4>=s+t){d=[];for(var f=0;f<e.length;f=f+2){d.push(e[f]);d.push(e[f+1]);d.push(l+4)}o=n.entities.add({polyline:{positions:Freedo.Cartesian3.fromDegreesArrayHeights(d),material:new Freedo.Color(1,1,1,c),width:u}});a.push(o)}}var d=[];for(var f=0;f<e.length;f=f+2){d=[];d.push(e[f]);d.push(e[f+1]);d.push(0+t);d.push(e[f]);d.push(e[f+1]);d.push(s+t);o=n.entities.add({polyline:{positions:Freedo.Cartesian3.fromDegreesArrayHeights(d),material:new Freedo.Color(1,1,1,c),width:u}});a.push(o)}return a};x.prototype.createBuildings=function(e,t,r){for(var i in e){var n=e[i].lines[0];var a=[];for(var o in n){a.push(n[o][0]);a.push(n[o][1])}this.createBuilding(a,1,r[i])}};x.prototype.createDynamicPolylines=function(e,t,r){var i=[];for(var n=0;n<e.length;n++){var a=e[n],o=[];for(var s=0;s<a.length;s++){var l=Freedo.FdMisc.FdGeometric.tc(a[s]);o.push(l)}var u={positions:o,startTime:0,duration:6,forward:true,round:false};i.push(u)}if(e.length>0&&e[0].length>0&&this._autoFly){this._flyToPos=Freedo.Cartesian3.fromDegrees(e[0][0][0],e[0][0][1],2e4);this._viewer.camera.flyTo({destination:this._flyToPos})}var d=this._mm.add("DynamicLine",{routes:i,width:Freedo.defaultValue(t.lineWidth,1),color:x.toColor(Freedo.defaultValue(t.lineColor,Freedo.Color.WHITE.withAlpha(0))),depthTest:t.depthTest});return d};x.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};x.prototype.show=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,V.default)(this._points),n;!(e=(n=i.next()).done);e=true){var a=n.value;a.show=true}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}if(this._polylines!=undefined){if(this._polylines.show instanceof Function){this._polylines.show()}else{this._polylines.show=true}}if(this._polygons!=undefined){this._polygons.show=true}var o=true;var s=false;var l=undefined;try{for(var u=(0,V.default)(this._polygonLines),d;!(o=(d=u.next()).done);o=true){var c=d.value;c.show=true}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var f=true;var h=false;var p=undefined;try{for(var v=(0,V.default)(this._labels),m;!(f=(m=v.next()).done);f=true){var _=m.value;_.show=true}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}this._viewer.scene.requestRender()};x.prototype.hide=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,V.default)(this._points),n;!(e=(n=i.next()).done);e=true){var a=n.value;a.show=false}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}if(this._polylines!=undefined){if(this._polylines.show instanceof Function){this._polylines.hide()}else{this._polylines.show=false}}if(this._polygons!=undefined){this._polygons.show=false}var o=true;var s=false;var l=undefined;try{for(var u=(0,V.default)(this._polygonLines),d;!(o=(d=u.next()).done);o=true){var c=d.value;c.show=false}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}var f=true;var h=false;var p=undefined;try{for(var v=(0,V.default)(this._labels),m;!(f=(m=v.next()).done);f=true){var _=m.value;_.show=false}}catch(e){h=true;p=e}finally{try{if(!f&&v.return){v.return()}}finally{if(h){throw p}}}this._viewer.scene.requestRender()};x.prototype.clear=function(){var e=true;var t=false;var r=undefined;try{for(var i=(0,V.default)(this._points),n;!(e=(n=i.next()).done);e=true){var a=n.value;this._viewer.entities.remove(a)}}catch(e){t=true;r=e}finally{try{if(!e&&i.return){i.return()}}finally{if(t){throw r}}}if(this._polylines!=undefined&&this._viewer.scene.primitives.contains(this._polylines))this._viewer.scene.primitives.remove(this._polylines);if(this._polygons!=undefined)this._viewer.scene.primitives.remove(this._polygons);var o=true;var s=false;var l=undefined;try{for(var u=(0,V.default)(this._polygonLines),d;!(o=(d=u.next()).done);o=true){var c=d.value;this._viewer.scene.primitives.remove(c)}}catch(e){s=true;l=e}finally{try{if(!o&&u.return){u.return()}}finally{if(s){throw l}}}this._mm.dispose();this._points=[];this._polylines=undefined;this._polygons=undefined;this._polygonLines=[];this._labels=[];this._viewer.scene.requestRender()};x.prototype.remove=function(){this.clear();this._data=undefined;this._viewer.scene.requestRender()};x.prototype.getData=function(){if(!this._data)return undefined;return{id:this._id,type:"ShapeFile",option:this._data}};x.prototype.dispose=function(){this.remove()};t.FdShapeFile=x},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdGltf=undefined;var i=r(96);var f=l(i);var n=r(1);var a=l(n);var o=r(2);var s=l(o);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function i(e,t,r){(0,a.default)(this,i);this._viewer=e;this._id=t;this._data=r;this._model=undefined;this._event=new Freedo.Event;this._eventHelper=new Freedo.EventHelper;this.create()}(0,s.default)(i,[{key:"option",get:function e(){return Freedo.clone(this.getData(),true)}}]);return i}();u.prototype.create=function(){if(!Freedo.defined(this._data)){console.error("FdGltf.prototype.create：参数无效");return}if(!Freedo.defined(this._id)){this._id=Freedo.createGuid()}if(!this._data.position&&!this._data.modelMatrix){console.error("FdGltf.prototype.create：position or modelMatrix未指定");return}else{if(typeof this._data.position=="string")this._data.position=this._data.position.split(",").map(function(e){return parseFloat(e)});this.build()}};u.prototype.refresh=function(){this._viewer.scene.requestRender()};u.prototype.build=function(){var i=this;var e=this._data;var t=e.url;var n=e.autoFly;var r;if(Freedo.defined(e.position)){var a;var o=(a=Freedo.Cartesian3).fromDegrees.apply(a,(0,f.default)(e.position));var s=Freedo.defaultValue(e.heading,0);var l=new Freedo.HeadingPitchRoll(Freedo.Math.toRadians(s),0,0);var u=Freedo.Quaternion.fromHeadingPitchRoll(l);var d=Freedo.Matrix3.fromQuaternion(u);r=Freedo.Transforms.eastNorthUpToFixedFrame(o);r=Freedo.Matrix4.multiplyByMatrix3(r,d,r)}else{r=Freedo.Matrix4.fromArray(e.modelMatrix,r)}this._model=Freedo.Model.fromGltf({url:t,modelMatrix:r});this._viewer.scene.primitives.add(this._model);var c=this;this._model.readyPromise.then(function(e){if(n){var t=Cesium.Matrix4.multiplyByPoint(e.modelMatrix,e.boundingSphere.center,new Freedo.Cartesian3);var r=new Freedo.BoundingSphere(t,e.boundingSphere.radius);c._viewer.camera.flyToBoundingSphere(r)}i._event.raiseEvent("DataChanged",i)});this._viewer.scene.requestRender()};u.prototype.on=function(e,t){return this._eventHelper.add(this._event,e,t)};u.prototype.remove=function(){if(this._model)this._viewer.scene.primitives.remove(this._model);this._model=undefined};u.prototype.show=function(e){this._model.show=e;this._viewer.scene.requestRender()};u.prototype.hide=function(){this.show(false)};u.prototype.getData=function(){if(!this._data)return undefined;var e=this._model?{url:this._data.url,autoFly:this._data.autoFly,modelMatrix:Freedo.Matrix4.toArray(this._model.modelMatrix)}:Freedo.clone(this._data,true);return{id:this._id,type:"GLTF",option:e}};u.prototype.setModelMatrix=function(e){if(this._model){this._model.modelMatrix=Freedo.clone(e,true);this._event.raiseEvent("DataChanged",this)}};u.prototype.reset=function(){};u.prototype.dispose=function(){this.reset();this.remove()};t.FdGltf=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdEffect=undefined;var i=r(1);var n=f(i);var a=r(749);var o=r(750);var s=r(751);var l=r(752);var u=r(753);var d=r(754);var c=r(755);function f(e){return e&&e.__esModule?e:{default:e}}var h=function e(){(0,n.default)(this,e);throw new Error("FdTools should not be instatiated!")};h.FdDynamicFan=a.FdDynamicFan;h.FdDynamicArc=o.FdDynamicArc;h.FdDynamicDialCircle=s.FdDynamicDialCircle;h.FdDynamicSemiLine=l.FdDynamicSemiLine;h.FdRotatingCircle=u.FdRotatingCircle;h.FdFlowTextureLine=d.FdFlowTextureLine;h.FdTextureFrame=c.FdTextureFrame;t.FdEffect=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){this._primitive=undefined;this._deltaInnerRadius=0;this._deltaOuterRadius=0;this._deltaRadians=0;this._playStatus=0;this._viewer=e;this._options=Freedo.clone(t,true);this._options.beginRadian=Freedo.defaultValue(this._options.beginRadian,0);this._options.endRadian=Freedo.defaultValue(this._options.endRadian,2*Math.PI);this._options.innerRadius=Freedo.defaultValue(this._options.innerRadius,0);this._options.gradualAlpha=Freedo.defaultValue(this._options.gradualAlpha,false);this._options.angleSpeed=Freedo.defaultValue(this._options.angleSpeed,0);this._options.innerSpeed=Freedo.defaultValue(this._options.innerSpeed,0);this._options.outerSpeed=Freedo.defaultValue(this._options.outerSpeed,0);this._options.loop=Freedo.defaultValue(this._options.loop,false);this._options.duration=Freedo.defaultValue(this._options.duration,10);this._animationFinished=new Freedo.Event}i.prototype.create=function(){if(Freedo.defined(this._primitive)){return}var e=this._options.color;var t=this._options.innerRadius;var r=this._options.outerRadius;var i=this._options.beginRadian;var n=this._options.endRadian;var a=this._options.gradualAlpha;var o=[];var s=[];var l=[];var u=[];var d=2;var c=1e-11;var f=0;for(var h=0;h<360+d;h+=d){var p=Freedo.Math.toRadians(h);var v=Math.sin(p);var m=Math.cos(p);o.push(c*v);o.push(c*m);o.push(0);s.push(0),s.push(1),s.push(0),l.push(c);l.push(p);o.push(v);o.push(m);o.push(0);s.push(0),s.push(1),s.push(0),l.push(1);l.push(p);f++}for(var _=0;_<f-1;_++){u.push(2*_+1);u.push(2*_);u.push(2*_+2);u.push(2*_+1);u.push(2*_+2);u.push(2*_+3)}var y=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(o)}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(s),normalize:true}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(l),normalize:true})},indices:new Uint32Array(u),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:new Freedo.BoundingSphere(Freedo.Cartesian3.ZERO,1)});var g=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:y}),appearance:new Freedo.MaterialAppearance({material:new Freedo.Material({fabric:{type:"FdDynamicFan",uniforms:{color:e,innerRadius:t/r,beginRadian:i,endRadian:n,gradualAlpha:a?1:0},source:"\n\t\t\t\t\t\tuniform vec4 color;\n\t\t\t\t\t\tuniform float innerRadius;\t\t\t\t\t\t\n\t\t\t\t\t\tuniform float beginRadian;\n                        uniform float endRadian;\n                        uniform float gradualAlpha;\n\n\t\t\t\t\t\tczm_material czm_getMaterial(czm_materialInput materialInput)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tczm_material material = czm_getDefaultMaterial(materialInput);\t\n                            material.diffuse = color.rgb;\t\n                            \n                            vec2 st = materialInput.st;\n                            float c = (innerRadius + 1.0) * 0.5;\n                            float alpha = gradualAlpha > 0.5 ? color.a * (1.0 - abs(st.x - c) / (1.0 - c)) : color.a;\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(st.x >= innerRadius) {\n\t\t\t\t\t\t\t\tif(beginRadian <= endRadian) {\n\t\t\t\t\t\t\t\t\tif(st.y >= beginRadian && st.y <= endRadian) {\n\t\t\t\t\t\t\t\t\t\tmaterial.alpha = alpha;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tmaterial.alpha = 0.0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tif(st.y > endRadian && st.y < beginRadian) {\n\t\t\t\t\t\t\t\t\t\tmaterial.alpha = 0.0;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tmaterial.alpha = alpha;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tmaterial.alpha = 0.0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn material;\n\t\t\t\t\t\t}\n\t\t\t\t\t"},translucent:true}),faceForward:true,flat:true}),compressVertices:false,asynchronous:false,cull:false});this._primitive=g;this.updateMatrix();this._viewer.scene.primitives.add(this._primitive);this._viewer.scene.requestRender()};i.prototype.destroy=function(){if(Freedo.defined(this._primitive)){this._viewer.scene.primitives.remove(this._primitive);this._primitive=undefined;this._viewer.scene.requestRender()}this._deltaInnerRadius=0;this._deltaOuterRadius=0;this._deltaRadians=0;if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}};i.prototype.updateMatrix=function(){if(Freedo.defined(this._primitive)){if(!Freedo.defined(this._worldMatrix)){this._worldMatrix=new Freedo.Matrix4}if(!Freedo.defined(this._matrix)){this._matrix=new Freedo.Matrix4}Freedo.Transforms.eastNorthUpToFixedFrame(this._options.center,undefined,this._worldMatrix);var e=this._options.outerRadius+this._deltaOuterRadius;this._primitive.modelMatrix=Freedo.Matrix4.multiplyByScale(this._worldMatrix,new Freedo.Cartesian3(e,e,1),this._matrix);this._viewer.scene.requestRender()}};i.prototype.updateColor=function(){if(Freedo.defined(this._primitive)){this._primitive.appearance.material.uniforms.color=this._options.color;this._viewer.scene.requestRender()}};i.prototype.updateAnimation=function(){if(Freedo.defined(this._primitive)){var e=function e(t){if(t>2*Math.PI||t<0){var r=2*Math.PI;t%=r;while(t<0){t+=r}while(t>r){t-=r}}return t};var t=this._options.beginRadian+this._deltaRadians;var r=this._options.endRadian+this._deltaRadians;t=e(t);r=e(r);var i=this._options.outerRadius+this._deltaOuterRadius;var n=this._options.innerRadius+this._deltaInnerRadius;this._primitive.modelMatrix=Freedo.Matrix4.multiplyByScale(this._worldMatrix,new Freedo.Cartesian3(i,i,1),this._matrix);this._primitive.appearance.material.uniforms.innerRadius=n/i;this._primitive.appearance.material.uniforms.beginRadian=t;this._primitive.appearance.material.uniforms.endRadian=r;this._viewer.scene.requestRender()}};i.prototype.tick=function(){var e=(new Date).getTime();if(this._playStatus===1){if(!Freedo.defined(this._lastTime)){this._lastTime=e}else{var t=e-this._lastTime;t/=1e3;this._timeUsed+=t;if(this._timeUsed>=this._options.duration){if(this._options.loop){this._deltaInnerRadius=0;this._deltaOuterRadius=0;this._deltaRadians=0;this._timeUsed=0}else{this._timeUsed=this._options.duration;if(Freedo.defined(this._autoStoped)||this._autoStoped===false){this._autoStoped=true;if(this._animationFinished.numberOfListeners>0){this._animationFinished.raiseEvent(this)}}}t=0}this._deltaInnerRadius+=this._options.innerSpeed*t;this._deltaOuterRadius+=this._options.outerSpeed*t;this._deltaRadians+=this._options.angleSpeed*t;this.updateAnimation()}}this._lastTime=e};i.prototype.play=function(){if(this._playStatus===0||this._playStatus===2){this._autoStoped=false;if(this._playStatus===0){this._timeUsed=0;var e=this;this._listener=this._viewer.scene.postRender.addEventListener(function(){e.tick()})}this._playStatus=1}};i.prototype.pause=function(){if(this._playStatus===1){this._playStatus=2}};i.prototype.stop=function(){if(this._playStatus===1||this._playStatus===2){this._playStatus=0;this._autoStoped=false;this._deltaInnerRadius=0;this._deltaOuterRadius=0;this._deltaRadians=0;if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}}};i.prototype.update=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.center=Freedo.defaultValue(e.center,this._options.center);this._options.color=Freedo.defaultValue(e.color,this._options.color);this._options.innerRadius=Freedo.defaultValue(e.innerRadius,this._options.innerRadius);this._options.outerRadius=Freedo.defaultValue(e.outerRadius,this._options.outerRadius);this._options.beginRadian=Freedo.defaultValue(e.beginRadian,this._options.beginRadian);this._options.endRadian=Freedo.defaultValue(e.endRadian,this._options.endRadian);this._options.gradualAlpha=Freedo.defaultValue(e.gradualAlpha,this._options.gradualAlpha);this._options.innerSpeed=Freedo.defaultValue(e.innerSpeed,this._options.innerSpeed);this._options.outerSpeed=Freedo.defaultValue(e.outerSpeed,this._options.outerSpeed);this._options.angleSpeed=Freedo.defaultValue(e.angleSpeed,this._options.angleSpeed);this._options.loop=Freedo.defaultValue(e.loop,this._options.loop);this._options.duration=Freedo.defaultValue(e.duration,this._options.duration);if(Freedo.defined(this._primitive)){if(Freedo.defined(e.center)){this.updateMatrix()}if(Freedo.defined(e.color)){this.updateColor()}if(Freedo.defined(e.gradualAlpha)){this._primitive.appearance.material.uniforms.gradualAlpha=this._options.gradualAlpha?1:0}if(Freedo.defined(e.innerRadius)||Freedo.defined(e.outerRadius)||Freedo.defined(e.beginRadian)||Freedo.defined(e.endRadian)){this.updateAnimation()}}};Freedo.defineProperties(i.prototype,{show:{get:function e(){if(Freedo.defined(this._primitive)){return this._primitive.show}else{return false}},set:function e(t){if(Freedo.defined(this._primitive)){this._primitive.show=t;this._viewer.scene.requestRender()}}},finishedEvent:{get:function e(){return this._animationFinished}}});t.FdDynamicFan=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicArc=undefined;var i=r(55);var n=d(i);var a=r(1);var o=d(a);var s=r(2);var l=d(s);var u=r(271);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function r(e,t){(0,o.default)(this,r);this._viewer=e;this._finishedEvent=new Freedo.Event;this.initOption(t);this._currentAngle=0;this._usedTime=0}(0,l.default)(r,[{key:"create",value:function e(){var t=this.generateArcPts();var r=this._width;if(!this._lines){this._lines=this._viewer.scene.primitives.add(new Freedo.PolylineCollection({modelMatrix:this.updateMatrix()}))}var i=this._lineStyle=="Dash"?Freedo.Material.PolylineDashType:Freedo.Material.ColorType;var n=Freedo.Material.fromType(i,{color:this._color});this._lines.add({positions:t,width:r,material:n});this._viewer.scene.requestRender()}},{key:"generateArcPts",value:function e(){function t(e){if(e>2*Math.PI||e<0){var t=2*Math.PI;e%=t;while(e<0){e+=t}while(e>t){e-=t}}return e}var r=t(this._beginRadian),i=t(this._endRadian);if(r>i){i+=Math.PI*2}var n=[];var a=.01;for(var o=r;o<i+a;o+=a){var s=Math.sin(o);var l=Math.cos(o);n.push(new Freedo.Cartesian3(s,l,0))}return n}},{key:"updateMatrix",value:function e(t){if(!t){t=Freedo.Transforms.eastNorthUpToFixedFrame(this._center,undefined,new Freedo.Matrix4);Freedo.Matrix4.multiplyByScale(t,new Freedo.Cartesian3(this._radius,this._radius,1),t);(0,u.rotateMatrix)(t,Freedo.Cartesian3.UNIT_Z,this._currentAngle,t)}this._lines&&(this._lines.modelMatrix=t);this._viewer.scene.requestRender();return t}},{key:"updateStyle",value:function e(){this._lines.removeAll();this.create()}},{key:"startRotating",value:function e(){var r=this;if(this._removeLoop)return;var i=undefined;this._removeLoop=this._viewer.scene.postRender.addEventListener(function(){var e=(new Date).getTime();if(!i)i=e;var t=e-i;r._usedTime+=t;i=e;r._currentAngle+=-r._angleSpeed*t/1e3;r.updateMatrix();if(r._usedTime>=r._duration*1e3){r._usedTime=0;if(!r._loop){r._removeLoop();r._removeLoop=undefined;r._finishedEvent.raiseEvent(r)}}})}},{key:"play",value:function e(){this.startRotating()}},{key:"pause",value:function e(){if(!this._removeLoop)return;this._removeLoop();this._removeLoop=undefined}},{key:"stop",value:function e(){if(!this._lines)return;if(!this._removeLoop)return;this._removeLoop();this._removeLoop=undefined;this._currentAngle=0;this.updateMatrix()}},{key:"initOption",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this._option=t;this._color=Freedo.defaultValue(t.color,Freedo.Color.RED);this._radius=Freedo.defaultValue(t.radius,100);this._beginRadian=Freedo.defaultValue(t.beginRadian,0);this._endRadian=Freedo.defaultValue(t.endRadian,2*Math.PI);this._width=Freedo.defaultValue(t.width,2);this._lineStyle=Freedo.defaultValue(t.lineStyle,"Dash");this._center=Freedo.defaultValue(t.center,new Freedo.Cartesian3);this._angleSpeed=Freedo.defaultValue(t.angleSpeed,.1);this._speed=Freedo.defaultValue(t.speed,10);this._loop=Freedo.defaultValue(t.loop,true);this._show=Freedo.defaultValue(t.show,true);this._duration=Freedo.defaultValue(t.duration,10)}},{key:"update",value:function e(t){var r=(0,n.default)({},this._option,t);this.initOption(r);this.updateMatrix();this.updateStyle()}},{key:"destroy",value:function e(){this.stop();this._viewer.scene.primitives.remove(this._lines)}},{key:"finishedEvent",get:function e(){return this._finishedEvent}},{key:"show",get:function e(){return this._show},set:function e(t){this._show=!!t;if(this._lines){for(var r=0;r<this._lines.length;r++){this._lines.get(r).show=this._show}}}}]);return r}();t.FdDynamicArc=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicDialCircle=undefined;var i=r(55);var n=c(i);var a=r(3);var f=c(a);var o=r(1);var s=c(o);var l=r(2);var u=c(l);var d=r(271);function c(e){return e&&e.__esModule?e:{default:e}}var h=function(){function r(e,t){(0,s.default)(this,r);this._viewer=e;this._finishedEvent=new Freedo.Event;this.initOption(t);this._currentAngle=0;this._rUsedTime=0;this._sUsedTime=0}(0,u.default)(r,[{key:"initOption",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this._option=t;this._color=Freedo.defaultValue(t.color,Freedo.Color.RED);this._innerRadius=Freedo.defaultValue(t.innerRadius,100);this._outerRadius=Freedo.defaultValue(t.outerRadius,200);this._width=Freedo.defaultValue(t.width,2);this._lineStyle=Freedo.defaultValue(t.lineStyle,"Dash");this._center=Freedo.defaultValue(t.center,new Freedo.Cartesian3);this._speed=Freedo.defaultValue(t.speed,10);this._angleSpeed=Freedo.defaultValue(t.angleSpeed,.1);this._loop=Freedo.defaultValue(t.loop,true);this._show=Freedo.defaultValue(t.show,true);this._duration=Freedo.defaultValue(t.duration,10);if(!this._rLoop){this._currentRadius=this._outerRadius}}},{key:"create",value:function e(){var t=this.generateLines();var r=this._width;var i=this.updateMatrix();if(!this._lines){this._lines=this._viewer.scene.primitives.add(new Freedo.PolylineCollection({modelMatrix:i}))}var n=this._lineStyle=="Dash"?Freedo.Material.PolylineDashType:Freedo.Material.ColorType;var a=true;var o=false;var s=undefined;try{for(var l=(0,f.default)(t),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=Freedo.Material.fromType(n,{color:this._color});this._lines.add({positions:d,width:r,material:c})}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}this._viewer.scene.requestRender()}},{key:"generateLines",value:function e(){var t=[],r=[],i=this._innerRadius/this._outerRadius;var n=1;for(var a=0;a<360+n;a+=n){var o=Freedo.Math.toRadians(a);var s=Math.sin(o);var l=Math.cos(o);t.push(new Freedo.Cartesian3(s,l,0));if(a%3==0){r.push([new Freedo.Cartesian3(s,l,0),new Freedo.Cartesian3(s*i,l*i,0)])}}r.push(t);return r}},{key:"updateMatrix",value:function e(t){if(!t){t=Freedo.Transforms.eastNorthUpToFixedFrame(this._center,undefined,new Freedo.Matrix4);Freedo.Matrix4.multiplyByScale(t,new Freedo.Cartesian3(this._currentRadius,this._currentRadius,1),t);(0,d.rotateMatrix)(t,Freedo.Cartesian3.UNIT_Z,this._currentAngle,t)}this._lines&&(this._lines.modelMatrix=t);this._viewer.scene.requestRender();return t}},{key:"updateStyle",value:function e(){this._lines.removeAll();this.create()}},{key:"startRotating",value:function e(){var r=this;if(this._rLoop)return;var i=undefined;this._rLoop=this._viewer.scene.postRender.addEventListener(function(){var e=(new Date).getTime();if(!i)i=e;var t=e-i;r._rUsedTime+=t;i=e;r._currentAngle+=-r._angleSpeed*t/1e3;r.updateMatrix();if(!r._loop&&r._rUsedTime>=r._duration*1e3){r._rLoop();r._rLoop=undefined;r._finishedEvent.raiseEvent(r)}})}},{key:"startScalar",value:function e(){var r=this;if(this._sLoop)return;var i=undefined;this._sLoop=this._viewer.scene.postRender.addEventListener(function(){var e=(new Date).getTime();if(!i)i=e;var t=e-i;r._sUsedTime+=t;i=e;r._currentRadius+=r._speed*t/1e3;r.updateMatrix();if(r._currentRadius>=r._outerRadius){r._currentRadius=0}if(!r._loop&&r._sUsedTime>=r._duration*1e3){r._sLoop();r._sLoop=undefined;r._finishedEvent.raiseEvent(r)}})}},{key:"play",value:function e(){this.startRotating()}},{key:"pause",value:function e(){this._rLoop&&this._rLoop();this._rLoop=undefined;this._sLoop&&this._sLoop();this._sLoop=undefined}},{key:"stop",value:function e(){if(!this._lines)return;this._rLoop&&this._rLoop();this._rLoop=undefined;this._sLoop&&this._sLoop();this._sLoop=undefined;this._currentAngle=0;this._currentRadius=this._outerRadius;this.updateMatrix()}},{key:"update",value:function e(t){var r=(0,n.default)({},this._option,t);this.initOption(r);this.updateMatrix();this.updateStyle()}},{key:"destroy",value:function e(){this.stop();this._viewer.scene.primitives.remove(this._lines)}},{key:"show",get:function e(){return this._show},set:function e(t){this._show=!!t;if(this._lines){for(var r=0;r<this._lines.length;r++){this._lines.get(r).show=this._show}}}},{key:"finishedEvent",get:function e(){return this._finishedEvent}}]);return r}();t.FdDynamicDialCircle=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdDynamicSemiLine=undefined;var i=r(55);var n=d(i);var a=r(3);var f=d(a);var o=r(1);var s=d(o);var l=r(2);var u=d(l);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(){function r(e,t){(0,s.default)(this,r);this._viewer=e;this._finishedEvent=new Freedo.Event;this.initOption(t);this._usedTime=0}(0,u.default)(r,[{key:"initOption",value:function e(t){this._option=t;this._color=Freedo.defaultValue(t.color,Freedo.Color.RED);this._radius=Freedo.defaultValue(t.radius,100);this._width=Freedo.defaultValue(t.width,2);this._lineStyle=Freedo.defaultValue(t.lineStyle,"Dash");this._center=Freedo.defaultValue(t.center,new Freedo.Cartesian3);this._speed=Freedo.defaultValue(t.speed,10);this._loop=Freedo.defaultValue(t.loop,true);if(!this._removeLoop){this._currentRadius=this._radius}this._duration=Freedo.defaultValue(t.duration,10)}},{key:"create",value:function e(){var t=this.generateSemiLines();var r=this._width;var i=this.updateMatrix();if(!this._lines){this._lines=this._viewer.scene.primitives.add(new Freedo.PolylineCollection({modelMatrix:i}))}var n=this._lineStyle=="Dash"?Freedo.Material.PolylineDashType:Freedo.Material.ColorType;var a=true;var o=false;var s=undefined;try{for(var l=(0,f.default)(t),u;!(a=(u=l.next()).done);a=true){var d=u.value;var c=Freedo.Material.fromType(n,{color:this._color});this._lines.add({positions:d,width:r,material:c})}}catch(e){o=true;s=e}finally{try{if(!a&&l.return){l.return()}}finally{if(o){throw s}}}this._viewer.scene.requestRender()}},{key:"generateSemiLines",value:function e(){var t=[];var r=45;for(var i=0;i<360+r;i+=r){var n=Freedo.Math.toRadians(i);var a=Math.sin(n);var o=Math.cos(n);t.push([new Freedo.Cartesian3(a,o,0),new Freedo.Cartesian3(0,0,0)])}return t}},{key:"updateMatrix",value:function e(t){if(!t){t=Freedo.Transforms.eastNorthUpToFixedFrame(this._center,undefined,new Freedo.Matrix4);Freedo.Matrix4.multiplyByScale(t,new Freedo.Cartesian3(this._currentRadius,this._currentRadius,1),t)}this._lines&&(this._lines.modelMatrix=t);this._viewer.scene.requestRender();return t}},{key:"updateStyle",value:function e(){this._lines.removeAll();this.create()}},{key:"startAnimation",value:function e(){var r=this;if(this._removeLoop)return;var i=undefined;this._removeLoop=this._viewer.scene.postRender.addEventListener(function(){var e=(new Date).getTime();if(!i)i=e;var t=e-i;r._usedTime+=t;i=e;r._currentRadius+=r._speed*t/1e3;r.updateMatrix();if(r._currentRadius>=r._radius){r._currentRadius=0}if(r._usedTime>=r._duration*1e3){r._usedTime=0;if(!r._loop){r._removeLoop();r._removeLoop=undefined;r._finishedEvent.raiseEvent(r)}}})}},{key:"play",value:function e(){this.startAnimation()}},{key:"pause",value:function e(){if(!this._removeLoop)return;this._removeLoop();this._removeLoop=undefined}},{key:"stop",value:function e(){if(!this._lines)return;if(!this._removeLoop)return;this._removeLoop();this._removeLoop=undefined;this._currentRadius=this._radius;this.updateMatrix()}},{key:"update",value:function e(t){var r=(0,n.default)({},this._option,t);this.initOption(r);this.updateMatrix();this.updateStyle()}},{key:"destroy",value:function e(){this.stop();this._viewer.scene.primitives.remove(this._lines)}},{key:"show",get:function e(){return this._show},set:function e(t){this._show=!!t;if(this._lines){for(var r=0;r<this._lines.length;r++){this._lines.get(r).show=this._show}}}},{key:"finishedEvent",get:function e(){return this._finishedEvent}}]);return r}();t.FdDynamicSemiLine=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){this._primitive=undefined;this._deltaRadians=0;this._playStatus=0;this._viewer=e;this._options=Freedo.clone(t,true);this._options.radius=Freedo.defaultValue(this._options.radius,0);this._options.angleSpeed=Freedo.defaultValue(this._options.angleSpeed,0);this._options.loop=Freedo.defaultValue(this._options.loop,false);this._options.duration=Freedo.defaultValue(this._options.duration,10);this._animationFinished=new Freedo.Event}i.prototype.create=function(){if(Freedo.defined(this._primitive)){return}var e=this._options.color;var t=[];var r=[];t.push(0);t.push(0);t.push(0);var i=2;var n=0;for(var a=0;a<360+i;a+=i){var o=Freedo.Math.toRadians(a);var s=Math.sin(o);var l=Math.cos(o);t.push(s);t.push(l);t.push(0);n++}for(var u=0;u<n-1;u++){r.push(0);r.push(u+2);r.push(u+1)}var d=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)})},indices:new Uint16Array(r),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:new Freedo.BoundingSphere(Freedo.Cartesian3.ZERO,1)});var c=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:d,attributes:{color:Freedo.ColorGeometryInstanceAttribute.fromColor(e)}}),appearance:new Freedo.PerInstanceColorAppearance({flat:true,translucent:true}),asynchronous:false,cull:false});this._primitive=c;this.updateMatrix();this._viewer.scene.primitives.add(this._primitive);if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()};i.prototype.destroy=function(){if(Freedo.defined(this._primitive)){this._viewer.scene.primitives.remove(this._primitive);this._primitive=undefined;if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}this._deltaRadians=0;if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}};i.prototype.updateMatrix=function(){if(Freedo.defined(this._primitive)){if(!Freedo.defined(this._matrix)){this._matrix=new Freedo.Matrix4}var e=Freedo.Transforms.eastNorthUpToFixedFrame(this._options.rotateCenter,undefined,this._matrix);var t=Freedo.Quaternion.fromAxisAngle(Freedo.Cartesian3.UNIT_Z,-1*this._deltaRadians,new Freedo.Quaternion);var r=Freedo.Matrix3.fromQuaternion(t,new Freedo.Matrix3);e=Freedo.Matrix4.multiplyByMatrix3(e,r,e);var i=this._options.circleOffset;e=Freedo.Matrix4.multiplyByTranslation(e,i,e);var n=new Freedo.Cartesian3(this._options.radius,this._options.radius,1);e=Freedo.Matrix4.multiplyByScale(e,n,e);this._primitive.modelMatrix=e;if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}};i.prototype.updateColor=function(){if(Freedo.defined(this._primitive)){var e=this._primitive._batchTableAttributeIndices["color"];var t=new Freedo.Cartesian4(this._options.color.red*255,this._options.color.green*255,this._options.color.blue*255,this._options.color.alpha*255);this._primitive._batchTable.setBatchedAttribute(0,e,t);if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}};i.prototype.tick=function(){var e=(new Date).getTime();if(this._playStatus===1){if(!Freedo.defined(this._lastTime)){this._lastTime=e}else{var t=e-this._lastTime;t/=1e3;this._timeUsed+=t;if(this._timeUsed>=this._options.duration){if(this._options.loop){this._deltaRadians=0;this._timeUsed=0}else{this._timeUsed=this._options.duration;if(Freedo.defined(this._autoStoped)||this._autoStoped===false){this._autoStoped=true;if(this._animationFinished.numberOfListeners>0){this._animationFinished.raiseEvent(this)}}}t=0}this._deltaRadians+=this._options.angleSpeed*t;this.updateMatrix()}}this._lastTime=e};i.prototype.play=function(){if(this._playStatus===0||this._playStatus===2){this._autoStoped=false;if(this._playStatus===0){this._timeUsed=0;var e=this;this._listener=this._viewer.scene.postRender.addEventListener(function(){e.tick()})}this._playStatus=1}};i.prototype.pause=function(){if(this._playStatus===1){this._playStatus=2}};i.prototype.stop=function(){if(this._playStatus===1||this._playStatus===2){this._playStatus=0;this._autoStoped=false;this._deltaRadians=0;if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}}};i.prototype.update=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.rotateCenter=Freedo.defaultValue(e.rotateCenter,this._options.rotateCenter);this._options.circleOffset=Freedo.defaultValue(e.circleOffset,this._options.circleOffset);this._options.radius=Freedo.defaultValue(e.radius,this._options.radius);this._options.color=Freedo.defaultValue(e.color,this._options.color);this._options.angleSpeed=Freedo.defaultValue(e.angleSpeed,this._options.angleSpeed);this._options.loop=Freedo.defaultValue(e.loop,this._options.loop);this._options.duration=Freedo.defaultValue(e.duration,this._options.duration);if(Freedo.defined(this._primitive)){if(Freedo.defined(e.circleOffset)||Freedo.defined(e.rotateCenter)||Freedo.defined(e.radius)){this.updateMatrix()}if(Freedo.defined(e.color)){this.updateColor()}}};Freedo.defineProperties(i.prototype,{show:{get:function e(){if(Freedo.defined(this._primitive)){return this._primitive.show}else{return false}},set:function e(t){if(Freedo.defined(this._primitive)){this._primitive.show=t;if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}}},finishedEvent:{get:function e(){return this._animationFinished}}});t.FdRotatingCircle=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){this._primitive=undefined;this._playStatus=0;this._offset=new Freedo.Cartesian2(0,0);this._deltaSize=new Freedo.Cartesian2(0,0);this._viewer=e;this._options=Freedo.clone(t,false);this._options.speed=Freedo.defaultValue(this._options.speed,0);this._options.sizeSpeed=Freedo.defined(this._options.sizeSpeed)?Freedo.Cartesian2.clone(this._options.sizeSpeed,new Freedo.Cartesian2):new Freedo.Cartesian2(0,0);this._options.loop=Freedo.defaultValue(this._options.loop,false);this._options.duration=Freedo.defaultValue(this._options.duration,10);this._animationFinished=new Freedo.Event}i.prototype.create=function(){if(Freedo.defined(this._primitive)){return}var e=this._options.texture;var t=[];var r=[];var i=[];var n=[];t.push(-.5);t.push(0);t.push(0);r.push(0);r.push(-1);r.push(0);i.push(.5);i.push(0);t.push(.5);t.push(0);t.push(0);r.push(0);r.push(-1);r.push(0);i.push(.5);i.push(1);t.push(.5);t.push(0);t.push(1);r.push(0);r.push(-1);r.push(0);i.push(1);i.push(1);t.push(-.5);t.push(0);t.push(1);r.push(0);r.push(-1);r.push(0);i.push(1);i.push(0);n.push(0);n.push(1);n.push(2);n.push(0);n.push(2);n.push(3);var a=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(t)}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(r),normalize:true}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(i)})},indices:new Uint16Array(n),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:new Freedo.BoundingSphere(new Freedo.Cartesian3(0,0,.5),.707)});var o=new Freedo.Material({translucent:true,fabric:{type:"Image",uniforms:{offset:this._offset},components:{alpha:"texture2D(image, fract(materialInput.st - offset)).a",diffuse:"texture2D(image, fract(materialInput.st - offset)).rgb"}}});o.uniforms.image=e;var s=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:a}),appearance:new Freedo.MaterialAppearance({translucent:true,material:o,flat:true,faceForward:true}),compressVertices:false,asynchronous:false,cull:false});this._primitive=s;this.updateMatrix();this._viewer.scene.primitives.add(this._primitive);this._viewer.scene.requestRender();var l=this;this._listener=this._viewer.scene.preRender.addEventListener(function(){l.tick();l.updateMatrix()})};i.prototype.destroy=function(){if(Freedo.defined(this._primitive)){this._viewer.scene.primitives.remove(this._primitive);this._primitive=undefined;this._viewer.scene.requestRender()}this._offset.x=0;this._deltaSize.x=0;this._deltaSize.y=0;if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}};i.prototype.updateMatrix=function(){if(Freedo.defined(this._primitive)){if(!Freedo.defined(this._matrix)){this._matrix=new Freedo.Matrix4}var e=Freedo.Transforms.eastNorthUpToFixedFrame(this._options.point,undefined,this._matrix);var t=this._viewer.scene.camera.heading;var r=Freedo.Quaternion.fromAxisAngle(Freedo.Cartesian3.UNIT_Z,-1*t,new Freedo.Quaternion);var i=Freedo.Matrix3.fromQuaternion(r,new Freedo.Matrix3);e=Freedo.Matrix4.multiplyByMatrix3(e,i,e);var n=new Freedo.Cartesian3(this._options.width+this._deltaSize.x,1,this._options.length+this._deltaSize.y);e=Freedo.Matrix4.multiplyByScale(e,n,e);this._primitive.modelMatrix=e;this._viewer.scene.requestRender()}};i.prototype.updateAnimation=function(){if(Freedo.defined(this._primitive)){this._primitive.appearance.material.uniforms.offset=this._offset;this._viewer.scene.requestRender()}};i.prototype.tick=function(){var e=(new Date).getTime();if(this._playStatus===1){if(!Freedo.defined(this._lastTime)){this._lastTime=e}else{var t=e-this._lastTime;t/=1e3;this._timeUsed+=t;if(this._timeUsed>=this._options.duration){if(this._options.loop){this._offset.x=0;this._deltaSize.x=0;this._deltaSize.y=0;this._timeUsed=0}else{this._timeUsed=this._options.duration;if(Freedo.defined(this._autoStoped)||this._autoStoped===false){this._autoStoped=true;if(this._animationFinished.numberOfListeners>0){this._animationFinished.raiseEvent(this)}}}t=0}this._deltaSize.x+=this._options.sizeSpeed.x*t;this._deltaSize.y+=this._options.sizeSpeed.y*t;this._offset.x+=this._options.speed*t;this.updateAnimation()}}this._lastTime=e};i.prototype.play=function(){if(this._playStatus===0||this._playStatus===2){this._autoStoped=false;if(this._playStatus===0){this._timeUsed=0}this._playStatus=1}};i.prototype.pause=function(){if(this._playStatus===1){this._playStatus=2}};i.prototype.stop=function(){if(this._playStatus===1||this._playStatus===2){this._playStatus=0;this._autoStoped=false;this._offset.x=0;this._deltaSize.x=0;this._deltaSize.y=0;this.updateMatrix()}};i.prototype.update=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.point=Freedo.defaultValue(e.point,this._options.point);this._options.width=Freedo.defaultValue(e.width,this._options.width);this._options.length=Freedo.defaultValue(e.length,this._options.length);this._options.speed=Freedo.defaultValue(e.speed,this._options.speed);this._options.sizeSpeed=Freedo.defined(e.sizeSpeed)?Freedo.Cartesian2.clone(e.sizeSpeed,new Freedo.Cartesian2):this._options.sizeSpeed;this._options.loop=Freedo.defaultValue(e.loop,this._options.loop);this._options.duration=Freedo.defaultValue(e.duration,this._options.duration);if(Freedo.defined(this._primitive)){if(Freedo.defined(e.point)||Freedo.defined(e.width)||Freedo.defined(e.length)){this.updateMatrix()}}};Freedo.defineProperties(i.prototype,{show:{get:function e(){if(Freedo.defined(this._primitive)){return this._primitive.show}else{return false}},set:function e(t){if(Freedo.defined(this._primitive)){this._primitive.show=t;this._viewer.scene.requestRender()}}},finishedEvent:{get:function e(){return this._animationFinished}}});t.FdFlowTextureLine=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){this._primitive=undefined;this._playStatus=0;this._currentFrame=0;this._materialArray=[];this._viewer=e;this._options=Freedo.clone(t,false);this._options.heading=Freedo.defaultValue(this._options.heading,0);this._options.loop=Freedo.defaultValue(this._options.loop,false);this._options.duration=Freedo.defaultValue(this._options.duration,.3);this._animationFinished=new Freedo.Event;this._created=new Freedo.Event}i.prototype.createImpl=function(){var e=[];var t=[];var r=[];var i=[];e.push(-.5);e.push(-.5);e.push(0);t.push(0);t.push(0);t.push(1);r.push(0);r.push(0);e.push(.5);e.push(-.5);e.push(0);t.push(0);t.push(0);t.push(1);r.push(1);r.push(0);e.push(.5);e.push(.5);e.push(0);t.push(0);t.push(0);t.push(1);r.push(1);r.push(1);e.push(-.5);e.push(.5);e.push(0);t.push(0);t.push(0);t.push(1);r.push(0);r.push(1);i.push(0);i.push(1);i.push(2);i.push(0);i.push(2);i.push(3);var n=new Freedo.Geometry({attributes:{position:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:new Float64Array(e)}),normal:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array(t),normalize:true}),st:new Freedo.GeometryAttribute({componentDatatype:Freedo.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(r)})},indices:new Uint16Array(i),primitiveType:Freedo.PrimitiveType.TRIANGLES,boundingSphere:new Freedo.BoundingSphere(new Freedo.Cartesian3(0,0,0),.5)});var a=this._materialArray[this._currentFrame];var o=new Freedo.Primitive({geometryInstances:new Freedo.GeometryInstance({geometry:n}),appearance:new Freedo.MaterialAppearance({translucent:true,material:a,flat:true,faceForward:true}),compressVertices:false,asynchronous:false,cull:false});this._primitive=o;this.updateMatrix();if(!this._viewer.isDestroyed()){this._viewer.scene.primitives.add(this._primitive);this._viewer.scene.requestRender()}var s=this;this._listener=this._viewer.scene.preRender.addEventListener(function(){s.tick()});if(this._created.numberOfListeners>0){this._created.raiseEvent(this)}};i.prototype.create=function(){if(Freedo.defined(this._primitive)){return}if(this._materialArray.length>0){this.createImpl()}else{this._materialArray=new Array(this._options.imageUrls.length);var a=this;var o=0;var s=0;var l=this._options.imageUrls[s];var u=new Image;u.crossOrigin="anonymous";u.onload=function(){var t=undefined;try{o++;t=new Freedo.Texture({context:a._viewer.scene.context,width:u.width,height:u.height,source:u,flipY:false});var e=new Freedo.Material({translucent:true,fabric:{type:"Image"}});e.uniforms.image=t;a._materialArray[s]=e}catch(e){if(Freedo.defined(t)){t.destroy()}}s++;if(o===a._options.imageUrls.length){var r=[];for(var i=0;i<a._materialArray.length;i++){var n=a._materialArray[i];if(Freedo.defined(n)){r.push(n)}}a._materialArray=r;if(!a._viewer.isDestroyed())a.createImpl()}else if(s<a._options.imageUrls.length){l=a._options.imageUrls[s];u.src=l}};u.src=l}};i.prototype.destroy=function(){if(Freedo.defined(this._primitive)){this._viewer.scene.primitives.remove(this._primitive);this._primitive=undefined;this._viewer.scene.requestRender()}if(Freedo.defined(this._listener)){this._listener();this._listener=undefined}for(var e=0;e<this._materialArray.length;e++){this._materialArray[e].destroy()}this._materialArray=[]};i.prototype.updateMatrix=function(){if(Freedo.defined(this._primitive)){if(!Freedo.defined(this._matrix)){this._matrix=new Freedo.Matrix4}var e=Freedo.Transforms.eastNorthUpToFixedFrame(this._options.center,undefined,this._matrix);var t=this._options.heading;var r=Freedo.Quaternion.fromAxisAngle(Freedo.Cartesian3.UNIT_Z,-1*t,new Freedo.Quaternion);var i=Freedo.Matrix3.fromQuaternion(r,new Freedo.Matrix3);e=Freedo.Matrix4.multiplyByMatrix3(e,i,e);var n=new Freedo.Cartesian3(this._options.width,this._options.length,1);e=Freedo.Matrix4.multiplyByScale(e,n,e);this._primitive.modelMatrix=e;if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}};i.prototype.updateAnimation=function(){if(Freedo.defined(this._primitive)){this._primitive.appearance.material=this._materialArray[this._currentFrame];if(!this._viewer.isDestroyed())this._viewer.scene.requestRender()}};i.prototype.tick=function(){var e=(new Date).getTime();if(this._playStatus===1){if(!Freedo.defined(this._lastTime)){this._lastTime=e}else{var t=e-this._lastTime;t/=1e3;this._timeUsed+=t;if(this._timeUsed>=this._options.duration){if(this._currentFrame>=this._materialArray.length-1){if(this._options.loop){this._currentFrame=0;this._timeUsed=0}else{this._currentFrame=this._materialArray.length-1;this._timeUsed=this._options.duration;if(Freedo.defined(this._autoStoped)||this._autoStoped===false){this._autoStoped=true;if(this._animationFinished.numberOfListeners>0){this._animationFinished.raiseEvent(this)}}}}else{this._currentFrame++;this._timeUsed=0}this.updateAnimation()}}}this._lastTime=e};i.prototype.play=function(){if(this._playStatus===0||this._playStatus===2){this._autoStoped=false;if(this._playStatus===0){this._timeUsed=0}this._playStatus=1}};i.prototype.pause=function(){if(this._playStatus===1){this._playStatus=2}};i.prototype.stop=function(){if(this._playStatus===1||this._playStatus===2){this._playStatus=0;this._autoStoped=false;this._currentFrame=0}};i.prototype.update=function(e){if(!Freedo.defined(this._options)){this._options={}}this._options.center=Freedo.defaultValue(e.center,this._options.center);this._options.width=Freedo.defaultValue(e.width,this._options.width);this._options.length=Freedo.defaultValue(e.length,this._options.length);this._options.heading=Freedo.defaultValue(e.length,this._options.length);this._options.loop=Freedo.defaultValue(e.loop,this._options.loop);this._options.duration=Freedo.defaultValue(e.duration,this._options.duration);if(Freedo.defined(this._primitive)){if(Freedo.defined(e.center)||Freedo.defined(e.width)||Freedo.defined(e.length)||Freedo.defined(e.heading)){this.updateMatrix()}}};Freedo.defineProperties(i.prototype,{show:{get:function e(){if(Freedo.defined(this._primitive)){return this._primitive.show}else{return false}},set:function e(t){if(Freedo.defined(this._primitive)){this._primitive.show=t;this._viewer.scene.requestRender()}}},finishedEvent:{get:function e(){return this._animationFinished}},createdEvent:{get:function e(){return this._created}}});t.FdTextureFrame=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FdLocalView=undefined;var i=r(1);var n=f(i);var a=r(757);var o=r(178);var s=r(272);var l=r(762);var u=r(763);var d=r(764);var c=r(179);function f(e){return e&&e.__esModule?e:{default:e}}var h=function e(){(0,n.default)(this,e);throw new Error("FdLocalView should not be instantiated!")};h.Detector=a.Detector;h.PModelLoader=o.PModelLoader;h.GLTFLoader=s.GLTFLoader;h.DRACOLoader=l.DRACOLoader;h.DoubleViewerControls=u.DoubleViewerControls;h.SingleViewerControls=d.SingleViewerControls;h.FreedoControls=c.FreedoControls;t.FdLocalView=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch(e){return false}}(),webgl2:function(){try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function e(){var t=document.createElement("div");t.id="webgl-error-message";t.style.fontFamily="monospace";t.style.fontSize="13px";t.style.fontWeight="normal";t.style.textAlign="center";t.style.background="#fff";t.style.color="#000";t.style.padding="1.5em";t.style.width="400px";t.style.margin="5em auto 0";if(!this.webgl){t.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return t},addGetWebGLMessage:function e(t){var r,i,n;t=t||{};r=t.parent!==undefined?t.parent:document.body;i=t.id!==undefined?t.id:"oldie";n=a.getWebGLErrorMessage();n.id=i;r.appendChild(n)}};t.Detector=a},function(e,t,r){e.exports={default:r(759),__esModule:true}},function(e,t,r){r(760);e.exports=r(13).Object.keys},function(e,t,r){var i=r(94);var n=r(81);r(761)("keys",function(){return function e(t){return n(i(t))}})},function(e,t,r){var n=r(17);var a=r(13);var o=r(68);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e];var i={};i[e]=t(r);n(n.S+n.F*o(function(){r(1)}),"Object",i)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DRACOLoader=undefined;var i=r(121);var n=s(i);var a=r(49);var o=s(a);function s(e){return e&&e.__esModule?e:{default:e}}var l=function e(t){this.timeLoaded=0;this.manager=t||THREE.DefaultLoadingManager;this.materials=null;this.verbosity=0;this.attributeOptions={};this.drawMode=THREE.TrianglesDrawMode;this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};l.prototype={constructor:l,load:function e(t,r,i,n){var a=this;var o=new THREE.FileLoader(a.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.load(t,function(e){a.decodeDracoFile(e,r)},i,n)},setPath:function e(t){this.path=t;return this},setVerbosity:function e(t){this.verbosity=t;return this},setDrawMode:function e(t){this.drawMode=t;return this},setSkipDequantization:function e(t,r){var i=true;if(typeof r!=="undefined")i=r;this.getAttributeOptions(t).skipDequantization=i;return this},decodeDracoFile:function e(t,r,i,n){var a=this;l.getDecoderModule().then(function(e){a.decodeDracoFileInternal(t,e.decoder,r,i||{},n||{})})},decodeDracoFileInternal:function e(t,r,i,n,a){var o=new r.DecoderBuffer;o.Init(new Int8Array(t),t.byteLength);var s=new r.Decoder;var l=s.GetEncodedGeometryType(o);if(l==r.TRIANGULAR_MESH){if(this.verbosity>0){console.log("Loaded a mesh.")}}else if(l==r.POINT_CLOUD){if(this.verbosity>0){console.log("Loaded a point cloud.")}}else{var u="DRACOLoader: Unknown geometry type.";console.error(u);throw new Error(u)}i(this.convertDracoGeometryTo3JS(r,s,l,o,n,a))},addAttributeToGeometry:function e(t,r,i,n,a,o,s,l){if(o.ptr===0){var u="DRACOLoader: No attribute "+n;console.error(u);throw new Error(u)}var d=o.num_components();var c=i.num_points();var f=c*d;var h;var p;switch(a){case Float32Array:h=new t.DracoFloat32Array;r.GetAttributeFloatForAllPoints(i,o,h);l[n]=new Float32Array(f);p=THREE.Float32BufferAttribute;break;case Int8Array:h=new t.DracoInt8Array;r.GetAttributeInt8ForAllPoints(i,o,h);l[n]=new Int8Array(f);p=THREE.Int8BufferAttribute;break;case Int16Array:h=new t.DracoInt16Array;r.GetAttributeInt16ForAllPoints(i,o,h);l[n]=new Int16Array(f);p=THREE.Int16BufferAttribute;break;case Int32Array:h=new t.DracoInt32Array;r.GetAttributeInt32ForAllPoints(i,o,h);l[n]=new Int32Array(f);p=THREE.Int32BufferAttribute;break;case Uint8Array:h=new t.DracoUInt8Array;r.GetAttributeUInt8ForAllPoints(i,o,h);l[n]=new Uint8Array(f);p=THREE.Uint8BufferAttribute;break;case Uint16Array:h=new t.DracoUInt16Array;r.GetAttributeUInt16ForAllPoints(i,o,h);l[n]=new Uint16Array(f);p=THREE.Uint16BufferAttribute;break;case Uint32Array:h=new t.DracoUInt32Array;r.GetAttributeUInt32ForAllPoints(i,o,h);l[n]=new Uint32Array(f);p=THREE.Uint32BufferAttribute;break;default:var u="DRACOLoader: Unexpected attribute type.";console.error(u);throw new Error(u)}for(var v=0;v<f;v++){l[n][v]=h.GetValue(v)}s.addAttribute(n,new p(l[n],d));t.destroy(h)},convertDracoGeometryTo3JS:function e(t,r,i,n,a,o){if(this.getAttributeOptions("position").skipDequantization===true){r.SkipAttributeTransform(t.POSITION)}var s;var l;var u=performance.now();if(i===t.TRIANGULAR_MESH){s=new t.Mesh;l=r.DecodeBufferToMesh(n,s)}else{s=new t.PointCloud;l=r.DecodeBufferToPointCloud(n,s)}if(!l.ok()||s.ptr==0){var d="DRACOLoader: Decoding failed: ";d+=l.error_msg();console.error(d);t.destroy(r);t.destroy(s);throw new Error(d)}var c=performance.now();t.destroy(n);var f;if(i==t.TRIANGULAR_MESH){f=s.num_faces();if(this.verbosity>0){console.log("Number of faces loaded: "+f.toString())}}else{f=0}var h=s.num_points();var p=s.num_attributes();if(this.verbosity>0){console.log("Number of points loaded: "+h.toString());console.log("Number of attributes loaded: "+p.toString())}var v=r.GetAttributeId(s,t.POSITION);if(v==-1){var d="DRACOLoader: No position attribute found.";console.error(d);t.destroy(r);t.destroy(s);throw new Error(d)}var m=r.GetAttribute(s,v);var _={};var y=new THREE.BufferGeometry;for(var g in this.nativeAttributeMap){if(a[g]===undefined){var w=r.GetAttributeId(s,t[this.nativeAttributeMap[g]]);if(w!==-1){if(this.verbosity>0){console.log("Loaded "+g+" attribute.")}var F=r.GetAttribute(s,w);this.addAttributeToGeometry(t,r,s,g,Float32Array,F,y,_)}}}for(var g in a){var b=o[g]||Float32Array;var C=a[g];var F=r.GetAttributeByUniqueId(s,C);this.addAttributeToGeometry(t,r,s,g,b,F,y,_)}if(i==t.TRIANGULAR_MESH){if(this.drawMode===THREE.TriangleStripDrawMode){var x=new t.DracoInt32Array;var P=r.GetTriangleStripsFromMesh(s,x);_.indices=new Uint32Array(x.size());for(var M=0;M<x.size();++M){_.indices[M]=x.GetValue(M)}t.destroy(x)}else{var T=f*3;_.indices=new Uint32Array(T);var E=new t.DracoInt32Array;for(var M=0;M<f;++M){r.GetFaceFromMesh(s,M,E);var S=M*3;_.indices[S]=E.GetValue(0);_.indices[S+1]=E.GetValue(1);_.indices[S+2]=E.GetValue(2)}t.destroy(E)}}y.drawMode=this.drawMode;if(i==t.TRIANGULAR_MESH){y.setIndex(new(_.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(_.indices,1))}var A=new t.AttributeQuantizationTransform;if(A.InitFromAttribute(m)){y.attributes["position"].isQuantized=true;y.attributes["position"].maxRange=A.range();y.attributes["position"].numQuantizationBits=A.quantization_bits();y.attributes["position"].minValues=new Float32Array(3);for(var M=0;M<3;++M){y.attributes["position"].minValues[M]=A.min_value(M)}}t.destroy(A);t.destroy(r);t.destroy(s);this.decode_time=c-u;this.import_time=performance.now()-c;if(this.verbosity>0){console.log("Decode time: "+this.decode_time);console.log("Import time: "+this.import_time)}return y},isVersionSupported:function e(t,r){l.getDecoderModule().then(function(e){r(e.decoder.isVersionSupported(t))})},getAttributeOptions:function e(t){if(typeof this.attributeOptions[t]==="undefined")this.attributeOptions[t]={};return this.attributeOptions[t]}};l.decoderPath="./";l.decoderConfig={};l.decoderModulePromise=null;l.setDecoderPath=function(e){l.decoderPath=e};l.setDecoderConfig=function(e){var t=l.decoderConfig.wasmBinary;l.decoderConfig=e||{};l.releaseDecoderModule();if(t)l.decoderConfig.wasmBinary=t};l.releaseDecoderModule=function(){l.decoderModulePromise=null};l.getDecoderModule=function(){var r=this;var e=l.decoderPath;var i=l.decoderConfig;var t=l.decoderModulePromise;if(t)return t;if(typeof DracoDecoderModule!=="undefined"){t=o.default.resolve()}else if((typeof WebAssembly==="undefined"?"undefined":(0,n.default)(WebAssembly))!=="object"||i.type==="js"){t=l._loadScript(e+"draco_decoder.js")}else{i.wasmBinaryFile=e+"draco_decoder.wasm";t=l._loadScript(e+"draco_wasm_wrapper.js").then(function(){return l._loadArrayBuffer(i.wasmBinaryFile)}).then(function(e){i.wasmBinary=e})}t=t.then(function(){return new o.default(function(t){i.onModuleLoaded=function(e){r.timeLoaded=performance.now();t({decoder:e})};DracoDecoderModule(i)})});l.decoderModulePromise=t;return t};l._loadScript=function(e){var t=document.getElementById("decoder_script");if(t!==null){t.parentNode.removeChild(t)}var r=document.getElementsByTagName("head")[0];var i=document.createElement("script");i.id="decoder_script";i.type="text/javascript";i.src=e;return new o.default(function(e){i.onload=e;r.appendChild(i)})};l._loadArrayBuffer=function(r){var i=new THREE.FileLoader;i.setResponseType("arraybuffer");return new o.default(function(e,t){i.load(r,e,undefined,t)})};t.DRACOLoader=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DoubleViewerControls=undefined;var i=r(72);var n=o(i);var a=r(35);var L=o(a);var D=r(179);var I=r(178);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t,n,a,s,l,r){if(l==undefined||l==null){l=true}var u,d;var c,i,o,f,h,p,v;var m=n.clientWidth;var _=n.clientHeight;var y=a.clientWidth;var g=a.clientHeight;c=new THREE.PerspectiveCamera(45,m/_,.1,2e3);u=new D.FreedoControls(c,n);d=new D.FreedoControls(c,a);var w=new THREE.Vector3;var F=new THREE.Vector3;i=new THREE.Scene;o=new THREE.Scene;p=new THREE.HemisphereLight(12303359,4473890);p.position.set(0,1,0);i.add(p);v=new THREE.HemisphereLight(12303359,4473890);v.position.set(0,1,0);o.add(v);f=new THREE.WebGLRenderer({antialias:true});f.setPixelRatio(window.devicePixelRatio);f.setSize(m,_);n.appendChild(f.domElement);h=new THREE.WebGLRenderer({antialias:true});h.setPixelRatio(window.devicePixelRatio);h.setSize(y,g);a.appendChild(h.domElement);var b=new I.PModelLoader;b.treeDiv=r;b.controller=this;var C=b.gltfScene;var x=C.clone();i.add(C);o.add(x);u.setIntesetionTestGroup(C);d.setIntesetionTestGroup(x);var P=this;b.load(t,function(e,t,r){if(e.err){console.log("Load Error : "+e.err)}else{var i=e.scene;var n=i.clone();C.add(i);x.add(n);if(!l){M(i.children,[],false);M(n.children,[],false)}}s(b.boundingSphere,t,r);if(t===r){u.enabled=true;d.enabled=true}if(t===1){var a=b.boundingSphere.center;var o=b.boundingSphere.radius;u.target.set(a.x,a.y,a.z);d.target.set(a.x,a.y,a.z);c.position.set(a.x,a.y,a.z+o*5)}});function M(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];if(n.children&&n.children.length>0){M(n.children,t,r)}else{if(t.length===0){n.visible=r}else{var a=t.indexOf(n.name);if(a!==-1){n.visible=r}}}}}var T=new THREE.Vector3(0,0,0);var E=new L.default;var S=new L.default;function A(e,t,i,n){function r(t){var r=t.name;if(!t.material.materialShaderForHighlight){t.material=t.material.clone();t.material.onBeforeCompile=function(e){e.uniforms.highlight={value:1};e.uniforms.highlightColor={value:i};e.fragmentShader="uniform float highlight;\n uniform vec3 highlightColor;\n"+e.fragmentShader;e.fragmentShader=e.fragmentShader.replace("#include <fog_fragment>",["#include <fog_fragment>","if(highlight > 0.5){","\tgl_FragColor.rgb = mix( gl_FragColor.rgb, highlightColor, 0.5 );","}"].join("\n"));if(n){E.set(r,e)}else{S.set(r,e)}t.material.materialShaderForHighlight=e};t.material.needsUpdate=true}else{if(n){E.set(r,t.material.materialShaderForHighlight)}else{S.set(r,t.material.materialShaderForHighlight)}t.material.materialShaderForHighlight.uniforms.highlight.value=1;t.material.materialShaderForHighlight.uniforms.highlightColor.value=i}}for(var a=0;a<e.length;a++){var o=e[a];if(o.children&&o.children.length>0){A(o.children,t,i,n)}else{var s=t.indexOf(o.name);if(s!==-1){r(o)}}}}function k(n,e){if(e){E.forEach(function(e,t){if(n.length===0){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=T;E.delete(t)}else{var i=n.indexOf(t);if(i!=-1){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=T;E.delete(t)}}},E)}else{S.forEach(function(e,t){if(n.length===0){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=T;S.delete(t)}else{var i=n.indexOf(t);if(i!=-1){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=T;S.delete(t)}}},S)}}this.addPickingEventListener=function(e){u.addPickingEventListener(e);d.addPickingEventListener(e)},this.setEnablePicking=function(e){u.enablePicking=e;d.enablePicking=e},this.getEnablePicking=function(){return u.enablePicking},this.resize=function(){var e=n.clientWidth;var t=n.clientHeight;var r=a.clientWidth;var i=a.clientHeight;u.resize();d.resize();c.aspect=e/t;c.updateProjectionMatrix();f.setSize(e,t);h.setSize(r,i)},this.frame=function(){f.render(i,c);h.render(o,c)},this.showLeftViewerAllComponents=function(e){M(C.children,[],e)},this.showRightViewerAllComponents=function(e){M(x.children,[],e)},this.showLeftViewerComponents=function(e,t){M(C.children,e,t)},this.showRightViewerComponents=function(e,t){M(x.children,e,t)},this.highlightLeftViewerComponents=function(e,t){A(C.children,e,t,true)},this.highlightRightViewerComponents=function(e,t){A(x.children,e,t,false)},this.unhighlightLeftViewerComponents=function(e){k(e,true)},this.unhighlightRightViewerComponents=function(e){k(e,false)},this.getComponentBoundingBox=function(e){return b.getComponentBoundingBox(e)};this.showComponents=function(e,t){P.showLeftViewerComponents(e,t);P.showRightViewerComponents(e,t)},this.highlightComponents=function(e,t){P.highlightLeftViewerComponents(e,t);P.highlightRightViewerComponents(e,t)},this.unhighlightComponents=function(e){P.unhighlightLeftViewerComponents(e);P.unhighlightRightViewerComponents(e)},this.flyTo=function(e,t){var r=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var i=e;var n=t;if(!Array.isArray(e)){i=r(e);n=r(t)}w.x=(n[0]+i[0])/2;w.y=(n[1]+i[1])/2;w.z=(n[2]+i[2])/2;var a=Math.sqrt((n[0]-i[0])*(n[0]-i[0])+(n[1]-i[1])*(n[1]-i[1])+(n[2]-i[2])*(n[2]-i[2]));u.target.set(w.x,w.y,w.z);c.getWorldDirection(F);F.multiplyScalar(-a*10);w.add(F);c.position.set(w.x,w.y,w.z)}};s.prototype=(0,n.default)(THREE.EventDispatcher.prototype);s.prototype.constructor=s;t.DoubleViewerControls=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SingleViewerControls=undefined;var i=r(72);var n=o(i);var a=r(35);var C=o(a);var x=r(178);var P=r(179);function o(e){return e&&e.__esModule?e:{default:e}}var s=function e(t,r,o,s,i){if(s==undefined||s==null){s=true}var l;var u,n,a,d;var c=r.clientWidth;var f=r.clientHeight;this._canvasWidth=c;this._canvasHeight=f;u=new THREE.PerspectiveCamera(45,c/f,.1,2e3);l=new P.FreedoControls(u,r,c,f);n=new THREE.Scene;d=new THREE.HemisphereLight(12303359,4473890);d.position.set(0,1,0);n.add(d);a=new THREE.WebGLRenderer({antialias:true});a.setPixelRatio(window.devicePixelRatio);a.setSize(c,f);r.appendChild(a.domElement);var h=new x.PModelLoader;h.treeDiv=i;h.controller=this;var p=h.gltfScene;n.add(p);l.setIntesetionTestGroup(p);var v=new THREE.Vector3;var m=new THREE.Vector3;var _=this;h.load(t,function(e,t,r){if(e.err){console.log("Load Error : "+e.err)}else{var i=e.scene;p.add(i);if(!s){y(i.children,[],false)}}o(h.boundingSphere,t,r);if(t===r){l.enabled=true}if(t===1){var n=h.boundingSphere.center;var a=h.boundingSphere.radius;l.target.set(n.x,n.y,n.z);u.position.set(n.x,n.y,n.z+a*5)}});function y(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];if(n.children&&n.children.length>0){y(n.children,t,r)}else{if(t.length===0){n.visible=r}else{var a=t.indexOf(n.name);if(a!==-1){n.visible=r}}}}}var g=new THREE.Vector3(0,0,0);var w=new C.default;function F(e,t,i){function r(t){var r=t.name;if(!t.material.materialShaderForHighlight){t.material=t.material.clone();t.material.onBeforeCompile=function(e){e.uniforms.highlight={value:1};e.uniforms.highlightColor={value:i};e.fragmentShader="uniform float highlight;\n uniform vec3 highlightColor;\n"+e.fragmentShader;e.fragmentShader=e.fragmentShader.replace("#include <fog_fragment>",["#include <fog_fragment>","if(highlight > 0.5){","\tgl_FragColor.rgb = mix( gl_FragColor.rgb, highlightColor, 0.5 );","}"].join("\n"));w.set(r,e);t.material.materialShaderForHighlight=e};t.material.needsUpdate=true}else{w.set(r,t.material.materialShaderForHighlight);t.material.materialShaderForHighlight.uniforms.highlight.value=1;t.material.materialShaderForHighlight.uniforms.highlightColor.value=i}}for(var n=0;n<e.length;n++){var a=e[n];if(a.children&&a.children.length>0){F(a.children,t,i)}else{var o=t.indexOf(a.name);if(o!==-1){r(a)}}}}function b(n,e){w.forEach(function(e,t){if(n.length===0){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=g;w.delete(t)}else{var i=n.indexOf(t);if(i!=-1){var r=e;r.uniforms.highlight.value=0;r.uniforms.highlightColor.value=g;w.delete(t)}}},w)}this.addPickingEventListener=function(e){l.addPickingEventListener(e)},this.setEnablePicking=function(e){l.enablePicking=e},this.getEnablePicking=function(){return l.enablePicking},this.resize=function(){var e=r.clientWidth;var t=r.clientHeight;_._canvasWidth=e;_._canvasHeight=t;l.resize();u.aspect=e/t;u.updateProjectionMatrix();a.setSize(e,t)},this.frame=function(){a.render(n,u)},this.showAllComponents=function(e){y(p.children,[],e)},this.showComponents=function(e,t){y(p.children,e,t)},this.highlightComponents=function(e,t){F(p.children,e,t)},this.unhighlightComponents=function(e){b(e,true)},this.getComponentBoundingBox=function(e){return h.getComponentBoundingBox(e)};this.flyTo=function(e,t){var r=function e(t){var r=t.split(",");return[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])]};var i=e;var n=t;if(!Array.isArray(e)){i=r(e);n=r(t)}v.x=(n[0]+i[0])/2;v.y=(n[1]+i[1])/2;v.z=(n[2]+i[2])/2;var a=Math.sqrt((n[0]-i[0])*(n[0]-i[0])+(n[1]-i[1])*(n[1]-i[1])+(n[2]-i[2])*(n[2]-i[2]));l.target.set(v.x,v.y,v.z);u.getWorldDirection(m);m.multiplyScalar(-a*10);v.add(m);u.position.set(v.x,v.y,v.z)}};s.prototype=(0,n.default)(THREE.EventDispatcher.prototype);s.prototype.constructor=s;t.SingleViewerControls=s}]);