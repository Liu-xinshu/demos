/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
define(["exports","./defined-b9ff0e39","./Check-e6691f86","./defaultValue-199f5aa8","./Math-92bd3539","./Cartesian2-8fa798b8","./objectToQuery-2e382d4d"],function(t,q,a,m,z,T,W){"use strict";var U={};function h(t,a,e){var r=t+a;return z.CesiumMath.sign(t)!==z.CesiumMath.sign(a)&&Math.abs(r/Math.max(Math.abs(t),Math.abs(a)))<e?0:r}U.computeDiscriminant=function(t,a,e){return a*a-4*t*e},U.computeRealRoots=function(t,a,e){var r;if(0===t)return 0===a?[]:[-e/a];if(0===a){if(0===e)return[0,0];var n=Math.abs(e),i=Math.abs(t);if(n<i&&n/i<z.CesiumMath.EPSILON14)return[0,0];if(i<n&&i/n<z.CesiumMath.EPSILON14)return[];if((r=-e/t)<0)return[];var s=Math.sqrt(r);return[-s,s]}if(0===e)return(r=-a/t)<0?[r,0]:[0,r];var o=h(a*a,-(4*t*e),z.CesiumMath.EPSILON14);if(o<0)return[];var u=-.5*h(a,z.CesiumMath.sign(a)*Math.sqrt(o),z.CesiumMath.EPSILON14);return 0<a?[u/t,e/u]:[e/u,u/t]};var N={};function o(t,a,e,r){var n,i,s=t,o=a/3,u=e/3,h=r,l=s*u,c=o*h,d=o*o,C=u*u,f=s*u-d,M=s*h-o*u,g=o*h-C,m=4*f*g-M*M;if(m<0){var v,p,R,w=-((R=l*C<=d*c?-2*o*(p=f)+(v=s)*M:-(v=h)*M+2*u*(p=g))<0?-1:1)*Math.abs(v)*Math.sqrt(-m),b=(i=w-R)/2,x=b<0?-Math.pow(-b,1/3):Math.pow(b,1/3),S=i===w?-x:-p/x;return n=p<=0?x+S:-R/(x*x+S*S+p),l*C<=d*c?[(n-o)/s]:[-h/(n+u)]}var O=f,y=-2*o*f+s*M,P=g,N=-h*M+2*u*g,q=Math.sqrt(m),I=Math.sqrt(3)/2,L=Math.abs(Math.atan2(s*q,-y)/3);n=2*Math.sqrt(-O);var E=Math.cos(L);i=n*E;var z=n*(-E/2-I*Math.sin(L)),T=2*o<i+z?i-o:z-o,W=s,U=T/W;L=Math.abs(Math.atan2(h*q,-N)/3);var B=-h,V=(i=(n=2*Math.sqrt(-P))*(E=Math.cos(L)))+(z=n*(-E/2-I*Math.sin(L)))<2*u?i+u:z+u,Z=B/V,A=-T*V-W*B,D=(u*A-o*(T*B))/(-o*A+u*(W*V));return U<=D?U<=Z?D<=Z?[U,D,Z]:[U,Z,D]:[Z,U,D]:U<=Z?[D,U,Z]:D<=Z?[D,Z,U]:[Z,D,U]}N.computeDiscriminant=function(t,a,e,r){var n=a*a,i=e*e;return 18*t*a*e*r+n*i-27*(t*t)*(r*r)-4*(t*i*e+n*a*r)},N.computeRealRoots=function(t,a,e,r){var n,i;if(0===t)return U.computeRealRoots(a,e,r);if(0!==a)return 0===e?0===r?(i=-a/t)<0?[i,0,0]:[0,0,i]:o(t,a,0,r):0===r?0===(n=U.computeRealRoots(t,a,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:0<=n[0]?[0,n[0],n[1]]:[n[0],0,n[1]]:o(t,a,e,r);if(0!==e)return 0===r?0===(n=U.computeRealRoots(t,0,e)).Length?[0]:[n[0],0,n[1]]:o(t,0,e,r);if(0===r)return[0,0,0];var s=(i=-r/t)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[s,s,s]};var B={};function l(t,a,e,r){var n=t*t,i=a-3*n/8,s=e-a*t/2+n*t/8,o=r-e*t/4+a*n/16-3*n*n/256,u=N.computeRealRoots(1,2*i,i*i-4*o,-s*s);if(0<u.length){var h=-t/4,l=u[u.length-1];if(Math.abs(l)<z.CesiumMath.EPSILON14){var c=U.computeRealRoots(1,i,o);if(2===c.length){var d,C=c[0],f=c[1];if(0<=C&&0<=f){var M=Math.sqrt(C),g=Math.sqrt(f);return[h-g,h-M,h+M,h+g]}if(0<=C&&f<0)return[h-(d=Math.sqrt(C)),h+d];if(C<0&&0<=f)return[h-(d=Math.sqrt(f)),h+d]}return[]}if(0<l){var m=Math.sqrt(l),v=(i+l-s/m)/2,p=(i+l+s/m)/2,R=U.computeRealRoots(1,m,v),w=U.computeRealRoots(1,-m,p);return 0!==R.length?(R[0]+=h,R[1]+=h,0!==w.length?(w[0]+=h,w[1]+=h,R[1]<=w[0]?[R[0],R[1],w[0],w[1]]:w[1]<=R[0]?[w[0],w[1],R[0],R[1]]:R[0]>=w[0]&&R[1]<=w[1]?[w[0],R[0],R[1],w[1]]:w[0]>=R[0]&&w[1]<=R[1]?[R[0],w[0],w[1],R[1]]:R[0]>w[0]&&R[0]<w[1]?[w[0],R[0],w[1],R[1]]:[R[0],w[0],R[1],w[1]]):R):0!==w.length?(w[0]+=h,w[1]+=h,w):[]}}return[]}function c(t,a,e,r){var n=t*t,i=-2*a,s=e*t+a*a-4*r,o=n*r-e*a*t+e*e,u=N.computeRealRoots(1,i,s,o);if(0<u.length){var h,l,c,d,C,f,M=u[0],g=a-M,m=g*g,v=t/2,p=g/2,R=m-4*r,w=m+4*Math.abs(r),b=n-4*M,x=n+4*Math.abs(M);if(M<0||R*x<b*w){var S=Math.sqrt(b);h=S/2,l=0===S?0:(t*p-e)/S}else{var O=Math.sqrt(R);h=0===O?0:(t*p-e)/O,l=O/2}0==v&&0===h?d=c=0:z.CesiumMath.sign(v)===z.CesiumMath.sign(h)?d=M/(c=v+h):c=M/(d=v-h),0==p&&0===l?f=C=0:z.CesiumMath.sign(p)===z.CesiumMath.sign(l)?f=r/(C=p+l):C=r/(f=p-l);var y=U.computeRealRoots(1,c,C),P=U.computeRealRoots(1,d,f);if(0!==y.length)return 0!==P.length?y[1]<=P[0]?[y[0],y[1],P[0],P[1]]:P[1]<=y[0]?[P[0],P[1],y[0],y[1]]:y[0]>=P[0]&&y[1]<=P[1]?[P[0],y[0],y[1],P[1]]:P[0]>=y[0]&&P[1]<=y[1]?[y[0],P[0],P[1],y[1]]:y[0]>P[0]&&y[0]<P[1]?[P[0],y[0],P[1],y[1]]:[y[0],P[0],y[1],P[1]]:y;if(0!==P.length)return P}return[]}function e(t,a){a=T.Cartesian3.clone(m.defaultValue(a,T.Cartesian3.ZERO)),T.Cartesian3.equals(a,T.Cartesian3.ZERO)||T.Cartesian3.normalize(a,a),this.origin=T.Cartesian3.clone(m.defaultValue(t,T.Cartesian3.ZERO)),this.direction=a}B.computeDiscriminant=function(t,a,e,r,n){var i=t*t,s=a*a,o=s*a,u=e*e,h=u*e,l=r*r,c=l*r,d=n*n;return s*u*l-4*o*c-4*t*h*l+18*t*a*e*c-27*i*l*l+256*(i*t)*(d*n)+n*(18*o*e*r-4*s*h+16*t*u*u-80*t*a*u*r-6*t*s*l+144*i*e*l)+d*(144*t*s*e-27*s*s-128*i*u-192*i*a*r)},B.computeRealRoots=function(t,a,e,r,n){if(Math.abs(t)<z.CesiumMath.EPSILON15)return N.computeRealRoots(a,e,r,n);var i=a/t,s=e/t,o=r/t,u=n/t,h=i<0?1:0;switch(h+=s<0?h+1:h,h+=o<0?h+1:h,h+=u<0?h+1:h){case 0:return l(i,s,o,u);case 1:case 2:return c(i,s,o,u);case 3:case 4:return l(i,s,o,u);case 5:return c(i,s,o,u);case 6:case 7:return l(i,s,o,u);case 8:return c(i,s,o,u);case 9:case 10:return l(i,s,o,u);case 11:return c(i,s,o,u);case 12:case 13:case 14:case 15:return l(i,s,o,u);default:return}},e.clone=function(t,a){if(q.defined(t))return q.defined(a)?(a.origin=T.Cartesian3.clone(t.origin),a.direction=T.Cartesian3.clone(t.direction),a):new e(t.origin,t.direction)},e.getPoint=function(t,a,e){return q.defined(e)||(e=new T.Cartesian3),e=T.Cartesian3.multiplyByScalar(t.direction,a,e),T.Cartesian3.add(t.origin,e,e)};var d={rayPlane:function(t,a,e){q.defined(e)||(e=new T.Cartesian3);var r=t.origin,n=t.direction,i=a.normal,s=T.Cartesian3.dot(i,n);if(!(Math.abs(s)<z.CesiumMath.EPSILON15)){var o=(-a.distance-T.Cartesian3.dot(i,r))/s;if(!(o<0))return e=T.Cartesian3.multiplyByScalar(n,o,e),T.Cartesian3.add(r,e,e)}}},v=new T.Cartesian3,p=new T.Cartesian3,R=new T.Cartesian3,w=new T.Cartesian3,b=new T.Cartesian3;d.rayTriangleParametric=function(t,a,e,r,n){n=m.defaultValue(n,!1);var i,s,o,u,h,l=t.origin,c=t.direction,d=T.Cartesian3.subtract(e,a,v),C=T.Cartesian3.subtract(r,a,p),f=T.Cartesian3.cross(c,C,R),M=T.Cartesian3.dot(d,f);if(n){if(M<z.CesiumMath.EPSILON6)return;if(i=T.Cartesian3.subtract(l,a,w),(o=T.Cartesian3.dot(i,f))<0||M<o)return;if(s=T.Cartesian3.cross(i,d,b),(u=T.Cartesian3.dot(c,s))<0||M<o+u)return;h=T.Cartesian3.dot(C,s)/M}else{if(Math.abs(M)<z.CesiumMath.EPSILON6)return;var g=1/M;if(i=T.Cartesian3.subtract(l,a,w),(o=T.Cartesian3.dot(i,f)*g)<0||1<o)return;if(s=T.Cartesian3.cross(i,d,b),(u=T.Cartesian3.dot(c,s)*g)<0||1<o+u)return;h=T.Cartesian3.dot(C,s)*g}return h},d.rayTriangle=function(t,a,e,r,n,i){var s=d.rayTriangleParametric(t,a,e,r,n);if(q.defined(s)&&!(s<0))return q.defined(i)||(i=new T.Cartesian3),T.Cartesian3.multiplyByScalar(t.direction,s,i),T.Cartesian3.add(t.origin,i,i)};var C=new e;d.lineSegmentTriangle=function(t,a,e,r,n,i,s){var o=C;T.Cartesian3.clone(t,o.origin),T.Cartesian3.subtract(a,t,o.direction),T.Cartesian3.normalize(o.direction,o.direction);var u=d.rayTriangleParametric(o,e,r,n,i);if(!(!q.defined(u)||u<0||u>T.Cartesian3.distance(t,a)))return q.defined(s)||(s=new T.Cartesian3),T.Cartesian3.multiplyByScalar(o.direction,u,s),T.Cartesian3.add(o.origin,s,s)};var f={root0:0,root1:0};function u(t,a,e){q.defined(e)||(e=new W.Interval);var r=t.origin,n=t.direction,i=a.center,s=a.radius*a.radius,o=T.Cartesian3.subtract(r,i,R),u=function(t,a,e,r){var n=a*a-4*t*e;if(!(n<0)){if(0<n){var i=1/(2*t),s=Math.sqrt(n),o=(-a+s)*i,u=(-a-s)*i;return o<u?(r.root0=o,r.root1=u):(r.root0=u,r.root1=o),r}var h=-a/(2*t);if(0!=h)return r.root0=r.root1=h,r}}(T.Cartesian3.dot(n,n),2*T.Cartesian3.dot(n,o),T.Cartesian3.magnitudeSquared(o)-s,f);if(q.defined(u))return e.start=u.root0,e.stop=u.root1,e}d.raySphere=function(t,a,e){if(e=u(t,a,e),q.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};var M=new e;d.lineSegmentSphere=function(t,a,e,r){var n=M;T.Cartesian3.clone(t,n.origin);var i=T.Cartesian3.subtract(a,t,n.direction),s=T.Cartesian3.magnitude(i);if(T.Cartesian3.normalize(i,i),r=u(n,e,r),!(!q.defined(r)||r.stop<0||r.start>s))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,s),r};var g=new T.Cartesian3,x=new T.Cartesian3;function V(t,a,e){var r=t+a;return z.CesiumMath.sign(t)!==z.CesiumMath.sign(a)&&Math.abs(r/Math.max(Math.abs(t),Math.abs(a)))<e?0:r}d.rayEllipsoid=function(t,a){var e,r,n,i,s,o=a.oneOverRadii,u=T.Cartesian3.multiplyComponents(o,t.origin,g),h=T.Cartesian3.multiplyComponents(o,t.direction,x),l=T.Cartesian3.magnitudeSquared(u),c=T.Cartesian3.dot(u,h);if(1<l){if(0<=c)return;var d=c*c;if(e=l-1,d<(n=(r=T.Cartesian3.magnitudeSquared(h))*e))return;if(n<d){i=c*c-n;var C=(s=-c+Math.sqrt(i))/r,f=e/s;return C<f?new W.Interval(C,f):{start:f,stop:C}}var M=Math.sqrt(e/r);return new W.Interval(M,M)}return l<1?(e=l-1,i=c*c-(n=(r=T.Cartesian3.magnitudeSquared(h))*e),s=-c+Math.sqrt(i),new W.Interval(0,s/r)):c<0?(r=T.Cartesian3.magnitudeSquared(h),new W.Interval(0,-c/r)):void 0};var I=new T.Cartesian3,L=new T.Cartesian3,E=new T.Cartesian3,Z=new T.Cartesian3,A=new T.Cartesian3,D=new W.Matrix3,k=new W.Matrix3,j=new W.Matrix3,F=new W.Matrix3,G=new W.Matrix3,Q=new W.Matrix3,Y=new W.Matrix3,_=new T.Cartesian3,H=new T.Cartesian3,J=new T.Cartographic;d.grazingAltitudeLocation=function(t,a){var e=t.origin,r=t.direction;if(!T.Cartesian3.equals(e,T.Cartesian3.ZERO)){var n=a.geodeticSurfaceNormal(e,I);if(0<=T.Cartesian3.dot(r,n))return e}var i=q.defined(this.rayEllipsoid(t,a)),s=a.transformPositionToScaledSpace(r,I),o=T.Cartesian3.normalize(s,s),u=T.Cartesian3.mostOrthogonalAxis(s,Z),h=T.Cartesian3.normalize(T.Cartesian3.cross(u,o,L),L),l=T.Cartesian3.normalize(T.Cartesian3.cross(o,h,E),E),c=D;c[0]=o.x,c[1]=o.y,c[2]=o.z,c[3]=h.x,c[4]=h.y,c[5]=h.z,c[6]=l.x,c[7]=l.y,c[8]=l.z;var d=W.Matrix3.transpose(c,k),C=W.Matrix3.fromScale(a.radii,j),f=W.Matrix3.fromScale(a.oneOverRadii,F),M=G;M[0]=0,M[1]=-r.z,M[2]=r.y,M[3]=r.z,M[4]=0,M[5]=-r.x,M[6]=-r.y,M[7]=r.x,M[8]=0;var g,m,v=W.Matrix3.multiply(W.Matrix3.multiply(d,f,Q),M,Q),p=W.Matrix3.multiply(W.Matrix3.multiply(v,C,Y),c,Y),R=W.Matrix3.multiplyByVector(v,e,A),w=function(t,a,e,r,n){var i,s=r*r,o=n*n,u=(t[W.Matrix3.COLUMN1ROW1]-t[W.Matrix3.COLUMN2ROW2])*o,h=n*(r*V(t[W.Matrix3.COLUMN1ROW0],t[W.Matrix3.COLUMN0ROW1],z.CesiumMath.EPSILON15)+a.y),l=t[W.Matrix3.COLUMN0ROW0]*s+t[W.Matrix3.COLUMN2ROW2]*o+r*a.x+e,c=o*V(t[W.Matrix3.COLUMN2ROW1],t[W.Matrix3.COLUMN1ROW2],z.CesiumMath.EPSILON15),d=n*(r*V(t[W.Matrix3.COLUMN2ROW0],t[W.Matrix3.COLUMN0ROW2])+a.z),C=[];if(0==d&&0==c){if(0===(i=U.computeRealRoots(u,h,l)).length)return C;var f=i[0],M=Math.sqrt(Math.max(1-f*f,0));if(C.push(new T.Cartesian3(r,n*f,n*-M)),C.push(new T.Cartesian3(r,n*f,n*M)),2===i.length){var g=i[1],m=Math.sqrt(Math.max(1-g*g,0));C.push(new T.Cartesian3(r,n*g,n*-m)),C.push(new T.Cartesian3(r,n*g,n*m))}return C}var v=d*d,p=c*c,R=d*c,w=u*u+p,b=2*(h*u+R),x=2*l*u+h*h-p+v,S=2*(l*h-R),O=l*l-v;if(0==w&&0==b&&0==x&&0==S)return C;var y=(i=B.computeRealRoots(w,b,x,S,O)).length;if(0===y)return C;for(var P=0;P<y;++P){var N=i[P],q=N*N,I=Math.max(1-q,0),L=Math.sqrt(I),E=(z.CesiumMath.sign(u)===z.CesiumMath.sign(l)?V(u*q+l,h*N,z.CesiumMath.EPSILON12):z.CesiumMath.sign(l)===z.CesiumMath.sign(h*N)?V(u*q,h*N+l,z.CesiumMath.EPSILON12):V(u*q+h*N,l,z.CesiumMath.EPSILON12))*V(c*N,d,z.CesiumMath.EPSILON15);E<0?C.push(new T.Cartesian3(r,n*N,n*L)):0<E?C.push(new T.Cartesian3(r,n*N,n*-L)):0!==L?(C.push(new T.Cartesian3(r,n*N,n*-L)),C.push(new T.Cartesian3(r,n*N,n*L)),++P):C.push(new T.Cartesian3(r,n*N,n*L))}return C}(p,T.Cartesian3.negate(R,I),0,0,1),b=w.length;if(0<b){for(var x=T.Cartesian3.clone(T.Cartesian3.ZERO,H),S=Number.NEGATIVE_INFINITY,O=0;O<b;++O){g=W.Matrix3.multiplyByVector(C,W.Matrix3.multiplyByVector(c,w[O],_),_);var y=T.Cartesian3.normalize(T.Cartesian3.subtract(g,e,Z),Z),P=T.Cartesian3.dot(y,r);S<P&&(S=P,x=T.Cartesian3.clone(g,x))}var N=a.cartesianToCartographic(x,J);return S=z.CesiumMath.clamp(S,0,1),m=T.Cartesian3.magnitude(T.Cartesian3.subtract(x,e,Z))*Math.sqrt(1-S*S),m=i?-m:m,N.height=m,a.cartographicToCartesian(N,new T.Cartesian3)}};var S=new T.Cartesian3;function O(t,a){var e,r,n,i,s=0,o=a.length;for(n=a[0],e=1;e<=o;e++)i=a[e%o],t[0]>Math.min(n[0],i[0])&&t[0]<=Math.max(n[0],i[0])&&t[1]<=Math.max(n[1],i[1])&&n[0]!==i[0]&&(r=(t[0]-n[0])*(i[1]-n[1])/(i[0]-n[0])+n[1],(n[1]===i[1]||t[1]<=r)&&s++),n=i;return s%2}d.lineSegmentPlane=function(t,a,e,r){q.defined(r)||(r=new T.Cartesian3);var n=T.Cartesian3.subtract(a,t,S),i=e.normal,s=T.Cartesian3.dot(i,n);if(!(Math.abs(s)<z.CesiumMath.EPSILON6)){var o=T.Cartesian3.dot(i,t),u=-(e.distance+o)/s;if(!(u<0||1<u))return T.Cartesian3.multiplyByScalar(n,u,r),T.Cartesian3.add(t,r,r),r}},d.trianglePlaneIntersection=function(t,a,e,r){var n,i,s=r.normal,o=r.distance,u=T.Cartesian3.dot(s,t)+o<0,h=T.Cartesian3.dot(s,a)+o<0,l=T.Cartesian3.dot(s,e)+o<0,c=0;if(c+=u?1:0,c+=h?1:0,1!=(c+=l?1:0)&&2!=c||(n=new T.Cartesian3,i=new T.Cartesian3),1==c){if(u)return d.lineSegmentPlane(t,a,r,n),d.lineSegmentPlane(t,e,r,i),{positions:[t,a,e,n,i],indices:[0,3,4,1,2,4,1,4,3]};if(h)return d.lineSegmentPlane(a,e,r,n),d.lineSegmentPlane(a,t,r,i),{positions:[t,a,e,n,i],indices:[1,3,4,2,0,4,2,4,3]};if(l)return d.lineSegmentPlane(e,t,r,n),d.lineSegmentPlane(e,a,r,i),{positions:[t,a,e,n,i],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==c){if(!u)return d.lineSegmentPlane(a,t,r,n),d.lineSegmentPlane(e,t,r,i),{positions:[t,a,e,n,i],indices:[1,2,4,1,4,3,0,3,4]};if(!h)return d.lineSegmentPlane(e,a,r,n),d.lineSegmentPlane(t,a,r,i),{positions:[t,a,e,n,i],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return d.lineSegmentPlane(t,e,r,n),d.lineSegmentPlane(a,e,r,i),{positions:[t,a,e,n,i],indices:[0,1,4,0,4,3,2,3,4]}}},d.intersetRectangleWithConstraintRegion=function(t,a){if(!q.defined(t)||!q.defined(a))return-1;var r=Math.min(t.east,t.west),n=Math.max(t.east,t.west),i=Math.min(t.north,t.south),s=Math.max(t.north,t.south);function e(t){if(O([r,i],t))return 1;if(O([r,s],t))return 1;if(O([n,i],t))return 1;if(O([n,s],t))return 1;for(var a=[[r,i],[r,s],[n,s],[n,i]],e=0;e<t.length;e++)if(O(t[e],a))return 1;return 0}for(var o=0;o<a.length;o++){var u=a[o].minMaxRegion,h=u[0],l=u[1],c=u[2],d=u[3],C=Math.abs(r+n-h-l),f=Math.abs(r-n)+Math.abs(h-l),M=Math.abs(i+s-c-d),g=Math.abs(i-s)+Math.abs(c-d),m=a[o].constraintRegion;if(C<=f&&M<=g&&e(m))return o;if((h<=r&&r<=l&&c<=i&&i<=d||r<=h&&h<=n&&i<=c&&c<=s)&&e(m))return o}return-1},d.isCartographicInConstraintRegion=function(t,a,e){if(!q.defined(t||!q.defined(e)))return-1;var r;if(-1!==a&&(r=e[a].constraintRegion,O([t.longitude,t.latitude],r)))return a;for(var n=0;n<e.length;n++)if(n!==a&&(r=e[n].constraintRegion,O([t.longitude,t.latitude],r)))return n;return-1};var y=new T.Cartographic,P=new T.Cartographic,K=new T.Cartesian3,X=new T.Cartesian3,$=new T.Cartesian3;d.interoplateCartographicWhenSmooth=function(t,a){if(!q.defined(a.interpolateCartographics))return a.height;var d=t.longitude,C=t.latitude;function e(t,a){var e=1e4*d,r=1e4*C,n=1e4*t[0],i=1e4*t[1],s=1e4*a[0],o=1e4*a[1],u=s-n,h=o-i;if(Math.abs(u)<1e-6&&Math.abs(h)<1e-6)return{distance:1e10};if(Math.abs(u)<1e-6)return r>=Math.min(o,i)&&r<=Math.max(o,i)?{distance:(e-n)*(e-n),point:[n/1e4,C]}:{distance:1e10};if(Math.abs(h)<1e-6)return e>=Math.min(n,s)&&e<=Math.max(n,s)?{distance:(r-o)*(r-o),point:[d,o/1e4]}:{distance:1e10};var l=(h*n-u*i-(h*e-u*r))/(u*u+h*h),c=[h*l,-u*l];return{distance:c[0]*c[0]+c[1]*c[1],point:[(h*l+e)/1e4,(-u*l+r)/1e4]}}for(var r=[],n=a.constraintRegion.length,i=0;i<n;i++){var s=e(a.constraintRegion[i],a.constraintRegion[(i+1)%n]);r.push({distance:s.distance,index:i,point:s.point})}if(r.sort(function(t,a){var e=t.distance,r=a.distance;return e<r?-1:r<e?1:0}),r.length<2||1e8<r[1].distance||1e8<r[0].distance)return a.height;y.longitude=r[0].point[0],y.latitude=r[0].point[1],P.longitude=r[1].point[0],P.latitude=r[1].point[1],K=T.Cartesian3.fromRadians(t.longitude,t.latitude),X=T.Cartesian3.fromRadians(y.longitude,y.latitude),$=T.Cartesian3.fromRadians(P.longitude,P.latitude);for(var o,u,h=T.Cartesian3.distance(X,K),l=T.Cartesian3.distance($,K),c=0,f=0;f<a.interpolateCartographics.length;f++){var M=a.interpolateCartographics[f],g=a.interpolateCartographics[(f+1)%a.interpolateCartographics.length];if(0==(Math.abs(M.longitude-g.longitude)>Math.abs(M.latitude-g.latitude)?0:1)?(M.longitude<=d&&g.longitude>=d||M.longitude>=d&&g.longitude<=d)&&(o=Math.abs(d-M.longitude),u=Math.abs(d-g.longitude),P.height=(M.height*u+g.height*o)/(o+u),c++):(M.latitude<=C&&g.latitude>=C||M.latitude>=C&&g.latitude<=C)&&(o=Math.abs(C-M.latitude),u=Math.abs(C-g.latitude),y.height=(M.height*u+g.height*o)/(o+u),c++),2===c)break}if(2!==c)return a.height;var m=y.height-.5*h,v=P.height-.5*l;return m<v?v:m},t.IntersectionTests=d,t.Ray=e});
